define.deployment("tpa.common.BootstrapIntegrationTests",function(a){function b(a){return a.replace(/([^:])\/{2,}/g,"$1/")}function c(a,b,c){function d(a){console.log("Loaded: "+a),f--,0===f&&c()}function e(a,b,c,d){throw f=-1,a=a.src||a,new Error("Failed to load: "+a+"\n"+d)}var f=b.length;b.forEach(function(b){a.loadResource({url:b},{onLoad:d.bind(b),onFailed:e.bind(b)})})}var d=/[?&]jasminespec=([^&]+)/i.exec(window.location.search);if(d&&window.self===window.top){var e=decodeURIComponent(d[1]),f=e.split(":");if(2!==f.length)throw new Error('Invalid format of the "jasmineSpec" query parameter. Expected: artifact:name');var g,h=f[0],i=f[1];!function(a){var b=a._windowErrorsStore&&"function"==typeof a._windowErrorsStore.pop?a._windowErrorsStore.pop.bind(a._windowErrorsStore):function(){a._windowErrors=[];var b=a.onerror;return a.onerror=function(){var c=Array.prototype.slice.call(arguments);return c.unshift(new Date),a._windowErrors.push(c),"function"==typeof b?b.apply(this,arguments):!1},function(){var b=a._windowErrors;return a._windowErrors=[],b}}(),c=function(){return g?g.isComplete()?"TESTS COMPLETE":"TESTS RUNNING":"WAITING FOR TESTS TO START"},d=function(){var b=a._consoleLog||a._consoleLogStore;if(!b||"function"!=typeof b.get)return[];b.pop=b.pop||function(){var a=b.get();return b.clear(),a};var c=new RegExp(">>>>LOG"),d=b.pop();return d=d.filter(function(a){return"string"!=typeof a[2]||!c.test(a[2])})},e=function(){return g&&g.popLog()};a.testManager={getProgress:function(){return{state:c(),windowErrors:b(),consoleLog:d(),testLog:e()}}}}(window),a.atPhase(PHASES.UTILS,function(a){var b=a.async(2e4,"Waiting for TPA integration tests utils");window.resource.getResourceValue("scriptLoader",function(a){a.loadResource({url:"http://s3.amazonaws.com/wix-client-versions/versions.json"},{onLoad:function(c){window._versions=c;var d=c&&c["js-sdk"];if(d){var e="http://sslstatic.wix.com/services/js-sdk/${version}/js/Wix.js".replace("${version}",d.ga);a.getUrl(e)}b()}})})}),a.atPhase(PHASES.TEST,function(a){function d(){var a=window.jasmine,b=a.getEnv();b.addReporter(new a.HtmlReporter),g=new a.RemoteReporter,b.addReporter(g),Q.longStackSupport=!0,b.execute()}var e=a.async(5e3,"Waiting for TPA integration tests spec"),f={tags:_.noop,driver:_.noop,urlParams:_.noop,urlHash:_.noop,describe:window.describe};window.describeRunner=function(a){a(f)},window.resource.getResources(["scriptLoader","topology"],function(a){var f=a.topology[h];if(!f)throw e(),new Error('Could not find artifact "'+h+'" in topology');var g=b(f+"/"+i+".js"),j=[g];c(a.scriptLoader,j,function(){function a(){return b=window.W.Editor.isReady(),c=window.W.Preview&&window.W.Preview.isReady()&&window.W.Preview.isSiteReady(),b&&c?void setTimeout(d,1):void(b||f?c||g||(W.Commands.registerCommandAndListener("PreviewIsReady",{},a),g=!0):(window.W.Editor.addEvent(window.W.Editor.EDITOR_READY,a),f=!0))}e();var b,c,f,g;window.W.Editor?a():window.W.Viewer&&(window.W.Viewer.isSiteReady()?d():window.W.Viewer.addEvent("SiteReady",d))})})})}}),define.component("tpa.common.components.TPAAsyncOverlayMessage",function(a){var b=a;b.inherits("tpa.common.components.TPAOverlayMessage"),b.resources(["W.Config"]),b.methods({_onAllSkinPartsReady:function(){this.parent(),this._getText(this._setText.bind(this))},_getText:function(){throw new Error("Must implement _getText!")}})}),define.component("tpa.common.components.TPABase",function(a){var b=a;b.inherits("mobile.core.components.base.BaseComponent"),b.resources(["W.Config","W.Classes","W.Components"]),b.traits(["tpa.common.traits.TPAComponentRegistryAccessor","tpa.common.traits.HasOverlayMessages"]),b.states({iframe:["iframeShown","iframeNotShown","iframeRenderedInvisible"]}),b.skinParts({iframe:{type:"htmlElement"},overlayMessage:{autoCreate:!1}}),b.binds(["_onIframeLoad"]),b.statics({IFRAME_BLANK_URL:"about:blank",LOAD_TIMEOUT:20}),b.methods({initialize:function(a,b,c){this.parent(a,b,c),this.resources.W.Classes.getClass("mobile.core.components.base.BaseComponent",function(a){this._baseDispose=a.prototype.dispose.bind(this)}.bind(this)),this._initialized=!1,this._appIsAlive=!1,this.disposeFunctions=[],this._iframe=null,this._unresponsiveCheckTimerId=null,this.safeMode=this.resources.W.Utils.getQueryParam("safeMode"),this.setState("iframeShown","iframe")},getViewMode:function(){return this.resources.W.Config.env.$isPublicViewerFrame?"site":this.resources.W.Config.env.isEditorInPreviewMode()?"preview":"editor"},_isBaseUrlSecure:function(){return this._getBaseUrl&&this._getBaseUrl().test(/^https:/)},_isSafeMode:function(){return-1!=this.safeMode.indexOf("tpa")&&"editor"===this.getViewMode()},addDisposeHandler:function(a){return"function"!=typeof a?void LOG.reportError(wixErrors.TPA_EXPECTED_FUNCTION,this._getAppNameForError(),"addDisposeHandler",a):void this.disposeFunctions.push(a)},isInDevMode:function(){var a=this._appData;return this.resources.W.Utils.getQueryParam("appDefinitionId")===a.appDefinitionId},_onAllSkinPartsReady:function(){this.parent(),this._wireStaticOverlayMessageNodeIfItExists(),this._skinParts.iframe.addEvent("load",this._onIframeLoad),this._shouldDisplayPreloader()&&this._overlayWithPreloader()},_shouldDisplayPreloader:function(){return!0},_shouldDisplayUnresponsiveMessage:function(){return!this.resources.W.Config.isCapturing()},_getIsIframeShown:function(){return"iframeShown"===this.getState("iframe")},_onAppAvailableTimeoutExpires:function(){this._unresponsiveCheckTimerId=null,this.isAppAlive()||this.handleUnresponsiveError()},_onIframeLoad:function(){this._skinParts.iframe.src!==this.IFRAME_BLANK_URL&&(this.isAppAlive()||this._scheduleUnresponsiveCheck(),this.fireEvent("iframeLoaded"))},_setIframeToViewSize:function(){if(Browser&&Browser.Platform&&Browser.Platform.ios){var a=this._view,b=this._iframe;a&&b&&!this.isFullWidthContainer&&(b.style.width=a.style.width||a.clientWidth+"px")}},isVisible:function(){return!0},setIFrameSrc:function(a){a?this.isVisible()&&this.replaceIframeSrc(this._iframe,a):this.handleUnresponsiveError()},replaceIframeSrc:function(a,b){var c=a.parentNode,d=document.createComment("iframe placeholder");c.replaceChild(d,a),a.src=b,c.replaceChild(a,d)},setUrl:function(a){this._iframe&&this.replaceIframeSrc(this._iframe,a)},handleUnresponsiveError:function(){this._skinParts.iframe.removeEvent("load",this._onIframeLoad),this.fireEvent("appUnresponsive"),LOG.reportError(wixErrors.APPS_OPEN_TIMEOUT,this._getAppNameForError(),"showAppNotAvailable",this._appData?this._appData.appDefinitionId:"*NOAPPDATA*"),this._shouldDisplayUnresponsiveMessage()&&this._overlayWithUnresponsiveErrorMessage()},_getAppNameForError:function(){var a=this._appData;return a?a.appDefinitionName?a.appDefinitionName.replace(" ","_"):a.appDefinitionId:"*NOAPPDATA*:"+this.getComponentId()},render:function(){var a=this._isBaseUrlSecure(),b=this.resources.W.Config.isFacebookSite();return b&&!a?void this._overlayWithContentUnavailableInFacebookMessage():void this._renderIframe()},isAppAlive:function(){return this._appIsAlive},setAppIsAlive:function(){this._appIsAlive=!0,this.fireEvent("appIsAlive")},getAppDefinitionId:function(){return this._appDefinitionId},getApplicationId:function(){return this._data&&this._data.get("applicationId")},getAppData:function(){return this._appData},_disposeEventHandlers:function(){this.disposeFunctions.forEach(function(a){try{a.call(this)}catch(b){LOG.reportError(wixErrors.TPA_DISPOSE_CALLBACK_EXCEPTION,this._getAppNameForError(),"_disposeEventHandlers",b)}},this),this.disposeFunctions.length=0},dispose:function(){this._disposeEventHandlers(),this.isUnderMobileView()?(this._onDispose(),this.parent()):(this._view.setStyle("display","none"),this._isSelectable=!1,setTimeout(function(){this._baseDispose()}.bind(this),500),this.getComponentInOtherViewingDevices().forEach(function(a){a.dispose()}),this._onDispose())},_onDispose:function(){this.unregisterComponent(),this._disableUnresponsiveCheck()},_changeSize:function(a,b){var c=this.getWidth(),d=this.getHeight(),e=a.x||a.w||a.width,f=a.y||a.h||a.height;e&&e!=c&&this.setWidth(e,!1,!f&&b),f&&f!=d&&this.setHeight(f,!1,b),this._wCheckForSizeChangeAndFireAutoSized(1)},forceRender:function(){if(this._getIsIframeShown()){this._iframe||(this._iframe=this._skinParts.iframe);var a=this._getUrl();this.setIFrameSrc(a)}},_renderIframe:function(){this._iframe?this._updateIframe():this._createIframe(),this._setIframeToViewSize()},_createIframe:function(){this._iframe=this._skinParts.iframe,this._updateIframe()},_updateIframe:function(){this._iframe&&this._setBasicIframeParams()},_setBasicIframeParams:function(){var a=this._getUrl();this._urlEquals(this._iframe.src,a)||this.setIFrameSrc(a)},_urlEquals:function(a,b){if(!a||!b)return!1;var c=["cacheKiller","width","viewMode"],d=this._removeURLParams(a,c),e=this._removeURLParams(b,c);return d===e},_removeURLParams:function(a,b){var c=a.split("?");if(c.length>=2){for(var d=c[1].split(/[&;]/g),e=0;e<b.length;e++)for(var f=encodeURIComponent(b[e])+"=",g=d.length;g-->0;)0===d[g].indexOf(f,0)&&d.splice(g,1);return d.length>0?c[0]+"?"+d.join("&"):c[0]}return a},_getUrl:function(){return this._getIsIframeShown()?this._buildUrl():this.IFRAME_BLANK_URL},getIFrame:function(){return this._iframe},getFriendlyName:function(){return this._appData&&this._appData.appDefinitionName||""},_hideIframe:function(a){a=a||!1;var b=a?"iframeRenderedInvisible":"iframeNotShown";this.setState(b,"iframe")},_showIframe:function(){this.setState("iframeShown","iframe")},_disableUnresponsiveCheck:function(){this._unresponsiveCheckTimerId&&(clearInterval(this._unresponsiveCheckTimerId),this._unresponsiveCheckTimerId=null)},_scheduleUnresponsiveCheck:function(){this._disableUnresponsiveCheck(),this._unresponsiveCheckTimerId=_.delay(this._onAppAvailableTimeoutExpires.bind(this),1e3*this.LOAD_TIMEOUT)},reportBiTpaUpgradePressed:function(a){var b=!W.Config.siteNeverSavedBefore(),c=W.Config.isPremiumUser(),d=b?c?2:1:0;LOG.reportEvent(wixEvents.TPA_UPGRADE_BUTTON_CLICKED,{c1:a.referralAdditionalInfo,g1:a.appDefinitionId,i1:d})}})}),define.component("tpa.common.components.TPAOverlayMessage",function(a){var b=a;b.inherits("mobile.core.components.base.BaseComponent"),b.skinParts({content:{type:"htmlElement"},tooltip:{type:"wysiwyg.common.components.InfoTip"}}),b.resources(["topology","W.Config"]),b.traits(["tpa.common.traits.MayHaveParentEditor"]),b.states({dismissButton:["hasDismissButton","noDismissButton"],icon:["iconOnTop","iconOnLeft","noIcon"],iconMode:["staticIcon","dynamicIcon"],env:["inSite","inPreview","inEditor"],text:["hasText","noText"]}),b.binds(["_dismissClickHandler","_handleSizeChanged","_showToolTip","_hideToolTip","_getAppName","_onParentComponentRendered","_fireFullyLoaded","_onResize"]),b.methods({initialize:function(a,b,c){this.parent(a,b,c),this._textForViewer=c.textForViewer,this._textEntryForEditor=c.textEntryForEditor,this._textModel=c.textModel,this._isFullyLoaded=!1,this._tooltipText=null,this._tooltipEnabled=!1,this._parentComponent=c.parentComponent,this._handleSizeChanged=_.debounce(this._handleSizeChanged,10,{maxWait:100}),$(window).addEvent("scroll",this._handleSizeChanged),$(window).addEvent("resize",this._handleSizeChanged),this._parentComponent.addEvent("resize",this._onResize),this._parentComponent.addEvent("componentMoved",this._handleSizeChanged),this.addEvent("resize",this._handleSizeChanged),this.addEvent("appended",this._onAppended),_.forOwn(c.eventHandlers||{},function(a,b){a=_.isArray(a)?a:[a],a.forEach(function(a){this.addEvent(b,a)}.bind(this))}.bind(this)),this.setState(this._getEnvStateAccordingToEnvFrameName(),"env"),this._setStateFromArgs(c),this._loadStates(b)},_onAppended:function(){var a=this._parentComponent;a.isReady()&&this._onParentComponentRendered(),a.addEvent(Constants.ComponentEvents.RENDER,this._onParentComponentRendered)},_onParentComponentRendered:function(){this.show(),this._handleSizeChanged()},_getEnvStateAccordingToEnvFrameName:function(){var a=this.resources.W.Config.env;switch(a.$frameName){case a.frameNames.EDITOR:return"inEditor";case a.frameNames.PUBLIC:return"inSite";case a.frameNames.PREVIEW:return"inPreview"}},_setStateFromArgs:function(a){var b=this._getStaticIconState(a.iconMode);b?this.setState(b,"icon"):"dynamic"===a.iconMode&&this.setState("dynamicIcon","iconMode"),this.setState(a.hasDismissButton?"hasDismissButton":"noDismissButton","dismissButton")},_loadStates:function(a){var b=a&&a.getProperty("state");if(b){var c=_.reduce(this._states_||{},function(a,b,c){return _(b).forEach(function(b){a[b]=c}),a},{}),d=b.split(/\s+/);d.forEach(function(a){var b=c[a];this.setState(a,b)}.bind(this))}},_onAllSkinPartsReady:function(){this.hide(),Browser.ie8&&this._skinParts.view.addClass("ie8"),"hasDismissButton"===this.getState("dismissButton")&&this._skinParts.dismissButton.addEvent("click",this._dismissClickHandler);var a=this.getState("icon");if(!this._skinParts.icon.src&&"noIcon"!==a){var b=this.resources.topology.tpa+this._getIconUrlRelative();this._skinParts.icon.src=b}},_getStaticIconState:function(a){switch(a){case"onLeft":return"iconOnLeft";case"onTop":return"iconOnTop";case"noIcon":return"noIcon";default:return null}},_getIconUrlRelative:function(){return"/resources/alert-icon.png"},_dismissClickHandler:function(){this.fireEvent("dismissClicked")},_setText:function(a){this._skinParts.text.innerHTML=a,this._tooltipText=a,this.setState(a?"hasText":"noText","text"),this.isReady()?this._fireFullyLoaded():this.addEvent(Constants.ComponentEvents.READY,this._fireFullyLoaded)},_fireFullyLoaded:function(){this._isFullyLoaded||(this._isFullyLoaded=!0,this.fireEvent("fullyLoaded"))},_handleSizeChanged:function(){var a=2,b=this._parentComponent._view.getBoundingClientRect(),c=this._parentComponent.getWidth()-2*a,d=this._parentComponent.getHeight()-2*a,e=document.documentElement.clientHeight,f=Math.max(0,b.top),g=Math.min(e,b.bottom),h=Math.max(0,g-f-2*a),i=this._skinParts.innerContainer.clientHeight,j=i+2*a,k=Math.max(0,c),l=Math.max(0,Math.min(h,d),j),m=0;if(b.top<0&&l>0){var n=d-l;m=Math.min(-b.top,n)}var o=Math.floor(.1*l),p=Math.floor(.1*k),q=k-2*p,r=l-2*o,s=this._skinParts.content;if(s.setStyle("width",q),s.setStyle("height",r),s.setStyle("padding",o+"px "+p+"px"),s.setStyle("top",m),"dynamicIcon"===this.getState("iconMode")){var t=this.getState("icon"),u=k>175?"iconOnLeft":"iconOnTop";t!==u&&this.setState(u,"icon")}this._setTooltipStateAccordingToVisibleSize()},_setTooltipStateAccordingToVisibleSize:function(){var a=this._skinParts.content;a.isVisible()&&(a.clientHeight<a.scrollHeight||a.clientWidth<a.scrollWidth?this._tooltipEnabled||this._enableToolTip():this._tooltipEnabled&&this._disableToolTip())},_setTooltipEvent:function(a,b){var c=this._skinParts.content;c[a]("mouseenter",this._showToolTip),c[a]("mouseleave",this._hideToolTip),this._tooltipEnabled=b},_disableToolTip:function(){this._setTooltipEvent("removeEvent",!1)},_enableToolTip:function(){this._setTooltipEvent("addEvent",!0)},_showToolTip:function(){this._skinParts.tooltip._showToolTipCmd({id:1,content:this._tooltipText},{source:this})},_hideToolTip:function(){this._skinParts.tooltip._closeToolTipCmd()},dispose:function(){$(window).removeEvent("scroll",this._handleSizeChanged),$(window).removeEvent("resize",this._handleSizeChanged),this._parentComponent.removeEvent("resize",this._onResize),this._parentComponent.removeEvent("componentMoved",this._handleSizeChanged),this._parentComponent.removeEvent(Constants.ComponentEvents.RENDER,this._onParentComponentRendered),this.parent()},_getAppName:function(){var a=this._parentComponent.getAppData(),b=a.appDefinitionName;return b?'"'+b+'"':"this App"},_isPublicSite:function(){return this.resources.W.Config.env.$isPublicViewerFrame},_replaceTokens:function(a,b){a=a||"";var c=/\$\{([^}]+)\}/g;return a.replace(c,function(a,c){var d=b[c];return"function"==typeof d&&(d=d()),d})},_translate:function(a,b){return!this._isPublicSite()&&this.isParentEditor()&&window.parent&&window.parent.W&&window.parent.W.Resources?window.parent.W.Resources.get("EDITOR_LANGUAGE",b,a):a},_getTranslatedText:function(a,b,c){var d=this._translate(a,b);return this._replaceTokens(d,c)}})}),define.component("tpa.common.components.TPAPreloaderOverlay",function(a){var b=a;b.inherits("tpa.common.components.TPASimpleOverlayMessage"),b.resources(["W.Config","W.Experiments"]),b.methods({initialize:function(a,b,c){var d=this.resources.W.Config.isCapturing();this.parent(a,b,_.merge(c,{iconMode:d?"noIcon":"onTop",hasDismissButton:!1,textForViewer:null,textEntryForEditor:"TPA_PRELOADER2",textModel:{APP_NAME:this._getAppName}}))},_getIconUrlRelative:function(){return"/resources/Loader_29px.gif"}})}),define.component("tpa.common.components.TPASafeModeOverlay",function(a){var b=a;b.inherits("tpa.common.components.TPASimpleOverlayMessage"),b.resources(["W.Config"]),b.methods({initialize:function(a,b,c){this.parent(a,b,_.merge(c,{iconMode:"noIcon",hasDismissButton:!0,textForViewer:"You are currently on safe mode, for loading the iframe, please press reload.",textEntryForEditor:"TPA_SAFE_MODE"}))}})}),define.component("tpa.common.components.TPASimpleOverlayMessage",function(a){var b=a;b.inherits("tpa.common.components.TPAOverlayMessage"),b.resources(["W.Config"]),b.methods({initialize:function(a,b,c){this.parent(a,b,c)},_getText:function(){return this._getTranslatedText(this._textForViewer,this._textEntryForEditor,this._getTextModel())},_getTextModel:function(){return this._textModel||{}},_onAllSkinPartsReady:function(){this.parent();var a=this._getText();this._setText(a)}})}),define.component("tpa.common.components.TPAUnavailableInFacebookOverlay",function(a){var b=a;b.inherits("tpa.common.components.TPASimpleOverlayMessage"),b.resources(["W.Config"]),b.methods({initialize:function(a,b,c){this.parent(a,b,_.merge(c,{iconMode:this._isPublicSite()?"noIcon":"dynamic",hasDismissButton:!1,textForViewer:"We're sorry, this content cannot be displayed.",textEntryForEditor:"TPA_UNAVAILABLE_IN_FACEBOOK_SITE"}))}})}),define.component("tpa.common.components.TPAUnavailableInMobileOverlay",function(a){var b=a;b.inherits("tpa.common.components.TPASimpleOverlayMessage"),b.resources(["W.Config"]),b.methods({initialize:function(a,b,c){this.parent(a,b,_.merge(c,{iconMode:"noIcon",hasDismissButton:!1,textForViewer:"We are sorry, this content is currently not optimized for mobile view.",textEntryForEditor:"TPA_UNAVAILABLE_IN_MOBILE"}))}})}),define.component("tpa.common.components.TPAUnresponsiveMessage",function(a){function b(a){return a.replace(/[\u00A0-\u99999<>\&]/gim,function(a){return"&#"+a.charCodeAt(0)+";"})}var c=a;c.inherits("tpa.common.components.TPAAsyncOverlayMessage"),c.resources(["W.TPA"]),c.methods({initialize:function(a,b,c){this.parent(a,b,_.merge(c,{hasDismissButton:!this._isPublicSite(),iconMode:this._isPublicSite()?"noIcon":"dynamic"}))},_getText:function(a){return this._isPublicSite()?void a(this.errorMessageConstants.textForViewer):void this._getTextModelForEditorAsync(function(b){var c=this._getTranslatedText(this.errorMessageConstants.textForViewer,"TPA_UNRESPONSIVE",b);a(c)}.bind(this))},_getTextModelForEditorAsync:function(a){var b=this._parentComponent.getAppData();this.resources.W.TPA.getAppMarketData(b.appDefinitionId,function(b){var c=this._getAppName();a({APP_NAME:c,APP_VENDOR:this._getAppVendorForErrorMessage(b,c)})}.bind(this))},_getAppVendorForErrorMessage:function(a,c){var d=a&&a.supportInfo,e=a&&a.by||d&&d.supportMail||"the author of "+c;e=b(e);var f=this._getAppVendorLinkForErrorMessage(d);return f?'<a href="'+f+'">'+e+"</a>":e},_getAppVendorLinkForErrorMessage:function(a){return a?a.supportUrl?a.supportUrl:a.supportMail?"mailto:"+b(a.supportMail):a.supportPhone?"callto:"+b(a.supportPhone):void 0:null}}),c.statics({errorMessageConstants:{textForViewer:"We're sorry, this content cannot be displayed. Please try again later."}})}),define.dataSchema("AccordionProperties",{font:{langsKey:"System.font",type:"string","default":"arial","enum":["arial","arialBlack","comicSansMS","courierNew","georgia","impact","lucidaConsole","lucidaSansConsole","palatinoLinotype","tahoma","timesNewRoman","verdana"]},descFont:{langsKey:"System.font",type:"string","default":"arial","enum":["arial","arialBlack","comicSansMS","courierNew","georgia","impact","lucidaConsole","lucidaSansConsole","palatinoLinotype","tahoma","timesNewRoman","verdana"]},alignText:{type:"string","default":"left","enum":["left","center","right"]},textMode:{langsKey:"System.textMode",type:"string","default":"titleOnly","enum":["titleOnly","noText"]},galleryImageOnClickAction:{langsPrefix:"System",type:"string","default":"zoomMode","enum":["disabled","zoomMode","goToLink"]},borderWidth:{type:"number","default":0,description:"Borer width between images",minimum:0,maximum:30}}),define.dataSchema("CollageProperties",{font:{langsKey:"System.font",type:"string","default":"arial","enum":["arial","arialBlack","comicSansMS","courierNew","georgia","impact","lucidaConsole","lucidaSansConsole","palatinoLinotype","tahoma","timesNewRoman","verdana"]},alignText:{type:"string","default":"center","enum":["left","center","right"]},textMode:{langsKey:"System.textMode",type:"string","default":"titleOnly","enum":["titleAndDescription","titleOnly","noText"]},galleryImageOnClickAction:{langsPrefix:"System",type:"string","default":"zoomMode","enum":["disabled","zoomMode","goToLink"]},minImageSize:{type:"number","default":1,description:"minimum image size",minimum:1,maximum:10},maxImageSize:{type:"number","default":3,description:"maximum image size",minimum:1,maximum:10},avergeImageSize:{type:"number","default":1,description:"averge image size",minimum:1,maximum:10},margin:{type:"number","default":5,description:"Margin around each item",minimum:0,maximum:30},fitToScreenWidth:{type:"boolean","default":!1,description:"fit component width to screen"},showNavButtons:{type:"boolean","default":!0,description:"show navigation buttons"},numOfCells:{type:"number","default":5,description:"number of grid cells",minimum:2,maximum:10},orientation:{langsKey:"System.orientation",type:"string","default":"vertical","enum":["vertical","horizontal"]},layoutSeed:{type:"number","default":50,description:"seed for layout calculation",minimum:1,maximum:100}}),define.dataSchema("FreestyleProperties",{galleryImageOnClickAction:{langsPrefix:"System",type:"string","default":"zoomMode","enum":["disabled","zoomMode","goToLink"]},layoutSeed:{type:"number","default":50,description:"seed for layout calculation",minimum:1,maximum:100},cropAndFitStage:{langsPrefix:"System",type:"string","default":"fit","enum":["crop","fit"]},imageDecoration:{langsPrefix:"System",type:"string","default":"none","enum":["none","polaroid","scotchTape","vintageFrame","random"]},borderWidth:{type:"number","default":3,description:"image border width",minimum:0,maximum:15},orientation:{type:"string","default":"horizontal","enum":["vertical","horizontal"]},applyRotationInLayout:{type:"boolean","default":!0}}),define.dataSchema("HoneycombProperties",{font:{langsKey:"System.font",type:"string","default":"arial","enum":["arial","arialBlack","comicSansMS","courierNew","georgia","impact","lucidaConsole","lucidaSansConsole","palatinoLinotype","tahoma","timesNewRoman","verdana"]},alignText:{type:"string","default":"left","enum":["left","center","right"]},textMode:{langsKey:"System.textMode",type:"string","default":"titleAndDescription","enum":["titleAndDescription","titleOnly","descriptionOnly","noText"]},galleryImageOnClickAction:{langsPrefix:"System",type:"string","default":"zoomMode","enum":["disabled","zoomMode","goToLink"]},margin:{type:"number","default":1,description:"Margin around each item",minimum:0,maximum:100},numOfColumns:{type:"number","default":4,description:"number of columns",minimum:2,maximum:10},numOfHoles:{type:"number","default":0,description:"number of holes in the honeycomb",minimum:2,maximum:8},layoutSeed:{type:"number","default":50,description:"seed for layout calculation",minimum:1,maximum:100},rolloverAnimation:{langsKey:"System.rolloverAnimation",type:"string","default":"colorOnly","enum":["colorOnly","glow","bounce"]},imageShape:{langsKey:"System.imageShape",type:"string","default":"hexagon","enum":["hexagon","square","triangle"]},imageScale:{langsKey:"System.imageScale",type:"string","default":"x1","enum":["x1","x2","x3"]}}),define.dataSchema("ImpressProperties",{font:{langsKey:"System.font",type:"string","default":"arial","enum":["arial","arialBlack","comicSansMS","courierNew","georgia","impact","lucidaConsole","lucidaSansConsole","palatinoLinotype","tahoma","timesNewRoman","verdana"]},textMode:{langsPrefix:"System",type:"string","default":"titleAndDescription","enum":["titleAndDescription","titleOnly","descriptionOnly","noText"]},alignText:{type:"string","default":"left","enum":["left","center","right"]},autoplayInterval:{type:"number","default":"5",minimum:0,maximum:30,description:"Autplay interval"},autoplay:{type:"boolean","default":!1,description:""},showPagination:{type:"boolean","default":!0,description:""},galleryImageOnClickAction:{langsPrefix:"System",type:"string","default":"zoomMode","enum":["disabled","zoomMode","goToLink"]},cropAndFitStage:{langsPrefix:"System",type:"string","default":"crop","enum":["crop","fit"]},transition:{type:"string","default":"random","enum":["none","1","2","3","4","5","random"]}}),define.dataSchema("MasonryProperties",{font:{langsPrefix:"System",type:"string","default":"arial","enum":["arial","arialBlack","comicSansMS","courierNew","georgia","impact","lucidaConsole","lucidaSansConsole","palatinoLinotype","tahoma","timesNewRoman","verdana"]},galleryImageOnClickAction:{langsPrefix:"System",type:"string","default":"zoomMode","enum":["disabled","zoomMode","goToLink"]},numCols:{type:"number","default":3,description:"Number of columns",minimum:1,maximum:10},margin:{type:"number","default":25,description:"Margin around each item",minimum:0,maximum:100},textMode:{langsPrefix:"System",type:"string","default":"titleAndDescription","enum":["titleAndDescription","titleOnly","descriptionOnly","noText"]},alignText:{type:"string","default":"left","enum":["left","center","right"]},boxShadowIsOn:{type:"boolean","default":!0},boxShadow:{type:"string","default":"0 1px 3px 0 rgba(0,0,0,0.33)"}}),define.dataSchema("StripShowcaseProperties",{galleryImageOnClickAction:{langsKey:"System.centerImageClick",type:"string","default":"disabled","enum":["disabled","zoomMode","goToLink"]},cropAndFitStage:{langsPrefix:"System",type:"string","default":"fit","enum":["crop","fit"]},imageScale:{type:"string","default":"4:3","enum":["16:9","4:3","1:1","3:4","9:16"]},imageMargin:{type:"number","default":5,description:"Margin between thumbnails",minimum:0,maximum:100},showThumbnails:{type:"boolean","default":!0},thumbsScale:{type:"string","default":"4:3","enum":["16:9","4:3","1:1","3:4","9:16"]},thumbsMargin:{type:"number","default":5,description:"Margin between thumbnails",minimum:0,maximum:100},autoplay:{type:"boolean","default":!1},autoplayInterval:{type:"number","default":5,minimum:0,maximum:30},arrowMode:{type:"boolean","default":!1}}),define.dataSchema("StripSlideshowProperties",{font:{langsPrefix:"System",type:"string","default":"arial","enum":["arial","arialBlack","comicSansMS","courierNew","georgia","impact","lucidaConsole","lucidaSansConsole","palatinoLinotype","tahoma","timesNewRoman","verdana"]},textMode:{langsPrefix:"System",type:"string","default":"titleAndDescription","enum":["titleAndDescription","titleOnly","descriptionOnly","noText"]},alignText:{type:"string","default":"left","enum":["left","center","right"]},autoplayInterval:{type:"number","default":"5",minimum:0,maximum:30,description:"Autplay interval"},autoplay:{type:"boolean","default":!1,description:""},transDuration:{type:"number",minimum:0,maximum:5,"default":1,description:"Duration of the transition in sec"},transition:{langsPrefix:"System",type:"string","default":"scroll","enum":["none","crossFade","slide","scroll","zoom","random"]}}),define.dataSchema("TPA",{applicationId:{type:"string","default":"",description:"application ID"},appDefinitionId:{type:"string","default":"",description:"application Definition Id"}}),define.dataSchema("CustomProperties",function(){return{properties:"object"}}),define.dataSchema("TPAGluedProperties",{placement:{type:"string","default:":"BOTTOM_RIGHT",description:"widget placement"},verticalMargin:{type:"string","default:":"",description:"widget vertical margin"},horizontalMargin:{type:"string","default:":"",description:"widget horizontal margin"}}),define.dataSchema("TPAWidget",{"extends":"TPA",widgetId:{type:"string","default":"",description:"some amazing description"}}),define.dataSchema("ThumbnailsProperties",{font:{langsPrefix:"System",type:"string","default":"arial","enum":["arial","arialBlack","comicSansMS","courierNew","georgia","impact","lucidaConsole","lucidaSansConsole","palatinoLinotype","tahoma","timesNewRoman","verdana"]},cropAndFitStage:{langsPrefix:"System",type:"string","default":"crop","enum":["crop","fit"]},componentScale:{type:"string","default":"4:3","enum":["16:9","4:3","1:1"]},margin:{type:"number","default":5,description:"Margin around each item",minimum:0,maximum:100},textMode:{langsPrefix:"System",type:"string","default":"titleAndDescription","enum":["titleAndDescription","titleOnly","descriptionOnly","noText"]},arrowMode:{type:"boolean","default":!0},alignText:{type:"string","default":"left","enum":["left","center","right"]},autoplayInterval:{type:"number","default":"5",minimum:0,maximum:30,description:"Autplay interval"},autoplay:{type:"boolean","default":!1,description:""},transDuration:{type:"number",minimum:0,maximum:5,"default":1,description:"Duration of the transition in sec"},transition:{langsPrefix:"System",type:"string","default":"crossFade","enum":["none","crossFade","slide","scroll","zoom","random"]},thumbnailsGravity:{langsKey:"System.gravity",type:"string","default":"bottom","enum":["top","bottom","left","right"]},galleryImageOnClickAction:{langsPrefix:"System",type:"string","default":"disabled","enum":["disabled","zoomMode","goToLink"]}}),define.experiment.Class("core.managers.ConfigurationManager.SessionDataInConfigManager",function(a){var b=a;b.methods({getAppInMyAccountUrl:function(a,b){var c=this.getMetaSiteId();return["//www.wix.com/my-account/site/",c,"/app#/",a,b?"?autoProvision=true":""].join("")}})}),define.experiment.newComponent("tpa.editor.components.dialogs.TPADashboardAppAddSuccessDialog.BusinessAppsInAppMarket",function(a){var b=a;b.inherits("core.components.base.BaseComp"),b.resources(["topology","W.Commands","W.Resources"]),b.binds(["_closeDialog","_onBusinessAppLinkClick"]),b.skinParts({title:{type:"htmlElement"},subtitle:{type:"htmlElement"},image:{type:"htmlElement"},appMarketButton:{type:"wysiwyg.editor.components.WButton",skin:"wysiwyg.editor.skins.buttons.ButtonBaseBlueSkin"}}),b.methods({initialize:function(a,b,c){this.appId=c.appId,this.parent(a,b,c)},_onRender:function(){this._skinParts.title.set("text",this.resources.W.Resources.get("EDITOR_LANGUAGE","BUSINESS_APPS_PROVISION_SUCCESS_TITLE")),this._skinParts.subtitle.set("html",this.resources.W.Resources.get("EDITOR_LANGUAGE","BUSINESS_APPS_PROVISION_SUCCESS_DESC")),this._skinParts.subtitle.getElement("a").addEvent("click",this._onBusinessAppLinkClick),this._skinParts.appMarketButton.addEvent("click",this._closeDialog.bind(this,"back-to-editor-button")),this._skinParts.appMarketButton.setTextContent(this.resources.W.Resources.get("EDITOR_LANGUAGE","BUSINESS_APPS_PROVISION_SUCCESS_BUTTON")),this._setImageUrl()},_onBusinessAppLinkClick:function(){var a=this._generateLinkToBusinessApp();this._closeDialog(),window.open(a,"_blank"),LOG.reportEvent(wixEvents.OPEN_BUSINESS_APP_PAGE,{c1:"text-link",g1:this.appId})},_generateLinkToBusinessApp:function(){var a=this.injects().Config.getAppInMyAccountUrl(this.appId);return a},_setImageUrl:function(){if(this._skinParts.image){var a=this.resources.topology.tpa+this._getRelativeUrl();
this._skinParts.image.setStyle("background","url("+a+") no-repeat left center")}},_getRelativeUrl:function(){return"/resources/business-apps-pop-up-image.png"},_closeDialog:function(a){var b=this.getParentComponent();b&&b.closeDialog(),this.dispose(),a=a||"close-button",LOG.reportEvent(wixEvents.CLOSE_BUSINESS_APP_SUCCESS_DIALOG,{c1:a,g1:this.appId})}})}),define.experiment.Class("tpa.common.managers.TPAManager.TPACacheTest",function(a,b){var c=a,d=b;c.resources(d.merge(["W.Config","scriptLoader"])),c.utilize(d.merge(["tpa.common.managers.UrlBuilderBase"])),c.methods({initialize:d.after(function(){var a=this.resources.W.Config.env;if(a.$isPublicViewerFrame||a.$isEditorViewerFrame){var b=Math.random()<.1;b&&resource.getResourceValue("W.Viewer",function(){W.Viewer.addEvent("SiteReady",function(){_.delay(this._loadCacheTestScript.bind(this),31500)}.bind(this))}.bind(this))}}),_loadCacheTestScript:function(){this.resources.scriptLoader.loadScript({url:"//static.wix.com/nv-services/third-party/tpa/cachetest/cachetest.js"},{onLoad:this._cacheTestScriptOnLoad.bind(this)})},_cacheTestScriptOnLoad:function(){var a=window.W&&window.W.TpaCacheTest;if(a){window.console.log("TPA cacheTestObject: "+JSON.stringify(a));var b=window.siteHeader&&window.siteHeader.userId||"00000000-0000-0000-0000-000000000000",c=(new this.imports.UrlBuilderBase).setBaseUrl("//frog.wix.com/mlt").setParam("src",42).setParam("evid",344).setParam("uid",b).setParam("c1",a.version).setParam("i1",a.timestamp).build();new Image(0,0).src=c}}})}),define.Class("tpa.common.managers.TPAManager",function(a){var b=a;b.inherits("bootstrap.managers.BaseManager"),b.utilize(["core.managers.components.ComponentBuilder"]),b.resources(["scriptLoader","W.Commands","W.CommandsNew","W.Utils","W.Config","W.Data","topology"]),b.binds(["getCompById","_onViewerReady"]),b.traits(["tpa.common.traits.MayHaveParentEditor"]),b.statics({TPA_MESSAGE:"TPA",TPA_MESSAGE2:"TPA2",TPA_RESPONSE:"TPA_RESPONSE",APP_MARKET_MESSAGE:"APP_MARKET",APP_MARKET_URL:"http://market.apps.wix.com",PINGPONG_PREFIX:"pingpong:",MessageTypes:{CHANGE_APP_SIZE:"changeAppSize",RESIZE_WINDOW:"resizeWindow",SET_WINDOW_PLACEMENT:"setWindowPlacement",GET_WINDOW_PLACEMENT:"getWindowPlacement",REFRESH_APP:"refreshApp",APP_IS_ALIVE:"appIsAlive",APP_STATE_CHANGED:"appStateChanged",CLOSE_POPUP:"closePopup",CLOSE_WINDOW:"closeWindow",OPEN_POPUP:"openPopup",OPEN_RELATIVE_POPUP:"openRelativePopup",OPEN_MODAL:"openModal",OPEN_MEDIA_DIALOG:"openMediaDialog",OPEN_BILLING_PAGE:"openBillingPage",GET_SITE_PAGES:"getSitePages",GET_SITE_COLORS:"getSiteColors",GET_USER_SESSION:"getUserSession",NAVIGATE_TO_PAGE:"navigateToPage",POST_MESSAGE:"postMessage",SM_REQUEST_LOGIN:"pingpong:smRequestLogin",SM_CURRENT_MEMBER:"pingpong:smCurrentMember",SITE_INFO:"pingpong:siteInfo",EVENT_LISTENER_ADDED:"pingpong:addEventListener",SM_REQUEST_LOGIN_2:"smRequestLogin",SM_CURRENT_MEMBER_2:"smCurrentMember",SITE_INFO_2:"siteInfo",BOUNDING_RECT_AND_OFFSETS:"boundingRectAndOffsets",SCROLL_TO:"scrollTo",SCROLL_BY:"scrollBy",POST_ACTIVITY:"postActivity",SET_STYLE_PARAM:"setStyleParam",GET_STYLE_PARAMS:"getStyleParams",START_CHECKOUT:"startCheckout",HEIGHT_CHANGED:"heightChanged",APP_SETTINGS_CHANGED:"appSettingsChanged",APP_SETTINGS_CLOSE:"appSettingsClose",APP_SHOW_POPUP:"appShowPopup",REGISTER_EVENT_LISTENER:"registerEventListener",REMOVE_EVENT_LISTENER:"removeEventListener",PUBLISH:"publish",NAVIGATE_TO_SECTION_PAGE:"navigateToSectionPage",GET_CURRENT_PAGE_ID:"getCurrentPageId",GET_DASHBOARD_APP_URL:"getDashboardAppUrl"},WorkerMessageTypes:{SITE_INFO_2:"siteInfo",GET_SITE_PAGES:"getSitePages",EVENT_LISTENER_ADDED:"pingpong:addEventListener",REMOVE_EVENT_LISTENER:"removeEventListener",REGISTER_EVENT_LISTENER:"registerEventListener",SM_CURRENT_MEMBER_2:"smCurrentMember",APP_IS_ALIVE:"appIsAlive",PUBLISH:"publish"}}),b.methods({initialize:function(){this._componentRegistry={};var a=this;this._addPostMessageCallback(function(b){a.handlePostMessage(b,a.getCompById)}),this._testAppsDefIds=this._getTestAppsDefIds(),this.initActivityReporter(),this.PubSubPublishers={},this._registerCommandListeners();var b=this.resources.W.Config.env;(b.$isEditorViewerFrame||b.$isPublicViewerFrame)&&(this.registerLocalEvents(),resource.getResourceValue("W.Viewer",this._onViewerReady)),this._currentPageState=this._getStateFromWindow()},_onViewerReady:function(a){this.resources.W.Utils.hash.addEvent("browserChange",function(){this._onHashChange(a)}.bind(this))},registerTPAPageConfiguration:function(a){var b=a.getPageConfigurationRepository();b.registerConfig("TpaPage",{options:{canBeDuplicated:!1}})},_onHashChange:function(a){var b=this._getStateFromWindow();if(b!==this._currentPageState){this._currentPageState=b;var c=this._getCurrentSection(a);c&&(c._updateIframe(),this.fireEvent("STATE_CHANGED",{newState:b}))}},_getStateFromWindow:function(){var a=this.resources.W.Utils.hash.getHashParts(window.location.hash);return a.extData||""},_getCurrentPageId:function(a,b){return this.resources.W.Utils.hash.getHashObject(b).id||a.getHomePageId()},_getCurrentSection:function(a){if(a){var b=this._getCurrentPageId(a,window.location.hash),c=this.resources.W.Data.getDataByQuery("#"+b);if(c){var d=c.get("tpaApplicationId");if(null!==d&&void 0!==d)return this._getSection(d)}}},_registerCommandListeners:function(){var a=this.resources.W.Commands;this.resources.W.Config.env.$isPublicViewerFrame&&a.registerCommandAndListener("WViewerCommands.Activity.Report",this,this._reportActivityHandler),a.registerCommandAndListener("WViewerCommands.Activity.Register",this,this._registerActivityHandler)},registerLocalEvents:function(){var a=this,b=function(b){a.fireEvent("SCROLL",b)};window.addEventListener?window.addEventListener("scroll",b,!1):window.attachEvent("scroll",b),this.getViewerAsync(function(b){var c=b.getCurrentPageId();b.addEvent("pageTransitionEnded",function(b){b!==c&&(a.fireEvent("PAGE_NAVIGATION",{toPage:b,fromPage:c}),c=b)})})},initActivityReporter:function(){this._activities={};var a=this;this.resource.getResources(["W.Classes"],function(b){a._classManager=b.W.Classes})},getCompById:function(a){if(this.resources.W.Config.env.$isEditorFrame){var b=$(a);return b&&b.$logic}return this.getViewer().getCompLogicById(a)},getViewer:function(){return this.resources.W.Config.env.$isEditorFrame?W.Preview.getPreviewManagers().Viewer:this.injects().Viewer},getViewerAsync:function(a){var b=this;this.resources.W.Config.env.$isEditorFrame?this.resource.getResourceValue("W.Preview",function(c){c.getPreviewManagersAsync(function(c){a.call(b,c.Viewer)})}):resource.getResourceValue("W.Viewer",function(c){a.call(b,c)})},getPartialsTopology:function(){return this.resources.topology.tpa.indexOf("services")>-1?"http://"+window.location.host+"/_partials"+this.resources.topology.tpa.split("/services")[1]:this.resources.topology.tpa},getAppMarketData:function(a,b){var c=this,d=this.getViewer(),e=d.getAppDataHandler().getAppDataByAppDefinitionId(a);e.marketData?b(e.marketData):c.resources.scriptLoader.loadResource({url:c.APP_MARKET_URL+"/api/market/app/"+a,usePlugin:"json"},{onLoad:function(a){c._setAppMarketingData(e,a),b(e.marketData)},onFailed:function(){b(null)}})},_setAppMarketingData:function(a,b){a.marketData=b},_addPostMessageCallback:function(a){this._callbacks=this._callbacks||[],this._callbacks.push(a),window.addEventListener?window.addEventListener("message",a,!1):window.attachEvent&&window.attachEvent("onmessage",a)},handlePostMessage:function(a,b){if("string"==typeof a.data){var c="";try{c=JSON.parse(a.data)}catch(d){return}var e=c.type;c&&c.intent&&(c.intent===this.TPA_MESSAGE&&e?this._handleTPAMessage(c,e,b):c.intent===this.APP_MARKET_MESSAGE?this._delegateAppMarketMessageHandling(a.source,c):c.intent===this.TPA_MESSAGE2&&e&&this._handleTPAMessage2(c,e,b))}},_handleTPAMessage2:function(a,b,c){var d,e=a.compId;if(0===e.indexOf("worker_")){if(d=this._getWorkerById(e),!Object.contains(this.WorkerMessageTypes,b))return void LOG.reportError("Function: "+b+" is not available for App Worker","tpa.viewer.managers.TPA","handlePostMessage2")}else d=c(e);if(d&&Object.contains(this.MessageTypes,b)){var f=this._getHandlerFunctionName(b),g=d[f];g?g.apply(d,[{msgData:a.data,callback:function(c){var f=d.getIFrame();try{f.contentWindow.postMessage(JSON.stringify({intent:this.TPA_RESPONSE,compId:e,callId:a.callId,type:b,res:c,status:!0}),"*")}catch(g){}}.bind(this)}]):LOG.reportError("Handler function not found - "+b,"tpa.viewer.managers.TPA","handlePostMessage2")}else LOG.reportError("Unknown post message type - "+b,"tpa.viewer.managers.TPA","handlePostMessage")},_getWorkerById:function(a){return this.workers&&this.workers[a]},_handleTPAMessage:function(a,b,c){var d=a.compId,e=c(d);if(e)if(Object.contains(this.MessageTypes,b)){var f=this._getHandlerFunctionName(b),g=e[f];g?this._isPingPongMessage(b)?g.call(e,{msgData:a.data,callback:function(a){var c=e.getIFrame();c.contentWindow.postMessage(JSON.stringify({intent:this.TPA_MESSAGE,compId:d,type:b,data:a}),"*")}.bind(this)}):g.call(e,a.data):LOG.reportError("Handler function not found - "+b,"tpa.viewer.managers.TPA","handlePostMessage")}else LOG.reportError("Unknown post message type - "+b,"tpa.viewer.managers.TPA","handlePostMessage")},_delegateAppMarketMessageHandling:function(a,b){this.resources.W.Commands.executeCommand("HandleAppMarketPostMessage",{data:b,source:a},this)},setMarketPanelWindow:function(a){this._marketPanelWindow=a},setMarketPopupWindow:function(a){this._marketPopupWindow=a},_getHandlerFunctionName:function(a){return this._isPingPongMessage(a)&&(a=a.replace(this.PINGPONG_PREFIX,"")),"handle"+a.capitalize()},_isPingPongMessage:function(a){return 0===a.indexOf(this.PINGPONG_PREFIX)},_getTestAppsDefIds:function(){var a=[],b=W.Utils.getQueryParam("appDefinitionId");b&&a.push(b);var c=window.editorModel&&window.editorModel.runningApps||{},d="~";return Object.each(c,function(b,c){if("ON"==b.toUpperCase()){var e=c.lastIndexOf(d),f=e+1;if(c.length>f||e>0){var g=c.substr(f);a.push(g.trim())}}}.bind(this)),a},getTestApps:function(a){a(this._testAppsDefIds)},getAppDefinitionId:function(a){var b=W.Preview.getPreviewManagers().Viewer.getAppDataHandler().getAppData(a);return b.appDefinitionId},getAppData:function(a){return W.Preview.getPreviewManagers().Viewer.getAppDataHandler().getAppData(a)},dispose:function(){for(var a;this._callbacks&&this._callbacks.length;)a=this._callbacks.pop(),window.removeEventListener?window.removeEventListener("message",a):window.detachEvent&&window.detachEvent("onmessage",a);this.parent()},postMessageEvent:function(a,b){var c=b||this._marketPanelWindow;if(c){var d=location.protocol+"//"+location.host,e={eventType:a,origin:d};c.postMessage(JSON.stringify(e),this.APP_MARKET_URL)}},_reportActivityHandler:function(a){var b=this._activities[a.name];b&&this._classManager.getClass(b,function(b){var c=new b(a.fields,a.callbacks,a.type);c.report()})},_registerActivityHandler:function(a){a&&a.name&&a.className&&(this._activities[a.name]=a.className)},getComponentRegistry:function(a){var b=this._componentRegistry[a]=this._componentRegistry[a]||{};return b},_getSection:function(a){var b=this.resources.W.Config.env.$viewingDevice,c=this.getComponentRegistry(a)[b]||{},d=_.values(c);return _.find(d,"isPage")},_getRegisteredComponentsByApplicationId:function(a){return _(this._componentRegistry[a]).values().map(_.values).flatten(!0).value()},refreshAllComponentsByApplicationId:function(a){_.forEach(this._getRegisteredComponentsByApplicationId(a),function(a){a.refreshAppData(),a.forceRender()})},isTPASectionComponent:function(a){return a&&a.isTpa&&a.isPage&&"tpa.viewer.components.TPASection"===a.className}})}),define.Class("tpa.common.managers.UrlBuilder",function(a){var b=a;b.resources(["W.Utils","W.Config","W.Data","W.TPA"]),b.inherits("tpa.common.managers.UrlBuilderBase");var c=0;b.methods({initialize:function(a,b,c){this.parent(),c=c||{},this._wData=c.wData||this.resources.W.Data,this._wConfig=c.wConfig||this.resources.W.Config,this._fragment=c.fragment||window.location.hash,this._href=c.href||window.location.href,this._tpaManager=c.tpaManager||this.resources.W.TPA,this._baseUrl=a,this._component=b,this._viewMode=this._getViewMode(this._wConfig.env)},_getViewMode:function(a){return a.$isPublicViewerFrame?"site":a.isEditorInPreviewMode()?"preview":"editor"},_getAppData:function(){return this._component.getAppData()},addCacheKiller:function(){return this._urlParams.cacheKiller=(new Date).getTime().toString()+c++,this},addInstance:function(){return this._urlParams.instance=this._getAppData().instance,this},addWidth:function(){return this._urlParams.width=this._component.getWidth(),this},addLocale:function(){return this._urlParams.locale=this._wConfig.getLanguage(),this},addViewMode:function(){return this._urlParams.viewMode=this._viewMode,this},addCompId:function(){return this._urlParams.compId=this._component.getComponentId(),this},addDeviceType:function(){return this._urlParams.deviceType=this._wConfig.env.$viewingDevice.toLowerCase(),this},addArbitraryQueryParams:function(a){return a&&_.assign(this._urlParams,a),this},addStateToPath:function(){var a=this._tpaManager._currentPageState;if(a){var b=this._splitUrlToParts(this._baseUrl);"/"!==b.protocolHostAndPath.slice(-1)&&(b.protocolHostAndPath+="/"),b.protocolHostAndPath+=a,this._baseUrl=this._joinUrlParts(b)}return this},addEndpointType:function(a){return this._urlParams.endpointType=a,this}})}),define.Class("tpa.common.managers.UrlBuilderBase",function(a){var b=a;b.methods({initialize:function(){this._urlParams={},this._fragment="",this._outputFragment=""},_convertUrlParamToNameValuePairs:function(a,b){a="function"==typeof a?a():a;var c=_.isArray(a)?a:[a];return _.map(c,function(a){return{name:b,value:a}})},_convertNameValuePairToQueryParam:function(a){var b=""+a.name,c=a.value;return void 0!==c&&null!==c&&(b+="="+encodeURIComponent(c)),b},_createQueryString:function(a){return _(a).map(this._convertUrlParamToNameValuePairs).flatten().map(this._convertNameValuePairToQueryParam).join("&")},_concatQueryStrings:function(a,b){return _([a,b]).filter().value().join("&")},_splitUrlToParts:function(a){var b=a.split("#"),c=b[0],d=b[1],e=c.split("?"),f=e[0],g=e[1];return{protocolHostAndPath:f,query:g,fragment:d}},_joinUrlParts:function(a){var b=a.protocolHostAndPath;return a.query&&(b+="?"+a.query),a.fragment&&("#"!==a.fragment[0]&&(b+="#"),b+=a.fragment),b},addParam:function(a,b){if(this._urlParams.hasOwnProperty(a)){var c=this._urlParams[a];return _.isArray(b)||(c=this._urlParams[a]=[b]),c.push(b),this}return this.setParam(a,b)},setParam:function(a,b){return this._urlParams[a]=b,this},setBaseUrl:function(a){return this._baseUrl=a,this},_build:function(a,b,c,d){d=d||"/";var e=this._splitUrlToParts(a),f=this._createQueryString(b);return e.query=this._concatQueryStrings(e.query,f),c&&(e.fragment?(e.fragment+=d,"#"===c[0]&&(c=c.slice(1))):e.fragment="",e.fragment+=c),this._joinUrlParts(e)},build:function(){return this._build(this._baseUrl,this._urlParams,this._outputFragment)}})}),define.Class.overrideName.multi({"wysiwyg.viewer.skins.TPASectionSkin":"tpa.viewer.skins.TPASectionSkin","wysiwyg.viewer.skins.TPAPlaceholderSkin":"tpa.viewer.skins.TPAPlaceholderSkin","wysiwyg.viewer.skins.TPAWidgetSkin":"tpa.viewer.skins.TPAWidgetSkin"}),define.Class("tpa.common.services.AppExtensionsService",function(a){var b=a;b.methods({hasExtensions:function(a){a=a||{};var b=a.widgets,c=_.filter(b,function(a){return _.isNull(a.appPage)||_.isUndefined(a.appPage)}),d=c.length>1,e=c.length>0&&this._hasSection(a);return d||e},_hasSection:function(a){return!_.isNull(a.sectionUrl)&&!_.isUndefined(a.sectionUrl)}})}),define.Class("tpa.common.services.PageToWidgetService",function(a){var b=a;b.methods({initialize:function(a){this.parent(),this.tpaToPageMap={},this._wData=a},mapPageToWidgets:function(){if(_.size(this.tpaToPageMap)>0)return this.tpaToPageMap;var a=this;return this._getPages(function(b){_.each(b,function(b){var c=a._wData.dataMap[b.id];if(c&&c._data&&c._data.tpaApplicationId>0){var d={pageId:b.id,tpaId:c._data.tpaApplicationId,tpaPageId:c._data.tpaPageId};_.isUndefined(a.tpaToPageMap[d.tpaId])&&(a.tpaToPageMap[d.tpaId]=[]),a.tpaToPageMap[d.tpaId].push(d)}})}),this.tpaToPageMap},_getPages:function(a){var b=[];this._wData.getDataByQuery("#MAIN_MENU",function(c){var d=c.getItems();_.each(d,function(a){var c={};c.id=a.get("refId").replace(/^#/,""),b.push(c)}),a(b)})}})}),define.Class("tpa.common.services.TPASectionService",function(a){var b=a;b.methods({initialize:function(a,b,c,d){this.parent(),this._data=a,this._dataSchemaType=b,this._isMobile=c,this._isInDevMode=d},getSectionUrl:function(a){if(this._isMobile)return this._getSectionUrlUnderMobile();var b=this._data.sectionUrl;if("TPA"===this._dataSchemaType)return b;if("TPAWidget"===this._dataSchemaType&&a){var c=_.find(this._data.widgets,function(b){return b.widgetId===a});c&&(b=c.widgetUrl)}return b},_getSectionUrlUnderMobile:function(){var a=this._data.sectionMobileUrl&&(this._isInDevMode||this._data.sectionMobilePublished);return a?this._data.sectionMobileUrl:this._data.sectionUrl}})}),function(){var a="cssStr",b=[{id:"bgcolor",type:a,defaultValue:"rgba(255,255,255,0.9)"},{id:"txtcolor",type:a,defaultValue:"#373737"},{id:"fnt",type:a,defaultValue:'font-family: "Helvetica Neue","HelveticaNeueW01-55Roma","HelveticaNeueW02-55Roma","HelveticaNeueW10-55Roma", Helvetica, Arial,sans-serif; font-size:14px;'},{id:"border",type:a,defaultValue:"border: 2px solid rgba(255,255,255,0.9); border-radius: 2px; box-sizing: border-box;"}],c='<div skinPart="tooltip" skin="wysiwyg.viewer.skins.option.InfoTipSkin"></div><div skinPart="content" class="fullheight"><div class="table fullheight"><div class="cell"><div skinpart="innerContainer" class="table"><div class="cell ttalign iconContainer"><img skinpart="icon" alt=""/></div><div class="cell" skinpart="textContainer"><span skinpart="text"></span><span skinpart="dismissButton"> <a>Dismiss</a></span></div></div></div></div></div>',d=["{ position: absolute; top: 0; left: 0; width:100%; height:100%; display: block; overflow: hidden; background-color: [bgcolor]; color: [txtcolor]; [border] }",'.ie8 { background: transparent; -ms-filter: "progid:DXImageTransform.Microsoft.gradient(startColorstr=#E5FFFFFF,endColorstr=#E5FFFFFF)"; zoom: 1 }','[state~="inEditor"] { border-style: none none none none }',"%content% { text-align: center; overflow: hidden; position: absolute; }","%.fullheight% { height: 100%; width: 100%; }","%.table% { display: table; }","%.cell% { display: table-cell; vertical-align: middle; }","%.ttalign% { vertical-align: text-top; }","%textContainer% { [fnt]; word-break: break-word; }","%textContainer% a { color: #0099ff; text-decoration: underline; }",'[state~="noText"] %textContainer% { display: none; }','[state~="iconOnTop"] %innerContainer% { display: block; }','[state~="iconOnTop"] %.iconContainer% { display: block; padding: 0px 0px 15px 0; }','[state~="iconOnTop"] %textContainer% { text-align: center; display: block; }','[state~="iconOnLeft"] %.iconContainer% { padding: 5px 15px 0 0; }','[state~="iconOnLeft"] %textContainer% { text-align: left; }','[state~="noIcon"] %.iconContainer% { display: none; }','[state~="noDismissButton"] %dismissButton% { display: none; }','[state~="noText"] %.iconContainer% { padding: 0 0; }'];define.skin("tpa.common.skins.TPAOverlayMessageSkin",function(e){e.inherits("mobile.core.skins.BaseSkin"),e.skinParams(b.concat([{id:"iconSize",type:a,defaultValue:"width: 40px; height: 40px;"}])),e.html(c),e.css(d)}),define.skin("tpa.common.skins.TPAPreloaderSkin",function(e){e.inherits("mobile.core.skins.BaseSkin"),e.skinParams(b.concat([{id:"iconSize",type:a,defaultValue:"width: 50px; height: 50px;"}])),e.html(c),e.css(d)})}(),define.Class("tpa.common.traits.HasOverlay",function(a){var b=a;b.methods({initialize:function(){this._validateResourcesExist("W.Components"),this._requestedOverlayQueue=[]},_validateResourcesExist:function(){var a=_.filter(arguments,function(a){for(var b,c=this.resources,d=a.split(".");c&&(b=d.shift());)c=c[b];return!c},this);if(a.length)throw new Error("Class "+this.$className+" must have the following resources: "+a)},_createOverlayMessageComponent:function(a,b){b=b||{};var c=b.skinName||"tpa.common.skins.TPAOverlayMessageSkin",d=b.args||{},e=this,f=new Element("div");f.setProperty("skinpart","overlayMessage"),this._requestedOverlayQueue.push(f);var g=function(){var a;do a=e._requestedOverlayQueue.shift();while(a&&a!==f);return f.cancelOverlay?void this.dispose():(e._removeExistingOverlay(),e._skinParts.overlayMessage=this,e._overlayOnTop=b.overlayOn||e._view,e._overlayOnTop.appendChild(this._view),void this.fireEvent("appended"))};return b.eventHandlers=b.eventHandlers||{},d=_.merge(d,{parentComponent:this,eventHandlers:_.merge(b.eventHandlers,{fullyLoaded:_.filter([g].concat(b.eventHandlers.fullyLoaded))})}),this.resources.W.Components.createComponent({compNode:f,type:a,skin:c,args:d}),f},_cancelOverlayMessageInQueue:function(a){a&&(a.cancelOverlay=!0)},_removeExistingOverlay:function(){var a=this._skinParts.overlayMessage;if(!a)return!1;var b=a._view;return this._overlayOnTop?this._overlayOnTop.removeChild(b):this._view.removeChild(b),this._skinParts.overlayMessage=null,b.$logic.dispose(),!0},_removeOverlayMessage:function(a){var b=this._removeExistingOverlay();b||this._cancelOverlayMessageInQueue(a)}})}),define.Class("tpa.common.traits.HasOverlayMessages",function(a){var b=a;b.inherits("tpa.common.traits.HasOverlay"),b.binds(["_onSafeModeOverlayMessageDismissClicked","_onIframeLoadedAfterSafeMode"]),b.resources(["W.Config"]),b.methods({initialize:function(){this._callFunction("tpa.common.traits.HasOverlay","initialize"),this._validateMethodsExist("_hideIframe","_showIframe","_disableUnresponsiveCheck"),(this.resources.W.Config.isCapturing()||this.resources.W.Config.isLoadedFromStatic())&&(this._addPreconditionForDomCaptureReady("componentReady"),this.addEvent(Constants.ComponentEvents.READY,function(){this._setPrecoditionForDomCaptureReady("componentReady")}),this.resources.W.Config.isLoadedFromStatic()&&(this._addPreconditionForDomCaptureReady("iframeLoaded"),this.addEvent("iframeLoaded",function(){this._setPrecoditionForDomCaptureReady("iframeLoaded")})))},getViewMode:_.memoize(function(){var a=this.resources.W.Config.env;return a.$isPublicViewerFrame?"site":a.$isEditorViewerFrame?"preview":"editor"}),isDomDisplayReadyOnReady:function(){return!1},_callFunction:function(a,b){var c=_.toArray(arguments).slice(2);W.Classes.getClass(a,function(a){a.prototype[b].apply(this,c)}.bind(this))},_validateMethodsExist:function(){var a=_.filter(arguments,function(a){return"function"!=typeof this[a]},this);if(a.length)throw new Error("Class "+this.$className+" must implement the following methods: "+a)},_overlayWithPreloader:function(){var a=this.resources.W.Config.isCapturing(),b={};a&&(this._addPreconditionForDomCaptureReady("overlayFullyLoaded"),b.eventHandlers={fullyLoaded:function(){this._setPrecoditionForDomCaptureReady("overlayFullyLoaded")}.bind(this)});var c=this._createOverlayMessageComponent("tpa.common.components.TPAPreloaderOverlay",b),d=function(){this.removeEvent("iframeLoaded",d),this._removeOverlayMessage(c)}.bind(this);this.addEvent("iframeLoaded",d),a&&(this._hideIframe(),this._disableUnresponsiveCheck())},_overlayWithContentUnavailableInFacebookMessage:function(){this._disableUnresponsiveCheck(),this._createOverlayMessageComponent("tpa.common.components.TPAUnavailableInFacebookOverlay"),this._hideIframe()},_overlayWithSafeMode:function(){var a=this._createOverlayMessageComponent("tpa.common.components.TPASafeModeOverlay",{eventHandlers:{dismissClicked:this._onSafeModeOverlayMessageDismissClicked}});this.addEvent("iframeLoaded",function(){this._onIframeLoadedAfterSafeMode(a)})},_overlayWithUnresponsiveErrorMessage:function(){var a=this,b=this._createOverlayMessageComponent("tpa.common.components.TPAUnresponsiveMessage",{eventHandlers:{dismissClicked:function(){a._removeOverlayMessage(b)},fullyLoaded:function(){a._hideIframe(!0)}}})},_overlayWithUnavailableInMobile:function(){this._createOverlayMessageComponent("tpa.common.components.TPAUnavailableInMobileOverlay"),this._hideIframe()},_onSafeModeOverlayMessageDismissClicked:function(){this.forceRender()},_onIframeLoadedAfterSafeMode:function(a){this._removeOverlayMessage(a),this.EDITOR_META_DATA.custom.splice(-1,1)},_onOverlayMessageDismissClicked:function(){this._removeOverlayMessage(),this._showIframe()},_wireStaticOverlayMessageNodeIfItExists:function(){var a=this._view.querySelector('[skinpart="overlayMessage"]');if(a){var b=a.$logic;b?this._skinParts.overlayMessage=b:(a.addEvent(Constants.ComponentEvents.WIXIFIED,function(a){this._skinParts.overlayMessage=a,a.fireEvent("appended")}.bind(this)),a.wixify({parentComponent:this}))}}})}),define.Class("tpa.common.traits.MayHaveParentEditor",function(a){var b=a;b.methods({isParentEditor:function(){try{return window.parent!==window&&window.parent.W}catch(a){return!1}}})}),define.Class("tpa.common.traits.TPAComponentRegistryAccessor",function(a){var b=a;b.resources(["W.TPA"]),b.methods({initialize:function(){this._appReg=null,this._deviceReg=null},_verifyInitialized:function(){var a=this.getComponentId&&this.getComponentId();if(!a)throw new Error('getComponentId() for component "'+this+'" does not exist or returned a falsey value');var b=this.getViewingDevice&&this.getViewingDevice();if(!b)throw new Error('getViewingDevice() for component "'+a+'" does not exist or returned a falsey value');var c=this.getApplicationId&&this.getApplicationId();if(!c)throw new Error('getApplicationId() for component "'+a+'" does not exist or returned a falsey value');this._appReg=this._appReg||this.resources.W.TPA.getComponentRegistry(c),this._deviceReg=this._deviceReg||(this._appReg[b]=this._appReg[b]||{})},_verifyRegistered:function(){this._verifyInitialized();var a=this.getComponentId();if(!this._deviceReg[a])throw new Error('component "'+a+'" is not registered')},registerComponent:function(){this._verifyInitialized(),this._deviceReg[this.getComponentId()]=this},unregisterComponent:function(){this._deviceReg&&(delete this._deviceReg[this.getComponentId()],this._deviceReg=null,this._appReg=null)},getComponentInOtherViewingDevices:function(){this._verifyRegistered();var a=this.getViewingDevice(),b=this.getComponentId();return _(this._appReg).keys().without(a).map(function(a){return a[b]}).filter().value()},getRelatedComponentsInViewingDevice:function(a){if(this._verifyRegistered(),a){var b=this._deviceReg;return _(a).map(function(a){return b[a]}).filter().value()}return _(this._deviceReg).values().value()}})}),define.Class("tpa.common.traits.TPAHandlersBase",function(a){var b=a;b.resources(["W.Config","W.Commands","W.Utils","W.Data","W.Theme","W.Css"]),b.utilize(["core.utils.css.Font"]),b.methods({_appIsAlive:!1,initialize:function(){return this._changeSize?(this._isAliveTime=0,void(this._isAliveCounter=0)):new Error("Must... Implement... _changeSize...")},getViewer:function(){return this.resources.W.Config.env.$isEditorFrame?W.Preview.getPreviewManagers().Viewer:this.injects().Viewer},handleAppIsAlive:function(a){this.setAppIsAlive(),this._isAliveTime=new Date,this._isAliveCounter++,a&&(a.version?this.version=a.version||"unknown":(this.version=a.msgData&&a.msgData.version||"unknown",a.callback&&this._initStylesHandling(a.callback)))},_colorParamKeyPrefix:"param_color_",_numberParamKeyPrefix:"param_number_",_booleanParamKeyPrefix:"param_boolean_",_fontParamKeyPrefix:"param_font_",_initStylesHandling:function(){throw new Error("_initStylesHandling: Not Implemented!")},updateAfterStyleChange:function(){var a=this;clearTimeout(this._timeoutForStyleChange),this._timeoutForStyleChange=setTimeout(function(){a.onThemeChange(a._getDataToPassIntoApp())},10)},_getColorParamFromStyle:function(a,b,c){var d,e=b[a];if(!c&&e&&0===e.indexOf("color_")){var f=this._getSiteThemeManager().getProperty(e);return d=b.hasOwnProperty("alpha-"+a)&&1!==b["alpha-"+a]?"rgba("+(f&&f.getRgb&&f.getRgb())+","+b["alpha-"+a]+")":f&&f.getHex&&f.getHex(),{themeName:e,value:d}}return c?{themeName:void 0,value:void 0}:{themeName:void 0,value:e}},_getSiteColors:function(){var a=this._getSiteThemeManager(),b=a.getProperties(),c=[];if(b){var d=[];Object.each(b,function(b,c){if(0===c.indexOf("color")){var e={},f=a.getProperty(c);e.name=c,e.value=f.getHex(),d.push(e)}});try{c=c.concat(d.slice(1,6)),c=c.concat(d.slice(11,36))}catch(e){}}return c},getAppStyleProperties:function(){var a=this.getOrigComponent?this.getOrigComponent():this,b=a.getStyle();return b?b.getProperties():null},getStylesForSDK:function(){var a={colors:{},numbers:{},booleans:{},fonts:{},googleFontsCssUrl:this.getAllGoogleFontsUrl()},b=this.getAppStyleProperties();if(!b)return a;for(var c in b)this._setValueForStoredParam(c,b,a);return a},_setValueForStoredParam:function(a,b,c){var d=0===a.indexOf("alpha-");if(b.hasOwnProperty(a)&&!d)if(a.match(this._colorParamKeyPrefix))c.colors[a.replace(this._colorParamKeyPrefix,"")]=this._getColorParamFromStyle(a,b,d);else if(a.match(this._numberParamKeyPrefix))c.numbers[a.replace(this._numberParamKeyPrefix,"")]=+b[a];else if(a.match(this._booleanParamKeyPrefix)){var e;e=b[a]instanceof Boolean?b[a]:"false"===b[a]?!1:!0,c.booleans[a.replace(this._booleanParamKeyPrefix,"")]=e}else if(a.match(this._fontParamKeyPrefix)){var f=JSON.parse(b[a]);f.fontStyleParam&&"Custom"===f.preset?this._updateCustomSavedFontValue(f):f.fontStyleParam?this._updatePresetSavedFontValue(f):f.fontParam&&this._updateSavedFontValue(f),c.fonts[a.replace(this._fontParamKeyPrefix,"")]=f}},_updateCustomSavedFontValue:function(a){var b=new this.imports.Font;b.setSize(a.size),b.setLineHeight(a.size+(a.size/4<<0)),b.setStyle(a.style.italic?"italic":"normal"),b.setWeight(a.style.bold?"bold":"normal"),b.setFontFamily(a.family);var c="";c+="font:"+b.getCssValue()+";",c+=a.style.underline?"text-decoration:underline;":"",a.value=c},_updatePresetSavedFontValue:function(a){var b=this._getFontsKeyToNameMap(),c=this.getFontPropertyFromTheme(b[a.preset]);a.value=c.value,a.size=parseInt(c.size,10),a.family=c.fontFamily,a.style.bold="bold"===c.weight,a.style.italic="italic"===c.style,a.style.underline=!1},_updateSavedFontValue:function(a){a.family=a.value,a.value="font-family:"+(a.cssFontFamily||a.value)+";",a.size=0,a.style={bold:!1,italic:!1,underline:!1}},_getSiteThemeManager:function(){return this.resources.W.Config.env.$isEditorFrame?W.Preview.getPreviewManagers().Theme:this.resources.W.Theme},_getDataToPassIntoApp:function(){return{fonts:{cssUrls:W.Css.getWixStoredFontsCssUrls(),imageSpriteUrl:this.resources.W.Theme.getProperty("WEB_THEME_DIRECTORY")+W.Css.getFontsListSpriteUrl(),fontsMeta:W.Css.getCurrentSelectablefonts()},siteTextPresets:this._getSiteTextPresets(),siteColors:this._getSiteColors(),style:this.getStylesForSDK()}},_getFontsKeyToNameMap:function(){return{Title:"font_0",Menu:"font_1","Page-title":"font_2","Heading-XL":"font_3","Heading-L":"font_4","Heading-M":"font_5","Heading-S":"font_6","Body-L":"font_7","Body-M":"font_8","Body-S":"font_9","Body-XS":"font_10"}},getFontPropertyFromTheme:function(a){var b=this._getSiteThemeManager(),c=b.getProperty(a);return{editorKey:a,lineHeight:c.getLineHeight(),style:c.getStyle(),weight:c.getWeight(),size:c.getSize(),fontFamily:c.getFontFamily().toLowerCase(),value:"font:"+c.getCssValue()+";"}},_getSiteTextPresets:function(){var a=this._getFontsKeyToNameMap(),b={};return _.each(a,function(a,c){b[c]=this.getFontPropertyFromTheme(a)},this),b},getGoogleFontsCssUrl:function(a){var b={};_.each(a,function(a){"string"==typeof a&&(a=JSON.parse(a)),b[a.family||a.fontFamily]=1});var c=W.Css.getFontsUrl(b);return c.contains("family=null")?"":c},getAllGoogleFontsUrl:function(){return this.getGoogleFontsCssUrl(_.extend(this._getStylesFonts(),this._getSiteTextPresets()))},_getStylesFonts:function(){var a={},b=this.getAppStyleProperties();
return _.each(b,function(b,c){c.match(this._fontParamKeyPrefix)&&(a[c.replace(this._fontParamKeyPrefix,"")]=b)},this),a}})}),define.Class("tpa.common.traits.TPAHandlersCommons",function(a){var b=a;b.resources(["W.Config","W.Data"]),b.methods({handleSiteInfo:function(a){var b=this._getSiteSEOParams();b.pageTitle=this._getCurrentPageName(),b.referer=document.referrer,b.url=location.href,b.baseUrl=this._getSiteBaseUrl(),a.callback(b)},_getSiteSEOParams:function(){var a=this.resources.W.Config.env;return a.$isPublicViewerFrame?this._getSiteSEOParamsInViewMode():a.$isEditorViewerFrame?this._getSiteSEOParamsInPreviewMode():a.$isEditorFrame?this._getSiteSEOParamsInEditMode():{}},_getSiteSEOParamsInViewMode:function(){var a=$$("title");return a=a&&a[0]&&a[0].text,{siteTitle:a||"",siteDescription:this._getMetadataParameter("description")||"",siteKeywords:this._getMetadataParameter("keywords")||""}},_getSiteSEOParamsInPreviewMode:function(){return this._getSiteSEOParamsFromWData(window.parent.W.Data)},_getSiteSEOParamsInEditMode:function(){return this._getSiteSEOParamsFromWData(this.resources.W.Data)},_getCurrentPageName:function(){var a=null;try{var b=this.getViewer().getCurrentPageNode().getLogic().getDataItem();a=b.getData()}catch(c){return""}return a&&a.title||""},_getSiteBaseUrl:function(){var a=this.resources.W.Config.env;if(a.$isPublicViewerFrame)return location.protocol+"//"+location.host+location.pathname;try{if(window.parent.W.Config.siteNeverSavedBefore())return"";var b=a.$isEditorFrame?this.resources.W.Config:window.parent.W.Config;return b.getUserPublicUrl()||""}catch(c){return""}},_getMetadataParameter:function(a,b){var c=$$("meta["+(b||"name")+"='"+a+"']"),d="";if(c&&c.length>0){var e=c.get("content");e.length>0&&(d=e[0])}return d},_getSiteSEOParamsFromWData:function(a){var b=a.getDataByQuery("#SITE_SETTINGS"),c=(b?b.getData():null)||{};return{siteTitle:c.siteTitleSEO||"",siteDescription:c.siteDescriptionSEO||"",siteKeywords:c.keywordsSEO||""}},_getSitePages:function(a,b){for(var c=[],d=0,e=b.length;e>d;d++){for(var f=this._getPageInfo(a,b[d]),g=b[d].get("items"),h=0,i=g.length;i>h;h++){var j=this._getPageInfo(a,g[h]);f.subPages=f.subPages||[],f.subPages.push(j)}c.push(f)}return c},_getPageInfo:function(a,b){var c={},d=b.get("refId"),e=a.getDataByQuery(d);return c.title=e.get("title")||"",c.id=0===d.indexOf("#")?d.substr(1):d,c.hide=e.get("hidePage")||!1,c}})});