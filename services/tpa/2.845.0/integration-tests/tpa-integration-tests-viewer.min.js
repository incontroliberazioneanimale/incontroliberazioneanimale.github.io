window.TPASpecs=window.TPASpecs||{},window.TPASpecs.runActivitiesTest=function(a){describe("Test Wix Activities",function(){var b=15e3;promiseIt("should report tpa contact form activity failure",function(){return a.driver.exec(function(a){Wix.Activities.postActivity({},a,a)}).then(function(a){expect(a).toBeDefined(),expect(a.status).toBe(400),expect(a.statusText).toBe("Bad Request")})},b),promiseIt("should report tpa contact form activity success",function(){return a.driver.exec(function(a){Wix.Activities.postActivity({type:Wix.Activities.Type.CONTACT_CONTACT_FORM,info:{fields:[{name:"email",value:"tester@wix.com"},{name:"message",value:"trying to see if contact form activity works"},{name:"name",value:"tester"},{name:"subject",value:"automation test"}]},details:{additionalInfoUrl:null,summary:"testing tpa contact form"},contactUpdate:{}},a,a)}).then(function(b){expect(b).toBeDefined(),expect(b.activityId).toBeDefined();var c=a.driver.comp.getAppData(),d="http://gilo6.wix.com/_api/app-integration-bus-web/v1/activities/"+b.activityId;d+="?application-id="+c.appDefinitionId+"&timestamp="+(new Date).toISOString()+"&signature="+c.instance.split(".")[0]+"&instance-id="+JSON.parse(atob(c.instance.split(".")[1])).instanceId+"&version=1.0.0&hs="+W.Config.getHS();var e=Q.defer();return setTimeout(function(){a.driver.scriptLoader.getUrl(d,function(a,b){e.resolve(b)},function(a,b){e.reject(b)},"json")},2500),e.promise}).then(function(a){expect(a).toBeTruthy(),expect(a.id).toBe(a.id),expect(a.activityType).toBe("contact/contact-form")})},b),promiseIt("should report wix component contact form activity success",function(){function b(){var a=Q.defer();return W.Commands.executeCommand("WViewerCommands.Activity.Report",{name:"ContactForm",fields:{email:"tester@wix.com",message:"trying to see if contact form activity works",name:"tester",subject:"automation test"},callbacks:{onSuccess:function(b){a.resolve(b)},onError:function(b){a.reject(b)}}}),a.promise}return b().then(function(b){expect(b).toBeDefined(),expect(b.activityId).toBeDefined();var c=a.driver.comp.getAppData(),d="http://gilo6.wix.com/_api/app-integration-bus-web/v1/activities/"+b.activityId;d+="?application-id="+c.appDefinitionId+"&timestamp="+(new Date).toISOString()+"&signature="+c.instance.split(".")[0]+"&instance-id="+JSON.parse(atob(c.instance.split(".")[1])).instanceId+"&version=1.0.0&hs="+W.Config.getHS();var e=Q.defer();return setTimeout(function(){a.driver.scriptLoader.getUrl(d,function(a,b){e.resolve(b)},function(a,b){e.reject(b)},"json")},2500),e.promise}).then(function(a){expect(a).toBeDefined(),expect(a.id).toBe(a.id),expect(a.activityType).toBe("contact/contact-form")})},b)})};var TPASpecs=TPASpecs||{};TPASpecs.runWixWorkerTests=function(a){describe("Test Wix.Worker namespace methods",function(){var b=new AsyncSpec(this);beforeEach(function(){waitsFor(function(){return!!a.driver},1e4)}),b.it("Wix.Worker.getSitePages",function(b){var c=a.driver.tpaDriver.getSitePages();a.driver.exec(function(a){Wix.Worker.getSitePages(function(b){a(b)})}).then(function(a){var d=_.pluck(a,"id"),e=_.intersection(d,c.pagesKeys);expect(e.length).toBeEquivalentTo(c.pagesKeys.length),b()})});var c={},d={};b.it("Wix.Worker.getSiteInfo",function(b){var e=a.driver.tpaDriver.getPreviewDocument().referrer,f=a.driver.tpaDriver.getPreviewDocument().location.href;d=a.getSiteInfo||{baseUrl:"",pageTitle:"Home",referer:e,siteDescription:"",siteKeywords:"",siteTitle:"",url:f};var g=a.override&&a.override.getSiteInfo;if(g)for(var h in g)g.hasOwnProperty(h)&&(d[h]=g[h]);a.driver.exec(function(a){Wix.Worker.getSiteInfo(function(b){a(b)})}).then(function(a){c=a,expect(c).toBeDefined()}).fin(b)}),b.xit("Wix.Worker.currentMember",function(){}),b.xit("Wix.Worker.addEventListener",function(){}),b.xit("Wix.Worker.removeEventListener",function(){})})};var TPASpecs=TPASpecs||{};TPASpecs.runWixWorkerUtilsTests=function(a){describe("Test Wix.Worker.Utils namespace methods",function(){function b(a){var b={},c=["getViewMode","getDeviceType","getLocale","getInstanceId","getIpAndPort","getDemoMode"];c.forEach(function(a){b[a]=Wix.Worker.Utils[a]()}),a(b)}var c,d=new AsyncSpec(this);beforeEach(function(){waitsFor(function(){return!!a.driver},1e4)});var e=[{func:"getViewMode",result:"site"},{func:"getDeviceType",result:"desktop"},{func:"getLocale",result:"en"},{func:"getInstanceId",result:"13186954-3ea0-72f6-201a-0da566c014a1"},{func:"getIpAndPort",result:"91.199.119.254/34247"},{func:"getDemoMode",result:!1}];d.it("gets Wix.Worker.Utils functions return values",function(d){a.driver.exec(b).then(function(b){if(c=b,a.override)for(var f=0;f<e.length;f++)e[f].func in a.override&&(e[f].result=a.override[e[f].func]);d()})}),e.forEach(function(a){d.it("Wix.Worker.Utils."+a.func,function(b){b(expect(c[a.func]).toBe(a.result))})})})};