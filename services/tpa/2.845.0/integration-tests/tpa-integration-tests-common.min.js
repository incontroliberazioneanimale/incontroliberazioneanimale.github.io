function TPADriver(a){function b(a,b){var c=Q.defer(),d=0;return this.comp=a,this.log.logLevel=1,this.tpaDriver=b,this.promise=c.promise,this.events={},this.settings=null,this.eventId=function(){return d++},this.events["AppReady_"+this.id()]={callbackID:"AppReady_"+this.id(),appComp:this,deferred:c},this.tpaDriver.$registerToMessages(this),this.overrideBaseDispose(),this.scriptLoader=b.scriptLoader,this}function c(a,c){b.call(this,a,c.tpaDriver),this.appDriver=c}function d(a,c){b.call(this,a,c.tpaDriver),this.appDriver=c}function e(a,c){b.call(this,a,c.tpaDriver),this.appDriver=c}var f="0.32.0",g={$appDrivers:[],$eventSystemListeners:{},$unRequstedRegisteredApp:{},$registerToMessages:function(a){this.$appDrivers.push(a);var b=a.id();this.$eventSystemListeners[b]=function(b,c){a.handleMessage(b,c)};var c=this.$unRequstedRegisteredApp[b];c&&(delete this.$unRequstedRegisteredApp[b],a.handleMessage(c.event,c.data))},$unRegisterToMessages:function(a){delete this.$eventSystemListeners[a.id()]},init:function(a){return a=a||{},this.log.logLevel=void 0!==a.logLevel?a.logLevel:1,this.log("Init Driver Start"),this.registerEventReceiversSystem(),this.log("Init Driver End"),this.scriptLoader=define._definitions.resource.scriptLoader.value,this},getConsoleUrl:function(){var a=window._versions&&window._versions["sdk-console"]&&window._versions["sdk-console"].rc;return a=a||f,"http://static.wix.com/services/sdk-console/${version}/index.html".replace("${version}",a)},registerEventReceiversSystem:function(){function a(c){var d,e={};if(g!==b)return window.removeEventListener("message",a,!1);try{e=JSON.parse(c.data)}catch(f){b.log("Error: App Message Parse Error",f)}return"number"==typeof e||e instanceof Number?"WTF":(d=b.$eventSystemListeners[e.compId],void(d?d(c,e):e&&e.cmd&&0===e.cmd.indexOf("AppReady")?b.$unRequstedRegisteredApp[e.compId]={event:c,data:e}:b.log("Error: No Handler registered for this event",e)))}var b=this;window.addEventListener("message",a,!1)},getPreviewDocument:function(){if(W.Config.env.$isPublicViewerFrame)return document;var a=document.getElementById("live-preview-iframe");return a.contentWindow.document},getPreviewDocumentPromise:function(){return W.Config.env.$isPublicViewerFrame?Q(document):waitForDomElement("#live-preview-iframe","preview iframe",1e4).then(function(a){return a.contentWindow.document})},addWidgetAppForWidgetAtIndex:function(a,c){var d=this;return this.registerWidgetTestApp(a).then(function(a){return d.addAppToStageForWidgetAtIndex(a,"tpaWidget",c)}).then(function(a){d.log("App added to stage creating WidgetDriver");var c=new b(a,d);return c.promise})},attachViewerWidgetApp:function(a){var c=this,d=this.getPreviewDocument().window.W.Viewer.getCurrentPageNode();return waitForRenderedComponent("wysiwyg.viewer.components.tpapps.TPAWidget","TPA Widget",15e3,d).then(function(d){return c.registerWidgetTestApp(a).then(function(){d._getBaseUrl=function(){return c.getConsoleUrl()};var a=new b(d,c);return a.promise})})},_addApp:function(a,c,d){var e=this;return c(a).then(function(a){return e.addAppToStage(a,d)}).then(function(a){e.log("App added to stage creating WidgetDriver");var c=new b(a,e);return c.promise})},addWidgetApp:function(a){return this._addApp(a,this.registerWidgetTestApp.bind(this),"tpaWidget")},addPageApp:function(a){return this._addApp(a,this.registerPageTestApp.bind(this),"tpaSection")},getLastWidgetIdFromSpecSync:function(a){return Object.keys(a.widgets).pop()},getWidgetIdByIndexFromSpecSync:function(a,b){var c=Object.keys(b.widgets);return c[a]},getRendererModel:function(){return this.getPreviewDocumentPromise().then(function(a){return waitForPromised(function(){return a.window.rendererModel},"previewDocument.window.rendererModel",2e3)})},getClientSpecMap:function(){return this.getRendererModel().then(function(a){return a.clientSpecMap})},registerWidgetTestApp:function(a){return this._registerApp(a,"tpaWidget")},registerPageTestApp:function(a){return this._registerApp(a,"tpaSection")},_registerApp:function(a,b){var c=this;return this.getClientSpecMap().then(function(d){var e=c.isAppRegisteredSync(a,d);if(e)return e;var f=c.getNewIndexPositionInClientSpecMapSync(d);return d[f]="tpaSection"==b?c.createSdkConsoleMapSyncForPage(a,f):c.createSdkConsoleMapSyncForWidget(a,f)})},isAppRegisteredSync:function(a,b){return _.find(b,{appDefinitionName:a})},getNewIndexPositionInClientSpecMapSync:function(a){return Math.max.apply(Math,Object.keys(a).map(Number))+1},_waitForTpaComponentToBeAlive:function(a){if(a.isAppAlive())return Q(a);var b=Q.defer();return a.addEvent("appIsAlive",function(){b.resolve(a)}),a.addEvent("appUnresponsive",function(){b.reject(new Error("App is unresponsive (timeout waiting for init call)"))}),b.promise},addAppToStageForWidgetAtIndex:function(a,b,c){function d(){return"tpaSection"===b?this.getPreviewDocumentPromise().then(function(b){return waitForRenderedComponent("tpa.viewer.components.TPASection","TPA section "+a.appDefinitionName,15e3,b)}):waitForPromised(function(){return W.Editor._editedComponent},"TPA Widget",15e3)}var e="tpaWidget"==b?this.getWidgetIdByIndexFromSpecSync(c,a):null;return W.Commands.executeCommand("WEditorCommands.AddApp",{appDefinitionDataObj:a,type:b,widgetId:e},this),d.call(this).then(this._waitForTpaComponentToBeAlive.bind(this))},addAppToStage:function(a,b){return this.addAppToStageForWidgetAtIndex(a,b,Object.keys(a.widgets).length-1)},getAllTpaWidgets:function(){return Array.prototype.slice.call(this.getPreviewDocument().querySelectorAll('[comp="wysiwyg.viewer.components.tpapps.TPAWidget"]'))},goToPage:function(a){var b=Q.defer(),c=g.getPreviewDocument().window.W.Viewer,d=g.getSitePages().currentPage;c.goToPage(a);var e=function(){c.removeEvent("pageTransitionEnded",e),setTimeout(function(){b.resolve({fromPage:d,toPage:a})},2e3)};return c.addEvent("pageTransitionEnded",e),b.promise},getSitePages:function(){var a=g.getPreviewDocument().window.W.Viewer,b=a.getCurrentPageId(),c=a.getPages(),d=Object.keys(c);return{currentPage:b,pages:c,pagesKeys:d}},createSdkConsoleMapSyncForWidget:function(a,b){var c={"SDK Console":{type:"public",applicationId:b,appDefinitionId:"12eaadbe-4e0e-4077-27b7-f10f2b4b511f",appDefinitionName:"SDK Console",instance:"W0m-nPMVQ72NAp3jk0BYByg9xA-Sjz3VtFbFXueSo0c.eyJpbnN0YW5jZUlkIjoiMTJlYWFkZjAtMWMyYy1iNWZkLWZhYTEtNGMxNGRkYjk0YTdiIiwic2lnbkRhdGUiOiIyMDEzLTA3LTE4VDA5OjA0OjE4LjY5OS0wNTowMCIsInVpZCI6ImY0NDdlZWMxLWMwMTEtNGExNy1iMjM5LTIzZDYwNWM1YWU3YyIsInBlcm1pc3Npb25zIjoiT1dORVIiLCJpcEFuZFBvcnQiOiI5MS4xOTkuMTE5LjI1NC81MjM0NSIsImRlbW9Nb2RlIjpmYWxzZX0",settingsHeight:615,settingsUrl:this.getConsoleUrl(),settingsWidth:700,widgets:{"12eaade9-1ea1-234d-b13f-6e2c29d0082c":{widgetUrl:this.getConsoleUrl(),widgetId:"12eaade9-1ea1-234d-b13f-6e2c29d0082c",refreshOnWidthChange:!0,defaultHeight:600,defaultWidth:980}},appRequirements:{requireSiteMembers:!1}},"Glued SDK Console":{type:"public",applicationId:b,appDefinitionId:"22eaadbe-4e0e-4077-27b7-f10f2b4b511f",appDefinitionName:"Glued SDK Console",instance:"W0m-nPMVQ72NAp3jk0BYByg9xA-Sjz3VtFbFXueSo0c.eyJpbnN0YW5jZUlkIjoiMTJlYWFkZjAtMWMyYy1iNWZkLWZhYTEtNGMxNGRkYjk0YTdiIiwic2lnbkRhdGUiOiIyMDEzLTA3LTE4VDA5OjA0OjE4LjY5OS0wNTowMCIsInVpZCI6ImY0NDdlZWMxLWMwMTEtNGExNy1iMjM5LTIzZDYwNWM1YWU3YyIsInBlcm1pc3Npb25zIjoiT1dORVIiLCJpcEFuZFBvcnQiOiI5MS4xOTkuMTE5LjI1NC81MjM0NSIsImRlbW9Nb2RlIjpmYWxzZX0",settingsHeight:615,settingsUrl:this.getConsoleUrl(),settingsWidth:700,widgets:{"12eaade9-1ea1-234d-b13f-6e2c29d0082c":{widgetUrl:this.getConsoleUrl(),widgetId:"12eaade9-1ea1-234d-b13f-6e2c29d0082c",refreshOnWidthChange:!0,defaultHeight:600,defaultWidth:980,gluedOptions:{horizontalMargin:0,placement:"TOP_RIGHT",verticalMargin:0}}},appRequirements:{requireSiteMembers:!1}},"Multi SDK Console":{type:"public",applicationId:b,appDefinitionId:"133ebdc9-fa7c-08be-0292-1d0c96258fcb",appDefinitionName:"Multi SDK Console",instance:"W0m-nPMVQ72NAp3jk0BYByg9xA-Sjz3VtFbFXueSo0c.eyJpbnN0YW5jZUlkIjoiMTJlYWFkZjAtMWMyYy1iNWZkLWZhYTEtNGMxNGRkYjk0YTdiIiwic2lnbkRhdGUiOiIyMDEzLTA3LTE4VDA5OjA0OjE4LjY5OS0wNTowMCIsInVpZCI6ImY0NDdlZWMxLWMwMTEtNGExNy1iMjM5LTIzZDYwNWM1YWU3YyIsInBlcm1pc3Npb25zIjoiT1dORVIiLCJpcEFuZFBvcnQiOiI5MS4xOTkuMTE5LjI1NC81MjM0NSIsImRlbW9Nb2RlIjpmYWxzZX0",settingsHeight:615,settingsUrl:this.getConsoleUrl(),settingsWidth:700,sectionUrl:this.getConsoleUrl(),widgets:{"133e29e3-626b-c1e4-1e8f-dda1827a7ad2":{widgetUrl:this.getConsoleUrl(),widgetId:"133ebde0-2027-ae26-f417-28a6244b1704",refreshOnWidthChange:!0,defaultHeight:600,defaultWidth:980},"133e29f2-4107-6e2a-9924-bc7506a64d36":{widgetUrl:this.getConsoleUrl(),widgetId:"133ebdf2-796d-ce25-1e8f-dda1827a7ad2",refreshOnWidthChange:!0,defaultHeight:600,defaultWidth:980}},appRequirements:{requireSiteMembers:!1}},"App Worker":{type:"public",applicationId:b,appDefinitionId:"12eaadbe-4e0e-4077-27b7-f10f2b4b511f",appDefinitionName:"App Worker",instance:"W0m-nPMVQ72NAp3jk0BYByg9xA-Sjz3VtFbFXueSo0c.eyJpbnN0YW5jZUlkIjoiMTJlYWFkZjAtMWMyYy1iNWZkLWZhYTEtNGMxNGRkYjk0YTdiIiwic2lnbkRhdGUiOiIyMDEzLTA3LTE4VDA5OjA0OjE4LjY5OS0wNTowMCIsInVpZCI6ImY0NDdlZWMxLWMwMTEtNGExNy1iMjM5LTIzZDYwNWM1YWU3YyIsInBlcm1pc3Npb25zIjoiT1dORVIiLCJpcEFuZFBvcnQiOiI5MS4xOTkuMTE5LjI1NC81MjM0NSIsImRlbW9Nb2RlIjpmYWxzZX0",widgets:{"12eaade9-1ea1-234d-b13f-6e2c29d0082c":{widgetUrl:this.getConsoleUrl(),widgetId:"12eaade9-1ea1-234d-b13f-6e2c29d0082c",refreshOnWidthChange:!0,defaultHeight:600,defaultWidth:980}},appRequirements:{requireSiteMembers:!1},appWorker:{appWorkerUrl:"http://worker.com/analytics"}}};return c[a]},createSdkConsoleMapSyncForPage:function(a,b){var c={"SDK Console":{type:"public",applicationId:b,appDefinitionId:"12eaadbe-4e0e-4077-27b7-f10f2b4b511f",appDefinitionName:"SDK Console",instance:"W0m-nPMVQ72NAp3jk0BYByg9xA-Sjz3VtFbFXueSo0c.eyJpbnN0YW5jZUlkIjoiMTJlYWFkZjAtMWMyYy1iNWZkLWZhYTEtNGMxNGRkYjk0YTdiIiwic2lnbkRhdGUiOiIyMDEzLTA3LTE4VDA5OjA0OjE4LjY5OS0wNTowMCIsInVpZCI6ImY0NDdlZWMxLWMwMTEtNGExNy1iMjM5LTIzZDYwNWM1YWU3YyIsInBlcm1pc3Npb25zIjoiT1dORVIiLCJpcEFuZFBvcnQiOiI5MS4xOTkuMTE5LjI1NC81MjM0NSIsImRlbW9Nb2RlIjpmYWxzZX0",settingsHeight:615,settingsUrl:this.getConsoleUrl(),settingsWidth:700,sectionUrl:this.getConsoleUrl(),widgets:{},appRequirements:{requireSiteMembers:!1}}};return c[a]},openPublishCongratulationsDialog:function(){return W.Commands.executeCommand("WEditorCommands.Publish"),waitForRenderedComponent("wysiwyg.editor.components.dialogs.PublishWebsiteSuccessDialog","publish success dialog",1e4)},saveSite:function(){var a=!W.Config.siteNeverSavedBefore();if(a)return Q();var b="wysiwyg.editor.components.dialogs.SaveDialog";return document.querySelector('[comp="'+b+'"]')||W.Commands.executeCommand("WEditorCommands.Save"),waitForRenderedComponent(b,"save dialog",2510).then(function(a){return a._siteLabel="test-site-"+_.random(999999),a._onSaveClick(),waitForRenderedComponent("wysiwyg.editor.components.dialogs.SaveSuccessDialog","save success dialog",10189).then(function(a){return a._dialogWindow.endDialog(),Q.delay(1200)})})},log:function(){},getMetaSiteId:function(){}};return b.prototype.id=function(){return this.comp.getComponentId()},b.prototype.getBoundingRect=function(){return this.comp._view.getBoundingClientRect()},b.prototype.remove=function(){return this.tpaDriver.$unRegisterToMessages(this),this.comp.dispose()},b.prototype.supportedMessages={AppReady:function(a,b){var c="AppReady_"+b.compId,d=this.events[c];d&&(delete this.events[c],d.hasOwnProperty("error")?(this.log("Error: ready callback for app component is not in the events map",b.compId),d.deferred.reject(new Error("AppReady: "+d.error),d)):(this.log("AppReady",b.compId,c),d.deferred.resolve(this)))},AppReturnValue:function(a,b,c){var d=this.events[b.callbackID];d&&(delete this.events[b.callbackID],d.hasOwnProperty("error")?(this.log("Error: callbackID is not in the events map",b.callbackID),d.deferred.reject(new Error("AppReturnValue: "+d.error),d)):(this.log("AppReturnValue",b.compId,b.callbackID),d.deferred.resolve(c)))}},b.prototype.handleMessage=function(a,b){try{var c=this.getHandler(b.cmd);if(c){var d=b.args||[];d.unshift(a,b),c.apply(this,d)}}catch(e){throw this.log("Error: App Handler Error:",b,e.stack||e.toString()),e}},b.prototype.getHandler=function(a){return this.supportedMessages[a]},b.prototype.openSettings=function(){var a=this;return this.settings?this.settings.promise:(this.log("openSettings: setting as edited component and opening settings dialog"),this.setAsEditedComponent(),W.Commands.executeCommand("WEditorCommands.OpenTPASettingsDialog"),this.waitForSettingsReady(this).then(function(b){a.log("openSettings: setting ready callback");var d=b.$logic;return a.settings=new c(d,a),a.settings.promise}))},b.prototype.openAppExtensions=function(){return W.Commands.executeCommand("WEditorCommands.OpenTPAAppExtensionsDialog",{appData:{appDefinitionId:this.comp._appData.appDefinitionId}}),waitForRenderedComponent("tpa.editor.components.dialogs.TpaAppExtensions",2e3)},b.prototype.openFPP=function(){return W.Commands.executeCommand("EditorUI.OpenFloatingPanel",{x:833,y:513}),waitForRenderedComponent("wysiwyg.editor.components.panels.FloatingPropertyPanel")},b.prototype.deletePage=function(){var a=Q.defer(),b=g.getPreviewDocument().window.W.Viewer,c=b.getPages()[b.getCurrentPageId()];return W.Commands.executeCommand("WEditorCommands.DeletePage",c.getLogic().getDataItem()),setTimeout(function(){a.resolve()},1e3),a.promise},b.prototype.goToPreview=function(){return W.Commands.executeCommand("WEditorCommands.WSetEditMode",{editMode:W.Editor.EDIT_MODE.PREVIEW}),waitForPromised(function(){return W.Config.env.$editorMode===W.Editor.EDIT_MODE.PREVIEW},"switch to preview")},b.prototype.goToEditor=function(){return W.Commands.executeCommand("WEditorCommands.WSetEditMode",{editMode:W.Editor.EDIT_MODE.CURRENT_PAGE}),waitForPromised(function(){return W.Config.env.$editorMode!==W.Editor.EDIT_MODE.PREVIEW},"switch to editor")},b.prototype.closeSettings=function(){this.settings&&(this.settings.comp._dialogWindow.endDialog(),this.settings.tpaDriver.$unRegisterToMessages(this.settings),this.settings=null)},b.prototype.waitForSettingsReady=function(a){var b=a.id();return this.log("waitForSettingsReady"),waitForDomElement('[comp="tpa.editor.components.dialogs.TPASettings"]',"settings panel for compId "+b,16e3,function(a){var c,d;return a.$logic&&(c=a.querySelector("iframe"))&&(d=c.src.match(/origCompId=([^&]+)/))&&d[1]===b})},b.prototype.setAsEditedComponent=function(){W.Editor.setSelectedComp(this.comp,!1,{})},b.prototype.exec=function(a,b){var c=Q.defer();return setTimeout(function(){var b=this.eventId();this.events[b]={callbackID:b,appComp:this.comp,deferred:c,injectedFunction:a};var d=this.comp._view.querySelector("iframe"),e=JSON.stringify({cmd:"exec",compId:this.comp.getComponentId(),inject:a.toString(),callbackID:b},null,2);d.contentWindow.postMessage(e,"*")}.bind(this),b||0),c.promise},b.prototype.log=console.log.bind(console,"TPAWidgetDriver"),b.prototype.setGlobal=function(a,b,c){var d="function(send){ send(window.$varName = $value)}";return d=d.replace("$varName",a),d=d.replace("$value",JSON.stringify(b)),this.exec(d,c)},b.prototype.getGlobal=function(a,b){var c="function(send){ send(window.$varName)}";return c=c.replace("$varName",a),this.exec(c,b)},b.prototype.waitForGlobal=function(a,b){var c="function(send){ send(window.$varName)}";c=c.replace("$varName",a);var d=this;return waitForPromised(function(){return d.exec(c,0)},"waiting for global: "+a,b)},b.prototype.isGlobalExist=function(a,b){var c="function(send){ send(!!window.$varName); }";return c=c.replace("$varName",a),this.exec(c,b)},b.prototype.getGlobalVars=function(a,b){var c="function(send){ send([$vars].map(function(v){return window[v]}))}";return c=c.replace("$vars",a),this.exec(c,b)},b.prototype.getViewNode=function(){return this.comp.getViewNode()},b.prototype.waitForModal=function(){return this.waitForPreviewEl('[comp="tpa.viewer.components.TPAModal"]')},b.prototype.openModal=function(a,b,c,e){var f=this,g=function(a){Wix.openModal($url,$width,$height,$onClose),a()};return g=g.toString().replace("$url","'"+a+"'").replace("$width",b).replace("$height",c).replace("$onClose",e&&e.toString()),this.exec(g).then(this.waitForPreviewEl.bind(this,'[comp="tpa.viewer.components.TPAModal"]')).then(function(a){return f.modal=new d(a.$logic,f),f.modal.promise})},b.prototype.navigateToSection=function(a){var b=Q.defer(),c=g.getPreviewDocument().window.W.Viewer,d=function(a){c.removeEvent("pageTransitionEnded",d),setTimeout(function(){b.resolve(a)},0)};c.addEvent("pageTransitionEnded",d);var e=function(a){Wix.Utils.navigateToSection($onError),a()};return e=e.toString().replace("$onError",a.toString()),this.exec(e)},b.prototype.waitForPreviewEl=function(a){var b=Q.defer(),c=this,d=setInterval(function(){var f=c.tpaDriver.getPreviewDocument().querySelectorAll(a),g=f[f.length-1];g&&(clearTimeout(e),clearInterval(d),b.resolve(g))},200),e=setTimeout(function(){clearInterval(d),b.reject(new Error('Element "'+a+'" cant be opened/found'))},2e3);return b.promise},b.prototype.openPopup=function(a,b,c,d,f){var g=this,h=function(a){Wix.openPopup($url,$width,$height,$position,$onClose),a()};return h=h.toString().replace("$url","'"+a+"'").replace("$width",b).replace("$height",c).replace("$position",JSON.stringify(d)).replace("$onClose",f&&f.toString()),this.exec(h).then(this.waitForPreviewEl.bind(this,'[comp="tpa.viewer.components.TPAPopup"]')).then(function(a){return g.popup=new e(a.$logic,g),g.popup.promise})},b.prototype.sdk_getCompId=function(){return this.exec(function(a){a(Wix.Utils.getCompId())})},b.prototype.navigateToPage=function(a){var b=Q.defer(),c=g.getPreviewDocument().window.W.Viewer,d=function(a){c.removeEvent("pageTransitionEnded",d),setTimeout(function(){b.resolve(a)},0)};c.addEvent("pageTransitionEnded",d);var e=function(a){Wix.navigateToPage("$pageId"),a()},f=e.toString().replace("$pageId",a);return this.exec(f),b.promise},b.prototype.getCurrentPageTitle=function(){return this.exec(function(a){Wix.getSiteInfo(function(b){a(b.pageTitle)})})},b.prototype.getCurrentPageUrl=function(){return this.exec(function(a){Wix.getSiteInfo(function(b){a(b.url)})})},b.prototype.overrideBaseDispose=function(){var a=this.comp._baseDispose,b=this;this.comp._baseDispose=function(){a.apply(this,arguments),b.disposeDefer&&b.disposeDefer.resolve(!0)}},c.prototype=Object.create(b.prototype),c.prototype.constructor=c,c.prototype.refreshApp=function(a){var b=Q.defer(),c=this,d=setTimeout(function(){delete c.appDriver.events["AppReady_"+c.appDriver.id()],b.reject(new Error("Could not refresh app"))},1e4);if(this.appDriver.events["AppReady_"+this.appDriver.id()])throw clearTimeout(d),new Error("App was never ready!!!");return this.appDriver.events["AppReady_"+this.appDriver.id()]={callbackID:"AppReady_"+this.appDriver.id(),appComp:this.appDriver,deferred:{resolve:function(){return clearTimeout(d),b.resolve.apply(b,arguments)},reject:function(){return clearTimeout(d),b.reject.apply(b,arguments)}}},this.exec(function(a){a(Wix.Settings.refreshApp())},a),b.promise},c.prototype.triggerSettingsUpdatedEvent=function(a){return this.exec(function(a){a(Wix.Settings.triggerSettingsUpdatedEvent($message,Wix.Utils.getOrigCompId()))}.toString().replace("$message",JSON.stringify(a)),0)},c.prototype.openBillingPage=function(){var a=this;return this.exec(function(a){a(Wix.Settings.openBillingPage())}).then(function(){return waitForRenderedComponent("tpa.editor.components.dialogs.TpaUpgradeModal",1e3)}).then(function(b){return a.billingModal=b,b})},c.prototype.openMediaDialog=function(a,b,c,d){var e=this;if(c=c||function(){},this.mediaDialog)throw new Error("Media Dialog is already open!");var f=function(a){Wix.Settings.openMediaDialog("$mt","$ms",$fnsuccess,$fncancel),a()}.toString().replace("$mt",a||"").replace("$ms",b||"").replace("$fnsuccess",c.toString()).replace("$fncancel","function"==typeof d?d.toString():"undefined");return this.exec(f).then(function(){return waitForDomElement("#mediaGalleryFrame",1e4)}).then(function(a){function b(b){if(b.source===c){var e=JSON.parse(b.data);"open"===e.type&&d.resolve(a)}}e.mediaDialog=a;var c=a.contentWindow,d=Q.defer();return window.addEventListener("message",b,!1),setTimeout(function(){d.reject('Timeout waiting for media dialog "open" event')},15e3),d.promise.fin(function(){window.removeEventListener("message",b)})})},c.prototype.closeMediaDialog=function(){return this.mediaDialog?(this.mediaDialog.removeEvent(Constants.CoreEvents.MOUSE_WHEEL,W.Utils.stopMouseWheelPropagation),this.mediaDialog.dispose(),this.mediaDialog=void 0,W.Commands.executeCommand("WEditorCommands.CloseMediaFrame"),waitForDomElementToNotExist("#mediaGalleryFrame",5e3)):void 0},c.prototype.log=console.log.bind(console,"TPASettingDriver"),c.prototype.getDashboardAppUrl=function(){return this.exec(function(a){Wix.Settings.getDashboardAppUrl(function(b){a(b)})})},d.prototype=Object.create(b.prototype),d.prototype.constructor=d,d.prototype.log=console.log.bind(console,"TPAModalDriver"),d.prototype.getModalWidth=function(){var a=0;return this.comp&&this.comp._skinParts&&this.comp._skinParts.dialog&&(a=this.comp._skinParts.dialog.clientWidth),a},d.prototype.getModalHeight=function(){var a=0;return this.comp&&this.comp._skinParts&&this.comp._skinParts.dialog&&(a=this.comp._skinParts.dialog.clientHeight),a},d.prototype.closeModal=function(){return this.disposeDefer||(this.disposeDefer=Q.defer(),this.exec(function(a){a(Wix.closeWindow("Close modal message"))})),this.disposeDefer.promise},e.prototype=Object.create(b.prototype),e.prototype.constructor=e,e.prototype.log=console.log.bind(console,"TPAPopupDriver"),e.prototype.getPopupWidth=function(){var a=0;return this.comp&&this.comp._view&&(a=this.comp._view.clientWidth),a},e.prototype.getPopupHeight=function(){var a=0;return this.comp&&this.comp._view&&(a=this.comp._view.clientHeight),a},e.prototype.getPopupLeft=function(){var a=0;return this.comp&&this.comp._view&&(a=this.comp._view.getLeft()),a},e.prototype.getPopupTop=function(){var a=0;return this.comp&&this.comp._view&&(a=this.comp._view.getTop()),a},e.prototype.getPopupPosition=function(){var a="fixed";return this.comp&&this.comp._view&&(a=this.comp._view.getStyle("position")),a},e.prototype.closePopup=function(a){if(!this.disposeDefer){this.disposeDefer=Q.defer();var b=function(a){a(Wix.closeWindow("$data"))};b=b.toString().replace("$data",JSON.stringify(a,null,2)||"Close popup message"),this.exec(b)}return this.disposeDefer.promise},g.init(a)}function AppMarketDriver(){}var TPASpecs=TPASpecs||{};TPASpecs.runWixStyles=function(a){describe("Test Wix.Styles",function(){beforeAll(function(){waitsFor(function(){return!!a.settings},"context.settings",10)}),promiseIt("Wix.Styles.googleFontsCssUrl - validate googleFontsCssUrl",function(){return a.settings.exec(function(a){Wix.Styles.getStyleParams(function(b){a(b)})}).then(function(a){var b=a.googleFontsCssUrl;b&&b.length>0?expect(!b.contains("null")).toBeTruthy():expect(b).toBe("")})})})},AppMarketDriver.prototype.exec=function(a,b,c){var d=Q.defer();return setTimeout(function(){var b=JSON.stringify({cmd:a,intent:"APP_MARKET",callback:function(a){d.resolve(a)}},null,2);window.postMessage(b,"*")}.bind(this),c||0),d.promise},AppMarketDriver.prototype.getPendingAppsList=function(){return this.exec("GET_PENDING_APPS_LIST")},window.TPASpecs=window.TPASpecs||{},window.TPASpecs.runWixTests=function(a){describe("Test Wix namespace methods",function(){var b;beforeEach(function(){waitsFor(function(){return!!a.driver},1e4)}),promiseIt("Wix.setHeight",function(){var b,c=700;return a.driver.exec(function(a){a(Wix.Utils.getCompId())}).then(function(c){return b=c,a.driver.exec(function(a){Wix.setHeight(700),a()})}).then(function(){return Q.delay(300)}).then(function(){var d=a.driver.tpaDriver.getPreviewDocument().getElementById(b),e=d.getHeight();expect(e).toBe(c)})}),promiseIt("Wix.navigateToPage",function(){return a.driver.exec(function(a){Wix.getSitePages(function(b){a(b)})}).then(function(c){return b=c,expect(b).toBeDefined(),a.driver.navigateToPage(b[1].id)}).then(function(c){var d=c===b[1].id;return expect(d).toBeTruthy(),a.global.goToPage("mainPage")}).then(function c(a){var d=a.toPage,c=d===b[0].id;expect(c).toBeTruthy()})},1e4),promiseIt("Wix.getSitePages",function(){var b=a.driver.tpaDriver.getSitePages();return a.driver.exec(function(a){Wix.getSitePages(function(b){a(b)})}).then(function(a){var c=_.pluck(a,"id"),d=_.intersection(c,b.pagesKeys);expect(d.length).toBeEquivalentTo(b.pagesKeys.length)})},15e3),promiseIt("Wix.getSiteInfo",function(){var b=a.driver.tpaDriver.getPreviewDocument().referrer,c=a.driver.tpaDriver.getPreviewDocument().location.href,d=W.Config.siteNeverSavedBefore(),e=a.getSiteInfo||{baseUrl:d?"":W.Config.getUserPublicUrl(),pageTitle:"Home",referer:b,siteDescription:"",siteKeywords:"",siteTitle:"",url:c},f=a.override&&a.override.getSiteInfo;if(f)for(var g in f)f.hasOwnProperty(g)&&(e[g]=f[g]);return a.driver.exec(function(a){Wix.getSiteInfo(function(b){a(b)})}).then(function(a){expect(a).toBeDefined(),expect(a.pageTitle).toBeEquivalentTo(e.pageTitle),expect(a.baseUrl).toBeEquivalentTo(e.baseUrl),expect(a.referer).toBeEquivalentTo(e.referer),expect(a.siteTitle).toBeEquivalentTo(e.siteTitle)})})})},window.TPASpecs=window.TPASpecs||{},window.TPASpecs.runWixUtilsMediaTests=function(a){describe("Test Wix.Utils.Media namespace methods",function(){function b(a){var b={},c=["getImageUrl","getAudioUrl","getDocumentUrl","getSwfUrl"];c.forEach(function(a){b[a]=Wix.Utils.Media[a]("test")}),a(b)}beforeEach(function(){waitsFor(function(){return!!a.driver},1e4)}),promiseIt("gets Wix.Utils.Media functions return values",function(){return a.driver.exec(b).then(function(a){var b={getImageUrl:"http://static.wix.com/media/test",getAudioUrl:"http://media.wix.com/mp3/test",getDocumentUrl:"http://media.wix.com/ugd/test",getSwfUrl:"http://static.wix.com/media/test"};Object.keys(b).forEach(function(c){expect(a[c]).toBe(b[c])})})},2e4),promiseIt("Wix.Utils.Media.getResizedImageUrl",function(){return a.driver.exec(function(a){a(Wix.Utils.Media.getResizedImageUrl("8dfce587e3f99f17bba2d3346fea7a8d.jpg",100,100))}).then(function(a){expect(a).toBe("http://static.wix.com/media/8dfce587e3f99f17bba2d3346fea7a8d.jpg_srz_100_100_75_22_0.5_1.2_75_jpg_srz")})})})},window.TPASpecs=window.TPASpecs||{},window.TPASpecs.runWixUtilsTests=function(a){describe("Test Wix.Utils namespace methods",function(){function b(a){var b={},c=["getViewMode","getWidth","getCacheKiller","getTarget","getSectionUrl","getLocale","getInstanceId","getUid","getPermissions","getIpAndPort","getDemoMode","getSignDate","getOrigCompId"];c.forEach(function(a){b[a]=Wix.Utils[a]()}),a(b)}var c;beforeEach(function(){waitsFor(function(){return!!a.driver},1e4)});var d;if(d=[{func:"getViewMode",result:"editor"},{func:"getWidth",result:"980"},{func:"getTarget",result:null},{func:"getSectionUrl",result:null},{func:"getLocale",result:"en"},{func:"getInstanceId",result:"12eaadf0-1c2c-b5fd-faa1-4c14ddb94a7b"},{func:"getUid",result:"f447eec1-c011-4a17-b239-23d605c5ae7c"},{func:"getPermissions",result:"OWNER"},{func:"getIpAndPort",result:"91.199.119.254/52345"},{func:"getDemoMode",result:!1},{func:"getSignDate",result:"2013-07-18T09:04:18.699-05:00"},{func:"getOrigCompId",result:null}],a.excludes)for(var e=0;e<a.excludes.length;e++){var f=a.excludes[e],g=-1;d.filter(function(a,b){a.func===f&&(g=b)}),g>=0&&d.splice(g,1)}beforeAll(function(){}),promiseIt("gets Wix.Utils functions return values",function(){return a.driver.exec(b).then(function(b){if(c=b,a.override)for(var e=0;e<d.length;e++)d[e].func in a.override&&(d[e].result=a.override[d[e].func])})}),d.forEach(function(a){it("Wix.Utils."+a.func,function(){expect(c[a.func]).toBe(a.result)})}),promiseIt("Wix should be defined in the global scope",function(){return a.driver.waitForGlobal("Wix")}),promiseIt("Wix.Utils.getCompId",function(){return a.driver.exec(function(a){a(Wix.Utils.getCompId())}).then(function(b){expect(b).toBe(a.driver.comp.getComponentId())})},15e3),promiseIt("Wix.Utils.getCacheKiller",function(){return a.driver.exec(function(a){a([Wix.Utils.getCompId(),Wix.Utils.getCacheKiller()])}).spread(function(b,c){var d=a.driver.tpaDriver.getPreviewDocument().getElementById(b),e=d.getElementsByTagName("iframe")[0].src.match(/[?&]cacheKiller=([^&#]+)/);if(expect(e).toBeTruthy(),e){var f=decodeURIComponent(e[1]);expect(c).toBeEquivalentTo(f)}})}),promiseIt("Wix.Utils.getDeviceType",function(){return a.driver.exec(function(a){a(Wix.Utils.getDeviceType())}).then(function(a){expect(a).toBe("desktop")})})})};