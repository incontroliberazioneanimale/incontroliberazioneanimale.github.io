define.experiment.component("wixapps.integration.components.AppPart.EcomFeedback.New",function(a){var b=a;b.methods({setPreventLogicRun:function(a){this._preventLogicFromRunning=a},_runLogic:function(){if(!this._preventLogicFromRunning){var a=this.getLogicParams(),b=this,c={showView:b.showView,showLoadingIndicator:function(){b.setState("loading")},hideLoadingIndicator:function(){b.setState("content")},showErrorIndicator:function(a,c){a=a||-1,c=c||"Unspecified error",b.setState("error");var d=b._logger;d.reportError({code:a,description:c},this.$className,"showErrorIndicator",d.SubCategory.APP_LOGIC)}},d=this._data.get("viewName");d||(d=this._partDef.views[0],this._data.set("viewName",d,!0)),this._logic.run(d,a,c,this._extraLogicParams)}},invalidateAppPartSize:function(){this._lifecycleManager.performAction(function(){this.fireEvent("invalidateSize")}.bind(this))}})}),define.experiment.Class("wixapps.integration.proxies.Button2Proxy.EcomFeedback.New",function(a){var b=a;b.methods({_stylesMap:{"default":{skin:"wysiwyg.viewer.skins.button.BasicButton",style:"b3"},ecomViewCart:{skin:"wysiwyg.viewer.skins.button.BasicButton",style:"ecom_vc1"},ecomCheckout:{skin:"wysiwyg.viewer.skins.button.DisabledLayerButton",style:"ecom_co1"},ecomAddToCart:{skin:"wysiwyg.viewer.skins.button.BasicButton",style:"ecom_atc1"},ecomRemoveFromCart:{skin:"wysiwyg.viewer.skins.button.FixedFontButton",style:"ecom_rfc1"},ecomApplyCoupon:{skin:"wysiwyg.viewer.skins.button.ApplyButtonEcom",style:"ecom_apl1"},ecomAddProduct:{skin:"wysiwyg.viewer.skins.button.AddProductButton",style:"ecom_ap1"},ecomFeedbackCheckout:{skin:"wysiwyg.viewer.skins.button.EcomFeedbackCheckoutButton",style:"ecom_fmc1"},ecomFeedbackContinueShopping:{skin:"wysiwyg.viewer.skins.button.EcomFeedbackContinueShopping",style:"ecom_fmcs1"},ecomFeedbackContinueShopping2:{skin:"wysiwyg.viewer.skins.button.EcomFeedbackContinueShopping2",style:"ecom_fmcs2"}}})}),define.experiment.Class("ecommerce.core.EcomCartAPI.EcomFeedback.New",function(a,b){var c=a,d=b;c.inherits("bootstrap.utils.Events"),c.methods({_onRequestFail:d.after(function(){this.fireEvent("EcomCartAPI.requestError")})})}),define.experiment.newSkin("wysiwyg.viewer.skins.button.EcomFeedbackCheckoutButton.EcomFeedback.New",function(a){var b=a;b.inherits("mobile.core.skins.BaseSkin"),b.skinParams([{id:"bg",type:Constants.SkinParamTypes.BG_COLOR,defaultTheme:"color_15"},{id:"bgh",type:Constants.SkinParamTypes.BG_COLOR,defaultTheme:"color_14"},{id:"brd",type:Constants.SkinParamTypes.COLOR,defaultTheme:"color_15"},{id:"brdh",type:Constants.SkinParamTypes.COLOR,defaultTheme:"color_14"},{id:"txt",type:Constants.SkinParamTypes.COLOR,defaultTheme:"color_11"},{id:"txth",type:Constants.SkinParamTypes.COLOR,defaultTheme:"color_11"},{id:"brw",type:Constants.SkinParamTypes.SIZE,defaultValue:"0px"},{id:"rd",type:Constants.SkinParamTypes.BORDER_RADIUS,defaultValue:"0px"},{id:"fnt",type:Constants.SkinParamTypes.FONT,defaultTheme:"font_8"},{id:"trans1",type:Constants.SkinParamTypes.TRANSITION,defaultValue:"border-color 0.4s ease 0s ,background-color 0.4s ease 0s"},{id:"trans2",type:Constants.SkinParamTypes.TRANSITION,defaultValue:"color 0.4s ease 0s"},{id:"pos",type:Constants.SkinParamTypes.OTHER,defaultValue:"position:absolute; top:0; bottom:0; left:0; right:0;"}]),b.html('<a skinPart="link"><span skinPart="label"></span></a>'),b.css(["%link% { [rd][pos][bg][trans1] border:solid [brd] [brw]; cursor:pointer !important; }","%label% { [fnt][trans2] color:[txt]; white-space:nowrap; margin:-[brw] [brw] 0 [brw]; display:inline-block; position:relative; }",":hover %link% { [bgh] border-color:[brdh]; [trans1] }",":hover %label% { color:[txth]; [trans2] }"])}),define.experiment.newSkin("wysiwyg.viewer.skins.button.EcomFeedbackContinueShopping.EcomFeedback.New",function(a){var b=a;b.inherits("mobile.core.skins.BaseSkin"),b.skinParams([{id:"bg",type:Constants.SkinParamTypes.BG_COLOR,defaultTheme:"color_14"},{id:"bgh",type:Constants.SkinParamTypes.BG_COLOR,defaultTheme:"color_13"},{id:"brd",type:Constants.SkinParamTypes.COLOR,defaultTheme:"color_14"},{id:"brdh",type:Constants.SkinParamTypes.COLOR,defaultTheme:"color_13"},{id:"txt",type:Constants.SkinParamTypes.COLOR,defaultTheme:"color_11"},{id:"txth",type:Constants.SkinParamTypes.COLOR,defaultTheme:"color_11"},{id:"brw",type:Constants.SkinParamTypes.SIZE,defaultValue:"0px"},{id:"rd",type:Constants.SkinParamTypes.BORDER_RADIUS,defaultValue:"0px"},{id:"fnt",type:Constants.SkinParamTypes.FONT,defaultTheme:"font_8"},{id:"trans1",type:Constants.SkinParamTypes.TRANSITION,defaultValue:"border-color 0.4s ease 0s ,background-color 0.4s ease 0s"},{id:"trans2",type:Constants.SkinParamTypes.TRANSITION,defaultValue:"color 0.4s ease 0s"},{id:"pos",type:Constants.SkinParamTypes.OTHER,defaultValue:"position:absolute; top:0; bottom:0; left:0; right:0;"}]),b.html('<a skinPart="link"><span skinPart="label"></span></a>'),b.css(["%link% { [rd][pos][bg][trans1] border:solid [brd] [brw]; cursor:pointer !important; }","%label% { [fnt][trans2] color:[txt]; white-space:nowrap; margin:-[brw] [brw] 0 [brw]; display:inline-block; position:relative; }",":hover %link% { [bgh] border-color:[brdh]; [trans1] }",":hover %label% { color:[txth]; [trans2] }"])}),define.experiment.newSkin("wysiwyg.viewer.skins.button.EcomFeedbackContinueShopping2.EcomFeedback.New",function(a){var b=a;b.inherits("mobile.core.skins.BaseSkin"),b.skinParams([{id:"bg",type:Constants.SkinParamTypes.BG_COLOR,defaultTheme:"color_11"},{id:"bgh",type:Constants.SkinParamTypes.BG_COLOR,defaultTheme:"color_11"},{id:"brd",type:Constants.SkinParamTypes.COLOR,defaultTheme:"color_11"},{id:"brdh",type:Constants.SkinParamTypes.COLOR,defaultTheme:"color_11"},{id:"txt",type:Constants.SkinParamTypes.COLOR,defaultTheme:"color_15"},{id:"txth",type:Constants.SkinParamTypes.COLOR,defaultTheme:"color_14"},{id:"brw",type:Constants.SkinParamTypes.SIZE,defaultValue:"0px"},{id:"rd",type:Constants.SkinParamTypes.BORDER_RADIUS,defaultValue:"0px"},{id:"fnt",type:Constants.SkinParamTypes.FONT,defaultTheme:"font_8"},{id:"trans1",type:Constants.SkinParamTypes.TRANSITION,defaultValue:"border-color 0.4s ease 0s ,background-color 0.4s ease 0s"},{id:"trans2",type:Constants.SkinParamTypes.TRANSITION,defaultValue:"color 0.4s ease 0s"},{id:"pos",type:Constants.SkinParamTypes.OTHER,defaultValue:"position:absolute; top:0; bottom:0; left:0; right:0;"}]),b.html('<a skinPart="link"><span skinPart="label"></span></a>'),b.css(["%link% { [rd][pos][bg][trans1] border:solid [brd] [brw]; cursor:pointer !important; }","%label% { [fnt][trans2] color:[txt]; white-space:nowrap; margin:-[brw] [brw] 0 [brw]; display:inline-block; position:relative; }",":hover %link% { [bgh] border-color:[brdh]; [trans1] }",":hover %label% { color:[txth]; [trans2] }"])}),define.experiment.Class("ecommerce.converters.EcomProductItemConverter.EcomFeedback.New",function(a){var b=a;b.methods({convertFromProductBundle:function(a){var b={_type:"ProductItem",id:a.id,title:a.title||"",quantity:1,origQuantity:1,inventory:0,quantityRange:"",optionsDescription:[],options:a.optionSelectionList||a.options,price:a.totalPrice||a.price,image:a.currentImage||"",isInStock:!a.isInventoryManaged||a.inventory>0};return b}})}),define.experiment.newClass("ecommerce.parts_logic.FeedbackMessageLogic.EcomFeedback.New",function(a){var b=a;b.resources(["W.Commands","W.Viewer","W.Utils"]),b.utilize(["ecommerce.core.InfrastructureUtils","ecommerce.converters.EcomProductItemConverter"]),b.binds(["_gotoPageAfterHashChange"]),b.statics({CLOSE_PRODUCT:"closeProduct",SHOW_FEEDBACK:"showFeedback",VIEW_NAME:"FeedbackMessage"}),b.fields({_isVisible:!1}),b.methods({initialize:function(a,b,c){this._environment=a,this._utils=new this.imports.InfrastructureUtils,this._productItemConverter=new this.imports.EcomProductItemConverter,this._localizer=b,this._logger=c,this._behaviors=[{value:this.CLOSE_PRODUCT,label:this._localizer.localize("ECOM_FEEDBACK_MSG_CLOSE_ZOOM_OPT_LABEL")},{value:this.SHOW_FEEDBACK,label:this._localizer.localize("ECOM_FEEDBACK_MSG_SHOW_FEEDBACK_OPT_LABEL")}]},hasFeedbackMessage:function(){var a=this._environment.getAppPart().getLogicParams();return a&&a.afterAddProduct?a.afterAddProduct==this.SHOW_FEEDBACK:!1},showFeedbackMessage:function(a){this._isVisible=!0,this._productItem=this.getProductItem(a);var b=this._getEventsHandlers(),c=this._environment.getAppPart();c.$view.setStyle("opacity","0"),c.showView(this._productItem,this.VIEW_NAME,b)},_getEventsHandlers:function(){return{"continue-shopping":function(){this._logger.sendEcomEvent(this._logger.FEEDBACK_MSG_CONTINUE_SHOPPING_BTN_CLICKED,{c1:this._productItem.getChildValue("id")}),this.closeFeedbackMsg()}.bind(this),"goto-checkout":function(){this._logger.sendEcomEvent(this._logger.FEEDBACK_MSG_CHECKOUT_BTN_CLICKED,{c1:this._productItem.getChildValue("id")}),this._navigateToCartPage()}.bind(this)}},isVisible:function(){return this._isVisible},closeFeedbackMsg:function(){this._isVisible=!1,this.resources.W.Commands.executeCommand("WViewerCommands.MediaZoom.Close",null,this)},_navigateToCartPage:function(){var a=this._getCartPageId(),b=!!W.Data.getDataByQuery("#"+a);a&&b&&this.resources.W.Utils.hash.addEvent("change",this._gotoPageAfterHashChange),this.closeFeedbackMsg()},_gotoPageAfterHashChange:function(a){if(a.isForSureAfterChange){var b=this._getCartPageId();this.resources.W.Utils.hash.removeEvent("change",this._gotoPageAfterHashChange),this.resources.W.Viewer.goToPage(b)}},_getCartPageId:function(){var a=this._environment.getAppPart().getLogicParams(),b=a&&a.cartPageID;return b},generateSettingsPanel:function(a,b){var c=this._environment.getAppPart().getMainProxy().getViewContext(),d=c.getEnvironment().getViewName();d==this.VIEW_NAME?this._updateFeedbackSettingsPanel(a,b):this._updateProductSettingsPanel(a,b)},_updateProductSettingsPanel:function(a,b){var c=this,d=b.get("appLogicParams"),e=d.afterAddProduct&&d.afterAddProduct.value||this._behaviors[0].value;a.addComboBoxField(this._localizer.localize("ECOM_FEEDBACK_MSG_BEHAVIOR_PANEL_LABEL"),this._behaviors).setValue(e).addEvent("inputChanged",function(a){d.afterAddProduct={type:"AppPartParam",value:a.value},a.value==c.CLOSE_PRODUCT?f.collapse():f.uncollapse(),c._fireDataChangePreventRerender(b)});var f=a.addButtonField("",this._localizer.localize("ECOM_FEEDBACK_MSG_STYLE_FEEDBACK_PAGE_BTN_LABEL"));f.addEvent("click",function(){var a=c._environment.getAppPart().getMainProxy().getData();c.showFeedbackMessage(a)}),e==this.CLOSE_PRODUCT&&f.collapse()},_updateFeedbackSettingsPanel:function(a,b){var c=this,d=this._utils.getSitePages(),e=b.get("appLogicParams"),f=e.cartPageID&&e.cartPageID.value||"";a.addComboBoxField(this._localizer.localize("ECOM_FEEDBACK_MSG_CHOOSE_PAGE_DESC_LABEL"),d).setValue(f).addEvent("inputChanged",function(a){e.cartPageID={type:"AppPartParam",value:a.value},c._fireDataChangePreventRerender(b)}),this._listenToOrientationChange()},_fireDataChangePreventRerender:function(a){var b=this._environment.getAppPart();b.setPreventLogicRun(!0),a.fireDataChangeEvent(),b.setPreventLogicRun(!1)},_listenToOrientationChange:function(){var a=this._environment.getAppPart(),b=a.getMainProxy().getViewContext().getEnvironment(),c=b.getVar("msgOrientation");c&&c.addEvent(Constants.DataItemEvents.CHANGE,function(){a.invalidateAppPartSize()})},getProductItem:function(a){var b=this._productItemConverter.convertFromProductBundle(a.getValue());b.options=b.options?this._getSelectedOptions(b.options):[];var c=this._utils.createDataItem(b,this._environment);return c},_getSelectedOptions:function(a){var b=[];return a.forEach(function(a){if(a.isSelectableList&&a.items&&a.items.length){var c=a.selectedValue;if(c>-1){var d=_.find(a.items,function(a){return a.value==c});b.push(d.description||d.text)}else b.push(a.items[0].description||a.items[0].text)}else a.text&&b.push(a.text)}),b}})}),define.experiment.Class("ecommerce.core.InfrastructureUtils.EcomFeedback.New",function(a){var b=a;b.resources(["W.Viewer"]),b.methods({getSitePages:function(){var a,b=[{label:"",value:""}],c=this.resources.W.Viewer.getPagesData();if(c){for(a in c){var d=c[a],e=d.get("title");b.push({label:e,value:a})}return b}}})}),define.experiment.Class("ecommerce.parts_logic.ProductBundleLogic.EcomFeedback.New",function(a,b){var c=a,d=b;c.utilize(d.merge(["ecommerce.parts_logic.FeedbackMessageLogic"])),c.resources(d.merge(["W.Viewer"])),c.binds(["_handleBuyProductError"]),c.methods({initialize:d.after(function(){this._feedbackLogic=new this.imports.FeedbackMessageLogic(this._environment,this._localizer,this._logger),this._environment.isMobile()&&(this.preventGeneratingSettingsPanel=!0),this._cartAPI.addEvent("EcomCartAPI.requestError",this._handleBuyProductError)}),_handleBuyProduct:function(a){var b=a.getChildByRef("options"),c=this._validateProductOptions(b),d=this._optionsItemsRelations._selectedOptions.map(function(a){return a.selectedOptionId}),e=this._optionsItemsRelations.getProductItem(a,d);if(e&&c){var f=this._getTextOptionsParams(b),g=e.getChildValue("id");this._cartAPI.addProduct(g,f),this._logger.sendEcomEvent(this._logger.PRODUCT_PAGE_ADD_PRODUCT_TO_CART,{c1:g}),this._feedbackLogic.hasFeedbackMessage()&&!this._environment.isMobile()?(this._feedbackLogic.showFeedbackMessage(a),this.resources.W.Viewer.getZoomHandler().hideNextPrevButtons()):this.resources.W.Commands.executeCommand("WViewerCommands.MediaZoom.Close",null,this)}},_handleBuyProductError:function(){this._feedbackLogic.isVisible()&&this._feedbackLogic.closeFeedbackMsg()},generateSettingsPanel:function(a,b){this._feedbackLogic.generateSettingsPanel(a,b)}})}),define.experiment.dataItem("STYLES.EcomFeedback",function(a){var b=a;return b.merge({styleItems:{ecomFeedbackCheckout:["ecom_fmc1"],ecomFeedbackContinueShopping:["ecom_fmcs1"],ecomFeedbackContinueShopping2:["ecom_fmcs2"]}})}),define.experiment.dataItem("SKINS.EcomFeedback.New",function(a){var b=a;return b.merge({components:{ecomFeedbackCheckout:["wysiwyg.viewer.skins.button.AddProductButton","wysiwyg.viewer.skins.button.BasicButton","wysiwyg.viewer.skins.button.ButtonThreeD","wysiwyg.viewer.skins.button.ButtonLiftedShadow","wysiwyg.viewer.skins.button.ShinyButtonInverted","wysiwyg.viewer.skins.button.ButtonArrow","wysiwyg.viewer.skins.button.ButtonInnerShadow","wysiwyg.viewer.skins.button.ButtonShadowRight","wysiwyg.viewer.skins.button.ButtonShadowLeft","wysiwyg.viewer.skins.button.TextOnlyButtonSkin","wysiwyg.viewer.skins.button.ShinyButtonISkin","wysiwyg.viewer.skins.button.ShinyButtonIISkin","wysiwyg.viewer.skins.button.RibbonButton","wysiwyg.viewer.skins.button.CircleButton","wysiwyg.viewer.skins.button.SloopyButton","wysiwyg.viewer.skins.button.IronButton"],ecomFeedbackContinueShopping:["wysiwyg.viewer.skins.button.AddProductButton","wysiwyg.viewer.skins.button.BasicButton","wysiwyg.viewer.skins.button.ButtonThreeD","wysiwyg.viewer.skins.button.ButtonLiftedShadow","wysiwyg.viewer.skins.button.ShinyButtonInverted","wysiwyg.viewer.skins.button.ButtonArrow","wysiwyg.viewer.skins.button.ButtonInnerShadow","wysiwyg.viewer.skins.button.ButtonShadowRight","wysiwyg.viewer.skins.button.ButtonShadowLeft","wysiwyg.viewer.skins.button.TextOnlyButtonSkin","wysiwyg.viewer.skins.button.ShinyButtonISkin","wysiwyg.viewer.skins.button.ShinyButtonIISkin","wysiwyg.viewer.skins.button.RibbonButton","wysiwyg.viewer.skins.button.CircleButton","wysiwyg.viewer.skins.button.SloopyButton","wysiwyg.viewer.skins.button.IronButton"],ecomFeedbackContinueShopping2:["wysiwyg.viewer.skins.button.AddProductButton","wysiwyg.viewer.skins.button.BasicButton","wysiwyg.viewer.skins.button.ButtonThreeD","wysiwyg.viewer.skins.button.ButtonLiftedShadow","wysiwyg.viewer.skins.button.ShinyButtonInverted","wysiwyg.viewer.skins.button.ButtonArrow","wysiwyg.viewer.skins.button.ButtonInnerShadow","wysiwyg.viewer.skins.button.ButtonShadowRight","wysiwyg.viewer.skins.button.ButtonShadowLeft","wysiwyg.viewer.skins.button.TextOnlyButtonSkin","wysiwyg.viewer.skins.button.ShinyButtonISkin","wysiwyg.viewer.skins.button.ShinyButtonIISkin","wysiwyg.viewer.skins.button.RibbonButton","wysiwyg.viewer.skins.button.CircleButton","wysiwyg.viewer.skins.button.SloopyButton","wysiwyg.viewer.skins.button.IronButton"]}})}),define.experiment.component("wixapps.integration.components.editor.ZoomCustomizer.EcomFeedback.New",function(a){var b=a;b.methods({_doCreateFields:function(){var a=this;if(this._zoomComp&&this._zoomComp.getAppPartLogic){var b=this._zoomComp.getAppPartLogic();!b.preventGeneratingSettingsPanel&&b.generateSettingsPanel&&(this._zoomLogicPropGroup?this._updatedZoomCompGeneralPanel(this._zoomLogicPropGroup):this.addInputGroupField(function(){a._zoomLogicPropGroup=this,a._updatedZoomCompGeneralPanel(this)}))}},_updatedZoomCompGeneralPanel:function(a){a.disposeFields();var b=this._zoomComp.getLogicParams(),c=this._zoomComp.getDataItem(),d=this._zoomComp.getAppPartLogic();d.generateSettingsPanel(a,c,b)},_registerZoomCompListeners:function(a){a.getDataItem().addEvent("dataChanged",this._updateCustomizations),a.addEvent("proxyDisplayed",this._updateCustomizationPanel),this._isMobile()&&a.addEvent("autoSized",this._updatePreviewFrame)},_updateCustomizationPanel:function(){this._updateViewCustomizations(this._customizationsPropGroup,this._zoomComp._mainProxy.getViewContext()),this._doCreateFields()},_updateCustomizations:function(){var a=this._zoomComp.getDataItem().get("appLogicCustomizations");this._targetZoomData.set("appLogicCustomizations",a);var b=this._zoomComp.getDataItem().get("appLogicParams");this._targetZoomData.set("appLogicParams",b)}})}),define.experiment.Class("wixapps.integration.managers.applicationhandlers.ZoomHandler.EcomFeedback",function(a){a.methods({_listenToViewDefChanges:function(a,b){var c=this,d=function(){Q().then(function(){return c._updateAppPartSize(a)}).done(function(){b(a.getViewNode())})};a.getMainProxy().getViewDefinition().addEvent(Constants.DataItemEvents.CHANGE,d),a.addEvent("proxyDisplayed",d),a.addEvent("invalidateSize",d)}})});