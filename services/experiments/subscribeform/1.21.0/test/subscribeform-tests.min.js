describeExperiment({SubscribeForm:"New"},"SubscribeForm",function(){function a(){var a=this;this.componentLogic=null,this.mockData=this.W.Data.createDataItem({id:"dummyData",type:"SubscribeForm"}),this.mockProps=this.W.Data.createDataItem({id:"dummyProperties",type:"SubscribeFormProperties"});var b=new this.ComponentBuilder(document.createElement("div"));b.withType("wysiwyg.common.components.subscribeform.viewer.SubscribeForm").withSkin("wysiwyg.common.components.subscribeform.viewer.skins.SubscribeFormSkin").withData(this.mockData).onCreated(function(b){a.componentLogic=b,a.componentLogic.isSiteReady=function(){return!0},a.componentLogic.getUserCountryCode=function(){return"UKR"},a.componentLogic.getCountryCodes=function(){return{AFG:{countryName:"Afghanistan",phoneCode:"+93"},ALA:{countryName:"Ã…land Islands",phoneCode:"+358 18"},ALB:{countryName:"Albania",phoneCode:"+355"},DZA:{countryName:"Algeria",phoneCode:"+213"}}},a.componentLogic._sendMail=function(){this._showMessage(this._data.get("successMessage"))},a.componentLogic.setComponentProperties(a.mockProps)}).create()}testRequire().components("wysiwyg.common.components.subscribeform.viewer.SubscribeForm").classes("core.managers.components.ComponentBuilder").resources("W.Data","W.ComponentLifecycle"),beforeEach(function(){a.call(this),this.forceRenderComponent=function(){this.ComponentLifecycle["@testRenderNow"](this.componentLogic)},waitsFor(function(){return null!==this.componentLogic},"SubscribeForm component to be ready",1e3)}),describe("Component structure",function(){it("Skin parts should be defined",function(){expect(this.componentLogic._skinParts.wrapper).toBeDefined()})}),describe("component data and properties by default",function(){it("toEmailAddress field should not have a value ",function(){var a=this.componentLogic._data.get("toEmailAddress");expect(a).not.toBe(!0)}),it("submitButtonLabel field should have a Label text",function(){var a=this.componentLogic._data.get("submitButtonLabel");expect(a).toBe("Subscribe")}),it("by Default should be shown one Email field",function(){var a=this.componentLogic._properties.get("hiddenEmailField");expect(a).toBeTruthy()}),it("by Default should be hidden all field except Email",function(){var a=!0,b=this;["hiddenFirstNameField","hiddenLastNameField","hiddenPhoneField"].forEach(function(c){a=!b.componentLogic._properties.get(c),!a}),expect(a).toBeTruthy()})}),describe("component state dir",function(){it("should be right in states'",function(){this.componentLogic._data.set("textDirection","right"),this.forceRenderComponent();var a=this.componentLogic._selectedStates.dir;expect(a).toBe("right")}),it("should be left in states'",function(){this.forceRenderComponent();var a=this.componentLogic._selectedStates.dir;expect(a).toBe("left")})}),describe("component fields activation",function(){it("first name should be enabled",function(){this.componentLogic._properties.set("hiddenFirstNameField",!0),this.forceRenderComponent();var a=!!this.componentLogic._activeFields.firstNameField;expect(a).toBeTruthy()}),it("last name should be enabled",function(){this.componentLogic._properties.set("hiddenLastNameField",!0),this.forceRenderComponent();var a=!!this.componentLogic._activeFields.lastNameField;expect(a).toBeTruthy()}),it("email field should be enabled",function(){this.componentLogic._properties.set("hiddenEmailField",!0),this.forceRenderComponent();var a=!!this.componentLogic._activeFields.emailField;expect(a).toBeTruthy()}),it("phone field should be enabled",function(){this.componentLogic._properties.set("hiddenPhoneField",!0),this.forceRenderComponent();var a=!!this.componentLogic._activeFields.phoneField;expect(a).toBeTruthy()})}),describe("country codes",function(){it("should be defined",function(){var a=this.componentLogic.getUserCountryCode();expect(a).toBeTruthy()}),it("Dropdown box should contain some items ",function(){this.componentLogic._properties.set("hiddenPhoneField",!0),this.forceRenderComponent();var a=this.componentLogic._skinParts.phoneField.querySelectorAll("option").length;expect(a).toBeGreaterThan(0)})}),describe("validation",function(){it("owner email error",function(){var a=this.componentLogic.lingo.err_noOwner.replace(/^\s+|\s+$/g,"");this.forceRenderComponent(),this.componentLogic.getDataItem().set("toEmailAddress",""),this.componentLogic._onSubmit();var b=this.componentLogic._skinParts.notifications.innerText.replace(/^\s+|\s+$/g,"");expect(b).toBe(a)}),it("subscriber email error",function(){var a=this.componentLogic._data.get("errorMessage").replace(/^\s+|\s+$/g,"");this.forceRenderComponent(),this.componentLogic.getDataItem().set("toEmailAddress","test@gmail.com"),this.componentLogic._skinParts.emailField.value="",this.componentLogic._onSubmit();var b=this.componentLogic._skinParts.notifications.innerText.replace(/^\s+|\s+$/g,"");expect(b).toBe(a)}),it("require fields error",function(){var a=this.componentLogic._data.get("validationErrorMessage").replace(/^\s+|\s+$/g,"");this.componentLogic._properties.set("hiddenFirstNameField",!0),this.componentLogic._properties.set("requiredFirstNameField",!0),this.forceRenderComponent(),this.componentLogic.getDataItem().set("toEmailAddress","test@gmail.com"),this.componentLogic._skinParts.emailField.value="test@gmqil.com",this.componentLogic._onSubmit();var b=this.componentLogic._skinParts.notifications.innerText.replace(/^\s+|\s+$/g,"");expect(b).toBe(a)}),it("send email successMessage",function(){var a=this.componentLogic._data.get("successMessage").replace(/^\s+|\s+$/g,"");this.forceRenderComponent(),this.componentLogic.getDataItem().set("toEmailAddress","test@gmail.com"),this.componentLogic._skinParts.emailField.value="test@gmqil.com",this.componentLogic._onSubmit();var b=this.componentLogic._skinParts.notifications.innerText.replace(/^\s+|\s+$/g,"");expect(b).toBe(a)})}),describe("format data",function(){it("pre format data with all fields ",function(){var a="test@gmqil.com";this.componentLogic._properties.set("hiddenFirstNameField",!0),this.componentLogic._properties.set("hiddenLastNameField",!0),this.forceRenderComponent(),this.componentLogic._skinParts.emailField.value=a,this.componentLogic._skinParts.firstNameField.value=a,this.componentLogic._skinParts.lastNameField.value=a;var b,c,d=this.componentLogic.preFormatFields(),e=0;for(b in d)for(c in d[b])d[b][c]===a&&e++;expect(e).toBe(6)}),it("pre format data with all filled fields ",function(){var a="test@gmqil.com";this.componentLogic._properties.set("hiddenFirstNameField",!0),this.componentLogic._properties.set("hiddenLastNameField",!0),this.forceRenderComponent(),this.componentLogic._skinParts.emailField.value=a,this.componentLogic._skinParts.firstNameField.value=a;var b,c,d=this.componentLogic.preFormatFields(),e=0;for(b in d)for(c in d[b])d[b][c]===a&&e++;expect(e).toBe(4)})})});