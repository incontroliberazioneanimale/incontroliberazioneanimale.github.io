define.resource("experimentDescriptors.ecomoutofstock",{createTime:"2013-11-05T00:05:00",owner:"guyb",description:"show out of stock products.",tags:["editor","viewer"]}),define.resource("experimentDescriptors.ecomapplyqamode",{createTime:"2013-02-16T17:53:00",owner:"guyb",description:"apply QA mode to the ecom and wixapps appPart run.",tags:["editor","viewer"]}),define.experiment.Class("ecommerce.converters.EcomProductBundleConverter.EcomOutOfStock",function(a){var b=a;b.methods({convertProductBundle:function(a){var b={_type:"ProductBundle",id:a.id,title:a.title||"<br/>",ribbon:a.ribbon||"",price:a.priceFormatted||"<br/>",retailPrice:a.retailPriceFormatted||"<br/>",options:a.optionsList&&a.optionsList.map(this._optionListConverter.convertOptionsList)||[],outOfStock:a.outOfStock||!1};return this._addImagesToProduct(a,b),b.productItems=this._getProductItems(a.productsItemsList),b.details=(a.details||"").replace(/\n/g,"<br/>"),b.overview=(a.overview||"").replace(/\n/g,"<br/>"),b.origPrice=b.price,b}})}),define.experiment.Class("ecommerce.converters.EcomProductItemConverter.EcomFeedbackMrg",function(a){var b=a;b.methods({convertFromProductBundle:function(a){var b={_type:"ProductItem",id:a.id,title:a.title||"",quantity:1,origQuantity:1,inventory:0,quantityRange:"",optionsDescription:[],options:a.optionSelectionList||a.options,price:a.totalPrice||a.price,image:a.currentImage||"",isInStock:!a.isInventoryManaged||a.inventory>0};return b}})}),define.experiment.Class("ecommerce.core.EcomCartAPI.EcomFeedbackMrg",function(a,b){var c=a,d=b;c.inherits("bootstrap.utils.Events"),c.methods({_onRequestFail:d.after(function(){this.fireEvent("EcomCartAPI.requestError")})})}),define.experiment.Class("ecommerce.core.EcomCheckoutAPI.EcomExp8",function(a){var b=a;b.statics({API_URL_SEGMENT:"/apps/ecommerce/api/checkout?",CHECKOUT_RESULT:"f_checkoutResult",CHECKOUT_ERROR_ID:"f_checkoutErrorId",_isErrorProcessed:!1,_checkoutSuccessUrl:"",_returnToURL:""}),b.methods({_getCheckoutURLParams:function(a,b,c){var d="storeId="+b;return d+="&cartId="+a,d+="&metaSiteId="+this.resources.W.Config.getMetaSiteId(),c&&(d+="&siteId="+c),this.resources.W.Config.env.$isPublicViewerFrame&&(d+="&svSession="+this.resources.W.Config.getSvSession()),d+="&successURL="+this._getSuccessURL(),d+="&returnToURL="+this._getReturnToURL()},setReturnToURL:function(a){this.$class.prototype._returnToURL||(a=this._removeQueryParam(this.CHECKOUT_RESULT,a),a=this._removeQueryParam(this.CHECKOUT_ERROR_ID,a),this.$class.prototype._returnToURL=a)},_getReturnToURL:function(){return this._returnToURL?encodeURIComponent(this._returnToURL):this._getCurrentPageURL()},_getSuccessURL:function(){return this._checkoutSuccessUrl?encodeURIComponent(this._checkoutSuccessUrl):this._getReturnToURL()}})}),define.experiment.Class("ecommerce.core.EcomDataProvider.EcomExp1",function(a,b){var c=a,d=b;c.utilize(d.merge(["ecommerce.core.EcomCartIdHolder"])),c.methods({initialize:function(a){this._environment=a,this._dataFactory=a.getDataItemFactory(),this._typesManager=a.getTypesManager(),this._itemsCache=a.getItemCache(),this._magentoClient=new this.imports.EcomMagentoClient(this.getStoreId(),this._environment.getAppInstance().getLocalizer()),this._productBundleConverter=new this.imports.EcomProductBundleConverter,this._cartConverter=new this.imports.EcomCartConverter,this._categoryConverter=new this.imports.EcomCategoryConverter,this._shippingConverter=new this.imports.EcomShippingConverter,this._cartIdHolder=new this.imports.EcomCartIdHolder,this._runningRequests={},this._deleteCartIfNeeded()},getCart:function(a){var b=this,c=this.getCartId(),d=c?this._magentoClient.getCart:function(a,b){b(null)};c=c||this._cartConverter.NULL_CART_ID,this._getData(c,d,function(a){a&&a.cart&&a.cart.clearCart&&(b._deleteCartId(),a=null);var c=b._cartConverter.convertCart(a);return b._setCartId(c.id),c},a)},getCartId:function(){var a=this._itemsCache.get(this.cartIdProperty)&&this._itemsCache.get(this.cartIdProperty).getValue();if(!a){var b=this._cartIdHolder.getCartId();b&&(a=b,this._itemsCache.put(this.cartIdProperty,a))}return a},clearCartId:function(){this._itemsCache.remove(this.cartIdProperty),this._deleteCartId()},_setCartId:function(a){a!=this._cartConverter.NULL_CART_ID&&this.getCartId()!=a&&(this.resources.W.Config.env.$isPublicViewerFrame&&this._cartIdHolder.setCartId(a),this._itemsCache.put(this.cartIdProperty,a))},_deleteCartIfNeeded:function(){if(!this._itemsCache.get("isCartDeleted")||!this._itemsCache.get("isCartDeleted").getValue()){var a=this.resources.W.Utils.getQueryParam(this.paymentSucceededQueryParam);a&&a===this.paymentSucceededQueryParamSuccessValue&&this._deleteCartId()}},_deleteCartId:function(){this._cartIdHolder.clearCartId(),this._itemsCache.put("isCartDeleted",!0)},_deleteCartCookie:d.remove(),_writeCartCookie:d.remove()})}),define.experiment.Class("ecommerce.core.InfrastructureUtils.EcomFeedbackMrg",function(a){var b=a;b.resources(["W.Viewer"]),b.methods({getSitePages:function(){var a,b=[{label:"",value:""}],c=this.resources.W.Viewer.getPagesData();if(c){for(a in c){var d=c[a],e=d.get("title");b.push({label:e,value:a})}return b}}})}),define.experiment.Class("ecommerce.core.ThankYouPageConfiguration.WixAppsTranslation",function(a){a.methods({handlePastePage:function(){var a=this.resources.W.AppsEditor.localize("ECOM_THANK_YOU_PAGE_ADDED_TITLE"),b=this.resources.W.AppsEditor.localize("ECOM_THANK_YOU_PAGE_ADDED_DESCRIPTION");this.resources.W.EditorDialogs.openPromptDialog(a,b,"",this.resources.W.EditorDialogs.DialogButtonSet.OK,function(){})}})}),define.experiment.Class("ecommerce.parts_logic.EcomCheckoutButtonLogic.EcomExp4",function(a){var b=a;b.methods({_initializeInnerData:function(a){this._linkData.target=a.checkoutTarget||this._linkData.target,this.resources.W.Config.env.$isPublicViewerFrame&&this._environment.isMobile()&&(this._linkData.target="_blank")},generateSettingsPanel:function(a,b){var c=b.get("appLogicParams"),d=this,e=c.checkoutTarget&&c.checkoutTarget.value||this._windowOptions[0].value;a.addComboBoxField(d._localizer.localize("ECOM_CHECKOUT_BUTTON_BUYERS_CHECKOUT_LABEL_PANEL"),this._windowOptions).setValue(e).addEvent("inputChanged",function(a){d._linkData.target!=a.value&&(d._linkData.target=a.value,c.checkoutTarget={type:"AppPartParam",value:a.value},b.fireDataChangeEvent())})}})}),define.experiment.Class("ecommerce.parts_logic.EcomJoinedCartLogic.EcomExp8",function(a){var b=a;b.methods({_prepareInnerCompsLogic:function(a,b,c){if(this._cartLogic._addLoadingIndicatorEvents(b),this._chkBtnLogic._initializeInnerData(a),c.getChildValue("hasFees")===!0&&this._chkBtnLogic.setValidationCallBack(this._shippingLogic.validateShipping),this.resources.W.Config.env.$isPublicViewerFrame){var d=this._pageController.getThankYouPageUrl();d&&this._chkBtnLogic._checkoutAPI.setCheckoutSuccessUrl(d),this._chkBtnLogic._checkoutAPI.setReturnToURL(window.location.href)}}})}),define.experiment.Class("ecommerce.parts_logic.EcomJoinedCartLogic.ecomApplyQaMode",function(a){var b=a;b.statics({OUTER_DEFAULT_CATEGORY:"defaultCategory"}),b.methods({runQaMode:function(a,b,c){var d=this;this._runArgs=[a,b,c];var e=this._environment.getAppPart();this.resources.W.Commands.executeCommand("ApplicationPerformanceSpy.logPhase",{step:"loadLogicData",appPart:e}),this._dataProvider.getCart(function(f){d.resources.W.Commands.executeCommand("ApplicationPerformanceSpy.logPhase",{step:"logicDataLoaded",appPart:e});var g=new d.imports.InfrastructureUtils,h=g.createDataItem({_type:"CheckoutButton"},d._environment);h.addEvent(Constants.DataItemEvents.CHANGE,function(){i.getChildByRef("checkout").setValue(h.getValue())}),d._cartDataChange=function(){i.getChildByRef("cart").setValue(f.getValue())},d._hasEvent(f,Constants.DataItemEvents.CHANGE,d._cartDataChange)||f.addEvent(Constants.DataItemEvents.CHANGE,d._cartDataChange);var i=g.createDataItem({_type:"JoinedCart",cart:f.getValue(),checkout:h.getValue()},d._environment);d._prepareInnerCompsLogic(b,c,f),c.showView(i,a,d._getEventsHandlers(),d._getViewVars()),f.getChildValue("preloadShipping")&&d._shippingLogic._initializeShippingData(),d.pushProduct()})},pushProduct:function(){var a=this,b=this.OUTER_DEFAULT_CATEGORY;this._dataProvider.getCategoryProducts(b,{success:function(b){a._category=b;var c=a._category.getChildValue("items")[0].productItems[0].id;c&&a._cartAPI.addProduct(c)}})}})}),define.experiment.Class("ecommerce.parts_logic.EcomProductsListLogic.EcomOutOfStock",function(a){var b=a;b.methods({_getViewVars:function(a){return{originalViewName:a,expOutOfStockOpen:!0}}})}),define.experiment.newClass("ecommerce.parts_logic.FeedbackMessageLogic.EcomFeedbackMrg",function(a){var b=a;b.resources(["W.Commands","W.Viewer","W.Utils"]),b.utilize(["ecommerce.core.InfrastructureUtils","ecommerce.converters.EcomProductItemConverter"]),b.binds(["_gotoPageAfterHashChange"]),b.statics({CLOSE_PRODUCT:"closeProduct",SHOW_FEEDBACK:"showFeedback",VIEW_NAME:"FeedbackMessage"}),b.fields({_isVisible:!1}),b.methods({initialize:function(a,b,c){this._environment=a,this._utils=new this.imports.InfrastructureUtils,this._productItemConverter=new this.imports.EcomProductItemConverter,this._localizer=b,this._logger=c,this._behaviors=[{value:this.CLOSE_PRODUCT,label:this._localizer.localize("ECOM_FEEDBACK_MSG_CLOSE_ZOOM_OPT_LABEL")},{value:this.SHOW_FEEDBACK,label:this._localizer.localize("ECOM_FEEDBACK_MSG_SHOW_FEEDBACK_OPT_LABEL")}]},hasFeedbackMessage:function(){var a=this._environment.getAppPart().getLogicParams();return a&&a.afterAddProduct?a.afterAddProduct==this.SHOW_FEEDBACK:!1},showFeedbackMessage:function(a){this._isVisible=!0,this._productItem=this.getProductItem(a);var b=this._getEventsHandlers(),c=this._environment.getAppPart();c.$view.setStyle("opacity","0"),c.showView(this._productItem,this.VIEW_NAME,b)},_getEventsHandlers:function(){return{"continue-shopping":function(){this._logger.sendEcomEvent(this._logger.FEEDBACK_MSG_CONTINUE_SHOPPING_BTN_CLICKED,{c1:this._productItem.getChildValue("id")}),this.closeFeedbackMsg()}.bind(this),"goto-checkout":function(){this._logger.sendEcomEvent(this._logger.FEEDBACK_MSG_CHECKOUT_BTN_CLICKED,{c1:this._productItem.getChildValue("id")}),this._navigateToCartPage()}.bind(this)}},isVisible:function(){return this._isVisible},closeFeedbackMsg:function(){this._isVisible=!1,this.resources.W.Commands.executeCommand("WViewerCommands.MediaZoom.Close",null,this)},_navigateToCartPage:function(){var a=this._getCartPageId(),b=!!W.Data.getDataByQuery("#"+a);a&&b&&this.resources.W.Utils.hash.addEvent("change",this._gotoPageAfterHashChange),this.closeFeedbackMsg()},_gotoPageAfterHashChange:function(a){if(a.isForSureAfterChange){var b=this._getCartPageId();this.resources.W.Utils.hash.removeEvent("change",this._gotoPageAfterHashChange),this.resources.W.Viewer.goToPage(b)}},_getCartPageId:function(){var a=this._environment.getAppPart().getLogicParams(),b=a&&a.cartPageID;return b},generateSettingsPanel:function(a,b){var c=this._environment.getAppPart().getMainProxy().getViewContext(),d=c.getEnvironment().getViewName();d==this.VIEW_NAME?this._updateFeedbackSettingsPanel(a,b):this._updateProductSettingsPanel(a,b)},_updateProductSettingsPanel:function(a,b){var c=this,d=b.get("appLogicParams"),e=d.afterAddProduct&&d.afterAddProduct.value||this._behaviors[0].value;a.addComboBoxField(this._localizer.localize("ECOM_FEEDBACK_MSG_BEHAVIOR_PANEL_LABEL"),this._behaviors).setValue(e).addEvent("inputChanged",function(a){d.afterAddProduct={type:"AppPartParam",value:a.value},a.value==c.CLOSE_PRODUCT?f.collapse():f.uncollapse(),c._fireDataChangePreventRerender(b)});var f=a.addButtonField("",this._localizer.localize("ECOM_FEEDBACK_MSG_STYLE_FEEDBACK_PAGE_BTN_LABEL"));f.addEvent("click",function(){var a=c._environment.getAppPart().getMainProxy().getData();c.showFeedbackMessage(a)}),e==this.CLOSE_PRODUCT&&f.collapse()},_updateFeedbackSettingsPanel:function(a,b){var c=this,d=this._utils.getSitePages(),e=b.get("appLogicParams"),f=e.cartPageID&&e.cartPageID.value||"";a.addComboBoxField(this._localizer.localize("ECOM_FEEDBACK_MSG_CHOOSE_PAGE_DESC_LABEL"),d).setValue(f).addEvent("inputChanged",function(a){e.cartPageID={type:"AppPartParam",value:a.value},c._fireDataChangePreventRerender(b)}),this._listenToOrientationChange()},_fireDataChangePreventRerender:function(a){var b=this._environment.getAppPart();b.setPreventLogicRun(!0),a.fireDataChangeEvent(),b.setPreventLogicRun(!1)},_listenToOrientationChange:function(){var a=this._environment.getAppPart(),b=a.getMainProxy().getViewContext().getEnvironment(),c=b.getVar("msgOrientation");c&&c.addEvent(Constants.DataItemEvents.CHANGE,function(){a.invalidateAppPartSize()})},getProductItem:function(a){var b=this._productItemConverter.convertFromProductBundle(a.getValue());b.options=b.options?this._getSelectedOptions(b.options):[];var c=this._utils.createDataItem(b,this._environment);return c},_getSelectedOptions:function(a){var b=[];return a.forEach(function(a){if(a.isSelectableList&&a.items&&a.items.length){var c=a.selectedValue;if(c>-1){var d=_.find(a.items,function(a){return a.value==c});b.push(d.description||d.text)}else b.push(a.items[0].description||a.items[0].text)}else a.text&&b.push(a.text)}),b}})}),define.experiment.Class("ecommerce.parts_logic.ProductBundleLogic.EcomFeedbackMrg",function(a,b){var c=a,d=b;c.utilize(d.merge(["ecommerce.parts_logic.FeedbackMessageLogic"])),c.resources(d.merge(["W.Viewer"])),c.binds(["_handleBuyProductError"]),c.methods({initialize:d.after(function(){this._feedbackLogic=new this.imports.FeedbackMessageLogic(this._environment,this._localizer,this._logger),this._environment.isMobile()&&(this.preventGeneratingSettingsPanel=!0),this._cartAPI.addEvent("EcomCartAPI.requestError",this._handleBuyProductError)}),_handleBuyProduct:function(a){var b=a.getChildByRef("options"),c=this._validateProductOptions(b),d=this._optionsItemsRelations._selectedOptions.map(function(a){return a.selectedOptionId}),e=this._optionsItemsRelations.getProductItem(a,d);if(e&&c){var f=this._getTextOptionsParams(b),g=e.getChildValue("id");this._cartAPI.addProduct(g,f),this._logger.sendEcomEvent(this._logger.PRODUCT_PAGE_ADD_PRODUCT_TO_CART,{c1:g}),this._feedbackLogic.hasFeedbackMessage()&&!this._environment.isMobile()?(this._feedbackLogic.showFeedbackMessage(a),this.resources.W.Viewer.getZoomHandler().hideNextPrevButtons()):this.resources.W.Commands.executeCommand("WViewerCommands.MediaZoom.Close",null,this)}},_handleBuyProductError:function(){this._feedbackLogic.isVisible()&&this._feedbackLogic.closeFeedbackMsg()},generateSettingsPanel:function(a,b){this._feedbackLogic.generateSettingsPanel(a,b)}})}),define.experiment.Class("ecommerce.parts_logic.ProductBundleLogic.EcomOutOfStock",function(a){var b=a;b.methods({_getViewVars:function(a){return{originalViewName:a,expOutOfStockOpen:!0}}})}),define.experiment.Class("ecommerce.parts_logic.ProductBundleLogic.WixAppsGalleryField",function(a){var b=a;b.methods({_handleImageSelectedFromSliderGallery:function(a,b){var c=b.cause,d=b.sender.getCompLogic().getDataItem().get("items"),e=d.indexOf("#"+c.get("id"));if(e>-1){var f=a.getChildValue("mediaItems")[e],g=a.getChildByRef("productMedia");g.setValue(f)}}})}),define.experiment.skin("ecommerce.skins.mcom.MobileColorOptionSkin.EcomExp7",function(a){var b=a;b.skinParams([{id:"tdr",type:Constants.SkinParamTypes.URL,defaultTheme:"BASE_THEME_DIRECTORY"}]),b.css([" { position:relative; margin:0 7px 7px 0; display:inline-block; width:47px; height:50px; border: solid 1px #8e8e8e;}","%.selectedFrame% { position:absolute; top:0; right:0; bottom:0; left:0;  }",'[state~="selected"] %.selectedFrame% { position:absolute; top:0; right:0; bottom:0; left:0; background:transparent url([tdr]wix_apps/smallcheck.png) no-repeat 50% 50%; background-size:22px 21px;}','[state~="disabled"] { display:none; }',"%description% { display:none; }"])}),define.experiment.skin("ecommerce.skins.mcom.MobileRemoveButton.EcomExp7",function(a){var b=a;b.skinParams([{id:"tdr",type:Constants.SkinParamTypes.URL,defaultTheme:"BASE_THEME_DIRECTORY"},{id:"txt",type:Constants.SkinParamTypes.COLOR,defaultValue:"#373737"},{id:"pos",type:Constants.SkinParamTypes.OTHER,defaultValue:"position:absolute; top:0; bottom:0; left:0; right:0;"}]),b.css([" { cursor:pointer; }","%link% {display:block; [pos] color:[txt]; border:1px solid [txt]; background:#fff url([tdr]close.gif) no-repeat 50% 50%; font-size:23px; font-weight:bold; line-height:30px; text-align:center; }","%label% { width:100%; height:100%; }"])}),define.experiment.skin("ecommerce.skins.mcom.MobileSelectOptionsListSkin.EcomExp7",function(a){var b=a;b.css([" { position:relative; }","%itemsContainer% { white-space: normal;}","%.tipContainer% { text-align:center; position:absolute; top:-57px; left:0; right:0; }","%tooltip% {display:inline-block; padding:12px 15px; min-width:33px; [bg] [rd] color:#ffffff; font-size:15px; margin:0 auto;}",'[state~="displayed"] %tooltip% { opacity:1; [trans]  }','[state~="hidden"]    %tooltip% { opacity:0; [trans1] }'])}),define.experiment.skin("ecommerce.skins.mcom.MobileTextOptionSkin.EcomExp7",function(a){var b=a;b.skinParams([{id:"tdr",type:Constants.SkinParamTypes.URL,defaultTheme:"BASE_THEME_DIRECTORY"}]),b.html('<p skinPart="description"></p><p skinPart="size" class="txtOpt"></p><p class="selectedCheckmark"></p>'),b.css(["{ background:#ffffff; color:#000000; padding:0 7px; margin:0 7px 7px 0; min-width:33px; height:50px; font-size:13px; line-height:50px; display:inline-block; border:solid 1px #8e8e8e; text-align:center; position:relative; }",'[state~="selected"] %.selectedCheckmark% { position:absolute; top:0; right:0; bottom:0; left:0; background:rgba(30, 30, 30, 0.5) url([tdr]wix_apps/smallcheck.png) no-repeat 50% 50%; background-size:22px 21px;}','[state~="selected"] %size% { display:inline;}','[state~="disabled"] { display:none; }',"%description% { display:none; }","%size% { cursor: default; }"])});