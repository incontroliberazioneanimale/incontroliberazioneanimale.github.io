define.deployment("automation.deployment",function(a){function b(){var a=Q.makePromise.prototype.then;Q.makePromise.prototype.then=function(b,c,d,e){var f=_.toArray(arguments);return"string"==typeof b&&(f[1]=function(a){return window.automation&&automation.Logger&&automation.Logger.log&&automation.Logger.log(b),c(a)},d&&(f[2]=function(a){return window.automation&&automation.Logger&&automation.Logger.log&&automation.Logger.log(b),d(a)}),e&&(f[3]=function(a){return window.automation&&automation.Logger&&automation.Logger.log&&automation.Logger.log(b),e(a)}),f.shift()),a.apply(this,f)}}a.atPhase(PHASES.TEST,function(a){function c(a,b){if("object"!=typeof b)return[a];var d=[];for(var e in b)d=d.concat(c(e,b[e]));return d.map(function(b){return a+"."+b})}if(self==top){var d=c("automation",define._definitions.Class.automation);d.forEach(function(b){a.createClassInstance(b,b)}),b(),resource.getResources(d,function(){automation.Utils.setDriversNameSpaces(d)})}})}),define.Class("automation.Component",function(a){var b=a;b.resources(["W.Editor","W.CommandsNew","W.Commands","W.Preview"]),b.inherits("automation.WebElement"),b.fields({componentEdges:{TOP:"top",TOP_RIGHT:"topRight",RIGHT:"right",BOTTOM_RIGHT:"bottomRight",BOTTOM:"bottom",BOTTOM_LEFT:"bottomLeft",LEFT:"left",TOP_LEFT:"topLeft"}}),b.methods({isReady:function(){return!0},waitForComponentReady:function(a){var b=Q.defer();return a.isReady()&&b.resolve(a),automation.controllers.Events.waitForEvent(a,"componentReady").then(function(){b.resolve(a)}),b.promise},waitForComponentRemove:function(a){return this._isCompAlive(a)?automation.controllers.Events.waitForEvent(a,"exterminating"):Q.resolve(a)},_isCompAlive:function(a){return a.$alive},waitForComponentResizeEnd:function(a){return automation.controllers.Events.waitForEvent(a,"resizeEnd")},waitForCompNodeReady:function(a){return this._createWaitForCompNodeReady(a)()},_createWaitForCompNodeReady:function(a){return automation.Utils.createQWaiter(function(){return this.isCompReady(a)}.bind(this),null,"waiting for comp node "+a+" to be ready")},isCompReady:function(a){return a&&a.$logic?a.$logic.NEW_BASE_COMP?"ready"===a.$logic.getComponentStatus():a.$logic.isReady&&a.$logic.isReady():!1},waitForComponentState:function(a,b){var c=function(a){var c=a.newState.split(/\s+/);return _.contains(c,b)},d=a.getState();return c({newState:d})?Q.resolve(d):automation.controllers.Events.waitForEvent(a,"stateChange",c).then(function(a){return Q.resolve(a.payload.newState)})},getComponentOfType:function(a,b){var c=this.waitForElementToExist(b,"[comp='"+a+"']");return c},getExactNumberOfComponentsType:function(a,b,c){var d=this.waitForExactNumberOfElementsToExist(b,"[comp='"+a+"']",c);return d},selectComponent:function(a){if(a===this.resources.W.Editor.getSelectedComp())return Q.resolve(a);var b=this.waitForSelectionChange(!0,function(b){return b.comp===a});return this.resources.W.Editor.setSelectedComp(a),b},getSelectedComponent:function(){return Q.resolve(this.resources.W.Editor.getSelectedComp())},deleteSelectedComponent:function(){var a=automation.controllers.Events.waitForEvent(this.resources.W.Editor,"onComponentDelete");return this.resources.W.Editor.doDeleteSelectedComponent(!0),a},getContainingComponent:function(a){return a&&a!==document&&a!==window?a.attributes&&a.attributes.comp?a.getLogic&&a.getLogic():a.parentElement?this.getContainingComponent(a.parentElement):null:null},waitForSelectionChange:function(a,b){var c=this,d=Q.defer(),e={onSuccess:function(f){if(!(a&&!f.comp||b&&!b(f))){c.resources.W.CommandsNew.unregisterListener(e);var g="array"===typeOf(f.comp)?f.comp[0]:f.comp;d.resolve(g)}}};return this.resources.W.Commands.registerCommandAndListener("WEditorCommands.SelectedComponentChange",e,e.onSuccess,null,!0),d.promise},setSkinForComponent:function(a,b){var c=a,d=this._getComponentCurrentStyleId(c);return this._setSkinForStyleId(d,b)},_getComponentCurrentStyleId:function(a){return a.getStyle().getDataItem().get("id")},_setSkinForStyleId:function(a,b){var c=Q.defer(),d=this.resources.W.Preview.getPreviewManagers();return d.Skins.getSkin(b,function(b){var e=d.Theme._styleCache[a];e?(e.setSkin(b),c.resolve()):c.reject("skinParam mapper is not defined for styleId="+a)}),c.promise},resizeComponent:function(a,b,c){var d,e,f,g=this.getElementPosition(a),h=a.$view.getSize(),i=5,j={x:{left:g.x-i,center:g.x+Math.floor(h.x/2),right:g.x+h.x+i},y:{top:g.y-i,middle:g.y+Math.floor(h.y/2),bottom:g.y+h.y+i}};switch(c){case this.componentEdges.TOP:d={x:j.x.center,y:j.y.top};break;case this.componentEdges.TOP_RIGHT:d={x:j.x.right,y:j.y.top};break;case this.componentEdges.RIGHT:d={x:j.x.right,y:j.y.middle};break;case this.componentEdges.BOTTOM_RIGHT:d={x:j.x.right,y:j.y.bottom};break;case this.componentEdges.BOTTOM:d={x:j.x.center,y:j.y.bottom};break;case this.componentEdges.BOTTOM_LEFT:d={x:j.x.left,y:j.y.bottom};break;case this.componentEdges.LEFT:d={x:j.x.left,y:j.y.middle};break;case this.componentEdges.TOP_LEFT:d={x:j.x.left,y:j.y.top}}return e=this._addOffsetToPosition(d,b),f=automation.editorcomponents.EditBox.getEditBoxKnobElm(c),automation.controllers.Mouse.clickAndDrag(f,d,e,a)},_addOffsetToPosition:function(a,b){return{x:(a.x||0)+(b.x||0),y:(a.y||0)+(b.y||0)}},___dummyForJSDoc___:function(){}})}),define.Class("automation.Logger",function(a){var b=a;b.resources([]),b.binds([]),b.fields({testLogs:{}}),b.methods({isReady:function(){return!0},log:function(a){var b=(window.jasmine&&jasmine.getEnv&&jasmine.getEnv(),this._getCurrentSuiteName()),c=this._getCurrentSpecName();this.testLogs[b]=this.testLogs[b]||{},this.testLogs[b][c]=this.testLogs[b][c]||[],this.testLogs[b][c].push({message:a,time:new Date})},clear:function(){this.testLogs={}},toConsole:function(){var a=console._oldConsole||console;_.forEach(this.testLogs,function(b,c){a.groupCollapsed(c),_.forEach(b,function(b,c){a.groupCollapsed(c),_.forEach(b,function(b){a.log(b.message+" ("+b.time+")")}),a.groupEnd()}),a.groupEnd()})},_getJasmineEnv:function(){return jasmine&&jasmine.getEnv&&jasmine.getEnv()},_getCurrentSuiteName:function(){var a=this._getJasmineEnv();return a&&a.currentSpec&&a.currentSpec.suite&&a.currentSpec.suite.description||"NOSUITE"},_getCurrentSpecName:function(){var a=this._getJasmineEnv();return a&&a.currentSpec&&a.currentSpec.description||"NOSPEC"}})}),define.Class("automation.Utils",function(a){var b=a;b.fields({_nameSpaces:[]}),b.methods({isReady:function(){return!0},setDriversNameSpaces:function(a){this._nameSpaces=a},findDriver:function(a){return this._nameSpaces.filter(function(b){return~b.toLowerCase().indexOf(a.toLowerCase())}).join("\n")},pass:function(){expect(!0).toBeTruthy()},createQWaiter:function(a,b,c){b=b||1e4;var d=0,e=100,f=function(f){function g(){d+=e;var i=a();i?h.resolve("boolean"==typeof i?f:i):d>=b?h.reject(new Error("timeout exceeded: "+(c||"(no message)"))):setTimeout(g,e)}var h=Q.defer();return g(),h.promise};return f},waitsForPromise:function(a,b){b=b||4e3;var c=a();if(!c||!c.inspect)throw"waitsForPromise: The closure must return a promise";return waitsFor(function(){var a=c.inspect();if("rejected"===a.state)throw a.reason;return"fulfilled"===a.state},"Time out",b),c},waitForPromiseNotToResolve:function(a){return this.waitsForPromise(function(){var b=Q.defer();return a().then(function(){b.reject(new Error("Promised resolved! Failing"))}),setTimeout(b.resolve,100),b.promise})},___dummyForJSDoc___:function(){}})}),define.Class("automation.WebElement",function(a){var b=a;b.binds(["waitForExactNumberOfElementsToExist"]),b.methods({isReady:function(){return!0},getWebElement:function(a,b){return a.getElement(b)},getElementByAttribute:function(a,b,c){return this.waitForElementToExist(c,"["+a+"='"+b+"']")},getWebElements:function(a,b){return a.getElements(b)},doesElementsOfExactNumberExist:function(a,b,c){var d=this.getWebElements(a,b);return d.length===c?d:!1},_createWaitForElementToExist:function(a,b){return automation.Utils.createQWaiter(function(){return this.getWebElement(a,b)}.bind(this))},_createWaitForExactNumberElementsToExist:function(a,b,c,d){return automation.Utils.createQWaiter(function(){return this.doesElementsOfExactNumberExist(a,b,c)}.bind(this),d)},waitForElementToExist:function(a,b){return this._createWaitForElementToExist(a,b)()},waitForOneOfTheElementsToContainCssTextOfType:function(a,b){return this._createwaitForOneOfTheElementsToContainCssTextOfType(a,b)()},_createwaitForOneOfTheElementsToContainCssTextOfType:function(a,b){return automation.Utils.createQWaiter(function(){var c=_.find(a,function(a){return a.style.cssText.contains(b)});return c}.bind(this))},waitForExactNumberOfElementsToExist:function(a,b,c,d){return this._createWaitForExactNumberElementsToExist(a,b,c,d)()},doesWebElementHaveInnerText:function(a){return a.innerText},waitForElementWithToHaveInnerText:function(){var a=this;return function(){var b=arguments;return automation.Utils.createQWaiter(function(){return a.doesWebElementHaveInnerText.apply(a,b)}.bind(a))}.apply(a,arguments)()},waitForElementWithCondition:function(a,b,c){var d=this;return automation.Utils.createQWaiter(function(){var e=d.getWebElements(a,b),f=!1;return _.forEach(e,function(a){c(a)&&(f=a)}),f}.bind(this))()},isVisible:function(a){return"hidden"!=a.getStyle("visibility")&&!_.isEqual(a.getDimensions(),{x:0,y:0,width:0,height:0})},getElementPosition:function(a){return this.resources.W.Preview.previewToEditorCoordinates(a.$view.getPosition(),!0)},___dummyForJSDoc___:function(){}})}),define.Class("automation.controllers.Animations",function(a){var b=a;b.resources(["W.Commands","W.Preview"]),b.methods({isReady:function(){return!0},openAnimationDialog:function(){return W.Commands.executeCommand("WEditorCommands.ShowAnimationDialog"),automation.editorcomponents.Dialogs.waitForDialogOfType("wysiwyg.editor.components.dialogs.AnimationDialog")},waitForAnimationStart:function(a,b){return automation.controllers.Events.waitForCommandWithCondition("TweenEngine.AnimationStart",a,b)},waitForAnimationComplete:function(a,b){return automation.controllers.Events.waitForCommandWithCondition("TweenEngine.AnimationComplete",a,b)},scrollToY:function(a,b){var a,c,d=Q.defer(),e=0,f=5;return b=b||{},deltaY=b.deltaY?b.deltaY:50,delay=b.delay?b.delay:null,context=b.previewContext?W.Preview.getPreviewSite():window,c=setInterval(function(){e>a&&(clearInterval(c),delay?setTimeout(d.resolve,delay):d.resolve()),context.scrollTo(0,e+=deltaY)},f),d.promise},___dummyForJSDoc___:function(){}})}),define.Class("automation.controllers.Clipboard",function(a){var b=a;b.resources(["W.ClipBoard"]),b.methods({isReady:function(){return!0},copy:function(a){var b=a;return _.isArray(a)&&(b={isMultiSelect:!0,comps:a,getSelectedComps:function(){return a}}),this.resources.W.ClipBoard.setClip(b),Q.resolve()},paste:function(){var a=automation.Component.waitForSelectionChange();return this.resources.W.ClipBoard.paste(),a},___dummyForJSDoc___:function(){}})}),define.Class("automation.controllers.Events",function(a){var b=a;b.resources(["W.Commands"]),b.methods({isReady:function(){return!0},waitForEvent:function(a,b,c){c=c||function(){return!0};var d=Q.defer(),e=function(f){c(f)&&(a.removeEvent&&a.removeEvent(b,e),a.off&&a.off(b,this,e),d.resolve({target:a,payload:f}))};return a.addEvent&&a.addEvent(b,e),a.on&&a.on(b,this,e),d.promise},waitForAppPartEvent:function(a,b,c){var d=Q.defer(),e={onSuccess:function(f){c()&&(a.getEventDispatcher().removeEvent(b,e.onSuccess),d.resolve({target:a,payload:f}))}};return c&&c()?d.resolve({target:a}):(c=c||function(){return!0},a.getEventDispatcher().addEvent(b,e.onSuccess)),d.promise},waitForCommand:function(a,b){return this.waitForCommandWithCondition(a,null,b)},waitForCommandWithCondition:function(a,b,c){b=b||function(){return!0};var d=c?W.Preview.getPreviewManagers():W,e=d.Commands.getCommand(a)||d.CommandsNew.getCommand(a),f=Q.defer(),g=function(a){b(a)&&(e.unregisterListener(this),f.resolve(a))};return e.registerListener(this,g),f.promise},waitForRenderFrame:function(){var a=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,1e3/60)}}(),b=Q.defer();return a(function(){b.resolve()}),b.promise},___dummyForJSDoc___:function(){}})}),define.Class("automation.controllers.Mouse",function(a){var b=a;b.resources(["W.Preview","W.Editor"]),b.fields({_mouseEventsEnum:{MOUSEDOWN:"mousedown",MOUSEUP:"mouseup",MOUSEOVER:"mouseover",MOUSEMOVE:"mousemove",MOUSEOUT:"mouseout"},componentEdges:{TOP:"top",TOP_RIGHT:"topRight",RIGHT:"right",BOTTOM_RIGHT:"bottomRight",BOTTOM:"bottom",BOTTOM_LEFT:"bottomLeft",LEFT:"left",TOP_LEFT:"topLeft"}}),b.methods({isReady:function(){return!0},_createMouseEventSync:function(a,b,c,d,e,f){var g=document.createEvent("MouseEvents");return g.initMouseEvent(a,!0,!0,window,1,b,c,d,e,!1,!1,!1,!1,f||0,null),g},_getMouseEventCatcherElement:function(){var a;return this.mouseEventCatcherElement||(a=this.resources.W.Editor.getEditorUI().getEditLayer().getSkinPart("mouseEventCatcher"),this.mouseEventCatcherElement=a.getSkinPart("catcher")),this.mouseEventCatcherElement},mouseEventOnCompSync:function(a,b){var c=a.$view,d=this.resources.W.Preview.previewToEditorCoordinates(c.getPosition(),!0),e=d.x+a.getWidth()/2,f=d.y+a.getHeight()/2,g=this._createMouseEventSync(b,e,f,e,f,0);this._getMouseEventCatcherElement().dispatchEvent(g)},clickAndDragToPosSync:function(a,b,c){var d=a.$view.getPosition(),e=b-d.x,f=c-d.y;this.clickAndDragByDeltaSync(a,e,f)},clickAndDragByDeltaSync:function(a,b,c){var d=this.resources.W.Preview.previewToEditorCoordinates(a.$view.getPosition(),!0),e=this.resources.W.Editor.getEditingFrame(),f={x:d.x+a.getWidth()/2,y:d.y+a.getHeight()/2},g={x:f.x+b,y:f.y+c},h=this._createMouseEventSync("mousedown",f.x,f.y,f.x,f.y,0),i=this._createMouseEventSync("mousemove",g.x,g.y,g.x,g.y,0),j=this._createMouseEventSync("mouseup",g.x,g.y,g.x,g.y,0),k=this._getMouseEventCatcherElement(),l=document.body;this.resources.W.Editor.getEditedComponent()===a?e.$view.dispatchEvent(h):k.dispatchEvent(h),l.dispatchEvent(i),l.dispatchEvent(j)},clickAndDragByDeltaWithAnchorsSync:function(){},resizeCompSync:function(){},___dummyForJSDoc___:function(){},_isKnobElm:function(a){return a&&"P"===a.nodeName&&a.className&&a.className.indexOf("knob")>-1}})}),define.Class("automation.controllers.Pages",function(a){var b=a;b.resources(["W.Commands"]),b.binds(["goToPage","getHomePageIdSync"]),b.fields({_viewerManager:void 0}),b.methods({isReady:function(){return!0},_getViewerManagerSync:function(){return this._viewerManager=this._viewerManager||W.Viewer||W.Preview.getPreviewManagers().Viewer,this._viewerManager},_getDataManagerSync:function(){this._dataManager=this._dataManager||W.Preview?W.Preview.getPreviewManagers().Data:W.Data},getPagesSync:function(){return this._getViewerManagerSync().getPages()},getPagesIdsSync:function(){return _.keys(this.getPagesSync())},waitForPageTransitionEnd:function(){var a=this;return automation.controllers.Events.waitForEvent(this._getViewerManagerSync(),"pageTransitionEnded").then(function(){var b=a.getCurrentPageIdSync(),c=a.getCurrentPageNodeSync().$logic.getDataItem().get("title");return{pageId:b,pageDisplayName:c}})},goToPage:function(a){if(this.getCurrentPageIdSync()===a)return Q.resolve();var b=this.waitForPageTransitionEnd();return this._getViewerManagerSync().goToPage(a),b},goToRandomPage:function(){var a=this.getCurrentPageIdSync(),b=this.getPagesIdsSync(),c=_.find(b,function(b){return b!==a});return this.goToPage(c)},getHomePageIdSync:function(){return this._getViewerManagerSync().getHomePageId()},getCurrentPageIdSync:function(){return this._getViewerManagerSync().getCurrentPageId()},getCurrentPageNodeSync:function(){return this._getViewerManagerSync().getCurrentPageNode()},deletePage:function(a){var b=this.getPageByIdSync(a);if(!b)return Q.reject("deletePage for page "+a+" failed");var c=automation.editorcomponents.Dialogs.waitForDialogOfType("core.editor.components.dialogs.MessageDialog").then(function(a){return automation.editorcomponents.Dialogs.findDialogWindow(a)}).then(function(a){var b=automation.controllers.Events.waitForCommand("WViewerCommands.PageTransitionComplete",!0),c=automation.controllers.Events.waitForCommand("WEditorCommands.DeletePageCompleted");return a.$logic.triggerConfirmButton(),Q.all([c,b])});return this.resources.W.Commands.executeCommand("WEditorCommands.DeletePage",b.$logic.getDataItem()),c},duplicatePage:function(){throw new Error("duplicatePage has not been implemented yet. Please implement it if you need to use it!")},getSubPagesSync:function(a){var b=this._getDataManagerSync(),c=b.getDataByQuery("#MAIN_MENU"),d=[],e=[],f=this,g=_.find(c.getItems(),function(b){return b.getData().refId==="#"+a});return g&&(d=g.get("items"),_.forEach(d,function(a){var b=a.getData().refId.replace("#","");e.push(f.getPageByIdSync(b))})),e},getProtectedPagesSync:function(){var a=this.getPagesSync(),b={};_.forEach(a,function(a,c){var d=a.$logic,e=d.getDataItem().get("pageSecurity");(e.passwordDigest||e.requireLogin)&&(b[c]=a)},this)},getPageByIdSync:function(a){return this.getPagesSync()[a]},getPageBySlug:function(){throw new Error("getPageBySlug has not been implemented yet. Please implement it if you need to use it!")},addPageByPageTemplateID:function(a,b){var c=Q.defer(),d={pageTemplateId:a,pageName:b,callback:function(a){c.resolve(a)}};return W.Commands.executeCommand("WEditorCommands.AddPageByPageTemplateId",d),c.promise.timeout(3500)},___dummyForJSDoc___:function(){}})}),define.Class("automation.controllers.Save",function(a){var b=a;b.resources(["W.Commands","W.ServerFacade"]),b.methods({isReady:function(){return!0},_failSaveIfNeeded:function(a){a&&a===!0&&(spyOn(this.resources.W.ServerFacade,"cloneDocument").andCallFake(function(a,b,c,d,e){e("it error")}),spyOn(this.resources.W.ServerFacade,"saveDocument").andCallFake(function(a,b,c,d){d("it error")}))},firstSave:function(a){var b="S"+Math.floor(1e10*Math.random());this._failSaveIfNeeded(a);var c=Q.defer();return Q.fulfill().then(function(){return automation.editorcomponents.Dialogs.waitForDialogOfType("wysiwyg.editor.components.dialogs.SaveDialog")}).then(function(a){var c=a.$view.getElement("[comp=wysiwyg.editor.components.inputs.Input]").getLogic();return c.setValue(b),c._fireKeyUp({}),a}).then(function(a){return a._onSaveClick()}).then(function(){automation.editorcomponents.Dialogs.waitForDialogOfType("wysiwyg.editor.components.dialogs.SaveSuccessDialog").then(function(a){a.getParentComponent().closeDialog(),c.resolve()}),automation.editorcomponents.Dialogs.waitForDialogOfType("core.editor.components.dialogs.MessageDialog").then(function(a){"fulfilled"!==c.promise.inspect().state&&(a.getParentComponent().closeDialog(),c.reject(new Error("First Save Error - save failed dialog opened")))})}),this.resources.W.Commands.executeCommand("WEditorCommands.Save"),c.promise},save:function(a){this._failSaveIfNeeded(a);var b=Q.defer();return automation.editorcomponents.Dialogs.waitForDialogOfType("core.editor.components.dialogs.MessageDialog").then(function(a){"fulfilled"!==b.promise.inspect().state&&(a.getParentComponent().closeDialog(),b.reject(new Error("Save Error - save failed dialog opened")))}),automation.editorcomponents.Dialogs.waitForDialogWithTitle("Your work was saved").then(function(a){a.getParentComponent().closeDialog(),b.resolve()}),this.resources.W.Commands.executeCommand("WEditorCommands.Save",{promptResultDialog:!0,src:"it"}),b.promise},publish:function(){var a=Q.defer();return automation.editorcomponents.Dialogs.waitForDialogOfType("wysiwyg.editor.components.dialogs.PublishWebsiteDialog").then(function(a){a._onPublishNowClick()}).then(function(){automation.editorcomponents.Dialogs.waitForDialogOfType("wysiwyg.editor.components.dialogs.PublishWebsiteSuccessDialog").then(function(b){b.getParentComponent().closeDialog(),automation.editorcomponents.Dialogs.waitForDialogOfType("wysiwyg.editor.components.dialogs.PublishWebsiteShareDialog").then(function(a){a.getParentComponent().closeDialog()}),a.resolve()}),automation.editorcomponents.Dialogs.waitForDialogOfType("core.editor.components.dialogs.MessageDialog").then(function(b){"fulfilled"!==a.promise.inspect().state&&(b.getParentComponent().closeDialog(),a.reject(new Error("Publish Error - publish failed dialog opened")))})}),this.resources.W.Commands.executeCommand("WEditorCommands.OpenPublishDialog"),a.promise},___dummyForJSDoc___:function(){}})}),define.Class("automation.controllers.States",function(a){var b=a;b.resources(["W.Config","W.Commands","W.Editor"]),b.methods({isReady:function(){return!0},changeToPreviewSync:function(){return"PREVIEW"!==this.resources.W.Config.env.$editorMode?(this.resources.W.Commands.executeCommand("WEditorCommands.WSetEditMode",{editMode:this.resources.W.Editor.EDIT_MODE.PREVIEW,src:"previewBtn"}),!0):!1},changeToEditModeSync:function(){return"PREVIEW"===this.resources.W.Config.env.$editorMode?(this.resources.W.Commands.executeCommand("WEditorCommands.WSetEditMode",{editMode:this.resources.W.Editor.EDIT_MODE.CURRENT_PAGE,previousEditMode:this.resources.W.Editor.EDIT_MODE.PREVIEW}),!0):!1},switchToMobileEditor:function(){if(this.resources.W.Config.env.$viewingDevice!==Constants.ViewerTypesParams.TYPES.MOBILE){var a=automation.controllers.Events.waitForCommand("WEditorCommands.SecondaryPreviewReady");return this.resources.W.Commands.executeCommand("WEditorCommands.SetViewerMode",{mode:Constants.ViewerTypesParams.TYPES.MOBILE},this),a}return Q.resolve()},switchToDesktopEditorSync:function(){return this.resources.W.Config.env.$viewingDevice!==Constants.ViewerTypesParams.TYPES.DESKTOP?(this.resources.W.Commands.executeCommand("WEditorCommands.SetViewerMode",{mode:Constants.ViewerTypesParams.TYPES.DESKTOP,src:"btn"}),!0):!1},___dummyForJSDoc___:function(){}})}),define.Class("automation.controllers.UndoRedo",function(a){var b=a;b.resources(["W.Commands"]),b.methods({isReady:function(){return!0},undoSync:function(){return this.resources.W.Commands.executeCommand("WEditorCommands.Undo")},redoSync:function(){return this.resources.W.Commands.executeCommand("WEditorCommands.Redo")},___dummyForJSDoc___:function(){}})}),define.Class("automation.editorcomponents.Dialogs",function(a){var b=a;b.resources(["W.EditorDialogs"]),b.binds(["findDialogWindow"]),b.methods({isReady:function(){return!0},clearDialog:function(a){var b=Q.defer();return a&&a._dialogWindow?(a._dialogWindow.closeDialog(),b.resolve()):b.reject(new Error("Cannot close dialog, undefined")),b.promise},waitForDialogWithTitle:function(a){var b=function(b){var c=b.getSkinPart("dialogTitle");return c&&c.innerText===a},c=this.createWaitForDialogWithCondition(b);return c().then(function(a){return Q.resolve(a.getInnerDialog().getLogic())})},waitForDialogOfType:function(a){var b=function(b){var c=b.getInnerDialog();return c.getLogic&&c.getLogic().$className===a},c=this.createWaitForDialogWithCondition(b);return c().then(function(a){return Q.resolve(a.getInnerDialog().getLogic())})},findDialogWindow:function(a){var b=_.find(this.resources.W.EditorDialogs._openDialogs,function(b){return b.getLogic().getInnerDialog().getLogic()==a});return b?Q.resolve(b):Q.reject(new Error("Dialog window for panel not found"))},isThereDialogWithCondition:function(a){a=a||function(){return!0};var b=this.resources.W.EditorDialogs._openDialogs,c=_.find(b,function(b){return b.getLogic&&b.getLogic().isRendered()&&a(b.getLogic())});return c&&c.getLogic()},createWaitForDialogWithCondition:function(a){return automation.Utils.createQWaiter(function(){return this.isThereDialogWithCondition(a)}.bind(this))},___dummyForJSDoc___:function(){}})}),define.Class("automation.editorcomponents.EditBox",function(a){var b=a;b.resources(["W.CommandsNew","W.Commands"]),b.methods({isReady:function(){return!0},getEditBox:function(){return document.getElement("[skinpart=componentEditBox]")},getEditBoxKnobElm:function(a){var b=a+"Knob",c=this.getEditBox();return c.getElement('[skinpart="'+b+'"]')},getEditedComponent:function(){return this.getEditBox().getLogic()._editedComponent},isEditBoxOnElement:function(a){var b=this.getEditedComponent();return b&&b.getViewNode()===a},clearSelection:function(){return console.log("not yet implemented"),Q()},waitForCompSelectionChange:function(){var a=this,b=Q.defer(),c={onSuccess:function(d){var e="array"===typeOf(d.comp)?d.comp[0]:d.comp;e&&(a.resources.W.CommandsNew.unregisterListener(c),b.resolve(e))}};return this.resources.W.Commands.registerCommandAndListener("WEditorCommands.SelectedComponentChange",c,c.onSuccess,null,!0),b.promise},___dummyForJSDoc___:function(){}})}),define.Class("automation.editorcomponents.EditorComponents",function(a){var b=a;b.inherits("automation.Component"),b.methods({isReady:function(){return!0},___dummyForJSDoc___:function(){}})}),define.Class("automation.editorcomponents.FloatingPropertyPanelDriver",function(a){var b=a;b.resources(["W.Editor"]),b.methods({isReady:function(){return!0},openFpp:function(){var a=automation.editorcomponents.EditBox.getEditBox().getPosition();return this.resources.W.Editor.openComponentPropertyPanels(a,!0,!1),Q(this.resources.W.Editor.getFloatingPanel())},closeFpp:function(){return Q(this.resources.W.Editor.hideFloatingPanel())},showCompOnAllPages:function(){this.resources.W.Editor.getFloatingPanel()._moveCurrentComponentToOtherScope()},getFppCustomActions:function(a,b){return Q(a.getSkinPart("customActions").children[b])},clickOnFppItemByLabel:function(a,b){return this.clickOnFppItem(a,function(a){return a.getLogic().getLabel()===b})},clickOnFppItem:function(a,b){return Q.resolve().then(function(){var c=a.getSkinPart("customActions").getChildren();c.each(function(a,c){return b&&b(a,c)?(a.click(),void 0):void 0})})},___dummyForJSDoc___:function(){}})}),define.Class("automation.editorcomponents.MediaGalleryDriver",function(a){var b=a;b.statics({image:{mediaType:"picture",fileName:"c6f5ea79378512d1fded46f6a618178e.jpg",uri:"c6f5ea79378512d1fded46f6a618178e.jpg",title:"Poolside Meditation ",url:"http://static.wix.com/media/c6f5ea79378512d1fded46f6a618178e.jpg",thumbnailUrl:"http://static.wix.com/media/c6f5ea79378512d1fded46f6a618178e.jpg_srz_210_210_75_22_0.5_1.20_0.00_jpg_srz",width:1e3,height:667},clipart:{mediaType:"picture",fileName:"edccbdca8e0b82507fefe62e22c23e83.png",uri:"edccbdca8e0b82507fefe62e22c23e83.png",title:"Sewing Thread",url:"http://static.wix.com/media/edccbdca8e0b82507fefe62e22c23e83.png",thumbnailUrl:"http://static.wix.com/media/edccbdca8e0b82507fefe62e22c23e83.png_srz_210_210_75_22_0.5_1.20_0.00_jpg_srz",width:168,height:102},shape:{mediaType:"picture",fileName:"shapes/f61bd1b026e05d6563cd20e86209aab5_svgshape.v1.Centipede.js",uri:"shapes/f61bd1b026e05d6563cd20e86209aab5_svgshape.v1.Centipede.js",title:"Centipede",url:"http://static.wix.com//media/shapes/f61bd1b026e05d6563cd20e86209aab5_svgshape.v1.Centipede.js",thumbnailUrl:"http://static.wix.com/shapes/597c9efb3b66a21e7799baab671df303_svgshape.v1.Centipede.svg",width:null,height:null}}),b.methods({selectResource:function(a){var b;return a=a?a.toLowerCase():"image",b="undefined"==typeof this[a]?this.image:this[a],Q(b)}})}),define.Class("automation.editorcomponents.Menu",function(a){var b=a;b.methods({isReady:function(){return!0},closeMenu:function(){return console.log("not yet implemented"),Q()},___dummyForJSDoc___:function(){}})}),define.Class("automation.editorcomponents.Panels",function(a){var b=a;b.methods({isReady:function(){return!0},closePanels:function(){return console.log("not yet implemented"),Q()},___dummyForJSDoc___:function(){}})}),define.Class("automation.editorcomponents.propertypanels.ArchivePropertyPanelDriver",function(a){var b=a;b.resources(["W.Editor"]),b.binds(["getPanel","setMonthsToShow"]),b.statics({MONTHS_TO_SHOW:{ALL:1/0,MONTHS_12:12,MONTHS_24:24}}),b.methods({isReady:function(){return!0},getPanel:function(a){var b=Q.defer(),c=this;return automation.Component.selectComponent(a).then(function(){return automation.editorcomponents.FloatingPropertyPanelDriver.openFpp()}).then(function(a){return automation.editorcomponents.FloatingPropertyPanelDriver.clickOnFppItemByLabel(a,"Settings")}).then(function(){var a=c.resources.W.Editor.getPropertyPanel().getViewNode(),b="[comp=wixapps.integration.components.editor.AppPartDataPanel]";return automation.WebElement.waitForElementToExist(a,b)}).then(function(a){var c=a.getLogic();c.runWhenReady(function(){return b.resolve(c)})}),b.promise},setMonthsToShow:function(a,b,c){var d=Q.defer(),e=function(){d.resolve(),b.removeEvent("autoSized",e)};b.addEvent("autoSized",e);var f=a._isDisposed?this.getPanel(b):Q.resolve(a);return f.then(function(a){var b=a.getViewNode();return automation.WebElement.waitForElementWithCondition(b,"[comp*=ComboBox]",function(a){return"Number Of Months To Display"===a.innerText.trim()})}).then(function(a){a=a.getLogic(),a.setValue(c),a.fireChangeEvent()}),d.promise},___dummyForJSDoc___:function(){}})}),define.Class("automation.editorcomponents.propertypanels.ListSettingsPanelDriver",function(a){a.resources(["W.Editor","W.Commands","W.AppsEditor2","W.Preview"]),a.utilize(["wysiwyg.common.components.traits.LinkableComponent"]),a.statics({PAGE_LINK_FIELDS:{TITLE:"Title",IMAGE:"Image",DATE:"Date",BUTTON:"Button",PRICE:"Price"},TABS:{ITEMS:"items",DESIGN:"design",OPTIONS:"settings"}}),a.methods({isReady:function(){return!0},getAppPartSettingsPanel:function(a){var b=Q.defer();return automation.Component.selectComponent(a).then(function(){return automation.WebElement.getElementByAttribute("comp","wixapps.integration.components.panels.ListSettingsPanel",document)}).done(function(a){var c=a.getLogic();c._manageItemPresenter.runWhenReady(function(){return b.resolve(c)})}),b.promise},copyViewFromComponent:function(a,b){var c=this;return Q.resolve().then(function(){return c.resources.W.AppsEditor2.openCopyViewDialog(a),automation.editorcomponents.Dialogs.waitForDialogOfType("wixapps.integration.components.panels.BuilderDialogPanel").then(function(a){for(var c,d=a._presenter._typeParts,e=0;e<d.length;e++){var f=d[e];f.getDisplayName()===b.getAppPartDefinition().getDisplayName()&&(c=e)}if(void 0===c)throw new Error("The components are not of the same type!");var g=a._presenter._model.getChildByRef("parts").getChildByIndex(c);return a._presenter.selectView({data:g}),a._dialogWindow.triggerConfirmButton(),Q.resolve()})})},moveItems:function(a,b,c){var d={cause:{oldIndex:b,newIndex:c}};return this.getAppPartSettingsPanel(a).then(function(a){return a._manageItemPresenter.onItemMoved(d),Q.resolve()})},showHideItem:function(a,b,c){var d,e=a.getAppInstance().getDataItemFactory(),f=e.createDataItem(c);return this.getAppPartSettingsPanel(a).then(function(a){var b=automation.editorcomponents.Dialogs.isThereDialogWithCondition();return a._manageItemPresenter.selectItems(),b}).then(function(a){d=a;var b=a.getInnerDialog();return Q.resolve(b.$logic._presenter)}).then(function(a){var c=a.getModel(),e=c.getChildByIndex(b),g={context:{_data:e},data:f};return a.onItemClick(g),d.triggerConfirmButton(),Q.resolve()})},getItems:function(a){var b=Q.defer(),c=a.getDataSelector();return c.getItems(function(a){b.resolve(a)},function(a){b.reject(a)}),b.promise},selectItem:function(a,b){var c=this;return this.getAppPartSettingsPanel(a).then(function(){var a=c.resources.W.AppsEditor2.getSelectionHandler();return a.getCurrentItemIndex()!=b&&a.setSelectedIndex(b),Q.resolve()})},addItem:function(a){var b=automation.controllers.Events.waitForCommand("WAppsEditor2Commands.AddNewDataItem");return a._manageItemPresenter.createItem(),b},addItems:function(a,b){for(var c=this,d=Q.resolve(),e=0;b>e;e++)d.then(c.addItem.bind(c,a));return d},duplicateItem:function(a,b){if(b){var c=this.resources.W.AppsEditor2.getSelectionHandler();c.getCurrentItemIndex()!=b&&c.setSelectedIndex(b)}var d=a.getDataSelector(),e=d.getItemIds().clone();return this.getAppPartSettingsPanel(a).then(function(a){var b=automation.Events.waitForEvent(d,"dataSelectorRefreshed");
return a._manageItemPresenter.duplicateItem(),b}).then(function(){var a=d.getItemIds(),b=_.difference(a,e);return 1!=b.length?Q.reject(new Error("Failed to create a new item")):Q.resolve(b[0])})},removeItem:function(a){var b=automation.controllers.Events.waitForCommand("WAppsEditor2Commands.RemoveDataItem");return a.removeItem(),b},getListTypeDisplayName:function(a){return Q.resolve(a.getAppPartDefinition().getTypeDef().displayName)},getListPartDisplayName:function(a){return Q.resolve(a.getAppPartDefinition().getDisplayName())},changeListName:function(a,b){var c=this;return this.getAppPartSettingsPanel(a).then(function(){return c.resources.W.Commands.executeCommand("WAppsEditor2Commands.SelectOptionsPanel"),automation.WebElement.waitForElementToExist(document,".wixApps2ListDisplayName")}).then(function(a){return a.getLogic().setValue(b),a.getLogic().fireChangeEvent(),Q.resolve()})},changeLibraryName:function(a,b){var c=this;return this.getAppPartSettingsPanel(a).then(function(){return c.resources.W.Commands.executeCommand("WAppsEditor2Commands.SelectOptionsPanel"),automation.WebElement.waitForElementToExist(document,".wixApps2ListTypeDisplayName")}).then(function(a){return a.getLogic().setValue(b),a.getLogic().fireChangeEvent(),Q.resolve()})},_linkPageCreation:function(a){return Q.resolve().then(function(){for(var b=0;b<a.length;b++){var c,d,e;e=W.EditorDialogs._openDialogs[0].getLogic().getInnerDialog().getLogic(),c=$$("[class*="+a[b]+"_link]")[0],c.getLogic().setChecked(!0),c.getProperty("class").split(" ").forEach(function(a){a.contains("_link")&&(d=a.split("_")[2])}),e._fieldClicked(d,!0)}return W.EditorDialogs._openDialogs[0].getLogic().triggerConfirmButton(),automation.controllers.Pages.waitForPageTransition()})},addField:function(a,b,c,d,e){a=a||this.resources.W.Editor.getSelectedComp();var f;return this.getAppPartSettingsPanel(a).then(function(a){var b=automation.editorcomponents.Dialogs.waitForDialogOfType("wixapps.intergration.components.editor.dialogs.AddFieldDialog");return a._customizeItemsPresenter.addField(),b}).then(function(a){f=a;var b=f._selectedItem;if(b&&b.getDataItem().get("text")===c)return Q.resolve();var d=_.filter(f.getViewNode().getElements("[comp*=MenuButton]"),function(a){return a.getLogic().getDataItem().get("text")===c})[0],e=automation.controllers.Events.waitForEvent(f._defaultValueDataItem,Constants.DataItemEvents.CHANGE);return d.click(),e}).then(function(){if(b){var a=f.getSkinPart("nameYourFieldInput");a.setValue(b)}if(d){var c=f.getSkinPart("positionYourFieldInput");c.setValue(d)}var g=f.getParentComponent();return e===!1?Q.resolve(g):(g.triggerConfirmButton(),Q.resolve())})},getEditFieldDialog:function(a,b){return this.getAppPartSettingsPanel(a).then(function(a){var c=a._customizeItemsPresenter.getModel(),d=_.filter(c.getChildren(),function(a){return a.getChildValue("displayName")===b});if(!d.length)return Q.reject("Can't find field with name "+b);var e=automation.editorcomponents.Dialogs.waitForDialogOfType("wixapps.integration.components.panels.EditFieldPanel");return a._customizeItemsPresenter.onFieldClicked({data:d[0]}),e})},linkToPageFromSidePanel:function(a,b){var c=this;return Q.resolve().then(function(){return c.resources.W.Commands.executeCommand("WAppsEditor2Commands.SelectOptionsPanel"),automation.WebElement.waitForElementToExist(document,".wixApps2ListTypeDisplayName")}).then(function(){return c.getAppPartSettingsPanel(a)}).then(function(a){return a._onEnablePageLinks({value:!0}),Q.delay(300)}).then(function(){return c._linkPageCreation(b)})},linkToPageFromFPP:function(a,b){var c=this;return Q.resolve().then(function(){return automation.Component.selectComponent(a)}).then(function(){return automation.editorcomponents.FloatingPropertyPanel.openFpp()}).then(function(a){var b=a.getSkinPart("customActions").getChildren();return b.each(function(a){"Options"===a.getLogic().getLabel()&&a.click()}),Q.delay(300)}).then(function(){return c.getAppPartSettingsPanel(a)}).then(function(a){return a._onEnablePageLinks({value:!0}),Q.delay(300)}).then(function(){return c._linkPageCreation(b)})},_linkItemToWebsite:function(a,b){b&&(b.link&&(a._presetWebsiteDialogData(),a.getDataItem().setFields({url:b.link})),b.openInSameWindow&&a.getDataItem().setFields({target:this.imports.LinkableComponent.linkTarget.SAME_WINDOW}))},_linkItemToPage:function(a,b){a._presetPageDialogData();var c,d=W.Preview.getPreviewManagers().Viewer.getLinkablePagesData();for(var e in d){var f=d[e],g=f.get("title");if(b.pageName===g){c=f;break}}var h=c.get("pageUriSEO"),i=c.get("id"),j="#!"+h+"/"+i;a.getDataItem().setFields({href:j})},_linkItemToEmail:function(a,b){a._presetEmailDialogData(),b&&(b.emailAddress&&a.getDataItem().setFields({href:b.emailAddress}),b.subject&&a.getDataItem().setFields({text:b.subject}))},openEditItemPanel:function(a,b){var c=this,d=a._listCursor;return b=void 0!==b?b:d.getCurrentItemIndex(),Q.resolve().then(function(){var a=Q.defer();return d.getCurrentItemIndex()===b?a.resolve():(automation.controllers.Events.waitForEvent(d,Constants.WixAppEvents.SELECTED_INDEX_CHANGED).then(function(){a.resolve()}),d.setSelectedIndex(b)),a.promise}).then(function(){var b=automation.controllers.Events.waitForCommand("WAppsEditor2Commands.OpenEditItemPanel").then(function(){return Q.resolve(a._dataEditPresenter)});return c.resources.W.Commands.executeCommand("WAppsEditor2Commands.OpenEditItemPanel",{reloadBeforeOpen:!0},c),b})},updateTags:function(a,b){b.length&&","!==_.last(b)&&(b+=",");var c=Q.defer();return automation.WebElement.getElementByAttribute("comp","wixapps.integration.components.panels.ListSettingsPanel",document).then(function(a){return automation.WebElement.getElementByAttribute("vcfield","_tags",a)}).then(function(d){var e=a._listCursor.getCurrentItemIndex(),f=a._itemsData.getChildByIndex(e),g=d.getLogic(),h=g.getDataItem();if(h.get("text")===b)c.resolve(f);else{var i=function j(){f.removeEvent(Constants.DataItemEvents.CHANGE,j),c.resolve(f)};f.addEvent(Constants.DataItemEvents.CHANGE,i),h.set("text",b)}}),c.promise},updateField:function(a,b,c){var d=Q.defer(),e=a.getModel().getChildByRef(b);if(!e)return Q.reject(b+" doesn't exist in the data item.");var f=a._listCursor.getCurrentItemIndex(),g=a._itemsData.getChildByIndex(f);return _.isEqual(e.getValue(),c)?d.resolve(g):(automation.controllers.Events.waitForEvent(g,Constants.DataItemEvents.CHANGE).then(function(){d.resolve(g)}),e.setValue(c)),d.promise},linkListItem:function(a,b,c,d,e){var f=this;return Q.resolve().then(function(){return f.getAppPartSettingsPanel(a)}).then(function(g){return f.openEditItemPanel(a,b).then(function(){var a=automation.editorcomponents.Dialogs.waitForDialogOfType("wysiwyg.editor.components.dialogs.LinkDialog");return g.getViewNode().getElements("[proxy*=DataEditFieldProxy]")[c].getViewProxy()._linkClick({mode:"add"}),a}).then(function(a){return a._setState(d),d===f.imports.LinkableComponent.linkType.WEBSITE?f._linkItemToWebsite(a,e):d===f.imports.LinkableComponent.linkType.PAGE?f._linkItemToPage(a,e):d===f.imports.LinkableComponent.linkType.EMAIL&&f._linkItemToEmail(a,e),a._dialogWindow.triggerConfirmButton(),Q.resolve()})})},togglePagination:function(a){var b,c=this,d=Q.defer(),e=a.getViewNode().getElement(".wixAppsList2"),f=e.getViewProxy().getPaginationLogic();return f.addEvent(f.PAGINATION_UPDATED,function(){d.resolve(),f.removeEvent(f.PAGINATION_UPDATED,this)}),Q.resolve().then(function(){return c.getAppPartSettingsPanel(a)}).then(function(a){return b=a,c.selectTab(a,c.TABS.DESIGN)}).then(function(){var a=b.getViewNode();return automation.WebElement.waitForElementWithCondition(a,"[comp*=CheckBox]",function(a){return"Split your list across multiple pages"===a.innerText})}).then(function(a){a=a.getLogic(),a.setValue(!a.getValue()),a.fireChangeEvent()}),d.promise},setPaginationItemsPerPage:function(a,b){var c=this,d=Q.defer(),e=a.getViewNode().getElement(".wixAppsList2"),f=e.getViewProxy().getPaginationLogic();return f.addEvent(f.PAGINATION_UPDATED,function(){d.resolve(),f.removeEvent(f.PAGINATION_UPDATED,this)}),Q.resolve().then(function(){return c.getAppPartSettingsPanel(a)}).then(function(a){var b=a.getViewNode();return automation.WebElement.waitForElementWithCondition(b,"[comp*=Slider]",function(a){return"Items Per Page"===a.innerText.trim()})}).then(function(a){a=a.getLogic(),a.setValue(b),a.fireChangeEvent()}),d.promise},selectTab:function(a,b){var c=Q.defer();if(a.tabsPresenter.getModel().getValue()===b)c.resolve();else switch(a.addEvent("viewCutsomizationsPanelUpdated",function(){c.resolve(),a.removeEvent("viewCutsomizationsPanelUpdated",this)}),b){case this.TABS.ITEMS:this.resources.W.Commands.executeCommand("WAppsEditor2Commands.SelectItemsPanel");break;case this.TABS.DESIGN:this.resources.W.Commands.executeCommand("WAppsEditor2Commands.SelectDesignPanel");break;case this.TABS.OPTIONS:this.resources.W.Commands.executeCommand("WAppsEditor2Commands.SelectOptionsPanel");break;default:c.reject()}return c.promise},___dummyForJSDoc___:function(){}})}),define.Class("automation.editorcomponents.propertypanels.TickerPropertyPanel",function(a){var b=a;b.resources(["W.Editor"]),b.methods({isReady:function(){return!0},getDataAlignmentButton:function(a){var b,c=this;return Q().then(function(){return c.getAppPartPanel()}).then(function(a){b=a;var c="[comp = wysiwyg.editor.components.inputs.InputGroup]",d="[comp = wysiwyg.editor.components.inputs.RadioImage]";return automation.WebElement.waitForExactNumberOfElementsToExist(b,c+" "+d+" [skinpart = radioIcon]",2)}).then(function(b){return automation.WebElement.waitForOneOfTheElementsToContainCssTextOfType(b,"radiobuttons/alignment/"+a+".png")})},getAppPartPanel:function(){var a=this.resources.W.Editor.getPropertyPanel().getViewNode();return automation.WebElement.waitForElementToExist(a,"[comp= wixapps.integration.components.editor.AppPartDataPanel]")},___dummyForJSDoc___:function(){}})}),define.Class("automation.viewercomponents.AppBuilderDriver",function(a){var b=a;b.resources(["W.Preview"]),b.methods({getSpecMap:function(){var a=W.Preview.getPreviewManagers().Viewer.getAppDataHandler().getAppsData(),b=_.find(a,{type:"appbuilder"});return{applicationId:b.applicationId,instanceId:b.instanceId,state:b.state}}})}),define.Class("automation.viewercomponents.AppPart2Driver",function(a){var b=a;b.resources(["W.Commands","W.AppsEditor2","W.Editor"]),b.inherits("automation.viewercomponents.ViewerComponent"),b.methods({isReady:function(){return!0},addAppPart2:function(a){a=a||"BasicPosts";var b=this,c=automation.editorcomponents.EditBox.waitForCompSelectionChange().then(function(a){return automation.Component.waitForComponentReady(a)});return this.resources.W.AppsEditor2.getAppBuilderApplicationInstance(function(c){b.resources.W.AppsEditor2._createAppPartFromTemplate(c,a,"list")}),c},addAppPart2AndCloseDialog:function(a){var b,c=Q.defer();return this.addAppPart2(a).then(function(a){b=a}).then(function(){return automation.editorcomponents.Dialogs.waitForDialogOfType("wixapps.integration.components.panels.BuilderDialogPanel")}).then(function(a){a.closeDialog(),c.resolve(b)}),c.promise},addAppPart2FromExistingType:function(a){var b=this,c=automation.editorcomponents.EditBox.waitForCompSelectionChange().then(function(a){return automation.Component.waitForComponentReady(a)});return this.resources.W.AppsEditor2.getAppBuilderApplicationInstance(function(c){b.resources.W.Commands.executeCommand("WAppsEditor2Commands.CreateAppByType",{typeName:a,appInstance:c})}),c},deleteAppPart2:function(a,b){var c,d,e=this,f=null;return c=b?Q.resolve().then(function(){return e.resources.W.Editor.setSelectedComp(a),e.resources.W.Commands.executeCommand("WEditorCommands.WDeleteSelectedComponent"),automation.editorcomponents.Dialogs.waitForDialogOfType("wixapps.integration.components.panels.BuilderDialogPanel")}).then(function(a){return f=a,d=a.getViewNode().getElement("[comp*=CheckBoxInput]"),d.wixificationState.wixifyDone?void 0:automation.controllers.Events.waitForEvent(d,Constants.ComponentEvents.WIXIFIED)}).then(function(){d.getLogic().setSelectedAndFireEvent(!0);var b=automation.Component.waitForComponentRemove(a);return f.getParentComponent().triggerConfirmButton(),b}):automation.viewercomponents.ViewerComponent.removeComponent(a,!0,"wixapps.integration.components.panels.BuilderDialogPanel")},setSelectedIndex:function(a,b){var c=this;return automation.Component.selectComponent(a).then(function(){var d=Q.defer(),e=c.resources.W.AppsEditor2.getSelectionHandler();return automation.controllers.Events.waitForCommand("WAppsEditor2Commands.SelectionChanged").then(function(){d.resolve(a)}),e.setSelectedIndex(b),d.promise})},goToPaginationPreviousPage:function(a){return automation.WebElement.waitForElementToExist(a.getViewNode(),".paginationPrev").then(function(a){return a.click(),Q.resolve()})},goToPaginationNextPage:function(a){return automation.WebElement.waitForElementToExist(a.getViewNode(),".paginationNext").then(function(a){return a.click(),Q.resolve()})},getTypeNameSync:function(a){return a.getAppPartDefinition()._type},_registerAfterAddPart2Actions:function(){var a;return Q.resolve().then(function(){return automation.editorcomponents.EditBox.waitForCompSelectionChange()}).then(function(){return automation.Component.getComponentOfType("wixapps.integration.components.AppPart2",W.Preview.getSiteNode())}).then(function(b){return a=b,automation.Component.waitForCompNodeReady(b)}).then(function(){return automation.Component.waitForComponentState(a.getLogic(),"shrink0")})},___dummyForJSDoc___:function(){}})}),define.Class("automation.viewercomponents.AppPartDriver",function(a){var b=a;b.resources(["W.Commands","W.EditorDialogs","W.AppStoreManager","W.AppsEditor"]),b.inherits("automation.viewercomponents.ViewerComponent"),b.statics({APP_IDS:{menu:"1660c5f3-b183-4e6c-a873-5d6bbd918224",faq:"f2c4fc13-e24d-4e99-aadf-4cff71092b88",news:"045dd836-ef5d-11e1-ace3-c0dd6188709b","ecom-gallery":"30b4a102-7649-47d9-a60b-bfd89dcca135","ecom-cart":"5fca0e8b-a33c-4c18-b8eb-da50d7f31e4a","ecom-view-cart":"c029b3fd-e8e4-44f1-b1f0-1f83e437d45c","ecom-add-to-cart-btn":"c614fb79-dbec-4ac7-b9b0-419669fadecc",rss:"51fbc8b3-e886-4f7e-96bb-9107bca12474"},APP_VIEWS:{menu:["Center","Left","Inline","LeftImage","LeftThumb","Gallery"],faq:["Left","ContainerBox","ExpandQuestions","ExpandQuestionsSep","Expand"],news:["SimpleVList","ImageVList","DateVList"],"ecom-gallery":["SimpleClean","Polaroid","Gallery"],"ecom-cart":["Joined"],"ecom-view-cart":["General"],"ecom-add-to-cart-btn":["Simple"],rss:["List","Grid","Single"]}}),b.fields({_addedComponents:[],_definitions:[]}),b.methods({initialize:function(){var a;this._definitions=this.resources.W.AppsEditor.editorData.appsDefinitionData,define.getResourceFetcher().getResourceValue("ecommerceDefObj2G",function(b){a={"55a88716-958a-4b91-b666-6c1118abdee4":b}}),Object.merge(this._definitions,a)},isReady:function(){return!0},addPart:function(a,b,c){var d=this,e=this.APP_IDS[a];c=void 0===c?!0:c;var f=automation.Component.waitForSelectionChange(!0).then(function(a){return d._addedComponents.push(a),c&&d.resources.W.EditorDialogs.closeAllDialogs(),automation.Component.waitForComponentState(a,"content").then(function(){return d.selectAppPart1View(a,b)})}),g=_.find(this._definitions,function(a){return a.widgets&&_.keys(a.widgets).contains(e)});return g?this.resources.W.AppStoreManager.addComponent("wixappsPart",g,e):alert("Relevant application/app-part not found in list provided by app store"),f},selectAppPart1View:function(a,b){var c=a.getDataItem();if(c.get("viewName")===b)return Q.resolve(a);var d=automation.controllers.Events.waitForEvent(a,"proxyDisplayed");return c.set("viewName",b),d},changeAppPartView:function(a,b){var c=automation.controllers.Events.waitForEvent(a.getEventDispatcher(),Constants.WixAppEvents.APP_CONTENT_RESIZE);return a.getDataItem().set("viewName",b),c},cleanUp:function(a){var b=this,c=Q.defer();a||(a=this._addedComponents);var d=function(){a.length?Q.resolve(a.pop()).then(b.selectComponent.bind(b)).then(b.deleteSelectedComponent.bind(b)).then(d):(this._addedComponents=[],b.resources.W.EditorDialogs.closeAllDialogs(),c.resolve())};return d(),c.promise},___dummyForJSDoc___:function(){}})}),define.Class("automation.viewercomponents.Audioplayer",function(a){var b=a;b.methods({isReady:function(){return!0},___dummyForJSDoc___:function(){}})}),define.Class("automation.viewercomponents.BlogDriver",function(a){var b=a;b.resources(["W.Commands","W.Preview"]),b.inherits("automation.viewercomponents.ViewerComponent"),b.binds(["getBlogFeed","getBlogFeedPage","_openDataEditingDialog","registerFeedPageFinishedQuerySync","unregisterFeedPageFinishedQuerySync"]),b.methods({isReady:function(){return!0},addBlog:function(){var a,b,c=this,d=Q.resolve().then(function(){return automation.controllers.Pages.getPagesSync()}).then(function(b){return a=_.keys(b),automation.editorcomponents.Dialogs.waitForDialogWithTitle("Great! You’ve added a blog")}).then(function(a){return automation.editorcomponents.Dialogs.findDialogWindow(a)}).then(function(a){return a.getLogic().triggerConfirmButton(),Q.delay(200)}).then(function(){return automation.controllers.Pages.getCurrentPageIdSync()}).then(function(c){a.push(c);var d=automation.controllers.Pages.getPagesSync(),e=_.difference(_.keys(d),a)[0];b={blogPage:c,singlePostPage:e}}).then(c.getBlogFeed).then("wait for blog to be ready",function(a){return automation.Component.waitForComponentState(a,"content")}).then(function(){return Q.resolve(b)}),e={showCategory:"blog",widgetId:"31c0cede-09db-4ec7-b760-d375d62101e6"};return this.resources.W.Commands.executeCommand("WEditorCommands.AddWixApp",e),d},addBlogPart:function(a){var b={type:"wixappsPart",widgetId:a},c=automation.editorcomponents.EditBox.waitForCompSelectionChange().then(function(a){return automation.Component.waitForComponentState(a,"content").then(function(){return Q.resolve(a)})});return this.resources.W.Commands.executeCommand("WEditorCommands.AddAppComponent",b),c},addArchivePart:function(){return this.addBlogPart("56ab6fa4-95ac-4391-9337-6702b8a77011")},openFilterDialog:function(a){var b=this;return Q.resolve().then(function(){return automation.Component.selectComponent(a)}).then(function(){var c=automation.editorcomponents.Dialogs.waitForDialogOfType("wixapps.integration.components.editor.DataSelectionDialog");return b.resources.W.Commands.executeCommand("WAppsEditorCommands.OpenSectionDialog",{selectedComp:a}),c})},getBlogTicker:function(){return this.getBlogAppPartOfKind("33a9f5e0-b083-4ccc-b55d-3ca5d241a6eb")},getBlogFeed:function(){return this.getBlogAppPartOfKind("4de5abc5-6da2-4f97-acc3-94bb74285072")},getBlogAppPartOfKind:function(a){var b=this;return Q.resolve().then(function(){return b.getBlogAppInstance()}).then(function(b){var c=_.filter(b.getAppParts(),{_partDef:{id:a},_isDisposed:!1});if(0===c.length)throw"Blog App Part with IDL: "+a+"  part not found";for(var d=[],e=0;e<c.length;e+=2)d.push(c[e]);var f=d.pop();return automation.Component.waitForComponentState(f,"content").then(function(){return f})})},getBlogAppInstance:function(){var a=this.resources.W.Preview.getPreviewManagers().Apps.getAppByPackageName("blog");return a?Q.resolve(a):Q.reject(new Error("Could not obtain blog app instance"))},removeBlog:function(){var a=this;return Q.resolve().then(function(){return a.getBlogFeedPage()}).then(function(a){return automation.controllers.Pages.deletePage(a.getDataItem().get("id"))}).then(function(){return Q.resolve()})},getBlogFeedPage:function(){var a=this;return Q.resolve().then(function(){return a.getBlogAppPartOfKind("4de5abc5-6da2-4f97-acc3-94bb74285072")}).then(function(a){var b=_.filter(a.getAppInstance().getAppPages(),{_appPageId:"79f391eb-7dfc-4adf-be6e-64434c4838d9"});if(0===b.length)throw"Blog feed part not found";var c=b.pop();return Q.resolve(c)})},selectAppPart1View:function(a,b){var c=this;if(a.getDataItem().get("viewName")===b)return Q.resolve(a);var d=c.waitForAppPartReRender(a);return a.getDataItem().set("viewName",b),d},waitForAppPartReRender:function(a){return automation.controllers.Events.waitForEvent(a,"proxyDisplayed").then(function(){return Q.resolve(a)})},_saveDataEditingDialog:function(a){return Q.resolve().then(function(){return a._updateListView(),a._refreshCategoriesPanel(),automation.editorcomponents.Dialogs.findDialogWindow(a)}).then(function(a){return a.getLogic().triggerConfirmButton(),automation.editorcomponents.Dialogs.waitForDialogWithTitle("Saved Successfully!")}).then(function(a){return automation.editorcomponents.Dialogs.clearDialog(a)})},_openDataEditingDialog:function(){var a,b=this;return Q.resolve().then(this.getBlogFeedPage).then(function(b){return a=b.getID(),automation.controllers.Pages.getCurrentPageIdSync()}).then(function(b){return b!==a?automation.controllers.Pages.goToPage(a):Q.resolve()}).then(function(){return b.getBlogFeed()}).then(function(a){return automation.Component.selectComponent(a)}).then(function(a){return b.resources.W.Commands.executeCommand("WAppsEditorCommands.OpenEditDataDialog",{selectedComp:a}),automation.editorcomponents.Dialogs.waitForDialogOfType("wixapps.integration.components.editor.DataEditorDialog")})},addPost:function(a,b,c){void 0===b&&(b=!0);var d,e=this,f=c?Q.resolve():this._openDataEditingDialog();return f=f.then(e.getBlogFeed).then(function(a){return d=a,automation.editorcomponents.Dialogs.waitForDialogOfType("wixapps.integration.components.editor.DataEditorDialog")}).then(function(c){var f=d.getAppPartLogic().getDataEditingModel(),g=f.getItemTemplate("TextPost",!0).getValue();g.title=a.title||g.title,g.date.iso=a.date||(new Date).toISOString();var h=f.addToCache("Posts",g);return h.setDirty(),b===!0?e._saveDataEditingDialog(c).then(function(){return automation.Component.waitForComponentState(d,"content")}):Q.resolve()})},addPosts:function(a){var b,c=this;return Q.resolve().then(function(){return c._openDataEditingDialog()}).then(function(d){b=d;for(var e=function(a){var b="Test photo post #"+a,d=new Date;return d.setDate(1),d.setMonth(d.getMonth()-a),c.addPost({title:b,date:d},!1,!0)},f=Q.resolve(),g=0;a>g;g++)f=f.then(e.bind(c,g));return f}).then(function(){return c._saveDataEditingDialog(b)}).then(c.getBlogFeed).then(function(a){return automation.Component.waitForComponentState(a,"content")})},updateViewVar:function(a,b,c){return a.getMainProxy()?(a.getMainProxy().getViewContext().getEnvironment().getVar(b).setValue(c),Q.resolve()):Q.delay(200).then(this.updateViewVar.bind(this,a,b,c))},registerFeedPageFinishedQuerySync:function(a,b){a.registerForDataItemLoaded(b)},unregisterFeedPageFinishedQuerySync:function(a,b){a.unregisterForDataItemLoaded(b)},___dummyForJSDoc___:function(){}})}),define.Class("automation.viewercomponents.Ecom",function(a){var b=a;b.resources(["W.Commands","W.Editor","W.EditorDialogs"]),b.inherits("automation.viewercomponents.ViewerComponent"),b.methods({isReady:function(){return!0},addProductsGallery:function(){var a=this,b=Q.fulfill().then(function(){return automation.editorcomponents.Dialogs.waitForDialogOfType("wysiwyg.editor.components.dialogs.AddAppDialog")}).then(function(b){return b._closeDialogCB(),a.resources.W.EditorDialogs.closeAllDialogs(),automation.editorcomponents.Dialogs.waitForDialogOfType("wixapps.integration.components.editor.DataSelectionDialog")}).then(function(a){return automation.editorcomponents.Dialogs.findDialogWindow(a)}).then(function(b){return b.getLogic().triggerConfirmButton(),Q(a.resources.W.Editor.getEditedComponent())}),c={type:"wixappsPart",widgetId:"30b4a102-7649-47d9-a60b-bfd89dcca135"};return this.resources.W.Commands.executeCommand("WEditorCommands.AddAppComponent",c),b},___dummyForJSDoc___:function(){}})}),define.Class("automation.viewercomponents.Sitedata",function(a){var b=a;b.methods({isReady:function(){return!0},getSiteData:function(){return console.log("not yet implemented"),Q()},___dummyForJSDoc___:function(){}})}),define.Class("automation.viewercomponents.ViewerComponent",function(a){var b=a;b.resources(["W.CommandsNew","W.Commands","W.Editor"]),b.inherits("automation.Component"),b.methods({isReady:function(){return!0},addComponent:function(a){var b="object"==typeof a?a:{compType:a},c=automation.editorcomponents.EditBox.waitForCompSelectionChange().then(function(a){return automation.Component.waitForComponentReady(a)});return this.resources.W.CommandsNew.executeCommand("WEditorCommands.AddComponent",b),c},removeComponent:function(a,b,c){c=c||"core.editor.components.dialogs.MessageDialog",this.resources.W.Editor.setSelectedComp(a);var d=automation.Component.waitForComponentRemove(a);return this.resources.W.Commands.executeCommand("WEditorCommands.WDeleteSelectedComponent"),b?automation.editorcomponents.Dialogs.waitForDialogOfType(c).then(function(a){return a.getParentComponent().triggerConfirmButton(),d}):d},_getComponent:function(a,b){return this.getComponentNode(a,this._getIframe(),b)},getComponentNode:function(a,b,c){var d,e=b.getElements("div[comp="+a+"]");return d=_.isNumber(c)?c:e.length-1,e[d]},___dummyForJSDoc___:function(){}})}),define.Class("automation.wixapps.AppInstance2Driver",function(a){var b=a;b.resources(["W.AppsEditor2"]),b.methods({isReady:function(){return!0},getAppInstanceFromAppIdSync:function(a){return W.AppsEditor2.getAppInstanceSync(a)},getAppInstanceFromAppPartSync:function(a){return a.getAppInstance()},getTypeDefinitionSync:function(a,b){return a.getTypesManager().getType(b)},___dummyForJSDoc___:function(){}})}),define.Class("automation.wixapps.AppInstanceDriver",function(a){var b=a;b.resources(["W.AppsEditor"]),b.methods({isReady:function(){return!0},getAppInstanceFromAppPartSync:function(a){return a.getAppInstance()},getApplicationLocalizerSync:function(a){return a.getLocalizer()},___dummyForJSDoc___:function(){}})}),define.Class("automation.wixapps.ApplicationLocalizerDriver",function(a){var b=a;b.utilize(["wixapps.integration.managers.ApplicationLocalizer"]),b.methods({createApplicationLocalizer:function(a){function b(){var a=c.getBundleLoadState();a===c.BUNDLE_STATES.LOADED||a===c.BUNDLE_STATES.FAILED?d.resolve(c):setTimeout(b,1e3)}var c=new this.imports.ApplicationLocalizer(a),d=Q.defer();return b(),d.promise},isReadySync:function(a){return a.isReady()&&a.getBundleLoadState()===a.BUNDLE_STATES.LOADED},hasLoadingBundleFailedSync:function(a){return a.getBundleLoadState()===a.BUNDLE_STATES.FAILED},___dummyForJSDoc___:function(){}})}),define.Class("automation.wixapps.DataServiceDriver",function(a){var b=a;b.binds(["cleanStore","uploadData","createItem","deleteItem","resetStoreToDescriptorData","resetAppToPreLoadedData"]),b.fields({}),b.methods({isReady:function(){return!0},getAllItemsInCollection:function(a,b){var c=Q.defer();return a.getDataService().getTransport().query(b,{},null,0,-1,!1,function(a){c.resolve(a.items)},function(a){c.reject(a)}),c.promise},deleteItem:function(a,b,c){var d=Q.defer();return a.getDataService().getTransport().deleteItem(b,c,function(){d.resolve(b+"/"+c)},function(a){d.reject(JSON.stringify(a))}),d.promise},createItem:function(a,b,c){var d=Q.defer(),e=_.clone(c,!0);delete e._createdAt,delete e._hash,delete e._updatedAt,delete e._vg;var f=a.getDataItemFactory().createDataItem(e);return a.getDataService().createItem(b,f,function(){d.resolve(b+"/"+c._iid)},function(a){d.reject(a)}),d.promise},cleanStore:function(a){var b=this,c={},d=_.map(a.getDescriptorValue(["collections"]),"id"),e=_.map(d,function(d){return Q.resolve().then(function(){return b.getAllItemsInCollection(a,d)}).then(function(a){c[d]=a})});return Q.all(e).then(function(){var d=[];return _.forOwn(c,function(c,e){d.append(_.map(c,function(c){return b.deleteItem(a,e,c._iid)}))}),Q.all(d)}).then(function(){return a.getDataService().getItemCache().removeAll(),Q.resolve(a)})},extractDescriptorData:function(a){return a.getDescriptorValue(["preLoadedData"])},uploadData:function(a){var b=this.extractDescriptorData(a),c=this,d=[];return _.forOwn(b,function(b,e){d.append(_.map(b,function(b){return c.createItem(a,e,b)}))}),Q.all(d)},resetStoreToDescriptorData:function(a){return Q.resolve(a).then(this.cleanStore).then(this.uploadData)},resetAppToPreLoadedData:function(a){var b=this;return Q.resolve(a).then("reset store",this.resetStoreToDescriptorData).then("reload app parts",function(){a.getItemCache().removeAll();var c=_.map(a.getAppParts(),b.reloadAppPart);return Q.all(c)})},___dummyForJSDoc___:function(){}})});