define.Class("wixapps.core.apprepo.AppPartDefinition",function(a){var b=a;b.traits(["wixapps.core.apprepo.traits.AppRepoItem"]),b.fields({_dataSelector:null,_viewName:null,_type:null,_displayName:null,_appPageId:"home"}),b.methods({initialize:function(a){this._appInstance=a},loadFromDefinition:function(a){this.setDataSelectorId(a.dataSelector),this.setViewName(a.viewName),this.setType(a.type),this.setDisplayName(a.displayName)},setDataSelectorId:function(a){this._dataSelector=a},getDataSelectorId:function(){return this._dataSelector},getDataSelector:function(){return this._appInstance.getDataSelectors().getById(this._dataSelector)},setViewName:function(a){this._viewName=a},getViewName:function(){return this._viewName},setType:function(a){this._type=a},getType:function(){return this._type},getTypeDef:function(){return this._appInstance.getTypesManager().getType(this._type)},setDisplayName:function(a){this._displayName=a},getDisplayName:function(){return this._displayName},setUsed:function(a){this._used=a},isUsed:function(){return this._used},getSerializableProperties:function(){return["dataSelector","viewName","type","displayName"]}})}),define.Class("wixapps.core.apprepo.AppPartsRepository",function(a){var b=a;b.inherits("wixapps.core.apprepo.base.BaseRepository"),b.utilize(["wixapps.core.apprepo.AppPartDefinition"]),b.fields({_byType:{}}),b.methods({_getInstanceClass:function(){return this.imports.AppPartDefinition},_createAppPartDefinition:function(a,b,c,d){var e=new this.imports.AppPartDefinition(this._appInstance);return e.setDataSelectorId(a),e.setViewName(b),e.setType(c),e.setDisplayName(d),e},createAndRegisterWithId:function(a,b,c,d,e){var f=this._createAppPartDefinition(b,c,d,e),g=this.registerWithId(a,f);return g},createAndRegister:function(a,b,c,d){var e=this._createAppPartDefinition(a,b,c,d),f=this.register("apppart",e);return f},filterByType:function(a,b,c){return this.filter(function(d){var e=d.getType()===a&&(d.isUsed()||c);if(b){var f=d.getDataSelector();return e&&!f.isPageBased()}return e})},countAppPartOfType:function(a,b){var c=this.filterByType(a,b);return c.length}})}),define.Class("wixapps.core.apprepo.AppRepoTransport",function(a){var b=a;b.inherits("wixapps.core.utils.WixServiceTransportBase"),b.resources(["W.Config"]),b.utilize(["wixapps.core.utils.WixAppsLogger"]),b.methods({_getServiceUrl:function(a){if(a.test("published")&&this.resources.W.Config.env.$isPublicViewerFrame){var b=this.resources.W.Config.getAppsRepoServerUrl();return b+"/"}var c=window.location.origin||this._extractBasePath(window.location.href);return c+"/apps/appBuilder/"},_getJSONPCallbackName:function(a){return a.test("published")?"loadAppRepo":void 0},updateInstance:function(a,b,c,d,e){var f=a.toObject(),g={checkConcurrentModification:!c};this.doRequest("saved/"+b,g,f,d,e)},getSavedInstance:function(a,b,c){this.doGetRequest("saved/"+a,{},null,b,c)},getPublishedInstance:function(a,b,c){var d=this.resources.W.Config.getPublishedVersion(),e="published/"+a+"/"+d,f=this.resources.W.Config.getCacheKillerVersion();this.doJSONPRequest(e,{cdnVersion:f},b,c)},publishInstance:function(a,b,c){this.doRequest("published/"+a,{},null,b,c)}})}),define.Class("wixapps.core.apprepo.ApplicationDefinition",function(a){var b=a;b.statics({DATA_PROVIDERS_KEY:"dataProviders",DATA_SELECTORS_KEY:"dataSelectors",PARTS_DEF_KEY:"parts",TYPES_KEY:"types",VIEWS_KEY:"views",PAGES_KEY:"pages",APP_VERSION_KEY:"applicationInstanceVersion"}),b.fields({_appDef:{}}),b.methods({initialize:function(a){this._appDef=a||{}},getDataProviders:function(){return this._appDef[this.DATA_PROVIDERS_KEY]},setDataProviders:function(a){this._appDef[this.DATA_PROVIDERS_KEY]=a},getDataSelectors:function(){return this._appDef[this.DATA_SELECTORS_KEY]},setDataSelectors:function(a){this._appDef[this.DATA_SELECTORS_KEY]=a},getAppPartDefinitions:function(){return this._appDef[this.PARTS_DEF_KEY]},setAppPartDefinitions:function(a){this._appDef[this.PARTS_DEF_KEY]=a},getTypes:function(){return this._appDef[this.TYPES_KEY]},setTypes:function(a){this._appDef[this.TYPES_KEY]=a},getViewDefinitions:function(){return this._appDef[this.VIEWS_KEY]},setViewDefinitions:function(a){this._appDef[this.VIEWS_KEY]=a},setAppInstanceVersion:function(a){this._appDef[this.APP_VERSION_KEY]=a},getAppInstanceVersion:function(){return this._appDef[this.APP_VERSION_KEY]},setPages:function(a){this._appDef[this.PAGES_KEY]=a},getPages:function(){return this._appDef[this.PAGES_KEY]},toObject:function(){return this._appDef}})}),define.Class("wixapps.core.apprepo.ApplicationInstance2",function(a){var b=a;b.inherits("bootstrap.utils.Events"),b.binds(["resolveResourcePath"]),b.utilize(["wixapps.core.apprepo.ApplicationDefinition","wixapps.core.apprepo.DataProvidersRepository","wixapps.core.apprepo.DataSelectorsRepository","wixapps.core.apprepo.AppPartsRepository","wixapps.core.apprepo.PageRepository","wixapps.core.managers.TypesManager","wixapps.core.views.ViewDefinitionsRepository","wixapps.core.views.ViewsCustomizer","wixapps.core.utils.WixAppsLogger","wixapps.core.data.DataItemFactory","wixapps.core.expressions.FunctionLibrary","wixapps.core.views.ViewBuilder","wixapps.integration.utils.PerformanceTracker","wixapps.integration.managers.CustomSystemFuctions"]),b.resources(["W.Commands","W.Classes"]),b.fields({_instanceId:null,_appDef:null,_basePath:null,_viewsDefRepo:null,_appInstanceVersion:1,_isTemplateBased:!1,_dataProvidersRepo:null,_isStubStore:!1,_repoDirtyFlag:!1,_viewBuilder:null,_instanceIdStates:{preSave:null,postSave:null,postProvision:null},_appInstanceWasInitFromTemplate:!1}),b.methods({initialize:function(a,b,c){this._pageLinkResolvers={},this._pageLinkResolversWaitingList=[],this._instanceId=a||"<DRAFT>",this._isStubStore=!!c,this._appInstanceWasInitFromTemplate=!!c,this._trkr=new this.imports.PerformanceTracker,this._funcLibrary=(new this.imports.FunctionLibrary).createChild(),this._dataFactory=new this.imports.DataItemFactory,this._dataFactory.registerFunctionLibrary(this._funcLibrary),this._appCache=null,this._dataProvidersRepo=new this.imports.DataProvidersRepository(this),this._dataSelectorsRepo=new this.imports.DataSelectorsRepository(this),this._partsRepo=new this.imports.AppPartsRepository(this),this._typesManager=new this.imports.TypesManager,this._pagesRepo=new this.imports.PageRepository(this),this._viewsDefRepo=new this.imports.ViewDefinitionsRepository(this._dataFactory),this._customizations=new this.imports.ViewsCustomizer,this._logger=new this.imports.WixAppsLogger,this._viewBuilder=new this.imports.ViewBuilder;for(var d=Constants.WixAppsSystemTypes,e=0;e<d.length;e++)this._typesManager.registerType(d[e]);var f=W.Config.getServiceTopologyProperty("scriptsLocationMap");if(!f||!f.wixapps)throw"wixapps topology path is undefined";this._basePath=f.wixapps+"/",b?(this._appDef=new this.imports.ApplicationDefinition(b),this._migrateDefinitions(this._appDef),this._loadAppData(),this._registerAllPagesLinkResolvers()):this._appDef=new this.imports.ApplicationDefinition;var g=new this.imports.CustomSystemFuctions;g.setupCustomFunctions(this._funcLibrary)},_registerAllPagesLinkResolvers:function(){this._pagesRepo.each(function(a){this.registerPageLinkResolver(a)}.bind(this))},registerPageLinkResolver:function(a){var b=this;this.resources.W.Classes.getClass(a.getPageLinkResolverClass(),function(c){b._pageLinkResolvers[a.getId()]=new c(a.toObject()),b._pageLinkResolversWaitingList=_.filter(b._pageLinkResolversWaitingList,function(c){return c.appPageId===a.getId()?(c.q.resolve(b._pageLinkResolvers[a.getId()]),!1):!0})})},getPageLinkResolverPromise:function(a){var b=Q.defer();return _.has(this._pageLinkResolvers,a)?b.resolve(this._pageLinkResolvers[a]):this._pageLinkResolversWaitingList.push({appPageId:a,q:b}),b.promise},_migrateDefinitions:function(a){var b=this._viewBuilder,c=_.reduce(a._appDef.views,function(a,c){return a.concat(b._find(c,function(a){return a.textAlign&&a["text-align"]}))},[]);_.each(c,function(a){delete a.textAlign});var d=1,e=this._appDef.getAppPartDefinitions();for(var f in e)if(e.hasOwnProperty(f)){var g=e[f];g.hasOwnProperty("displayName")||(g.displayName="List "+d,d++)}},toObject:function(){var a=new this.imports.ApplicationDefinition;a.setDataProviders(this._dataProvidersRepo.toObject()),a.setDataSelectors(this._dataSelectorsRepo.toArray()),a.setAppPartDefinitions(this._partsRepo.toObject());var b=this.getDataProviders().getWixDbDataProvider();return a.setTypes(b.getManagedTypes()),a.setViewDefinitions(this._viewsDefRepo.toArray()),a.setPages(this._pagesRepo.toObject()),a.setAppInstanceVersion(this.getAppInstanceVersion()),a.toObject()},createErrorRepoItems:function(){var a=this,b=this._dataProvidersRepo.getWixDbDataProvider(),c=this._dataSelectorsRepo.createAndRegister("IB.StaticItem",b,"wix:Object",{item:{}}),d=this._viewBuilder.getErrorViews();_.each(d,function(b){a._customizations.fillMissingIds(b),a.addViewDefinition(b)}),this._partsRepo.createAndRegisterWithId("errAppPartDef",c,"SadPartErrorView","wix:Object","Error")},_loadAppData:function(){this._dataProvidersRepo.fromObject(this._appDef.getDataProviders()),this._dataProvidersRepo.isWixDbDataProviderDefined()||this._dataProvidersRepo.createWixDbDataProvider(),this._dataSelectorsRepo.fromArray(this._appDef.getDataSelectors()),this._partsRepo.fromObject(this._appDef.getAppPartDefinitions()),this.loadViews(this._appDef.getViewDefinitions()),this._pagesRepo.fromObject(this._appDef.getPages()),this.setAppInstanceVersion(this._appDef.getAppInstanceVersion())},getAppDef:function(){return this._appDef},getDataProviders:function(){return this._dataProvidersRepo},getDataSelectors:function(){return this._dataSelectorsRepo},getAppPartDefinitions:function(){return this._partsRepo},getPages:function(){return this._pagesRepo},getTypesManager:function(){return this._typesManager},addViewDefinition:function(a){this._customizations.applyAll(a),this._viewsDefRepo.setViewDefinition(a)},setAppInstanceVersion:function(a){this._appInstanceVersion=a},getAppInstanceVersion:function(){return this._appInstanceVersion},getViewDefinitions:function(){return this._viewsDefRepo},getLogger:function(){return this._logger},getAppCache:function(){return this._appCache},resolveResourcePath:function(a){if(a){var b=a.match(/^(http:\/\/)?(images\/.*)/);if(b)return this._basePath+b[2]}return a},getDataItemFactory:function(){return this._dataFactory},loadViews:function(a){a&&(a.each(function(a){for(var b=this._viewsDefRepo.cloneAndMultiply(a),c=0;c<b.length;c++){var d=b[c];this._customizations.fillMissingIds(d),this.addViewDefinition(d)}}.bind(this)),this.setupCustomizations([]))},setupCustomizations:function(a){this._customizations.addRules(a),this.applyCustomizations()},applyCustomizations:function(){this._customizations.applyToViewDefinitionsRepository(this._viewsDefRepo)},setInstanceId:function(a){this._instanceId=a},getInstanceId:function(){return this._instanceId},setApplicationId:function(a){this._applicationId=a},registerAppPage:function(a){a.initApp()},getPageDefinition:function(a){return this._pagesRepo.exists(a)?this._pagesRepo.getById(a):null},getApplicationId:function(){return this._applicationId},getTrkr:function(){return this._trkr},getViewsCustomizer:function(){return this._customizations},performCleanup:function(){this._cleanupViewDefinitions()},_cleanupAppPartDefinitions:function(){try{for(var a=W.Apps2.getAppPart2Components(!0),b=a.map(function(a){return a._data.get("appPartName")}),c=this.getAppPartDefinitions(),d=c.getIds(),e=0;e<d.length;e++){var f=d[e];b.contains(f)===!1&&(c.remove(f),this.setDirty())}}catch(g){var h=this._logger,i=Object.clone(h.Errors.APP_INSTANCE2_CLEANUP_FAILED);i.description=i.description+g,h.reportError(i,this.$className,"_cleanupAppPartDefinitions",h.SubCategory.APP_BUILDER)}},_cleanupViewDefinitions:function(){try{var a=this,b=this.getViewDefinitions(),c=b.toArray(),d=W.Apps2.getAppPart2Components(!0),e=_.unique(_.map(d,function(a){return a.getAppPartDefinition().getViewName()})),f=_.filter(c,function(a){return!_.contains(e,a.name)});_.each(f,function(c){b.removeViewDefinition(c),a.setDirty()})}catch(g){var h=this._logger,i=Object.clone(h.Errors.APP_INSTANCE2_CLEANUP_FAILED);i.description=i.description+g,h.reportError(i,this.$className,"_cleanupViewDefinitions",h.SubCategory.APP_BUILDER)}},_cleanupTypes:function(){for(var a=this.getDataProviders().getWixDbDataProvider(),b=a.getManagedTypes(),c=this,d=0;d<b.length;d++){var e=b[d].name;this._hasNoAppPartDefRefs(function(a){return a.getType()===e},function(){a.deleteType(e),c.setDirty()})}},_cleanupDataSelectors:function(){for(var a=this.getDataSelectors(),b=a.getIds(),c=this,d=0;d<b.length;d++){var e=b[d];this._hasNoAppPartDefRefs(function(a){return a.getDataSelectorId()===e},function(){a.remove(e),c.setDirty()})}},_hasNoRefsInCollection:function(a,b,c){0===a.filter(b).length&&c()},_hasNoAppPartDefRefs:function(a,b){var c=this.getAppPartDefinitions();this._hasNoRefsInCollection(c,a,b)},isEmpty:function(){var a=this.toObject();return _.isEmpty(a.dataSelectors)&&_.isEmpty(a.parts)&&_.isEmpty(a.types)},isDirty:function(){return this._repoDirtyFlag||!this.isEmpty()},setDirty:function(){this._repoDirtyFlag=!0},resetDirty:function(){this._repoDirtyFlag=!1},setIsStubStore:function(a){this._isStubStore=a},isStubStore:function(){return this._isStubStore},getViewBuilder:function(){return this._viewBuilder},setError:function(a){this._error=a},getError:function(){return this._error}})}),define.Class("wixapps.core.apprepo.DataProvidersRepository",function(a){var b=a;b.inherits("wixapps.core.apprepo.base.BaseRepository"),b.utilize(["wixapps.core.data.providers.wixdb.WixDbDraftDataProvider","wixapps.core.data.providers.wixdb.WixDbPublishedDataProvider"]),b.methods({_getInstanceClass:function(a){var b=a&&a.type;return"WixDb"===b?W.Config.env.$isPublicViewerFrame?this.imports.WixDbPublishedDataProvider:this.imports.WixDbDraftDataProvider:void 0},registerWixDbDataProvider:function(a){return this.registerWithId("wixdb",a)},getWixDbDataProvider:function(){var a;return a=this.isWixDbDataProviderDefined()?this.getById("wixdb"):this.createWixDbDataProvider()},isWixDbDataProviderDefined:function(){return void 0!==this._instancesMap.wixdb},createWixDbDataProvider:function(){var a=new this.imports.WixDbDraftDataProvider(this._appInstance);return this.registerWixDbDataProvider(a),a}})}),define.Class("wixapps.core.apprepo.DataSelectorsRepository",function(a){var b=a;b.inherits("wixapps.core.apprepo.base.BaseRepository"),b.utilize(["wixapps.core.data.selectors.ManualSelectedItemDataSelector","wixapps.core.data.selectors.ManualSelectedListDataSelector","wixapps.core.data.selectors.PageSelectedItemDataSelector","wixapps.core.data.selectors.SelectedItemDataSelector","wixapps.core.data.selectors.StaticItemDataSelector","wixapps.core.data.selectors.TagsFilteredItemsDataSelector","wixapps.core.data.selectors.NewItemOfTypeDataSelector"]),b.fields({_byType:{}}),b.methods({_getInstanceClass:function(a){var b=a&&a.logicalTypeName;switch(b){case"IB.ManualSelectedItem":return this.imports.ManualSelectedItemDataSelector;case"IB.ManualSelectedList":return this.imports.ManualSelectedListDataSelector;case"IB.SelectedItemInList":return this.imports.SelectedItemDataSelector;case"IB.PageSelectedItem":return this.imports.PageSelectedItemDataSelector;case"IB.StaticItem":return this.imports.StaticItemDataSelector;case"IB.TagsFilteredList":return this.imports.TagsFilteredItemsDataSelector;case"IB.NewItemOfType":return this.imports.NewItemOfTypeDataSelector}},fromArray:function(a){a=a||[],Array.each(a,function(a){var b=this._createInstance(a);this.registerWithId(a.id,b);var c=b.getSelectionType();this._byType[c]=this._byType[c]||[],this._byType[c].push(b)}.bind(this))},createInstance:function(a,b,c,d){var e=this._getInstanceClass({logicalTypeName:a}),f=new e(this._appInstance);switch(f.setDataProvider(b),f.setSelectionType(c),a){case"IB.StaticItem":f.setStaticItem(d.item);break;case"IB.ManualSelectedList":f.setItemIds(d.itemIds);break;case"IB.ManualSelectedItem":d.itemIds.length&&(d.itemIds=d.itemIds[0]),f.setItemId(d.itemIds);break;case"IB.PageSelectedItem":f.setAppPageId(d.appPageId)}return f},registerWithId:function(a,b){this.parent(a,b);var c=b.getSelectionType();this._byType[c]=this._byType[c]||[],this._byType[c].push(b)},remove:function(a){var b=this.getById(a),c=b.getSelectionType();_.remove(this._byType[c],function(a){return a===b}),this.parent(a)},_register:function(a){var b=this.register("dataSelector"+W.Utils.AppsUtils.getTimeBasedUniqueId(),a);return b},createAndRegister:function(a,b,c,d){return this._register(this.createInstance(a,b,c,d))},createBasedOnOtherSelector:function(a){var b=this._appInstance.getDataSelectors(),c=a.getLogicalTypeName(),d=a.getDataProvider(),e=a.getSelectionType(),f=a.toObject(),g=b.createAndRegister(c,d,e,f),h=b.getById(g);return h},getByType:function(a){return this._byType[a]||[]}})}),define.Class("wixapps.core.apprepo.FormDefinition",function(a){a.inherits("wixapps.core.apprepo.base.AppRepoItem"),a.fields({_dataSelectorId:null,_type:null,_displayName:null,_used:!1}),a.methods({initialize:function(a,b){this._appInstance=a,this.setDisplayName(b.displayName),this.setType(b.type),this.setDataSelectorId(b.dataSelectorId)},getDefinition:function(){return{dataSelectorId:this._dataSelectorId,type:this._type,displayName:this._displayName}},setDataSelectorId:function(a){this._dataSelectorId=a},getDataSelectorId:function(){return this._dataSelectorId},setType:function(a){this._type=a},getType:function(){return this._type},setDisplayName:function(a){this._displayName=a},getDisplayName:function(){return this._displayName},setUsed:function(a){this._used=a},isUsed:function(){return this._used}})}),define.Class("wixapps.core.apprepo.FormsRepository",function(a){var b=a;b.inherits("wixapps.core.apprepo.base.BaseRepository"),b.utilize(["wixapps.core.apprepo.FormDefinition"]),b.fields({_byType:{}}),b.methods({_getInstanceClass:function(){return this.imports.FormDefinition},_createFormDefinition:function(a,b,c){var d={displayName:c,dataSelectorId:a,type:b};return new this.imports.FormDefinition(this._appInstance,d)},createAndRegisterWithId:function(a,b,c,d){var e=this._createFormDefinition(b,d);return this.registerWithId(a,e)},createAndRegister:function(a,b,c){var d=this._createFormDefinition(a,b,c);return this.register("form",d)},countFormOfType:function(a){var b=this.filter(function(b){return b.getType()===a});return b.length}})}),define.Class("wixapps.core.apprepo.MiniPartDefinition",function(a){a.inherits("wixapps.core.apprepo.base.AppRepoItem"),a.fields({_formId:null,_viewName:null,_field:null}),a.methods({initialize:function(a,b){this._appInstance=a,this.setFormId(b.formId),this.setViewName(b.viewName),this.setField(b.field)},getDefinition:function(){return{formId:this._formId,viewName:this._viewName,field:this._field}},setFormId:function(a){this._formId=a},getFormId:function(){return this._formId},setViewName:function(a){this._viewName=a},getViewName:function(){return this._viewName},setField:function(a){this._field=a},getField:function(){return this._field}})}),define.Class("wixapps.core.apprepo.MiniPartsRepository",function(a){var b=a;b.inherits("wixapps.core.apprepo.base.BaseRepository"),b.utilize(["wixapps.core.apprepo.MiniPartDefinition"]),b.fields({_byForm:{}}),b.methods({_getInstanceClass:function(){return this.imports.MiniPartDefinition},_createFromDefinition:function(a,b,c){var d={formId:a,viewName:b,field:c};return new this.imports.MiniPartDefinition(this._appInstance,d)},registerWithId:function(a,b){var c=this._byForm[b.getFormId()]=this._byForm[b.getFormId()]||{};c[b.getField()]=b,this.parent(a,b)},createAndRegisterWithId:function(a,b,c,d){var e=this._createFromDefinition(b,c,d);return this.registerWithId(a,e)},createAndRegister:function(a,b,c){var d=this._createFromDefinition(a,b,c);return this.register("form",d)},getByFormIdAndField:function(a,b){var c=this._byForm[a];return c&&c[b]}})}),define.Class("wixapps.core.apprepo.PageDefinition",function(a){var b=a;b.traits(["wixapps.core.apprepo.traits.AppRepoItem"]),b.fields({_forType:null,_pageLogicClass:null,_displayName:null}),b.methods({initialize:function(a){this._appInstance=a},loadFromDefinition:function(a){this.setLogicClass(a.pageLogicClass),this.setType(a.forType),this.setDisplayName(a.displayName),this.setPageLinkResolverClass(a.pageLinkResolverClass||"wixapps.core.logics.page.SingleItemPageLinkResolver")},getPageLinkResolverClass:function(){return this._pageLinkResolverClass||"wixapps.core.logics.page.SingleItemPageLinkResolver"},setPageLinkResolverClass:function(a){this._pageLinkResolverClass=a},setLogicClass:function(a){this._pageLogicClass=a},getLogicClass:function(){return this._pageLogicClass},setType:function(a){this._forType=a},getType:function(){return this._forType},setDisplayName:function(a){this._displayName=a},getDisplayName:function(){return this._displayName},getSerializableProperties:function(){return["pageLogicClass","forType","displayName","pageLinkResolverClass"]}})}),define.Class("wixapps.core.apprepo.PageRepository",function(a){var b=a;b.inherits("wixapps.core.apprepo.base.BaseRepository"),b.utilize(["wixapps.core.apprepo.PageDefinition"]),b.methods({_getInstanceClass:function(){return this.imports.PageDefinition},createAndRegister:function(a,b,c){var d=new this.imports.PageDefinition(this._appInstance);"singleItem"==a&&(d.setPageLinkResolverClass("wixapps.core.logics.page.SingleItemPageLinkResolver"),d.setLogicClass("wixapps.core.logics.page.AppBuilderPageLogic"),d.setType(b)),d.setDisplayName(c);var e=this.registerWithGuid(d);return e},getPageDefByType:function(a){for(var b=0;b<this._instances.length;b++){var c=this._instances[b],d=c.instance;if(d.getType()===a)return d}return void 0},filterByType:function(a){return this.filter(function(b){return b.getType()===a})}})}),define.Class("wixapps.core.apprepo.base.AppRepoItem",function(a){a.inherits("bootstrap.utils.Events"),a.fields({_id:null}),a.methods({initialize:function(){throw"not implemented"},getDefinition:function(){throw"not implemented"},getId:function(){return this._id},setId:function(a){this._id=a}})}),define.Class("wixapps.core.apprepo.base.BaseRepository",function(a){var b=a;b.fields({_instances:[],_instancesMap:{},_appInstance:null}),b.methods({initialize:function(a){this._appInstance=a},fromObject:function(a){Object.each(a,function(a,b){var c=this._createInstance(a);this.registerWithId(b,c)}.bind(this))},fromArray:function(a){a=a||[],Array.each(a,function(a){var b=this._createInstance(a);this.registerWithId(a.id,b)}.bind(this))},_createInstance:function(a){var b,c=this._getInstanceClass(a);if(!c)throw"No Class found for "+a;return b=new c(this._appInstance),b.loadFromDefinition(a),b},toObject:function(){for(var a={},b=0;b<this._getInstances().length;b++){var c=this._getInstances()[b];a[c.id]=c.instance.toObject()}return a},toArray:function(){return this._getInstances().map(function(a){return a.instance.toObject()})},_getInstances:function(){return this._instances},_getInstanceClass:function(){throw"Must Implement!"},register:function(a,b){var c=W.Utils.AppsUtils.getTimeBasedUniqueId(a);return this.registerWithId(c,b),c},registerWithId:function(a,b){return this._getInstances().push({id:a,instance:b}),this._instancesMap[a]=b,b.setId(a),a},registerWithGuid:function(a){var b=this.generateGUID();return this.registerWithId(b,a),b},generateGUID:function(){var a=function(){return Math.floor(65536*Math.random()).toString(16)};return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()},remove:function(a){this._instances=this._instances.filter(function(b){return b.id!=a}),delete this._instancesMap[a]},getById:function(a){var b=this._instancesMap[a];if(!b)throw"No item of id ["+a+"]";return b},getIds:function(){return this._instances.map(function(a){return a.id})},filter:function(a){var b=this._instances.filter(function(b){return a(b.instance)});return b.map(function(a){return a.instance})},each:function(a){_.each(this._instancesMap,a)},exists:function(a){return _.has(this._instancesMap,a)}})}),define.Class("wixapps.core.apprepo.traits.AppRepoItem",function(a){var b=a;b.methods({fromObject:function(a){Object.each(a,function(a,b){this["_"+b]=a}.bind(this))},toObject:function(){var a=this.getSerializableProperties(),b={};return a.each(function(a){b[a]=_.clone(this["_"+a],!0)}.bind(this)),b},getId:function(){return this._id},setId:function(a){this._id=a},getSerializableProperties:function(){throw"Must implement me!"}})}),define.Class("wixapps.core.data.DataItemBinding",function(a){var b=a;b.inherits(),b.utilize([]),b.traits([]),b.binds(["_onSourceChanged","_onTargetChanged"]),b.fields({_source:null,_target:null,_bidirectional:!1}),b.methods({initialize:function(a,b,c){this._bidirectional=void 0===c?!1:c,this._source=a,this._target=b,this._source.addEvent(Constants.DataItemEvents.CHANGE,this._onSourceChanged),this._bidirectional&&this._target.addEvent(Constants.DataItemEvents.CHANGE,this._onTargetChanged),this._target.setValue(this._source.getValue())},_onSourceChanged:function(){this._target.setValue(this._source.getValue())},_onTargetChanged:function(){this._source.setValue(this._target.getValue())},dispose:function(){this._source.removeEvent(Constants.DataItemEvents.CHANGE,this._onSourceChanged),this._bidirectional&&this._target.removeEvent(Constants.DataItemEvents.CHANGE,this._onTargetChanged)}})}),define.Class("wixapps.core.data.DataItemFactory",function(a){var b=a;b.utilize(["wixapps.core.expressions.Expression"]),b.fields({_refResolver:null,_cfCtrlDict:{},_constructorMap:{},_funcLibrary:null,_debugMode:0}),b.statics({SANITATION_WARNING_ILLEGAL_TYPE:"Illegal type"}),b.resources(["DataItemModule"]),b.methods({initialize:function(){this._constructorMap=this.resources.DataItemModule.getConstructors()},getDataItemClassName:function(a){var b,c=typeOf(a);if("object"==c)b=a._type&&"wix:Ref"==a._type.substr(0,7)?"wixapps.core.data.DataItemProxy":a.hasOwnProperty("$expr")?"wixapps.core.data.ExprDataItem":"wixapps.core.data.CompositeDataItem";else if("array"==c)b="wixapps.core.data.ArrayDataItem";else{if("function"==c)throw"DataItemFactory: Can't create DataItem of a 'function' type";b="wixapps.core.data.DataItem"}return b},createDataItem:function(a){var b,c,d;return b=this.getDataItemClassName(a),c=this._getDataItemConstructor(b),c&&(d=new c(this),d.setInitialValue(a),this._debugMode>0&&(window._debug_idCounter||(window._debug_idCounter=1e3,window._debug_itemDict={}),d._debug_itemID=window._debug_idCounter++,this._debugMode>1&&W&&W.Utils&&(d._debug_whodunnit=W.Utils.getStackTrace()))),d},createComputedField:function(a,b,c,d){var e=this._getDataItemConstructor("wixapps.core.data.ComputedFieldItem");return new e(this,a,b,c,d)},createVirtualArray:function(){var a=this._getDataItemConstructor("wixapps.core.data.VirtualArrayDataItem");return new a(this)},createFilteredVirtualArray:function(){var a=this._getDataItemConstructor("wixapps.core.data.FilteredVirtualArrayDataItem");return new a(this)},getFactory:function(){return this},getRefResolver:function(){return this._refResolver},registerRefResolver:function(a){if(!a.deReference||"function"!==typeOf(a.deReference))throw new Error("refResolver must provide function 'deReference()'");this._refResolver=a},registerComputedFieldController:function(a,b,c,d){a&&b&&(this._cfCtrlDict[this._getCfCtrlKey(a,b)]={getter:c,setter:d})},getComputedFieldGetter:function(a,b){var c=this._getCfCtrlKey(a,b);return this._cfCtrlDict[c]?this._cfCtrlDict[c].getter:void 0},getComputedFieldSetter:function(a,b){var c=this._getCfCtrlKey(a,b);return this._cfCtrlDict[c]?this._cfCtrlDict[c].setter:void 0},getFunctionLibrary:function(){return this._funcLibrary},registerFunctionLibrary:function(a){this._funcLibrary=a},_getCfCtrlKey:function(a,b){return a+"|"+b},_getDataItemConstructor:function(a){var b;return a?(a in this._constructorMap||(b=a.match(/[^\.]+$/)[0],b&&b in this.imports&&(this._constructorMap[a]=this.imports[b])),this._constructorMap[a]):void 0},sanitizeRawData:function(a){var b=this,c=["string","boolean","number","object","array"],d=[],e=function(a,f){var g=typeOf(a);if(c.contains(g)){var h="array"==g?Array:"object"==g?Object:void 0;if(h){var i=h.map(a,function(a,b){return e(a,f+"/"+String(b))});return h.filter(i,function(a){return null!==a})}return a}return d.push({id:b.SANITATION_WARNING_ILLEGAL_TYPE,path:f,value:typeOf(a)}),null};return{processedData:e(a,""),warnings:d}},clone:function(){var a=new this.constructor;return a.registerRefResolver(this._refResolver),a._cfCtrlDict={},Object.each(this._cfCtrlDict,function(b,c){a._cfCtrlDict[c]=b}),a}})}),define.Const("DataItem",{VOID_REF:"VOID_REF"}),define.Const("DataItemEvents",{CHANGE:"dataItemChange",VALIDATION_PERFORMED:"dataItemValidationChanged",CHANGE_EVENT_ACTION_ADD:"add",CHANGE_EVENT_ACTION_DELETE:"delete",CHANGE_EVENT_ACTION_REPLACE:"replace",CHANGE_EVENT_ACTION_MOVE:"move",CHANGE_EVENT_ACTION_VISIBILITY:"visibility",bubblingEvents:["dataItemChange"]}),define.Const("DataItemEventPhase",{ON_TARGET:"onTarget",BUBBLING:"bubbling"}),define.resource("DataItemModule",{_constructorSet:null,getConstructors:function(){return this._constructorSet||(this._constructorSet=this._createConstructors()),this._constructorSet},_createConstructors:function(){var a=function(){for(var a=arguments[0],b=a.prototype,c=1;c<arguments.length;c++){var d=arguments[c],e=d.prototype;for(var f in e)e.hasOwnProperty(f)&&(b[f]=e[f])}},b=W.Classes.get("bootstrap.utils.Events"),c=function(a){return this._context=a,this._value=void 0,this._parent=void 0,this._dirtyFlag=!1,this};a(c,b),c.prototype.getValue=function(){return this._value},c.prototype.setValue=function(a){var b=this._value;this._value=a,this._value!==b&&(void 0!==b&&this.setDirty(),this.fireChangedEvent(this._value,b))},c.prototype.setInitialValue=function(a){this.setValue(a)},c.prototype.fireChangedEvent=function(a,b){this.fireEvent(Constants.DataItemEvents.CHANGE,{target:this,newValue:a,oldValue:b})},c.prototype.getTypeName=function(){switch(typeOf(this._value)){case"string":return"String";case"number":return"Number";case"boolean":return"Boolean";default:return void 0}},c.prototype.isRef=function(){return!1},c.prototype.getParent=function(){return this._parent},c.prototype.fireEvent=function(a,c){c=c||{},void 0!==c._previousTargets&&c._previousTargets.contains(this)||(c.currentTarget=this,c.phase=c.target===c.currentTarget?Constants.DataItemEventPhase.ON_TARGET:Constants.DataItemEventPhase.BUBBLING,b.prototype.fireEvent.call(this,a,c),this._parent&&Constants.DataItemEvents.bubblingEvents.contains(a)&&(c._previousTargets=c._previousTargets||[],c._previousTargets.push(this),this._fireBubblingEvent(a,c)))},c.prototype._fireBubblingEvent=function(a,b){var c={};Object.each(b,function(a,b){c[b]=a}),this._parent.fireEvent(a,c)},c.prototype.isDirty=function(){return this._dirtyFlag},c.prototype.setDirty=function(){this._dirtyFlag=!0},c.prototype.resetDirtyFlag=function(){this._dirtyFlag=!1},c.prototype._passScope=function(a){var b=!0;return a&&a.inheritsScope&&(b=a.inheritsScope(this)),b?a:void 0};var d=function(){return this._aggregatedEvents=[],this._eventFilter=[],this._aggregatedChildEvents=[],this};d.prototype.startEventAggregation=function(a){this._eventFilter=a||[];var b=this;this.fireEvent=function(){b._aggregatingDispatchFunc.apply(b,arguments)},this._hijackChildDataItemFireEvent()},d.prototype.releaseEventAggregation=function(a){a=a||Constants.DataItemEvents.CHANGE,this._restoreChildDataItemFireEvent(),_.each(this._aggregatedChildEvents,function(a){a.source.fireEvent(a.event,a.payload)}),this._aggregatedChildEvents=[],this.fireEvent=this.constructor.prototype.fireEvent,this._aggregatedEvents.length>0&&this.fireEvent(a,{target:this,events:this._aggregatedEvents}),this._aggregatedEvents=[]},d.prototype._hijackChildDataItemFireEvent=function(){var a=this;_.each(this._children,function(b){"wixapps.core.data.DataItem"===b.className&&(b.fireEvent=function(c,d){a._aggregatedChildEvents.push({source:b,event:c,payload:d})
})})},d.prototype._restoreChildDataItemFireEvent=function(){_.each(this._children,function(a){"wixapps.core.data.DataItem"===a.className&&(a.fireEvent=c.prototype.fireEvent)})},d.prototype._aggregatingDispatchFunc=function(a,b){0===this._eventFilter.length||this._eventFilter.contains(a)?b.events?this._aggregatedEvents=this._aggregatedEvents.concat(b.events):this._aggregatedEvents.push({type:a,payload:b}):this._originalFireEventFunc(a,b)};var e=function(a){return c.call(this,a),d.call(this),this._children=[],this};a(e,c,d),e.prototype.getTypeName=function(){return"Array"},e.prototype.addChild=function(a,b){var c;return a=a.className&&-1!=a.className.indexOf("wixapps.core.data")?a:this._context.getFactory().createDataItem(a,this),void 0!==b&&(c="number"==typeof b?parseInt(b,10):this.getChildIndex(b)),c>-1?this._children.splice(c,0,a):(c=this._children.length,this._children.push(a)),this.setDirty(),this.fireEvent(Constants.DataItemEvents.CHANGE,{target:this,action:Constants.DataItemEvents.CHANGE_EVENT_ACTION_ADD,child:a,index:c}),a._parent=this,a},e.prototype.deleteChild=function(a){var b="number"==typeof a?parseInt(a,10):this.getChildIndex(a);if(b>-1&&b<this._children.length){var c=this._children.splice(b,1);return this.setDirty(),this.fireEvent(Constants.DataItemEvents.CHANGE,{target:this,action:Constants.DataItemEvents.CHANGE_EVENT_ACTION_DELETE,child:c[0],index:b}),c[0]}return null},e.prototype.moveChildByIndex=function(a,b){return a="number"==typeof a?parseInt(a,10):this.getChildIndex(a),b="number"==typeof b?parseInt(b,10):this.getChildIndex(b),a>-1&&a<this._children.length&&b>-1&&b<this._children.length?(this._children.splice(b,0,this._children.splice(a,1)[0]),this.setDirty(),this.fireEvent(Constants.DataItemEvents.CHANGE,{target:this,action:Constants.DataItemEvents.CHANGE_EVENT_ACTION_MOVE,child:this._children[b],index:a,to:b}),this._children[b]):null},e.prototype.replaceChild=function(a,b){var c,d;if(void 0!==b&&(c="number"==typeof b?parseInt(b,10):this.getChildIndex(b)),c>=0&&c<this._children.length){if(d=this._children[c],a.className&&a.className.contains("wixapps.core.data"))d!==a&&(this._children[c]=a,this.setDirty(),this.fireEvent(Constants.DataItemEvents.CHANGE,{target:this,action:Constants.DataItemEvents.CHANGE_EVENT_ACTION_REPLACE,child:a,prevChild:d,index:c}));else{var e=a;d.className===this._context.getFactory().getDataItemClassName(e)?d.setValue(e):(a=this._context.getFactory().createDataItem(e),a&&(this._children[c]=a,this.setDirty(),a._parent=this,this.fireEvent(Constants.DataItemEvents.CHANGE,{target:this,action:Constants.DataItemEvents.CHANGE_EVENT_ACTION_REPLACE,child:a,prevChild:d,index:c})))}return a}},e.prototype.getChildrenCount=function(){return this._children.length},e.prototype.getChildren=function(){return this._children.slice(0)},e.prototype.getValue=function(a,b){var c=[],d=this._passScope(b);return this._children.forEach(function(b){c.push(b.getValue(a,d))}),c},e.prototype.setValue=function(a){this.startEventAggregation(),this._applyData(a),this.releaseEventAggregation(Constants.DataItemEvents.CHANGE)},e.prototype.setInitialValue=function(a){this._children.length=a.length;for(var b,c=0;c<a.length;c++)b=a[c],b=b.className&&-1!=b.className.indexOf("wixapps.core.data")?b:this._context.getFactory().createDataItem(b,this),this._children[c]=b,this._children[c]._parent=this},e.prototype.getChildIndex=function(a){return this._children.indexOf(a)},e.prototype.getChildByIndex=function(a){return this._children[a]},e.prototype.getChildValue=function(a){return this._children&&void 0!==this._children[a]?this._children[a].getValue():void 0},e.prototype.isDirty=function(){if(c.prototype.isDirty.call(this))return!0;for(var a=0;a<this._children.length;a++)if(this._children[a].isDirty())return!0;return!1},e.prototype.resetDirtyFlag=function(){c.prototype.resetDirtyFlag.call(this);for(var a=0;a<this._children.length;a++)this._children[a].resetDirtyFlag()},e.prototype._applyData=function(a){for(var b=this._children.length,c=0;c<a.length;c++)b>c?this.replaceChild(a[c],c):this.addChild(a[c]);if(a.length<this._children.length)for(var d=this._children.length-1;d>=a.length;d--)this.deleteChild(d)};var f=function(a){return c.call(this,a),d.call(this),this._children={},this};a(f,c,d),f.prototype.getValue=function(a,b){var c={};for(var d in this._children){var e=this._passScope(b);c[d]=this._children[d].getValue(a,e)}return c},f.prototype.getTypeName=function(){var a=this.getChildByRef("_type");return a&&a.getValue()||"wix:Object"},f.prototype.addChild=function(a,b){var c=this._context.getFactory().createDataItem(a);return this._children[b]=c,this.setDirty(),this.fireEvent(Constants.DataItemEvents.CHANGE,{target:this,action:Constants.DataItemEvents.CHANGE_EVENT_ACTION_ADD,child:c,ref:b}),c._parent=this,c},f.prototype.deleteChild=function(a){var b=this._children[a];return b&&(b._parent=null,delete this._children[a],this.setDirty(),this.fireEvent(Constants.DataItemEvents.CHANGE,{target:this,action:Constants.DataItemEvents.CHANGE_EVENT_ACTION_DELETE,child:b,ref:a})),b},f.prototype.replaceChild=function(a,b){b.className&&-1!=b.className.indexOf("wixapps.core.data")&&(b=this.getChildRef(b));var c=this._children[b];if(c){if(a&&a.className&&-1!=a.className.indexOf("wixapps.core.data"))c!==a&&(this._children[b]=a,this.setDirty(),this.fireEvent(Constants.DataItemEvents.CHANGE,{target:this,action:Constants.DataItemEvents.CHANGE_EVENT_ACTION_REPLACE,child:a,prevChild:c,ref:b}));else{var d=a;c.className===this._context.getFactory().getDataItemClassName(d)?c.setValue(d):(a=this._context.getFactory().createDataItem(d),a&&(this._children[b]=a,this.setDirty(),a._parent=this,this.fireEvent(Constants.DataItemEvents.CHANGE,{target:this,action:Constants.DataItemEvents.CHANGE_EVENT_ACTION_REPLACE,child:a,prevChild:c,ref:b})))}return a}},f.prototype.getChildRef=function(a){for(var b in this._children)if(this._children[b]===a)return b},f.prototype.getChildren=function(){return Object.values(this._children)},f.prototype.getChildByRef=function(a){return this._children[a]},f.prototype.getChildValue=function(a){return this._children&&void 0!==this._children[a]?this._children[a].getValue():void 0},f.prototype.getChildrenRefs=function(){return Object.keys(this._children)},f.prototype.setValue=function(a){this.startEventAggregation(),this._applyData(a),this.releaseEventAggregation()},f.prototype.setInitialValue=function(a){var b;for(var c in a)b=this._context.getFactory().createDataItem(a[c]),b&&(b._parent=this,this._children[c]=b)},f.prototype.isDirty=function(){if(c.prototype.isDirty.call(this))return!0;for(var a=this.getChildrenRefs(),b=0;b<a.length;b++)if(this._children[a[b]].isDirty())return!0;return!1},f.prototype.resetDirtyFlag=function(){c.prototype.resetDirtyFlag.call(this);for(var a=this.getChildrenRefs(),b=0;b<a.length;b++)this._children[a[b]].resetDirtyFlag()},f.prototype._applyData=function(a){for(var b in a)void 0===this._children[b]?this.addChild(a[b],b):this.replaceChild(a[b],b);for(b in this._children)void 0===a[b]&&this.deleteChild(b)};var g=W.Classes.get("wixapps.core.expressions.Expression"),h=function(a){return this._exprSource=null,this._expr=null,c.call(this,a),this};a(h,c),h.prototype.setValue=function(a){this._exprSource=a,this._expr=new g(this._context.getFunctionLibrary()),this._expr.parseExpression(this._exprSource.$expr),this._defaultValue=this._exprSource.$default,this._value=void 0},h.prototype.getChangeDispatchers=function(a){var b=this._expr.getSymbolItems(a.getSymbolResolver()),c=_.reduce(this._expr.getFunctionCalls(),function(a,b){return b.getExtraChangeDispatchers?a.concat(b.getExtraChangeDispatchers()):a},[]);return[].concat(b,c)},h.prototype.getValue=function(a,b){if(0===a)return this._exprSource;if(b){if(void 0===this._defaultValue)return this._expr.evaluate(b.getSymbolResolver());var c;try{c=this._expr.evaluate(b.getSymbolResolver())}catch(d){c=this._defaultValue}return c}return this._exprSource};var i=function(a){return c.call(this,a),this._ref=null,this._onReferencedChange_bound=this._onReferencedChange.bind(this),this};i.prototype.DEFAULT_MAX_REF_DEPTH=1,a(i,c),i.prototype.setValue=function(a){var b=this._ref;this._ref=Object.clone(a),this._resolveReference(),null===b||null!=this._ref&&this._ref.collectionId==b.collectionId&&this._ref.itemId==b.itemId||(this.setDirty(),this.fireEvent(Constants.DataItemEvents.CHANGE,{target:this}))},i.prototype._resolveReference=function(){this._referenced&&this._referenced.removeEvent(Constants.DataItemEvents.CHANGE,this._onReferencedChange_bound),this._referenced=this._context.getRefResolver().deReference(this._ref.collectionId,this._ref.itemId),this._referenced&&this._referenced.addEvent(Constants.DataItemEvents.CHANGE,this._onReferencedChange_bound)},i.prototype._onReferencedChange=function(a){var b={};Object.each(a,function(a,c){b[c]=a}),a._previousTargets=a._previousTargets||[],a._previousTargets.push(this),b.currentTarget=this,this.fireEvent(Constants.DataItemEvents.CHANGE,b)},i.prototype._proxyCall=function(a,b){return!this._referenced&&this._ref&&this._resolveReference(),this._referenced?this._referenced[a].apply(this._referenced,b):void 0},i.prototype.getValue=function(a){return a=void 0===a?this.DEFAULT_MAX_REF_DEPTH:a,a--,a>=0?this._proxyCall("getValue",[a]):this._ref?Object.clone(this._ref):{}},i.prototype.isRef=function(){return!0},i.prototype.getParent=function(){return this._parent},i.prototype.getTypeName=function(){return this._proxyCall("getTypeName",arguments)},i.prototype.getChildren=function(){return this._proxyCall("getChildren",arguments)},i.prototype.getChildIndex=function(){return this._proxyCall("getChildIndex",arguments)},i.prototype.getChildByIndex=function(){return this._proxyCall("getChildByIndex",arguments)},i.prototype.getChildrenRefs=function(){return this._proxyCall("getChildrenRefs",arguments)},i.prototype.addChild=function(){return this._proxyCall("addChild",arguments)},i.prototype.deleteChild=function(){return this._proxyCall("deleteChild",arguments)},i.prototype.replaceChild=function(){return this._proxyCall("replaceChild",arguments)},i.prototype.getChildByRef=function(){return this._proxyCall("getChildByRef",arguments)},i.prototype.getChildValue=function(){return this._proxyCall("getChildValue",arguments)},i.prototype.setReferencedValue=function(){return this._proxyCall("setValue",arguments)},i.prototype.startEventAggregation=function(){this._proxyCall("startEventAggregation",arguments)},i.prototype.releaseEventAggregation=function(){this._proxyCall("releaseEventAggregation",arguments)},i.prototype.getChildRef=function(){return this._proxyCall("getChildRef",arguments)},i.prototype.getReferencedDataItem=function(){return!this._referenced&&this._ref&&this._resolveReference(),this._referenced},i.prototype.moveChildByIndex=function(){return this._proxyCall("moveChildByIndex",arguments)},i.prototype.getChildrenCount=function(){return this._proxyCall("getChildrenCount",arguments)};var j=function(a,b,d,e,f){return c.call(this,a),this._onDataContextChange_bound=this._onDataContextChange.bind(this),this._type=d,this._dataContext=f,this._getterFunc=a.getComputedFieldGetter(b,e),this._setterFunc=a.getComputedFieldSetter(b,e),this._dataContext.addEvent(Constants.DataItemEvents.CHANGE,this._onDataContextChange_bound),this};a(j,b),a(j,c),j.prototype.getTypeName=function(){return this._type},j.prototype.getValue=function(){var a,b=this._value;return void 0===this._getterFunc?this._value:(a=this._getterFunc(this._dataContext,this.passValue.bind(this)),void 0!==a&&(this._value=a,_.isEqual(this._value,b)||this.fireEvent(Constants.DataItemEvents.CHANGE,{target:this})),this._value)},j.prototype.setValue=function(a){if(void 0===this._setterFunc)throw new Error("Computed field not writable");this._setterFunc(a,this._dataContext.setValue.bind(this._dataContext),this._dataContext),this.passValue(a)},j.prototype.passValue=function(a){var b=this._value;this._value=a,this._value!==b&&this.fireEvent(Constants.DataItemEvents.CHANGE,{target:this})},j.prototype._onDataContextChange=function(){this.fireEvent(Constants.DataItemEvents.CHANGE)};var k=function(a){return c.call(this,a),this._onVirtualItemsChange_bound=this._onVirtualItemsChange.bind(this),this._onRealItemsChange_bound=this._onRealItemsChange.bind(this),this._vArray=this._context.getFactory().createDataItem([]),this._vArray.addEvent(Constants.DataItemEvents.CHANGE,this._onVirtualItemsChange_bound),this._children=[],this._ignoreChangeInReal=!1,this._ignoreChangeInVirtual=!1,this};a(k,c),k.prototype.getTypeName=function(){return"Array"},k.prototype.addEvent=function(a,b){this._vArray.addEvent(a,b)},k.prototype.addEvents=function(a){this._vArray.addEvents(a)},k.prototype.removeEvent=function(a,b){this._vArray.removeEvent(a,b)},k.prototype.removeEvents=function(a){this._vArray.removeEvents(a)},k.prototype.removeAllEvents=function(){this._vArray.removeAllEvents()},k.prototype.setChildren=function(a){for(var b=0;b<this._children.length;b++){var c=this._children[b];c.removeEvent(Constants.DataItemEvents.CHANGE,this._onRealItemsChange_bound)}this._children=a;for(var d=0;d<this._children.length;d++){var e=this._children[d];e.addEvent(Constants.DataItemEvents.CHANGE,this._onRealItemsChange_bound)}this._onRealItemsChange(),this._vArray.resetDirtyFlag()},k.prototype._convertVirtualToRealIndex=function(a){return a},k.prototype._convertRealToVirtualIndex=function(a){return a},k.prototype._onVirtualItemsChange=function(a){if(!this._ignoreChangeInVirtual){this._ignoreChangeInReal=!0;var b=-1;if(a&&a.target)for(var c=a.target;c&&-1===b;)b=this._vArray.getChildIndex(c),c=c.getParent();if(b>-1){var d=this._convertVirtualToRealIndex(b);this._children[d].setValue(this._vArray.getChildByIndex(b).getValue(0))}else for(var e=this._vArray.getChildren(),f=0;f<e.length;f++){var g=this._vArray.getChildByIndex(f),h=g.getValue(0),i=this._convertVirtualToRealIndex(f);this._children[i].setValue(h)}this._ignoreChangeInReal=!1}},k.prototype._onRealItemsChange=function(a){if(!this._ignoreChangeInReal){this._ignoreChangeInVirtual=!0;var b=-1;if(a&&a.target)for(var c=a.target;c&&-1===b;)b=this._children.indexOf(c),c=c.getParent();if(b>-1){var d=this._convertRealToVirtualIndex(b);-1!==d&&this._vArray.getChildByIndex(d).setValue(this._children[b].getValue(0))}else{var e=this._vArray.getChildren(),f=this._children.map(function(a){return a.getValue(0)});if(e.length!=f.length)this._vArray.setValue(f);else for(var g=0;g<f.length;g++){var h=this._convertRealToVirtualIndex(g);-1!==h&&e[h].setValue(f[g])}}this._ignoreChangeInVirtual=!1}},k.prototype.addChild=function(){throw"not implemented"},k.prototype.deleteChild=function(){throw"not implemented"},k.prototype.replaceChild=function(){throw"not implemented"},k.prototype.moveChildByIndex=function(){throw"not implemented"},k.prototype.getRealChildren=function(){return this._children.slice(0)},k.prototype.getChildren=function(){return this._vArray.getChildren()},k.prototype.getChildrenCount=function(){return this._vArray.getChildrenCount()},k.prototype.getValue=function(a,b){return this._vArray.getValue(a,b)},k.prototype.setValue=function(){throw"not implemented"},k.prototype.getChildIndex=function(a){var b=this._vArray.getChildIndex(a);return-1!=b?b:this._children.indexOf(a)},k.prototype.getChildByIndex=function(a){return this._vArray.getChildByIndex(a)},k.prototype.getChildValue=function(a){return this._vArray.getChildValue(a)},k.prototype.isDirty=function(){return this._vArray.isDirty()||this._children.some(function(a){return a.isDirty()})},k.prototype.resetDirtyFlag=function(){this._vArray.resetDirtyFlag(),this._children.forEach(function(a){a.resetDirtyFlag()})};var l=function(a){return k.call(this,a),this._filterFunction=function(){return!0},this};a(l,k),l.prototype._filterRealItems=function(){var a=this,b=[];this._realToVirtual={},this._virtualToReal={},_.each(this._children,function(c,d){if(a._filterFunction(c,d)){var e=b.length;b.push(c.getValue(0)),a._realToVirtual[d]=e,a._virtualToReal[e]=d}else a._realToVirtual[d]=-1}),this._ignoreChangeInVirtual=!0,this._vArray.setValue(b),this._ignoreChangeInVirtual=!1},l.prototype.setFilterFunction=function(a){this._filterFunction=a,this._filterRealItems()},l.prototype._onVirtualItemsChange=function(a){this._ignoreChangeInVirtual||(k.prototype._onVirtualItemsChange.call(this,a),this._filterRealItems())},l.prototype._onRealItemsChange=function(){this._ignoreChangeInReal||this._filterRealItems()};var m={"wixapps.core.data.DataItem":c,"wixapps.core.data.ArrayDataItem":e,"wixapps.core.data.CompositeDataItem":f,"wixapps.core.data.ExprDataItem":h,"wixapps.core.data.DataItemProxy":i,"wixapps.core.data.ComputedFieldItem":j,"wixapps.core.data.VirtualArrayDataItem":k,"wixapps.core.data.FilteredVirtualArrayDataItem":l};for(var n in m)m.hasOwnProperty(n)&&(m[n].prototype.className=n);return m}}),define.Class("wixapps.core.data.DataItemUtils",function(a){var b=a;b.methods({initialize:function(){},findExprItems:function(a){return this.findDataItems(a,"wixapps.core.data.ExprDataItem",function(a){return!(a.getParent().getChildRef&&"templates"==a.getParent().getChildRef(a)&&a.getParent().getChildValue&&"Toggle"!=a.getParent().getChildValue("name"))})},findDataItems:function(a,b,c){var d,e=[];c=c||function(){return!0};var f=typeOf(b);"function"===f?d=b:"string"===f&&(d=function(a){return a.className===b});var g=function(a){d(a)&&e.push(a),a.getChildren&&a.getChildren().each(function(a){c(a)&&g(a)})};return g(a),e},getDataItemPath:function(a,b){var c,d,e=[];for(a=a||null;b&&b!==a&&b.getParent();)c=b.getParent(),c.getChildRef?d=c.getChildRef(b):c.getChildIndex&&(d=c.getChildIndex(b)),e.push(d),b=c;return e.reverse()},resolveDataItemPath:function(a,b){for(var c,d=a;d&&b.length;)c=b.shift(),d.getChildByRef?d=d.getChildByRef(c):d.getChildByIndex&&(d=d.getChildByIndex(c));return d},createDataChangeEventList:function(a,b){var c=[];b=b||a.currentTarget;for(var d=a.events||[{type:a.type,payload:{target:a.target,action:a.action}}],e=0;e<d.length;e++){var f,g=d[e],h=g.payload.action||Constants.DataItemEvents.CHANGE;if(!g.payload.ref||"_"!==g.payload.ref.charAt(0)){f=h==Constants.DataItemEvents.CHANGE?g.payload.target:g.payload.child;var i;h===Constants.DataItemEvents.CHANGE_EVENT_ACTION_DELETE?(i=this.getDataItemPath(b,g.payload.target),i.push(g.payload.ref||g.payload.index)):i=this.getDataItemPath(b,f),c.push({type:h,item:f,path:i})}}return c}})}),define.Class("wixapps.core.data.DataMigrator",function(a){var b=a,c={FIELD_DELETED:"FieldDeleted",FIELD_TYPE_CHANGED:"FieldTypeChanged",FIELD_VALIDATIONS_CHANGED:"FieldValidationsChanged",FIELD_DEFAULT_VALUE_CHANGED:"FieldDefaultValueChanged",FIELD_ADDED:"FieldAdded",VALUE_CHANGED:"ValueChanged"};b.fields({_typesManager:null}),b.methods({initialize:function(a){this._typesManager=a},diffTypes:function(a,b){var d=this._typesManager;if(d.getTypeName(a)!=d.getTypeName(b))throw"type name change is not permitted. old name ["+d.getTypeName(a)+"] new name ["+d.getTypeName(b)+"]";for(var e=d.getFields(a),f=d.getFields(b),g={},h=0;h<f.length;h++){var i=f[h];g[i.name]=i}for(var j=[],k=[],l=0;l<e.length;l++){var m=e[l],n=m.name,o=g[n];if(o){if(m.type!=o.type){if(void 0===o.defaultValue)throw"field ["+n+"] with new type must have defaultValue";j.push({op:c.FIELD_TYPE_CHANGED,fieldName:n,oldField:m,newField:o})}if(!this._areEqual(m.defaultValue,o.defaultValue)){if(void 0===o.defaultValue)throw"field ["+n+"] with new validations must have defaultValue";j.push({op:c.FIELD_DEFAULT_VALUE_CHANGED,fieldName:n,oldField:m,newField:o})}if(!this._areEqual(m.validations,o.validations)){if(void 0===o.defaultValue)throw"field ["+n+"] with new validations must have defaultValue";j.push({op:c.FIELD_VALIDATIONS_CHANGED,fieldName:n,oldField:m,newField:o})}}else j.push({op:c.FIELD_DELETED,fieldName:n,oldField:m});k.push(m.name)}for(var p=0;p<f.length;p++)-1==k.indexOf(f[p].name)&&j.push({op:c.FIELD_ADDED,fieldName:f[p].name,newField:f[p]});return j},migrateItem:function(a,b){for(var d=Object.clone(b),e=0;e<a.length;e++){var f=a[e],g=f.fieldName;switch(f.op){case c.FIELD_DELETED:delete d[g],delete d.links[g];break;case c.FIELD_TYPE_CHANGED:d[g]=this._convertType(d[g],f.oldField.type,f.newField.type,f.newField.defaultValue);break;case c.FIELD_VALIDATIONS_CHANGED:this._typesManager.validateValue(d[g],f.newField)||(d[g]=f.newField.defaultValue);break;case c.FIELD_DEFAULT_VALUE_CHANGED:d[g]=this._preformDefaultValueMigration(d[g],f.oldField,f.newField);break;case c.FIELD_ADDED:void 0!==f.newField.defaultValue&&(d[g]=f.newField.defaultValue)}}return d},_preformDefaultValueMigration:function(a,b,c){return"wix:Map"===b.type?Object.merge({},c.defaultValue,a):a},_convertType:function(a,b,c,d){return d},_areEqual:function(a,b){var c=void 0!==a&&null!==a,d=void 0!==b&&null!==b;if(c!=d)return!1;var e=typeof a,f=typeof b;if(e!=f)return!1;switch(e){case"object":var g=Object.keys(a),h=Object.keys(b);if(g.length!=h.length)return!1;for(var i=0;i<g.length;i++){var j=g[i],k=a[j],l=b[j];if(!this._areEqual(k,l))return!1}break;case"array":if(a.length!=b.length)return!1;for(var m=0;m<a.length;m++)if(!this._areEqual(a[m],b[m]))return!1;break;default:return a===b}return!0}})}),define.Class("wixapps.core.data.DataPagination",function(a){var b=a;b.inherits("bootstrap.utils.Events"),b.binds(["_onSourceChange","nextPage","prevPage","getTotalItemsCount","setPageByItemIndex"]),b.statics({PAGINATION_REFRESH:"pagination_refresh",PAGINATION_UPDATED:"pagination_updated"}),b.fields({_source:null,_target:null,_pos:0,_size:1/0}),b.methods({initialize:function(a,b,c){if(this._source=a,this._dataItemFactory=b,this._target=b.createDataItem([]),c&&0>c)throw new Error("Page size must be equal or larger than 1");this._size=c?c:1/0,this._source.addEvent(Constants.DataItemEvents.CHANGE,this._onSourceChange)},getData:function(){return this._target.getValue().length||this._updateData(),this._target},setPosition:function(a,b){if(this._pos!==a||this._size!==b){var c=b||this._size;if(0>a||a>=this.getTotalItemsCount()||a%b!==0||0>b)throw new Error("Given size and position in paginated list are illegal");this._size=c,this._pos=a,this._updateData(),this.fireEvent(this.PAGINATION_REFRESH)}},getPosition:function(){return this._pos},getPageSize:function(){return this._size},nextPage:function(){var a=this._source.getChildrenCount();this._size<a&&(this._pos+=this._size,this._pos>=a&&(this._pos=0),this._updateData(),this.fireEvent(this.PAGINATION_REFRESH))},prevPage:function(){var a=this._source.getChildrenCount();if(this._size<a){if(this._pos-=this._size,this._pos<0){var b=a%this._size;b=0!==b?b:this._size,this._pos=a-b}this._updateData(),this.fireEvent(this.PAGINATION_REFRESH)}},getTotalPageCount:function(){return 1/0===this._size?1:Math.ceil(this._source.getChildrenCount()/this._size)},getTotalItemsCount:function(){return this._source.getChildrenCount()},getPageItemsCount:function(){return this._target.getChildrenCount()},getCurrentPage:function(){return Math.floor(this._pos/this._size)+1},_updateData:function(){var a,b=this;this._target||(this._target=this._dataItemFactory.createDataItem([]));var c=this._source.getChildrenCount()-1;a=-1==this._size?c:Math.min(this._pos+this._size-1,c);var d=this._source.getChildren().slice(this._pos,a+1);d.forEach(function(a){a._parent=b._target}),this._target.setValue(d),this.fireEvent(this.PAGINATION_UPDATED)},_onSourceChange:function(){var a=this.getTotalItemsCount();this._pos>=a&&a&&(this._pos-=this._size),this._updateData()},setPageByItemIndex:function(a){var b=Math.floor(a/this._size);b!=this.getCurrentPage()-1&&(this._pos=b*this._size,this._updateData(),this.fireEvent(this.PAGINATION_REFRESH))},dispose:function(){this._source.removeEvent(Constants.DataItemEvents.CHANGE,this._onSourceChange),this._target=null,this._source=null}})}),define.Class("wixapps.core.data.DataPaginationGalleries",function(a){var b=a;b.inherits("wixapps.core.data.DataPagination"),b.methods({initialize:function(a,b,c){this.parent(a,b,c)},_updateData:function(){var a;this._target||(this._target=this._dataItemFactory.createDataItem([]));var b=this._source.getChildrenCount()-1;a=-1==this._size?b:Math.min(this._pos+this._size-1,b);var c=this._source.getChildren().slice(this._pos,a+1);this._target._children=this._dataItemFactory.createDataItem(c).getChildren()}})}),define.Class("wixapps.core.data.PrimitiveValidations",function(a){var b=a;b.fields({_byName:{}}),b.methods({initialize:function(){this._byName.arrayMaxLength=this._arrayMaxLength,this._byName.email=this._isEmail,this._byName.maxLength=this._maxLength,this._byName.minLength=this._minLength,this._byName.isNotWhitespace=this._isNotWhitespace,this._byName.isInteger=this._isInteger,this._byName.isPositive=this._isPositive,this._byName.gt=this._gt,this._byName.gte=this._gte,this._byName.lt=this._lt,this._byName.lte=this._lte,this._byName.eq=this._equals,this._byName.ne=this._notEquals},validate:function(a,b,c){var d=this._byName[a];if(!d)throw"No such validation function ["+a+"]";var e=[b];if(c&&c.length>0)for(var f=0;f<c.length;f++)e.push(c[f]);return d.apply(this,e)},_arrayMaxLength:function(a,b){return a.length<=b},_isEmail:function(a){var b=function(a){if(a.length>253)return!1;var b=a.split(".");if(b.length<2)return!1;for(var c=0;c<b.length;c++){var d=b[c];if(!d.test(/^[a-zA-Z0-9-]*$/))return!1;if(d.length>63)return!1}return!0},c=function(a){return a.test(new RegExp("^[a-zA-Z0-9!$&*-=^`|~#%'+/?_\\{\\}.]*$"))},d=a.lastIndexOf("@");if(0>d)return!1;var e=a.substring(0,d),f=a.substring(d+1);return b(f)?c(e):!1},_maxLength:function(a,b){return a.length<=b},_minLength:function(a,b){return a.length>=b},_isNotWhitespace:function(a){return a.trim().length>0},_isInteger:function(a){return isFinite(a)&&parseFloat(a)==parseInt(a,10)},_isPositive:function(a){return a>0},_gt:function(a,b){return a>b},_gte:function(a,b){return a>=b},_lt:function(a,b){return b>a},_lte:function(a,b){return b>=a},_equals:function(a,b){return a==b},_notEquals:function(a,b){return a!=b}})}),define.dataItem.multi({WIXAPPS_EXTERNAL_APPS:{type:"map",items:{ecommerce:{descriptorResourceName:"ecommerceDescriptor"}},metaData:{isPersistent:!1}}}),define.Class("wixapps.core.data.providers.ItemBasedDataProvider",function(a){var b=a;b.inherits("wixapps.core.data.providers.base.BaseDataProvider"),b.methods({initialize:function(a){this.parent(a)},loadFromDefinition:function(){},createItem:function(){throw"not implemented"},updateItem:function(){throw"not implemented"},deleteItem:function(){throw"not implemented"},readItem:function(){throw"not implemented"},readItems:function(){throw"not implemented"},query:function(){throw"not implemented"}})}),define.Class("wixapps.core.data.providers.ItemsLocalStore",function(a){var b=a;b.inherits("bootstrap.utils.Events"),b.fields({_dataItemFactory:null,_items:{},_markedDeleted:{}}),b.methods({initialize:function(a){this._dataItemFactory=a},clear:function(){this._items={},this._markedDeleted={}},get:function(a){return this._items[a]||null},put:function(a,b){var c=this._items[a];return c?c.setValue(b):(c=this._dataItemFactory.createDataItem(b),this._items[a]=c,this.fireEvent("itemAdded",c)),c},putIfNotDirty:function(a,b){var c=!1,d=this._items[a];return d?(c=d.isDirty(),c||d.setValue(b)):(d=this._dataItemFactory.createDataItem(b),this._items[a]=d,this.fireEvent("itemAdded",d)),{wasDirty:c,item:d}},insertDataItem:function(a,b){this._items[a]=b},remove:function(a){var b=this._items[a];if(b){var c=b.getValue();return this.fireEvent("itemRemoved",c),delete this._items[a],c}},each:function(a){Object.each(this._items,a)},removeAll:function(){for(var a in this._items)this.remove(a)},markItemAsDeleted:function(a){this._markedDeleted[a]=!0},unMarkItemAsDeleted:function(a){delete this._markedDeleted[a]},isItemMarkedAsDeleted:function(a){return this._markedDeleted[a]===!0},getItemsMarkedAsDeleted:function(){return Object.keys(this._markedDeleted)}})}),define.Class("wixapps.core.data.providers.base.BaseDataProvider",function(a){var b=a;b.inherits("bootstrap.utils.Events"),b.traits(["wixapps.core.apprepo.traits.AppRepoItem"]),b.fields({_appInstance:null,_type:null}),b.methods({initialize:function(a){this._appInstance=a,this._loadTypes(a.getTypesManager())},loadFromDefinition:function(a){this._type=a.type},_loadTypes:function(){throw"must implement me"},isTypeDefinitionReadOnly:function(){return!0},createType:function(){throw this.isTypeDefinitionReadOnly?"type definition is read only":"not implemented"},updateType:function(){throw this.isTypeDefinitionReadOnly?"type definition is read only":"not implemented"},deleteType:function(){throw this.isTypeDefinitionReadOnly?"type definition is read only":"not implemented"},getSerializableProperties:function(){return["type"]},reportDataItemChangeEvent:function(a,b,c,d){void 0!==b&&void 0!==c&&this.fireEvent("undoAppsDataChangedEvent",[a,b,c,d])}})}),define.Class("wixapps.core.data.providers.wixdb.WixDbBaseDataProvider",function(a){var b=a;b.inherits("wixapps.core.data.providers.ItemBasedDataProvider"),b.utilize(["wixapps.core.data.providers.ItemsLocalStore","wixapps.core.data.providers.wixdb.WixDbTransport"]),b.resources(["W.Utils"]),b.fields({_type:"WixDb",_localStore:null,_api:null}),b.methods({initialize:function(a){this.parent(a),this._localStore=new this.imports.ItemsLocalStore(a.getDataItemFactory()),this._queryStore={},this._logger=a.getLogger(),this._typesManager=a.getTypesManager(),this._api=new this.imports.WixDbTransport(a)},loadFromDefinition:function(a){this.parent(a)},getTransport:function(){return this._api},readItem:function(a,b,c){var d=this._localStore.get(a);if(d)return b(d),void 0;if(this._api.isTempStore())return c(this._logger.Errors.ITEM_NOT_FOUND),void 0;var e=function(d){var e=this._translateLoadedItem(d.item),f=this._localStore.isItemMarkedAsDeleted(a)?void 0:this._putInCacheIfNotDirty(a,e);f?b(f):c(this._logger.Errors.ITEM_NOT_FOUND)}.bind(this);this._api.readItem(a,e,c)},_updateRawDataAfterSave:function(a,b){a._createdAt=b.createdAt,a._updatedAt=b.updatedAt},readItems:function(a,b,c,d){for(var e={},f=0;f<b.length;f++)e[b[f]]=f;for(var g=function(a,b){return e[a.getChildValue("_iid")]-e[b.getChildValue("_iid")]},h=[],i=0,j=[],k=0;k<b.length;k++){var l=this._localStore.get(b[k]);l?(i++,j.push(l)):h.push(b[k])}var m=function(a){j.append(a),j.sort(g),c(j)};h.length>0?this.query(a,{_iid:{$in:h}},{},0,-1,m,d):m([])},query:function(a,b,c,d,e,f,g){this._willThrowIfTypeDoesNotExist(a);var h=JSON.stringify({typeName:a,filter:b,sort:c,skip:d,limit:e}),i=function(d){var e=[];this._queryStore[h]=1,d.items.forEach(function(a){a=this._translateLoadedItem(a);var b=a._iid;if(!this._localStore.isItemMarkedAsDeleted(b)){var c=this._localStore.get(b);if(!c||!c.isDirty()){var d=this._localStore.put(b,a);d.resetDirtyFlag(),e.push(d)}}}.bind(this));var g=!1;this._localStore.each(function(c){this._isItemModified(c)&&this._match(a,b,c.getValue(0))&&(g=!0,e.push(c))}.bind(this)),g&&this._sortQueryResults(e,c),f(e)}.bind(this);return this._api.isTempStore()||this._queryStore[h]?(this.resources.W.Utils.callLater(function(a,b,c,d,e,f){var g=this.queryLocalStore(a,b,c,d,e);f(g)},[a,b,c,d,e,f],this),void 0):(this._rewriteAndQuery(a,b,c,d,e,i,g),void 0)},_isItemModified:function(a){return a.isDirty()},_rewriteAndQuery:function(a,b,c,d,e,f,g){this._api.query(a,b,c,d,e,f,g)},_translateLoadedItem:function(a){return a},queryLocalStore:function(a,b,c,d,e){this._willThrowIfTypeDoesNotExist(a);var f=[];return this._localStore.each(function(c){this._match(a,b,c.getValue(0))&&f.push(c)}.bind(this)),this._sortQueryResults(f,c),this._cropQueryResults(f,d,e),f},_putInCacheIfNotDirty:function(a,b){var c=this._localStore.putIfNotDirty(a,b);return c.wasDirty||c.item.resetDirtyFlag(),c.item},_loadTypes:function(a){var b=this._appInstance.getAppDef().getTypes();b&&b.each(function(b){a.registerType(b)}.bind(this))},toObject:function(){return this.parent()},_sortQueryResults:function(a,b){a.sort(function(a,c){return this._compare(a.getValue(0),c.getValue(0),b)
}.bind(this))},_cropQueryResults:function(a,b,c){if(b=void 0===b||null===b?0:b,c=void 0===c||null===c?-1:c,b>0&&a.splice(0,b),c>-1){c=Math.min(c,a.length);var d=a.length-c,e=a.length-d;a.splice(e,d)}},_match:function(a,b,c){return this._typesManager.isOf(c._type,a)?this._matchIgnoreType(b,c):!1},_matchIgnoreType:function(a,b){for(var c in a)if(a.hasOwnProperty(c)){var d=a[c],e=this._evaluatePath(b,c);(!_.isArray(e)||d.hasOwnProperty("$size"))&&(e=[e]);var f=function(a){return this._matchSingleValue(d,a)}.bind(this);if(!e.some(f))return!1}return!0},_matchSingleValue:function(a,b){return"object"==typeof a?a.hasOwnProperty("$in")?a.$in.contains(b):a.hasOwnProperty("$ne")?b!=a.$ne:a.hasOwnProperty("$gt")?b>a.$gt:a.hasOwnProperty("$gte")?b>=a.$gte:a.hasOwnProperty("$lt")?b<a.$lt:a.hasOwnProperty("$lte")?b<=a.$lte:a.hasOwnProperty("$size")?a.$size==b.length:this._matchIgnoreType(a,b):b==a},_compare:function(a,b,c){var d=0;for(var e in c)if(c.hasOwnProperty(e)){var f=this._evaluatePath(a,e),g=this._evaluatePath(b,e),h=void 0===f&&void 0===g?0:void 0===f?-1:void 0===g?1:f>g?1:g>f?-1:0;if(0!==h){d=h*c[e];break}}return d},_evaluatePath:function(a,b){function c(a,b){if(null===a||void 0===a)return void 0;if(0===b.length)return a;if(_.isArray(a)){var d=_.map(a,function(a){return c(a,b)});return _.filter(d,function(a){return void 0!==a})}var e=b[0];return c(a[e],b.slice(1))}return c(a,b.split("."))},_willThrowIfTypeDoesNotExist:function(a){if(_.isUndefined(this._typesManager.getType(a)))throw"WixDbBaseDataProvider:: type ["+a+"] does not exist."}})}),define.Class("wixapps.core.data.providers.wixdb.WixDbDraftDataProvider",function(a){var b=a;b.inherits("wixapps.core.data.providers.wixdb.WixDbBaseDataProvider"),b.utilize(["wixapps.core.data.DataMigrator"]),b.binds(["_migrateLinks","updateTypeWithUniqueDisplayName"]),b.fields({_dataMigrator:null,_typeDiffs:{},_managedTypes:{},_newTypes:[],_deletedTypes:[],_createdItemIds:[],_appInstance:null,_adminTypeMigrations:[]}),b.methods({initialize:function(a){this.parent(a),this._dataMigrator=new this.imports.DataMigrator(a.getTypesManager()),this._appInstance=a,this._addAdminTypeMigrations();for(var b=this.getManagedTypes(),c=0;c<b.length;c++)this.adminTypeMigration(b[c])},_addAdminTypeMigrations:function(){this._adminTypeMigrations.push(this._migrateLinks),this._adminTypeMigrations.push(this._ensureTitleField),this._adminTypeMigrations.push(this.updateTypeWithUniqueDisplayName)},updateTypeWithUniqueDisplayName:function(a){for(var b=this.getManagedTypes(),c=[],d=0;d<b.length;d++){var e=b[d];e.name!=a.name&&c.push(e.displayName)}for(var f=0,g=a.displayName,h=g;c.contains(h);)f++,h=g+" "+f;return a.displayName=h,a},isTypeDefinitionReadOnly:function(){return!1},takeRevisionSnapshot:function(a){this._api.takeRevisionSnapshot(a)},save:function(a,b,c){if(b=b||function(){},c=c||function(){},this._api.isTempStore())throw"cannot save draft to temp store";this._typeDiffs={},this._newTypes=[],this._deletedTypes=[];for(var d=function(a,d){for(var e=[],f=null,g=null,h=0;h<a.results.length;h++)if(a.results[h].success){var i=a.results[h].payload,j=d[h];switch(j.name){case"CreateItem":f=Object.clone(j.params.item),f._iid=i.id,this._updateRawDataAfterSave(f,i),g=this._localStore.put(i.id,f),this._createdItemIds.erase(i.id),g.resetDirtyFlag();break;case"UpdateItem":f=Object.clone(j.params.item),this._updateRawDataAfterSave(f,i),g=this._localStore.put(f._iid,f),g.resetDirtyFlag();break;case"DeleteItem":this._localStore.unMarkItemAsDeleted(j.params.itemId)}}else e.push(a.results[h]);e.length>0?c(e,a,d):b(a,d)}.bind(this),e=this._localStore.getItemsMarkedAsDeleted(),f=[],g=0;g<this._createdItemIds.length;g++){var h=this._createdItemIds[g];f.push(this._localStore.get(h))}var i=[];this._localStore.each(function(a,b){this._createdItemIds.contains(b)||i.push(a)}.bind(this)),this._api.activateBatchMode();try{for(var j=0;j<e.length;j++)this._api.deleteItem(e[j]);for(var k=0;k<f.length;k++)this._api.createItem(f[k].getValue(0));for(var l=0;l<i.length;l++)this._api.updateItem(i[l].getValue(0));this._api.sendBatchAndDeactivate(a,d,c)}finally{this.getTransport().discardBatch()}},_doesExistOnServer:function(a){return a._updatedAt},_getInNewState:function(a){return _.omit(a,"_createdAt","_updatedAt","_permissions")},createItem:function(a,b,c){b=b||function(){},c=c||function(){};var d=a.getValue(0);d._iid||(d._iid=W.Utils.getUniqueId("i"));var e=this._localStore.get(d._iid),f=this._localStore.isItemMarkedAsDeleted(d._iid);if(f)this._localStore.unMarkItemAsDeleted(d._iid);else{if(e||this._doesExistOnServer(d))return c(this._logger.Errors.CREATE_ITEM_CALLED_FOR_NON_NEW),void 0;this._createdItemIds.push(d._iid)}var g=this._localStore.put(d._iid,d);b(g)},restoreItem:function(a,b,c){var d=a.getValue(0),e=d._iid,f=this._localStore.get(e);if(void 0===e)return c(this._logger.Errors.RESTORE_ITEM_CALLED_FOR_NEW),void 0;if(f)return c(this._logger.Errors.RESTORE_ITEM_CALLED_FOR_EXISTING),void 0;var g=this._doesExistOnServer(d),h=this._localStore.isItemMarkedAsDeleted(e);g?h?this._localStore.unMarkItemAsDeleted(e):this._deletedTypes.contains(d._type)||(d=this._getInNewState(d),this._createdItemIds.push(e)):this._createdItemIds.push(e);var i=this._localStore.put(e,d);b(i)},updateItem:function(a,b,c){b=b||function(){},c=c||function(){};var d=a.getValue(0);if(!d._iid)return c(this._logger.Errors.UPDATE_ITEM_CALLED_FOR_NEW),void 0;var e=this._localStore.get(d._iid);if(!e)return c(this._logger.Errors.UPDATE_ITEM_CALLED_FOR_NEW),void 0;var f=this._localStore.put(d._iid,d);b(f)},deleteItem:function(a,b,c){b=b||function(){},c=c||function(){},this._createdItemIds.erase(a);var d=this._localStore.remove(a),e=this._appInstance.getTypesManager().getType(d._type),f=void 0!==e,g=this._doesExistOnServer(d);g&&f&&this._localStore.markItemAsDeleted(a),b(a,d)},_isItemModified:function(a){var b=a.getChildValue("_iid");return a.isDirty()||this._createdItemIds.contains(b)},_rewriteAndQuery:function(a,b,c,d,e,f,g){this._newTypes.contains(a)?f({items:[]}):this._api.query(a,b,c,d,e,f,g)},createType:function(a,b){var c=this._appInstance.getTypesManager();c.registerType(a);var d=c.getTypeName(a);this._addManagedType(d),b||this._newTypes.push(d)},restoreType:function(a,b,c,d){var e=this._appInstance.getTypesManager(),f=e.getTypeName(a),g=this._deletedTypes.contains(f);this.createType(a,g);var h=[],i=function(a){h.push(a),h.length===b.length&&c(h)},j=this;_.forEach(b,function(a){j.restoreItem(a,i,d)}),g&&this._deletedTypes.splice(this._deletedTypes.indexOf(f))},updateType:function(a){var b=this._appInstance.getTypesManager(),c=b.getTypeName(a),d=b.getType(c),e=this._dataMigrator.diffTypes(d,a),f=[];return e.length>0&&this._getDiffsForType(c).append(e),b.registerType(a),e.length>0&&this._appInstance.fireEvent(Constants.WixAppEvents.TYPE_CHANGE,{typeName:c,oldType:d,newType:a}),this._localStore.each(function(a){if(a.getTypeName()==c){var b=a.getValue(0),d=a.isDirty(),g=this._dataMigrator.migrateItem(e,b);a.setValue(g),d||a.resetDirtyFlag(),f.push({dataItem:a,dataItemId:b._iid,oldValue:b,newValue:g})}}.bind(this)),f},deleteType:function(a){var b=function(){};this._appInstance.getTypesManager().removeType(a),this._localStore.each(function(c,d){c.getTypeName()==a&&this.deleteItem(d,b,b)}.bind(this)),this._removeManagedType(a),this._newTypes=_.without(this._newTypes,a),this._deletedTypes.push(a)},_getDiffsForType:function(a){var b=this._typeDiffs[a];return b||(b=[],this._typeDiffs[a]=b),b},_translateLoadedItem:function(a){this.parent(a);var b=this._getDiffsForType(a._type);return b.length>0?this._dataMigrator.migrateItem(b,a):a},_loadTypes:function(a){var b=this._appInstance.getAppDef().getTypes();b=b||[];for(var c=0;c<b.length;c++)this._addManagedType(a.getTypeName(b[c]));this.parent(a)},_addManagedType:function(a){this._managedTypes[a]=!0},_removeManagedType:function(a){delete this._managedTypes[a]},_getManagedTypes:function(){return Object.keys(this._managedTypes)},getManagedTypes:function(){for(var a=[],b=this._getManagedTypes(),c=0;c<b.length;c++){var d=b[c],e=this._appInstance.getTypesManager().getType(d);a.push(e)}return a},registerDataItemsChange:function(a,b){if(!this._dataItemChangeCallbacksSet){var c=this;this._localStore.addEvent("itemAdded",function(b){a(b,c)}),this._localStore.addEvent("itemRemoved",function(a){b(a._iid)}),this._dataItemChangeCallbacksSet=!0}},adminTypeMigration:function(a){for(var b=0;b<this._adminTypeMigrations.length;b++){var c=this._adminTypeMigrations[b];a=c(a)}return this.updateType(a),a},_migrateLinks:function(a){var b=Object.clone(a);return this._ensureLinksFieldOnTypes(b),b},_ensureTitleField:function(a){var b=Object.clone(a);if(b){var c=b.fields.first(function(a){return"title"===a.name});c?c.displayName="Title":b.fields.unshift({name:"title",displayName:"Title",type:"String",defaultValue:"I'm a title"})}return b},_ensureLinksFieldOnTypes:function(a){if(a){var b=a.fields.some(function(a){return"links"===a.name});b||a.fields.push({name:"links",type:"wix:Map",defaultValue:{_type:"wix:Map"}})}}})}),define.Class("wixapps.core.data.providers.wixdb.WixDbPublishedDataProvider",function(a){var b=a;b.inherits("wixapps.core.data.providers.wixdb.WixDbBaseDataProvider"),b.methods({createItem:function(a,b,c){var d=a.getValue(0),e=function(c){this._localStore.insertDataItem(c.id,a),d._iid=c.id,this._updateRawDataAfterSave(d,c),a.setValue(d),a.resetDirtyFlag(),b(a)}.bind(this);this._api.createItem(d,e,c)},updateItem:function(a,b,c){var d=a.getValue(0),e=function(a){this._updateRawDataAfterSave(d,a);var c=this._localStore.put(d._iid,d);c.resetDirtyFlag(),b(c)}.bind(this);this._api.updateItem(d,e,c)},deleteItem:function(a,b,c){var d=function(){this._localStore.remove(a),this._localStore.unMarkItemAsDeleted(a),b(a)}.bind(this);this._api.deleteItem(a,d,c)}})}),define.Class("wixapps.core.data.providers.wixdb.WixDbTransport",function(a){var b=a;b.inherits("wixapps.core.utils.WixServiceTransportBase"),b.resources(["W.Utils","W.Config"]),b.statics({operationEndPoints:{take:"snapshot"}}),b.fields({_draftStore:"<DRAFT>",_batch:null}),b.methods({_getServiceUrl:function(a){var b=window.location.origin||this._extractBasePath(window.location.href),c=this.operationEndPoints[a]||this._savedOrPublished();return b+"/apps/appBuilder/1/"+c+"/"},_savedOrPublished:function(){return this.resources.W.Config.env.$isPublicViewerFrame?"viewer":"editor"},takeRevisionSnapshot:function(a){this.doRequest("take",{},{applicationInstanceId:this._appInstance.getInstanceId(),applicationInstanceVersion:this._appInstance.getAppInstanceVersion(),revision:String(a)})},loadFromDefinition:function(a){this.parent(a),this._type=a.type},createItem:function(a,b,c){this.doRequest("CreateItem",{},{applicationInstanceId:this._appInstance.getInstanceId(),applicationInstanceVersion:this._appInstance.getAppInstanceVersion(),item:a},b,c)},updateItem:function(a,b,c){this.doRequest("UpdateItem",{},{applicationInstanceId:this._appInstance.getInstanceId(),applicationInstanceVersion:this._appInstance.getAppInstanceVersion(),item:a},b,c)},deleteItem:function(a,b,c){this.doRequest("DeleteItem",{},{applicationInstanceId:this._appInstance.getInstanceId(),applicationInstanceVersion:this._appInstance.getAppInstanceVersion(),itemId:a},b,c)},readItem:function(a,b,c){var d=this.resources.W.Utils.AppsUtils.getResourceValueSync("W.Apps"),e=d&&"owner"===d.getUserRole();this.doRequest("ReadItem",{consistentRead:e},{applicationInstanceId:this._appInstance.getInstanceId(),applicationInstanceVersion:this._appInstance.getAppInstanceVersion(),itemId:a},b,c)},query:function(a,b,c,d,e,f,g){var h=this.resources.W.Utils.AppsUtils.getResourceValueSync("W.Apps"),i=h&&"owner"===h.getUserRole();this.doRequest("Query",{consistentRead:i},{applicationInstanceId:this._appInstance.getInstanceId(),applicationInstanceVersion:this._appInstance.getAppInstanceVersion(),type:a,filter:b,sort:c,skip:d,limit:-1==e?null:e},f,g)},isTempStore:function(){return"<DRAFT>"==this._appInstance.getInstanceId()},activateBatchMode:function(){if(this._batch)throw"batch already active";this._batch=[]},discardBatch:function(){this._batch=null},sendBatchAndDeactivate:function(a,b){if(!this._batch)throw"batch mode is not active";if(0===this._batch.length)return this._batch=null,b({results:[]},[]),void 0;for(var c=30,d=[],e=0;e<this._batch.length;e+=c)d.push(this._batch.slice(e,e+c));var f={operations:this._batch};this._batch=null;for(var g=[],h=function(a,b){for(var c=0;c<a.length;c++)g.push({success:!1,errorCode:b.code,errorDescription:b.description})},i=function(a,b){g=g.concat(b.results)},j=function(b){return function(c){this.doRequest("Batch",{checkConcurrentModification:!a},{operations:b},function(a){i(b,a),c()},function(a){h(b,a),c()})}.bind(this)}.bind(this),k=this.resources.W.Utils.AppsUtils.createTaskRunner(),l=0;l<d.length;l++)k.add("batch, chunk ("+l+")",j(d[l]));k.run(function(){b({results:g},f.operations)})},doRequest:function(a,b,c,d,e){this._batch?this._batch.push({name:a,params:c}):this.parent(a,b,c,d,e)}})}),define.Class("wixapps.core.data.selectors.AllItemsOfTypeDataSelector",function(a){var b=a;b.inherits("wixapps.core.data.selectors.ListDataSelector"),b.methods({initialize:function(a,b,c){this.parent(a,b),this.setDataProvider(c)},getItems:function(a){this._dataProvider.query(this._forType,{},{title:1},0,-1,a)},getItemIds:function(a){this.getItems(function(b){var c=b.map(function(a){return a.getChildValue("_iid")});a(c)})},getItemsIdsLocally:function(){var a=this._dataProvider.queryLocalStore(this._forType,{},{title:1},0,-1);return a.map(function(a){return a.getChildValue("_iid")})},onRemoveItem:function(a){for(var b=this._appInstance.getDataSelectors().getByType(this._forType),c=0;c<b.length;c++){var d=b[c];d.isListSelector()&&d.removeItem(a)}},getLogicalTypeName:function(){return"IB.AllItemsOfTypeDataSelector"},getItemIdIndex:function(a){return this.getItemIdRealIndex(a)},getItemIdRealIndex:function(a){return this.getItemsIdsLocally().indexOf(a)}})}),define.Class("wixapps.core.data.selectors.ItemDataSelector",function(a){var b=a;b.inherits("wixapps.core.data.selectors.base.BaseDataSelector"),b.methods({getItem:function(){throw"not implemented"},getSerializableProperties:function(){return this.parent().concat(["itemId"])}})}),define.Class("wixapps.core.data.selectors.ListDataSelector",function(a){var b=a;b.inherits("wixapps.core.data.selectors.base.BaseDataSelector"),b.methods({getItems:function(){throw"not implemented"},getAllItems:function(){throw"not implemented"},getItemIdRealIndex:function(){throw"not implemented"},addItem:function(){return!1},removeItem:function(){return!1},_refresh:function(a,b){a||(a=function(){}),b||(b=function(){}),this.getItems(a,b)},setSelectedItemByIndex:function(a){this._selectedItemIndex=a,this.getAllItems(function(b){var c=b.getChildByIndex(a);this.setSelectedItem(c)}.bind(this),function(){})},getItemIdIndex:function(){throw"not implemented"},getSelectedItemIndex:function(){return this._selectedItemIndex},resetSelectedItem:function(){this._virtualSelectedItem&&(this._selectedItemIndex=-1,this._virtualSelectedItem.setValue({}))},setSelectedItem:function(a){this._virtualSelectedItem=this._virtualSelectedItem||this._dataItemFactory.createDataItem({}),this._virtualSelectedItem.setValue(a.getValue(0))},getSelectedItem:function(){return this._virtualSelectedItem},handleUndo:function(){},isSorted:function(){return!1},isListSelector:function(){return!0}})}),define.Class("wixapps.core.data.selectors.ManualSelectedItemDataSelector",function(a){var b=a;b.inherits("wixapps.core.data.selectors.ItemDataSelector"),b.fields({_itemId:null,_virtualItem:null,Extends:"wixapps.core.data.selectors.ItemDataSelector"}),b.methods({loadFromDefinition:function(a){this.parent(a),this._itemId=a.itemId},setItemId:function(a){this._itemId=a,this._itemId&&this._refresh()},_refresh:function(a,b){a||(a=function(){}),b||(b=function(){}),this.getItem(a,b)},getItem:function(a,b){var c=function(b){this._virtualItem=this._virtualItem||this._dataItemFactory.createDataItem({}),this._virtualItem.setValue(b.getValue(0)),a(this._virtualItem)}.bind(this);this._dataProvider.readItem(this._itemId,c,b)},getLogicalTypeName:function(){return"IB.ManualSelectedItem"},getSerializableProperties:function(){return this.parent().concat(["itemId"])}})}),define.Class("wixapps.core.data.selectors.ManualSelectedListDataSelector",function(a){var b=a;b.utilize(["wixapps.core.utils.WixAppsLogger"]),b.inherits("wixapps.core.data.selectors.ListDataSelector"),b.resources(["W.Config"]),b.fields({_itemIds:null,_logger:null}),b.methods({initialize:function(a,b){this.parent(a,b),this._itemIds=[],this._logger=new this.imports.WixAppsLogger},loadFromDefinition:function(a){this.parent(a);var b=_.compact(a.itemIds);b.length!==a.itemIds.length&&(this._logger.reportError(this._logger.Errors.DATA_SELECTOR_CONTAINS_NULL,this.$className,"loadFromDefinition",this._logger.SubCategory.APP_BUILDER),a=_.clone(a),a.itemIds=b),a.hiddenItemIds&&a.hiddenItemIds.length&&(a.itemIds=_.difference(a.itemIds,a.hiddenItemIds)),this._itemIds=a.itemIds},setItemIds:function(a){this._itemIds=a,this._refresh()},getItemIds:function(){return this._itemIds},_getItemIdsForQuery:function(){return this._itemIds},getItems:function(a,b){this._dataProvider.readItems(this.getSelectionType(),this._getItemIdsForQuery(),function(b){b.length!==this._getItemIdsForQuery().length&&(this.resources.W.Config.env.$isEditorViewerFrame&&this._logger.reportError(this._logger.Errors.DATA_SELECTOR_MISSING_ITEMS,this.$className,"getItems",this._logger.SubCategory.APP_BUILDER),this._itemIds=_.map(b,function(a){return a.getChildValue("_iid")})),this._virtualArray=this._virtualArray||this._dataItemFactory.createVirtualArray(),this._virtualArray.setChildren(b),this._fireSelectorRefreshed(),a(this._virtualArray)}.bind(this),b)},getAllItems:function(a,b){this._dataProvider.readItems(this.getSelectionType(),this._getItemIdsForQuery(),function(b){var c=this._dataItemFactory.createVirtualArray();c.setChildren(b),a(c)}.bind(this),b)},getItemIdIndex:function(a){return this._itemIds.indexOf(a)},getItemIdRealIndex:function(a){return this.getItemIdIndex(a)},addItem:function(a,b,c){if(void 0===c||c===this){var d=a.getChildValue("_iid");return void 0===b&&(b=0),this._itemIds.splice(b,0,d),this._refresh(),b}},removeItem:function(a,b){return void 0===b&&(b=this._itemIds.indexOf(a)),b>=0&&(this._itemIds.splice(b,1),this._refresh()),b},moveItem:function(a,b){var c=this._itemIds.splice(a,1);this._itemIds.splice(b,0,c[0]),this._refresh()},duplicate:function(a,b){var c=this.getLogicalTypeName(),d=[],e=this._dataProvider,f=this._appInstance,g=[];if(b)d=Array.clone(this._itemIds);else{this._itemIds.each(function(b){e.readItem(b,function(b){var c=b.getValue();c=e._getInNewState(c),c._type=a,b=f.getDataItemFactory().createDataItem(c),e.createItem(b,function(a){var b=a.getValue(),c=b._iid;d.push(c)},function(){})})});var h=f.getTypesManager().getType(this._forType);h=Object.clone(h),h.name=a,h.displayName=h.displayName+"_1",e.createType(h)}var i=this._appInstance.getDataSelectors().createAndRegister(c,this.getDataProvider(),a,{itemIds:d,hiddenItems:g});return i},getBiInfo:function(){var a=this._dataProvider.queryLocalStore(this._forType).length,b=this._itemIds.length;return{v:b,h:a-b,type:this._forType}},handleUndo:function(a,b,c,d){this.parent(a,b,c,d),"Move"==a&&this.moveItem(d,c)},getLogicalTypeName:function(){return"IB.ManualSelectedList"},getSerializableProperties:function(){return this.parent().concat(["itemIds"])}})}),define.Class("wixapps.core.data.selectors.NewItemOfTypeDataSelector",function(a){a.inherits("wixapps.core.data.selectors.ItemDataSelector"),a.utilize(["wixapps.core.data.DataMigrator"]),a.binds(["_onTypeChanged"]),a.fields({_defaultValues:null,_dataMigrator:null,_typesManager:null}),a.methods({initialize:function(a,b){this.parent(a,b),this._typesManager=this._appInstance.getTypesManager(),this._dataMigrator=new this.imports.DataMigrator(a.getTypesManager()),this._appInstance.addEvent(Constants.WixAppEvents.TYPE_CHANGE,this._onTypeChanged),this.setDefaultValue(b.defaultValue),this.resetItem()},_onTypeChanged:function(a){if(a.typeName===this._forType){var b=this._dataMigrator.diffTypes(a.oldType,a.newType),c=this._dataMigrator.migrateItem(b,this._virtualItem.getValue());this._virtualItem.setValue(c)}},getData:function(a){a(this._virtualItem)},setDefaultValue:function(a){if(!a)throw this.getLogicalTypeName()+"must define defaultValue";if(a._type&&a._type!==this._forType)throw"Can't set default value of type "+a._type+" on selector of type "+this._forType;delete a._iid,delete a._createdAt,delete a._updatedAt,this._defaultValues=a},getDefaultValue:function(){return this._defaultValues},resetItem:function(){var a=this._typesManager.applyDefaults(this._dataItemFactory.createDataItem({_type:this._forType}));a.setValue(_.merge(a.getValue(),this._defaultValues)),this._setItem(a)},getLogicalTypeName:function(){return"IB.NewItemOfType"},getDefinition:function(){return _.merge(this.parent(),{defaultValue:this._defaultValues})},dispose:function(){this._appInstance.removeEvent(Constants.WixAppEvents.TYPE_CHANGE,this._onTypeChanged)}})}),define.Class("wixapps.core.data.selectors.PageSelectedItemDataSelector",function(a){var b=a;b.inherits("wixapps.core.data.selectors.ItemDataSelector"),b.resources(["W.Utils"]),b.fields({_appPageId:null}),b.methods({setAppPageId:function(a){this._appPageId=a},loadFromDefinition:function(a){this.parent(a),this._appPageId=a.appPageId},_refresh:function(a,b){a||(a=function(){}),b||(b=function(){}),this.getItem(a,b)},getItem:function(a){var b=function(b){this._virtualArray=this._virtualArray||this._dataItemFactory.createVirtualArray(),this._virtualArray.setChildren([b]),this._virtualItem=this._virtualArray.getChildByIndex(0),a(this._virtualItem)}.bind(this);this._getPageLogic(function(a){a.getDisplayedDataItem(b)})},_getPageLogic:function(a){if(this._pageLogic)a(this._pageLogic);else{var b=W.Viewer.getAppPages()[this._appPageId];b&&b.node&&b.node.$logic?(this._pageLogic=b.node.$logic,a(this._pageLogic)):this.resources.W.Utils.callLater(this._getPageLogic,[a],this)}},isPageBased:function(){return!0},getLogicalTypeName:function(){return"IB.PageSelectedItem"},getSerializableProperties:function(){return this.parent().concat(["appPageId"])}})}),define.Class("wixapps.core.data.selectors.SelectedItemDataSelector",function(a){var b=a;b.inherits("wixapps.core.data.selectors.ItemDataSelector"),b.methods({setListSelectorId:function(a){this._listSelectorId=a;var b=this._appInstance.getDataSelectors().getById(this._listSelectorId);this._virtualSelectedItem=b.getSelectedItem()},loadFromDefinition:function(a){this.parent(a),this._listSelectorId=a.listSelectorId,this.setListSelectorId(this._listSelectorId)},getItem:function(a){a(this._virtualSelectedItem)},getLogicalTypeName:function(){return"IB.SelectedItemInList"},getSerializableProperties:function(){return this.parent().push("listSelectorId")}})}),define.Class("wixapps.core.data.selectors.SortedListDataSelector",function(a){a.inherits("wixapps.core.data.selectors.ListDataSelector"),a.fields({_sortField:"_createdAt",_sortAscending:!1}),a.methods({isSorted:function(){return!0},loadFromDefinition:function(a){this.parent(a),this._sortField=a.sortField||"title",this._sortAscending=void 0===a.sortAscending?!0:a.sortAscending},getDefinition:function(){var a=this.parent();return a.sortField=this._sortField,a.sortAscending=this._sortAscending,a},updateList:function(a,b){if(this._virtualArray){var c=b.getValue();a[this._sortField]!==c[this._sortField]&&this._refresh()}},handleUndo:function(a,b,c,d){"Sort"===a?(this.setSortField(c.sortField),this.sortAscending(c.ascending),this._refresh()):this.parent(a,b,c,d)},getQuerySortParameter:function(){var a={};return a[this._sortField]=this._sortAscending?1:-1,a},setSortField:function(a){this._sortField!==a&&(this._sortField=a,this._refresh())},getSortField:function(){return this._sortField},sortAscending:function(a){a=void 0===a?!0:a,this._sortAscending!==a&&(this._sortAscending=a,this._refresh())},isSortAscending:function(){return this._sortAscending},getSerializableProperties:function(){return this.parent().concat(["sortField","sortAscending"])}})}),define.Class("wixapps.core.data.selectors.StaticItemDataSelector",function(a){var b=a;b.inherits("wixapps.core.data.selectors.ItemDataSelector"),b.fields({_itemRaw:null,_dataItem:null}),b.methods({loadFromDefinition:function(a){this.parent(a),this.setStaticItem(a.itemRaw)},setStaticItem:function(a){this._itemRaw=a,this._createDataItem()},_createDataItem:function(){this._itemRaw=this._itemRaw||{},this._dataItem=this._dataItemFactory.createDataItem(this._itemRaw)},getItem:function(a,b){return this._itemRaw?(this._dataItem||this._createDataItem(),a(this._dataItem),void 0):(b(),void 0)},getLogicalTypeName:function(){return"IB.StaticItem"},getSerializableProperties:function(){return this.parent().concat(["itemRaw"])}})}),define.Class("wixapps.core.data.selectors.TagsFilteredItemsDataSelector",function(a){a.inherits("wixapps.core.data.selectors.SortedListDataSelector"),a.fields({_tagIds:[],_predefinedSettings:null}),a.methods({loadFromDefinition:function(a){this.parent(a),this._tagIds=a.tagIds||[]},getDefinition:function(){var a=this.parent();return a.tagIds=this._tagIds,a},getItems:function(a,b){var c=this._tagIds.length?{_tags:this._tagIds.length>1?{$in:this._tagIds}:_.first(this._tagIds)}:{},d=this,e=function(b){d._virtualArray=d._virtualArray||d._dataItemFactory.createVirtualArray(),d._virtualArray.setChildren(b),d._fireSelectorRefreshed(),a(d._virtualArray)};this._dataProvider.query(this._forType,c,this.getQuerySortParameter(),0,-1,e,b)},getAllItems:function(a,b){return this.getItems(a,b)},getItemIdIndex:function(a){return _.indexOf(this.getItemIds(),a)},getItemIdRealIndex:function(a){return this.getItemIdIndex(a)},getItemIds:function(){return this._virtualArray?_.pluck(this._virtualArray.getValue(),"_iid"):[]},addItem:function(a){if(!this._virtualArray)return-1;var b=a.getValue();b._tags=this._tagIds,a.setValue(b);var c=_(this._virtualArray.getValue());this.isSortAscending()||c.reverse();var d=c.sortedIndex(a,this.getSortField());this.isSortAscending()||(d=this._virtualArray.getChildrenCount()-d);var e=this._virtualArray.getRealChildren();return e.splice(d,0,a),this._virtualArray.setChildren(e),d},removeItem:function(a){if(!this._virtualArray)return-1;var b=this._virtualArray.getValue(),c=_.indexOf(_.pluck(b,"_iid"),a);if(c>-1){var d=this._virtualArray.getRealChildren();d.splice(c,1),this._virtualArray.setChildren(d),this._fireSelectorRefreshed()}return c},handleUndo:function(a,b,c,d){"TagsChanged"===a?(this.setTags(c),this._refresh()):this.parent(a,b,c,d)},updateList:function(a,b){if(this._virtualArray){var c=b.getValue();if(a._tags=a._tags||[],a._tags.length>c._tags.length){var d=_.first(_.difference(a._tags,c._tags));_.contains(this._tagIds,d)&&this._refresh()}else if(a._tags.length<c._tags.length){var e=_.first(_.difference(c._tags,a._tags));_.contains(this._tagIds,e)&&this._refresh()}else this.parent(a,b)}},setTags:function(a,b,c){this._tagIds=_.uniq(a),this._refresh(b,c)},getTags:function(){return this._tagIds},addTag:function(a){-1===_.indexOf(this._tagIds,a)&&(this._tagIds.push(a),this._refresh())},removeTag:function(a){var b=_.indexOf(this._tagIds,a);-1!==b&&(this._tagIds.splice(b,1),this._refresh())},setPredefinedSettings:function(a,b,c){this._predefinedSettings=a,this._predefinedSettings&&this._predefinedSettings.selectedTag&&(this._predefinedSettings&&"all"===this._predefinedSettings.selectedTag?this.setTags(this._predefinedSettings.tags,b,c):this.setTags([this._predefinedSettings.selectedTag],b,c))},hasPredefinedSettings:function(){return!0},getLogicalTypeName:function(){return"IB.TagsFilteredList"},getSerializableProperties:function(){return this.parent().concat(["tagIds"])}})}),define.Class("wixapps.core.data.selectors.base.BaseDataSelector",function(a){var b=a;b.statics({SELECTOR_REFRESHED:"dataSelectorRefreshed"}),b.binds(["_fireSelectorRefreshed"]),b.inherits("bootstrap.utils.Events"),b.traits(["wixapps.core.apprepo.traits.AppRepoItem"]),b.fields({_dataProvider:null,_dataProviderId:null,_appInstance:null,_dataItemFactory:null,_virtualArray:null}),b.methods({initialize:function(a,b){this._appInstance=a,this._dataItemFactory=a.getDataItemFactory(),this._forType=b,this._virtualArray=this._dataItemFactory.createVirtualArray(),this._logicalTypeName=this.getLogicalTypeName()},loadFromDefinition:function(a){this._forType=a.forType,this._type=a.type,this._id=a.id,this.setDataProvider(this._appInstance.getDataProviders().getById(a.dataProviderId))},setDataProvider:function(a){this._dataProviderId=a.getId(),this._dataProvider=a},getDataProvider:function(){return this._dataProvider},getFriendlyName:function(){return this._name},getSelectionType:function(){return this._forType},_fireSelectorRefreshed:function(){this.fireEvent(this.SELECTOR_REFRESHED,{vArray:this._virtualArray})},setSelectionType:function(a){this._forType=a},isListSelector:function(){return!1},isPageBased:function(){return!1},getBiInfo:function(){return{}},handleUndo:function(){throw"not implemented"},getLogicalTypeName:function(){throw"must implement"},getDefinition:function(){return{forType:this._forType,id:this._id,dataProviderId:this._dataProvider.getId(),logicalTypeName:this.getLogicalTypeName()}},getSerializableProperties:function(){return["logicalTypeName","dataProviderId","forType","id"]}})}),define.Class("wixapps.core.dataservice.DataService",function(a){var b=a;b.utilize(["wixapps.core.dataservice.DataServiceTransport","wixapps.core.managers.TypesManager","wixapps.core.data.DataItemFactory"]),b.fields({_api:null,_dataItemFactory:null,_cache:null,_failedQueries:[]}),b.methods({initialize:function(a,b,c){this._api=a,this._dataItemFactory=b,this._cache=c,this._dataItemFactory.registerRefResolver(this)},getTransport:function(){return this._api},getDataItemFactory:function(){return this._dataItemFactory},getItemCache:function(){return this._cache},createStore:function(a,b){this._api.createStore(a,b)},createType:function(a,b,c){this._api.createType(a,b,c)},readType:function(a,b,c){this._api.readType(a,b,c)},listTypes:function(a,b){this._api.listTypes(a,b)},deleteType:function(a,b,c){this._api.deleteType(a,b,c)},createCollection:function(a,b,c,d){this._api.createCollection(a,b,c,d)},listCollections:function(a,b){this._api.listCollections(a,b)},deleteCollection:function(a,b,c){this._api.deleteCollection(a,b,c)},createItem:function(a,b,c,d){var e=b.getValue(0),f=function(d){this._cache.insertDataItem(this._cache.key(a,d.id),b),e._iid=d.id,e._hash=d.hash,b.setValue(e),c(b)}.bind(this);this._api.createItem(a,e,f,d)},updateItem:function(a,b,c,d){var e=b.getValue(0),f=function(b){e._hash=b.hash;var d=this._cache.put(this._cache.key(a,e._iid),e);c(d)}.bind(this);this._api.updateItem(a,e,f,d)},deleteItem:function(a,b,c,d){var e=function(){this._cache.remove(this._cache.key(a,b)),c(b)}.bind(this);this._api.deleteItem(a,b,e,d)},readItem:function(a,b,c,d){var e=function(b){Object.each(b.referencedItems,function(a,b){this._cache.isItemMarkedAsDeleted(b)||this._putInCacheIfNotDirty(b,a)}.bind(this));var d=this._cache.key(a,b.item._iid),e=this._cache.isItemMarkedAsDeleted(d)?null:this._putInCacheIfNotDirty(this._cache.key(a,b.item._iid),b.item);Object.each(b.unreferencedItems,function(a){var b=this._api.getLogger(),c={description:a.errorDescription,code:a.errorCode};b.reportError(c,this.$className,"readItem",b.SubCategory.DATA_SERVICE)}.bind(this)),c(e)}.bind(this),f=function(c){var e=JSON.stringify({collectionId:a,itemId:b});this._failedQueries.contains(e)||(this._failedQueries.push(e),d(c))}.bind(this);d?this._api.readItem(a,b,e,f):this._api.readItem(a,b,e,d)},query:function(a,b,c,d,e,f,g,h){var i=this;e=e||-1;var j=function(b){var c=[],d=b;if(_.isArray(b)){var e=_.map(b,function(b){return i._cache.key(a,b._iid)
});d=_.object(e,b)}return _.each(d,function(a,b){i._cache.isItemMarkedAsDeleted(b)||c.push(i._putInCacheIfNotDirty(b,a))}),c},k=function(b){return _.map(b,function(b){return{_type:"wix:Ref<"+b.getTypeName()+">",collectionId:a,itemId:b.getChildValue("_iid")}})},l=function(d){j(d.referencedItems);var f=j(d.items);if(-1===e){var h=_.transform(f,function(b,c){var d=i._cache.key(a,c.getChildValue("_iid"));b[d]=!0});i._cache.each(function(c,d){if(!_.has(h,d)){var e=i._cache.idsFromKey(d);c.isDirty()&&e.collectionId===a&&i._match(b,c.getValue(0))&&f.push(c)}})}else f=_.take(f,e);var l=k(f);i._sortQueryResults(f,l,c),_.each(d.unreferencedItems,function(a){var b=i._api.getLogger(),c={description:a.errorDescription,code:a.errorCode};b.reportError(c,i.$className,"readItem",b.SubCategory.DATA_SERVICE)}),g(f,l,d.totalCount)},m=function(e){var f=JSON.stringify({collectionId:a,filter:b,sort:c,skip:d});i._failedQueries.contains(f)||(i._failedQueries.push(f),h(e))},n=e;if(n>-1){var o=this._cache.getItemsMarkedAsDeleted();n+=o.length}this._api.query(a,b,c,d,n,f,l,m)},signItem:function(a,b,c,d,e){this._api.signItem(a,b,c,d,e)},queryCache:function(a,b,c,d,e){var f=[],g=[];return this._cache.each(function(c,d){var e=this._cache.idsFromKey(d);e.collectionId==a&&this._match(b,c.getValue(0))&&(f.push(c),g.push({_type:"wix:Ref<"+c.getTypeName()+">",collectionId:a,itemId:e.itemId}))}.bind(this)),this._sortQueryResults(f,g,c),this._cropQueryResults(f,g,d,e),{items:f,refList:g}},_getCacheKey:function(a,b,c,d,e){var f="groupByAndCount",g=JSON.stringify({collectionId:a,typeName:b,filter:c,groupByField:d,project:e}),h=this._cache.key(f,g);return h},groupByAndCount:function(a,b,c,d,e,f,g){var h=function(g){var h=this._getCacheKey(a,b,c,d,e),i=this._cache.put(h,g);this._cache.markItemAsNonPersistent(h),f(i)}.bind(this);this._api.groupByAndCount(a,b,c,d,e,h,g)},groupByAndCountFromCache:function(a,b,c,d,e){var f=this._getCacheKey(a,b,c,d,e);return this._cache.get(f)},areReferencesResolved:function(a,b){function c(a,b){if(-1!=_.indexOf(d,a))return!0;if(d.push(a),0===b)return!0;if(a.isRef()){var e=a.getReferencedDataItem();if(!e)return!1;if(!c(e,b-1))return!1}else if(a.getChildren)for(var f=a.getChildren(),g=0;g<f.length;g++){var h=f[g];if(!c(h,b))return!1}return!0}var d=[];return c(a,b)},_putInCacheIfNotDirty:function(a,b){var c=this._cache.putIfNotDirty(a,b);return c.wasDirty||c.item.resetDirtyFlag(),c.item},_sortQueryResults:function(a,b,c){for(var d=[],e=0;e<a.length;e++)d.push({item:a[e],ref:b[e]});d=d.sort(function(a,b){return this._compare(a.item.getValue(0),b.item.getValue(0),c)}.bind(this)),a.empty(),b.empty();for(var f=0;f<d.length;f++)a.push(d[f].item),b.push(d[f].ref)},_cropQueryResults:function(a,b,c,d){if(c=void 0===c||null===c?0:c,d=void 0===d||null===d?-1:d,c>0&&(a.splice(0,c),b.splice(0,c)),d>-1){d=Math.min(d,a.length);var e=a.length-d,f=a.length-e;a.splice(f,e),b.splice(f,e)}},deReference:function(a,b){return this._cache.get(this._cache.key(a,b))||null},readItemFromCache:function(a,b){return this.deReference(a,b)},_match:function(a,b){for(var c in a)if(a.hasOwnProperty(c)){var d=a[c],e=this._evaluatePath(b,c);(!_.isArray(e)||d.hasOwnProperty("$size"))&&(e=[e]);var f=function(a){return this._matchSingleValue(d,a)}.bind(this);if(!e.some(f))return!1}return!0},_matchSingleValue:function(a,b){return"object"==typeof a?a.hasOwnProperty("$in")?a.$in.contains(b):a.hasOwnProperty("$ne")?b!=a.$ne:a.hasOwnProperty("$gt")?b>a.$gt:a.hasOwnProperty("$gte")?b>=a.$gte:a.hasOwnProperty("$lt")?b<a.$lt:a.hasOwnProperty("$lte")?b<=a.$lte:a.hasOwnProperty("$size")?a.$size==b.length:!1:b==a},_compare:function(a,b,c){var d=0;for(var e in c)if(c.hasOwnProperty(e)){var f=this._evaluatePath(a,e),g=this._evaluatePath(b,e),h=void 0===f&&void 0===g?0:void 0===f?-1:void 0===g?1:f>g?1:g>f?-1:0;if(0!==h){d=h*c[e];break}}return d},_evaluatePath:function(a,b){function c(a,b){if(null===a||void 0===a)return void 0;if(0===b.length)return a;if(_.isArray(a)){var d=_.map(a,function(a){return c(a,b)});return _.filter(d,function(a){return void 0!==a})}var e=b[0];return c(a[e],b.slice(1))}return c(a,b.split("."))}})}),define.Class("wixapps.core.dataservice.DataServiceTransport",function(a){var b=a;b.inherits("wixapps.core.dataservice.DataServiceTransportBase"),b.fields({_storeId:null}),b.methods({initialize:function(a,b,c,d){this.parent(c,d),this._storeId=a},getStoreId:function(){return this._storeId},createStore:function(a,b){this.doRequest("CreateStore",{},{storeId:this._storeId},a,b)},createType:function(a,b,c){this.doRequest("CreateType",{},{storeId:this._storeId,appDefId:this._appDefId,type:a},b,c)},readType:function(a,b,c){this.doRequest("ReadType",{},{storeId:this._storeId,appDefId:this._appDefId,typeName:a},b,c)},listTypes:function(a,b){this.doRequest("ListTypes",{},{storeId:this._storeId},a,b)},deleteType:function(a,b,c){this.doRequest("DeleteType",{},{storeId:this._storeId,appDefId:this._appDefId,typeName:a},b,c)},createCollection:function(a,b,c,d){this.doRequest("CreateCollection",{},{storeId:this._storeId,appDefId:this._appDefId,collectionId:a,typeNames:b},c,d)},listCollections:function(a,b){this.doRequest("ListCollections",{},{storeId:this._storeId},a,b)},deleteCollection:function(a,b,c){this.doRequest("DeleteCollection",{},{storeId:this._storeId,appDefId:this._appDefId,collectionId:a},b,c)},createItem:function(a,b,c,d){this.doRequest("CreateItem",{},{storeId:this._storeId,appDefId:this._appDefId,collectionId:a,item:b},c,d)},updateItem:function(a,b,c,d){this.doRequest("UpdateItem",{},{storeId:this._storeId,appDefId:this._appDefId,collectionId:a,item:b},c,d)},deleteItem:function(a,b,c,d){this.doRequest("DeleteItem",{},{storeId:this._storeId,appDefId:this._appDefId,collectionId:a,itemId:b},c,d)},readItem:function(a,b,c,d){var e=this.resources.W.Utils.AppsUtils.getResourceValueSync("W.Apps"),f=e&&"owner"===e.getUserRole();this.doRequest("ReadItem",{consistentRead:f},{storeId:this._storeId,appDefId:this._appDefId,collectionId:a,itemId:b,autoDereferenceLevel:3},c,d)},query:function(a,b,c,d,e,f,g,h){b=b||{},c=c||{};var i=this.resources.W.Utils.AppsUtils.getResourceValueSync("W.Apps"),j=i&&"owner"===i.getUserRole();this.doRequest("Query",{consistentRead:j},{getTotalCount:f,storeId:this._storeId,appDefId:this._appDefId,collectionId:a,filter:b,sort:c,skip:d,limit:-1==e?null:e,autoDereferenceLevel:3},g,h)},groupByAndCount:function(a,b,c,d,e,f,g){c=c||{},e=e||{};var h=this.resources.W.Utils.AppsUtils.getResourceValueSync("W.Apps"),i=h&&"owner"===h.getUserRole();this.doRequest("GroupByAndCount",{consistentRead:i},{storeId:this._storeId,appDefId:this._appDefId,collectionId:a,type:b,filter:c,field:d,project:e},f,g)},signItem:function(a,b,c,d,e){this.doRequest("SignItem",{consistentRead:!0},{storeId:this._storeId,appDefId:this._appDefId,collectionId:a,itemId:b,template:c},d,e)}})}),define.Class("wixapps.core.dataservice.DataServiceTransportBase",function(a){var b=a;b.utilize(["wixapps.core.utils.WixAppsLogger"]),b.resources(["W.Utils"]),b.fields({_serviceUrl:null,_userProperties:null,_accessToken:null,_logger:null}),b.methods({initialize:function(a,b){this._userProperties=a,this._accessToken=b;var c=window.location.origin||this._extractBasePath(window.location.href);this._serviceUrl=c+"/apps/lists/1/"},_extractBasePath:function(a){var b=document.createElement("a");return b.href=a,b.protocol+"//"+b.hostname},getLogger:function(){return this._logger||(this._logger=new this.imports.WixAppsLogger),this._logger},doRequest:function(a,b,c,d,e){e||(e=function(a){throw a.description+" ("+a.code+")"});var f=function(a){var b=this.getLogger();b.reportError(a,this.$className,"doRequest",b.SubCategory.DATA_SERVICE)}.bind(this),g=function(a){if(a.success)d(a.payload);else{var b={code:a.errorCode,description:a.errorDescription};f(b),e(b)}}.bind(this),h=function(a){var b={code:a.status?a.status:-1,description:a.statusText?a.statusText:"Unspecified error occurred, possibly a connection problem"};f(b),e(b)};this._postJsonRequest(a,b,c,g,h)},_postJsonRequest:function(a,b,c,d,e){var f=this.resources.W.Utils.AppsUtils.urlBuilder(this._serviceUrl);f.combinePath(a),f.addParams(b);var g=new this.resources.W.Utils.AppsUtils.JSONNative({url:f.toString(),urlEncoded:!1,onSuccess:d,onFailure:e});g.options=g.options||{},g.options.headers=g.options.headers||{},g.options.headers["If-Modified-Since"]="Sat, 1 Jan 2005 00:00:00 GMT",g.options.headers["Content-Type"]="application/json; charset=utf-8",g.options.headers["x-wix-user-properties"]=this._userProperties,g.options.headers["x-wix-access-token"]=this._accessToken,g.post(JSON.stringify(c))}})}),define.Class("wixapps.core.dataservice.ItemCache",function(a){var b=a;b.fields({_dataItemFactory:null,_items:{},_markedNonPersistent:{},_markedDeleted:{}}),b.methods({initialize:function(a){this._dataItemFactory=a},get:function(a){return this._items[a]||null},put:function(a,b){var c=this._items[a];return c?c.setValue(b):(c=this._dataItemFactory.createDataItem(b),this._items[a]=c),c},putIfNotDirty:function(a,b){var c=!1,d=this._items[a];return d?(c=d.isDirty(),c||d.setValue(b)):(d=this._dataItemFactory.createDataItem(b),this._items[a]=d),{wasDirty:c,item:d}},insertDataItem:function(a,b){this._items[a]=b},remove:function(a){delete this._items[a]},key:function(a,b){return a+"/"+b},idsFromKey:function(a){var b=a.split("/");return{collectionId:b[0],itemId:b[1]}},each:function(a){Object.each(this._items,a)},removeAll:function(){for(var a in this._items)delete this._items[a]},markItemAsDeleted:function(a){this._markedDeleted[a]=!0},unMarkItemAsDeleted:function(a){delete this._markedDeleted[a]},isItemMarkedAsDeleted:function(a){return this._markedDeleted[a]===!0},getItemsMarkedAsDeleted:function(){return Object.keys(this._markedDeleted)},markItemAsNonPersistent:function(a){this._markedNonPersistent[a]=!0},unMarkItemAsNonPersistent:function(a){delete this._markedNonPersistent[a]},isItemMarkedAsNonPersistent:function(a){return this._markedNonPersistent[a]===!0},getItemsMarkedAsNonPersistent:function(){return Object.keys(this._markedNonPersistent)},isNewItem:function(a){return"undefined"==typeof a.getChildValue("_hash")},getNewItems:function(a){a=!!a;var b=this,c=[];return this.each(function(d,e){b.isNewItem(d)&&(a||!b.isItemMarkedAsNonPersistent(e))&&c.push(d)}),c}})}),define.Class("wixapps.core.events.EventAggregator",function(a){var b=a;b.binds(["_aggregatingDispatchFunc"]),b.fields({_aggregatedEvents:[],_eventFilter:[],_originalFireEventFunc:null}),b.methods({initialize:function(){this._originalFireEventFunc=this.fireEvent},startEventAggregation:function(a){this._eventFilter=a||[],this.fireEvent=this._aggregatingDispatchFunc},releaseEventAggregation:function(a){a=a||Constants.DataItemEvents.CHANGE,this.fireEvent=this._originalFireEventFunc,this._aggregatedEvents.length>0&&this.fireEvent(a,{target:this,events:this._aggregatedEvents}),this._aggregatedEvents=[]},_aggregatingDispatchFunc:function(a,b){0===this._eventFilter.length||this._eventFilter.contains(a)?b.events?this._aggregatedEvents=this._aggregatedEvents.concat(b.events):this._aggregatedEvents.push({type:a,payload:b}):this._originalFireEventFunc(a,b)}})}),define.Class("wixapps.core.events.ProxyEventBus",function(a){var b=a;b.inherits("bootstrap.utils.Events"),b.utilize(["wixapps.core.events.TreePath"]),b.fields({_map:null,_originals:[],_interceptors:[]}),b.methods({initialize:function(){this._map={same:Constants.WixAppTreeRelation.THIS,parent:Constants.WixAppTreeRelation.PARENT,ancestor:Constants.WixAppTreeRelation.ANCESTOR,sibling:Constants.WixAppTreeRelation.SIBLING,descendant:Constants.WixAppTreeRelation.DESCENDANT,"parent-descendant":Constants.WixAppTreeRelation.PARENT_DESCENDANT,"sibling-descendant":Constants.WixAppTreeRelation.SIBLING_DESCENDANT}},fireProxyEvent:function(a,b,c,d){c.sender=a,c.context=a.getViewContext(),c.data=a.getData(),c.def=a.getViewDefinition(),c.type=b,this.fireEvent(b,c,d)},addEventFilteredByScope:function(a,b,c,d,e){b||(b="same");var f=this._map[b];if(!f&&"any"!=b)throw'"'+b+'" is invalid scope value';var g=function(c){var e=c&&c.context&&c.context.getEnvironment().getTreePath(),g=a.getEnvironment().getTreePath();("any"==b||g&&e&&g.isOtherRelatedToThisAs(e,f))&&d(c)};this._originals.push(d),this._interceptors.push(g),this.addEvent(c,g,e)},removeEvent:function(a,b){var c=this._originals.indexOf(b),d=-1==c?b:this._interceptors[c];-1!=c&&(this._originals.splice(c,1),this._interceptors.splice(c,1)),this.parent(a,d)}})}),define.Const("WixAppTreeRelation",{PARENT:1,ANCESTOR:2,SIBLING:4,DESCENDANT:8,PARENT_DESCENDANT:16,SIBLING_DESCENDANT:32,THIS:64}),define.Class("wixapps.core.events.TreePath",function(a){var b=a,c=0;b.fields({_path:null}),b.methods({initialize:function(a){this._path=a?a._path.clone():[]},pushScope:function(){this._path.push(c++)},isOtherRelatedToThisAs:function(a,b){switch(b){case Constants.WixAppTreeRelation.THIS:return this._path.length==a._path.length&&this._path.every(function(b,c){return a._path[c]==b});case Constants.WixAppTreeRelation.PARENT:return!this.isRoot()&&a.get(-1)==this.get(-2);case Constants.WixAppTreeRelation.ANCESTOR:return-1!=this._path.indexOf(a.get(-1));case Constants.WixAppTreeRelation.SIBLING:return this._path.length==a._path.length&&this.get(-2)==a.get(-2);case Constants.WixAppTreeRelation.DESCENDANT:return a.isOtherRelatedToThisAs(this,Constants.WixAppTreeRelation.ANCESTOR);case Constants.WixAppTreeRelation.PARENT_DESCENDANT:return this.isRoot()||a.isOtherRelatedToThisAs(this._createTempParent(),Constants.WixAppTreeRelation.ANCESTOR);case Constants.WixAppTreeRelation.SIBLING_DESCENDANT:return this.isOtherRelatedToThisAs(a,Constants.WixAppTreeRelation.PARENT_DESCENDANT)&&!this.isOtherRelatedToThisAs(a,Constants.WixAppTreeRelation.PARENT)&&!this.isOtherRelatedToThisAs(a,Constants.WixAppTreeRelation.DESCENDANT)}},_createTempParent:function(){var a=new this.constructor(this);return a._path=this._path.slice(0,-1),a},isRoot:function(){return 1==this._path.length},get:function(a){return this._path[(this._path.length+a)%this._path.length]}})}),define.Class("wixapps.core.expressions.CustomFunctionLibrary",function(a){var b=a;b.utilize(["bootstrap.utils.Events"]),b.fields({_parentLibrary:null,_fnDict:{}}),b.methods({initialize:function(a){this._parentLibrary=a},getFunctionByName:function(a){return this._parentLibrary?this._fnDict[a]||this._parentLibrary.getFunctionByName(a):this._fnDict[a]},createChild:function(){var a=this.constructor;return new a(this)},addFunction:function(a,b){return this._fnDict[a]=b,b},addFunctionWithTrigger:function(a,b){var c=new this.imports.Events,d=function(){c.fireEvent(Constants.DataItemEvents.CHANGE)},e=b(d);e.getExtraChangeDispatchers=function(){return[c]},this.addFunction(a,e)}})}),define.Class("wixapps.core.expressions.EvalScopeWrapper",function(a){var b=a;b.binds(["_onSourceChange","_onEvaluationContextChange"]),b.utilize(["wixapps.core.data.DataItemFactory","wixapps.core.data.DataItemUtils"]),b.fields({_source:null,_evaluationContext:null,_maxRefDepth:0,_data:null,_dataItemFactory:null,_dataItemUtils:null,_evalPending:!1,_changeUpdateTimeChunk:0}),b.methods({initialize:function(a,b,c,d){this._source=a,this._evaluationContext=b,this._viewEnvironment=c,this._maxRefDepth=d,this._dataItemFactory=this._viewEnvironment.getDataItemFactory(),this._dataItemUtils=new this.imports.DataItemUtils,this.evaluateData(),this._source.addEvent(Constants.DataItemEvents.CHANGE,this._onSourceChange),this._exprChangeDispatchers=this._getExprChangeDispatchers(this._source,this._evaluationContext),this._exprChangeDispatchers.each(function(a){a.addEvent(Constants.DataItemEvents.CHANGE,this._onEvaluationContextChange)}.bind(this))},evaluateData:function(){var a=this._source.getValue(this._maxRefDepth,this._evaluationContext);null===this._data?this._data=this._dataItemFactory.createDataItem(a):this._data.setValue(a)},getData:function(){return this._data},_onSourceChange:function(){this._requestEvaluation()},_onEvaluationContextChange:function(){this._requestEvaluation()},_requestEvaluation:function(){this._evalPending===!1&&(this._evalPending=!0,setTimeout(function(){this.evaluateData(),this._evalPending=!1}.bind(this),this._changeUpdateTimeChunk))},_getExprChangeDispatchers:function(a,b){return this._dataItemUtils.findExprItems(a).reduce(function(a,c){var d=c.getChangeDispatchers(b)||[];return Array.concat(a,d)},[]).reduce(function(a,b){return-1==a.indexOf(b)?a.concat(b):a},[])},dispose:function(){this._exprChangeDispatchers.each(function(a){a.removeEvent(Constants.DataItemEvents.CHANGE,this._onEvaluationContextChange)}),this._exprChangeDispatchers=null,this._source.removeEvent(Constants.DataItemEvents.CHANGE,this._onSourceChange),this._source=null}})}),define.Class("wixapps.core.expressions.Expression",function(a){var b=a;b.utilize(["wixapps.core.expressions.ExpressionParser"]),b.fields({_funcLib:null,_expr:null,_exprSource:""});var c=null;b.methods({initialize:function(a){c||(c=new this.imports.ExpressionParser),this._funcLib=a},parseExpression:function(a){this._exprSource=a,this._expr=c.parseExpressionSource(a)[0]},getSymbolItems:function(a){var b=function(c,d){return"ref"==d.type?c.concat(a.resolveExpressionReference(d.content)):"function"==d.type?c.concat(_.reduce(d.params,b,[])):c};return _([this._expr]).reduce(b,[]).filter(function(a){return a.addEvent}).valueOf()},getFunctionCalls:function(){var a=this,b=function(c,d){if("function"==d.type){var e=a._funcLib.getFunctionByName(d.content);return c.concat(e||[],_.reduce(d.params,b,[]))}return c};return _([this._expr]).reduce(b,[]).valueOf()},evaluate:function(a){var b=this,c=function(a,d,e){if("function"==a.type){var f=d.getFunctionByName(a.content),g=Array.map(a.params,function(a){return c(a,d,e)});if(f)return f.apply(null,g);throw new Error("Expression: "+b._exprSource+" | Cannot resolve function "+a.content+"()")}if("primitive"==a.type)return a.content;if("ref"==a.type){var h=e.evaluateExpressionReference(a.content);if(void 0===h)throw new Error("Expression: "+b._exprSource+" | Cannot resolve symbol "+a.content);return h}};return this._expr?c(this._expr,this._funcLib,a):void 0},_performDebugFunc:function(a,b){if("Debug.symbols"==a){var c=b.listSymbols();Object.each(c,function(a,b){console.log(a,"=",b)})}},dispose:function(){this._funcLib=null}})}),define.Class("wixapps.core.expressions.ExpressionLexer",function(a){var b=a;b.methods({parseExpression:function(a){if(a.length){var b=this._findString(a)||this._findSymbol(a)||this._findBracket(a);return b?Array.concat([b],this.parseExpression(a.slice(b.length))):this.parseExpression(a.slice(1))}return[]},_findString:function(a){var b=["'",'"'],c=function(a,b){if(a.length){var d=a.charAt(0);if("\\"==d&&a.length>1)return String.concat(d+a.charAt(1),c(a.slice(2),b));if(d!=b)return String.concat(d,c(a.slice(1),b))}return""},d=a.charAt(0);return b.contains(d)?String.concat('"',c(a.slice(1),d),'"'):void 0},_findSymbol:function(a){var b=/[\w\*\/\-\%\+\$]/,c=/[\w\*\/\-\%\+\.\$\[\]\?_]/,d=function(a){var b=a.charAt(0);return a.length&&b.match(c)?String.concat(b,d(a.slice(1))):""},e=a.charAt(0);return e.match(b)?String.concat(e,d(a.slice(1))):void 0},_findBracket:function(a){var b=a.charAt(0);return"("==b||")"==b?b:void 0}})}),define.Class("wixapps.core.expressions.ExpressionParser",function(a){var b=a;b.utilize(["wixapps.core.expressions.ExpressionLexer"]),b.fields({DIALECT_JS:0,DIALECT_LISP:1,_primitiveTypes:["boolean","string","number"]});var c=null;b.methods({parseExpressionSource:function(a){c||(c=new this.imports.ExpressionLexer(a));var b=c.parseExpression(a),d="("==b[0]?this.DIALECT_LISP:this.DIALECT_JS,e=this._foldTokenList(b,d);return this._foldFunctionChain(e)},_foldTokenList:function(a,b){if(a.length){var c=this._getFunction(a,b)||this._getPrimitive(a,b)||this._getReference(a,b);if(c)return Array.concat([c.node],this._foldTokenList(c.next,b))}return[]},_foldFunctionChain:function(a){var b=this._foldFunctionChain;if(a.length>0&&a.every(function(a){return"function"===a.type})){var c=a.slice(1).reduce(function(a,c){return{type:c.type,content:c.content,params:Array.concat([a],b(c.params))}},a[0]);return[c]}return a},_getFunction:function(a,b){var c=b==this.DIALECT_LISP?0:1,d=b==this.DIALECT_LISP?1:0;if("("===a[c]&&"string"===typeOf(a[d])){var e=this._getFuncParams(a);return{next:a.slice(e.length+3),node:{type:"function",content:a[d],params:this._foldTokenList(e,b)}}}},_getFuncParams:function(a){var b=function(a,c){if(a.length&&c>0){var d=a[0],e=a.slice(1);return"("==d?Array.concat([d],b(e,c+1)):")"==d?Array.concat([d],b(e,c-1)):Array.concat([d],b(e,c))}return[]};return b(a.slice(2),1).slice(0,-1)},_getPrimitive:function(a){var b,c=a[0];return"true"==c?b=!0:"false"==c?b=!1:'"'==c.charAt(0)&&'"'==c.charAt(c.length-1)||"'"==c.charAt(0)&&"'"==c.charAt(c.length-1)?b=this._unescapeString(c.slice(1,c.length-1)):isNaN(parseFloat(c,10))?isNaN(parseInt(c,10))||(b=parseInt(c,10)):b=parseFloat(c,10),void 0!==b?{next:a.slice(1),node:{type:"primitive",content:b}}:void 0},_unescapeString:function(a){return a=a.replace(/\\/g,"")},_getReference:function(a){return{next:a.slice(1),node:{type:"ref",content:a[0]}}}})}),define.Class("wixapps.core.expressions.FunctionLibrary",function(a){var b=a;b.utilize(["wixapps.core.expressions.CustomFunctionLibrary"]);var c={and:function(){for(var a=0;a<arguments.length;a++)if(arguments[a]===!1)return!1;return!0},or:function(){for(var a=0;a<arguments.length;a++)if(arguments[a]===!0)return!0;return!1},"if":function(a,b,c){return a?b:c},eq:function(a,b){return a==b},ne:function(a,b){return a!=b},not:function(a){return!a},"!":function(a){return!a},gt:function(a,b){return a>b},gte:function(a,b){return a>=b},lt:function(a,b){return b>a},lte:function(a,b){return b>=a},toString:function(a){return a.toString?a.toString():""+a},toJson:function(a){return JSON.stringify(a)},mod:function(a,b){return a%b},add:function(){for(var a=0,b=0;b<arguments.length;b++)a+=arguments[b];return a},mult:function(){for(var a=1,b=0;b<arguments.length;b++)a*=arguments[b];return a},sub:function(a,b){return a-b},div:function(a,b){return a/b},match:function(a,b,c){return a==b?c:void 0},"true?":function(a,b){return Boolean(a)===!0?b:void 0},"false?":function(a,b){return Boolean(a)===!1?b:void 0},"else":function(a,b){return void 0===a?b:a},map:function(){for(var a=1;a<arguments.length-1;a+=2)if(arguments[0]==arguments[a])return arguments[a+1];return arguments.length%2===0?arguments[arguments.length-1]:arguments[0]},Math:{floor:function(a){return Math.floor(a)},round:function(a){return Math.round(a)}},Array:{length:function(a){return a.length},isEmpty:function(a){return null==a||0===a.length},slice:function(a,b,c){return a.slice(b,c)},join:function(a,b){return a.join(b)},filter:function(a,b,c){return a.filter(function(a){return c.contains(a[b])})},itemAt:function(a,b){return a[b]}},RichText:{isEmpty:function(a){return"<div></div>"===a.text}},String:{length:function(a){return a.length},isEmpty:function(a){return null==a||0===a.length},charAt:function(a,b){return a.charAt(b)},charCodeAt:function(a,b){return a.charCodeAt(a,b)},concat:function(){return String.concat.apply(arguments[0],arguments)},indexOf:function(a,b){return a.indexOf(b)},lastIndexOf:function(a,b){return a.lastIndexOf(b)},match:function(a,b){return a.match(new RegExp(b))},replace:function(a,b,c){return a.replace(b,c)},search:function(a,b){return a.search(new RegExp(b))},slice:function(a,b,c){return a.slice(b,c)},split:function(a,b){return a.split(b)},substr:function(a,b,c){return a.substr(b,c)},substring:function(a,b,c){return a.substring(b,c)},toLowerCase:function(a){return a.toLowerCase()},toUpperCase:function(a){return a.toUpperCase()},contains:function(a,b){return a.contains(b)},trim:function(a){return a.trim()},toInt:function(a){return parseInt(a,10)},toFloat:function(a){return parseFloat(a)}},Date:{createDate:function(a){return a?new Date(a):new Date},getBefore:function(a,b,c,d){var e=d?new Date(d):new Date;return e.setDate(e.getDate()-a),e.setMonth(e.getMonth()-b),e.setFullYear(e.getFullYear()-c),e},getAfter:function(a,b,c,d){var e=d?new Date(d):new Date;return e.setDate(e.getDate()-a),e.setMonth(e.getMonth()-b),e.setFullYear(e.getFullYear()-c),e}},Styles:{fontToTextStyle:function(a){return Constants.WixApps.TEXT_STYLE_NAMES["font_"+a]}}};b.fields({_funcTable:{}}),b.methods({initialize:function(){var a=function(b,c,d){Object.each(c,function(c,e){"function"==typeOf(c)?b[d+e]=c:typeOf("object"==c)&&a(b,c,e+".")})};this._funcTable={},a(this._funcTable,c,"")},getFunctionByName:function(a){return this._funcTable[a]},createChild:function(){return new this.imports.CustomFunctionLibrary(this)}})}),define.Class("wixapps.core.expressions.IFunctionLibrary",function(a){var b=a;b.methods({getFunctionByName:function(){},createChild:function(){}})}),define.Const("FlowLayout",{Anchors:{TOP_LEFT:"top-left",BOTTOM_LEFT:"bottom-left",TOP_RIGHT:"top-right",BOTTOM_RIGHT:"bottom-right",ALL:["top-left","bottom-left","top-right","bottom-right"]}}),define.Class("wixapps.core.layouts.FlowLayout",function(a){var b=a;b.utilize(["wixapps.core.layouts.Width","wixapps.core.layouts.Padding","wixapps.core.layouts.Spacing"]),b.fields({_anchor:null,_width:null,_model:null,_elements:null,_lines:null,_defaults:null}),b.methods({initialize:function(a){this._anchor=Array.contains(Constants.FlowLayout.Anchors.ALL,a)?a:Constants.FlowLayout.Anchors.TOP_LEFT,this._defaults={spacing:new this.imports.Spacing(5),padding:new this.imports.Padding(0)}},setModel:function(a,b){this._model=Object.clone(a),this._elements=b.slice(),this._buildLines()},getHeight:function(){return this._lines.height},_getSpacing:function(){return this._model.spacing?new this.imports.Spacing(this._model.spacing):this._defaults.spacing},_getPadding:function(a){return a.padding?new this.imports.Padding(a.padding):this._defaults.padding},positionElements:function(a,b,c){a=a||this.getHeight(),b=b||0,c=c||0;for(var d=this._getSpacing(),e=0,f=0;f<this._lines.length;f++){for(var g=this._lines[f],h=0+("default"==g.align?0:"center"==g.align?Math.floor((this._model.minWidth-g.width)/2):this._model.minWidth-g.width),i=0;i<g.items.length;i++){var j=g.items[i],k=g.elements[i];this._positionElement(a,b,c,j,k,h,e,g.height),h+=g.widths[i]+d.horizontal}e+=g.height+d.vertical}},_positionElement:function(a,b,c,d,e,f,g,h){var i=d.vAlign||"bottom";this._anchor.indexOf("bottom")>-1&&("bottom"==i?i="top":"top"==i&&(i="bottom"));var j=this._getPadding(d);"middle"==i&&(g+=Math.floor((h-j.getPaddedHeight(e))/2)),"bottom"==i&&(g+=h-j.getPaddedHeight(e)),this._anchor.indexOf("bottom")>-1&&(g=a-(g+j.getPaddedHeight(e))),this._anchor.indexOf("right")>-1&&(f=this._model.minWidth-(f+j.getPaddedWidth(e))),e.setPos(b+f+j.left,c+g+j.top)},_buildLines:function(){for(var a=function(){return{height:0,width:0,items:[],elements:[],widths:[]}},b=[a()],c=this._getSpacing(),d=0;d<this._model.items.length;d++){var e=this._elements[d],f=this._model.items[d],g=this._getPadding(f),h=void 0!==f.minWidth?new this.imports.Width(f.minWidth):new this.imports.Width(this._elements[d].getWidth()),i=void 0!==f.maxWidth?new this.imports.Width(f.maxWidth):h,j=b[b.length-1],k=j.items.length>0?c.horizontal:0;j.width+k+h.toAbsolute(this._model.minWidth)>this._model.minWidth&&(j=a(),b.push(j),k=0);var l=Math.min(Math.max(i.toAbsolute(this._model.minWidth),h.toAbsolute(this._model.minWidth)),this._model.minWidth-(j.width+k));if(g.getPaddedWidth(e)!=l&&e.setWidth(l-g.getHorizontalPadding()),0===j.items.length){var m=-1!=this._anchor.indexOf("left")?"left":"right",n=f.align?f.align:m;j.align=n==m?"default":"center"==n?"center":"opposite"}j.items.push(f),j.elements.push(e),j.widths.push(l),j.width+=k+l;var o=g.getPaddedHeight(e);o>j.height&&(j.height=o),(f.last===!0||"true"===f.last)&&b.push(a())}0===b[b.length-1].items.length&&b.pop();for(var p=0,q=0;q<b.length;q++)p+=b[q].height;b.height=p+Math.max(b.length-1,0)*c.vertical,this._lines=b}})}),define.Class("wixapps.core.layouts.FourWayFlowLayout",function(a){var b=a;b.utilize(["wixapps.core.layouts.Spacing","wixapps.core.layouts.FlowLayout"]),b.fields({_model:null,_elements:null,_layouts:{},_spacing:null}),b.methods({setModel:function(a,b){this._model=Object.clone(a),this._elements=b.slice(),this._spacing=new this.imports.Spacing(void 0!==a.spacing?a.spacing:5);var c={},d={},e=function(b){var d=c[b];return d||(d={minWidth:a.minWidth,spacing:this._spacing.toString(),items:[]},c[b]=d),d}.bind(this),f=function(a){var b=d[a];return b||(b=[],d[a]=b),b};this._model.items.forEach(function(a,c){var d=Object.clone(a),g=d.anchor||Constants.FlowLayout.Anchors.TOP_LEFT;delete d.anchor,e(g).items.push(d),f(g).push(b[c])}.bind(this)),Constants.FlowLayout.Anchors.ALL.forEach(function(a){if(c[a]){var b=new this.imports.FlowLayout(a);b.setModel(c[a],d[a]),this._layouts[a]=b}else this._layouts[a]={getHeight:function(){return 0},positionElements:function(){}}}.bind(this))},getHeight:function(){var a=Constants.FlowLayout.Anchors,b=function(a,b){var c=a.getHeight(),d=b.getHeight();return c+d+(c>0&&d>0&&this._spacing.vertical>0?this._spacing.vertical:0)}.bind(this);return Math.max(b(this._layouts[a.TOP_LEFT],this._layouts[a.BOTTOM_LEFT]),b(this._layouts[a.TOP_RIGHT],this._layouts[a.BOTTOM_RIGHT]),this._model.minHeight||0)},positionElements:function(a,b,c){a=a||this.getHeight(),b=b||0,c=c||0,Constants.FlowLayout.Anchors.ALL.forEach(function(d){this._layouts[d].positionElements(a,b,c)}.bind(this))}})}),define.Class("wixapps.core.layouts.Padding",function(a){var b=a;b.fields({top:0,right:0,bottom:0,left:0}),b.methods({initialize:function(a){this.setFromString(a)},setFromString:function(a){var b=a.toString().split(/\s+/);b.length>0&&(this.top=this.bottom=this.right=this.left=parseInt(b[0],10)),b.length>1&&(this.right=this.left=parseInt(b[1],10)),b.length>2&&(this.bottom=parseInt(b[2],10)),b.length>3&&(this.left=parseInt(b[3],10))},getHorizontalPadding:function(){return this.left+this.right},getVerticalPadding:function(){return this.top+this.bottom},getPaddedWidth:function(a){return a.getWidth()+this.right+this.left},getPaddedHeight:function(a){return a.getHeight()+this.top+this.bottom}})}),define.Class("wixapps.core.layouts.Spacing",function(a){var b=a;b.fields({horizontal:0,vertical:0}),b.methods({initialize:function(a){this.setFromString(a)},setFromString:function(a){var b=a.toString().split(/\s+/);b.length>0&&(this.horizontal=this.vertical=parseInt(b[0],10)),b.length>1&&(this.vertical=this.left=parseInt(b[1],10))},toString:function(){return this.horizontal.toString()+" "+this.vertical.toString()}})}),define.Const("SuperFlowLayout",{Regions:{NORTH:"north",SOUTH:"south",EAST:"east",WEST:"west",CENTER:"center",ALL:["north","south","east","west","center"]}}),define.Class("wixapps.core.layouts.SuperFlowLayout",function(a){var b=a;b.utilize(["wixapps.core.layouts.FourWayFlowLayout"]),b.fields({_model:null,_elements:null,_widths:{},_heights:{north:0,middle:0,south:0},_layouts:{}}),b.methods({setModel:function(a,b){this._model=Object.clone(a),this._elements=b.slice();var c=Constants.SuperFlowLayout.Regions,d={};c.ALL.forEach(function(a){d[a]=this._model.regions&&this._model.regions[a]&&this._model.regions[a].minWidth||0}.bind(this)),this._widths={};var e=d[c.EAST]+d[c.CENTER]+d[c.WEST],f=Math.max(d[c.NORTH],d[c.SOUTH],e,this._model.minWidth||0);this._widths[c.NORTH]=this._widths[c.SOUTH]=f,this._widths[c.EAST]=d[c.EAST],this._widths[c.WEST]=d[c.WEST],this._widths[c.CENTER]=f-(d[c.EAST]+d[c.WEST]);var g={},h={},i=function(a){var b=g[a];if(!b){b={minWidth:this._widths[a],items:[]};var c=this._model.regions&&this._model.regions[a];c&&(void 0!==c.spacing&&(b.spacing=c.spacing),void 0!==c.minHeight&&(b.minHeight=c.minHeight)),g[a]=b}return b}.bind(this),j=function(a){var b=h[a];return b||(b=[],h[a]=b),b};this._model.items.forEach(function(a,d){var e=Object.clone(a),f=e.region||c.CENTER;delete e.region,i(f).items.push(e),j(f).push(b[d])}.bind(this)),c.ALL.forEach(function(a){if(g[a]){var b=new this.imports.FourWayFlowLayout;
b.setModel(g[a],h[a]),this._layouts[a]=b}else this._layouts[a]={getHeight:function(){return 0},positionElements:function(){}}}.bind(this)),this._heights.north=this._layouts[c.NORTH].getHeight(),this._heights.south=this._layouts[c.SOUTH].getHeight(),this._heights.middle=Math.max(this._layouts[c.CENTER].getHeight(),this._layouts[c.EAST].getHeight(),this._layouts[c.WEST].getHeight())},getHeight:function(){return this._heights.north+this._heights.middle+this._heights.south},positionElements:function(a,b,c){a=a||this.getHeight(),b=b||0,c=c||0;var d=Constants.SuperFlowLayout.Regions,e=this._layouts,f=e[d.NORTH],g=e[d.SOUTH],h=e[d.EAST],i=e[d.WEST],j=e[d.CENTER],k=b,l=c;f.positionElements(this._heights.north,k,l),l+=this._heights.north,i.positionElements(this._heights.middle,k,l),k+=this._widths[d.WEST],j.positionElements(this._heights.middle,k,l),k+=this._widths[d.CENTER],h.positionElements(this._heights.middle,k,l),k=0,l+=this._heights.middle,g.positionElements(this._heights.south,k,l)}})}),define.Class("wixapps.core.layouts.Width",function(a){var b=a;b.fields({_kind:null,_val:null}),b.methods({initialize:function(a){if("undefined"==a||null==a||!this.setFromString(a.toString()))throw"Incorrect width format: ["+a+"]"},setFromString:function(a){if(a&&/^(-?[0-9]+|[0-9]+%)$/.test(a)){var b={val:parseInt(a,10),kind:"exact"};return-1!=a.indexOf("-")&&(b.kind="offset"),-1!=a.indexOf("%")&&(b.kind="percent"),this._kind=b.kind,this._val=b.val,!0}return!1},toAbsolute:function(a){return"offset"==this._kind?a+this._val:"percent"==this._kind?Math.floor(a*this._val/100):this._val}})}),define.Const("DataEditingModel",{ContainmentOptions:{NONE:"none",DIRECT:"direct",ONE_TO_MANY_REFERENCE:"one-2-many-ref",MANY_TO_MANY_REFERENCE:"many-2-many-ref"}}),define.Class("wixapps.core.logics.AbstractDataEditingModel",function(a){var b=a;b.methods({initialize:function(){},getDataService:function(){},getTypesManager:function(){},getCategories:function(){},getCategorySections:function(){},getAddNewTypesInCategory:function(){},getAddNewTypesToParent:function(){},getQueryItems:function(){},loadTree:function(){},getTreeTopLevelItems:function(){},getTreeChildren:function(){},getChildren:function(){},getContainmentOptions:function(){},removeChild:function(){},insertChild:function(){},createItem:function(){},copyItem:function(){},getCollectionOfItem:function(){},deleteItem:function(){}})}),define.Class("wixapps.core.logics.CategoryLogic",function(a){var b=a;b.inherits("wixapps.core.logics.SingleItemLogic"),b.methods({_dsp:function(a,b){return this._environment.getAppInstance().getDescriptorValue(["dataEditing","logicParams","dataSelection",a])||b},_getDescriptorValue:function(a){return this._environment.getAppInstance().getDescriptorValue(a)},generateDataSelectorPanel:function(a,b,c){this.generateSelectionList(a,b,c)},generateSelectionList:function(a,b,c,d,e){var f=this._getItemsCollection(c),g=this._dsp("categoriesSelectionFilter",null),h=this._dsp("categoriesSelectionSort",null),i=this._dsp("categoriesSelectionSkip",null),j=this._dsp("categoriesSelectionLimit",null);this._environment.getDataService().query(f,g,h,i,j,!1,function(d){var f;if(0===d.length)a.addLabel(this._dsp("noCategoriesLabel","No categories found")),f=this._dsp("addFirstCategoryLabel","Create a new category");else{a.addLabel(this._dsp("inlineHelp","Pick which category you'd like to appear and click OK.")),f=this._dsp("anotherCategoryLabel","No thanks, I'd like to create a new category");var g=this._generateCategoriesComboSection(d,a,b,c);g.runWhenReady(function(a){e&&e.apply(this,[a])})}if(!c.dontShowCreateNew){var h=a.addButtonField(null,f,null,null,"withArrow");h.addEvent(Constants.CoreEvents.CLICK,function(){this._createNewListAndSelect(a,b,c)}.bind(this))}}.bind(this))},_createCategoryListData:function(a){for(var b,c=this._getItemsCollection(this._logicParams),d=[],e=0;e<a.length;e++)b=a[e].getValue(),d.push({value:c+"/"+b._iid,label:b.title});return d},_generateCategoriesComboSection:function(a,b,c,d){return b.addBreakLine(20),this._generateCategoriesCombo(a,b,c,d)},_generateCategoriesCombo:function(a,b,c,d){var e=this._createCategoryListData(a),f=b.addComboBoxField("",e);if(f.addEvent("inputChanged",function(a){this._changeSelectedCategory(c,a.value)}.bind(this)),d.collectionId&&d.itemId){for(var g=d.collectionId+"/"+d.itemId,h=-1,i=0;i<e.length;i++)if(e[i].value==g){h=i;break}-1!=h?f.setValue(g):e.length>0&&this._changeSelectedCategory(c,e[0].value)}return f},_createNewListAndSelect:function(a,b){var c=a.injects();if(c.Config.siteNeverSavedBefore())c.EditorDialogs.openWixAppsSiteMustBeSaved();else{var d=this._dsp("newItemType","Category"),e=this._dsp("newItemCollection","Categories"),f=this.getDataEditingModel().getItemTemplate(d,!0),g=this._dsp("newItemOverrides",{title:"New Category"});Object.each(g,function(a,b){f.getChildByRef(b).setValue(a)}),this._environment.getDataService().createItem(e,f,function(d){this._changeSelectedCategory(b,e+"/"+d.getChildValue("_iid")),a._dialogWindow.closeDialog(),c.Commands.executeCommand("WAppsEditorCommands.OpenEditDataDialog",{selectedComp:this._environment.getAppPart()})}.bind(this),function(a){c.EditorDialogs.openErrorDialog(this._dsp("newItemErrorTitle","Error creating new category"),this._dsp("newItemErrorDescription","Please try again in a few minutes"),a.code+"\n"+a.description,null)}.bind(this))}},_changeSelectedCategory:function(a,b){this._fixingItemNotFound=!1;var c=a.get("appLogicParams"),d=b.split("/")[0],e=b.split("/")[1],f={};f=Object.merge(f,a._data),c.itemId={type:"AppPartParam",value:e},c.collectionId={type:"AppPartParam",value:d};var g={};g=Object.merge(g,a._data),a.fireDataChangeEvent(void 0,g,f)},getSelectedIId:function(a,b){return b.itemId},getDataEditingMetaInfo:function(){var a=this._environment.getAppInstance(),b=a.getDescriptorValue(["dataEditing","dataSelectionLabel"])||"Choose Category",c=a.getDescriptorValue(["dataEditing","dataEditingLabel"])||"Edit Data",d=this._environment.getAppPart().getPartDef().name,e=a.getDescriptorValue(["dataEditing","useCategoryTitle"]);if((void 0===e||null===e)&&(e=!0),e){var f=this._logicParams?this._environment.getDataService().deReference(this._logicParams.collectionId,this._logicParams.itemId):null;f&&(d=d+" - "+f.getChildValue("title"),d.length>35&&(d=d.substr(0,35)+"..."))}var g=this.parent();return _.merge(g,{title:d,hasDataEdit:!0,hasDataSelection:!0,dataSelectionLabel:b,dataEditingLabel:c})}})}),define.Class("wixapps.core.logics.DescriptorDataEditingModel",function(a){var b=a;b.utilize(["wixapps.core.logics.AbstractDataEditingModel"]),b.resources(["W.Utils"]),b.fields({_logicEnv:null,_descriptor:null,_categories:[],_sectionsByCat:{},_addNewByCat:{},_sections:{},_trees:{}}),b.methods({initialize:function(a){this._logicEnv=a,this._descriptor=a.getAppInstance().getAppDescriptor(),this._parse()},getDataService:function(){return this._logicEnv.getDataService()},getTypesManager:function(){return this._logicEnv.getTypesManager()},getCategories:function(){return this._categories},getDataEditingHelpId:function(){return this._getDescriptorValue(["dataEditing","helpId"])},getItemEditingHelpId:function(){return this._getDescriptorValue(["dataEditing","itemEditingHelpId"])},getPotentialParentsTree:function(a,b){var c=this._getDescriptorValue(["dataEditing","typeMetaData",a,"parentsTreeId"]);this.loadTree(c,function(){b(this.getFullTree(c))}.bind(this))},getCategorySections:function(a){return this._sectionsByCat[a]},getCategoryHeight:function(a){for(var b=this._getDescriptorValue(["dataEditing","categories"]),c=0;c<b.length;c++)if(b[c].name===a)return b[c].height},getAddNewTypesInCategory:function(a){return this._addNewByCat[a]||[]},getAddNewTypesToParent:function(a){var b=this._getDescriptorValue(["dataEditing","typeMetaData",a.getTypeName(),"addChildrenTypes"]);if(b)return b;var c=this._getChildrenTypeField(a.getTypeName());if(c){for(var d=this.getTypesManager(),e=d.getArrayAllowedTypes(c.type),f=[],g=0;g<e.length;g++){var h=d.isRef(e[g])?d.getReferredType(e[g]):e[g];f.contains(h)||f.push(h),f.combine(d.getExtendingTypes(h))}return f}return[]},getQueryItems:function(a,b){var c=function(a){b(a)},d=function(a){throw a};this.getDataService().query(a.collectionId,a.filter,a.sort,a.skip,a.limit,!1,c,d)},getQueryNoResultsMessage:function(a){return a.noResultsMessage||"No items"},loadTree:function(a,b){var c=function(a){b(a)},d=function(a){throw a},e=this._getDescriptorValue(["dataEditing","trees",a]),f=e.collectionId,g=e.topLevelSorting||{};this.getDataService().query(f,{},g,0,null,!1,c,d)},getTreeTopLevelItems:function(a){var b=this._getDescriptorValue(["dataEditing","trees",a]),c=b.collectionId,d=b.topLevelSorting||{};return this.getDataService().queryCache(c,{},d,0,-1).items},getTreeChildren:function(a,b){var c=this._getChildrenTypeField(b.getTypeName());if(!c)return[];var d=this._getDescriptorValue(["dataEditing","trees",a]),e=d.includedTypes||[],f=b.getChildByRef(c.name),g=[];return f.getChildren().forEach(function(a){e.contains(a.getTypeName())&&g.push(a)}),g},getFullTree:function(a){for(var b=this.getTreeTopLevelItems(a),c=[],d=0;d<b.length;d++)c.push({title:b[d].getChildValue("title"),item:b[d],children:this._getTreeChildrenRecursive(a,b[d])});return c},getNoChildrenForItemMessage:function(a){return this._getDescriptorValue(["dataEditing","typeMetaData",a,"noChildrenMessage"])||"No Items"},_getTreeChildrenRecursive:function(a,b){for(var c=[],d=this.getTreeChildren(a,b),e=0;e<d.length;e++)c.push({title:d[e].getChildValue("title"),item:d[e],children:this._getTreeChildrenRecursive(a,d[e])});return c},getChildren:function(a){var b=this._getChildrenTypeField(a.getTypeName());if(!b)return[];var c=a.getChildByRef(b.name);return c.getChildren()},getContainmentOptions:function(a,b){return this.getContainmentOptionsByTypeNames(a.getTypeName(),b.getTypeName())},getContainmentOptionsByTypeNames:function(a,b){var c=this._getChildrenTypeField(a);if(!c)return[];for(var d=this.getTypesManager().getArrayAllowedTypes(c.type),e=[],f=this.getTypesManager(),g=0;g<d.length;g++){var h;if(f.isOf(b,d[g]))h=Constants.DataEditingModel.ContainmentOptions.DIRECT,e.contains(h)||e.push(h);else if(f.isOf(b,f.getReferredType(d[g]))){var i=this._getParentTypeField(b);h=i&&!f.isArray(i.type)?Constants.DataEditingModel.ContainmentOptions.ONE_TO_MANY_REFERENCE:Constants.DataEditingModel.ContainmentOptions.MANY_TO_MANY_REFERENCE,e.contains(h)||e.push(h)}}return e},getContainmentType:function(a,b){var c=this.getTypesManager();b.isRef()&&(b=b.getReferencedDataItem());for(var d=this.getChildren(a),e=0;e<d.length;e++){var f=d[e];if(f===b)return Constants.DataEditingModel.ContainmentOptions.DIRECT;if(f.isRef()&&f.getReferencedDataItem()===b){var g=this._getParentTypeField(b.getTypeName());return g&&!c.isArray(g.type)?Constants.DataEditingModel.ContainmentOptions.ONE_TO_MANY_REFERENCE:Constants.DataEditingModel.ContainmentOptions.MANY_TO_MANY_REFERENCE}}return null},getItemBreadCrumbs:function(a){var b="",c=this.getItemParents(a);return 1===c.length&&(b=c[0].getChildValue("title")+"/"),b+=a.getChildValue("title")},getItemParents:function(a){var b=this._getParentTypeField(a.getTypeName());if(!b){var c=a.getParent()&&a.getParent().getParent();return c?[c]:[]}var d=a.getChildByRef(b.name);if(null===d.getValue()||void 0===d.getValue())return[];if(this.getTypesManager().isArray(d.getTypeName())){var e=d.getChildren();return _.map(e,function(a){return a.isRef()?a.getReferencedDataItem():a})}return[d.isRef()?d.getReferencedDataItem():d]},getChildContainmentOptions:function(a){var b=this._getParentTypeField(a);return b?this._getFieldAcceptableTypes(b):this._getContainmentOptions(a)},removeChild:function(a,b){var c=this._getChildrenTypeField(a.getTypeName());if(c){var d=a.getChildByRef(c.name);this._removeFromArray(d,b)}var e=this._getParentTypeField(b.getTypeName());if(e){var f=b.getChildByRef(e.name);if(this.getTypesManager().isArray(f.getTypeName()))this._removeFromArray(f,a);else if(this._areDataItemsEqual(f,a)){var g={_type:e.type,collectionId:Constants.DataItem.VOID_REF,itemId:Constants.DataItem.VOID_REF};f.setValue(g)}}return b},insertChild:function(a,b,c,d){var e=this._getChildrenTypeField(a.getTypeName());if(!e)throw"child ["+b+"] cannot be added to parent ["+a+"] because parent has no children field definition in descriptor";var f=a.getChildByRef(e.name),g=b;if(c===Constants.DataEditingModel.ContainmentOptions.MANY_TO_MANY_REFERENCE||c===Constants.DataEditingModel.ContainmentOptions.ONE_TO_MANY_REFERENCE){var h=this.getCollectionOfItem(b);if(!h)throw"CollectionId for child ["+b+"] is unknown";g={_type:"wix:Ref<"+b.getTypeName()+">",collectionId:h,itemId:b.getChildValue("_iid")};var i=this._getParentTypeField(b.getTypeName());if(i){var j=this.getCollectionOfItem(a),k={_type:"wix:Ref<"+a.getTypeName()+">",collectionId:j,itemId:a.getChildValue("_iid")};if(c===Constants.DataEditingModel.ContainmentOptions.MANY_TO_MANY_REFERENCE){var l=b.getChildByRef(i.name);l.addChild(k)}else{var m=b.getChildByRef(i.name);m.setValue(k)}}}f.addChild(g,d)},getItemTemplate:function(a,b){var c=Object.clone(this._getDescriptorValue(["dataEditing","typeMetaData",a,"newItemTemplate"]));c._type=a,b&&(c._iid=this._generateId());var d=this.getDataService().getDataItemFactory().createDataItem(c);return this.getTypesManager().applyDefaults(d)},getItemDefaultCollection:function(a){return this._getDescriptorValue(["dataEditing","typeMetaData",a,"collectionId"])},getItemDefaultNewChild:function(a){return this._getDescriptorValue(["dataEditing","typeMetaData",a,"defaultChildType"])},getTypeFriendlyName:function(a){return this._getDescriptorValue(["dataEditing","typeMetaData",a,"friendlyName"])},copyItem:function(a,b){var c=this._doCopyItem(a);c._iid=this._generateId(),delete c._hash;var d=this.addToCache(b,c);return this.getTypesManager().applyDefaults(d),d.setDirty(),d},copyDependentItem:function(a){var b=this._doCopyItem(a),c=this._logicEnv.getDataItemFactory().createDataItem(b);return this.getTypesManager().applyDefaults(c),c},_doCopyItem:function(a){var b=this,c=this.resources.W.Utils.AppsUtils.generateLinkId,d=Object.clone(a.getValue(0));_.each(d,function(a){a._type&&"wix:RichText"===a._type&&a.links&&a.links.length>0&&_.each(a.links,function(d){var e=d.linkId;d.linkId=c(b._logicEnv.getProxyFactory().getNameSpace()),a.text=a.text.replace("#"+e,"#"+d.linkId)})});var e=this._getDescriptorValue(["dataEditing","typeMetaData",d._type,"duplicationStrategy"]);if(e){if(e.resetToDef)for(var f=0;f<e.resetToDef.length;f++)delete d[e.resetToDef[f]];if(e.resetToNow)for(var g=new Date,h=0;h<e.resetToNow.length;h++)d[e.resetToNow[h]].iso=g.toISOString()}return d},addExistingToCache:function(a,b){var c=this.getDataService().getItemCache(),d=c.key(a,b.getChildValue("_iid"));c.insertDataItem(d,b)},addToCache:function(a,b){var c=this.getDataService().getItemCache(),d=b._iid;return c.put(c.key(a,d),b)},deleteItem:function(){},getCollectionOfItem:function(a){var b=a.getChildValue("_iid");if(!b)return null;var c=this._descriptor.collections;a.isRef()&&(a=a.getReferencedDataItem());for(var d=0;d<c.length;d++)if(this.getDataService().deReference(c[d].id,b)===a)return c[d].id;return null},_areDataItemsEqual:function(a,b){return a.isRef()&&(a=a.getReferencedDataItem()),b.isRef()&&(b=b.getReferencedDataItem()),a===b},_removeFromArray:function(a,b){for(var c=a.getChildren(),d=0,e=0;d<c.length;d++,e++){var f=c[d];this._areDataItemsEqual(f,b)&&(a.deleteChild(e),e--)}},_CHARS:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),_generateId:function(){for(var a,b=this._CHARS,c=[],d=0,e=0;36>e;e++)8===e||13===e||18===e||23===e?c[e]="-":14===e?c[e]="4":(2>=d&&(d=33554432+16777216*Math.random()|0),a=15&d,d>>=4,c[e]=b[19===e?3&a|8:a]);return c.join("")},_getFieldAcceptableTypes:function(a){var b,c=[];if(this.getTypesManager().isArray(a.type)){b=this.getTypesManager().getArrayAllowedTypes(a.type);for(var d=0;d<b.length;d++)c.push(this.getTypesManager().getReferredType(b[d]));return{relation:Constants.DataEditingModel.ContainmentOptions.MANY_TO_MANY_REFERENCE,types:c}}return c.push(this.getTypesManager().getReferredType(a.type)),{relation:Constants.DataEditingModel.ContainmentOptions.ONE_TO_MANY_REFERENCE,types:[c]}},_getContainmentOptions:function(a){var b,c=this._getDescriptorValue(["dataEditing","childrenField"]),d=[];for(var e in c){var f=this._getChildrenTypeField(e);b=this._getFieldAcceptableTypes(f).types,b.contains(a)&&d.push(e)}return 0===d.length?{relation:Constants.DataEditingModel.ContainmentOptions.NONE}:{relation:Constants.DataEditingModel.ContainmentOptions.DIRECT,types:d}},_getChildrenTypeField:function(a){var b=this._getDescriptorValue(["dataEditing","typeMetaData",a,"childrenField"]);if(b){var c=this.getTypesManager();return c.getField(c.getType(a),b)}return null},_getParentTypeField:function(a){var b=this._getDescriptorValue(["dataEditing","typeMetaData",a,"parentField"]);if(b){var c=this.getTypesManager();return c.getField(c.getType(a),b)}return null},_getDescriptorValue:function(a){return this._logicEnv.getAppInstance().getDescriptorValue(a)},_getCollectionAllowedTypes:function(a){for(var b=this._descriptor.collections||[],c=0;c<b.length;c++)if(b[c].id===a)return b[c].allowedTypes;return[]},_parse:function(){for(var a=this._getDescriptorValue(["dataEditing","categories"])||{},b=0;b<a.length;b++){var c=a[b].name;this._categories.push(c),this._sectionsByCat[c]=a[b].items||[];for(var d=0;d<this._sectionsByCat[c].length;d++){var e=this._sectionsByCat[c][d];this._sections[c+"/"+e.name]=e}a[b].newTypes&&(this._addNewByCat[c]=a[b].newTypes)}},getShowValidationPopupOnCancel:function(){return this._getDescriptorValue(["dataEditing","displayValidationPopupOnCancel"])}})}),define.Class("wixapps.core.logics.EditItemLogic",function(a){var b=a;b.inherits("wixapps.core.logics.SingleItemLogic"),b.binds(["onSuccess","_saveItem","_cancel","_onSaveSuccess","_onSaveFailure","_addSubItem"]),b.utilize(["wixapps.core.utils.DataServiceSaver","wixapps.core.logics.DescriptorDataEditingModel"]),b.methods({initialize:function(a){a.newDataServiceContext(),this.parent(a),this._saver=new this.imports.DataServiceSaver,this._model=new this.imports.DescriptorDataEditingModel(a)},run:function(a,b,c,d){if(this._viewName=a,this._callBacks=c,d&&d.type){var e=this._model.getItemTemplate(d.type,!0);this._model.addExistingToCache(b.collectionId,e),this.onSuccess(e)}else this.parent(a,b,c)},_getViewEventHandlers:function(){return _.merge({},this.parent(),{saveItem:this._saveItem,cancel:this._cancel,itemMoved:this._onItemMoved,addSubItem:this._addSubItem})},onSuccess:function(a){this._item=a,this.parent(a)},_addSubItem:function(a){var b=a.params.addToField,c=a.params.type,d=this._model.getItemTemplate(c,!1),e=this._item.getChildByRef(b);e.addChild(d,0)},_createItemOfType:function(a){var b=this._environment.getAppInstance().getDescriptorValue(["dataEditing","typeMetaData",a]);return this._environment.getDataItemFactory().createDataItem(b.newItemTemplate)},_onItemMoved:function(a){var b=a.sender,c=(b.getViewContext().getData(),a.data.getValue());c.splice(a.cause.oldIdx,1),c.splice(a.cause.idx,0,a.cause.dataItem.getValue()),a.data.setValue(c),a.data.fireChangedEvent(),b.getViewContext().getData().fireChangedEvent()},_saveItem:function(){this._saver.saveChanges(this._environment.getDataService(),this._onSaveSuccess,this._onSaveFailure)||this._cancel()},_onSaveSuccess:function(a){var b=this._environment.getDataService().getItemCache();this._environment.popDataServiceContext();var c=this._environment.getDataService().getItemCache();this._saver.copyChanges(b,c,a,this._environment),this._environment.getAppInstance().fireEvent(Constants.WixAppEvents.INVALIDATE_PART_DATA,{}),this.injects().Commands.executeCommand("WViewerCommands.MediaZoom.Close")},_onSaveFailure:function(){},_validatePartData:function(){},_cancel:function(){this._environment.popDataServiceContext(),this.injects().Commands.executeCommand("WViewerCommands.MediaZoom.Close")},dispose:function(){this._proxy.removeEvent("saveItem",this._saveItem),this._proxy.removeEvent("cancel",this._cancel),this._proxy.removeEvent("itemMoved",this._onItemMoved),this.parent()}})}),define.Class("wixapps.core.logics.EditableQueryLogic",function(a){var b=a;b.inherits("wixapps.core.logics.QueryLogic"),b.binds(["_addItem"]),b.utilize(["wixapps.core.utils.DataServiceSaver"]),b.methods({initialize:function(a){this.parent(a),this._saver=new this.imports.DataServiceSaver},_getViewEventHandlers:function(){return _.merge({},this.parent(),{addItem:this._addItem,deleteItem:this._deleteItem,setValue:this._setValue})},_addItem:function(a){this._environment.getAppInstance().getZoomHandler().openZoomForNewItem(a.params.zoomPartName,{hideNextPrevBtns:!0},{type:a.params.type})},_deleteItem:function(){},_setValue:function(){}})}),define.Class("wixapps.core.logics.GroupByAndCountLogic",function(a){function b(a,b){return a>b?1:b>a?-1:0}var c=a;c.inherits("wixapps.core.logics.LogicBase"),c.binds(["onSuccess","onFailure","_validatePartData","_processResult","_appActiveStateChanged"]),c.utilize(["wixapps.core.logics.DescriptorDataEditingModel"]),c.resources(["W.Utils","W.Viewer","W.Config"]);var d={byKeyAsc:function(a,c){return b(a.key,c.key)},byKeyDesc:function(a,c){return b(c.key,a.key)},byCountAsc:function(a,c){return b(a.count,c.count)},byCountDesc:function(a,c){return b(c.count,a.count)}};c.fields({_environment:null,_logicParams:null,_countsMapDataItem:null,_countersInfoDataItem:null}),c.methods({initialize:function(a){this._environment=a,this._environment.getAppInstance().addEvent(Constants.WixAppEvents.INVALIDATE_PART_DATA,this._validatePartData);var b=this._environment.getAppInstance().getAppVar("applicationActiveState");b&&b.addEvent(Constants.DataItemEvents.CHANGE,this._appActiveStateChanged)},run:function(a,b,c){this._run(a,b,c,!0)},_run:function(a,b,c,d){this._viewName=a,this._callBacks=c,this._logicParams=b,this.isValid()?this._doQuery(d):this.onFailure({description:"'collectionId' and 'type' and 'field' should be defined",code:-1}),this._logicParams["wixapps:first-load-after-add-to-stage"]=!1},_validatePartData:function(){this._run(this._viewName,this._logicParams,this._callBacks,!1)},_appActiveStateChanged:function(){this._run(this._viewName,this._logicParams,this._callBacks,!1)},isValid:function(){if(!(this._logicParams&&this._logicParams.collectionId&&this._logicParams.type&&this._logicParams.field))return!1;if(this._logicParams["wixapps:first-load-after-add-to-stage"]===!0)return!0;var a=this._environment.getAppInstance();return a.getApplicationActiveState()},_doQuery:function(a){var b=this._environment,c=this._logicParams,d=this._callBacks,e=c.filter||{},f=c.project||{},g=b.getDataService().groupByAndCountFromCache(c.collectionId,c.type,e,c.field,f);a&&g?this.onSuccess(g):(b.getDataService().groupByAndCount(c.collectionId,c.type,e,c.field,c.project,this.onSuccess,this.onFailure),this._countsMapDataItem||this._showLoading(d))},onSuccess:function(a){this._countsMapDataItem!==a&&(this._countsMapDataItem&&this._countsMapDataItem.removeEvent(Constants.DataItemEvents.CHANGE,this._processResult),this._countsMapDataItem=a,this._countsMapDataItem.addEvent(Constants.DataItemEvents.CHANGE,this._processResult)),this._processResult()},getDataEditingModel:function(){return new this.imports.DescriptorDataEditingModel(this._environment)},_resultsToPairs:function(){var a=[];if(Object.each(this._countsMapDataItem.getValue(),function(b,c){a.push({count:b,key:c})}),this._logicParams.sort&&d[this._logicParams.sort]&&(a=a.sort(d[this._logicParams.sort])),this._logicParams.limit&&(a=a.slice(0,this._logicParams.limit)),this._logicParams.normalizeTo)for(var b=parseInt(this._logicParams.normalizeTo),c=a.reduce(function(a,b){return a>b.count?a:b.count},-1),e=0;e<a.length;e++)a[e].normalized=Math.ceil(a[e].count*b/c);return a},_processResult:function(){var a=this._resultsToPairs();this._countersInfoDataItem?this._countersInfoDataItem.setValue(a):(this._countersInfoDataItem=this._environment.getDataItemFactory().createDataItem(a),this._callBacks.showView(this._countersInfoDataItem,this._viewName)),this._callBacks.showView(this._countersInfoDataItem,this._viewName)},onFailure:function(a){this._showError(this._callBacks,a)},_showLoading:function(a){a.showLoadingIndicator()},_showError:function(a,b){var c=Object.clone(b);c._type="Error";var d=this._environment.getProxyFactory(),e=this.resources.W.Config.env.$isPublicViewerFrame?"ErrorInPublished":"ErrorInEditor";d.getViewDefinition(c._type,e)?a.showView(this._environment.getDataItemFactory().createDataItem(c),e):a.showErrorIndicator(b.code,b.description)},getDataEditingMetaInfo:function(){var a=this._environment.getAppInstance(),b=a.getDescriptorValue(["dataEditing","dataSelectionLabel"])||"Choose Category",c=a.getDescriptorValue(["dataEditing","dataEditingLabel"])||"Edit Data",d=this._environment.getAppPart().getPartDef().name,e=this._environment.getAppPart().getPartDef().logicParams||{};return{title:d,hasDataEdit:e.allowDataEditing!==!1&&this.isValid(),hasDataSelection:e.allowDataSelection!==!1&&this.isValid(),dataSelectionLabel:b,dataEditingLabel:c}},dispose:function(){this._environment.getAppInstance().removeEvent(Constants.WixAppEvents.INVALIDATE_PART_DATA,this._validatePartData),this._countsMapDataItem&&this._countsMapDataItem.removeEvent(Constants.DataItemEvents.CHANGE,this._processResult);var a=this._environment.getAppInstance().getAppVar("applicationActiveState");a&&a.removeEvent(Constants.DataItemEvents.CHANGE,this._appActiveStateChanged)}})}),define.Class("wixapps.core.logics.LogicBase",function(a){var b=a;b.binds(["_onDetailsUpdated"]),b.fields({_environment:null,USER_ROLES:{NONE:"none",MEMEBER:"member",OWNER:"owner"},_userRole:"none"}),b.resources(["W.Commands"]),b.methods({initialize:function(a){this._environment=a,this._activateOwnerVariable()},run:function(){},getDataEditingModel:function(){},getDataEditingMetaInfo:function(){var a=this._environment.getAppPart().getPartDef().logicParams||{};return{title:"",hasDataSelection:!1||a.allowDataSelection===!0,openDataSelectionOnAddToStage:a.openDataSelectionOnAddToStage!==!1,dataSelectionLabel:"",dataEditingLabel:"",hasDataEdit:!0&&a.allowDataEditing!==!1}},_getLastTenItems:function(){return[]},getLastTenItemsZoomParams:function(a,b,c,d){this._getLastTenItems(a,function(a){if(d=d||"title",c=c||"_iid",0===a.length)return{list:[],selectedIndex:0};var e=a[0].getValue()[c],f=a.map(function(a){return{id:a.getChildByRef(c).getValue(),title:a.getChildByRef(d).getValue()}}),g=f.getIndexByField("id",e);b({list:f,selectedIndex:g})})},sendEmail:function(a,b,c,d,e,f,g,h,i){var j={to:a,cc:b,bcc:c,from:d,subject:e,htmlMessage:f,plainTextMessage:g,metaSiteId:h},k=this.injects(),l=k.Config.getServiceTopologyProperty("emailServer"),m=this._isPreviewMode();m&&(l+="Secured");var n=[];n.push(l),n.push("?accept=json&contentType=json"),n.push("&appUrl="+encodeURIComponent(window.location.href)),m&&n.push("&wixSession="+k.CookiesManager.getCookie("wixSession")),this._sendJsonCORS(n.join(""),j,"POST",i)},_sendJsonCORS:function(a,b,c,d){var e=function(a,b){var c=new XMLHttpRequest;return"withCredentials"in c?(c.open(a,b,!0),c.withCredentials="true"):"undefined"!=typeof XDomainRequest&&(c=new XDomainRequest,c.open(a,b),c.setRequestHeader=function(){}),c},f=function(a){if(!h.responseText)return{success:!1,errorDescription:"Invalid ajax response, no responseText",errorCode:-9001};var b=JSON.parse?JSON.parse:eval;try{return b(a)}catch(c){return{success:!1,errorDescription:"Invalid JSON object",errorCode:-9e3}}},g=function(a){return a.errorDescription+" ("+a.errorCode+")"},h=e(c,a);h.onabort=function(){d(!1,"request aborted")},h.ontimeout=function(){d(!1,"request timeout")},h.onerror=function(){d(!1,g(f(h.responseText)))},h.onload=function(){var a=f(h.responseText);d(a.success,a.success?a:g(a))},h.send(JSON.stringify(b))},_sendJsonCORSWide:function(a,b,c,d){var e=function(a,b){var c=new XMLHttpRequest;return"withCredentials"in c?(c.open(a,b,!0),c.withCredentials=!1):"undefined"!=typeof XDomainRequest&&(c=new XDomainRequest,c.open(a,b),c.setRequestHeader=function(){}),c},f=function(a){if(!h.responseText)return{success:!1,errorDescription:"Invalid ajax response, no responseText",errorCode:-9001};var b=JSON.parse?JSON.parse:eval;try{var c=b(a);return c.success=!0,c}catch(d){return{success:!1,errorDescription:"Invalid JSON object",errorCode:-9e3}}},g=function(a){return a.errorDescription+" ("+a.errorCode+")"},h=e(c,a);h.onabort=function(){d(!1,"request aborted")},h.ontimeout=function(){d(!1,"request timeout")},h.onerror=function(){d(!1,g(f(h.responseText)))},h.onload=function(){var a=f(h.responseText);d(a.success,a.success?a:g(a))},h.send(JSON.stringify(b))},_activateOwnerVariable:function(){this._isPreviewMode()?this._userRole=this.USER_ROLES.OWNER:this.injects().SiteMembers.getMemberDetails(this._onDetailsUpdated,this._onDetailsUpdated)},_getViewVars:function(){return this._userRole=this._userRole||this.USER_ROLES.NONE,this._isPreviewMode()&&(this._userRole=this.USER_ROLES.OWNER),{userRole:this._userRole}},_getViewEventHandlers:function(){return{}},_onDetailsUpdated:function(a){this._userRole=this._isPreviewMode()||a.owner===!0?this.USER_ROLES.OWNER:"ACTIVE"==a.status?this.USER_ROLES.MEMEBER:this.USER_ROLES.NONE,this._proxy&&this._proxy.getViewContext().getEnvironment().setVar("userRole",this._userRole)},_isPreviewMode:function(){return!this.injects().Config.env.$isPublicViewerFrame},isDeletable:function(){return!0},_getParamsFromURL:function(){if(this._urlParams)return this._urlParams;var a={},b=window.location.search;if(b.length>1){b=b.substr(1);for(var c=b.split("&"),d=0;d<c.length;d++){var e=c[d].split("=");a[e[0]]=a[e[0]]||[],a[e[0]].push(e[1])}}return this._urlParams=a,a},dispose:function(){this.removeEvents&&this.removeEvents(),this.resources.W.Commands.unregisterListener(this)}})}),define.Class("wixapps.core.logics.QueryLogic",function(a){var b=a;b.inherits("wixapps.core.logics.LogicBase"),b.binds(["onSuccess","onFailure","_validatePartData","_appActiveStateChanged"]),b.utilize(["wixapps.core.logics.DescriptorDataEditingModel"]),b.traits(["wixapps.core.logics.QueryTrait"]),b.resources(["W.Viewer","W.Utils","W.Config"]),b.fields({_environment:null,_logicParams:null}),b.methods({initialize:function(a){this._environment=a,this._environment.getAppInstance().addEvent(Constants.WixAppEvents.INVALIDATE_PART_DATA,this._validatePartData);var b=this._environment.getAppInstance().getAppVar("applicationActiveState");b&&b.addEvent(Constants.DataItemEvents.CHANGE,this._appActiveStateChanged),this._dataItemFactory=this._environment.getAppInstance().getDataItemFactory(),this.parent(a)},getSelectedIId:function(a,b){return b.itemId},_getItemsCollection:function(a){return a.collectionId},run:function(a,b,c){this._viewName=a,this._callBacks=c,this._logicParams=b,this.isValid()?this.fetchData(b,this.onSuccess,this.onFailure):this.onFailure({description:"Required page not found",code:-2021}),this._logicParams["wixapps:first-load-after-add-to-stage"]=!1},_appActiveStateChanged:function(){this.run(this._viewName,this._logicParams,this._callBacks)},isValid:function(){if(this._logicParams&&this._logicParams["wixapps:first-load-after-add-to-stage"]===!0)return!0;var a=this._environment.getAppInstance();return a.getApplicationActiveState()},onSuccess:function(a){this._virtualArray=a;var b=this._getViewEventHandlers(),c=this._getViewVars();this._callBacks.showView(this._virtualArray,this._viewName,b,c)},onFailure:function(a){this._showError(this._callBacks,a)},_validatePartData:function(){this.run(this._viewName,this._logicParams,this._callBacks)},getDataEditingModel:function(){return new this.imports.DescriptorDataEditingModel(this._environment)},_getLastTenItems:function(a,b){var c=this.getDataEditingModel().getItemDefaultCollection(a);this.getDataEditingModel().getDataService().query(c,{_type:a},{_updatedAt:-1},0,10,!1,b)
},_showLoading:function(a){a.showLoadingIndicator()},getDataEditingMetaInfo:function(){var a=this._environment.getAppInstance(),b=a.getDescriptorValue(["dataEditing","dataSelectionLabel"])||"Choose Category",c=a.getDescriptorValue(["dataEditing","dataEditingLabel"])||"Edit Data",d=this._environment.getAppPart().getPartDef().name,e=this._logicParams?this._environment.getDataService().deReference(this._logicParams.collectionId,this._logicParams.itemId):null;e&&(d=d+" - "+e.getChildValue("title"),d.length>35&&(d=d.substr(0,35)+"..."));var f=this._environment.getAppPart().getPartDef().logicParams||{};return{title:d,hasDataEdit:f.allowDataEditing!==!1&&this.isValid(),hasDataSelection:f.allowDataSelection!==!1&&this.isValid(),openDataSelectionOnAddToStage:f.openDataSelectionOnAddToStage!==!1&&this.isValid(),dataSelectionLabel:b,dataEditingLabel:c}},generateDataSelectorPanel:function(){},_showError:function(a,b){var c=Object.clone(b);c._type="Error";var d=this._environment.getProxyFactory(),e=this.resources.W.Config.env.$isPublicViewerFrame?"ErrorInPublished":"ErrorInEditor";d.getViewDefinition(c._type,e)?a.showView(this._environment.getDataItemFactory().createDataItem(c),e):a.showErrorIndicator(b.code,b.description)},dispose:function(){this._environment.getAppInstance().removeEvent(Constants.WixAppEvents.INVALIDATE_PART_DATA,this._validatePartData);var a=this._environment.getAppInstance().getAppVar("applicationActiveState");a&&a.removeEvent(Constants.DataItemEvents.CHANGE,this._appActiveStateChanged)}})}),define.Class("wixapps.core.logics.QueryTrait",function(a){var b=a;b.binds(["_parseResult"]),b.methods({initialize:function(a){this._dataItemFactory=this._environment.getAppInstance().getDataItemFactory(),this.parent(a)},fetchData:function(a,b,c){this._onFetchDataSuccess=b;var d=this._environment;if(this._logicParams=a,!a.collectionId)return c({description:"'collectionId' should be defined",code:-1}),void 0;var e=null,f=null;a.filter&&a.filter.length&&(e=JSON.parse(a.filter)),a.sort&&a.sort.length&&(f=JSON.parse(a.sort));var g=a.skip||0,h=Number(a.limit)||null,i=(d.getTypesManager().getType(a.resultType),!!a.getTotalCount);d.getDataService().query(a.collectionId,e,f,g,h,i,this._parseResult,c)},_parseResult:function(a,b,c){this._virtualArray=this._virtualArray||this._dataItemFactory.createVirtualArray(),this._virtualArray.setChildren(a),this._setTotalResultCount(c),this._onFetchDataSuccess(this._virtualArray)},_setTotalResultCount:function(){},getLogicParams:function(){return this._logicParams||null}})}),define.Class("wixapps.core.logics.SingleItemLogic",function(a){var b=a;b.inherits("wixapps.core.logics.LogicBase"),b.binds(["onSuccess","onFailure","_validatePartData"]),b.utilize(["wixapps.core.logics.DescriptorDataEditingModel"]),b.resources(["W.Config"]),b.fields({_environment:null,_logicParams:null,_fixingItemNotFound:!1}),b.methods({initialize:function(a){this._environment=a,this._environment.getAppInstance().addEvent(Constants.WixAppEvents.INVALIDATE_PART_DATA,this._validatePartData),this._registerComputedFieldsControllers()},_registerComputedFieldsControllers:function(){},getSelectedIId:function(a,b){return b.itemId},run:function(a,b,c){var d=this._environment;if(this._viewName=a,this._callBacks=c,this._logicParams=b,!b.collectionId||!b.itemId)return this.onFailure({description:"'collectionId' and 'itemId' should be defined",code:-1}),void 0;var e=d.getDataService().readItemFromCache(b.collectionId,b.itemId);e&&d.getDataService().areReferencesResolved(e,3)?this.onSuccess(e):(d.getDataService().readItem(b.collectionId,b.itemId,this.onSuccess,this.onFailure),this._showLoading(c))},onSuccess:function(a){var b=this._environment,c=b.getTypesManager();c.applyDefaults(a);var d=this._getViewEventHandlers(),e=this._getViewVars();this._onBeforeItemRendered(a,e,d),this._callBacks.showView(a,this._viewName,d,e)},onFailure:function(a){this._logicParams["wixapps:first-load-after-add-to-stage"]===!0&&-1021==a.code?this._fixItemNotFound():this._showError(this._callBacks,a)},_onBeforeItemRendered:function(){},_validatePartData:function(){var a=this._logicParams,b=this._environment.getDataService().readItemFromCache(a.collectionId,a.itemId);b||this.onFailure({code:-1021,description:"Item not found"})},_fixItemNotFound:function(){this._fixingItemNotFound=!0;var a=this._getItemsCollection(this._logicParams),b=function(b){if(this._fixingItemNotFound){if(this._fixingItemNotFound=!1,0===b.length)return this._logicParams["wixapps:first-load-after-add-to-stage"]=!1,this.onFailure({description:"No items found in collection "+a,code:-1021}),void 0;var c=b[0],d=c.getChildValue("_iid");if(!d)return this.onFailure({description:"New selected item id not found",code:-1}),void 0;var e=this._environment.getAppPart().getDataItem().get("appLogicParams");e.itemId={type:"AppPartParam",value:d},this._environment.getAppPart().getDataItem().fireDataChangeEvent()}}.bind(this),c=function(a){this._fixingItemNotFound&&(this._fixingItemNotFound=!1,this._showError(this._callBacks,a))}.bind(this);this.getDataEditingModel().getDataService().query(a,{},{_updatedAt:-1},0,-1,!1,b,c)},_getItemsCollection:function(a){return a.collectionId},getDataEditingModel:function(){return new this.imports.DescriptorDataEditingModel(this._environment)},_getLastTenItems:function(a,b){var c=this.getDataEditingModel().getItemDefaultCollection(a);this.getDataEditingModel().getDataService().query(c,{_type:a},{_updatedAt:-1},0,10,!1,b)},_showLoading:function(a){a.showLoadingIndicator()},_getViewEventHandlers:function(){return{}},_getViewVars:function(){return{}},_showError:function(a,b){var c=Object.clone(b);c._type="Error";var d=this._environment.getProxyFactory(),e=this.resources.W.Config.env.$isPublicViewerFrame?"ErrorInPublished":"ErrorInEditor";if(d.hasViewDefinition(c._type,e)){var f=this._environment.getDataItemFactory().createDataItem(c);a.showView(f,e)}else a.showErrorIndicator(b.code,b.description)},dispose:function(){this._environment.getAppInstance().removeEvent(Constants.WixAppEvents.INVALIDATE_PART_DATA,this._validatePartData)}})}),define.Class("wixapps.core.logics.TwoLevelCategoryLogic",function(a){var b=a;b.inherits("wixapps.core.logics.CategoryLogic"),b.methods({_getItemsCollection:function(){return this._getTopLevelCollection()},_getTopLevelItemType:function(){return this._dsp("topLevelItemType","Category")},_getMidLevelItemType:function(){return this._dsp("midLevelItemType","Section")},_getTopLevelCollection:function(){return this._dsp("topLevelCollection","Categories")},_getMidLevelCollection:function(){return this._dsp("midLevelCollection","Sections")},_generateCategoriesComboSection:function(a,b,c,d){return this._generateCategoriesCombo(a,b,c,d)},_createCategoryListData:function(a){for(var b,c=[],d=0;d<a.length;d++){b=a[d].getValue(),c.push({value:this._getTopLevelCollection()+"/"+b._iid,label:b.title});for(var e=this._getDescriptorValue(["dataEditing","typeMetaData",a[d].getTypeName(),"childrenField"]),f=a[d].getChildByRef(e).getChildren(),g=0;g<f.length;g++){var h=f[g];h.getTypeName()==this._getMidLevelItemType()&&c.push({value:this._getMidLevelCollection()+"/"+h.getChildValue("_iid"),label:" - "+h.getValue().title})}}return c}})}),define.Class("wixapps.core.logics.page.AppBuilderPageLogic",function(a){var b=a;b.inherits("wixapps.core.logics.page.PageLogicBase"),b.fields({_environment:null}),b.methods({initialize:function(a){this._environment=a,this._type=a.getForType()},paramsFromUri:function(a){return a||(a=this._getSampleItemIdFromStore()),a?{itemId:a}:null},_getSampleItemIdFromStore:function(){var a=this._environment.getAppInstance().getDataProviders().getWixDbDataProvider(),b=a.queryLocalStore(this._type,{},{},0,1);return b&&b.length?b[0].getChildValue("_iid"):null},fetchDataItem:function(a,b,c){var d=this._environment.getAppInstance().getDataProviders().getWixDbDataProvider();d.readItem(a.itemId,b,c)},fetchSampleDataItem:function(a,b){var c=this._environment.getAppInstance().getDataProviders().getWixDbDataProvider(),d=c.queryLocalStore(this._type,{},{},0,1);d&&0!==d.length?a(d[0]):c.query(this._type,{},{},0,1,function(b){if(b&&b.length>0)a(b[0]);else{var c=this._environment.getAppInstance(),d=c.getDataItemFactory(),e=d.createDataItem({_type:this._type,_iid:"SampleData"});c.getTypesManager().applyDefaults(e),a(e)}}.bind(this),b)}})}),define.Class("wixapps.core.logics.page.EventsPageLogic",function(a){var b=a;b.inherits("wixapps.core.logics.page.PageLogicBase"),b.fields({_environment:null}),b.methods({initialize:function(a){this._environment=a},_getCollectionId:function(){return"Events"},getSampleDataItem:function(){return{collectionId:"Events",itemId:"Talk1"}},fetchSampleDataItem:function(a,b){this.fetchDataItem(this.getSampleDataItem(),a,b)},fetchDataItem:function(a,b,c){var d=this._environment.getDataService(),e=a.collectionId,f=a.itemId,g=function(a){var d=this._environment.options.acceptableTypes;!d||d.length>0||d.contains(a.getTypeName())?b(a):c({code:-10003,description:"Page expected ["+d+" ] but received "+a.getTypeName()})}.bind(this),h=function(a){c(a)}.bind(this),i=d.readItemFromCache(e,f);i?b(i):this._environment.getDataService().readItem(e,f,g,h)}})}),define.Class("wixapps.core.logics.page.ItemFromPageLogic",function(a){var b=a;b.inherits("wixapps.core.logics.page.PageDependentLogicBase"),b.utilize(["wixapps.core.utils.SocialShareHandler","wixapps.integration.utils.MediaTextDataUtils"]),b.fields({_environment:null,_dataItem:null,_mediaTextUtils:null}),b.binds(["_handleShareRequest"]),b.methods({initialize:function(a){this._environment=a,this._sharer=new this.imports.SocialShareHandler,this._mediaTextUtils=new this.imports.MediaTextDataUtils},_getViewEventHandlers:function(){return _.merge({},this.parent(),{sharePost:this._handleShareRequest})},_handleShareRequest:function(a){var b="",c=this._dataItem;"MediaPost"==c.getTypeName()&&(c=this._mediaTextUtils.convertMediaPostForView(this._dataItem,this._environment.getDataItemFactory())),"PhotoPost"==c.getTypeName()&&(b=c.getChildValue("photo").src,b=this._environment.getProxyFactory().resolveResourcePath(b)),this._sharer.handleShareRequest(a.params.service,window.location.href,c.getChildValue("title"),b,void 0,!1)},_onDataLoaded:function(a){var b=this._params.acceptableTypes;if(b&&b.length>0&&!b.contains(a.getTypeName()))throw"Part expected ["+b+" ] but received "+a.getTypeName();this.parent(a),this._dataItem=a},getDataEditingMetaInfo:function(){var a=this._environment.getAppInstance(),b=a.getDescriptorValue(["dataEditing","dataEditingLabel"])||"Edit Data",c=this._environment.getAppPart().getPartDef().name;return{title:c,hasDataEdit:!0,hasDataSelection:!1,dataSelectionLabel:"",dataEditingLabel:b}}})}),define.Class("wixapps.core.logics.page.ListFromPageLogic",function(a){var b=a;b.inherits("wixapps.core.logics.page.PageDependentLogicBase"),b.fields({_environment:null}),b.methods({initialize:function(a){this._environment=a},_onDataLoaded:function(a){this.parent(a)},_getViewVars:function(){var a=this._getParentPageLogic().getCurrentPage(),b=this._getParentPageLogic().getPageCount();return _.merge({},this.parent(),{pageCount:b,pageNum:a,hasPrev:a>0,hasNext:b-1>a})},getDataEditingMetaInfo:function(){var a=this._environment.getAppInstance(),b=a.getDescriptorValue(["dataEditing","dataEditingLabel"])||"Edit Data",c=this._environment.getAppPart().getPartDef().name;return{title:c,hasDataEdit:!0,hasDataSelection:!1,dataSelectionLabel:"",dataEditingLabel:b}}})}),define.Class("wixapps.core.logics.page.MenuPageLogic",function(a){var b=a;b.inherits("wixapps.core.logics.page.PageLogicBase"),b.fields({_environment:null}),b.methods({initialize:function(a){this._environment=a},_getCollectionId:function(){return"Items"},getSampleDataItem:function(){return{collectionId:"Items",itemId:"SampleItem1"}},fetchSampleDataItem:function(a,b){this.fetchDataItem(this.getSampleDataItem(),a,b)},fetchDataItem:function(a,b,c){var d=this._environment.getDataService(),e=a.collectionId,f=a.itemId,g=function(a){var d=this._environment.options.acceptableTypes;!d||d.length>0||d.contains(a.getTypeName())?b(a):c({code:-10003,description:"Page expected ["+d+" ] but received "+a.getTypeName()})}.bind(this),h=function(a){c(a)}.bind(this),i=d.readItemFromCache(e,f);i?b(i):this._environment.getDataService().readItem(e,f,g,h)}})}),define.Class("wixapps.core.logics.page.PageDependentLogicBase",function(a){var b=a;b.inherits("wixapps.core.logics.SingleItemLogic"),b.binds(["_onDataLoaded"]),b.methods({initialize:function(a){this.parent(a)},run:function(a,b,c){this._viewName=a,this._callBacks=c,this._params=b;var d=this,e=function(){var a=d._environment.getAppPart().getViewNode().getParent('[comp$="AppPage"]');if(a&&a.getLogic&&a.getLogic().getPrimaryLogic()&&W.Viewer.isSiteReady()){var b=a.getLogic();d._parentPageLogic=b.getPrimaryLogic(),b.registerForDataItemLoaded(d._onDataLoaded)}else W.Utils.callLater(e)};this._showLoading(c),e()},_getParentPageLogic:function(){return this._parentPageLogic},isDeletable:function(){return!1},_onDataLoaded:function(a){this.onSuccess(a)}})}),define.Class("wixapps.core.logics.page.PageLinkResolverBase",function(a){var b=a;b.resources(["W.Utils","W.Viewer"]),b.fields({_def:null,_hash:null}),b.methods({initialize:function(a){this._def=a,this._hash=this.resources.W.Utils.hash},resolveLinkUrl:function(){throw"override me.."},getWPageDataPromise:function(a){return this.resources.W.Viewer.getPageDataPromise(function(b){return b.get("appPageId")===a})},getBaseParams:function(){return _.clone(this._def.logic.display.options)}})}),define.Class("wixapps.core.logics.page.PageLogicBase",function(a){var b=a;b.inherits("wixapps.core.logics.LogicBase"),b.methods({paramsFromUri:function(a){return this._fromQueryString(a)},_fromQueryString:function(a){var b={};if(void 0!==a&&a.length>0){a=a.split("&");for(var c=0;c<a.length;c++){var d=a[c].split("=");b[d[0]]=unescape(d[1])}}return b},fetchDataItem:function(){}})}),define.Class("wixapps.core.logics.page.QueryPageLinkResolver",function(a){var b=a;b.inherits("wixapps.core.logics.page.PageLinkResolverBase"),b.methods({resolveLinkUrl:function(a,b,c,d,e){var f=this;this.getWPageDataPromise(a).then(function(a){var g=a.get("id"),h=a.get("pageUriSEO"),i=f._getExtraDataParams(b,c,d),j=f.uriFromParams(i);e(f._hash.getHashPartsString(g,h,j))})},_getPageLogicForNextPrev:function(){var a=this.resources.W.Viewer.getCurrentPageNode(),b=a.$logic,c=b.getPrimaryLogic();if(c.getPageCount&&c.getCurrentPage)return c;throw"Current page must contain primary logic with [getPageCount] and [getCurrentPage]"},_getExtraDataParams:function(a,b,c){var d,e=this.getBaseParams();switch(c){case"nextPage":d=this._getPageLogicForNextPrev(),d.getPageCount()>d.getCurrentPage()+1&&(this._useAlreadyExistingPageParams(d,e),e.page=d.getCurrentPage()+1);break;case"prevPage":d=this._getPageLogicForNextPrev(),d.getCurrentPage()>0&&(this._useAlreadyExistingPageParams(d,e),e.page=d.getCurrentPage()-1);break;case"tag":this._addParamToFilter(e,"tags",a.getValue().key||a.getValue());break;case"query":e=_.clone(b),delete e.filterType,delete e.filterView,delete e.limit,delete e.resultType}return this._removeDefaultParams(e)},_useAlreadyExistingPageParams:function(a,b){if(this._wasPageTagQueried(a)){var c=/"tags":"(.*)",|}/,d=a.getLogicParams().filter.match(c)[1];this._addParamToFilter(b,"tags",d)}},_addParamToFilter:function(a,b,c){a.filter='{"'+b+'":"'+c+'" }'},_wasPageTagQueried:function(a){return a.getLogicParams().filter.contains("tags")},_removeDefaultParams:function(a){var b=this.getBaseParams();return _.omit(a,function(a,c){return _.has(b,c)&&b[c]===a})},uriFromParams:function(a){return Object.toQueryString(a)}})}),define.Class("wixapps.core.logics.page.QueryPageLogic",function(a){var b=a;b.inherits("wixapps.core.logics.page.PageLogicBase"),b.traits(["wixapps.core.logics.QueryTrait"]),b.binds(["_onDataSaved"]),b.fields({_environment:null}),b.methods({initialize:function(a){this._environment=a,this._environment.getAppInstance().addEvent(Constants.WixAppEvents.INVALIDATE_PART_DATA,this._onDataSaved),this._currentPage=0,this._pageCount=1},paramsFromUri:function(a){return this._fromQueryString(a)},_getCollectionId:function(){return this._environment.options.collectionId},fetchSampleDataItem:function(a,b){this.fetchDataItem({collectionId:this._getCollectionId()},a,b)},_onDataSaved:function(){this._params&&this.fetchDataItem(this._params,this._callBacks.onSuccess,this._callBacks.onFailure)},fetchDataItem:function(a,b,c){this._callBacks={onSuccess:b,onFailure:c},this._params=a,a.getTotalCount=!0,this._currentPage=parseInt(a.page)||0,a.skip=this._currentPage*Number(a.limit),this._addAppSpecificParams(a),this.fetchData(a,b,c),this._limit=a.limit},_addAppSpecificParams:function(){},_setTotalResultCount:function(a){this._totalResult=a,this._pageCount=Math.ceil(a/Number(this._limit))},getCurrentPage:function(){return this._currentPage},getPageCount:function(){return this._pageCount},dispose:function(){this._environment.getAppInstance().removeEvent(Constants.WixAppEvents.INVALIDATE_PART_DATA,this._onDataSaved),this.parent()}})}),define.Class("wixapps.core.logics.page.SingleItemPageLinkResolver",function(a){var b=a;b.inherits("wixapps.core.logics.page.PageLinkResolverBase"),b.methods({resolveLinkUrl:function(a,b,c,d,e){var f=this;this.getWPageDataPromise(a).then(function(a){var c=a.get("id"),d=b.getChildValue("title"),g=b.getChildValue("_iid")||"";e(f._hash.getHashPartsString(c,d,g))})}})}),define.Class("wixapps.core.logics.page.SingleItemPageLogic",function(a){var b=a;b.inherits("wixapps.core.logics.page.PageLogicBase"),b.fields({_environment:null}),b.methods({initialize:function(a){this._environment=a},_getCollectionId:function(){return this._environment.options.collectionId},fetchSampleDataItem:function(a,b){this._environment.getDataService().query(this._getCollectionId(),null,null,0,1,!1,function(b){a(b[0])},b)},fetchDataItem:function(a,b,c){var d=this._environment.getDataService(),e=a.collectionId,f=a.itemId,g=function(a){if(!a||0===a.length)return c({code:-10004,description:"No items were found"}),void 0;var d=a[0],e=this._environment.options.acceptableTypes;!e||e.length>0||e.contains(d.getTypeName())?b(d):c({code:-10003,description:"Page expected ["+e+" ] but received "+d.getTypeName()})}.bind(this),h=function(a){c(a)}.bind(this);if(!f||!e)return c({code:-1,description:"Item id or collection id not defined"}),void 0;var i=d.readItemFromCache(e,f);if(i)b(i);else{var j={_iid:f},k=this._environment.options.filter;k&&(j=_.merge(j,k)),this._environment.getDataService().query(e,j,{},0,1,!1,g,h)}},paramsFromUri:function(a){var b={};return b.itemId=a,b},getCustomPageTitle:function(a,b){this.fetchDataItem(a,function(a){b(a.getChildValue("title"))},function(){b(null)})}})}),define.Class("wixapps.core.managers.TypesManager",function(a){var b=a;b.utilize(["wixapps.core.data.PrimitiveValidations"]),b.fields({_validator:null,_typesMap:{},_extendingTypes:{}}),b.methods({initialize:function(){this._validator=new this.imports.PrimitiveValidations},getType:function(a){return this._typesMap[a]},getTypeName:function(a){return a.name||a._iid},registerType:function(a){var b=this.getTypeName(a);if(this._typesMap[b]=a,a.baseTypes&&"array"!=typeOf(a.baseTypes))throw"Type ["+b+'] "baseTypes" field should be an array';if(a.baseTypes){for(var c=0;c<a.baseTypes.length;c++){var d=a.baseTypes[c],e=this._extendingTypes[d];e||(e=[],this._extendingTypes[d]=e),e.contains(b)||e.push(b)}var f={},g=function(a){if(this.getBaseTypes(a).forEach(function(a){g(a)}),a.fields)for(var c=0;c<a.fields.length;c++){var d=a.fields[c];if(f[d.name]){if(f[d.name].type!=d.type)throw"Type ["+b+"] is invalid. Field ["+d.name+"] is defined both as ["+d.type+"] and as ["+f[d.name].type+"]"}else f[d.name]=d}}.bind(this);g(a)}},removeType:function(a){for(var b=this._extendingTypes[a]||[],c=0;c<b.length;c++){var d=b[c],e=this._typesMap[d];e.baseTypes&&e.baseTypes.erase(a)}delete this._extendingTypes[a],delete this._typesMap[a]},getExtendingTypes:function(a){var b=function(a,c){var d=this._extendingTypes[a];d&&d.forEach(function(a){b(a,c),c[a]=!0})}.bind(this),c={};return b(a,c),Object.keys(c)},getBaseTypeNames:function(a){return a&&a.baseTypes?a.baseTypes:[]},getBaseTypes:function(a){var b=[];return this.getBaseTypeNames(a).forEach(function(c){var d=this.getType(c);if(!d)throw"Base type ["+c+"] of type ["+this.getTypeName(a)+"] not found";b.push(d)}.bind(this)),b},getField:function(a,b){var c;return this._getInheritanceTreeDFS(a).forEach(function(a){if(a.fields)for(var d=0;d<a.fields.length;d++)a.fields[d].name==b&&(c=this._mergeFieldDefinitions(c,a.fields[d]))}.bind(this)),c},getFields:function(a){var b={};return this._getInheritanceTreeDFS(a).forEach(function(a){if(a.fields)for(var c=0;c<a.fields.length;c++){var d=a.fields[c].name;b[d]=this._mergeFieldDefinitions(b[d],a.fields[c])}}.bind(this)),Object.values(b)},isOf:function(a,b){var c=function(a){if(a==b)return!0;var d=this.getType(a);return this.getBaseTypeNames(d).some(function(a){return c(a,b)})}.bind(this);return c(a,b)},_getInheritanceTreeDFS:function(a){var b={},c=[],d=function(a){var e=this.getTypeName(a);b[e]||(b[e]=!0,c.push(a),this.getBaseTypes(a).forEach(d))}.bind(this);return d(a),c},_mergeFieldDefinitions:function(a,b){return a?(!a.defaultValue&&b.defaultValue&&(a.defaultValue=b.defaultValue),b.validations&&(a.validations=a.validations?a.validations.concat(b.validations):b.validations.clone()),a):Object.clone(b)},applyDefaults:function(a){function b(a){return d[a.collectionId+"/"+a.itemId]}function c(a){d[a.collectionId+"/"+a.itemId]=!0}var d={},e=function(a){if(a.isRef()){var d=a.getValue(0);if(b(d))return a;c(d)}var f=a.getTypeName();if(this.isArray(f))return a.getChildren().forEach(function(a){e(a)}.bind(this)),a;if(this.isSimple(f))return a;var g=this.getType(f);if(!g)return a;for(var h=this.getFields(g),i=0;i<h.length;i++){var j=h[i],k=a.getChildByRef(j.name);if(!k&&void 0!==j.defaultValue){var l=this.isSimple(j.type)?j.defaultValue:this.isArray(j.type)?Array.clone(j.defaultValue):Object.clone(j.defaultValue);a.addChild(l,j.name)}}return a.getChildrenRefs().forEach(function(b){var c=a.getChildByRef(b);e(c)}.bind(this)),a}.bind(this);return e(a)},validateDataItem:function(a){return this._validateDataItem(a,{validations:[]})},_validateDataItem:function(a,b){var c=a.getTypeName(),d=!0;if(a.isRef())return!0;if(b.validations&&b.validations.length>0){var e=a.getValue();d=this.validateValue(e,b)&&d}if("Array"==c)a.getChildren().forEach(function(a){a&&(d=this.validateDataItem(a)&&d)}.bind(this));else if(!this.isSimple(c)){var f=this.getType(c);this.getFields(f).forEach(function(b){if(b.computed!==!0){var c=a.getChildByRef(b.name);c&&(d=this._validateDataItem(c,b)&&d)}}.bind(this))}return a.fireEvent(Constants.DataItemEvents.VALIDATION_PERFORMED,{target:a,valid:d}),d},validateValue:function(a,b){for(var c=b.validations||[],d=0;d<c.length;d++){var e=c[d];if(!this._validator.validate(e.func,a,e.params||[]))return!1}return!0},isSimple:function(a){return a&&a.test(/^(String|Boolean|Number)$/)},isArray:function(a){return a&&a.test(/^Array(<.+>)?$/)},getArrayAllowedTypes:function(a){var b=a&&a.match(/^Array<(.+)>$/),c=[];if(b){var d=b[1];d.split(",").forEach(function(a){c.push(a.trim())})}return c},isRef:function(a){return a&&a.test(/^wix:Ref<.+>$/)},getReferredType:function(a){var b=a&&a.match(/^wix:Ref<(.+)>$/);return b&&b[1].trim()},isNative:function(a){return this.isSimple(a)||this.isArray(a)},getAllTypes:function(){return Object.values(this._typesMap)},getDefaultDataForType:function(a){if(Constants.WixAppsDefaultTypeValues.hasOwnProperty(a))return Constants.WixAppsDefaultTypeValues[a];for(var b=this.getBaseTypeNames(this.getType(a)),c=0;c<b.length;c++){var d=this.getDefaultDataForType(b[c]);if(d)return d}return void 0},getUniqueFieldName:function(a,b,c){var d=this.getType(a),e=function(a){var c=d.fields&&d.fields.some(function(c){return c.displayName===a&&c.name!==b});return!c};if(e(c))return c;for(var f=2;!e(c+" ("+f+")");)f++;return c+" ("+f+")"}})}),define.Class("wixapps.core.types.AppBuilderTypesHelper",function(a){var b=a;b.utilize(["wixapps.integration.managers.AppBuilderLocalizer","wixapps.core.managers.TypesManager"]),b.resources(["W.Utils"]),b.binds(["isDisplayableField","isMandatoryField","isLinkableField","isTitleField","getSortableFields"]),b.fields({_localizer:null,_nonDisplayableFields:[{key:"name",value:"links"}],_mandatoryFields:[{key:"name",value:"title"}],_linkableFields:[{key:"type",value:"String"},{key:"type",value:"wix:Image"}],_sortableFields:[{key:"type",value:"String"}],_titleFieldName:"title",_serverGeneratedFields:{_createdAt:"CREATED_AT",_updatedAt:"UPDATED_AT"},_typesManager:null,_utils:null}),b.methods({initialize:function(){this._typesManager=new this.imports.TypesManager,this._utils=this.resources.W.Utils.AppsUtils,this._localizer=new this.imports.AppBuilderLocalizer},_getFields:function(a){if("object"!==this._utils.getType(a))throw"AppBuilderTypesHelper:: invalid type definition. got ["+a+"] of type ["+this._utils.getType(a)+"] instead of an object.";return this._typesManager.getFields(a)},getSortableFields:function(a){var b=this._getFields(a),c=_.filter(b,this.isSortableField),d=this._localizer,e=_.map(this._serverGeneratedFields,function(a,b){return{name:b,displayName:d.localize(a,a)}});return c.concat(e)},getDisplayableFields:function(a){var b=this._getFields(a);return _.filter(b,this.isDisplayableField)},getMandatoryFields:function(a){var b=this._getFields(a);return _.filter(b,this.isMandatoryField)},getLinkableFields:function(a){var b=this._getFields(a);return _.filter(b,this.isLinkableField)},getTitleField:function(a){var b=this._getFields(a);return _.find(b,this.isTitleField)},isSortableField:function(a){return _.contains(_.keys(this._serverGeneratedFields),a.name)||"String"===a.type&&!(a.metadata&&"AsButton"===a.metadata.showAsHint)},isDisplayableField:function(a){return _.some(this._nonDisplayableFields,function(b){return a[b.key]!==b.value})},isMandatoryField:function(a){return _.some(this._mandatoryFields,function(b){return a[b.key]===b.value})},isLinkableField:function(a){return _.some(this._linkableFields,function(b){return a[b.key]===b.value})},isTitleField:function(a){return a.name===this._titleFieldName},isServerGeneratedField:function(a,b){if(!b.getParent())return!1;for(var c=_.keys(this._serverGeneratedFields),d=0;d<c.length;d++){var e=c[d],f=a.getChildByRef(e);if(f===b)return!0}return!1}})}),define.Class("wixapps.core.utils.AppLint",function(a){var b=a;b.binds(["_traverseCompNodes","_traverseLayoutNodes"]),b.fields({_lintRules:{},_traverseCache:{}}),b.methods({initialize:function(){this._lintRules={layout_in_comp:{walkFunc:this._traverseCompNodes,cond:function(a){return a.comp&&a.comp.layout},message:"Layout placed inside the comp instead alongside it."},dimension_in_comp:{walkFunc:this._traverseCompNodes,cond:function(a){return a.comp&&(a.comp.width||a.comp.height)},message:'Width/height placed inside the "comp" instead of the "layout" node.'},dimensions_as_string:{walkFunc:this._traverseLayoutNodes,cond:function(a){return a.width&&"string"==typeOf(a.width)&&!String.contains(a.width,"%")||a.height&&"string"==typeOf(a.height)&&!String.contains(a.height,"%")},message:"Width/height specified as a string where integer number might be used."},hbox_flexbox_conflict:{walkFunc:this._traverseCompNodes,cond:function(a){return a.comp&&"HBox"===a.comp.name&&a.comp.items?Array.some(a.comp.items,function(a){return a.layout&&void 0!==a.layout.width&&void 0!==a.layout["box-flex"]}):void 0},message:'"Width" property superfluous when horizontal "box-flex" specified.'},vbox_flexbox_conflict:{walkFunc:this._traverseCompNodes,cond:function(a){return a.comp&&"VBox"===a.comp.name&&a.comp.items?Array.some(a.comp.items,function(a){return a.layout&&void 0!==a.layout.height&&void 0!==a.layout["box-flex"]}):void 0},message:'"Height" property superfluous when vertical "box-flex" specified.'},box_dimension_100:{walkFunc:this._traverseCompNodes,cond:function(a){if(a.comp&&a.comp.items){if("VBox"===a.comp.name)return Array.some(a.comp.items,function(a){return a.layout&&"100%"==a.layout.height});if("HBox"===a.comp.name)return Array.some(a.comp.items,function(a){return a.layout&&"100%"==a.layout.width})}},message:'Width/height set to "100%" inside HBox/VBox is rendered inconsistently across the browsers.'}}},formatResult:function(a){var b=this._getNodePath,c="* AppLint *\n";return c+=a.length+" warning(s)\n",c+"	"+Array.map(a,function(a){return a.message+"\n"+a.nodes.map(function(a){return"		"+b(a)}).join("\n")}).join("\n	")},lintDescriptor:function(a){var b=this;return a=this._mapRelationships(a),this._traverseCache={},Object.values(this._lintRules).map(function(c){return b._applyRule(c,a)}).filter(function(a){return a})},_applyRule:function(a,b){var c=a.walkFunc(b).filter(a.cond);return c.length>0?{nodes:c,message:a.message}:void 0},_getNodePath:function(a){for(var b=[];a;)b.push(a),a=a._parent;return b.map(function(a){return Object.keys(a).filter(function(a){return["name","id","_iid","forType"].contains(a)}).map(function(b){return a[b]}).join(", ")}).filter(function(a){return a}).reverse().join(" > ")},_memoize:function(a,b){return a in this._traverseCache||(this._traverseCache[a]=b()),this._traverseCache[a]},_traverseCompNodes:function(a){var b=function(a){var c=[];return"array"===typeOf(a)?Array.forEach(a,function(a){c=c.concat(b(a))}):("object"===typeOf(a)&&c.push(a),a.comp&&a.comp.items&&a.comp.items.forEach(function(a){c=c.concat(b(a))}),a.comp&&a.comp.cases&&Object.each(a.comp.cases,function(a){c=c.concat(b(a))}),a.comp&&a.comp.columns&&"Table"==a.comp.name&&a.comp.columns.forEach(function(a){Array.forEach(["item","header","footer"],function(d){void 0!==a[d]&&(c=c.concat(b(a[d])))})})),c};return b(a.views)},_traverseLayoutNodes:function(a){return this._traverseCompNodes(a).map(function(a){return a.layout}).filter(function(a){return a})},_mapRelationships:function(a){var b=function(a,c){var d=typeOf(a);("object"==d||"array"==d)&&Object.each(a,function(c){b(c,a)}),a._parent=c},c=Object.clone(a);return b(c,null),c}})}),define.Class("wixapps.core.utils.ApplicationPerformanceSpy",function(a){var b=a;b.resources(["W.Viewer","W.Commands","W.Config"]),b.fields({_isReady:!1,_isRepoLoaded:!1,_reportToLog:!1,_firstCompId:null,_appParts2StartedToLoadTime:null,_appParts2FinishedLoadingTime:null,_lastCompId:null,_compIdsLogOrder:[],_partsLoggedData:{},_parts2LoggedData:[],_appInstance2:{phases:[]},_sendEventTimeout:3e4,_logSent:!1}),b.statics({appPartCommand:"ApplicationPerformanceSpy.logPhase",appPart2Command:"ApplicationPerformanceSpy.logPhase2",appInstanceCommand:"ApplicationPerformanceSpy.instanceLogPhase",category:{editor:1,viewer:2,core:3,server:4},type:{error:10,timing:20,funnel:30,userAction:40},eventId:80,eventSource:30,eventDescription:"Collect wixapps and ecommerce components loading time data",biAdapter:"ec2",eventSampleRatio:10,partsToLog:{"30b4a102-7649-47d9-a60b-bfd89dcca135":"productGallery","f72a3898-8520-4b60-8cd6-24e4e20d483d":"productPage","c029b3fd-e8e4-44f1-b1f0-1f83e437d45c":"viewCart","c614fb79-dbec-4ac7-b9b0-419669fadecc":"addToCartButton","5fca0e8b-a33c-4c18-b8eb-da50d7f31e4a":"joinedCart","4de5abc5-6da2-4f97-acc3-94bb74285072":"blog-feed"}}),b.methods({initialize:function(){var a=W.Utils.getQueryParam("timush");this._reportToLog="true"===a,this.resources.W.Config.env.$isPublicViewerFrame&&(this.resources.W.Commands.registerCommandAndListener(this.appPartCommand,this,this._onAppPartLogPhase,null),this.resources.W.Commands.registerCommandAndListener(this.appPart2Command,this,this._onAppPart2LogPhase,null),this.resources.W.Commands.registerCommandAndListener(this.appInstanceCommand,this,this._onInstanceLogPhase,null),setTimeout(function(){this._sendBILog()}.bind(this),this._sendEventTimeout)),this._isReady=!0},_getEvent:function(){return{type:this.type.timing,category:this.category.viewer,biAdapter:this.biAdapter,biEventId:this.eventId,desc:this.eventDescription,sampleRatio:this.eventSampleRatio}
},_sendBILog:function(){if(this._shouldSendEvent()){var a,b=0!==this._compIdsLogOrder.length?this._getParsedBIDataForParts():{};2==this._appInstance2.phases.length&&(a=this._getParsedBIDataForParts2());var c=this._getEvent();b.appBuilderTimes=a;var d={c1:JSON.stringify(b),c2:rendererModel.userId,src:this.eventSource};LOG.reportEvent(c,d),this._reportToLog&&console.log(JSON.stringify(a)),this._logSent=!0,this.resources.W.Commands.unregisterCommand(this.appPartCommand),this.resources.W.Commands.unregisterCommand(this.appPart2Command),this.resources.W.Commands.unregisterCommand(this.appInstanceCommand)}},_shouldSendEvent:function(){return this._logSent?!1:this.resources.W.Config.env.$isPublicViewerFrame?this._isRepoLoaded||0!==this._compIdsLogOrder.length?this._isAllComponentsDisplayed()?!0:!1:!1:!1},_isAllComponentsDisplayed:function(){for(var a=this._parts2LoggedData.length-1;a>=0;a--)if(!this._parts2LoggedData[a].displayed)return!1;for(var b in this._partsLoggedData)if(!this._partsLoggedData[b].done)return!1;return!0},_getParsedBIDataForParts:function(){for(var a=this._partsLoggedData[this._firstCompId].phases[0].time,b=_.last(this._partsLoggedData[this._lastCompId].phases).time,c={},d=0,e=this._compIdsLogOrder.length;e>d;d++){var f=this._compIdsLogOrder[d],g=this._partsLoggedData[f];c[d]={start:g.start,done:g.done,partName:g.partName,phases:{}};for(var h=g.start,i=0,j=g.phases.length;j>i;i++)c[d].phases[i]={step:g.phases[i].step,time:g.phases[i].time-h},h=g.phases[i].time}return{start:a,done:b,parts:c}},_getCompLogObj:function(a,b){return this._compIdsLogOrder.push(b),{start:LOG.getSessionTime(),done:0,partName:this.partsToLog[a]||a,phases:[]}},_addPhase:function(a,b,c){var d=LOG.getSessionTime(),e={step:b,time:d,params:c};a.phases.push(e),"displayed"==b&&(a.done=d)},_onAppPartLogPhase:function(a){if(a.appPart&&a.appPart.getDataItem()){a.extraParams=a.extraParams||{};var b=a.appPart.getComponentId(),c=a.appPart.getDataItem().get("appPartName");a.extraParams.className=a.appPart.className,b&&c&&this.partsToLog[c]&&(this._firstCompId||(this._firstCompId=b),this._lastCompId=b,this._partsLoggedData[b]=this._partsLoggedData[b]||this._getCompLogObj(c,b),this._addPhase(this._partsLoggedData[b],a.step,a.extraParams),this._sendBILog())}},_onAppPart2LogPhase:function(a){if(a.appPart&&a.appPart.getDataItem()){var b=LOG.getSessionTime(),c=a.appPart.getComponentId();this._appParts2StartedToLoadTime||(this._appParts2StartedToLoadTime=b),b>this._appParts2FinishedLoadingTime&&(this._appParts2FinishedLoadingTime=b);var d=this._getPartObj(c);d||(d={compId:c},this._parts2LoggedData.push(d)),d[a.step]=b,a.appPart.getDataSelector()&&!d.items&&(d.items=a.appPart.getDataSelector().isListSelector()?a.appPart.getDataSelector().getItemIds().length:1),this._sendBILog()}},_getPartObj:function(a){return _.find(this._parts2LoggedData,function(b){return b.compId===a})},_onInstanceLogPhase:function(a){var b=LOG.getSessionTime(),c={step:a.step,time:b};this._appInstance2.phases.push(c),this._isRepoLoaded="repo was loaded"===a.step&&2===this._appInstance2.phases.length},_calcDone:function(){var a=0;if(this._isAllComponentsDisplayed)for(var b=0;b<this._parts2LoggedData.length;b++){var c=this._parts2LoggedData[b].displayed;c&&c>a&&(a=c)}return a?a:null},_getParsedBIDataForParts2:function(){var a=-1,b=-1;return this._appInstance2.phases&&this._appInstance2.phases[0]&&this._appInstance2.phases[0].time&&(a=this._appInstance2.phases[0].time),this._appInstance2.phases&&this._appInstance2.phases[1]&&this._appInstance2.phases[1].time&&(b=this._appInstance2.phases[1].time),{start:this._appParts2StartedToLoadTime,done:this._calcDone(),isRepoLoaded:this._isRepoLoaded,repoStart:a,repoEnd:b,parts:this._parts2LoggedData}},isReady:function(){return this._isReady}})}),define.utils("AppsUtils",function(){var a=0,b=0,c="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split("");return{getTimeBasedUniqueId:function(c){var d=(new Date).getTime();b=d;var e=d===b?String(++a):"";return c=c?c.replace(/[^A-Za-z0-9_-]/g,""):"",c+d.toString(36)+e},generateLinkId:function(a){for(var b,d=[],e=0,f=0;8>f;f++)2>=e&&(e=33554432+16777216*Math.random()|0),b=15&e,e>>=4,d[f]=c[19==f?3&b|8:b];var g=d.join("");return a+"_"+g},getType:function(a){return Object.prototype.toString.call(a).match(/\s([a-zA-Z]+)/)[1].toLowerCase()},removeExtraSpaces:function(a){return a.replace(/(?:(?:^|\n)\s+|\s+(?:$|\n))/g,"").replace(/\s+/g," ")},getUserRole:function(a){var b=this.getResourceValueSync("W.Config").env.$isPublicViewerFrame;if(!b)return a("owner"),void 0;var c=function(b){b.owner===!0?a("owner"):"ACTIVE"===b.status?a("member"):a("none")}.bind(this);resource.getResourceValue("W.SiteMembers",function(a){a.getMemberDetails(c,c)})},getResourceValueSync:function(a){var b;return resource.getResourceValue(a,function(a){b=a}),b},createTaskRunner:function(){return{_tasks:[],_onDone:null,_done:function(){if(this._tasks.length<1)return this._onDone&&this._onDone(),void 0;var a=this._tasks.shift();a.func(this._done.bind(this))},add:function(a,b){this._tasks.push({name:a,func:b})},run:function(a){this._onDone=a,this._done()}}},deepEquals:function(a,b){var c=void 0!==a&&null!==a,d=void 0!==b&&null!==b;if(c!=d)return!1;var e=typeOf(a),f=typeOf(b);if(e!=f)return!1;switch(e){case"object":var g=Object.keys(a),h=Object.keys(b);if(g.length!=h.length)return!1;for(var i=0;i<g.length;i++){var j=g[i];if(!this.deepEquals(a[j],b[j]))return!1}break;case"array":if(a.length!=b.length)return!1;for(var k=0;k<a.length;k++)if(!this.deepEquals(a[k],b[k]))return!1;break;default:return a===b}return!0},combinePath:function(a,b){return(a.length>0&&"/"===a[a.length-1]?a:a+"/")+(b.length>0&&"/"===b[0]?b.substr(1):b)},urlBuilder:function(a){var b=this;return{_url:a,_params:{},addParam:function(a,b){return this._params[a]=b,this},addParams:function(a){return Object.merge(this._params,a),this},combinePath:function(a){return this._url=b.combinePath(this._url,a),this},toString:function(){var a=0===Object.keys(this._params).length?"":"?"+Object.toQueryString(this._params);return this._url+a}}},jsonp:function(a,b,c,d,e){b.callback=b.callback||c;var f=this.urlBuilder(a);f.addParams(b),window[c]=function(a){d&&d(a),delete window[c]};var g=new Element("script",{src:f.toString(),type:"text/javascript",charset:"UTF-8"});g.onerror=function(){e&&e.apply(this,arguments),delete window[c]},g.inject(document.head,"bottom")},JSONNative:new Class({Extends:Request,options:{secure:!0},initialize:function(a){this.parent(a),Object.append(this.headers,{Accept:"application/json","X-Request":"JSON"})},success:function(a){var b=this.response.json=Function.attempt(function(){return JSON.parse(a)});null==b?this.onFailure():this.onSuccess(b,a)}})}}),define.Class("wixapps.core.utils.DataServiceSaver",function(a){var b=a;b.methods({saveChanges:function(a,b,c){var d,e=a.getItemCache(),f=[],g=[],h=[],i=e.getItemsMarkedAsDeleted(),j=i.length;e.each(function(a,b){(a.isDirty()||!a.getChildValue("_hash"))&&f.push(b)});var k=function(){this._inSaveProcess=!1,h.length>0?c():b(g)}.bind(this),l=function(a,b){return function(){"create"==b?g.unshift(a):g.push(a),f.length+j==g.length+h.length&&k()}},m=function(a){return function(b){d=b,h.push(a),f.length+j==g.length+h.length&&k()}};return f.forEach(function(b){var c=e.get(b);c.getChildValue("_hash")?a.updateItem(e.idsFromKey(b).collectionId,c,l(b,"update"),m(b)):a.createItem(e.idsFromKey(b).collectionId,c,l(b,"create"),m(b))}),i.forEach(function(b){var c=e.idsFromKey(b);a.deleteItem(c.collectionId,c.itemId,l(b,"delete"),m(b))}),f.length>0||i.length>0},copyChanges:function(a,b,c,d){try{c.forEach(function(c){if(a.isItemMarkedAsDeleted(c))b.remove(c);else{var d=b.put(c,a.get(c).getValue(0));d.resetDirtyFlag()}})}catch(e){var f=d.getLogger();f.reportError(f.Errors.UNABLE_TO_REFRESH_AFTER_SAVE,this.$className,"onSuccess",f.SubCategory.DATA_EDITING)}},deleteItem:function(){}})}),define.Class("wixapps.core.utils.DataTypesUtils",function(a){var b=a;b.fields({_wixTypeMap:{string:"String",number:"Number","boolean":"Boolean",object:"wix:Object"},_typeDefaultValues:{String:"",Number:0,Boolean:!0}}),b.methods({initialize:function(){},generateTypeDefinitionFromData:function(a,b,c){var d=Object.keys(b).map(function(a){var d=this._wixTypeMap[typeOf(b[a])],e=c?b[a]:this._typeDefaultValues[d];return{_type:"wix:Field",name:a,type:d,defaultValue:e}}.bind(this)).filter(function(a){return Boolean(a.type)});return{_iid:a,_type:"wix:Type",fields:d}}})}),define.Class("wixapps.core.utils.DoubleOSeven",function(a){var b=a;b.fields({_options:{profile:!0,measure:!0},_activeProfiles:{}}),b.methods({initialize:function(){},_log:function(){window.console&&(window.console._oldConsole&&window.console._oldConsole.log&&window.console._oldConsole.log.apply(null,arguments),window.console.log&&window.console.log.apply(null,arguments))},_time:function(){return window.performance&&window.performance.now?window.performance.now():+new Date},_profile:function(a){window.console&&window.console.profile&&console.profile(a)},_profileEnd:function(a){window.console&&window.console.profileEnd&&console.profileEnd(a)},spyOn:function(a,b,c){c=_.merge({},this._options,c);var d=b[a],e=this;b[a]=function(){var f,g,h;c.profile&&(e._activeProfiles[a]=e._activeProfiles[a]||0,h=e._activeProfiles[a]++,e._profile(a+"_"+h)),c.measure&&(f=e._time());var i=d.apply(b,arguments);return c.measure&&(g=e._time(),e._log(a,g-f)),c.profile&&e._profileEnd(a+"_"+h),i}}})}),define.Class("wixapps.core.utils.EcomPaymentHandler",function(a){var b=a;b.inherits("wixapps.core.utils.WixServiceTransportBase"),b.resources(["W.Utils","W.MessagesController","W.Config"]),b.statics({ServiceBaseUrl:{PAYPAL:"http://safer-checkout.krembo.wixpress.com/payment-gateway/settings/updatePaypalSettings",getPaymentSetting:"http://safer-checkout.krembo.wixpress.com/payment-gateway/settings"}}),b.methods({_buildPostJsonUrl:function(a){var b=this.resources.W.Utils.AppsUtils.urlBuilder(this._getServiceUrl(a));return b.toString()},_getServiceUrl:function(a){var b=this.ServiceBaseUrl[a];if(!b)throw"EcomPaymentHandler:: Unknown operation requested.";return this._addServiceRequestParams(b)},_addServiceRequestParams:function(a){var b=this.resources.W.Utils.AppsUtils.urlBuilder(a);return b.addParams({metasiteId:this.resources.W.Config.getMetaSiteId(),appDefinitionId:this._appInstance.getAppDefinitionId()}),b.toString()},_openPaymentAccountWindow:function(a){var b=Q.defer(),c=function(a){var d=a.data;window.removeEventListener("message",c,!1),b.resolve(d)};return window.addEventListener("message",c,!1),window.open(a,"_blank"),b.promise},setPaymentSetting:function(a){var b=this._getServiceUrl(a);return this._openPaymentAccountWindow(b)},getPaymentSetting:function(){var a=Q.defer(),b={},c=function(b){a.resolve(b.data)},d=function(b){a.reject(b)};return this.doGetRequest("getPaymentSetting",b,null,c,d),a.promise}})}),define.component("wixapps.core.utils.ListCursor",function(a){var b=a;b.inherits("bootstrap.utils.Events"),b.traits([]),b.skinParts({}),b.states(),b.dataTypes(),b.fields({_currentItemIndex:-1}),b.methods({initialize:function(a,b){this._data=a,0>b?this.removeSelection():this.setSelectedIndex(b)},next:function(){this.setSelectedIndex(this._currentItemIndex+1)},prev:function(){this.setSelectedIndex(this._currentItemIndex-1)},last:function(){this.setSelectedIndex(this._getItemsLength()-1)},first:function(){this.setSelectedIndex(0)},_getItemsLength:function(){return this._data.getChildren().length},setSelectedIndex:function(a,b){if(a!=this._currentItemIndex){var c=this._currentItemIndex,d=this._getItemsLength();this._currentItemIndex=0===d?-1:a>=d?0:0>a?d-1:a,b||this.fireChangeEvent(this._currentItemIndex,c)}},hasSelection:function(){this._currentItemIndex>-1},removeSelection:function(){this._currentItemIndex=-1},fireChangeEvent:function(a,b){this.fireEvent(Constants.WixAppEvents.SELECTED_INDEX_CHANGED,{index:a||this._currentItemIndex,oldIndex:void 0===b?-1:b})},getCurrentItemIndex:function(){return this._currentItemIndex}})}),define.Class("wixapps.core.utils.Map",function(a){var b=a;b.fields({_keys:[],_values:[]}),b.methods({get:function(a){var b=this._keys.indexOf(a);return b>-1?this._values[b]:void 0},put:function(a,b){var c=this._keys.indexOf(a);-1===c?(this._keys.push(a),this._values.push(b)):this._values[c]=b},containsKey:function(a){return this._keys.indexOf(a)>-1},containsValue:function(a){return this._values.indexOf(a)>-1},remove:function(a){var b=this._keys.indexOf(a);if(b>-1){var c=this._values[b];return this._keys.splice(b,1),this._values.splice(b,1),c}return void 0},getKeys:function(){return this._keys.concat()},getValues:function(){return this._values.concat()},getEntries:function(){return this._keys.map(function(a,b){return{key:a,value:this._values[b]}}.bind(this))},clear:function(){this._keys=[],this._values=[]}})}),define.Class("wixapps.core.utils.SocialShareHandler",function(a){var b=a;b.utilize(["core.components.image.ImageUrlNew","wixapps.core.utils.WixAppsLogger","wixapps.integration.managers.WixAppsLocalizer"]),b.resources(["W.Viewer","W.MessagesController","W.Config","W.Utils"]),b.statics({GOOGLE_SHARE_URL:"https://plus.google.com/share?url=",FANCY_SHARE_URL:"http://www.fancy.com/fancyit/fancy?ItemURL=",PINTEREST_SHARE_URL:"http://pinterest.com/pin/create/button/?url=",TWITTER_SHARE_URL:"https://twitter.com/intent/tweet?url=",FACEBOOK_SHARE_URL:"http://www.facebook.com/sharer.php?u=",ACTIVITY_MAPPER:{facebook:"FACEBOOK",google:"GOOGLE_PLUS",twitter:"TWITTER"}}),b.methods({initialize:function(){this._imgUtils=new this.imports.ImageUrlNew,this._logger=new this.imports.WixAppsLogger,this._localizer=new this.imports.WixAppsLocalizer},handleShareRequest:function(a,b,c,d,e,f){this.resources.W.Config.env.$isPublicViewerFrame?(this._service=a,this._url=b,this._title=c,this._imageUrl=d,this._isPyramidImg=void 0!==e?e:!0,this._addDeepLinkParam=void 0!==f?f:!0,this._processShareRequest()):this._dismissShareRequest()},getSocialActivityValue:function(a){return this.ACTIVITY_MAPPER[a]},_processShareRequest:function(){var a="";switch(this._service){case"google":a=this._getGoogleShareUrl();break;case"fancy":a=this._getFancyShareUrl();break;case"pinterest":a=this._getPinterestShareUrl();break;case"twitter":a=this._getTwitterShareUrl();break;case"facebook":a=this._getFacebookShareUrl()}this._logger.reportEvent(this._logger.Events.USER_SHARED_PAGE,{c1:encodeURIComponent(this._url),c2:this._service}),this.resources.W.Utils.openPopupWindow(a,"wixapps_share","width=635,height=346,scrollbars=no,status=no,toolbar=no,menubar=no,location=no")},_getGoogleShareUrl:function(){var a=this.GOOGLE_SHARE_URL;return a+=this._getSharePageURL()},_getFancyShareUrl:function(){var a=this.FANCY_SHARE_URL;return a+=this._getSharePageURL(),a+="&Title="+this._getShareTitle(),a+="&ImageURL="+this._getImageUrl()},_getPinterestShareUrl:function(){var a=this.PINTEREST_SHARE_URL;return a+=this._getSharePageURL(),a+="&media="+this._getImageUrl(),a+="&description="+this._getShareTitle()},_getTwitterShareUrl:function(){var a=this.TWITTER_SHARE_URL;return a+=this._getSharePageURL(),a+="&text="+this._getShareTitle()+encodeURIComponent("\n")},_getFacebookShareUrl:function(){var a=this.FACEBOOK_SHARE_URL;return a+=this._getSharePageURL(),a+="&t="+this._getShareTitle()},_dismissShareRequest:function(){var a=this._localizer.localize("OH_OH_MSG_TITLE"),b=this._localizer.localize("SHARE_BLOCKED_IN_PREVIEW_MSG_DESC");this.resources.W.MessagesController.showMessage(a,b)},_getSharePageURL:function(a){if(this._addDeepLinkParam){var b="deeplink_referrer=socialB_"+this._service;this._url=this._addQueryParamToUrl(this._url,b)}var c=this._url.split("#!");return c.length>1&&(c[1]=decodeURIComponent(c[1]),this._url=c.join("#!")),a&&(this._url=this._url.replace("#!","/#!")),encodeURIComponent(this._url)},_addQueryParamToUrl:function(a,b){var c=a.split("#"),d=-1!=a.indexOf("?")?"&":"?";return c[0]+=d+b,c.join("#")},_getShareTitle:function(){return this._title?encodeURIComponent(this._title):""},_getImageUrl:function(){var a="";return this._imageUrl&&(a=this._isPyramidImg&&0!==this._imageUrl.indexOf("http")?this._imgUtils.getImageUrlExactSizeKeepRatio({x:250,y:250},this._imageUrl):this._imageUrl,a=encodeURIComponent(a)),a}})}),define.Class("wixapps.core.utils.UserExperienceKeyHandler",function(a){var b=a;b.fields({}),b.statics({KEYS:{DELETE_ITEM_CONFIRM:"wixapps_delete_item_confirmation",DELETE_FIELD_CONFIRM:"wixapps_delete_field_confirmation"}}),b.methods({setItem:function(a,b){Object.values(this.KEYS).contains(a)&&localStorage.setItem(a,b)},setItemIfNotDefined:function(a,b){this.isSet(a)||this.setItem(a,b)},getItem:function(a){return Object.values(this.KEYS).contains(a)?localStorage.getItem(a):void 0},isSet:function(a){var b=localStorage.getItem(a);return b}})}),define.Class("wixapps.core.utils.WixAppsLogger",function(a){var b=a;b.resources(["W.Config"]),b.statics({LISTS_EVENT_SOURCE:60,Type:{ERROR:10,USER_ACTION:40},Category:{EDITOR:1,VIEWER:2,CORE:3,SERVER:4},SubCategory:{GENERAL:0,PROXY:1,APP_LOGIC:2,DATA_SERVICE:3,DATA_ITEMS:4,CORE_WIRING:5,DATA_EDITING:6,APP_BUILDER:7,APP_REPO_SERVICE:8},Severity:{RECOVERABLE:10,WARNING:20,ERROR:30,FATAL:40},Errors:{GENERIC_ERROR:{code:-2e4,description:"WixApps unspecified error"},APP_INSTANCE_NOT_LOADED:{code:-20001,description:"Application instance failed to load"},UNABLE_TO_REFRESH_AFTER_SAVE:{code:-20002,description:"Failed to update views after data save"},UNABLE_TO_LOAD_DATA_ITEM_FROM_PARAMS:{code:-20003,description:"Failed to load data item from url params"},CREATE_ITEM_CALLED_FOR_NON_NEW:{code:-20004,description:"CreateItem called with a non-new item"},UPDATE_ITEM_CALLED_FOR_NEW:{code:-20005,description:"UpdateItem called with a new item"},RESTORE_ITEM_CALLED_FOR_NEW:{code:-20006,description:"RestoreItem called with a new item"},RESTORE_ITEM_CALLED_FOR_EXISTING:{code:-20007,description:"RestoreItem called with an existing item"},ITEM_NOT_FOUND:{code:-20008,description:"ReadItem called with unknown item"},WIX_DATA_PROVIDER_DOESNT_EXIST:{code:-20009,description:"Data provider wasn't found in loaded app definition"},FAILED_TO_LOAD_EXTERNAL_APP_MANIFEST:{code:-20010,description:"Failed to load external app manifest"},APP_PART2_FAILED_TO_LOAD:{code:-20011,description:"Failed to load app part"},APP_INSTANCE2_CLEANUP_FAILED:{code:-20012,description:"Failed to cleanup app instance2 because: "},DATA_SELECTOR_CONTAINS_NULL:{code:-20013,description:"A data selector returned from the server with a null id key."},DATA_SELECTOR_MISSING_ITEMS:{code:-20014,description:"A data selector has ids of items that does not exist in the server"},PAGE_ENVIRONMENT_OF_UNKNOWN_TYPE:{code:-20015,description:"A page data contained appPageType that did not have an AppPageEnvironment definition"}},Events:{APP_BUILDER_SAVE:{id:100,description:"App builder - save"},APP_BUILDER_PART_ADDED:{id:101,description:"App builder - part added"},APP_BUILDER_FIELD_ADDED:{id:102,description:"App builder - field added"},APP_BUILDER_PART_LOADED:{id:103,description:"App builder - part loaded in published"},APP_BUILDER_ORGANIZE_CLICKED:{id:104,description:"App builder - organized clicked"},APP_BUILDER_PART_ERROR:{id:105,description:"App builder - part error"},USER_SHARED_PAGE:{id:106,description:"User shared page"},APP_BUILDER_PUBLISH:{id:107,description:"App builder - publish"},APP_PART_COPIED:{id:108,description:"App Builder - app part copied"},APP_PART_PASTED:{id:109,description:"App Builder - app part pasted"},APP_PART_DELETED:{id:110,description:"App Builder - List deleted"},APP_BUILDER_APP_LINK_CLICKED:{id:111,description:"App Builder - List Item selected, item will open in separate page"},APP_BUILDER_MOVED_TO_APP_PAGE_IN_VIEWER:{id:112,description:"App Builder - Moved to app page in preview"},APP_BUILDER_MOVED_TO_APP_PAGE_IN_EDITOR:{id:113,description:"App Builder - Moved to app page in viewer"},APP_BUILDER_ITEM_ADDED:{id:114,description:"App Builder - item Added"},BLOG_REMOVED:{id:115,description:"Blog - removed from site"},FLEX_SHRINK_BUG_DETECTED:{id:116,description:"Flex-shrink-bug detected"},APP_BUILDER_FILTER_APPLIED:{id:117,description:"User applied filter to a data set."},APP_BUILDER_USER_ADDED_NEW_LIST:{id:118,description:"User clicked the add 'List-Builer' from main menu"},APP_BUILDER_NEW_DATA_SET_ADDED:{id:119,description:"User selected to add a new Data-Set."},APP_BUILDER_EXISTING_DATA_SET_ADDED:{id:120,description:"User selected to re-use an existing Data-Set."},APP_BUILDER_NEW_LIST_CANCELED:{id:121,description:"User clicked add new list builder from menu then clicked X without making a selection."},APP_BUILDER_DELETED:{id:122,description:"User deleted a new 'List-Builder'."},APP_BUILDER_TOGGLE_PAGINATION:{id:123,description:"App Builder - User toggled pagination"},ADD_WIX_APP:{id:124,description:"A wix app has been added"},CMS_ITEM_ADDED:{id:125,description:"Added an item to the CMS"},CMS_ITEM_DELETED:{id:126,description:"Deleted an item from the CMS"},CMS_ITEM_UPDATED:{id:127,description:"Updated an item in the CMS"},APP_BUILDER_USER_CLOSED_TEMPLATE_PICKER:{id:128,description:"A user closed the template picker without choosing anything."},APP_BUILDER_USER_TOGGLED_ITEM_PAGE:{id:129,description:"A user toggled on/off the item page in the App Builder control panel."},APP_BUILDER_EXISTING_DATA_SET_DIALOG_SHOWN:{id:130,description:"Dialog with 'What would you like to add' for users with existing data sets popped."},APP_BUILDER_EXISTING_DATA_SET_DIALOG_CANCELED:{id:131,description:"User closed 'What would you like to add' dialog (without selecting anything)"},APP_BUILDER_FILTER_DIALOG_CANCELED:{id:132,description:"User closed the filter screen with cancel or 'x'."},APP_BUILDER_USER_STARTED_EDITING:{id:133,description:"User started editing an item from a list."},APP_BUILDER_USER_CHANGED_TO_MANUAL_HEIGHT:{id:134,description:"User applied manual height."},APP_PART2_FAILED_TO_LOAD_DATA_SELECTOR:{id:135,description:"Failed to load data selector"},APP_PART2_FAILED_TO_LOAD_PART_DEFINITION:{id:136,description:"Failed to load app part definition"},VIEW_DEFINITION_NOT_FOUND:{id:137,description:"Failed to load view definition"},APP_BUILDER_REPORT_INSTANCE_IDS:{id:138,description:"AppBuilder instanceId across the flow. {c1:pre-save, g1:post-save, i1:post-provision}"},APP_BUILDER_USER_DELETED_TYPE:{id:139,description:"User deleted the last app part with the library (using the checkbox)."},APP_BUILDER_SAVE_START:{id:140,description:"App builder save process start."},APP_BUILDER_APP_INSTANCE_ERROR_NO_SAVE:{id:141,description:"App Builder Application Instance has an error so we don't save."},APP_BUILDER_FIRST_SAVE_PROVISION_FAILED:{id:142,description:"App builder provision during editor first save failed."},APP_BUILDER_BEFORE_SAVE_REPO:{id:143,description:"App builder before saving the repo."},APP_BUILDER_SKIP_SAVE_REPO:{id:144,description:"App builder skip calling save repo (appInstance is not dirty)."},APP_BUILDER_BEFORE_SAVE_ITEMS:{id:145,description:"App builder before saving the items."},APP_BUILDER_SKIP_SAVE_ITEMS:{id:146,description:"App builder skip calling save items (appInstance is not dirty)."},APP_BUILDER_IN_STATE_TEMPLATE_FOUND_IN_SAVED_SITE:{id:153,description:"An app-builder application in state Template found in a saved site (Invalid state)."},APP_BUILDER_IN_STATE_TEMPLATE_FOUND_IN_SAVED_SITE_PROVISIONED:{id:154,description:"An app-builder application in state Template found in a saved site and was provisioned."},FORM_FAILED_TO_LOAD_DEFINITION:{id:155,description:"Failed to load form definition"},FORM_FAILED_TO_LOAD_DATA_SELECTOR:{id:156,description:"Failed to load data selector"},FORM_DELETED:{id:157,description:"User deleted a new 'Form'."},FORM_LOADED:{id:158,description:"Form loaded in published"},FORM_ERROR:{id:159,description:"App builder - form error"},FORM_LOADED_WITH_INVALID_SELECTOR:{id:160,description:"The form data selector is not a single item selector."},APP_BUILDER_USER_ADDED_NEW_FORM:{id:161,description:"User clicked the add 'List-Builer' from main menu"},APP_BUILDER_REPO_SAVE:{id:162,description:"App builder repo save"},APP_BUILDER_ITEMS_SAVE:{id:163,description:"App builder items save"},APP_BUILDER_FILTER_SELECTION_DIALOG_OPEN:{id:190,description:"User open the filter panel."},APP_BUILDER_FILTER_SELECTION_SELECT_TYPE:{id:191,description:"User clicks on the tabs in the filter dialog."},APP_BUILDER_FILTER_SELECTION_CLICK_OK:{id:192,description:"User clicked OK on the filter dialog."},APP_BUILDER_FILTER_SELECTION_CLICK_SORT:{id:193,description:"User sorted the items"},APP_BUILDER_FILTER_SELECTION_UOU_FILTERING_ENABLE:{id:194,description:"User enabled UoU filter on the list"},APP_BUILDER_FILTER_SELECTION_UOU_FILTERING_DISABLE:{id:195,description:"User disabled UoU filter on the list"},APP_BUILDER_FILTER_SELECTION_UOU_FILTERING_TAG_SELECTED:{id:196,description:"User chose a default tag for UoU filtering"},OPEN_ITEM_FOR_EDITING:{id:200,description:"Opened item for editing"},BUBBLE_OPENED:{id:201,description:"A bubble was shown to the user."},TAGS_FIRST_TIME_BUBBLE_APPEARED:{id:300,description:"First time bubble appeared"},TAG_CREATED:{id:301,description:"User adds a tag to an item."},TAG_ADDED_TO_ITEM:{id:302,description:"User adds a tag to an item."},TAG_REMOVED_FROM_ITEM:{id:303,description:"User removes a tag from an item."},APP_BUILDER_ITEM_TAG_HELP_CLICKED:{id:304,description:"User opened the explanation bubble in the Items tab."},TAG_SELECTED_IN_VIEWER:{id:305,description:"User selected a tag in the viewer."}}}),b.methods({reportError:function(a,b,c,d,e,f){try{var g={desc:a.description||this.Errors.GENERIC_ERROR.description,errorCode:a.code||this.Errors.GENERIC_ERROR.code,type:this.Type.ERROR,issue:d||this.SubCategory.GENERAL,severity:e||this.Severity.ERROR,category:f||this.getDefaultCategory()};LOG.reportError(g,b,c,{src:this.LISTS_EVENT_SOURCE,desc:a.description})}catch(h){}},reportEvent:function(a,b){try{var c={type:this.Type.USER_ACTION,desc:a.description,biEventId:a.id,biAdapter:"lists",category:this.getDefaultCategory()};b=b||{},b.src=this.LISTS_EVENT_SOURCE,LOG.reportEvent(c,b)}catch(d){}},getDefaultCategory:function(){return this.resources.W.Config.env.$isPublicViewerFrame?this.Category.VIEWER:this.Category.EDITOR}})}),define.Class("wixapps.core.utils.WixServiceTransportBase",function(a){var b=a;b.utilize(["wixapps.core.utils.WixAppsLogger"]),b.resources(["W.Utils"]),b.fields({_logger:null,_appInstance:null}),b.methods({initialize:function(a){this._appInstance=a},_getServiceUrl:function(){},getLogger:function(){return this._logger||(this._logger=new this.imports.WixAppsLogger),this._logger},doRequest:function(a,b,c,d,e){this._doRequestInternal(a,b,c,"POST",d,e)},doGetRequest:function(a,b,c,d,e){this._doRequestInternal(a,b,c,"GET",d,e)},_extractBasePath:function(a){var b=document.createElement("a");return b.href=a,b.protocol+"//"+b.hostname},_doRequestInternal:function(a,b,c,d,e,f){f||(f=function(a){throw a.description+" ("+a.code+")"}),e||(e=function(){}),d||(d="POST");var g=function(a){var b=this.getLogger();b.reportError(a,this.$className,"doRequest",b.SubCategory.DATA_SERVICE)}.bind(this),h=function(a){if(a.success)e(a.payload);else{var b={code:a.errorCode,description:a.errorDescription};g(b),f(b)}}.bind(this),i=function(a){var b={code:a.status?a.status:-1,description:a.statusText?a.statusText:"Unspecified error occurred, possibly a connection problem"};g(b),f(b)};this._postJsonRequest(a,b,c,d,h,i)},_buildPostJsonUrl:function(a,b){var c=this.resources.W.Utils.AppsUtils.urlBuilder(this._getServiceUrl(a));return c.combinePath(a),c.addParams(b),c.toString()},_getJSONPCallbackName:function(){return"parseResponse"},doJSONPRequest:function(a,b,c,d){var e=this._getJSONPCallbackName(a);b.callback||(b.callback=e);var f=this.resources.W.Utils.AppsUtils.urlBuilder(this._getServiceUrl(a));f.combinePath(a),f.addParams(b),window[e]=function(a){c&&c(a),delete window[e]};var g=new Element("script",{src:f.toString(),type:"text/javascript",charset:"UTF-8"});g.onerror=function(){d&&d.apply(this,arguments),delete window[e]},g.inject(document.head,"bottom")},_postJsonRequest:function(a,b,c,d,e,f){var g=this._buildPostJsonUrl(a,b),h=new this.resources.W.Utils.AppsUtils.JSONNative({url:g,urlEncoded:!1,onSuccess:e,onFailure:f,method:d,data:c?JSON.stringify(c):""});h.options=h.options||{},h.options.headers=h.options.headers||{},h.options.headers["If-Modified-Since"]="Sat, 1 Jan 2005 00:00:00 GMT",h.options.headers["Content-Type"]="application/json; charset=utf-8",h.options.headers.Accept="application/json",h.send()}})}),define.Class("wixapps.core.views.ProxyFactory",function(a){var b=a;b.utilize(["wixapps.core.events.ProxyEventBus","wixapps.core.views.ViewEnvironment","wixapps.core.views.ViewContext","wixapps.core.data.DataItemUtils","wixapps.core.expressions.EvalScopeWrapper","wixapps.core.views.ViewEvaluationContext"]),b.fields({_viewRepository:null,_dataItemFactory:null,_typesManager:null,_managers:null,_byName:{},_eventDispatcher:null,_resourceResolverFunction:null,_lifecycleManager:null,_dataItemUtils:null,_defaultTypeForProxy:{},_stylesheetManager:null}),b.methods({initialize:function(a,b,c,d,e,f,g,h,i,j){this._viewRepository=c,this._dataItemFactory=a,this._typesManager=b,this._eventDispatcher=d||new this.imports.ProxyEventBus,this._resourceResolverFunction=e,this._nameSpace=f,this._lifecycleManager=g,this._hostingComponent=h,this._dataItemUtils=new this.imports.DataItemUtils,this._stylesheetManager=i,this._externalVars=j},registerProxy:function(a,b,c){this._byName[a]=b,c=c||"",this._defaultTypeForProxy[a]=c},createView:function(a,b,c,d){c=c||"",d=d||{};var e={parent:void 0,vars:{}};this._externalVars&&this._externalVars.getChildrenRefs&&this._externalVars.getChildrenRefs().forEach(function(a){e.vars[a]=this._externalVars.getChildByRef(a)}.bind(this));var f=new this.imports.ViewEnvironment(this._dataItemFactory,this._typesManager,this,b,a.getTypeName(),c,this._eventDispatcher,[],e,void 0,this._lifecycleManager),g=new this.imports.ViewContext(f,a);return _.forEach(d,function(a,b){g.getEnvironment().setVar(b,a)}),this._createViewInternal(g,b)},getViewDefinition:function(a,b,c){var d=this._viewRepository.getViewDefinition(a,b,c);if(d)return d;for(var e=this._typesManager.getBaseTypeNames(this._typesManager.getType(a)),f=0;f<e.length;f++){var g=this.getViewDefinition(e[f],b,c);if(g)return g}return void 0},hasViewDefinition:function(a,b,c){var d=this._viewRepository.hasViewDefinition(a,b,c);if(d)return!0;for(var e=this._typesManager.getBaseTypeNames(this._typesManager.getType(a)),f=0;f<e.length;f++){var g=this.hasViewDefinition(e[f],b,c);if(g)return!0}return!1},getProxyClassByName:function(a){return this._byName[a]},_createViewInternal:function(a,b){var c=a.getData().getTypeName(),d=a.getEnvironment(),e=d.getFormatName(),f=this.getViewDefinition(c,b,e);if(!f)throw"View definition ["+b+"] for type ["+c+"] is missing in the repository";var g=f.getChildValue("format")||"",h=f.getChildByRef("comp");if(!h||!h.getChildValue("name"))throw"View definition ["+b+"] for type ["+c+"] is incorrect. Missing comp.name attribute";var i=f.getChildValue("forType");d.setViewName(b),d.setVar("viewName",b),d.setForType(i),d.setVar("viewDataType",c),d.setViewFormatName(g),d.getTreePath().pushScope(),d.addIncludedView(i,b,g),this._setupViewVariables(a,f),f=this.createNewEvaluationScope(f,a);var j=f.getChildByRef("stylesheet");j&&this._stylesheetManager.addStylesheetItem(d,j);var k=this.createProxyFromItemDefinition(a,f);return k.proxy},_resolveItemDataForProxy:function(a,b,c){var d=a.resolveTypeForPath(b);if(d||(d=this._defaultTypeForProxy[c]),!d)throw"Unable to resolve Type of field ["+b+"] in item ["+JSON.stringify(a.getData().getValue())+"]";var e,f=this._typesManager.getType(a.getData().getTypeName()),g=this._typesManager.getField(f,b);if(g&&g.hasOwnProperty("defaultValue")&&(e=this._dataItemFactory.createDataItem(g.defaultValue)),!e){var h=this._typesManager.getDefaultDataForType(d);
if(void 0===h)throw"Unable to resolve default value for type ["+d+"] it might be missing in the ProxyMap";e=this._dataItemFactory.createDataItem(h)}return e},createProxyFromItemDefinition:function(a,b){var c=b.getChildValue("id"),d=a.getEnvironment();if(!c)throw"ID not defined for an item in ["+JSON.stringify(b.getValue())+"] in view for ["+d.getForType()+"|"+d.getViewName()+"]";var e=b.getChildByRef("value"),f=a.getData(),g=this._dataItemFactory,h=b.getChildByRef("comp")||b.addChild({},"comp"),i=!0;if(e){var j=g.createDataItem(b.getChildValue("value"));b.getChildByRef("value").addEvent(Constants.DataItemEvents.CHANGE,function(){j.setValue(b.getChildValue("value"))}),f=j}else{var k=b.getChildValue("data")||"this";if(f=a.evaluatePath(k),!f){i=!1;var l=this._resolveProxyName(a.getData().getTypeName(),h,d.getViewName(),d.getForType(),d.getFormatName());"view"===l.type?(h=g.createDataItem({name:"Empty"}),f=g.createDataItem({})):f=this._resolveItemDataForProxy(a,k,l.name)}if(!f)throw"Evaluation of ["+k+"] on type ["+a.getData().getTypeName()+"] did not generate child context"}var m=this._createProxy(a,f,h,c);return m.setIsBound(i),{id:c,proxy:m}},_createProxy:function(a,b,c,d){var e=a.getEnvironment(),f=b.getTypeName(),g=e.getViewName(),h=e.getFormatName(),i=this._resolveProxyName(f,c,g,e.getForType(),h);if(!i.name)throw"Cannot resolve view/proxy for type ["+f+"] in context of view ["+g+"] in format ["+h+"]";if("view"==i.type)return a=a.newContextForData(b),this._setupViewVariables(a,c),this._createViewInternal(a,i.name);c.getParent()&&"new"===c.getParent().getChildValue("scope")&&(a=a.newContextForData(b));var j=this._byName[i.name];if(!j)throw"Proxy ["+i.name+"] for type ["+f+"] is not registered in factory";return new j(a,b,c,d)},_setupViewVariables:function(a,b){function c(a,b){if(0===a.indexOf("ancestor.")){a=a.substr("ancestor.".length);var c=d.getVar(a);if(!c)throw"Variable ["+a+"] is not defined on any of your ancestors";c.setValue(b.getValue(void 0,e))}else d.setVar(a,b.getValue(0))}var d=a.getEnvironment(),e=new this.imports.ViewEvaluationContext(a),f=b.getChildByRef("vars");if(f)for(var g=f.getChildrenRefs(),h=0;h<g.length;h++){var i=g[h],j=f.getChildByRef(i);c(i,j);j.addEvent(Constants.DataItemEvents.CHANGE,function(a,b,d){return function(){c(b,d)}}(d,i,j))}},resolveResourcePath:function(a){return this._resourceResolverFunction&&this._resourceResolverFunction(a)||a},getNameSpace:function(){return this._nameSpace},getHostingComponent:function(){return this._hostingComponent},_resolveProxyName:function(a,b,c,d,e){var f=b.getChildValue("name"),g=f||c;if(this.hasViewDefinition(a,g,e))return{name:g,type:"view"};if(f)return{name:f,type:"proxy"};throw"Component [name] was not defined in view ["+c+"|"+d+"] for data type ["+a+"]"},createNewEvaluationScope:function(a,b){if(this._dataItemUtils.findExprItems(a).length>0){var c=new this.imports.ViewEvaluationContext(b),d=new this.imports.EvalScopeWrapper(a,c,b.getEnvironment());return d.getData()}return a}})}),define.Class("wixapps.core.views.ViewContext",function(a){var b=a;b.fields({_parent:null,_data:null,_computedFields:{}}),b.methods({initialize:function(a,b,c,d){this._env=a.newCopy(),this._data=b,this._parent=d,this._computedFields=c||{}},getEnvironment:function(){return this._env},getData:function(){return this._data},getParent:function(){return this._parent},newContextForData:function(a){var b=new this.constructor(this._env,a,this._computedFields,this);return b.getEnvironment().getTreePath().pushScope(),b},newContextFromPath:function(a){var b=this.evaluatePath(a);return b?new this.constructor(this._env,b,this._computedFields,this):void 0},evaluatePath:function(a){return this._evaluatePathRecursive(a.split("."),this._data)},_evaluatePathRecursive:function(a,b){if(0===a.length)return b;var c=a.shift(),d=b,e=-1,f=c.match(/^(.*)\[([0-9]+)\]$/);if(f&&(c=f[1],e=f[2]),"parent"==c)return this._parent?this._parent._evaluatePathRecursive(a,-1==e?this._parent._data:this._parent._data.getChildByIndex(e)):void 0;if("this"==c)return this._evaluatePathRecursive(a,-1==e?this._data:this._data.getChildByIndex(e));if(0===c.indexOf("$")){if(d=this._env.getVar(c.substr(1)),!d)return void 0}else{if(!d.getChildByRef)return void 0;var g=d.getChildByRef(c);if(d=g?g:this._getComputedChild(d,c),!d)return void 0}if(-1!=e){if(!d.getChildByIndex)return void 0;if(d=d.getChildByIndex(e),!d)return void 0}return this._evaluatePathRecursive(a,d)},_getComputedChild:function(a,b){var c=this._env.getTypesManager(),d=a.getTypeName();if(c.isNative(d)||"wix:Object"==d)return void 0;var e=c.getType(d);if(!e)return void 0;var f=c.getField(e,b);return f&&f.computed===!0?this._env.getDataItemFactory().createComputedField(f.name,f.type,d,a):void 0},resolveTypeForPath:function(a){var b=a.split(".").length>1||0===a.indexOf("$")||0===a.indexOf("parent");if(b)return void 0;var c=this._data.getTypeName(),d=a,e=-1,f=d.match(/^(.*)\[([0-9]+)\]$/);if(f&&(d=f[1],e=f[2]),"this"==d)return c;var g=this._env.getTypesManager(),h=g.getType(c),i=g.getField(h,d);if(!i)return void 0;if(-1==e)return i.type;var j=g.getArrayAllowedTypes(i.type);return j.length>0?j[0]:void 0}})}),define.Class("wixapps.core.views.ViewDefinitionsOverrideRepository",function(a){var b=a;b.fields({_map:{},_baseViewDefRepo:null,_customizations:null,_dataItemFactory:null}),b.methods({initialize:function(a,b,c){this._baseViewDefRepo=a,this._customizations=b,this._dataItemFactory=c},getViewDefinition:function(a,b,c){c=c||"";var d=a+"|"+b+"|"+(c||""),e=this._map[d];if(!e){var f=this._baseViewDefRepo.getViewDefinitionWithFormat(a,b,c);if(!f)return c?this.getViewDefinition(a,b,""):void 0;var g=f.getValue(0);this._customizations.applyAll(g),e=this._dataItemFactory.createDataItem(g),this._map[d]=e}return e},hasViewDefinition:function(a,b,c){return this._baseViewDefRepo.hasViewDefinition(a,b,c)},getAllViewDefinitions:function(){var a=Object.values(this._map);return a.sort(function(a,b){var c=function(a,b){return a>b?1:a==b?0:-1},d=c(a.getChildByRef("forType").getValue(),b.getChildByRef("forType").getValue());return 0!==d?d:c(a.getChildByRef("name").getValue(),b.getChildByRef("name").getValue())}),a}})}),define.Class("wixapps.core.views.ViewDefinitionsRepository",function(a){var b=a;b.inherits("bootstrap.utils.Events"),b.binds(["_onClonedViewChanged"]),b.utilize(["wixapps.core.data.DataItemFactory","wixapps.core.utils.WixAppsLogger","wixapps.core.views.ViewsCustomizer"]),b.fields({_dataItemFactory:null,_clonedTargets:[],_map:{},_mapRaw:{},_byType:{},_logger:null}),b.methods({initialize:function(a,b){this._dataItemFactory=a,this._preProcessingViewDefFunction=b,this._logger=new this.imports.WixAppsLogger},clone:function(){var a=this.getAllViewDefinitions(),b=this.constructor,c=new b(this._dataItemFactory);return a.forEach(function(a){c.setViewDefinition(a.getValue(0),!0)}),c._mapRaw=this._mapRaw,c},cloneAndMultiply:function(a){var b=[];if("array"==typeOf(a.name)){for(var c=0;c<a.name.length;c++){var d=Object.clone(a);d.name=a.name[c],b.push(d)}return b}return b.push(Object.clone(a)),b},setViewDefinition:function(a,b){var c=a.name,d=a.forType,e=a.format||"",f=d+"|"+c+"|"+e;this._mapRaw[f]=a;var g=this._map[f];b&&!g&&(g=this.getViewDefinition(d,c)),g&&g.setValue(a);var h=this._byType[d];h||(h=this._byType[d]=[]);var i=c+"|"+e;return h.contains(i)||h.push(i),g},removeViewDefinition:function(a){var b=a.forType,c=a.name,d=a.format||"",e=b+"|"+c+"|"+d;delete this._map[e],delete this._mapRaw[e],this._byType[b]&&(this._byType[b].erase(c+"|"+d),0===this._byType[b].length&&delete this._byType[b])},getViewDefinition:function(a,b,c){var d=this.getViewDefinitionWithFormat(a,b,c);return!d&&c&&(d=this.getViewDefinitionWithFormat(a,b,"")),d||this._logger.reportEvent(this.imports.WixAppsLogger.Events.VIEW_DEFINITION_NOT_FOUND,{g1:a,c1:b,c2:c}),d},getViewDefinitionWithFormat:function(a,b,c){c=c||"";var d=a+"|"+b+"|"+(c||""),e=this._map[d];return!e&&this._mapRaw[d]&&(this._preProcessingViewDefFunction&&this._preProcessingViewDefFunction(this._mapRaw[d]),e=this._dataItemFactory.createDataItem(this._mapRaw[d]),this._map[d]=e,e.addEvent(Constants.DataItemEvents.CHANGE,function(a){this.fireEvent(Constants.DataItemEvents.CHANGE,a),this._clonedTargets.forEach(function(b){b._onClonedViewChanged(a)})}.bind(this))),e},getViewDefinitionsByType:function(a){var b=this._byType[a]||[];return b.map(function(b){var c=b.split("|");return this.getViewDefinition(a,c[0],c[1])}.bind(this))},hasViewDefinition:function(a,b,c){return c=c||"",this._mapRaw[a+"|"+b+"|"+c]||c&&this._mapRaw[a+"|"+b+"|"]},cloneAndListen:function(a){for(var b=a.getAllViewDefinitions(),c=0;c<b.length;c++)this.setViewDefinition(b[c].getValue(),!0),b[c].addEvent(Constants.DataItemEvents.CHANGE,this._onClonedViewChanged);this._mapRaw=a._mapRaw,a._clonedTargets.push(this)},_onClonedViewChanged:function(a){this.setViewDefinition(a.currentTarget.getValue(),!0)},getAllViewDefinitions:function(){var a=Object.values(this._map);return a.sort(function(a,b){var c=function(a,b){return a>b?1:a==b?0:-1},d=c(a.getChildByRef("forType").getValue(),b.getChildByRef("forType").getValue());return 0!==d?d:c(a.getChildByRef("name").getValue(),b.getChildByRef("name").getValue())}),a},toArray:function(){var a=[];return Object.keys(this._mapRaw).forEach(function(b){this._map[b]?a.push(this._map[b].getValue()):a.push(Object.clone(this._mapRaw[b]))}.bind(this)),a.sort(function(a,b){var c=function(a,b){return a>b?1:a==b?0:-1},d=c(a.forType,b.forType);return 0!==d?d:c(a.name,b.name)}),a},getAllViewNamesByType:function(){return this._byType},duplicateListViewDefinition:function(a,b,c,d,e){e||(e=d);var f=this.getViewDefinition("Array",b);f&&(f=f.getValue(),f.forType="Array",f.name=c,f.id=W.Utils.getUniqueId("view"),this.imports.ViewsCustomizer.applyRule(f,{fieldId:"listItem",key:"comp.name",value:c}),a.addViewDefinition(f));var g=this.toArray(),h=_.filter(g,function(a){return a.name===b&&a.forType===d});_.forEach(h,function(b){var d=_.clone(b,!0);d.forType=e,d.name=c,a.addViewDefinition(d)})}})}),define.Class("wixapps.core.views.ViewEnvironment",function(a){var b=a;b.utilize(["wixapps.core.events.TreePath"]),b.fields({_dataItemFactory:null,_typesManager:null,_proxyFactory:null,_viewName:null,_forType:null,_formatName:null,_viewFormatName:null,_eventsDispatcher:null,_includedViews:null,_treePath:null,_vars:null}),b.methods({initialize:function(a,b,c,d,e,f,g,h,i,j,k){this._dataItemFactory=a,this._typesManager=b,this._proxyFactory=c,this._viewName=d,this._forType=e,this._formatName=f,this._viewFormatName="",this._eventsDispatcher=g,h instanceof Array&&(h=this._dataItemFactory.createDataItem(h)),this._includedViews=h,this._vars={parent:i,vars:{}},this._treePath=new this.imports.TreePath(j),this._lifecycleManager=k},newCopy:function(){var a=new this.constructor(this._dataItemFactory,this._typesManager,this._proxyFactory,this._viewName,this._forType,this._formatName,this._eventsDispatcher,this._includedViews,this._vars,this._treePath,this._lifecycleManager);return a.setViewFormatName(this._viewFormatName),a},setViewName:function(a){this._viewName=a},setForType:function(a){this._forType=a},setViewFormatName:function(a){this._viewFormatName=a},getDataItemFactory:function(){return this._dataItemFactory},getTypesManager:function(){return this._typesManager},getProxyFactory:function(){return this._proxyFactory},getViewName:function(){return this._viewName},getForType:function(){return this._forType},getFormatName:function(){return this._formatName},getViewFormatName:function(){return this._viewFormatName},getEventsDispatcher:function(){return this._eventsDispatcher},getIncludedViews:function(){return this._includedViews.getValue()},getTreePath:function(){return this._treePath},getLifecycleManager:function(){return this._lifecycleManager},addIncludedView:function(a,b,c){var d=a+"|"+b+"|"+(c||"");-1==this._includedViews.getValue().indexOf(d)&&this._includedViews.addChild(d)},addEventIncludedViewsChanged:function(a){this._includedViews.addEvent(Constants.DataItemEvents.CHANGE,a)},removeEventIncludedViewsChanged:function(a){this._includedViews.removeEvent(Constants.DataItemEvents.CHANGE,a)},getVars:function(){var a=function(b){if(!b)return{};var c=a(b.parent);return Object.each(b.vars,function(a,b){c[b]=a.getValue()}),c};return a(this._vars)},getVar:function(a){for(var b=this._vars;b;b=b.parent){var c=b.vars[a];if(c)return c}return void 0},setVar:function(a,b){var c=this._vars.vars[a];return c?c.setValue(b):(c=this._dataItemFactory.createDataItem(b),this._vars.vars[a]=c),c}})}),define.Class("wixapps.core.views.ViewEvaluationContext",function(a){var b=a;b.fields({_viewContext:null}),b.methods({initialize:function(a){this._viewContext=a},getSymbolResolver:function(){return this},resolveExpressionReference:function(a){return this._viewContext.evaluatePath(a)},evaluateExpressionReference:function(a){var b=this.resolveExpressionReference(a);return b?b.getValue(void 0,this):void 0},listSymbols:function(){var a={},b=(this._data,{});return Object.merge(a,b)},inheritsScope:function(a){return!("wixapps.core.data.CompositeDataItem"==a.className&&a.getParent()&&a.getParent().getChildRef&&"templates"==a.getParent().getChildRef(a)&&a.getParent().getChildValue&&"Toggle"!=a.getParent().getChildValue("name"))}})}),define.Class("wixapps.core.views.ViewsCustomizer",function(a){var b=a;b.binds(["addRule"]),b.fields({_byIndex:[],_byTypeAndView:{}}),b.methods({addRules:function(a){a.forEach(this.addRule)},addRule:function(a){var b=this.getByTypeAndView(a.forType,a.view);b.push(this._byIndex.length),this._byIndex.push(a)},clearRules:function(){this._byIndex=[],this._byTypeAndView={}},getByTypeAndView:function(a,b){var c=a+"|"+b,d=this._byTypeAndView[c];return void 0===d&&(d=[],this._byTypeAndView[c]=d),d},applyToViewDefinitionsRepository:function(a){a.getAllViewDefinitions().forEach(function(a){var b=a.getValue(0);this.applyAll(b),a.setValue(b)}.bind(this))},applyAll:function(a){var b=[];b=b.concat(this.getByTypeAndView(a.forType,a.name)),b=b.concat(this.getByTypeAndView("*",a.name)),b=b.concat(this.getByTypeAndView(a.forType,"*")),b=b.concat(this.getByTypeAndView("*","*")),b.sort(function(a,b){return a-b}),b.forEach(function(b){this.applyRule(a,this._byIndex[b])}.bind(this))}}),b.statics({applyRule:function(a,b){var c=a.format||"",d=b.format||"";if("*"===d||d===c){var e=this._findApplicableFields(a,b);e.forEach(function(a){if("object"==typeof a)for(var c=a,d=b.key.split("."),e=0;e<d.length;e++){var f=d[e];if(e==d.length-1){var g=b.value;/^\s*(\+|-)?\d+\s*$/.test(b.value)&&(g=parseInt(g,10)),void 0===g?delete c[f]:c[f]=g}else c[f]||(c[f]={}),c=c[f]}})}},fillMissingIds:function(a){return this._fillMissingIdsForItem(a,0),a},getCurrentRule:function(a,b){var c=Object.clone(b);return c.value=this.getCurrentValue(a,b),c},getCurrentValue:function(a,b){for(var c=this._findApplicableFields(a,b),d=0;d<c.length;d++)for(var e=c[d],f=b.key.split("."),g=0;g<f.length;g++){var h=f[g];if(g==f.length-1){if(void 0!==e[h])return e[h];break}if(!e[h])break;e=e[h]}return void 0},_findApplicableFields:function(a,b){var c=[];return"vars"==b.fieldId?c.push(a.vars):this._findApplicableFieldsOnItem(a,b,0,c),c},_findApplicableFieldsOnItem:function(a,b,c,d){var e=a.id||a.data||c,f=this;("*"==b.fieldId||b.fieldId==e)&&d.push(a),a.comp&&a.comp.items&&a.comp.items.forEach(function(a,c){f._findApplicableFieldsOnItem(a,b,c,d)}),a.comp&&a.comp.templates&&Object.each(a.comp.templates,function(a){f._findApplicableFieldsOnItem(a,b,0,d)}),a.comp&&a.comp.cases&&Object.each(a.comp.cases,function(a){"array"===typeOf(a)?a.forEach(function(a){f._findApplicableFieldsOnItem(a,b,0,d)}):f._findApplicableFieldsOnItem(a,b,0,d)}),a.comp&&a.comp.columns&&"Table"==a.comp.name&&a.comp.columns.forEach(function(a){Array.forEach(["item","header","footer"],function(c){void 0!==a[c]&&f._findApplicableFieldsOnItem(a[c],b,0,d)})})},_fillMissingIdsForItem:function(a,b){a.id=a.id||a.data||"def_"+b;var c=b+1,d=this;return a.comp&&a.comp.items&&a.comp.items.forEach&&a.comp.items.forEach(function(a){c=d._fillMissingIdsForItem(a,c)}),a.comp&&a.comp.templates&&Object.each(a.comp.templates,function(a){c=d._fillMissingIdsForItem(a,c)}),a.comp&&a.comp.cases&&Object.each(a.comp.cases,function(a){"array"===typeOf(a)?a.forEach(function(a){c=d._fillMissingIdsForItem(a,c)}):c=d._fillMissingIdsForItem(a,c)}),a.comp&&a.comp.columns&&"Table"==a.comp.name&&a.comp.columns.forEach(function(a){Array.forEach(["item","header","footer"],function(b){void 0!==a[b]&&(c=d._fillMissingIdsForItem(a[b],c))})}),c}})}),define.Class("wixapps.core.views.proxies.ArrayProxy",function(a){var b=a;b.inherits("wixapps.core.views.proxies.Proxy"),b.utilize(["wixapps.core.views.ViewContext"]),b.fields({_children:[],_components:[]}),b.methods({initialize:function(a,b,c,d){this.parent(a,b,c,d),this._loadTemplates()},_createChildren:function(){for(var a=this._data.getChildren(),b=0;b<a.length;b++){var c=a[b];this._addChild(c,b,a.length)}},_getItemTemplate:function(a){return this._def.getChildByRef("templates")&&this._def.getChildByRef("templates").getChildByRef(a)},_addTemplateVars:function(a){var b=this._def.getChildByRef("templates")&&this._def.getChildByRef("templates").getChildValue("vars");if(b){var c=a.getEnvironment();_.forEach(b,function(a,b){c.setVar(b,a)})}},_addPositionInParentVars:function(a,b,c){var d=a.getEnvironment();d.setVar("indexInParent",b),d.setVar("indexOneInParent",b+1),d.setVar("positionInParent",0===b&&c>1?"first":b==c-1?"last":"middle"),d.setVar("isOddIndexInParent",b%2==1)},_loadTemplates:function(){var a=this._viewContext.getEnvironment();this._itemTemplate=this._getItemTemplate("item")||a.getDataItemFactory().createDataItem({id:this.getFieldId()+"_template_item",comp:{}},this._def)},_processDefinitionsChangeList:function(a){this.parent(a);var b=a.filter(function(a){return"templates"==_.first(a.path)});b.length&&this._loadTemplates()},_addChild:function(a,b,c){var d=this._viewContext.getEnvironment().getProxyFactory(),e=this._viewContext.newContextForData(a);this._addTemplateVars(e,b,c),this._addPositionInParentVars(e,b,c);var f=d.createProxyFromItemDefinition(e,this._itemTemplate).proxy;this._children.push(f)},_createChildComponents:function(a){this._children.forEach(function(b){var c=b.createComponent();this._components.push(c),this._onChildCreated(b,c),a.grab(c)}.bind(this))},_onChildCreated:function(){},_onBeforeChildDisposed:function(){}})}),define.Class("wixapps.core.views.proxies.CompositeProxy",function(a){var b=a;b.inherits("wixapps.core.views.proxies.Proxy"),b.utilize(["wixapps.core.views.ViewContext"]),b.fields({_ids:[],_children:[],_components:[],_itemsDefAsRaw:null}),b.methods({initialize:function(a,b,c,d){this.parent(a,b,c,d)},_isReloadRequired:function(){if(null===this._itemsDefAsRaw)return!1;var a=this._itemsDefAsRaw,b=this._def.getChildValue("items")||[];if(b.length!=a.length)return!0;for(var c=0;c<a.length;c++){var d=a[c],e=b[c],f=d.comp&&d.comp.name||"unspecified",g=e.comp&&e.comp.name||"unspecified";if(f!=g||d.data!=e.data||d.id!=e.id)return!0}return!1},_createChildProxies:function(){for(;this._children.length>0;){var a=this._children.pop();a.isDisposed()||a.dispose()}this._ids=[],this._components=[];var b=this._def.getChildByRef("items");if(this._itemsDefAsRaw=b?b.getValue():[],b){var c=this._viewContext.getEnvironment().getProxyFactory();b.getChildren().forEach(function(a){var b=c.createProxyFromItemDefinition(this._viewContext,a);this._ids.push(b.id),this._children.push(b.proxy)}.bind(this))}},_createChildComponents:function(a){a.set("html",""),this._components=[],this._children.forEach(function(b){var c=b.createComponent();this._components.push(c),a.grab(c)}.bind(this))},_reloadProxy:function(){},_processDefinitionsChangeList:function(a){if(this.parent(a),!this.isDisposed()){if(a.length&&this._isReloadRequired())return this._reloadProxy(),void 0;var b=a.filter(function(a){return 4==a.path.length&&"layout"==a.path[a.path.length-2]});b.length&&this._onChildLayoutPropertyChange(b)}},_onChildLayoutPropertyChange:function(){}})}),define.Class("wixapps.core.views.proxies.Proxy",function(a){var b=a;b.binds(["_onDataChangedInternal","_onDefinitionsChangedInternal","_onProxyValidation","_isPropertyChange"]),b.utilize(["wixapps.core.data.DataItemUtils","wixapps.core.views.ViewEvaluationContext"]),b.fields({_viewContext:null,_data:null,_def:null,_disposed:!1,_fieldId:null,_isBound:!0}),b.methods({initialize:function(a,b,c,d){this._viewContext=a,this._data=b,this._def=c,this._fieldId=d,this._dataItemUtils=new this.imports.DataItemUtils,this._validateDataType(),this._setVarsFromDef();var e=c.getChildValue("events");e&&Object.each(e,function(a,b){if("string"==typeof a){var c=a.split(";");_.each(c,function(a){this._registerProxyEvents(b,this._createTranslator(a))}.bind(this))}else this._registerProxyEvents(b,this._createTranslator(a))}.bind(this)),this._data.addEvent(Constants.DataItemEvents.CHANGE,this._onDataChangedInternal),this._def.addEvent(Constants.DataItemEvents.CHANGE,this._onDefinitionsChangedInternal);var f=this._def.getChildValue("validationVar");f&&this._data.addEvent(Constants.DataItemEvents.VALIDATION_PERFORMED,this._onProxyValidation)},_onProxyValidation:function(a){var b=this._def.getChildValue("validationVar");if(b&&a){var c=this._viewContext.getEnvironment().getVar(b);c&&c.setValue(a.valid)}},_createTranslator:function(a){var b,c={};return"object"==typeOf(a)?(b=a.event,Object.each(a,function(a,b){"event"!==b&&(c[b]=a)})):b=String(a),function(a){var d=b.trim().match(/^set:([^=]+)=(.+)$/);if(d){var e=this._viewContext,f=e.evaluatePath(d[1].trim());if(!f)throw"Cannot resolve symbol "+d[1].trim();var g={$expr:d[2].trim()},h=e.getEnvironment().getDataItemFactory().createDataItem(g),i=new this.imports.ViewEvaluationContext(e),j=h.getValue(1,i);f.setValue(j)}else c.cause=a,this.fireEvent(b,c)}.bind(this)},setIsBound:function(a){this._isBound=a},getIsBound:function(){return this._isBound},isDisposed:function(){return this._disposed},dispose:function(){this._disposed||(this._disposed=!0,this._data.removeEvent(Constants.DataItemEvents.CHANGE,this._onDataChangedInternal),this._data.removeEvent(Constants.DataItemEvents.VALIDATION_PERFORMED,this._onProxyValidation),this._data=null,this._def.removeEvent(Constants.DataItemEvents.CHANGE,this._onDefinitionsChangedInternal),this._viewContext=null,this._def=null)},addEvent:function(a,b){this._viewContext.getEnvironment().getEventsDispatcher().addEvent(a,b)},addEventFilteredByScope:function(a,b,c){this._viewContext.getEnvironment().getEventsDispatcher().addEventFilteredByScope(this._viewContext,a,b,c)},removeEvent:function(a,b){this._viewContext.getEnvironment().getEventsDispatcher().removeEvent(a,b)},fireEvent:function(a,b,c){this._viewContext.getEnvironment().getEventsDispatcher().fireProxyEvent(this,a,b,c)},setupProxy:function(){},createComponent:function(){},_registerProxyEvents:function(){},_onDefinitionsChangedInternal:function(a){var b=this._dataItemUtils.createDataChangeEventList(a);b.length&&this._processDefinitionsChangeList(b)},_processDefinitionsChangeList:function(a){if(!this._shouldDefinitionChangesBeIgnored(a)){this._setVarsFromDef();var b=_.filter(a,this._isPropertyChange);b.length&&this._onDefPropertyChanged(b)}},_isPropertyChange:function(a){return 1==a.path.length},_shouldDefinitionChangesBeIgnored:function(a){return a.some(function(a){return 1===a.path.length&&"name"===a.path[0]})},_onDefPropertyChanged:function(){},_setVarsFromDef:function(){var a=this._def.getChildValue("vars");if(a){var b=this._viewContext.getEnvironment();Object.each(a,function(a,c){b.setVar(c,a)})}},_onDataChanged:function(){},_onDataChangedInternal:function(a){this._disposed||(this._validateDataType(),this._onDataChanged(a))},_validateDataType:function(){var a=this._getAcceptableDataTypes();if(a&&a.length>0){for(var b=this._viewContext.getEnvironment().getTypesManager(),c=this._data.getTypeName(),d=0;d<a.length;d++)if(b.isOf(c,a[d]))return;throw"Proxy "+this.$className+" accepts only ["+a+"] but received ["+c+"]"}},_getAcceptableDataTypes:function(){return[]},getViewContext:function(){return this._viewContext},getData:function(){return this._data},getViewDefinition:function(){return this._def},getFieldId:function(){return this._fieldId},getFullFieldId:function(){return this._viewContext._env.getForType()+"|"+this._viewContext._env.getViewName()+"|"+this._fieldId},setWidth:function(){},getWidth:function(){return 0},getHeight:function(){return 0},setPos:function(){}})}),define.Const("WixApps",{TEXT_STYLES:{Title:"font_0",Menu:"font_1","Page title":"font_2","Heading XL":"font_3","Heading L":"font_4","Heading M":"font_5","Heading S":"font_6","Body L":"font_7","Body M":"font_8","Body S":"font_9","Body XS":"font_10"},TEXT_STYLE_NAMES:{font_0:"Title",font_1:"Menu",font_2:"Page title",font_3:"Heading XL",font_4:"Heading L",font_5:"Heading M",font_6:"Heading S",font_7:"Body L",font_8:"Body M",font_9:"Body S",font_10:"Body XS"},EDIT_TEMPLATE_NAME:"EditPanel",FORM_INPUT_TEMPLATE_NAME:"FormInput"}),define.Const("WixAppEvents",{FULL_DATA_EDITOR_SAVED:"wix:fullDataEditorSaved",APP_PART_RESIZE:"wix:appPartResize",APP_VIEW_READY:"wix:appViewready",APP_VIEW_CREATED:"wix:appViewCreated",APP_ZOOM_READY:"wix:appZoomready",APP_CONTENT_RESIZE:"wix:appContentResize",PROXY_IRRECOVERABLE:"wix:proxyIrrecoverable",TYPE_CHANGE:"wix:typeChange",FIELD_ADDED:"wix:fieldAdded",FIELD_REMOVED:"wix:fieldRemoved",ITEM_CHANGED:"wix:itemChanged",SELECTED_INDEX_CHANGED:"wix:selectedItemChanged",INVALIDATE_PART_DATA:"wix:invalidatePartData",DATA_SELECTOR_CHANGED:"wix:dataSelectorChanged",DATA_SELECTOR_PREDEFINED_SETTINGS_CHANGED:"wix:dataSelectorPredefinedSettingsChanged",PROXY_SIZE_INVALID:"wix:proxySizeInvalid"}),define.component("wixapps.integration.components.AppPage",function(a){var b=a;b.inherits("core.components.Page"),b.utilize(["wixapps.core.utils.WixAppsLogger","wixapps.integration.managers.AppPageEnvironment","wixapps.integration.managers.AppBuilderPageEnvironment"]),b.binds(["_onLogicClassLoaded","_onDataItemLoaded","_onDataItemLoadError","_handleHashExtraDataChanged"]),b.dataTypes(["AppPage"]),b.resources(["W.Utils","W.Classes","W.Viewer","W.Config"]),b.fields({_appPageId:null,_appInstance:null,_pagePrimaryLogic:null,_pageDefinition:null,_dataItemLoaded:null,_dataItem:null,_pageEnvironment:null,_itemLoadedCallbacks:[],_envMap:null,prevHashEvt:null}),b.methods({initialize:function(a,b,c){this.parent(a,b,c),this._logger=new this.imports.WixAppsLogger,this._initEnvMap(),this.resources.W.Viewer.addEvent("hashExtraDataChanged",this._handleHashExtraDataChanged)},_onAllSkinPartsReady:function(){this._appPageId=this._data.get("appPageId");var a=this._data.get("appInnerID"),b=this._data.get("appPageType"),c=this._envMap[b];return c?(this._pageEnvironment=c(),this._getAppInstance(a,function(a){return this._appInstance=a,this._appInstance?(this._appInstance.registerAppPage(this),void 0):(this._itsDeadJim(),void 0)}.bind(this)),void 0):(this._logger.reportError(this._logger.Errors.PAGE_ENVIRONMENT_OF_UNKNOWN_TYPE,this.$className,"_onAllSkinPartsReady",this._logger.SubCategory.CORE_WIRING),this._itsDeadJim(),void 0)},_itsDeadJim:function(){this._isZedDead=!0},initApp:function(){if(this._pageDefinition=this._appInstance.getPageDefinition(this._appPageId),!this._pageDefinition)return this._itsDeadJim(),void 0;var a=this._getLogicClassName(this._pageDefinition);this.resources.W.Classes.get(a,this._onLogicClassLoaded)},_initEnvMap:function(){var a=this;this._envMap={AppPage:function(){return new a.imports.AppPageEnvironment},AppBuilderPage:function(){return new a.imports.AppBuilderPageEnvironment}}},getPageEnvironment:function(a){var b=a.get("appPageType"),c=this._envMap[b];if(c)return c();throw"AppPage:: environment for page type ["+b+"] was not found in the envMap."},getPrimaryLogic:function(){return this._pagePrimaryLogic},_handleHashExtraDataChanged:function(a){if(!this._isZedDead&&a.pageId===this._data.get("id")){var b=!this.prevHashEvt||this.prevHashEvt.extData!==a.extData||this.prevHashEvt.pageId!==a.pageId;b&&(this.prevHashEvt=a,this.updateParamsFromExtraData(a.extData))}},_getLogicClassName:function(a){return this._pageEnvironment.getLogicClassName(a)},_getAppInstance:function(a,b){return this._pageEnvironment.getAppInstance(a,b)},getPageDefinition:function(){return this._pageDefinition},getAppPageId:function(){return this._appPageId},getLogger:function(){return this._logger},getStyleNameSpace:function(){return this._styleNameSpace||"core.components.Page"},getEnvironment:function(){return this._environment||(this._environment=this._pageEnvironment.getEnvironment(this,this._pageDefinition)),this._environment},_onLogicClassLoaded:function(a){try{this._pagePrimaryLogic=new a(this.getEnvironment()),this._primaryLogicLoaded=!0,this.fireEvent("pageLogicLoaded"),this._fetchDataItem()}catch(b){this._itsDeadJim()}},_fetchDataItem:function(a){return this._primaryLogicLoaded?(a||(a=this._parseHashParams()),a&&!_.isEmpty(a)&&this._pagePrimaryLogic.fetchDataItem(a,this._onDataItemLoaded,this._onDataItemLoadError),void 0):(this.resources.W.Utils.callLater(this._fetchDataItem,[a],this),void 0)},_parseHashParams:function(a,b){var c=this.getBaseParams();if(!b&&void 0===a){var d=this.resources.W.Utils.hash.getHashParts();a=d.extData}if(this._primaryLogicLoaded){var e=this.getPrimaryLogic().paramsFromUri(a||"");c=Object.merge(c,e)}return c},updateParams:function(a){this._fetchDataItem(a)},updateParamsFromExtraData:function(a){this.updateParams(this._parseHashParams(a,!0))},getBaseParams:function(){var a={},b=this.getEnvironment();if(b.options){var c=b.options;Object.each(c,function(b,c){void 0===a[c]&&(a[c]=b)})}return a},registerForDataItemLoaded:function(a){this._itemLoadedCallbacks.push(a),this._dataItemLoaded&&a(this._dataItem)},unregisterForDataItemLoaded:function(a){var b=this._itemLoadedCallbacks.indexOf(a);-1!=b&&this._itemLoadedCallbacks.splice(b)},getDisplayedDataItem:function(a){this.registerForDataItemLoaded(a)},_onDataItemLoaded:function(a){this._dataItem=a,this._dataItemLoaded=!0,this._itemLoadedCallbacks.each(function(b){b(a)})},_onDataItemLoadError:function(){var a=this.resources.W.Viewer,b=a.getCurrentPageId()===this._data.get("id");if(this.resources.W.Config.env.$isPublicViewerFrame&&b){this._logger.reportError(this._logger.Errors.UNABLE_TO_LOAD_DATA_ITEM_FROM_PARAMS,this.$className,"_onDataItemLoadError",this._logger.SubCategory.CORE_WIRING);var c=W.Data.getDataMap().SITE_STRUCTURE.get("mainPage");a.goToPage(c.replace("#",""))}else this._pagePrimaryLogic.fetchSampleDataItem(this._onDataItemLoaded,function(){throw this._itsDeadJim(),"All has failed..."}.bind(this))},getCustomPageTitle:function(a){this._pagePrimaryLogic&&this._pagePrimaryLogic.getCustomPageTitle?this._pagePrimaryLogic.getCustomPageTitle(this._parseHashParams(),function(b){a(b)}):a(null)},dispose:function(){this.resources.W.Viewer.removeEvent("hashExtraDataChanged",this._handleHashExtraDataChanged),this.parent()}})}),define.experiment.component("wixapps.integration.components.AppPart.AppsWPhotoNBC",function(a,b){var c=a;c.binds(b.merge(["_fireAppPartResize"])),c.methods({_updateHeight:function(){if(this._allowHeightResize===!1){var a=this._getMinPhysicalHeight(),b=this.getHeight()!=a;this.setHeight(a,!1,!1),(b||this._mainProxy.getFlexPolyFillInstance().isComputedFlex())&&this._lifecycleManager.performAction(this._fireAppPartResize,this._lifecycleManager.ExecutionOrder.Late),this.fireEvent("autoSizeChange"),this.fireEvent("autoSized")}},_fireAppPartResize:function(){this._eventDispatcher.fireEvent(Constants.WixAppEvents.APP_PART_RESIZE)}})}),define.component("wixapps.integration.components.AppPart",function(a){var b=a;b.inherits("mobile.core.components.base.BaseComponent"),b.utilize(["wixapps.core.utils.WixAppsLogger","wixapps.core.views.ViewsCustomizer","wixapps.core.views.ViewDefinitionsOverrideRepository","wixapps.core.dataservice.ItemCache","wixapps.core.dataservice.DataService","wixapps.core.events.ProxyEventBus","wixapps.core.views.ProxyFactory","wixapps.integration.proxies.ProxyMap","wixapps.integration.managers.AppResizeHandler","wixapps.integration.managers.LifecycleManager","wixapps.integration.managers.StylesheetManager"]),b.traits(["wixapps.integration.components.traits.SizeRefreshHandler"]),b.resources(["W.Viewer","W.Config","W.Commands"]),b.binds(["_onLogicLoaded","_onContentResize","_onAppPartRenderComplete","showView"]),b.skinParts({inlineContent:{type:"htmlElement"}}),b.states(["loading","error","rendering","content"]),b.dataTypes(["AppPart"]),b.propertiesSchemaType("AppPartProperties"),b.fields({_eventDispatcher:null,_resizeHandler:null,EDITOR_META_DATA:{general:{help:!1,settings:!0,design:!1},custom:[{label:"EDIT_DATA_BUTTON",command:"WAppsEditorCommands.OpenEditDataDialog",commandParameter:{}}],mobile:{custom:[{label:"FPP_SETTINGS_LABEL",command:"EditorUI.OpenPropertyPanel"}],disablePropertySplit:!0}}}),b.methods({initialize:function(a,b,c){this.parent(a,b,c),this._logger=new this.imports.WixAppsLogger,this._appInstance=null,this._eventDispatcher=new this.imports.ProxyEventBus,this.setState("loading"),this._resizeHandler=new this.imports.AppResizeHandler,this._lifecycleManager=new this.imports.LifecycleManager(this._eventDispatcher,!0),this._formatName="",this._eventDispatcher.addEvent(Constants.WixAppEvents.APP_CONTENT_RESIZE,this._onContentResize),this.injects().Commands.registerCommand("WViewerCommands.AppDataChange",!0),this.setMaxH(8e3)
},render:function(){try{this.getAppInstance()}catch(a){this.setState("error");var b=this._logger;b.reportError(b.Errors.APP_INSTANCE_NOT_LOADED,this.$className,"render",b.SubCategory.CORE_WIRING)}},initApp:function(){if(!this._isDisposed){if(this._appInstance.addEvent(Constants.WixAppEvents.INVALIDATE_PART_DATA,this._onContentResize),this._customizations=new this.imports.ViewsCustomizer(this._appInstance.getDataItemFactory()),this._viewDefinitions=new this.imports.ViewDefinitionsOverrideRepository(this._appInstance.getViewDefRepo(),this._customizations,this._appInstance.getDataItemFactory()),this._isMobile()&&(this._formatName="Mobile"),this._applyCustomizationRulesToDefinitions(),this._initializeProxyFactory(),this._partDef=this._appInstance.getPartDefinition(this._data.get("appPartName")),!this._partDef)throw new Error("AppPart.initApp partName ["+this._data.get("appPartName")+"] not found in app descriptor");this._allowHeightResize=this._configByFormat("allowHeightResize",!1),this._allowHeightResize||(this._resizableSides=[Constants.BaseComponent.ResizeSides.LEFT,Constants.BaseComponent.ResizeSides.RIGHT]);var a=this._configByFormat("minWidth",0);a>0&&this.setMinW(a),this._loadPartLogic(),this._view.set("partid",this._appInstance.getPackageName()+"_"+this._partDef.id)}},_configByFormat:function(a,b){var c=b;return this._partDef.configByFormat&&this._formatName in this._partDef.configByFormat&&a in this._partDef.configByFormat[this._formatName]?c=this._partDef.configByFormat[this._formatName][a]:a in this._partDef&&(c=this._partDef[a]),c},_initializeProxyFactory:function(){this._stylesheetManager=new this.imports.StylesheetManager("#"+this.getViewNode().get("id")),this._proxyFactory=new this.imports.ProxyFactory(this._appInstance.getDataItemFactory(),this._appInstance.getTypesManager(),this._viewDefinitions,this._eventDispatcher,this._appInstance.resolveResourcePath,this._appInstance.getPackageName(),this._lifecycleManager,this,this._stylesheetManager,this._appInstance.getAppVars()),(new this.imports.ProxyMap).registerComponentProxies(this._proxyFactory)},getCustomizationDefaultValue:function(a,b,c,d,e){var f={forType:a,viewName:b,format:c,fieldId:d,key:e},g=this._appInstance.getViewDefRepo(),h=g.getViewDefinition(a,b,c);if(!h)throw"View "+a+"|"+b+"|"+c+" not found in repository";return h=h.getValue(0),this._customizations.getCurrentValue(h,f)},isDeleteable:function(){return this._partDef&&this._partDef.hasOwnProperty("allowPartDelete")?this._partDef.allowPartDelete:this.parent()},isDuplicatable:function(){return this._partDef&&this._partDef.hasOwnProperty("allowPartDuplicate")?this._partDef.allowPartDuplicate:this.parent()},getShowOnAllPagesChangeability:function(){return this._partDef&&this._partDef.hasOwnProperty("allowShowOnAllPages")?this._partDef.allowShowOnAllPages:this.parent()},getFormatName:function(){return this._formatName},setFormatName:function(a){a!=this._formatName&&(this._formatName=a,this.reRenderView())},_applyCustomizationRulesToDefinitions:function(){this._customizations.clearRules();var a=this._data.get("appLogicCustomizations");a.forEach(function(a){"value"!=a.key||a.format||(a.format="*")}),this._customizations.addRules(a);var b=this._appInstance.getViewDefRepo();this._viewDefinitions.getAllViewDefinitions().forEach(function(a){var c=b.getViewDefinition(a.getChildValue("forType"),a.getChildValue("name"),a.getChildValue("format")||"").getValue(0);this._customizations.applyAll(c),a.setValue(c)}.bind(this)),this.fireEvent("customizationApplied")},getPartDef:function(){return this._partDef},getHelpId:function(){var a=this._configByFormat("helpId","");return a?a:this._appInstance.getAppDescriptor().helpId},getAppPartViewDefRepo:function(){return this._viewDefinitions},getViewDef:function(){return this._mainProxy?this._mainProxy.getViewDefinition():void 0},getViewsCustomizer:function(){return this._customizations},getMainProxy:function(){return this._mainProxy},getAppInstance:function(){return this._appInstance||(this._appInstance=W.Apps.getApp(this._data.get("appInnerID")),this._appInstance.registerAppPart(this)),this._appInstance},getLogger:function(){return this._logger},getLogicParams:function(){var a={};this._partDef.logic.display.options&&Object.each(this._partDef.logic.display.options,function(b,c){a[c]=b});var b=!1,c=this._data.get("appLogicParams");return Object.each(c,function(c,d){"wixapps:first-load-after-add-to-stage"===d?(b=!0,a["wixapps:first-load-after-add-to-stage"]=!0):a[d]=c.value}),b&&delete c["wixapps:first-load-after-add-to-stage"],a},getEnvironment:function(){if(!this._environment){var a=this;this._environment={_context:[{dataService:null,itemCache:a._appInstance.getItemCache(),dataItemFactory:a._appInstance.getDataItemFactory()}],getProxyFactory:function(){return a._proxyFactory},getDataItemFactory:function(){return this._getContext().dataItemFactory},getTypesManager:function(){return a._appInstance.getTypesManager()},getDataService:function(){return this._getContext().dataService||a._appInstance.getDataService()},getItemCache:function(){return this._getContext().itemCache},getAppPart:function(){return a},getAppInstance:function(){return a._appInstance},getViewDefRepo:function(){return a._appInstance.getViewDefRepo()},getLogger:function(){return a.getLogger()},isMobile:function(){return a._isMobile()},_getContext:function(){return this._context[this._context.length-1]},newDataServiceContext:function(){var b=this.getDataService(),c=b.getDataItemFactory().clone(),d=new a.imports.ItemCache(c),e=new a.imports.DataService(a._appInstance.getDataServiceTransport(),c,d);this._context.push({dataService:e,itemCache:d,dataItemFactory:c})},popDataServiceContext:function(){if(this._context.length<2)throw"no data service context to pop";return this._context.pop().dataService}}}return this._environment},_loadPartLogic:function(){this.resources.W.Commands.executeCommand("ApplicationPerformanceSpy.logPhase",{step:"loadLogic",appPart:this}),W.Classes.get(this._partDef.logic.display.type,this._onLogicLoaded)},_onLogicLoaded:function(a){this.resources.W.Commands.executeCommand("ApplicationPerformanceSpy.logPhase",{step:"logicLoaded",appPart:this});var b=this.getEnvironment();this._disposeLogic(),this._logic=new a(b),this.fireEvent("logicLoaded"),this.getViewNode().fireEvent("logicLoaded"),this._runLogic(),this.fireEvent("logicReady")},_isMobile:function(){return this.resources.W.Config.env.$viewingDevice===Constants.ViewerTypesParams.TYPES.MOBILE},getFriendlyName:function(){var a=this.getAppPartLogic(),b=a&&a.getDataEditingMetaInfo?a.getDataEditingMetaInfo():{},c=this.getPartDef()||{};return b.title||c.name||""},isDomDisplayReadyOnReady:function(){return!1},showView:function(a,b,c,d){if(!this._isDisposed){var e=this;this._currenetViewArguments=arguments,this._appEventHandlers&&_.forEach(this._appEventHandlers,function(a,b){this._eventDispatcher.removeEvent(b,a)},this),this._appEventHandlers=null,this.setState("rendering"),this._mainProxy&&(this._mainProxy.dispose(),this._stylesheetManager&&this._stylesheetManager.reset()),d=d||{},d.partDirection=this.getComponentProperty("direction"),this._partDef.forceFlexCompute&&(d.forceFlexCompute=this._partDef.forceFlexCompute),this._appEventHandlers=c,this._mainProxy=this._proxyFactory.createView(a,b,this._formatName,d),_.forEach(c,function(a,b){this._mainProxy.addEvent(b,a)},this),this._lifecycleManager.reset(),this._mainComponent=this._mainProxy.createComponent(),this._skinParts.inlineContent.set("html",""),this._skinParts.inlineContent.adopt(this._mainComponent),this._allowHeightResize&&this._mainProxy.getElement().setStyle("height",this.getHeight()),this._mainProxy.setupProxy(),window.requestAnimFrame(function(){e._lifecycleManager.performAction(e._onAppPartRenderComplete)}),this._setupMainProxyListeners.call(this,this._mainProxy)}},reRenderView:function(){this._mainProxy&&this._currenetViewArguments&&this.showView.apply(this,this._currenetViewArguments)},_runLogic:function(){var a=this.getLogicParams(),b=this,c={showView:b.showView,showLoadingIndicator:function(){b.setState("loading")},hideLoadingIndicator:function(){b.setState("content")},showErrorIndicator:function(a,c){a=a||-1,c=c||"Unspecified error",b.setState("error");var d=b._logger;d.reportError({code:a,description:c},this.$className,"showErrorIndicator",d.SubCategory.APP_LOGIC)}},d=this._data.get("viewName");d||(d=this._partDef.views[0],this._data.set("viewName",d,!0)),this._logic.run(d,a,c,this._extraLogicParams)},_onAppPartRenderComplete:function(){this.resources.W.Commands.executeCommand("ApplicationPerformanceSpy.logPhase",{step:"displayed",appPart:this}),this._stylesheetManager.updateDocumentStylesheet(),this.fireEvent("proxyDisplayed",this._mainProxy),this._eventDispatcher.fireEvent(Constants.WixAppEvents.APP_VIEW_READY),this.fireEvent("autoSized"),this.setState("content"),window.requestAnimFrame(function(){this._isDisposed||this._updateHeight()}.bind(this)),!this.resources.W.Config.isCapturing()&&!this.resources.W.Config.isLoadedFromStatic()||this._isDisposed||this._view.fireEvent(Constants.ComponentEvents.DOM_DISPLAY_READY)},_setupMainProxyListeners:function(a){var b=this;a.removeEvent("wix:zoom-link:open-zoom"),a.removeEvent("wix:edit-link:open-editor"),a.removeEvent("wix:app-link:navigate"),a.addEvent("wix:zoom-link:open-zoom",function(a){var c=a.zoomParams,d=b.getPartDef().zoomPartName,e=b._appInstance.getPartDefinition(d),f=b._isMobile()?e.mobileZoomExtraParams:e.zoomExtraParams,g=Object.merge(c.extraParams,f);b.getAppInstance().getZoomHandler().openZoomForItemsList(c.list,c.selectedIndex,d,g)}),a.addEvent("wix:edit-link:open-editor",function(a){var c=a.zoomParams,d=b.getPartDef().zoomPartName;b.getAppInstance().getZoomHandler().openZoomForItemsList(c.list,c.selectedIndex,d)}),a.addEvent("wix:app-link:navigate",function(){throw"Is there anybody out there..?"})},hideContent:function(){this.setState("loading"),this._skinParts.inlineContent.collapse()},showContent:function(){this.setState("content"),this._skinParts.inlineContent.uncollapse()},_getMinPhysicalHeight:function(){var a=0;return a=this._mainProxy&&this._mainProxy.getElement()?this._mainProxy.getElement().getSize().y:parseInt(this._view.get("height")||0,10)},_onAllSkinPartsReady:function(){this._activateHandlers(),this._skinParts.inlineContent.setStyles({position:"relative",direction:this.getComponentProperty("direction")}),Browser.firefox&&this._skinParts.inlineContent.setStyles({"white-space":"pre-wrap"})},_activateHandlers:function(){this._resizeHandler.activateResizeHandler(this._eventDispatcher,this._skinParts.inlineContent)},hasChildren:function(){return!1},isContainer:function(){return!1},_onDataChange:function(a,b){return this._ignoreUpdate||"appLogicCustomizations"===b?void 0:"AppPartProperties"===a.getType()?(this._skinParts.inlineContent.setStyle("direction",a.get("direction")),this._mainProxy&&this._mainProxy.getViewContext().getEnvironment().setVar("partDirection",a.get("direction")),void 0):(this._appInstance&&this._runLogic(),void 0)},getAppPartLogic:function(){return this._logic},_ruleFits:function(a,b){var c=!0;for(var d in b)b[d]!=a[d]&&(c=!1);return c},getCustomization:function(a){var b=[];if(!a)return this._data.get("appLogicCustomizations");for(var c=this._data.get("appLogicCustomizations"),d=c.length-1;d>-1;d--)this._ruleFits(c[d],a)&&b.push(c[d]);return b},clearCustomizations:function(a,b){if(a)for(var c=this._data.get("appLogicCustomizations"),d=c.length-1;d>-1;d--)this._ruleFits(c[d],a)&&c.splice(d,1);else this._data.set("appLogicCustomizations",[]);this._ignoreUpdate=!b,this._data.fireDataChangeEvent(),this._ignoreUpdate=!1,this._applyCustomizationRulesToDefinitions(),this._eventDispatcher.fireEvent(Constants.WixAppEvents.APP_PART_RESIZE),window.requestAnimFrame(function(){this.fireEvent("autoSized")}.bind(this))},setCustomizationRule:function(a){if("appVars"==a.fieldId)return this._appInstance.setAppVar(a.key,a.value),!1;var b,c=this._data.get("appLogicCustomizations"),d=[];a.type="AppPartCustomization";for(var e=0;e<c.length;)b=c[e],b.forType!==a.forType||b.view!==a.view||b.fieldId!==a.fieldId||b.key!==a.key||(b.format||"")!==(a.format||"")&&(b.format&&""!==b.format||"*"!==a.format)?e++:d.push(c.splice(e,1)[0]);return"*"===a.format?c.unshift(a):c.push(a),d},applyCustomizationRule:function(a,b){var c=this.setCustomizationRule(a,!0);if(c!==!1){this._ignoreUpdate=!b;var d=c&&c.length>0?c[0]:void 0,e=this.getCustomizationDefaultValue(a.forType,a.view,a.format||"",a.fieldId,a.key),f=d?!this.injects().Utils.areObjectsEqual(a,d):e!=a.value;f&&this.injects().Commands.executeCommand("WViewerCommands.AppDataChange",[a,d,this]),this._data.fireDataChangeEvent("appLogicCustomizations",a,d,this,!0),this._ignoreUpdate=!1,this._applyCustomizationRulesToDefinitions(),this._eventDispatcher.fireEvent(Constants.WixAppEvents.APP_CONTENT_RESIZE),this._eventDispatcher.fireEvent(Constants.WixAppEvents.APP_PART_RESIZE),window.requestAnimFrame(function(){this.fireEvent("autoSized")}.bind(this))}},_onResize:function(){return this._mainProxy?(this._allowHeightResize===!1?this.setHeight(this._getMinPhysicalHeight(),!1,!1):this._mainProxy&&this._mainProxy.getElement().setStyle("height",this.getHeight()),this.parent(),this._eventDispatcher.fireEvent(Constants.WixAppEvents.APP_PART_RESIZE),void 0):this.parent()},_onContentResize:function(){this._isDisposed||this._lifecycleManager.performAction(function(){this._updateHeight()}.bind(this))},_updateHeight:function(){this._allowHeightResize===!1&&(this.setHeight(this._getMinPhysicalHeight(),!1,!1),this.fireEvent("autoSizeChange"),this.fireEvent("autoSized"))},setExtraLogicParams:function(a){this._extraLogicParams=a},getEventDispatcher:function(){return this._eventDispatcher},_disposeLogic:function(){this._logic&&this._logic.dispose&&this._logic.dispose()},dispose:function(){this._mainProxy&&this._mainProxy.dispose(),this._stylesheetManager&&this._stylesheetManager.dispose(),this._disposeLogic(),this.parent()}})}),define.component("wixapps.integration.components.AppPart2",function(a){var b=a;b.inherits("mobile.core.components.base.BaseComponent"),b.utilize(["wixapps.integration.managers.ViewHolder","wixapps.integration.utils.GeometryUtils","wixapps.core.utils.WixAppsLogger","wixapps.integration.utils.FunctionCallThrottle","wixapps.integration.utils.FlexShrinkBugDetector"]),b.traits(["wixapps.integration.components.traits.SizeRefreshHandler"]),b.resources(["W.Utils","W.Viewer","W.Commands","W.Config"]),b.binds(["_onError","_onAppViewReady","_initApp","_retrieveData","_onContentResize","_onResizeEnd","_onViewDefinitionsChanged","_onAppDataChanged","checkSizeLimits","_updateHeightToMinPhysicalHeight","_updateHeight","_setupViewHolder"]),b.skinParts({inlineContent:{type:"htmlElement"},loading:{type:"htmlElement"}}),b.states({phase:["loading","error","rendering","content"],flexFix:["shrink1_legacy","shrink0"]}),b.dataTypes(["AppBuilderComponent"]),b.fields({_viewHolder:null,_allowHeightResize:!1,_appPartDefinition:null,_appInstance:null,_appPartData:null,isWixApps2:!0,_geometryUtils:null,_needsDuplication:!1,EDITOR_META_DATA:{mobile:{custom:[{label:"FPP_SETTINGS_LABEL",command:"EditorUI.OpenPropertyPanel"}],disablePropertySplit:!0}}}),b.methods({initialize:function(){this.parent.apply(this,arguments),this._logger=new this.imports.WixAppsLogger,this._utils=this.resources.W.Utils.AppsUtils,this._geometryUtils=new this.imports.GeometryUtils,this.setState("loading"),this.addEvent("resizeEnd",this._onResizeEnd),this.setMaxH(8e3),this._formatName="",this._checkSizeLimitsDebounce=this.imports.FunctionCallThrottle.debounceFunction(function(){this._viewHolder&&this._viewHolder.performActionWhenReadyLate(this.checkSizeLimits)}.bind(this),500),W.Config.env.$isEditorViewerFrame&&this.setState("shrink0"),this.resources.W.Commands.executeCommand("ApplicationPerformanceSpy.logPhase2",{step:"initialized",appPart:this})},_itsDeadJim:function(a){if(this.setState("error"),this._logger.reportError(this._logger.Errors.APP_PART2_FAILED_TO_LOAD,this.$className,"_onAllSkinPartsReady",this._logger.SubCategory.APP_BUILDER),!W.Config.env.$isPublicViewerFrame){this._resizableSides=[],this.getShowOnAllPagesChangeability=function(){return!1},this.isDuplicatable=function(){return!1},this._appInstance=W.Apps2.getErroneousAppInstance(this._data.get("appInnerID"),a);var b=this._appInstance.getAppPartDefinitions(),c=this._appInstance.getDataSelectors(),d=this._appInstance.getViewDefinitions(),e=this._appInstance.getDataItemFactory(),f=this._appInstance.getTypesManager(),g=this._appInstance.getDataProviders().getWixDbDataProvider();this._viewHolder=new this.imports.ViewHolder(e,f,d,this._appInstance.resolveResourcePath,"",!0,this),this._viewHolder.setContainer(this._skinParts.inlineContent),this._appPartDefinition=b.getById("errAppPartDef"),this._forType="wix:Object",this._viewName="SadPartErrorView",this._formatName="",this._dataSelector=c.createInstance("IB.StaticItem",g,"wix:Object",{item:{errCode:a&&a.code}}),this._dataSelector.getItem(function(a){this._setupViewHolder(a)}.bind(this))}},_onAllSkinPartsReady:function(a){a.error&&a.error.exterminate(),W.Apps2.getApplicationInstance(this._data.get("appInnerID"),function(a){if(!a)return this._itsDeadJim(),void 0;if(a.getError())return this._itsDeadJim(a.getError()),void 0;var b=a.getViewDefinitions(),c=a.getDataItemFactory(),d=a.getTypesManager();this._appInstance=a,b.addEvent(Constants.DataItemEvents.CHANGE,this._onViewDefinitionsChanged),this._viewHolder=new this.imports.ViewHolder(c,d,b,a.resolveResourcePath,"",!0,this),this._viewHolder.setContainer(this._skinParts.inlineContent),this._viewHolder.getEventDispatcher().addEvent(Constants.WixAppEvents.APP_CONTENT_RESIZE,this._onContentResize),this._initApp()}.bind(this))},_initApp:function(){var a=this._appInstance.getAppPartDefinitions(),b=this._appInstance.getDataSelectors(),c=this._appInstance.getViewDefinitions(),d=this._data.get("appPartName");if(!a.exists(d))return this._logger.reportEvent(this.imports.WixAppsLogger.Events.APP_PART2_FAILED_TO_LOAD_PART_DEFINITION,{c1:d}),this._itsDeadJim(),void 0;this._appPartDefinition=a.getById(d);var e=this._appPartDefinition.getDataSelectorId();return b.exists(e)?(this._resizableSides=[Constants.BaseComponent.ResizeSides.LEFT,Constants.BaseComponent.ResizeSides.RIGHT],this._dataSelector=b.getById(e),this._forType=this._appPartDefinition.getType(),this._viewName=this._appPartDefinition.getViewName(),this._formatName=this._isMobile()?"Mobile":"",this._verifyRequiredViewDefinitions(c,this._forType,this._viewName,this._formatName),this.resources.W.Commands.executeCommand("ApplicationPerformanceSpy.logPhase2",{step:"requesting items from server",appPart:this}),this._dataSelector.isListSelector()?this._dataSelector.getItems(this._retrieveData,this._onError):this._dataSelector.getItem(this._retrieveData,this._onError),this._appPartDefinition.setUsed(!0),void 0):(this._logger.reportEvent(this.imports.WixAppsLogger.Events.APP_PART2_FAILED_TO_LOAD_DATA_SELECTOR,{c1:e}),this._itsDeadJim(),void 0)},_verifyRequiredViewDefinitions:function(a,b,c,d){var e=this._appInstance.getViewBuilder();if(!a.hasViewDefinition(b,c,d)){var f=e.getBlankListItemViewTemplateDefinition(b,c);f.format=d,this._appInstance.addViewDefinition(f)}if(this._dataSelector.isListSelector()&&!a.hasViewDefinition("Array",c,d)){var g=e.getListViewTemplateDefinition(c);g.format=d,this._appInstance.addViewDefinition(g)}},_retrieveData:function(a){this.resources.W.Commands.executeCommand("ApplicationPerformanceSpy.logPhase2",{step:"items loaded",appPart:this}),this._isDisposed||(this._appPartData=a,this.setState("rendering"),this._viewHolder.getEventDispatcher().addEvent(Constants.WixAppEvents.APP_VIEW_CREATED,this._onAppViewReady),this._setupViewHolder(a),a.addEvent(Constants.DataItemEvents.CHANGE,this._onAppDataChanged))},reportDeleteComponentToBI:function(){var a=this._appInstance.getLogger();if(this._appPartDefinition&&this._appInstance.getInstanceId()){var b={c1:this._appInstance.getInstanceId(),c2:this._appPartDefinition.getId()};a.reportEvent(a.Events.APP_BUILDER_DELETED,b)}},reRenderView:function(){this._appPartData&&this._viewName&&this._setupViewHolder(this._appPartData)},isDomDisplayReadyOnReady:function(){return!1},_onError:function(a){this.setState("error"),this._reportError(a)},getEventDispatcher:function(){return this._viewHolder&&this._viewHolder.getEventDispatcher?this._viewHolder.getEventDispatcher():null},_onAppViewReady:function(){this.setState("content"),this._allowHeightResize===!0?this._viewHolder.setContentHeight(this.getHeight()):this.fireEvent("autoSized"),this._view.fireEvent(Constants.WixAppEvents.APP_VIEW_READY),this.fireEvent(Constants.WixAppEvents.APP_VIEW_READY),this._reportLoaded(),this._flexShrinkBUgDetector||(this._flexShrinkBUgDetector=new this.imports.FlexShrinkBugDetector,this._flexShrinkBUgDetector.start(this)),this.resources.W.Commands.executeCommand("ApplicationPerformanceSpy.logPhase2",{step:"displayed",appPart:this}),(this.resources.W.Config.isCapturing()||this.resources.W.Config.isLoadedFromStatic())&&this._view.fireEvent(Constants.ComponentEvents.DOM_DISPLAY_READY)},_onResize:function(){this._viewHolder&&(this._allowHeightResize===!1?this._viewHolder.performActionWhenReady(this._updateHeightToMinPhysicalHeight):this._viewHolder&&this._viewHolder.setContentHeight(this.getHeight()),this.parent(),this._viewHolder.getEventDispatcher().fireEvent(Constants.WixAppEvents.APP_PART_RESIZE),this._wCheckForSizeChangeAndFireAutoSized(3))},_onContentResize:function(){this._viewHolder.performActionWhenReady(this._updateHeight)},_updateHeight:function(){this._isDisposed||this._allowHeightResize===!1&&(this.setHeight(this._getMinPhysicalHeight(),!1,!1),this.fireEvent("autoSizeChange"),this.fireEvent("autoSized"))},_updateHeightToMinPhysicalHeight:function(){this.setHeight(this._getMinPhysicalHeight(),!1,!1)},_getMinPhysicalHeight:function(){if(this._viewHolder){var a=this._viewHolder.getRootProxy();if(a&&a.getElement())return a.getElement().getSize().y}return parseInt(this._view.get("height")||0,10)},_isMobile:function(){return this.resources.W.Config.env.$viewingDevice===Constants.ViewerTypesParams.TYPES.MOBILE},getFriendlyName:function(){var a=this.getAppPartDefinition(),b=a&&a.getDisplayName()||"";return b},_onResizeEnd:function(){this.checkSizeLimits()},_onViewDefinitionsChanged:function(){this._isDisposed||this._viewHolder.performActionWhenReady(this._checkSizeLimitsDebounce)},_onAppDataChanged:function(){this._isDisposed||this._viewHolder.performActionWhenReady(this._checkSizeLimitsDebounce)},checkSizeLimits:function(a){var b=this,c=!1;if(!this._isDisposed&&!this.resources.W.Config.env.$isPublicViewerFrame){a=void 0===a?0:a,this._viewHolder.getGeometryMap().reset();var d=this._geometryUtils.getOverflowRegions(this._skinParts.inlineContent,this._viewHolder.getGeometryMap());if(d.length>0&&d.length!==a){if(d.forEach(function(a){a.container.className.contains("wixAppsInRenderPreventReflow")&&(c=!0)}),c)return window.requestAnimFrame(function(){b.checkSizeLimits(a)}.bind(this)),void 0;var e=d.reduce(function(a,b){return Math.max(a,b.left+b.right)},-1/0);if(this.setWidth(this.getWidth()+e),d.length>1)return window.requestAnimFrame(function(){this.checkSizeLimits(d.length)}.bind(this)),void 0}this._viewHolder.invalidateSize()}},getAppInstance:function(){return this._appInstance},getAppPartData:function(){return this._appPartData},getAppPartDefinition:function(){return this._appPartDefinition},setAppPartDefinition:function(a){this._appPartDefinition=a},getViewDefinition:function(){return this._appInstance.getViewDefinitions().getViewDefinition(this._forType,this._viewName,this._formatName)},getFormatName:function(){return this._formatName},setFormatName:function(a){this._formatName=a,this.reRenderView()},getViewHolder:function(){return this._viewHolder},_setupViewHolder:function(a){this._viewHolder.setupViewHolder(a,this._viewName,this._formatName)},getUniqueFieldName:function(a,b){return this.getAppInstance().getTypesManager().getUniqueFieldName(this._forType,a,b)},getDataSelector:function(){return this._dataSelector},getEnvironment:function(){var a=this;return{getAppInstance:function(){return a._appInstance},getForType:function(){return a._forType}}},isDuplicatable:function(){return this.getDataSelector()&&!this.getDataSelector().isPageBased()},isDeleteable:function(){return!this.getDataSelector()||!this.getDataSelector().isPageBased()},getShowOnAllPagesChangeability:function(){return this.getDataSelector()&&!this.getDataSelector().isPageBased()},markNeedsDuplication:function(){this._needsDuplication=!0},_reportLoaded:function(){if(this.resources.W.Config.env.$isPublicViewerFrame){var a=this._appInstance.getLogger(),b={c1:this._appInstance.getInstanceId(),c2:this._appPartDefinition.getId(),g2:rendererModel&&rendererModel.userId};a.reportEvent(a.Events.APP_BUILDER_PART_LOADED,b)}},_reportError:function(a){if(this.resources.W.Config.env.$isPublicViewerFrame){var b=this._appInstance.getLogger(),c={c1:this._appInstance.getInstanceId(),c2:this._appPartDefinition.getId(),g2:rendererModel&&rendererModel.userId,i1:JSON.stringify(a)};b.reportEvent(b.Events.APP_BUILDER_PART_ERROR,c)}},dispose:function(){this._appInstance&&(this._appInstance.getViewDefinitions()&&this._appInstance.getViewDefinitions().removeEvent(Constants.DataItemEvents.CHANGE,this._onViewDefinitionsChanged),this._appPartData&&this._appPartData.removeEvent(Constants.DataItemEvents.CHANGE,this._onAppDataChanged),this._viewHolder&&(this._viewHolder.getEventDispatcher()&&(this._viewHolder.getEventDispatcher().removeEvent(Constants.WixAppEvents.APP_VIEW_READY,this._onAppViewReady),this._viewHolder.getEventDispatcher().removeEvent(Constants.WixAppEvents.APP_CONTENT_RESIZE,this._onContentResize)),this._viewHolder.dispose())),this._appPartDefinition&&this._appPartDefinition.setUsed(!1),this._viewHolder=null,this._dataSelector=null,this.parent()}})}),define.component("wixapps.integration.components.Area",function(a){var b=a;b.inherits("core.components.ContainerOBC"),b.skinParts({inlineContent:{type:"htmlElement"}}),b.methods({initialize:function(a,b,c){this.parent(a,b,c),"default"===c.styleNS&&(this._styleNameSpace="core.components.Container")},setStyle:function(a){this._setStyleInProgress=!0,this.parent(a),this._setStyleInProgress=!1,this.fireEvent(Constants.DisplayEvents.SKIN_CHANGE)},_replaceSkin:function(a){this.parent(a),this._setStyleInProgress||this.fireEvent(Constants.DisplayEvents.SKIN_CHANGE)}})}),define.component("wixapps.integration.components.ClippedParagraph",function(a){var b=a;b.inherits("wysiwyg.viewer.components.WRichText"),b.utilize(["wixapps.integration.utils.ParagraphLinesMap","wixapps.integration.utils.ParagraphClipping"]),b.skinParts({richTextContainer:{type:"htmlElement"}}),b.propertiesSchemaType("ClippedParagraphProperties"),b.resources(["W.Theme","W.Utils"]),b.fields({_paragraphClipping:null,_paragraphLineMap:null}),b.methods({initialize:function(a,b,c){this.parent(a,b,c),this._paragraphClipping=new this.imports.ParagraphClipping,this._paragraphLineMap=new this.imports.ParagraphLinesMap},render:function(){this._clipTextContent(),this._setLinksDataToElements("VIEW")},_updateText:function(){},_onAllSkinPartsReady:function(){this.parent(),this.resources.W&&this.resources.W.Theme&&this.resources.W.Theme.addEvent("propertyChange",function(a){if(!this._isDisposed&&0===a.name.indexOf("font_")){var b=this._data.get("text"),c=this.getRichTextContainer();this._paragraphClipping.rebuildCache(b,c),this._clipTextContent()}}.bind(this)),this._view.setStyles({overflow:"hidden",position:"absolute",width:this.getWidth(),"white-space":"normal"})},setPartDirection:function(){this._paragraphClipping.resetCache(),this.render()},_onDataChange:function(){this.parent(),this._skinParts&&this._clipTextContent()},_clipTextContent:function(){var a=this._data.get("text"),b=parseInt(this.getComponentProperty("maxLines"),10)||0,c=parseInt(this.getComponentProperty("minLines"),10)||0,d=String(this.getComponentProperty("pack")),e=this.getRichTextContainer();e.isVisible()&&(e.setStyles({width:this.getWidth()}),b?this._clipParagraphByLines(a,e,this.getWidth(),c,b,d):this._clipParagraphBySize(a,e,this.getWidth(),this.getHeight()),("true"===this.getComponentProperty("showTooltip")||this.getComponentProperty("showTooltip")===!0)&&(this._paragraphClipping.isClipped()?e.setAttribute("title",a.replace(/<.*?>/gi,"")):e.removeAttribute("title")))},_clipParagraphBySize:function(a,b,c,d){this._paragraphClipping.clipParagraph(a,b,c,d)},_clipParagraphByLines:function(a,b,c,d,e,f){var g=a!==this._paragraphClipping.getLastTextContent();g&&b.set("html",this._paragraphClipping.wrapWordsInSpans(a)),this._paragraphClipping.hideEllipsis(),this._paragraphLineMap.updateMap(b),this._paragraphClipping.showEllipsis();var h=Math.min(e,this._paragraphLineMap.getLineNum()),i=this._paragraphLineMap.getParagraphHeight(h),j=i/h;this._paragraphClipping.clipParagraph(a,b,c,i);var k=0;if("none"!==f&&e>h){var l=parseInt((e-h)*j,10);i+=l,"bottom"===f?k=l:"middle"===f&&(k=Math.floor(l/2))}d>0&&(i=Math.max(i,j*d)),b.setStyle("margin-top",k),this.setHeight(i,void 0,!1),this._view.setStyles({height:i}),this.fireEvent("autoSized")},_onResize:function(){(this._isRendered===!0||this.resources.W.Utils.isIE())&&this.getRichTextContainer().getParents("body").length&&this._clipTextContent()},setHeight:function(a,b,c){return c!==!1&&(c=!0),a=parseInt(a,10),isNaN(a)?(W.Utils.debugTrace("WbaseComp","setHeight","NaN passed as value"),void 0):(a=this._limitHeight(a),(this._$height!=a||b)&&(this._$height=a,this._view.setStyle("min-height",this._$height+"px"),this._view.setStyle("height",this._$height+"px"),this.flushPhysicalHeightCache(),c&&this._onResize()),void 0)}})}),define.component("wixapps.integration.components.ContentFlipper",function(a){var b=a;b.utilize(["wysiwyg.viewer.utils.TransitionUtils"]),b.inherits("core.components.base.BaseComp"),b.skinParts({inlineContent:{type:"htmlElement"}}),b.statics({CONTENT_REARRANGED:"ContentRearranged"}),b.fields({_intakeContainer:null,_mainContainer:null,_transitionUtils:null,_viewPortSize:null}),b.methods({initialize:function(){this.INVALIDATIONS.CONTENT_REFRESH="INVALIDATIONS.CONTENT_REFRESH",this.parent.apply(this,arguments),this._transitionUtils=new this.imports.TransitionUtils},isRenderNeeded:function(a){var b=[this.INVALIDATIONS.SKIN_CHANGE,this.INVALIDATIONS.SIZE,this.INVALIDATIONS.DATA_CHANGE,this.INVALIDATIONS.CONTENT_REFRESH];return a.isInvalidated(b)},getIntakeContainer:function(){return this._intakeContainer},_onRender:function(a){if(a.data.invalidations.isInvalidated([this.INVALIDATIONS.SKIN_CHANGE])&&this._setupSkinParts(),a.data.invalidations.isInvalidated([this.INVALIDATIONS.SIZE])){var b=_.last(a.data.invalidations.getInvalidationByType(this.INVALIDATIONS.SIZE)).current;this._updateInlineContentSize(b)}return a.data.invalidations.isInvalidated([this.INVALIDATIONS.DATA_CHANGE])?(this._mainContainer.empty(),this._updateDataPagination(this._pagination),void 0):(this._updatePageCounter(this._pagination.getCurrentPage(),this._pagination.getTotalPageCount()),this._viewPortSize&&(this._intakeContainer.childNodes.length>0?this._insertNewContent().done():this._refreshContent().done()),void 0)},_updateDataPagination:function(){},_updatePageCounter:function(){},_setupSkinParts:function(){this._intakeContainer=new Element("div"),this._mainContainer=new Element("div"),this._hideContainer(this._intakeContainer),_.toArray(this._skinParts.inlineContent.childNodes).forEach(function(a){this._intakeContainer.appendChild(a)}.bind(this));var a=new Element("div");a.appendChild(this._mainContainer),a.appendChild(this._intakeContainer),this._skinParts.inlineContent.appendChild(a),this.$view.setStyles({overflow:"hidden"}),a.setStyles({position:"absolute",width:"100%",height:"100%"}),this._skinParts.inlineContent.setStyles({position:"absolute",overflow:"hidden"})
},_updateInlineContentSize:function(a){var b=this._skin.getParamValue("widthDiff"),c=this._skin.getParamValue("heightDiff"),d=a.width-(b?b.getAmount():0),e=a.height-(c?c.getAmount():0);this._skinParts.inlineContent.setStyles({width:d,height:e}),this._viewPortSize={width:d,height:e}},_arrangeContent:function(){},_updateContainerSize:function(){},_refreshContent:function(){var a=this;return Q.resolve().then(function(){return a._updateContainerSize(a._mainContainer)||Q.resolve()}).then(function(){return a._arrangeContent(a._mainContainer)||Q.resolve()}).then(function(){return a.trigger(a.CONTENT_REARRANGED),Q.resolve()})},_insertNewContent:function(){var a=this;return Q.resolve().then(function(){return a._updateContainerSize(a._intakeContainer)||Q.resolve()}).then(function(){return a._arrangeContent(a._intakeContainer)||Q.resolve()}).then(function(){return a.trigger(a.CONTENT_REARRANGED),Q.resolve()}).then(function(){return a._intakeContainer.childNodes.length>0?a._injectNewItems():Q.resolve()}).then(function(){return a._updateContainerSize(a._mainContainer)||Q.resolve()})},_injectNewItems:function(){var a=Q.defer(),b=this._mainContainer.childNodes.length>0;if(b){this._showContainer(this._intakeContainer);var c=this._transitionUtils.getTransition(this.getTransitionType());c.call(this,this._mainContainer,this._intakeContainer,this.getDirection(),this.getDuration(),function(){this._finalizeTransition(),a.resolve()}.bind(this))}else this._finalizeTransition(),a.resolve();return a.promise},getDirection:function(){return 0},getDuration:function(){return 1},getTransitionType:function(){return Constants.TransitionTypes.SWIPE_HORIZONTAL},_showContainer:function(a){a.setStyles({overflow:"visible"})},_hideContainer:function(a){a.setStyles({width:0,height:0,overflow:"hidden"})},_finalizeTransition:function(){for(;this._mainContainer.childNodes[0];)this._mainContainer.childNodes[0].$viewProxy.dispose();for(;this._intakeContainer.childNodes[0];)this._mainContainer.appendChild(this._intakeContainer.childNodes[0]);this._showContainer(this._mainContainer),this._hideContainer(this._intakeContainer),this.trigger("transitionFinished")},dispose:function(){this.exterminateAutoplay(),this.exterminate()},exterminate:function(){for(;this._mainContainer.childNodes[0];)this._mainContainer.childNodes[0].$viewProxy.dispose();this.parent()}})}),define.component("wixapps.integration.components.Counter",function(a){var b=a;b.inherits("mobile.core.components.base.BaseComponent"),b.skinParts({text:{type:"htmlElement",optional:"true"},graphic:{type:"htmlElement",optional:"true"}}),b.methods({initialize:function(a,b,c){this.parent(a,b,c),this.refresh(c.defaultIndex,c.total)},_onAllSkinPartsReady:function(){},refresh:function(a,b){this._total!=b&&(this._total=b,this.isGraphic()&&(this._skinParts.graphic.empty(),this._containerCreated=!1)),this._currentIndex=a,this._renderIfReady()},render:function(){this.isTextual()&&this._skinParts.text.set("text",this._getCounterText()),this.isGraphic()&&this._createGraphicCounter()},isGraphic:function(){return void 0!==this._skinParts.graphic},isTextual:function(){return void 0!==this._skinParts.text},_getCounterText:function(){return String(this._currentIndex+1)+"/"+String(this._total)},_createGraphicCounter:function(){var a=this._skinParts.graphic;if(this._containerCreated)for(var b=a.getChildren(),c=0;c<b.length;c++){var d=b[c];c===this._currentIndex?d.addClass("selected"):d.removeClass("selected")}else{for(var e=0;e<this._total;e++){var f=e===this._currentIndex,g=new Element("li",{"class":f?"selected":""});a.appendChild(g)}this._containerCreated=!0}}})}),define.component("wixapps.integration.components.HorizontalRepeater",function(a){var b=a;b.inherits("wysiwyg.viewer.components.VerticalRepeater"),b.utilize(["wysiwyg.viewer.utils.ComponentSequencer"]),b.traits([]),b.binds([]),b.skinParts({inlineContent:{type:"htmlElement"}}),b.states(),b.fields({}),b.methods({})}),define.component("wixapps.integration.components.IFrameComponent",function(a){var b=a;b.inherits("wysiwyg.viewer.components.IFrameComponent"),b.binds(),b.methods({initialize:function(a,b,c){this.parent(a,b,c),this._url=c.url,this._width=c.width||"100%",this._height=c.height||"100%"},setUrl:function(a){this._url=a},_getUrl:function(){return this._url},getWidth:function(){return this._width+"px"},getHeight:function(){return this._height+"px"}})}),define.component("wixapps.integration.components.Icon",function(a){var b=a;b.inherits("mobile.core.components.base.BaseComponent"),b.binds(["_onClick"]),b.skinParts({img:{type:"htmlElement"}}),b.dataTypes(["Icon"]),b.methods({_onAllSkinPartsReady:function(a){a.img.addEvent("click",this._onClick)},render:function(){this._skinParts.img.set("src",this._data.get("url")),this._skinParts.img.set("width",this._data.get("width")),this._skinParts.img.set("height",this._data.get("height")),this._skinParts.img.set("title",this._data.get("title")),this._view.setStyles({width:this._data.get("width"),height:this._data.get("height")})},_onClick:function(a){this.fireEvent(Constants.CoreEvents.CLICK,a)}})}),define.component("wixapps.integration.components.ImageButton",function(a){var b=a;b.inherits("mobile.core.components.base.BaseComponent"),b.binds(["_onClick","_onMouseEnter","_onMouseLeave","_onMouseDown","_onMouseUp"]),b.skinParts({}),b.propertiesSchemaType("WixappsImageButtonProperties"),b.dataTypes(["Icon"]),b.methods({_isSprite:function(){return this.getComponentProperty("isSprite")},_startX:function(){return this.getComponentProperty("startPositionX")},_startY:function(){return this.getComponentProperty("startPositionY")},_dir:function(){return this.getComponentProperty("spriteDirection")},_bgPos:function(a,b){return void 0===a&&(a=this._startX()),void 0===b&&(b=this._startY()),a+"px "+b+"px"},_onAllSkinPartsReady:function(){this._view.addEvent("click",this._onClick),this._view.addEvent("mousedown",this._onMouseDown),this._view.addEvent("mouseup",this._onMouseUp),this._view.addEvent("mouseenter",this._onMouseEnter),this._view.addEvent("mouseleave",this._onMouseLeave)},_onClick:function(a){this.fireEvent(Constants.CoreEvents.CLICK,a)},_onMouseDown:function(){if(this._isSprite()&&"none"!==this._dir()){var a=parseInt(this._startX(),10),b=parseInt(this._startY(),10),c=parseInt(this._data.get("width"),10),d=parseInt(this._data.get("height"),10),e="horizontal"===this._dir();e?a-=2*c:b-=2*d,this._view.firstChild.setStyle("background-position",this._bgPos(a,b))}},_onMouseUp:function(){if(this._isSprite()&&"none"!==this._dir()){var a=parseInt(this._startX(),10),b=parseInt(this._startY(),10),c=parseInt(this._data.get("width"),10),d=parseInt(this._data.get("height"),10),e="horizontal"===this._dir();e?a-=c:b-=d,this._view.firstChild.setStyle("background-position",this._bgPos(a,b))}},_onMouseEnter:function(){if(this._isSprite()&&"none"!==this._dir()){var a=parseInt(this._startX(),10),b=parseInt(this._startY(),10),c=parseInt(this._data.get("width"),10),d=parseInt(this._data.get("height"),10),e="horizontal"===this._dir();e?a-=c:b-=d,this._view.firstChild.setStyle("background-position",this._bgPos(a,b))}},_onMouseLeave:function(){this._isSprite()&&this._view.firstChild.setStyle("background-position",this._bgPos())},_renderImage:function(){this._view.empty();var a=new Element("img");a.set("src",this._data.get("url")),a.set("width",this._data.get("width")),a.set("height",this._data.get("height")),a.set("title",this._data.get("title")),this._view.grab(a)},_renderSprite:function(){this._view.empty();var a=new Element("span"),b={"background-image":"url("+this._data.get("url")+")","background-repeat":"no-repeat","background-position":this._bgPos(),width:this._data.get("width"),height:this._data.get("height"),display:"inline-block"};a.setStyles(b),this._view.grab(a)},render:function(){this._view.setStyles({width:this._data.get("width"),height:this._data.get("height")}),this._isSprite()?this._renderSprite():this._renderImage()}})}),define.component("wixapps.integration.components.InlineText",function(a){a.inherits("wysiwyg.viewer.components.WRichText"),a.utilize(["mobile.core.components.base.BaseComponent"]),a.skinParts({}),a.methods({_updateText:function(){var a=this._data.get("text");a=a.replace("<p","<span"),a=a.replace("</p","</span"),this._view.set("html",a)},getRichTextContainer:function(){return this._skinParts?this._view:null}})}),define.component("wixapps.integration.components.LinkSelector",function(a){var b=a;b.inherits("mobile.core.components.base.BaseComponent"),b.utilize([]),b.traits([]),b.binds(["_onClick"]),b.skinParts({description:{type:"htmlElement"}}),b.states(["normal","nonEditable"]),b.dataTypes(["Text"]),b.fields({_descriptionVisibility:!1}),b.methods({initialize:function(a,b,c){this.parent(a,b,c),this._descriptionVisibility=c&&c.descriptionVisible||!1,this._isEditable=c&&void 0!==c.isEditable?c.isEditable:!0},_onAllSkinPartsReady:function(a){this._isEditable?(this.setState("normal"),a.description.addEvent("click",this._onClick)):this.setState("nonEditable")},_onClick:function(a){this.fireEvent(Constants.CoreEvents.CLICK,a)},render:function(){this.parent(),this.setDescriptionVisibility(this._descriptionVisibility)},setDescriptionVisibility:function(a){this._descriptionVisibility=a,this._skinParts.description.set("text",a?this._data.get("text"):""),this._skinParts.description.set("title",a?"":this._data.get("text"))}})}),define.component("wixapps.integration.components.MatrixGallery",function(a){var b=a;b.inherits("mobile.core.components.base.BaseComponent"),b.utilize(["wysiwyg.viewer.utils.ComponentSequencer"]),b.binds(["_increaseTotalMaxRows","_sequencingHook"]),b.dataTypes(["ImageList"]),b.skinParts({imageItem:{type:"htmlElement"},itemsContainer:{type:"htmlElement"},showMore:{type:"htmlElement"}}),b.states(["fullView","hiddenChildren"]),b.propertiesSchemaType("MatrixGalleryProperties"),b.fields({EDITOR_META_DATA:{general:{settings:!0,design:!0},custom:[{label:"GALLERY_ORGANIZE_PHOTOS",command:"WEditorCommands.OpenListEditDialog",commandParameter:{galleryConfigID:"MatrixGallery",publicMediaFile:"photos",selectionType:"multiple",mediaType:"picture",i18nPrefix:"multiple_images"},commandParameterDataRef:"SELF"}],dblClick:{command:"WEditorCommands.OpenListEditDialog",commandParameter:{galleryConfigID:"MatrixGallery",publicMediaFile:"photos",selectionType:"multiple",mediaType:"picture",i18nPrefix:"multiple_images"},commandParameterDataRef:"SELF"}},_itemsRef:[],_galleryItems:[],_totalMaxRows:0,_numCols:0,_numRows:0,_gap:0,_itemWidth:-1,_itemHeight:-1,_transitionProp:"",_numItems:0,_imageMode:"",_transitionsOn:!0,_Tween:null,_widthDiff:0,_heightDiff:0,_minDisplayerWidth:5,_minDisplayerHeight:5,_renderingPhase:"normal"}),b.methods({initialize:function(a,b,c){this.parent(a,b,c),W.Commands.registerCommandListenerByName("WPreviewCommands.WEditModeChanged",this,this._onEditorModeChanged),this._transitionProp=this.injects().Utils.getCSSBrowserFeature("transition"),this._Tween=this.injects().Utils.Tween,this.setMaxW(1e4),this.setMaxH(1e4),this._sequencer=new this.imports.ComponentSequencer,this._sequencer.resolveItem=c&&c.sequencingHook?c.sequencingHook:this._sequencingHook},_sequencingHook:function(){return{comp:"wysiwyg.viewer.components.Displayer",skin:this._skin.compParts.imageItem.skin}},_onDataChange:function(){var a,b;this._numItems=this._data.get("items").length,this._numCols=parseInt(this.getComponentProperty("numCols")),this._numRows=this._getRowNumber(),this._gap=parseInt(this.getComponentProperty("margin")),this._imageMode=String(this.getComponentProperty("imageMode")),this._updateState(),-1==this._itemWidth?this._calculateItemSize():this._numItems>0&&(a=Math.round(this._numCols*this._itemWidth+(this._numCols-1)*this._gap),b=Math.round(this._numRows*this._itemHeight+(this._numRows-1)*this._gap),this._setContainerWidth(a),this._setContainerHeight(b),this._positionAllItems(),this.fireEvent("autoSized")),this._updateSizeLimits(),this.parent()},_getRowNumber:function(){var a=parseInt(this.getComponentProperty("numCols")),b=parseInt(this.getComponentProperty("maxRows"));return this._numItems&&this._numItems<b*a?this._normalizeRows(b):b},_updateSizeLimits:function(){this.setMinW(this._numCols*(this._minDisplayerWidth+this._gap)+this._widthDiff-this._gap),this.setMinH(this._numRows*(this._minDisplayerHeight+this._gap)+this._heightDiff-this._gap)},_onEditorModeChanged:function(a,b){"PREVIEW"===b&&this._setTotalMaxRows(this._getRowNumber())},_setContainerWidth:function(a){var b=a+this._widthDiff;this._skinParts.itemsContainer.setStyle("width",String(a)+"px"),this._view.setStyle("width",String(b)+"px"),this.setWidth(b,!1,!1)},_setContainerHeight:function(a){var b=a+this._heightDiff;this._skinParts.itemsContainer.setStyle("height",String(a)+"px"),this.setHeight(b,!1,!1),this._view.setStyle("height",String(b)+"px")},_updateContainerSize:function(){var a=this._view.getSize();(0===a.x||0===a.y)&&(a.x=this.getWidth(),a.y=this.getHeight());var b=a.x-this._widthDiff,c=a.y-this._heightDiff;this._skinParts.itemsContainer.setStyles({width:b+"px",height:c+"px"})},_calculateItemSize:function(){if(this._skinParts&&this._data.get("items").length>0){var a=this._view.getSize();(0===a.x||0===a.y)&&(a.x=this.getWidth(),a.y=this.getHeight());var b=a.x-this._widthDiff,c=a.y-this._heightDiff;this._itemWidth=Math.max(Math.floor((b-(this._numCols-1)*this._gap)/this._numCols),0),this._itemHeight=Math.max(Math.floor((c-(this._numRows-1)*this._gap)/this._numRows),0)}},_onAllSkinPartsReady:function(){var a=this.getComponentProperty("galleryImageOnClickAction"),b=this.getComponentProperty("expandEnabled");"unset"===a&&(b===!1?this.setComponentProperty("galleryImageOnClickAction","disabled",!0):this.setComponentProperty("galleryImageOnClickAction","zoomMode",!0)),this._sequencer.addEvent("componentSetup",function(a){this._onDisplayerCreation(a.compView.getLogic(),a.method,a.index)}.bind(this)),this._sequencer.addEvent("productionFinished",function(a){this._onSequencerFinished(a)}.bind(this)),this._skinParts.itemsContainer.setStyles({position:"relative"}),this._skinParts.showMore&&(this._skinParts.showMore.addEvent(Constants.CoreEvents.MOUSE_DOWN,this._increaseTotalMaxRows),this._skinParts.showMore.setStyles({"white-space":"nowrap"})),this._widthDiff=this._skin.widthDiff||0,this._heightDiff=this._skin.heightDiff||0,this._bottomGap=this._skin.bottomGap||0,this._calculateItemSize(),this._updateSizeLimits(),this._setCorrectedComponentSize(),this._updateContainerSize()},render:function(){this._newItems=[],this._sequencer.createComponents(this._skinParts.itemsContainer,this._data.get("items").slice(0,this._numCols*this._numRows))},_onSequencerFinished:function(a){this._renderingPhase="normal",this._galleryItems=a.elements,this._totalMaxRows=this.getComponentProperty("maxRows"),this._positionAllItems(),this._setupAllItems()},_setupItem:function(a){if(a.getLogic){var b=a.getLogic();b.setOwner(this),b.invalidateSize(),b.setSize(this._itemWidth,this._itemHeight-this._bottomGap,this._imageMode),this._transitionsOn&&parseFloat(a.getStyle("opacity"))<1&&(this._transitionProp?(a.setStyle(this._transitionProp,"opacity 1s"),setTimeout(function(){a.setStyle("opacity","1.0")},150)):this._Tween.to(a,1,{opacity:1}))}},_onDisplayerCreation:function(a,b){"create"==b&&"showMore"==this._renderingPhase&&a.getViewNode().setStyle("opacity","0.0")},_normalizeRows:function(a){var b=Math.floor(this._numItems/this._numCols)+(this._numItems%this._numCols>0?1:0);return Math.min(a,b)},_updateState:function(){this._numItems<=this._numRows*this._numCols?this.setState("fullView"):this.setState("hiddenChildren")},_positionAllItems:function(a){a=a||this._galleryItems;for(var b=0;b<a.length;b++){var c=this._calcItemPosition(b);a[b].setStyles({position:"absolute",left:c.left+"px",top:c.top+"px"})}},_calcItemPosition:function(a){var b=a%this._numCols,c=Math.floor((a-b)/this._numCols);return{left:b*(this._itemWidth+this._gap),top:c*(this._itemHeight+this._gap),width:this._itemWidth+this._gap,height:this._itemHeight+this._gap}},_setupAllItems:function(a){a=a||this._galleryItems;for(var b=0;b<a.length;b++)this._setupItem(a[b])},_setCorrectedComponentSize:function(){var a=this.getWidth()-(this.getWidth()-this._widthDiff-this._gap*(this._numCols-1))%this._numCols,b=this.getHeight()-(this.getHeight()-this._heightDiff-this._gap*(this._numRows-1))%this._numRows;this._view.setStyles({width:a,height:b}),this.setWidth(a,!1,!1),this.setHeight(b,!1,!1)},_onResize:function(){this.parent(),this._skinParts&&(this._calculateItemSize(),this._setCorrectedComponentSize(),this._updateContainerSize(),this._positionAllItems(),this._setupAllItems())},_checkExtremeValues:function(){if(this._itemWidth<this._minDisplayerWidth){var a=this.getWidth()-this._widthDiff;this._itemWidth=this._minDisplayerWidth,this._gap=Math.floor((a-this._numCols*this._itemWidth)/(this._numCols-1)),this.setComponentProperty("margin",this._gap)}else if(this._itemHeight<this._minDisplayerHeight){var b=this.getHeight()-this._heightDiff;this._itemHeight=this._minDisplayerHeight,this._gap=Math.floor((b-this._numRows*this._itemHeight)/(this._numRows-1)),this.setComponentProperty("margin",this._gap)}},_increaseTotalMaxRows:function(){this._setTotalMaxRows(this._normalizeRows(this._numRows+parseInt(this.getComponentProperty("incRows"))))},_setTotalMaxRows:function(a){this._numRows=a;var b=Math.floor(this._numRows*this._itemHeight+(this._numRows-1)*this._gap);this._updateState(),this._setContainerHeight(b),this._calculateItemSize(),this.fireEvent("autoSized"),this._renderingPhase="showMore",this.render()},getSequencer:function(){return this._sequencer}})}),define.component("wixapps.integration.components.MultiColumnList",function(a){a.inherits("mobile.core.components.base.BaseComponent"),a.utilize(["wysiwyg.viewer.utils.ComponentSequencer"]),a.binds([]),a.fields({_columns:3,_columnWidth:0}),a.dataTypes(["ImageList"]),a.methods({initialize:function(a,b,c){if(this.parent(a,b,c),this._sequencer=new this.imports.ComponentSequencer,!c||!c.sequencingHook)throw new Error("No sequencer");this._sequencer.resolveItem=c.sequencingHook},_onAllSkinPartsReady:function(){this._sequencer.addEvent("componentSetup",function(a){this._onDisplayerCreation(a.compView,a.method,a.index)}.bind(this)),this._sequencer.addEvent("productionFinished",function(a){this._onSequencerFinished(a)}.bind(this))},render:function(){this._columnWidth=this._view.getSize().x/this._columns,this._sequencer.createComponents(this._skinParts.itemsContainer,this._data.get("items").slice(0,this._numCols*this._numRows))},_onSequencerFinished:function(){},_onDisplayerCreation:function(a){a.setStyles({width:this._columnWidth})},getSequencer:function(){return this._sequencer}})}),define.component("wixapps.integration.components.PaginatedGridGallery",function(a){var b=a;b.inherits("wixapps.integration.components.MatrixGallery"),b.utilize(["wysiwyg.viewer.utils.MatrixTransitions","wysiwyg.viewer.utils.GalleryUtils"]),b.resources(["W.Utils"]),b.traits(["wixapps.integration.components.traits.GalleryAutoplay"]),b.binds(["next","prev","_onTransitionComplete","_onRollOut","_onMouseMove","_onClick","_onRollOverViewCreated","_onPrevious","_onNext"]),b.skinParts({itemsContainer:{type:"htmlElement"},buttonPrev:{type:"htmlElement"},buttonNext:{type:"htmlElement"},counter:{type:"htmlElement",optional:!0},rolloverHolder:{type:"htmlElement",optional:!0},rolloverContent:{type:"htmlElement",optional:!0},title:{type:"htmlElement",optional:!0},description:{type:"htmlElement",optional:!0},zoom:{type:"htmlElement",optional:!0},link:{type:"htmlElement",optional:!0},graphicCounter:{optional:!0,type:"wixapps.integration.components.Counter",skin:"wysiwyg.viewer.skins.paginatedgrid.counter.CounterGraphicSkin"}}),b.states({rendering:["pending","ready"],itemSelection:["rollover","idle"],linkableComponent:["link","noLink"],slideshow:["autoplayOn","autoplayOff"],mobile:["notMobile","mobile"]}),b.propertiesSchemaType("PaginatedGridGalleryProperties"),b.fields({_pageItemsCount:0,_currentItemIndex:0,_displayerDict:{},_transitionPending:!1,_transitionUtils:null,_linkUtils:null,_hasRollOver:!0,_NO_LINK_PROPAGATION:!0}),b.methods({initialize:function(a,b,c){c=c||{},this.parent(a,b,c),this._transitionsOn=!1,this._transitionUtils=new this.imports.MatrixTransitions,this._linkUtils=this.resources.W.Utils.linkUtils,this._view.addEvent(Constants.CoreEvents.MOUSE_MOVE,this._onMouseMove),this._view.addEvent(Constants.CoreEvents.MOUSE_OUT,this._onRollOut),"fixedRowNumber"in c&&(this._fixedRowNumber=c.fixedRowNumber===!0),void 0===c.sequencingHook&&(this._sequencer.resolveItem=function(){return{comp:"wysiwyg.viewer.components.ImageLite",skin:"mobile.core.skins.InlineSkin"}}),c.rolloverHook&&(this._rolloverSequencer=new this.imports.ComponentSequencer,this._rolloverSequencer.resolveItem=c.rolloverHook,this._rolloverSequencer.addEvent("componentSetup",this._onRollOverViewCreated)),c.sequencingHook&&!c.rolloverHook&&(this._hasRollOver=!1),W.Config.mobileConfig.isMobileOrTablet()?this.setState("mobile","mobile"):this.setState("notMobile","mobile")},getSequencer:function(){return this._sequencer},getRolloverSequencer:function(){return this._rolloverSequencer},_onAllSkinPartsReady:function(){this.parent(),this.getComponentProperty("showNavigation")||this.getComponentProperty("showCounter")||(this._heightDiff=0),this._skinParts.itemsContainer.setStyles({position:"relative"}),this._skinParts.itemsContainer.addEvent(Constants.CoreEvents.CLICK,this._onClick),this._skinParts.rolloverHolder&&(this._skinParts.rolloverHolder.addEvent(Constants.CoreEvents.CLICK,this._onClick),this._skinParts.rolloverHolder.setStyles({overflow:"hidden"}),this._resetRollOver());var a=this.injects().Utils.getCSSBrowserFeature("user-select"),b={cursor:"pointer"};a&&(b[a]="none"),this._skinParts.buttonPrev.setStyles(b),this._skinParts.buttonNext.setStyles(b),this._addEventListeners(),this._skinParts.itemsContainer.setStyle("overflow","hidden"),this._transitionUtils.setupTransitionMap(this._calcItemPosition.bind(this),this._skinParts.itemsContainer),this._checkSkinPartsVisibility()},_addEventListeners:function(){this._skinParts.buttonPrev.addEvent(Constants.CoreEvents.CLICK,this._onPrevious),this._skinParts.buttonNext.addEvent(Constants.CoreEvents.CLICK,this._onNext),"mobile"===this.getState("mobile")&&(window.Hammer(this._view).on("swiperight",this._onPrevious),window.Hammer(this._view).on("swipeleft",this._onNext))},_onPrevious:function(a){a.stopPropagation(),this.prev()},_onNext:function(a){a.stopPropagation(),this.next()},_getRowNumber:function(){return this._fixedRowNumber===!0?parseInt(this.getComponentProperty("maxRows"),10):this.parent()},_calculateItemSize:function(){if(this._skinParts&&this._data.get("items").length>0){var a={x:this.getWidth(),y:this.getHeight()},b=a.x-this._widthDiff,c=a.y-this._heightDiff;this._itemWidth=Math.max(Math.floor((b-(this._numCols-1)*this._gap)/this._numCols),0),this._itemHeight=Math.max(Math.floor((c-(this._numRows-1)*this._gap)/this._numRows),0)}},_onResize:function(){this.parent(),this._skinParts&&this._updateRollover()},_onResizeEnd:function(){this._skinParts&&this._skinParts.itemsContainer.getChildren().forEach(function(a,b){this._updateDisplayerGeometry(a,b)}.bind(this))},_onDataChange:function(){this._currentItemIndex=0;var a=parseInt(this.getComponentProperty("numCols"),10)*this._getRowNumber();this._componentReady&&a!=this._pageItemsCount&&this._clearAllItems(),this._pageItemsCount=a,this.parent.apply(this,arguments),this._checkSkinPartsVisibility()},render:function(){var a=this._data.get("items");this._displayerDict={},this._skinParts.counter&&this._skinParts.counter.set("text",this._getCounterText(this._currentItemIndex,a.length)),this._pageItemsCount=parseInt(this.getComponentProperty("numCols")*this._getRowNumber(),10),this._displayedItems=this._getPageItems(a,this._currentItemIndex);var b=this._displayedItems;if(a.length>this._pageItemsCount?(this._nextPageItems=this._getPageItems(a,this._getNextPageItemIndex()),this._prevPageItems=this._getPageItems(a,this._getPrevPageItemIndex()),b=b.concat(this._nextPageItems).concat(this._prevPageItems),this._skinParts.buttonNext.setStyles({display:"block"}),this._skinParts.buttonPrev.setStyles({display:"block"})):(this._skinParts.buttonNext.setStyles({display:"none"}),this._skinParts.buttonPrev.setStyles({display:"none"})),this._sequencer.createComponents(this._skinParts.itemsContainer,b),this._skinParts.graphicCounter){var c=Math.floor(this._currentItemIndex/this._pageItemsCount),d=Math.max(this._getTotalPageCount(),1);this._skinParts.graphicCounter.refresh(c,d)}},_getPageItems:function(a,b){for(var c=[],d=Math.min(this._numItems-1,b+this._pageItemsCount-1),e=b;d>=e;e++)c.push(a[e]);return c},_translateRefList:function(a){var b,c,d,e=[],f=this._skinParts.itemsContainer.children,g=typeOf(a[0]);a=a.slice(0);for(var h=0;h<f.length;h++)b=f[h],c=b.getLogic().getDataItem(),d="string"===g?"#"+c.get("id"):c,a.contains(d)&&(e.push(b),a.splice(a.indexOf(d),1));return e},_checkSkinPartsVisibility:function(){this._skinParts&&(this._updateRollover(),this._skinParts.buttonPrev.setStyle("visibility",this.getComponentProperty("showNavigation")?"visible":"hidden"),this._skinParts.buttonNext.setStyle("visibility",this.getComponentProperty("showNavigation")?"visible":"hidden"),this._skinParts.counter&&this._skinParts.counter.setStyle("visibility",this.getComponentProperty("showCounter")?"visible":"hidden"),this._skinParts.rolloverHolder&&this._skinParts.rolloverHolder.setStyle("cursor",this.getComponentProperty("expandEnabled")?"pointer":"default"),this._skinParts.graphicCounter&&this._skinParts.graphicCounter.getViewNode().setStyle("visibility",this.getComponentProperty("showCounter")?"visible":"hidden"))},_updateState:function(){},_onDisplayerCreation:function(a,b,c){var d,e=a.getViewNode();d=a.getRef?a.getRef():"#"+a.getDataItem().get("id"),e.addClass("galleryDisplayer"),this._displayerDict[d]=a,this._updateDisplayerGeometry(e,c)},_updateDisplayerGeometry:function(a,b){this._setupItem(a),b>=this._displayedItems.length&&a.setStyles({top:"-200%",position:"absolute"})},_onSequencerFinished:function(a){a.elements=a.elements.slice(0,this._displayedItems.length),this.parent(a),this._transitionPending=!1,this.fireEvent("transitionFinished")},gotoNext:function(){this.next()},next:function(){!this._transitionPending&&this._numItems>this._pageItemsCount&&(this._currentItemIndex=this._getNextPageItemIndex(),this._goto(this._nextPageItems,0))},prev:function(){!this._transitionPending&&this._numItems>this._pageItemsCount&&(this._currentItemIndex=this._getPrevPageItemIndex(),this._goto(this._prevPageItems,1))},_getNextPageItemIndex:function(){var a=this._currentItemIndex+this._pageItemsCount;return a>=this._numItems&&(a=0),a},_getPrevPageItemIndex:function(){var a=this._currentItemIndex-this._pageItemsCount;return 0>a&&(a=(this._getTotalPageCount()-1)*this._pageItemsCount),a},_getTotalPageCount:function(){var a=Math.floor(this._numItems/this._pageItemsCount);return this._numItems%this._pageItemsCount>0&&a++,a},_getCounterText:function(a){var b=Math.floor(a/this._pageItemsCount),c=Math.max(this._getTotalPageCount(),1);return String(b+1)+"/"+String(c)},_goto:function(a,b){this._transitionPending=!0,this._resetRollOver();var c=this._translateRefList(this._displayedItems),d=this._translateRefList(a),e=this._transitionUtils.getTransition(this.getComponentProperty("transition"));this._setupAllItems(d),e(c,d,this._numCols,this._numRows,b,parseFloat(this.getComponentProperty("transDuration")),function(){Array.each(c,function(a){a.getLogic?a.getLogic().dispose():a.destroy&&a.destroy()}),this._onTransitionComplete(d)}.bind(this))},_onTransitionComplete:function(){this.render(),this.fireEvent("render")},_updateRollover:function(){if(this._highlightedDisplayer){var a=this._highlightedDisplayer.getCoordinates(this._skinParts.rolloverHolder.getParent());this._skinParts.rolloverHolder.setStyles({visibility:"visible",position:"absolute",padding:0,left:a.left,top:a.top,width:a.width,height:a.height}),this._skinParts.rolloverHolder.uncollapse(),this.setState("idle"),window.requestAnimFrame(function(){if(this._highlightedDisplayer){this._updateDisplayerInfo(this._highlightedDisplayer.getLogic().getDataItem());var a=this._highlightedDisplayer.getLogic().getDataItem();if(a.getType&&"Image"===a.getType()){var b=this.getSkinPart("link");this._linkUtils.linkifyElement(this,b,a,!0)}this.setState("rollover")}}.bind(this))}},_onMouseMove:function(a){if(this._transitionPending!==!0){var b=this._findDisplayerFromPosition(a.page);b&&this._skinParts.rolloverHolder&&this._hasRollOver?this._highlightedDisplayer!==b&&(this._highlightedDisplayer=b,this._updateRollover()):this._resetRollOver()}},_onRollOut:function(a){a.relatedTarget&&!a.relatedTarget.getParents().contains(this._view)&&this._resetRollOver()},_findDisplayerFromPosition:function(a){var b,c=this._skinParts.itemsContainer.getPosition(),d={x:a.x-c.x,y:a.y-c.y},e=Math.floor(d.x/(this._itemWidth+this._gap)),f=Math.floor(d.y/(this._itemHeight+this._gap));if(e>=0&&f>=0){var g=f*this._numCols+e;g<this._galleryItems.length&&(b=this._galleryItems[g])}return b},_findDisplayer:function(a){for(;a;){if(a===this._skinParts.itemsContainer)return null;if(this._galleryItems.contains(a))return a;a=a.getParent()}return null},_updateDisplayerInfo:function(a){if(this._skinParts.rolloverHolder&&this._rolloverSequencer){var b=this._skinParts.rolloverContent||this._skinParts.rolloverHolder;this._rolloverSequencer.createComponents(b,[a])}else a&&a.getData&&"title"in a.getData()&&"description"in a.getData()&&(this._skinParts.title.set("text",a.get("title")),this._skinParts.description.set("text",a.get("description")))},_onRollOverViewCreated:function(a){this._setupItem(a.compView)},_hideRollOverHolder:function(){this.setState("idle"),this._skinParts.rolloverHolder&&this._skinParts.rolloverHolder.collapse()},_resetRollOver:function(){this._hideRollOverHolder(),this._highlightedDisplayer=null},_onClick:function(a){var b;if(a.rightClick===!1&&this.getComponentProperty("expandEnabled")===!0){var c=this._highlightedDisplayer||this._findDisplayer(a.target);if(c&&(b=c.getLogic().getDataItem(),b.get)){var d=b.get("id"),e=this._data.get("items"),f=e.indexOf("#"+d);this.injects().Commands.executeCommand("WViewerCommands.OpenZoom",{itemsList:this._data,currentIndex:f,getDisplayerDivFunction:this.injects().Viewer.getDefaultGetZoomDisplayerFunction("Image"),getHashPartsFunction:function(a,b){this.injects().Data.getDataItem(a,function(a){b({id:a.get("id"),title:a.get("title")})})}.bind(this)})}}},_clearAllItems:function(){this._componentReady&&(this._skinParts.itemsContainer.getChildren().forEach(function(a){a.getLogic?a.getLogic().dispose():a.destroy()}.bind(this)),this._skinParts.itemsContainer.empty())}})}),define.component("wixapps.integration.components.PaginatedGridGallery2",function(a){var b=a;b.utilize(["wixapps.integration.utils.PagingBuffer"]),b.inherits("wixapps.integration.components.ContentFlipper"),b.traits(["wixapps.integration.components.traits.GalleryAutoplayNBC"]),b.binds(["gotoNext","gotoPrev"]),b.states({slideshow:["autoplayOn","autoplayOff"]}),b.skinParts({inlineContent:{type:"htmlElement"},buttonPrev:{type:"htmlElement"},buttonNext:{type:"htmlElement"},counter:{type:"htmlElement",optional:!0},autoplay:{type:"htmlElement",optional:!0},link:{type:"htmlElement",optional:!0},rolloverHolder:{type:"htmlElement",optional:!0}}),b.propertiesSchemaType("PaginatedGridGallery2Properties"),b.fields({_pagination:null,_direction:0,_pagingBuffer:null,_transitionRemap:{horizSwipeAllAtOnce:"swipeHorizontal"},_reRenderProps:["rows","columns"]}),b.methods({initialize:function(a,b,c){this.parent.apply(this,arguments),this._pagination=c.pagination,this._pagingBuffer=new this.imports.PagingBuffer},_insertNewContent:function(){return this.parent().then(function(){return this._pagingBuffer.unlock(),Q.resolve()}.bind(this))
},_onRender:function(a){var b=a.data.invalidations;if(a.data.invalidations.isInvalidated([this.INVALIDATIONS.SIZE])){var c=_.last(a.data.invalidations.getInvalidationByType(this.INVALIDATIONS.SIZE)).current;this._updateInlineContentSize(c)}b.isInvalidated([this.INVALIDATIONS.DATA_CHANGE])&&this._isNonRenderPropertyInvalidated(b)?this._refreshContent().done():this.parent(a)},_isNonRenderPropertyInvalidated:function(a){var b=a.getLastInvalidationByType(this.INVALIDATIONS.DATA_CHANGE);if(b){var c=b.field;return c&&!_.contains(this._reRenderProps,c)}return!0},_setupSkinParts:function(){this.parent(),this.$view.setStyles({position:"relative"}),this._skinParts.buttonNext.on(Constants.CoreEvents.CLICK,this,this.gotoNext),this._skinParts.buttonPrev.on(Constants.CoreEvents.CLICK,this,this.gotoPrev),this._skinParts.buttonNext.setStyles({cursor:"pointer"}),this._skinParts.buttonPrev.setStyles({cursor:"pointer"}),this._skinParts.link&&this._skinParts.link.setStyle("display","none"),this._skinParts.rolloverHolder&&this._skinParts.rolloverHolder.setStyle("position","absolute"),this._checkSkinPartsVisibility()},gotoNext:function(){this._pagingBuffer.lock(function(){this._direction=0,this._pagination.nextPage()}.bind(this))},gotoPrev:function(){this._pagingBuffer.lock(function(){this._direction=1,this._pagination.prevPage()}.bind(this))},_updateDataPagination:function(a){a.setPosition(0,this.getComponentProperty("columns")*this.getComponentProperty("rows"))},_checkSkinPartsVisibility:function(){this._skinParts&&(this._skinParts.buttonPrev.setStyle("visibility",this.getComponentProperty("showNavigation")?"visible":"hidden"),this._skinParts.buttonNext.setStyle("visibility",this.getComponentProperty("showNavigation")?"visible":"hidden"),this._skinParts.counter&&this._skinParts.counter.setStyle("visibility",this.getComponentProperty("showCounter")?"visible":"hidden"))},_updatePageCounter:function(a,b){this._skinParts.counter&&this._skinParts.counter.set("text",a+"/"+b)},_arrangeContent:function(a){var b=this.getComponentProperty("columns"),c=this.getComponentProperty("rows"),d=this.getComponentProperty("gap"),e=this._skin.widthDiff||0,f=this._skin.heightDiff||0;this.getComponentProperty("showNavigation")||this.getComponentProperty("showCounter")||(f=0);var g=Math.floor((this._viewPortSize.width-e-d*(b-1))/b),h=Math.floor((this._viewPortSize.height-f-d*(c-1))/c);_.each(a.childNodes,function(a,c){var e=c%b,f=Math.floor(c/b);a.setStyles({position:"absolute",left:e*g+e*d,top:f*h+f*d,width:g,"min-width":g,height:h}),a.addClass("galleryDisplayer")}.bind(this))},_updateContainerSize:function(a){a.setStyles({width:this._viewPortSize.width,height:this._viewPortSize.height})},getDirection:function(){return this._direction},getDuration:function(){return this.getComponentProperty("transDuration")},getTransitionType:function(){var a=this.getComponentProperty("transition");return this._transitionRemap[a]||a}})}),define.component("wixapps.integration.components.SelectableSliderGallery",function(a){var b=a;b.inherits("wysiwyg.viewer.components.SelectableSliderGallery"),b.methods({setHeight:function(a,b,c,d){this.parent(a,b,c,d),this._sizeDefined&&this._onResizeEnd()},setWidth:function(a,b,c,d){this.parent(a,b,c,d),this._sizeDefined&&this._onResizeEnd()}})}),define.component("wixapps.integration.components.SiteButton",function(a){var b=a;b.inherits("wysiwyg.viewer.components.SiteButton"),b.resources(["W.Utils"]),b.methods({getStyleNameSpace:function(){return this._styleNameSpace||"wysiwyg.viewer.components.SiteButton"},_setSkinPartElements:function(a){if(a.link&&"a"===a.link.tagName.toLowerCase()){var b=new Element("div");if(this.resources.W.Utils.isIE()&&(b.clearAttributes(),b.mergeAttributes(a.link),b.removeAttribute("uid")),a.link.attributes)for(var c=0;c<a.link.attributes.length;c++){var d=a.link.attributes[c];if(d.specified){var e=a.link[d.name],f="function"==typeof e?e:d.value;b.setAttribute(d.name,f)}}for(b.setStyles(a.link.getStyles());a.link.children.length>0;)b.appendChild(a.link.removeChild(a.link.firstChild));b.className=a.link.className,a.link.parentNode.replaceChild(b,a.link),a.link=b}this._validateSkinParts(a),this._skinPartElements=a,this._tryCreatingComponentParts()},_setMinimumWidthAccordingToText:function(){this._skinParts.label.parentNode.setStyle("overflow","hidden")},_renderLink:function(){var a=this.getDataItem(),b=a._data.link;if(b){var c=this.resources.W.Data.getDataByQuery(b);c&&this._linkRenderer.renderLink(this._skinParts.link,c,this)}}})}),define.component("wixapps.integration.components.Toggle",function(a){a.inherits("mobile.core.components.base.BaseComponent"),a.skinParts({on:{type:"htmlElement"},off:{type:"htmlElement"}}),a.binds(["toggle"]),a.states(["on","off"]),a.methods({initialize:function(a,b,c){this.parent(a,b,c),this._createOnHook=c.createOnHook,this._createOffHook=c.createOffHook,this._initialState=c.initialState,this._listensToPartsClick=c.listensToPartsClick},_onAllSkinPartsReady:function(a){this._listensToPartsClick&&(a.on.addEvent("click",this.toggle),a.off.addEvent("click",this.toggle)),this._createOnHook(a.on),this._createOffHook(a.off),this.setState("on"==this._initialState?"on":"off")},turnOn:function(){this.setState("on")},turnOff:function(){this.setState("off")},toggle:function(){"on"==this.getState()?this.turnOff():this.turnOn(),this.fireEvent("wix:toggle",{state:this.getState()})},_onResize:function(){this.parent()}})}),define.component("wixapps.integration.components.VerticalListEditor",function(a){a.inherits("wysiwyg.viewer.components.VerticalRepeater"),a.skinParts({inlineContent:{type:"htmlElement"}}),a.binds(["_sequencingHook","_onItemsUpdated","_startDragChild","_onItemEndDrag","_onItemDrag"]),a.utilize([]),a.methods({initialize:function(a,b,c){this.parent(a,b,c),this._sequencer.addEvent("productionFinished",this._onItemsUpdated),this._dragEnabled=c.dragEnabled,this._dragEventsHandler=c.dragEventHandler||{onDragItemCopyCreated:function(){},disposeDragItemCopy:function(a){a.getLogic().dispose()}},this._maxDragIndex=void 0!==c.maxDragIndex?c.maxDragIndex:-1},render:function(){this._data&&(this._sequencer.createComponents(this._skinParts.inlineContent,this._data.get("items")),this._hideShowContainers())},setDragEnabled:function(a){this._dragEnabled=a},_onItemsUpdated:function(a){if(0!==a.elements.length){this._items=a.elements;for(var b=0;b<this._items.length;b++)this._listenToItem(this._items[b],b)}},_listenToItem:function(a,b){var c=this;a.hasClass("container")||(a.addEvent("click",function(){c.fireEvent("itemClick",{idx:b,element:a,dataItem:c._data.get("items")[b]})}),a.addEvent(Constants.CoreEvents.MOUSE_DOWN,function(d){c._startDragChild(a,b,d)}))},_startDragChild:function(a,b,c){if(this._dragEnabled&&"INPUT"!=c.target.tagName){this._startIdx=b,this._body=this._body||$$("body"),this._basePos=this._view.getPosition().y,this._itemPos=a.getPosition().y;var d=c.client.y+window.getScroll().y;this._deltaY=d-this._itemPos,this._startMousePos=d,this._startedDrag=!1,this._body.addEvent(Constants.CoreEvents.MOUSE_MOVE,this._onItemDrag),this._body.addEvent(Constants.CoreEvents.MOUSE_UP,this._onItemEndDrag),this._body.addClass("blockSelection")}},_doStartDrag:function(){var a=this._data.get("items"),b=this._items[this._startIdx];this._movedItem=b.dispose();var c=a[this._startIdx];this.createFloatingItem(c,a)},createFloatingItem:function(a,b){this._childCopy=this._sequencer.createComponent(this._view,a,this._startIdx,b);var c=this._childCopy.get("comp");if(c)this._childCopy.addEvent(Constants.ComponentEvents.WIXIFIED,function(){this._childCopy.getLogic().setDragged()}.bind(this));else for(var d=this._childCopy.getElements("[comp]"),e=0;e<d.length;e++){var f=d[e];f.addEvent(Constants.ComponentEvents.WIXIFIED,function(){var a=this.getLogic();a.setDragged&&a.setDragged()})}this._childCopy.setStyles({position:"absolute",left:"0px",top:this._itemPos-this._basePos,width:"100%"}),this._view.grab(this._childCopy),this._dragEventsHandler.onDragItemCopyCreated(this._childCopy)},_onItemDrag:function(a){var b=a.client.y+window.getScroll().y,c=3;if(!this._startedDrag&&Math.abs(b-this._startMousePos)>c&&(this._startedDrag=!0,this._doStartDrag()),this._startedDrag){var d=b-this._basePos-this._deltaY+this._view.getScrollTop();this._childCopy.setStyle("top",d);var e=this._getNewItemIndex(a);if(!(e<this._maxDragIndex)){var f=this._items[e];e>this._items.length-1?this._movedItem.inject(this._skinParts.inlineContent):e>-1&&this._movedItem.inject(f,"before"),this._hideShowContainers()}}},_getNewItemIndex:function(a){for(var b,c,d=-1,e=a.client.y+window.getScroll().y,f=0;f<this._items.length-1;f++)if(c=this._items[f].getPosition().y+(this._items[f+1].getPosition().y-this._items[f].getPosition().y)/2,d=f,c>e){b=!0;break}if(!b){var g=this._items.length-1;c=this._items[g].getPosition().y+this._items[g].getSize().y/2,d=c>e?g:g+1}return d},_hideShowContainers:function(){var a=this._skinParts.inlineContent.getElements(".container");Array.each(a,function(a){var b=a.getElement(".container-box"),c=a.getNext();!c||c&&c.hasClass("container")?(b.removeClass("hidden"),a.setStyle("opacity","0.4")):(b.addClass("hidden"),a.setStyle("opacity","1"))})},_onItemEndDrag:function(){if(this._body.removeEvent(Constants.CoreEvents.MOUSE_MOVE,this._onItemDrag),this._body.removeEvent(Constants.CoreEvents.MOUSE_UP,this._onItemEndDrag),this._body.removeClass("blockSelection"),this._startedDrag){var a=this._skinParts.inlineContent.getChildren().indexOf(this._movedItem);this._dragEventsHandler.disposeDragItemCopy(this._childCopy),this.fireEvent("itemMoved",{idx:a,oldIdx:this._startIdx,dataItem:this._data.get("items")[this._startIdx]})}}})}),define.component("wixapps.integration.components.Video",function(a){var b=a;b.inherits("wysiwyg.viewer.components.Video"),b.methods({_renderIframe:function(){this._options.videoType=this._getVideoType(),this._options.videoId=this._getVideoId(),this._options.videoId&&this._options.videoType&&(this._skinParts.videoFrame.uncollapse(),this._skinParts.preview.collapse(),this._iframe&&this._skinParts.videoFrame.hasChildNodes()?this._updateIframe(this._getUrl(),this.getWidth(),this.getHeight()):this._createIframe(this._getUrl(),this.getWidth(),this.getHeight()),this._iframe.setStyles({height:"100%",width:"100%"}))}})}),define.component("wixapps.integration.components.WPhoto",function(a){var b=a;b.inherits("wysiwyg.viewer.components.WPhotoOBC"),b.utilize([]),b.traits([]),b.skinParts({link:{type:"htmlElement"},img:{type:"core.components.image.ImageNew",dataRefField:"*",hookMethod:"_setImageArgs"}}),b.dataTypes(["Image"]),b.propertiesSchemaType("WPhotoProperties"),b.resources(["W.Config","W.Utils"]),b.methods({initialize:function(a,b,c){this.parent(a,b,c),c=c||{},this._showZoom=c.showZoom||!1},getStyleNameSpace:function(){return this._styleNameSpace||"wysiwyg.viewer.components.WPhoto"},_onAllSkinPartsReady:function(){this.parent(),this._skinParts.link.setStyles({"box-sizing":"border-box"})},_setSkinPartElements:function(a){if(a.link&&"a"===a.link.tagName.toLowerCase()){var b=new Element("div");if(this.resources.W.Utils.isIE()&&(b.clearAttributes(),b.mergeAttributes(a.link),b.removeAttribute("uid")),a.link.attributes)for(var c=0;c<a.link.attributes.length;c++){var d=a.link.attributes[c];if(d.specified){var e=a.link[d.name],f="function"==typeof e?e:d.value;b.setAttribute(d.name,f)}}for(b.setStyles(a.link.getStyles());a.link.children.length>0;)b.appendChild(a.link.removeChild(a.link.firstChild));b.className=a.link.className,a.link.parentNode.replaceChild(b,a.link),a.link=b}this._validateSkinParts(a),this._skinPartElements=a,this._tryCreatingComponentParts()},_setImageArgs:function(a){var b=this.parent(a);if(b&&b.argObject&&b.argObject.requestExactSize===!0){var c=this._data&&this._data._data.uri&&this._data._data.uri||"";0===c.indexOf("http://")&&0!==c.indexOf(this.resources.W.Config.getMediaStaticUrl())&&(b.argObject.requestExactSize=!1)}return b},_renderImage:function(){if(this._layoutInitialized&&this._sizeDefined){var a=this._skinParts.img;if(a&&a.getOriginalClassName){var b=this._getImageSettings();a.setSettings(b);var c=a.getSize();if(c&&(b.getCropMode()==b.CropModes.FIT_WIDTH?this.setHeight(c.y+this._getContentPaddingSize().y,!1,!1,!0):b.getCropMode()==b.CropModes.FIT_HEIGHT&&this.setWidth(c.x+this._getContentPaddingSize().x,!1,!1,!0)),this._fireAutoSize(),this._showZoom){if(!a||!a.getOriginalClassName)return;a.setZoom(!0),a.fireEvent("resize",a.isOriginalImageSmallerThanWrapper()),a.setSettings(b)}}}}})}),define.component("wixapps.integration.components.WPhotoSelector",function(a){var b=a;b.utilize(["wixapps.integration.managers.WixAppsLocalizer"]),b.inherits("wixapps.integration.components.WPhoto"),b.traits([]),b.fields({_localizer:null}),b.skinParts({link:{type:"htmlElement"},img:{type:"core.components.image.ImageNew",dataRefField:"*",hookMethod:"_setImageArgs"},overlay:{type:"htmlElement"}}),b.dataTypes(["Image"]),b.propertiesSchemaType("WPhotoProperties"),b.resources(["W.Config"]),b.methods({initialize:function(a,b,c){this.parent(a,b,c),this._localizer=new this.imports.WixAppsLocalizer},_onAllSkinPartsReady:function(){this.parent(),this._skinParts.overlay.set("text",this._data.get("linkText")||this._localizer.localize("IMAGE_SELECTOR_REPLACE_IMAGE"))}})}),define.component("wixapps.integration.components.common.formcontainer.viewer.FormContainer",function(a){var b=a;b.inherits("core.components.Container"),b.utilize(["wixapps.core.utils.WixAppsLogger"]),b.resources(["W.Apps2"]),b.binds(["_retrieveData","_reportError"]),b.states({phase:["content","submitting","success","error"],displayDevice:["desktopView","mobileView"]}),b.dataTypes(["FormContainer"]),b.fields({_formData:null,_formDefinition:null,_dataSelector:null,_forType:null,_submitButton:null}),b.methods({initialize:function(){this.parent.apply(this,arguments),this.on(this.INVALIDATIONS.DATA_CHANGE,this,this._onDataChanged)},_onRender:function(a){var b=this.INVALIDATIONS.FIRST_RENDER;if(a.data.invalidations.isInvalidated([b])){var c=_.find(this.getDescendantComponents(),function(a){return a.$logic&&"wixapps.integration.components.common.submitbutton.viewer.SubmitButton"===a.$logic.$className});c&&(this._submitButton=c.$logic,this._initSubmitEvents()),this._initErrorBox()}},_initErrorBox:function(){this._skinParts.errorDescription.set("text","Something went wrong"),this._skinParts.errorLink.set("text","Please try again"),this._skinParts.x.on(Constants.CoreEvents.CLICK,this,function(){this.setState("content","phase")}),this._skinParts.errorLink.on(Constants.CoreEvents.CLICK,this,this._submitForm)},_submitForm:function(){this._submitButton.submit()},reportDeleteComponentToBI:function(){if(this._formDefinition&&this._appInstance.getInstanceId()){var a={c1:this._appInstance.getInstanceId(),c2:this._formDefinition.getId()};this._logger.reportEvent(this._logger.Events.FORM_DELETED,a)}},addChild:function(a){this.parent(a),"wixapps.integration.components.common.minipart.viewer.MiniPart"===a.$className&&this.trigger(Constants.WixAppEvents.FIELD_ADDED,a)},getFieldsComponents:function(){return _(this.getDescendantComponents()).map("$logic").filter(function(a){return a&&"wixapps.integration.components.common.minipart.viewer.MiniPart"===a.$className}).value()},getFieldComponent:function(a){return _.find(this.getFieldsComponents(),function(b){return b.getDataItem().get("field")===a})},getFriendlyName:function(){return this._formDefinition&&this._formDefinition.getDisplayName()||""},getAppInstance:function(){return this._appInstance},getFormData:function(){return this._formData},getFormDefinition:function(){return this._formDefinition},setAppPartDefinition:function(a){this._formDefinition=a},getUniqueFieldName:function(a,b){return this.getAppInstance().getTypesManager().getUniqueFieldName(this._forType,a,b)},getDataSelector:function(){return this._dataSelector},getType:function(){return this._forType},_onDataChanged:function(){this.resources.W.Apps2.getApplicationInstance(this._data.get("appInnerID"),function(a){this._initForm(a)}.bind(this))},_initForm:function(a){this._appInstance=a,this._logger=a.getLogger();var b=a.getFormDefinitions(),c=a.getDataSelectors(),d=this._data.get("formId");if(!b.exists(d))return this._logger.reportEvent(this.imports.WixAppsLogger.Events.FORM_FAILED_TO_LOAD_DEFINITION,{c1:d}),void 0;this._formDefinition=b.getById(d);var e=this._formDefinition.getDataSelectorId();return c.exists(e)?(this._dataSelector=c.getById(e),this._dataSelector.isListSelector()?(this._logger.reportEvent(this.imports.WixAppsLogger.Events.FORM_LOADED_WITH_INVALID_SELECTOR,{c1:e}),void 0):(this._forType=this._formDefinition.getType(),this.resources.W.Commands.executeCommand("ApplicationPerformanceSpy.logPhase2",{step:"requesting items from server",appPart:this}),this._dataSelector.getData(this._retrieveData,this._reportError),this._formDefinition.setUsed(!0),void 0)):(this._logger.reportEvent(this.imports.WixAppsLogger.Events.FORM_FAILED_TO_LOAD_DATA_SELECTOR,{c1:e}),void 0)},_initSubmitEvents:function(){var a=this._submitButton.Events.SUBMIT;this._submitButton.on(a.START,this,function(){this.setState("submitting","phase"),this._submitButton.disable()}),this._submitButton.on(a.SUCCESS,this,function(){this.setState("success","phase"),setTimeout(function(){this._dataSelector.resetItem(),this._submitButton.enable(),this.setState("content","phase")}.bind(this),1e3)}),this._submitButton.on(a.FAILED,this,function(){this.setState("error","phase")})},_retrieveData:function(a){this._isExterminated||(this.setState("content","phase"),this._reportLoaded(),this._formData=a)},_reportLoaded:function(){if(this.resources.W.Config.env.$isPublicViewerFrame){var a={c1:this._appInstance.getInstanceId(),c2:this._formDefinition.getId(),g2:rendererModel&&rendererModel.userId};this._logger.reportEvent(this._logger.Events.FORM_LOADED,a)}},_reportError:function(a){if(this.resources.W.Config.env.$isPublicViewerFrame){var b={c1:this._appInstance.getInstanceId(),c2:this._formDefinition.getId(),g2:rendererModel&&rendererModel.userId,i1:JSON.stringify(a)};this._logger.reportEvent(this._logger.Events.FORM_ERROR,b)}},exterminate:function(){this._isExterminated||(this._appInstance=null,this._formDefinition.setUsed(!1),this._formDefinition=null,this._dataSelector=null,this._formData=null),this.parent()}})}),define.dataSchema("FormContainer",{appInnerID:"string",formId:"string"}),define.resource("formcontainerSkinMap",{"wixapps.integration.components.common.formcontainer.viewer.skins.FormContainerSkin":{description:"Arrow",iconUrl:"images/wysiwyg/skinIcons/verticalmenu/ribbon.jpg",hidden:!0,index:6}}),define.skin("wixapps.integration.components.common.formcontainer.viewer.skins.FormContainerSkin",function(a){var b=a;b.inherits("core.managers.skin.BaseSkin2"),b.iconParams({description:"Arrow",iconUrl:"images/wysiwyg/skinIcons/verticalmenu/ribbon.jpg",hidden:!0,index:6}),b.skinParams([{id:"bg",type:Constants.SkinParamTypes.BG_COLOR,defaultTheme:"color_11"},{id:"brd",type:Constants.SkinParamTypes.COLOR_ALPHA,defaultTheme:"color_15"},{id:"brw",type:Constants.SkinParamTypes.SIZE,defaultValue:"1px"},{id:"rd",type:Constants.SkinParamTypes.BORDER_RADIUS,defaultValue:"5px"},{id:"prd",type:Constants.SkinParamTypes.BORDER_RADIUS,defaultValue:"4px"},{id:"shd",type:Constants.SkinParamTypes.BOX_SHADOW,defaultValue:"0 1px 4px rgba(0, 0, 0, 0.6);"},{id:"pshd",type:Constants.SkinParamTypes.BOX_SHADOW,defaultValue:"0 1px 6px rgb(0, 0, 0);"},{id:"pos",type:Constants.SkinParamTypes.OTHER,defaultValue:"position:absolute; top:0; bottom:0; left:0; right:0;"},{id:"tdr",type:Constants.SkinParamTypes.URL,defaultTheme:"WEB_THEME_DIRECTORY"}]),b.html('<div skinPart="bg"></div><div skinPart="inlineContent"></div><div skinPart="blockingLayer"><div skinPart="progress"></div><div skinPart="error"><div skinPart="errorImage"></div><div skinPart="errorText"><div skinPart="errorDescription"></div><div skinPart="errorLink"></div></div><div skinPart="x"></div></div></div>'),b.css(["%bg% {border:[brw] solid [brd];[pos][bg][rd][shd] }","%inlineContent% { [pos] }","%blockingLayer% { [pos] background-color: rgba(255, 255, 255, 0.5); display: none; }","%progress% { [pos] [prd] [pshd] background-color: #fff; margin: auto; background-image: url([tdr]forms/submitting-sprite.gif); background-repeat: no-repeat; height:40px; width:40px; }","%error% { [pos] [prd] [pshd] background-color: #fff; margin: auto; height:88px; width:230px; }","[state~=submitting] %inlineContent% { pointer-events:none; }","[state~=submitting] %blockingLayer% { display: block; }","[state~=submitting] %error% { display: none; }","[state~=error] %progress% { display: none; }","[state~=error] %blockingLayer% { display: block; }","[state~=error] %error% { display: block; }","[state~=error] %inlineContent% { pointer-events:none; }","[state~=success] %progress% { background-position-x: -40px; }","[state~=success] %blockingLayer% { display: block; }","[state~=success] %error% { display: none; }","[state~=success] %inlineContent% { pointer-events:none; }","%errorImage% { position: absolute; top: 32px; left: 20px; background-image: url([tdr]forms/error.png); background-repeat: no-repeat; height: 29px; width: 29px; }",'%errorText% { position: absolute; top: 32px; left: 57px; font-family: "Helvetica Neue", "HelveticaNeueW01-55Roma", "HelveticaNeueW02-55Roma", "HelveticaNeueW10-55Roma", Helvetica, Arial, sans-serif; font-size: 13px; }',"%errorLink% { color: #0099ff; cursor: pointer; }","%x% { position: absolute; top: 10px; right: 10px; cursor: pointer; background-image: url([tdr]/x.png); background-repeat: no-repeat; width: 10px; height: 10px; }"])}),define.component("wixapps.integration.components.common.minipart.viewer.MiniPart",function(a){var b=a;b.inherits("core.components.base.BaseComp"),b.resources(["W.Apps2"]),b.binds(["_retrieveData","_reportError"]),b.utilize(["wixapps.integration.managers.ViewHolder"]),b.states({phase:["loading","error","content"]}),b.dataTypes(["MiniPart"]),b.fields({_formData:null,_partDefinition:null,_dataSelector:null,_forType:null,_logger:null,_viewHolder:null}),b.methods({initialize:function(){this.parent.apply(this,arguments),this.on(this.INVALIDATIONS.DATA_CHANGE,this,this._onDataChanged)},getAppInstance:function(){return this._appInstance},getShowOnAllPagesChangeability:function(){return!1},getFormData:function(){return this._formData},getMiniPartDefinition:function(){return this._partDefinition},setMiniPartDefinition:function(a){this._partDefinition=a},getDataSelector:function(){return this._dataSelector},getType:function(){return this._forType},_getMinPhysicalHeight:function(){if(this._viewHolder){var a=this._viewHolder.getRootProxy();if(a&&a.getElement())return a.getElement().getSize().y}return parseInt(this._view.get("height")||0,10)},_onDataChanged:function(){this.resources.W.Apps2.getApplicationInstance(this._data.get("appInnerID"),function(a){var b=a.getViewDefinitions(),c=a.getDataItemFactory(),d=a.getTypesManager();this._viewHolder=new this.imports.ViewHolder(c,d,b,a.resolveResourcePath,"",!0,this),this._viewHolder.getEventDispatcher().addEvent(Constants.WixAppEvents.APP_VIEW_CREATED,function(){this.setState("content"),this.setHeight(this._getMinPhysicalHeight(),!1,!1)}.bind(this)),this._initPart(a)}.bind(this))},_onRender:function(a){var b=a.data.invalidations;b.isInvalidated([this.INVALIDATIONS.FIRST_RENDER])&&(this._viewHolder.setContainer(this._skinParts.inlineContent),this._formData&&this._viewHolder.setupViewHolder(this._formData,this._viewName,this._formatName))},_initPart:function(a){this._appInstance=a,this._logger=a.getLogger();var b=a.getMiniPartDefinitions(),c=a.getFormDefinitions(),d=a.getDataSelectors(),e=this._data.get("partId");if(b.exists(e)){this._miniPartDefinition=b.getById(e);var f=this._miniPartDefinition.getFormId();c.exists(f)&&(this._formDefinition=c.getById(f),this._dataSelector=d.getById(this._formDefinition.getDataSelectorId()),this._dataSelector.isListSelector()||(this._forType=this._formDefinition.getType(),this._viewName=this._miniPartDefinition.getViewName(),this._formatName=this._isDeviceMobile?"Mobile":"",this._dataSelector.getData(this._retrieveData,this._reportError)))}},_retrieveData:function(a){this._isExterminated||(this._formData=a,this._viewHolder.getRootProxy()||this._viewHolder.setupViewHolder(this._formData,this._viewName,this._formatName,null))},updateVars:function(a){var b=this._viewHolder.getRootProxy();if(b){var c=b.getViewContext().getEnvironment();_.each(a,function(a,b){c.setVar(b,a)})}},getVars:function(){var a=this._viewHolder.getRootProxy();if(a){var b=a.getViewContext().getEnvironment();return b.getVars()}return{}},_reportError:function(a){if(this.resources.W.Config.env.$isPublicViewerFrame){var b={c1:this._appInstance.getInstanceId(),c2:this._formDefinition.getId(),g2:rendererModel&&rendererModel.userId,i1:JSON.stringify(a)};this._logger.reportEvent(this._logger.Events.FORM_ERROR,b)}},exterminate:function(){this._isExterminated||(this._appInstance=null,this._formDefinition.setUsed(!1),this._formDefinition=null,this._dataSelector=null,this._formData=null),this.parent()}})}),define.dataSchema("MiniPart",{appInnerID:"string",partId:"string",field:"string"}),define.resource("minipartSkinMap",{"wixapps.integration.components.common.minipart.viewer.skins.MiniPartSkin":{}}),define.skin("wixapps.integration.components.common.minipart.viewer.skins.MiniPartSkin",function(a){var b=a;b.inherits("core.managers.skin.BaseSkin2"),b.skinParams([{id:"bg",type:Constants.SkinParamTypes.BG_COLOR,mutators:["alpha",25],defaultValue:"#000"},{id:"rd",type:Constants.SkinParamTypes.BORDER_RADIUS,defaultValue:"7px"},{id:"pos",type:Constants.SkinParamTypes.OTHER,defaultValue:"position:absolute; top:0; right:0; bottom:0; left:0; "},{id:"videoThumbBg",type:Constants.SkinParamTypes.BG_COLOR,mutators:["alpha",40],defaultValue:"#000",noshow:!0},{id:"videoThumbColor",type:Constants.SkinParamTypes.COLOR_ALPHA,mutators:["alpha",70],defaultValue:"#FFFFFF",noshow:!0},{id:"videoThumbCorners",type:Constants.SkinParamTypes.BORDER_RADIUS,defaultValue:"7px",noshow:!0},{id:"themeDir",type:"themeUrl",defaultTheme:"THEME_DIRECTORY",name:""}]),b.html('<div skinPart="inlineContent"></div><div skinPart="error">An error has occurred</div><div skinPart="loading"><p></p></div>'),b.css(['[state~="content"] %error% { display:none;}','[state~="content"] %loading% { display:none;}','[state~="error"] %inlineContent% { display:none;}','[state~="error"] %loading% { display:none;}','[state~="loading"] %loading% { [pos] [bg]  }','[state~="rendering"] %loading% { [pos] [bg]  }','[state~="loading"] %loading% p { color:#fff; font-size:16px; font-weight:bold; text-align:center; line-height:50px; letter-spacing:1px; height:100px; width:200px; position:absolute; top:50%; margin-top:-50px; left:50%; margin-left:-100px; [rd]background:transparent url([themeDir]wixapps_preloader.gif) center 42px no-repeat }','[state~="loading"] %error% { display:none;}','[state~="rendering"] %inlineContent%  { opacity: 0;}','[state~="rendering"] %error% { display: none;}','[state~="rendering"] %loading% p { display: none;}','[state~="content"] %inlineContent% { opacity: 1;}',"%inlineContent% > div { width: 100%; }"," .singleLine { white-space:nowrap; display:block; overflow:hidden; text-overflow:ellipsis; word-wrap:normal; }",' .videoIndicator > div:before {content:""; position:absolute; top:50%; left:50%; margin-top:-15px; margin-left:-20px; width:40px; height:30px;[videoThumbBg][videoThumbCorners]  }',' .videoIndicator > div:after {content:""; position:absolute; top:50%; left:50%; width:0; height:0; margin-top:-10px; margin-left:-9px; border:10px solid transparent; border-left:18px solid [videoThumbColor] }'," a.wixAppsLink img {cursor: pointer;}","[state~=shrink0] * { flex-shrink: 0; }"])}),define.component("wixapps.integration.components.common.submitbutton.viewer.SubmitButton",function(a){var b=a;b.inherits("wysiwyg.viewer.components.SiteButton"),b.dataTypes(["SubmitButton"]),b.propertiesSchemaType("ButtonProperties"),b.binds(["_retrieveData","_reportError"]),b.resources(["W.Viewer","W.Apps2","W.Commands"]),b.statics({Events:{SUBMIT:{START:"submit-start",SUCCESS:"submit-success",FAILED:"submit-failed"}}}),b.fields({_appInstance:null,_dataSelector:null,_appData:null}),b.methods({_onAllSkinPartsReady:function(a){this.parent(a),this.resources.W.Apps2.getApplicationInstance(this._data.get("appInnerID"),function(a){this._appInstance=a;var b=a.getFormDefinitions().getById(this._data.get("formId"));this._dataSelector=a.getDataSelectors().getById(b.getDataSelectorId()),this._dataSelector.getData(this._retrieveData,this._reportError)}.bind(this))},_reportError:function(){},_retrieveData:function(a){this._isExterminated||(this._appData=a)},submit:function(){var a=this,b=this._appData.getValue();this.trigger(this.Events.SUBMIT.START),this.resources.W.Commands.executeCommand("WApps2Commands.AddNewDataItem",{comp:this,compId:this._data.get("formId"),rawData:b,onDataItemAdded:function(){a.trigger(a.Events.SUBMIT.SUCCESS)},onError:function(){a.trigger(a.Events.SUBMIT.FAILED)}})},_onClick:function(a){this.parent(a),this.submit()},getDataSelector:function(){return this._dataSelector},getAppInstance:function(){return this._appInstance}})}),define.dataSchema("SubmitButton",{"extends":"LinkableButton",label:{type:"string","default":"Submit"},appInnerID:"string",formId:"string"}),define.resource("submitbuttonSkinMap",{"wysiwyg.viewer.skins.button.BasicButton":{}}),define.component("wixapps.integration.components.dialogs.MessageDialog",function(a){var b=a;b.inherits("core.editor.components.dialogs.MessageDialog"),b.skinParts({text:{type:"htmlElement"},details:{type:"htmlElement"},isDontShowAgain:{type:"htmlElement"},isDontShowAgainCont:{type:"htmlElement"}}),b.resources(["W.Resources","W.AppsEditor2"]),b.methods({initialize:function(a,b,c){this._dontShowAgainKey=c.dontShowAgainKey,this.parent(a,b,c)},_onAllSkinPartsReady:function(a){this.parent(a),this._skinParts.isDontShowAgainCont.appendText(this.resources.W.Resources.get("EDITOR_LANGUAGE","DONT_SHOW_AGAIN"))},_onDialogClosing:function(a){if(this._skinParts.isDontShowAgain.checked){var b=this.resources.W.AppsEditor2.getUserExperienceKeyHandler();b.setItem(this._dontShowAgainKey,!0)}this.parent(a)}})}),define.component("wixapps.integration.components.inputs.BUISelector",function(a){var b=a;b.inherits("wysiwyg.editor.components.inputs.BaseInput"),b.traits(["wysiwyg.editor.components.traits.BindValueToData"]),b.binds([]),b.skinParts({bold:{type:"wysiwyg.editor.components.inputs.CheckBoxImage",argObject:{}},underline:{type:"wysiwyg.editor.components.inputs.CheckBoxImage",argObject:{}},italic:{type:"wysiwyg.editor.components.inputs.CheckBoxImage",argObject:{}}}),b.states({label:["hasLabel","noLabel"]}),b.methods({initialize:function(a,b,c){this.parent(a,b,c),c=c||{},this._value=c.value||{bold:!1,underline:!1,italic:!1}},render:function(){},_onAllSkinPartsReady:function(){this.parent(),this.isEnabled()?(this._skinParts.bold.enable(),this._skinParts.underline.enable(),this._skinParts.italic.enable()):(this._skinParts.bold.disable(),this._skinParts.underline.disable(),this._skinParts.italic.disable()),this._skinParts.bold.setBackground("icons/font/fonts_bold.png",null,{w:27,h:33}),this._skinParts.underline.setBackground("icons/font/fonts_underline.png",null,{w:27,h:33}),this._skinParts.italic.setBackground("icons/font/fonts_italic.png",null,{w:27,h:33})},setValue:function(a){this._value=a,this._skinParts.bold.setValue(this._value.bold),this._skinParts.underline.setValue(this._value.underline),this._skinParts.italic.setValue(this._value.italic)},getValue:function(){return this._value.bold=this._skinParts.bold.getValue(),this._value.underline=this._skinParts.underline.getValue(),this._value.italic=this._skinParts.italic.getValue(),this._value},_onEnabled:function(){this.parent(),this._skinParts.bold.enable(),this._skinParts.underline.enable(),this._skinParts.italic.enable()
},_onDisabled:function(){this.parent(),this.isReady()&&(this._skinParts.bold.disable(),this._skinParts.underline.disable(),this._skinParts.italic.disable())},_changeEventHandler:function(a){var b=this.getValue(),c={value:b,origEvent:a,compLogic:this};this.fireEvent("inputChanged",c)},_listenToInput:function(){this._skinParts.bold.addEvent("inputChanged",this._changeEventHandler),this._skinParts.underline.addEvent("inputChanged",this._changeEventHandler),this._skinParts.italic.addEvent("inputChanged",this._changeEventHandler)},_stopListeningToInput:function(){this._skinParts.bold.removeEvent("inputChanged",this._changeEventHandler),this._skinParts.underline.removeEvent("inputChanged",this._changeEventHandler),this._skinParts.italic.removeEvent("inputChanged",this._changeEventHandler)}})}),define.component("wixapps.integration.components.inputs.CheckBoxGroupInput",function(a){var b=a;b.inherits("mobile.core.components.base.BaseComponent"),b.traits(["wysiwyg.viewer.components.traits.ValidationSettings"]),b.binds(["_handleSingleCheckboxClick"]),b.skinParts({collection:{type:Constants.ComponentPartTypes.HTML_ELEMENT},errorMessage:{type:Constants.ComponentPartTypes.HTML_ELEMENT,optional:"true"}}),b.dataTypes(["MultiSelectableList"]),b.states({validity:["valid","invalid"]}),b.fields({}),b.methods({initialize:function(a,b,c){this.parent(a,b,c),this.addEvent(this.VALID_STATE_CHANGED_EVENT,function(a){this.setState(a?"valid":"invalid","validity")}.bind(this)),this._checkboxGroupName=c.checkboxGroupName||"cbGroup"},_onAllSkinPartsReady:function(){this._createCheckboxGroup()},_createCheckboxGroup:function(){var a=function(a){this._optionsData=Object.values(a),this._bindCheckboxGroupToData(this._skinParts.collection)}.bind(this);this._selectedOptions=this.getDataItem().get("selected");var b=this.getDataItem().get("items").filter(function(a){return a.get("enabled")});b.length>0&&"string"==typeof b[0]?this.injects().Data.getDataByQueryList(b,a):a(b)},_bindCheckboxGroupToData:function(a){a.empty();for(var b=0;b<this._optionsData.length;b++){var c=this._optionsData[b],d=c.get("value"),e=new Element("Input",{type:"checkbox",name:this._checkboxGroupName,value:d,idInData:b});a.grab(e,"bottom"),a.addEvent("click",this._handleSingleCheckboxClick),a.innerHTML+=c.get("text")+"<BR/>"}this._setSelected(a)},_setSelected:function(a){var b=this.getDataItem().get("selected"),c=a.getElements('input[name="'+this._checkboxGroupName+'"]');b&&Array.each(b,function(a){var b=this._optionsData.indexOf(a);b>-1&&b<c.length&&c[b].set("checked","checked")}.bind(this))},_handleSingleCheckboxClick:function(a){var b=a.target,c=this.getDataItem().get("selected"),d=b.getAttribute("idInData"),e=this._optionsData[d];b.checked?c.push(e):c.erase(e),this.getDataItem().set("selected",c),this.getDataItem().fireDataChangeEvent("selected",c),this.fireEvent("selectionChanged",e)},setError:function(a){this.setValidationState(!1),this._skinParts.errorMessage&&this._skinParts.errorMessage.set("text",a)}})}),define.dataSchema("DateInputProperties",{allowEmpty:{type:"boolean","default":!0,description:"If set to false will not have empty options in the combo-boxes and the default value will be set to the current date."}}),define.component("wixapps.integration.components.inputs.DateInput",function(a){var b=a;b.inherits("mobile.core.components.base.BaseComponent"),b.utilize([]),b.traits([]),b.binds(["_userChange"]),b.skinParts({year:{type:Constants.ComponentPartTypes.HTML_ELEMENT},month:{type:Constants.ComponentPartTypes.HTML_ELEMENT},day:{type:Constants.ComponentPartTypes.HTML_ELEMENT}}),b.states({validation:["invalid"],allowEmpty:["allowEmpty","hideEmpty"]}),b.dataTypes(["Text"]),b.propertiesSchemaType("DateInputProperties"),b.fields({_invalidDateString:"Invalid Date",_emptyYearText:"YYYY",_emptyMonthText:"MM",_emptyDayText:"DD"}),b.methods({initialize:function(a,b,c){this.parent(a,b,c)},showValidationMessage:function(a){this.setState("invalid","validation"),this._skinParts.message&&this._skinParts.message.set("text",a)},resetInvalidState:function(){this.removeState("invalid","validation"),this._skinParts.message&&this._skinParts.message.set("text","")},_onAllSkinPartsReady:function(){if(this._skinParts.year.addEvent(Constants.CoreEvents.CHANGE,this._userChange),this._skinParts.month.addEvent(Constants.CoreEvents.CHANGE,this._userChange),this._skinParts.day.addEvent(Constants.CoreEvents.CHANGE,this._userChange),this._allowEmpty()){var a=new Option(this._emptyYearText,this._emptyYearText);a.addClass("empty"),this._skinParts.year.options.add(a),a=new Option(this._emptyMonthText,this._emptyMonthText),a.addClass("empty"),this._skinParts.month.options.add(a)}var b,c=(new Date).getFullYear();for(b=new Date(0).getFullYear()+20;c+10>b;b++)this._skinParts.year.options.add(new Option(b,b));for(b=1;12>=b;b++)this._skinParts.month.options.add(new Option(b,b))},render:function(){var a,b,c=this._data.get("text"),d=new Date(c),e=d.getFullYear(),f=d.getMonth()+1,g=d.getDate(),h=this._allowEmpty();if(this.setState(h?"allowEmpty":"hideEmpty","allowEmpty"),h){if(d.toString()==this._invalidDateString){if(0===this._skinParts.day.options.length){for(b=new Option(this._emptyDayText,this._emptyDayText),b.addClass("empty"),this._skinParts.day.options.add(b),a=1;a<this._getDaysForMonth(e,f)+1;a++)this._skinParts.day.options.add(new Option(a,a));this._setSelectedValue(this._skinParts.day,this._emptyDayText)}return}if(0===d.getTime()){this._skinParts.day.innerHTML="",b=new Option(this._emptyDayText,this._emptyDayText),b.addClass("empty"),this._skinParts.day.options.add(b);var i=this._getDaysForMonth(e,f);for(a=1;i>=a;a++)this._skinParts.day.options.add(new Option(a,a));return this._setSelectedValue(this._skinParts.year,this._emptyYearText),this._setSelectedValue(this._skinParts.month,this._emptyMonthText),this._setSelectedValue(this._skinParts.day,this._emptyDayText),void 0}}for(this._skinParts.day.innerHTML="",a=1;a<this._getDaysForMonth(e,f)+1;a++)this._skinParts.day.options.add(new Option(a,a));this._setSelectedValue(this._skinParts.year,e),this._setSelectedValue(this._skinParts.month,f),this._setSelectedValue(this._skinParts.day,g)},_setSelectedValue:function(a,b){var c=Array.from(a.options).filter(function(a){return a.value==b});c.length&&(c[0].selected=!0)},_isValidDate:function(){return this._skinParts.year.getSelected()[0].value!=this._emptyYearText&&this._skinParts.month.getSelected()[0].value!=this._emptyMonthText&&this._skinParts.day.getSelected()[0].value!=this._emptyDayText},_isEmptyDate:function(){return this._skinParts.year.getSelected()[0].value==this._emptyYearText&&this._skinParts.month.getSelected()[0].value==this._emptyMonthText&&this._skinParts.day.getSelected()[0].value==this._emptyDayText},_userChange:function(){var a=new Date(0);if(a.setHours(12),this._isEmptyDate())this.getDataItem().set("text",a.toISOString()),this.fireEvent("selectionChanged",a.toISOString());else if(this._isValidDate()){var b=this._skinParts.year.getSelected()[0].value,c=this._skinParts.month.getSelected()[0].value,d=this._skinParts.day.getSelected()[0].value;a.setFullYear(b);var e=this._getDaysForMonth(b,c);a.setDate(d>e?e:d),a.setMonth(c-1),this.getDataItem().set("text",a.toISOString()),this.fireEvent("selectionChanged",a.toISOString())}else this.getDataItem().set("text",this._invalidDateString),this.fireEvent("selectionChanged",this._invalidDateString)},_allowEmpty:function(){return this.getComponentProperty("allowEmpty")===!0||"true"===this.getComponentProperty("allowEmpty")},_getDaysForMonth:function(a,b){return a=a||(new Date).getFullYear(),new Date(a,b,0).getDate()}})}),define.component("wixapps.integration.components.inputs.ErasableTextInput",function(a){var b=a;b.inherits("wixapps.integration.components.inputs.TextInput"),b.binds(["_onEraseButtonClick","_onInputFieldMouseUp"]),b.states({erase:["showButton","hideButton"],label:["hasLabel","noLabel"],validation:["invalid"]}),b.skinParts({label:{type:"htmlElement"},input:{type:"htmlElement"},erase:{type:"htmlElement"},message:{type:"htmlElement"}}),b.methods({render:function(){this.setErase(),this.parent()},_onAllSkinPartsReady:function(){this.parent(),this._bindSkinPartsEvents()},_bindSkinPartsEvents:function(){this._skinParts.erase.addEvent(Constants.CoreEvents.CLICK,this._onEraseButtonClick),this._skinParts.input.addEvent(Constants.CoreEvents.MOUSE_UP,this._onInputFieldMouseUp)},_unbindSkinPartsEvents:function(){this._skinParts.erase.removeEvent(Constants.CoreEvents.CLICK,this._onEraseButtonClick),this._skinParts.input.removeEvent(Constants.CoreEvents.MOUSE_UP,this._onInputFieldMouseUp)},_onInputFieldMouseUp:function(){this._isMSIE()&&window.setTimeout(function(){var a=this._skinParts.input.value;a||this._onEraseButtonClick()}.bind(this),100)},_onEraseButtonClick:function(){this.setValue(""),this.getDataItem().set("text",""),this.setErase(),this.resetInvalidState()},setErase:function(){if(!this._handleMSIEEraseState()){var a=this._skinParts.input.value;a?this.setState("showButton","erase"):this.setState("hideButton","erase")}},_handleMSIEEraseState:function(){return this._isMSIE()?(this.setState("hideButton","erase"),!0):!1},_isMSIE:function(){return navigator.userAgent&&-1!=navigator.userAgent.toLowerCase().indexOf("msie")},dispose:function(){this._unbindSkinPartsEvents(),this.parent()}})}),define.component("wixapps.integration.components.inputs.InlineTextInput",function(a){var b=a;b.inherits("mobile.core.components.base.BaseComponent"),b.utilize([]),b.traits([]),b.binds(["_onPreviewClicked","_onInputBlur","_onKeyUp"]),b.skinParts({preview:{type:"htmlElement"},input:{type:"htmlElement"}}),b.states(["preview","input"]),b.dataTypes(["Text"]),b.fields({}),b.methods({render:function(){this.setState("preview");var a=this.getDataItem().get("text");this._skinParts.preview.set("text",a),this._skinParts.input.set("value",a)},_onAllSkinPartsReady:function(){this._listenToInput()},getValue:function(){return this._skinParts.preview.get("text")},_onPreviewClicked:function(){this._skinParts.input.set("value",this.getValue()),this.setState("input"),this._skinParts.input.select()},_onKeyUp:function(a){a=a||window.event,13==a.code&&this._onInputCaptureDone(a)},_onInputBlur:function(a){this._onInputCaptureDone(a)},_onInputCaptureDone:function(a){var b=this.getValue(),c=this._skinParts.input.get("value");if(c&&c!==b){this._skinParts.preview.set("text",c),this._data.set("text",c);var d={value:c,origEvent:a,compLogic:this};this.fireEvent("inputChanged",d)}this.setState("preview")},_listenToInput:function(){this._skinParts.preview.addEvent(Constants.CoreEvents.CLICK,this._onPreviewClicked),this._skinParts.input.addEvent(Constants.CoreEvents.KEY_UP,this._onKeyUp),this._skinParts.input.addEvent(Constants.CoreEvents.BLUR,this._onInputBlur)},_stopListeningToInput:function(){this._skinParts.preview.removeEvent(Constants.CoreEvents.CLICK,this._onPreviewClicked),this._skinParts.input.removeEvent(Constants.CoreEvents.KEY_UP,this._onKeyUp),this._skinParts.input.removeEvent(Constants.CoreEvents.BLUR,this._onInputBlur)},dispose:function(){this._stopListeningToInput(),this.parent()}})}),define.component("wixapps.integration.components.inputs.LocationSelector",function(a){var b=a;b.inherits("mobile.core.components.base.BaseComponent"),b.utilize([]),b.traits([]),b.binds(["_handleSearch","_handleAddressKeyDown"]),b.skinParts({address:{type:Constants.ComponentPartTypes.HTML_ELEMENT},viewMode:{type:Constants.ComponentPartTypes.HTML_ELEMENT},message:{type:Constants.ComponentPartTypes.HTML_ELEMENT}}),b.states({validation:["invalid"],viewMode:["loading","error","found","search"]}),b.dataTypes(["GeoMap"]),b.propertiesSchemaType("GoogleMapProperties"),b.fields({API_KEY:"AIzaSyCWeeateTaYGqsHhNcmoDfT7Us-vLDZVPs",geocoder:null}),b.methods({initialize:function(a,b,c){this.parent(a,b,c),this.setState("search","viewMode")},showValidationMessage:function(a){this.setState("invalid","validation"),this._skinParts.message&&(this._skinParts.message.set("text",a),this._skinParts.message.uncollapse())},resetInvalidState:function(){this.removeState("invalid","validation"),this._skinParts.message&&(this._skinParts.message.set("text",""),this._skinParts.message.collapse())},render:function(){var a=this.getDataItem().get("address");this._skinParts.address.value=a},_onAllSkinPartsReady:function(){this._skinParts.address.addEvent(Constants.CoreEvents.KEY_DOWN,this._handleAddressKeyDown),this._skinParts.address.addEvent(Constants.CoreEvents.BLUR,this._handleSearch),this._skinParts.viewMode.addEvent(Constants.CoreEvents.CLICK,this._handleSearch)},_handleAddressKeyDown:function(a){if(13==a.code)a.stop(),this._getGeoLocationFromAddress(this._skinParts.address.value);else{var b=this.getDataItem();b.set("latitude",-1970,!0),b.set("longitude",-1970,!0),this.setState("search","viewMode")}},_handleSearch:function(){"search"===this.getState("viewMode")&&this._getGeoLocationFromAddress(this._skinParts.address.value)},_getGeoLocationFromAddress:function(a){if(this.setState("loading","viewMode"),null===this.geocoder){var b=new Request.JSONP({url:"http://maps.googleapis.com/maps/api/js?key="+this.API_KEY+"&sensor=true",onComplete:function(){var b=window.google;this.geocoder=new b.maps.Geocoder,this._getGeoLocationFromAddress(a)}.bind(this)});return b.send(),void 0}var c=this.getDataItem();return 0===a.trim().length?(this.resetInvalidState(),c.set("latitude",1970,!0),c.set("longitude",1970,!0),c.set("address","",!0),c.fireDataChangeEvent(),this.setState("search","viewMode"),void 0):(this.geocoder.geocode({address:a},function(b,c){var d=this.getDataItem(),e=window.google;if(c==e.maps.GeocoderStatus.OK){this.resetInvalidState();var f=b[0].geometry.location;d.set("latitude",f.lat(),!0),d.set("longitude",f.lng(),!0),d.set("address",b[0].formatted_address,!0),d.fireDataChangeEvent(),this.setState("found","viewMode")}else this.showValidationMessage("We couldn't find this address, enter another one or leave it empty"),d.set("address",a,!0),d.set("latitude",-1970,!0),d.set("longitude",-1970,!0),d.fireDataChangeEvent(),this.setState("error","viewMode")}.bind(this)),void 0)}})}),define.component("wixapps.integration.components.inputs.SelectOptionsList",function(a){var b=a;b.inherits("wysiwyg.common.components.inputs.OptionsListInput"),b.resources(["W.Utils"]),b.skinParts({itemsContainer:{type:"htmlElement"},tooltip:{type:"htmlElement"}}),b.states({validity:["valid","invalid"],tooltip:["displayed","hidden"]}),b.fields({_selectedItem:null,_numOfTimerCalls:0}),b.methods({initialize:function(a,b,c){this.parent(a,b,c),this.setState("hidden","tooltip")},_prepareForRender:function(){return this._sequencer.addEvent("productionFinished",function(a){this._onSequencerFinished(a),this.fireEvent("optionListInputReady",a)}.bind(this)),this._sequencer.createComponents(this._skinParts.itemsContainer,this.getDataItem().get("items")),!0},_changeSelectedItem:function(a){this._selectedItem&&(this._selectedItem.setSelected(!1),this._selectedItem=null,a||this.setState("hidden","tooltip")),a&&(this._selectedItem=a,this._selectedItem.setSelected(!0),this._showTooltip(this._selectedItem.getDataItem().get("description")))},_showTooltip:function(a){a&&(this._skinParts.tooltip.set("html",a),this._numOfTimerCalls++,this.setState("displayed","tooltip"),this.resources.W.Utils.callLater(this._hideTooltip,null,this,1500))},_hideTooltip:function(){this._numOfTimerCalls--,0===this._numOfTimerCalls&&this.setState("hidden","tooltip")}})}),define.dataSchema("TextInputProperties",{label:"string",placeholder:"string"}),define.component("wixapps.integration.components.inputs.TextInput",function(a){var b=a;b.inherits("mobile.core.components.base.BaseComponent"),b.utilize([]),b.traits([]),b.binds(["_changeEventHandler","_fireBlur","_fireKeyUp","_fireFocus","_selectPresetFieldContent","_deselectPresetFieldContent"]),b.skinParts({input:{type:"htmlElement"}}),b.states({label:["hasLabel","noLabel"],validation:["invalid"]}),b.dataTypes(["Text"]),b.propertiesSchemaType("TextInputProperties"),b.fields({}),b.methods({render:function(){this.setLabel(this.getComponentProperty("label")),this.setValue(this.getDataItem().get("text"),!1),this.setPlaceholder(this.getComponentProperty("placeholder"))},_onAllSkinPartsReady:function(){this.addEvent("inputChanged",function(a){this._ignoreUpdate=!0,this.getDataItem().set("text",a.value),this._ignoreUpdate=!1}.bind(this)),this.resetInvalidState(),this._listenToInput()},_onDisabled:function(){this._skinParts.input.disabled=!0},_onEnabled:function(){this._skinParts.input.disabled=!1},dispose:function(){this._stopListeningToInput(),this.parent()},setPlaceholder:function(a){this._skinParts.input.set("placeholder",a),window.Modernizr&&!window.Modernizr.input.placeholder&&this._placeholderPolyFill()},_placeholderPolyFill:function(){function a(a){var b=a.target;""===b.get("value")&&b.get("placeholder")&&(b.addClass("isPlaceholder"),b.set("value",b.get("placeholder")))}function b(a){var b=a.target;b.hasClass("isPlaceholder")&&(b.removeClass("isPlaceholder"),b.set("value",""))}this.hasPlaceholder||(this.hasPlaceholder=!0,this._skinParts.input.addEvent("focus",b),this._skinParts.input.addEvent("blur",a),a({target:this._skinParts.input}))},setLabel:function(a){a&&"string"==typeof a?(this.setState("hasLabel","label"),this._skinParts.label.set("html",a),this._skinParts.label.uncollapse()):(this.setState("noLabel","label"),this._skinParts.label.set("html",""),this._skinParts.label.collapse())},showValidationMessage:function(a){this.setState("invalid","validation"),this._skinParts.message&&(this._skinParts.message.setStyle("white-space","normal"),this._skinParts.message.set("text",a),this._skinParts.message.uncollapse())},resetInvalidState:function(){this.removeState("invalid","validation"),this._skinParts.message&&(this._skinParts.message.set("text",""),this._skinParts.message.collapse())},setValue:function(a,b){var c=this._skinParts.input;this.hasPlaceholder&&c.removeClass("isPlaceholder"),this._ignoreUpdate||c.set("value",a),b?c.set("isPreset","true"):c.erase("isPreset")},_changeEventHandler:function(a){if(!a.code||W.Utils.isInputKey(a.code)){if(13==a.code)return this.fireEvent("enterPressed"),void 0;this._skinParts.input.set("isPreset","");var b=this.getValue();b=this.injects().Utils.convertToHtmlText(b);var c={value:b,origEvent:a,compLogic:this};this.fireEvent("inputChanged",c)}},_selectPresetFieldContent:function(a){a.target.get("isPreset")&&(a.target.get("isSelected")||(a.target.set("isSelected","true"),a.target.select()))},_deselectPresetFieldContent:function(a){a.target.erase("isSelected")},_fireBlur:function(a){this.fireEvent(Constants.CoreEvents.BLUR,a)},_fireKeyUp:function(a){this.fireEvent(Constants.CoreEvents.KEY_UP,a)},_fireFocus:function(a){this.fireEvent(Constants.CoreEvents.FOCUS,a)},_listenToInput:function(){this._skinParts.input.addEvent(Constants.CoreEvents.KEY_UP,this._changeEventHandler),this._skinParts.input.addEvent(Constants.CoreEvents.KEY_UP,this._fireKeyUp),this._skinParts.input.addEvent(Constants.CoreEvents.CUT,this._changeEventHandler),this._skinParts.input.addEvent(Constants.CoreEvents.PASTE,this._changeEventHandler),this._skinParts.input.addEvent(Constants.CoreEvents.CHANGE,this._changeEventHandler),this._skinParts.input.addEvent(Constants.CoreEvents.CLICK,this._selectPresetFieldContent),this._skinParts.input.addEvent(Constants.CoreEvents.BLUR,this._deselectPresetFieldContent),this._skinParts.input.addEvent(Constants.CoreEvents.BLUR,this._fireBlur),this._skinParts.input.addEvent(Constants.CoreEvents.FOCUS,this._fireFocus)},_stopListeningToInput:function(){this._skinParts.input.removeEvent(Constants.CoreEvents.KEY_UP,this._changeEventHandler),this._skinParts.input.removeEvent(Constants.CoreEvents.KEY_UP,this._fireKeyUp),this._skinParts.input.removeEvent(Constants.CoreEvents.CUT,this._changeEventHandler),this._skinParts.input.removeEvent(Constants.CoreEvents.PASTE,this._changeEventHandler),this._skinParts.input.removeEvent(Constants.CoreEvents.CHANGE,this._changeEventHandler),this._skinParts.input.removeEvent(Constants.CoreEvents.CLICK,this._selectPresetFieldContent),this._skinParts.input.removeEvent(Constants.CoreEvents.BLUR,this._deselectPresetFieldContent),this._skinParts.input.removeEvent(Constants.CoreEvents.BLUR,this._fireBlur),this._skinParts.input.removeEvent(Constants.CoreEvents.FOCUS,this._fireFocus)},getValue:function(){var a=this._skinParts.input,b="";return a.hasClass("isPlaceholder")||(b=a.get("value")),b}})}),define.dataSchema("TimeInputProperties",{resolution:{type:"string","enum":["hours","half-hour","quarter-hour","minutes","seconds"],"default":"minutes",description:"Specify the resolution of the time selector"},hourFormat:{type:"string","enum":["12h","24h"],"default":"12h",description:"Specify the format of the hour field in the time selector (12h / 24h)"},allowEmpty:{type:"boolean","default":!0,description:"If set to false will not have empty options in the combo-boxes and the default value will be set to the current date."}}),define.component("wixapps.integration.components.inputs.TimeInput",function(a){var b=a;b.inherits("mobile.core.components.base.BaseComponent"),b.utilize([]),b.traits([]),b.binds(["_userChange"]),b.skinParts({hours24:{type:Constants.ComponentPartTypes.HTML_ELEMENT},hours12:{type:Constants.ComponentPartTypes.HTML_ELEMENT},minutes:{type:Constants.ComponentPartTypes.HTML_ELEMENT},seconds:{type:Constants.ComponentPartTypes.HTML_ELEMENT},ampm:{type:Constants.ComponentPartTypes.HTML_ELEMENT},message:{type:Constants.ComponentPartTypes.HTML_ELEMENT}}),b.states({resolution:["hours","half-hour","quarter-hour","minutes","seconds"],hourFormat:["12h","24h"],allowEmpty:["allowEmpty","hideEmpty"],validation:["invalid"]}),b.dataTypes(["Text"]),b.propertiesSchemaType("TimeInputProperties"),b.fields({_options:{minutes:[],quarterHour:[],halfHour:[]},_invalidDateString:"Invalid Date",_emptyHoursText:"HH",_emptyMinutesText:"MI",_emptySecondsText:"SS"}),b.methods({initialize:function(a,b,c){this.parent(a,b,c),this._buildMinuteOptionCache()},showValidationMessage:function(a){this.setState("invalid","validation"),this._skinParts.message&&this._skinParts.message.set("text",a)},resetInvalidState:function(){this.removeState("invalid","validation"),this._skinParts.message&&this._skinParts.message.set("text","")},render:function(){var a=this._data.get("text"),b=this.getComponentProperty("resolution"),c=this.getComponentProperty("hourFormat"),d=this._allowEmpty();if(this.setState(b,"resolution"),this.setState(c,"hourFormat"),this.setState(d?"allowEmpty":"hideEmpty","allowEmpty"),!d||a!=this._invalidDateString){var e=new Date(a);isNaN(e.getTime())&&(e=d?new Date(0):new Date);var f=e.getHours(),g=e.getMinutes(),h=e.getSeconds();this._clearOptions(this._skinParts.minutes),"quarter-hour"==b&&(this._populateOptions(this._skinParts.minutes,this._options.quarterHour),g=15*parseInt((g+7.5)/15,10)%60,f=e.getMinutes()>52?f+1:f),"half-hour"==b&&(this._populateOptions(this._skinParts.minutes,this._options.halfHour),g=30*parseInt((g+15)/30,10)%60,f=e.getMinutes()>45?f+1:f),0===this._skinParts.minutes.options.length&&this._populateOptions(this._skinParts.minutes,this._options.minutes),d&&0===e.getTime()?(this._setSelectedValue(this._skinParts.hours12,this._emptyHoursText),this._setSelectedValue(this._skinParts.hours24,this._emptyHoursText),this._setSelectedValue(this._skinParts.minutes,this._emptyMinutesText),this._setSelectedValue(this._skinParts.seconds,this._emptySecondsText)):(0===f?(this._setSelectedValue(this._skinParts.hours12,12),this._setSelectedValue(this._skinParts.ampm,"PM")):(this._setSelectedValue(this._skinParts.hours12,f%12),this._setSelectedValue(this._skinParts.ampm,f>12?"PM":"AM")),this._setSelectedValue(this._skinParts.hours24,f),this._setSelectedValue(this._skinParts.minutes,g),this._setSelectedValue(this._skinParts.seconds,h))}},_setSelectedValue:function(a,b){var c=Array.from(a.options).filter(function(a){return a.value==b});c.length&&(c[0].selected=!0)},_clearOptions:function(a){a.innerHTML=""},_populateOptions:function(a,b){for(var c=0;c<b.length;c++)a.options.add(b[c])},_formatTimePart:function(a,b){return b=b||" ",(b+a).substr(-2)},_onAllSkinPartsReady:function(){this._populateStaticOptions(),this._skinParts.hours24.addEvent(Constants.CoreEvents.CHANGE,this._userChange),this._skinParts.hours12.addEvent(Constants.CoreEvents.CHANGE,this._userChange),this._skinParts.minutes.addEvent(Constants.CoreEvents.CHANGE,this._userChange),this._skinParts.seconds.addEvent(Constants.CoreEvents.CHANGE,this._userChange)},_isValidDate:function(){return!("24h"!=this.getState("hourFormat")&&this._skinParts.hours12.getSelected()[0].value==this._emptyHoursText||"12h"!=this.getState("hourFormat")&&this._skinParts.hours24.getSelected()[0].value==this._emptyHoursText||"hours"!=this.getState("resolution")&&this._skinParts.minutes.getSelected()[0].value==this._emptyMinutesText||"seconds"==this.getState("resolution")&&this._skinParts.seconds.getSelected()[0].value==this._emptySecondsText)},_isEmptyDate:function(){var a="24h"==this.getState("hourFormat")&&this._skinParts.hours24.getSelected()[0].value==this._emptyHoursText||"12h"==this.getState("hourFormat")&&this._skinParts.hours12.getSelected()[0].value==this._emptyHoursText,b=this._skinParts.minutes.getSelected()[0].value==this._emptyMinutesText,c=this._skinParts.seconds.getSelected()[0].value==this._emptySecondsText;return"hours"==this.getState("resolution")?a:"seconds"==this.getState("resolution")?a&&b&&c:a&&b},_userChange:function(){var a,b=new Date(0);this._isEmptyDate()?(this.getDataItem().set("text",b.toISOString()),this.fireEvent("selectionChanged",b.toISOString())):this._isValidDate()?("12h"==this.getState("hourFormat")?(a=this._skinParts.hours12.getSelected()[0].value,a="PM"==this._skinParts.ampm.getSelected()[0].value?(parseInt(a,10)+12)%24:parseInt(a,10)):(a=this._skinParts.hours24.getSelected()[0].value,a=parseInt(a,10)),b.setHours(a),"hours"!=this.getState("resolution")?b.setMinutes(parseInt(this._skinParts.minutes.getSelected()[0].value,10)):b.setMinutes(0),"seconds"==this.getState("resolution")?b.setSeconds(parseInt(this._skinParts.seconds.getSelected()[0].value,10)):b.setSeconds(0),b.setDate(5),this.getDataItem().set("text",b.toISOString()),this.fireEvent("selectionChanged",b.toISOString())):(this.getDataItem().set("text",this._invalidDateString),this.fireEvent("selectionChanged",this._invalidDateString))},_buildMinuteOptionCache:function(){var a,b,c;for(c=new Option(this._emptyMinutesText,this._emptyMinutesText),c.addClass("empty"),this._options.quarterHour.push(c),this._options.halfHour.push(c),this._options.minutes.push(c),a=0;60>a;a++)b=this._formatTimePart(a,"0"),c=new Option(b,a),a%15===0&&this._options.quarterHour.push(c),a%30===0&&this._options.halfHour.push(c),this._options.minutes.push(c)},_populateStaticOptions:function(){var a,b,c;for(this._skinParts.ampm.options.add(new Option("AM","AM")),this._skinParts.ampm.options.add(new Option("PM","PM")),c=new Option(this._emptyHoursText,this._emptyHoursText),c.addClass("empty"),this._skinParts.hours12.options.add(c),a=1;13>a;a++)b=this._formatTimePart(a),this._skinParts.hours12.options.add(new Option(b,a));for(c=new Option(this._emptyHoursText,this._emptyHoursText),c.addClass("empty"),this._skinParts.hours24.options.add(c),a=0;24>a;a++)b=this._formatTimePart(a),this._skinParts.hours24.options.add(new Option(b,a));for(c=new Option(this._emptySecondsText,this._emptySecondsText),c.addClass("empty"),this._skinParts.seconds.options.add(c),a=0;60>a;a++)b=this._formatTimePart(a,"0"),this._skinParts.seconds.options.add(new Option(b,a))},_allowEmpty:function(){return this.getComponentProperty("allowEmpty")===!0||"true"===this.getComponentProperty("allowEmpty")}})}),define.Class("wixapps.integration.managers.AppBuilderLocalizer",function(a){var b=a;b.inherits("wixapps.integration.managers.BaseLocalizer"),b.fields({}),b.methods({localize:function(a,b){return this._resourceManager.get("WIXAPPS2_LANGUAGE",a,b)||"["+a+"]"},localizeView:function(a){return this._processValue(a,"")},localizeTemplates:function(a){return this._processValue(a,"")}})}),define.Class("wixapps.integration.managers.AppBuilderPageEnvironment",function(a){var b=a;b.resources(["W.Apps2"]),b.methods({initialize:function(){},getLogicClassName:function(a){return a.getLogicClass()},getAppInstance:function(a,b){this.resources.W.Apps2.getApplicationInstance(a,b)},getWixAppsManager:function(){throw this.resources.W.Apps2},getTypeForPageLogic:function(a){return a?a.getType():void 0},getEnvironment:function(a,b){return{getAppInstance:function(){return a._appInstance},getForType:function(){return b?b.getType():void 0}}}})}),define.Class("wixapps.integration.managers.AppPageEnvironment",function(a){var b=a;b.resources(["W.Apps"]),b.methods({initialize:function(){},getLogicClassName:function(a){return a.logic.display.type},getAppInstance:function(a,b){b(this.resources.W.Apps.getApp(a))},getWixAppsManager:function(){throw this.resources.W.Apps},getTypeForPageLogic:function(){return void 0},getEnvironment:function(a,b){var c={_context:[{itemCache:a._appInstance.getItemCache(),dataItemFactory:a._appInstance.getDataItemFactory()}],getForType:function(){return void 0},getDataItemFactory:function(){return this._getContext().dataItemFactory},getTypesManager:function(){return a._appInstance.getTypesManager()},getDataService:function(){return a._appInstance.getDataService()},getItemCache:function(){return this._getContext().itemCache},getAppInstance:function(){return a._appInstance},getLogger:function(){return a.getLogger()},_getContext:function(){return this._context[this._context.length-1]},getAppPage:function(){return a},getAppPageId:function(){return a.getDataItem().get("appPageId")}};if(b.logic.display.options){var d={};Object.each(b.logic.display.options,function(a,b){d[b]=a}),c.options=d}return c},getBundledPagesIds:function(a){return a.pageSettings.bundledPages}})}),define.Class("wixapps.integration.managers.AppResizeHandler",function(a){var b=a;b.binds(["_onAppResize","_onAppViewCreated","_onProxySizeInvalid","_onThemeChanged"]),b.resources(["W.Theme"]),b.fields({_appHolderView:null,_resizeDispatcher:null,_lastSize:null,_resizeLocked:!1}),b.methods({activateResizeHandler:function(a,b){this.deactivateResizeHandler(),this._resizeDispatcher=a,this._appHolderView=b,this._resizeDispatcher.addEvent(Constants.WixAppEvents.APP_PART_RESIZE,this._onAppResize),this._resizeDispatcher.addEvent(Constants.WixAppEvents.APP_VIEW_READY,this._onAppViewCreated),this._resizeDispatcher.addEvent(Constants.WixAppEvents.PROXY_SIZE_INVALID,this._onProxySizeInvalid),this.resources.W.Theme.getDataMap().THEME_DATA.addEvent(Constants.DataEvents.DATA_CHANGED,this._onThemeChanged)},deactivateResizeHandler:function(){this._resizeDispatcher&&(this._resizeDispatcher.removeEvent(Constants.WixAppEvents.APP_PART_RESIZE,this._onAppResize),this._resizeDispatcher.removeEvent(Constants.WixAppEvents.APP_VIEW_READY,this._onAppViewCreated),this._resizeDispatcher.removeEvent(Constants.WixAppEvents.PROXY_SIZE_INVALID,this._onProxySizeInvalid),this.resources.W.Theme.getDataMap().THEME_DATA.removeEvent(Constants.DataEvents.DATA_CHANGED,this._onThemeChanged),this._resizeDispatcher=null,this._appHolderView=null)},_onAppViewCreated:function(){this._performResizeAction(this._appHolderView,function(a){a._onAppViewCreated()}),this._checkContentSizeChange()},_onAppResize:function(){this._performResizeAction(this._appHolderView,function(a){a._onAppResize.call()}),this._checkContentSizeChange()},_ignoredThemeProperties:["BASE_THEME_DIRECTORY","BG_DIRECTORY","CONTACT_DIRECTORY","EXTERNAL_LINKS_DIRECTORY","NETWORKS_DIRECTORY","PAGES_DIRECTORY","THEME_DIRECTORY","WEB_THEME_DIRECTORY"],_onThemeChanged:function(a,b){Array.some(b,function(a){return!this._ignoredThemeProperties.contains(a)}.bind(this))&&this._onProxySizeInvalid()},_onProxySizeInvalid:function(){this._resizeLocked||(this._resizeLocked=!0,window.requestAnimFrame(function(){this._resizeLocked=!1,this._performResizeAction(this._appHolderView,function(a){a._onAppResize.call()
}),this._checkContentSizeChange()}.bind(this)))},_checkContentSizeChange:function(){this._waitingForFrame||(this._waitingForFrame=!0,window.requestAnimFrame(function(){this._waitingForFrame=!1;var a=!1,b=this._appHolderView.getSize();this._lastSize&&(a=!(b.x===this._lastSize.x&&b.y===this._lastSize.y)),this._lastSize=b,a&&this._resizeDispatcher.fireEvent(Constants.WixAppEvents.APP_CONTENT_RESIZE)}.bind(this)))},_performResizeAction:function(a,b){if(!this._resizeLocked){var c=this,d=a.getElements("[hasproxy]");this._updateGeometry(a);var e=d.filter(function(a){return c._isResizableProxy(a.getViewProxy())}).map(function(b){return{proxy:b.getViewProxy(),depth:c._getElementDepth(a,b)}}).sort(function(a,b){return a.depth-b.depth});e.forEach(function(a){b(a.proxy)})}},_updateGeometry:function(a){if(a.$flexPolyfill)a.$flexPolyfill.updateGeometry();else for(var b=0;b<a.children.length;b++)this._updateGeometry(a.children[b])},_isResizableProxy:function(a){return a._onAppResize&&a._onAppViewCreated},_getElementDepth:function(a,b){return b==a||null==b?0:this._getElementDepth(a,b.getParent())+1}})}),define.Class("wixapps.integration.managers.ApplicationInstance",function(a){var b=a;b.inherits("bootstrap.utils.Events"),b.binds(["_onDescriptorLoaded","resolveResourcePath"]),b.resources(["W.Utils","W.Config","topology","W.Data","W.Classes","W.Viewer","W.Commands"]),b.utilize(["wixapps.core.managers.TypesManager","wixapps.core.dataservice.DataServiceTransport","wixapps.core.data.DataItemFactory","wixapps.core.dataservice.ItemCache","wixapps.core.dataservice.DataService","wixapps.core.views.ViewsCustomizer","wixapps.core.views.ViewDefinitionsRepository","wixapps.integration.managers.ApplicationInstanceUtils","wixapps.integration.managers.applicationhandlers.ZoomHandler","wixapps.core.expressions.FunctionLibrary","wixapps.integration.managers.ApplicationLocalizer","wixapps.integration.managers.CustomSystemFuctions"]),b.fields({_localizer:null}),b.methods({initialize:function(a){this._pageLinkResolvers={},this._pageLinkResolversWaitingList=[],this._appParts=[],this._appPages=[],this._appVars=null,this._types=new this.imports.TypesManager,this._funcLibrary=(new this.imports.FunctionLibrary).createChild(),this._dataFactory=new this.imports.DataItemFactory,this._dataFactory.registerFunctionLibrary(this._funcLibrary),this._itemCache=new this.imports.ItemCache(this._dataFactory),this._zoomHandler=new this.imports.ZoomHandler(this),this._localizer=null,this._customizations=new this.imports.ViewsCustomizer,this._viewDefinitions=new this.imports.ViewDefinitionsRepository(this._dataFactory,this._localizeRawViewDefinition.bind(this)),this._createdApplicationPages={},this._utils=new this.imports.ApplicationInstanceUtils(this);var b=new this.imports.CustomSystemFuctions;b.setupCustomFunctions(this._funcLibrary),this._isApplicationActive=null,this.updateFromAppSpec(a);var c=this.resources.W.Config.env.$isEditorViewerFrame&&this.resources.W.Config.siteNeverSavedBefore();c&&(a.notProvisioned=!0)},updateFromAppSpec:function(a){this._idInMetasite=a.applicationId,this._appDefinitionId=a.appDefinitionId,this._packageName=a.packageName,"wixapps"==a.type?(this._transport=new this.imports.DataServiceTransport(a.datastoreId,"",""),this._dataService=new this.imports.DataService(this._transport,this._dataFactory,this._itemCache)):"ecommerce"==a.type&&(this._magentoStoreId=a.magentoStoreId),this._appBasePath=null;var b=W.Config.getServiceTopologyProperty("scriptsLocationMap");if(!b||!b.wixapps)throw"wixapps topology path is undefined";this._appBasePath=b.wixapps+"/javascript/wixapps/apps/"+this._packageName+"/",this.resources.W.Data.getDataByQuery("#WIXAPPS_EXTERNAL_APPS",function(a){a.get("items")[this._packageName]&&(this._appBasePath=this.resources.topology[this._packageName])}.bind(this))},loadDescriptor:function(){this.resource.getResourceValue("W.Apps",function(a){a.requestAppDescriptor(this._packageName,this._onDescriptorLoaded)}.bind(this))},getAppDefinitionId:function(){return this._appDefinitionId},getPackageName:function(){return this._packageName},getIdInMetasite:function(){return this._idInMetasite},getDataService:function(){return this._dataService},getMagentoStoreId:function(){return this._magentoStoreId},getAppDescriptor:function(){return this._descriptor},getAppBasePath:function(){return this._appBasePath},getAppParts:function(){return this._appParts},getAppPages:function(){return this._appPages},getParentAppPage:function(){var a=_.find(this._appPages,function(a){return void 0===a.getPageDefinition().parentPage});return a},getLocalizer:function(){return this._localizer},getUtils:function(){return this._utils},resolveResourcePath:function(a){if(a){var b=a.match(/^(http:\/\/)?(images\/.*)/);if(b)return this.resources.W.Utils.AppsUtils.combinePath(this._appBasePath,b[2])}return a},registerAppPart:function(a){this.resources.W.Commands.executeCommand("ApplicationPerformanceSpy.logPhase",{step:"registered",appPart:a}),this._appParts.push(a),this.getDescriptorLoaded()&&a.initApp()},registerAppPage:function(a){this._appPages.push(a),this.getDescriptorLoaded()&&a.initApp()},unregisterAppPage:function(a){_.remove(this._appPages,a)},getDescriptorLoadPromise:function(){var a=Q.defer();return this.getDescriptorLoaded()?a.resolve(this._descriptor):this.registerForDescriptorLoaded(function(b){a.resolve(b)}),a.promise},registerForDescriptorLoaded:function(a){this._descriptorLoadedCallbacks=this._descriptorLoadedCallbacks||[],this._descriptorLoadedCallbacks.push(a)},notifyDescriptorLoaded:function(){this._descriptorLoadedCallbacks=this._descriptorLoadedCallbacks||[];for(var a;this._descriptorLoadedCallbacks.length;)a=this._descriptorLoadedCallbacks.shift(),a(this._descriptor)},getDescriptorLoaded:function(){return!!this._descriptor},getTypesManager:function(){return this._types},getDataServiceTransport:function(){return this._transport},getDataItemFactory:function(){return this._dataFactory},getItemCache:function(){return this._itemCache},getCustomizations:function(){return this._customizations},getViewDefRepo:function(){return this._viewDefinitions},getPartDefinition:function(a){if(!this._descriptor||!this._descriptor.parts)return null;for(var b=0;b<this._descriptor.parts.length;b++)if(this._descriptor.parts[b].id==a)return this._descriptor.parts[b];return null},getPageDefinition:function(a){return this._descriptor&&this._descriptor.pages?this._descriptor.pages.first(function(b){return b.id==a}):null},getPageLinkResolverPromise:function(a){var b=Q.defer();return _.has(this._pageLinkResolvers,a)?b.resolve(this._pageLinkResolvers[a]):this._pageLinkResolversWaitingList.push({appPageId:a,q:b}),b.promise},_localizeRawViewDefinition:function(a){a=this._localizer.localizeDescriptor(a)},_localizeDescriptor:function(a){var b=a.lang||{};return this._localizer=new this.imports.ApplicationLocalizer(b),a=this._localizer.localizeDescriptor(a)},_onDescriptorLoaded:function(a){this._descriptor=a,this._setupAppVars(),a=this._localizeDescriptor(a);var b,c=Constants.WixAppsSystemTypes;for(b=0;b<c.length;b++)this._types.registerType(c[b]);for(b=0;b<a.types.length;b++)this._types.registerType(a.types[b]);var d=a.pages,e=this._getPageConfigurationRepository();if(d){var f=this;_.forEach(d,function(a){a.pageSettings&&a.pageSettings.pageIcon&&(a.pageSettings.pageIcon=f.resolveResourcePath(a.pageSettings.pageIcon)),a.pageSettings&&a.pageSettings.pageConfigurationType?e.registerConfig(a.id,{options:a.pageSettings,type:a.pageSettings.pageConfigurationType}):e.registerConfig(a.id,{options:a.pageSettings}),f.registerPageLinkResolver(a)})}for(this._customizations.addRules(a.customizations),this._addDataEditingCustomizations(),b=0;b<a.views.length;b++)for(var g=this._viewDefinitions.cloneAndMultiply(a.views[b]),h=0;h<g.length;h++)this._customizations.fillMissingIds(g[h]),this._customizations.applyAll(g[h]),this._viewDefinitions.setViewDefinition(g[h]);for(b=0;b<this._appParts.length;b++)this._appParts[b].initApp();for(b=0;b<this._appPages.length;b++)this._appPages[b].initApp();W.Viewer&&W.Viewer.isSiteReady()?this._zoomHandler.validateZoomRelatedData():this._callValidateZoomData(),this.notifyDescriptorLoaded()},registerPageLinkResolver:function(a){if(_.has(a,"pageLinkResolver")){var b=this;this.resources.W.Classes.getClass(a.pageLinkResolver,function(c){b._pageLinkResolvers[a.id]=new c(a),b._pageLinkResolversWaitingList=_.filter(b._pageLinkResolversWaitingList,function(c){return c.appPageId===a.id?(c.q.resolve(b._pageLinkResolvers[a.id]),!1):!0})})}},_callValidateZoomData:function(){W.Viewer&&W.Config.env.$isPublicViewerFrame?W.Viewer.addEvent("SiteReady",this._zoomHandler.validateZoomRelatedData):W.Commands.registerCommandListenerByName("EditorCommands.SiteLoaded",this,this._zoomHandler.validateZoomRelatedData)},_addDataEditingCustomizations:function(){var a=this.getDescriptorValue(["dataEditing","typeMetaData"]),b=this.getCustomizations();for(var c in a){var d=a[c];if(d.validationMessages)for(var e in d.validationMessages)b.addRule({forType:c,view:"editorForm",fieldId:e,key:"comp.validationMessage",value:d.validationMessages[e]})}},getDescriptorValue:function(a){return this._getInnerValue(this._descriptor,a)},_getInnerValue:function(a,b){for(var c=a,d=0;d<b.length;d++)if(c=c[b[d]],void 0===c||null===c)return null;return c},getZoomHandler:function(){return this._zoomHandler},_getPageConfigurationRepository:function(){return this.resources.W.Viewer.getPageConfigurationRepository()},getAppVars:function(){return this._appVars},getAppVar:function(a){var b=this._appVars.getChildByRef(a);return void 0===b&&(this.setAppVar(a,void 0),b=this._appVars.getChildByRef(a)),b},getAppVarValue:function(a){return this._appVars.getChildValue(a)},setAppVar:function(a,b){var c=this._appVars.getValue();c[a]=b,this._appVars.setValue(c)},_setupAppVars:function(){var a=this._descriptor.appVars||{},b=this._getSavedAppVars(),c=function(){return Object.map(b.get("vars"),function(a){return JSON.parse(a.value)})},d=b?c():{},e=Object.merge(a,d);this._appVars=this._dataFactory.createDataItem(e);var f=this;this._appVars.addEvent(Constants.DataItemEvents.CHANGE,function(){if(!this._ignoreChanges){var a=f._appVars.getValue();f._setAppVarsWData(a)}})},_updateAppVars:function(a){var b=Object.map(a.get("vars"),function(a){return JSON.parse(a.value)}),c=this._appVars.getValue(),d=_.merge({},c,b);this._ignoreChanges=!0,this._appVars.setValue(d),this._ignoreChanges=!1},_getSavedAppVars:function(){var a=this.resources.W.Data,b="#appVars_"+this._appDefinitionId;if(a.isDataAvailable(b))return a.getDataByQuery(b);var c=this;return a.getDataByQuery(b,function(a){c._updateAppVars(a)}),null},_setAppVarsWData:function(a){var b=this.resources.W.Data,c="appVars_"+this._appDefinitionId;b.isDataAvailable("#"+c)||b.addDataItem(c,{type:"AppVars",vars:{},appDefId:this._appDefinitionId});var d=b.getDataByQuery("#"+c),e=Object.map(a,function(a){return{type:"AppPartParam",value:JSON.stringify(a)}});d.set("vars",e)},setApplicationActiveState:function(a){this.setAppVar("applicationActiveState",a)},getApplicationActiveState:function(){return this._appVars?this.getAppVarValue("applicationActiveState"):!1}})}),define.Class("wixapps.integration.managers.ApplicationInstanceUtils",function(a){var b=a;b.fields({_appInstance:null}),b.methods({initialize:function(a){this._appInstance=a},createRunner:function(){return{_tasks:[],_onDone:null,_done:function(){if(this._tasks.length<1)return this._onDone&&this._onDone(),void 0;var a=this._tasks.shift();a.func(this._done.bind(this))},add:function(a,b){this._tasks.push({name:a,func:b})},run:function(a){this._onDone=a,this._done()}}},extractStoreData:function(a){var b,c={},d=this.createRunner();d.add("Loading collection names",function(a){for(var e=b.getDescriptorValue(["collections"]),f=0;f<e.length;f++){var g=e[f].id;d.add("Loading items from "+g,function(a){return function(d){b.getDataService().getTransport().query(a,{},null,0,-1,!1,function(b){c[a]=b.items,d()},function(){d()})}}(g))}d.add("Cleaning items",function(a){Object.each(c,function(a){a.forEach(function(a){delete a._createdAt,delete a._hash,delete a._updatedAt,delete a._vg})}),a()}),a()}),d.run(function(){a(c)})},extractDescriptorData:function(){return this._appInstance.getDescriptorValue(["preLoadedData"])},cleanDataInStore:function(a,b){function c(){h.length+i.length==g&&b&&b({successes:h.length,failures:i,failuresCause:j})}function d(a){return function(){h.push(a),c()}}function e(a){return function(b){-1021==b.code||b.description.indexOf("ItemNotExistsException")>-1?h.push(a):(i.push(a),j.push(b)),c()}}var f=this._appInstance,g=0,h=[],i=[],j=[];Object.each(a,function(a){a.forEach(function(a){a._iid&&g++})}),Object.each(a,function(a,b){a.forEach(function(a){a._iid&&f.getDataService().deleteItem(b,a._iid,d(a),e(a))}.bind(this))}.bind(this))},cleanStore:function(a){var b={},c=this._appInstance,d=this.createRunner();d.add("Loading collection names",function(a){for(var e=c.getDescriptorValue(["collections"]),f=0;f<e.length;f++){var g=e[f].id;d.add("Loading items from "+g,function(a){return function(d){c.getDataService().getTransport().query(a,{},null,0,-1,!1,function(c){b[a]=c.items,d()},function(){d()})}}(g))}d.add("Delete all items",function(a){function d(){e--,0===e&&a()}var e=0;Object.each(b,function(a){e+=a.length}),Object.each(b,function(a,b){a.forEach(function(a){c.getDataService().getTransport().deleteItem(b,a._iid,d,d)})}),a()}),a()}),d.run(a)},uploadData:function(a,b){function c(){h.length+i.length==g&&b&&b({successes:h.length,failures:i.length})}function d(a){return function(){h.push(a),c()}}function e(a){return function(b){i.push(a),j.push(b),c()}}var f=this._appInstance,g=0;Object.each(a,function(a){g+=a.length});var h=[],i=[],j=[];Object.each(a,function(a,b){a.forEach(function(a){var c=Object.clone(a);delete c._createdAt,delete c._hash,delete c._updatedAt,delete c._vg;var g=f.getDataItemFactory().createDataItem(c);f.getDataService().createItem(b,g,d(a),e(a))})})},resetStoreToDescriptorData:function(a){this.cleanStore(function(){var b=this.extractDescriptorData(),c=this._appInstance.getDataService().getItemCache();c&&c.removeAll(),this.uploadData(b,a)}.bind(this))}})}),define.Class("wixapps.integration.managers.ApplicationLocalizer",function(a){var b=a;b.inherits("wixapps.integration.managers.BaseLocalizer"),b.fields({_blackList:["/collections","/permissions","/types","/preLoadedData","/lang"]}),b.methods({initialize:function(a){this._lang=a||{},this.resources.W.Config.isInDebugMode()||this._blackList.push("/views"),this.parent()},localizeDescriptor:function(a){return this._processValue(a,"")},localize:function(a,b){return b=b||this._locale,this._getByLocale(a,b)||this._getByLocale(a,this.DEFAULT_LANG)||"["+a+"]"},_getByLocale:function(a,b){return b?this._lang.hasOwnProperty(b)?this._lang[b].hasOwnProperty(a)?this._lang[b][a]:null:null:null}})}),define.Class("wixapps.integration.managers.BaseLocalizer",function(a){var b=a;b.resources(["W.Resources","W.Utils","W.CookiesManager","W.Config"]),b.fields({THINGY_CHAR:"@",DEFAULT_LANG:"en",_blackList:[],_isReady:!1,_resourceManager:null,_utils:null}),b.methods({initialize:function(){this._utils=this.resources.W.Utils.AppsUtils,this._resourceManager=this.resources.W.Resources,this._locale=this._getLangCode(),this._macroPattern=new RegExp(this.THINGY_CHAR+"[0-9a-zA-Z_\\-\\.]*"+this.THINGY_CHAR),this._thingyPattern=new RegExp(this.THINGY_CHAR,"g"),this._isReady=!1,this._ensureBundleLoaded()},isReady:function(){return this._isReady},_ensureBundleLoaded:function(){},localize:function(){throw"Not implemented: ask my children."},isValidKey:function(a){return this._macroPattern.test(a)},getKeyValue:function(a){return a.replace(this._thingyPattern,"")},_getLangCode:function(){var a=this.resources.W.Config.env;if(a.$isEditorFrame)return this._resourceManager.getLanguageSymbol();if(a.$isEditorViewerFrame)return this.resources.W.CookiesManager.getCookie("wixLanguage");if(a.$isPublicViewerFrame){var b=window.navigator.userLanguage||window.navigator.language;return b.split("-")[0]}throw"Localizer:: Not in Editor, Preview or Public... something is wrong"},_processValue:function(a,b){var c=this._utils.getType(a);if(this._blackList.indexOf(b)>-1)return a;switch(c){case"object":return this._iterateObject(a,b);case"array":return this._iterateArray(a,b);case"string":return this._localize(a);default:return a}},_localize:function(a){for(var b,c,d;null!==(b=this._macroPattern.exec(a));)b=b[0],c=b.replace(this._thingyPattern,""),d=this.localize(c),a=a.replace(b,d);return a},_iterateArray:function(a,b){var c,d=a.length;for(c=0;d>c;c++)a[c]=this._processValue(a[c],b+"["+c+"]");return a},_iterateObject:function(a,b){var c;for(c in a)a.hasOwnProperty(c)&&(a[c]=this._processValue(a[c],b+"/"+c));return a}})}),define.Class("wixapps.integration.managers.BubbleHandler",function(a){var b=a;b.utilize(["wixapps.integration.gui.BubblePresenter","wixapps.core.utils.WixAppsLogger"]),b.traits([]),b.binds([]),b.resources(["W.Editor","W.Utils","W.AppsGUI","W.EditorDialogs","W.Config"]),b.statics({ARROW_GAP:25,ARROW_HGAP:12,ARROW_VGAP:45,Sets:{FT_AFTER_COPY_LIST_2:{titleKey:"FT_AFTER_COPY_LIST_2_Title",descriptionKey:"FT_AFTER_COPY_LIST_2_Description",iconFileName:"multiple-lists-filter-icon.png",links:[{titleKey:"FT_AFTER_COPY_LIST_2_LINK_1",helpId:"/node/19865"}],hasDontShowAgainCheckbox:!0},FT_HELP_AFTER_ENABLE_PAGE:{titleKey:"FT_HELP_AFTER_ENABLE_PAGE_Title",descriptionKey:"FT_HELP_AFTER_ENABLE_PAGE_Description",iconFileName:"ft-item-page-icon.png",links:[{titleKey:"FT_HELP_AFTER_ENABLE_PAGE_1",helpId:"/node/14834"},{titleKey:"FT_HELP_AFTER_ENABLE_PAGE_2",helpId:"/node/19865"}],hasDontShowAgainCheckbox:!0},FT_HELP_ADDING_TAGS_TO_ITEM:{titleKey:"FT_HELP_ADDING_TAGS_TO_ITEM_Title",descriptionKey:"FT_HELP_ADDING_TAGS_TO_ITEM_Description",links:[{titleKey:"FT_HELP_ADDING_TAGS_TO_ITEM_Open_Filter_Panel",command:{name:"WAppsEditor2Commands.OpenFilterPanel",parameters:{logicalTypeName:"IB.TagsFilteredList"}},closeBubble:!0,style:"button"}],hasDontShowAgainCheckbox:!1,alwaysShow:!0,minHeight:150},FT_START_USING_TAGS:{titleKey:"FT_START_USING_TAGS_Title",descriptionKey:"FT_START_USING_TAGS_Description",links:[{titleKey:"FT_START_USING_TAGS_Open_Edit_Item_Panel",command:{name:"WAppsEditor2Commands.OpenEditItemPanel",parameters:{focusOn:"tags",origin:"StartUsingTagsBubble"}},closeBubble:!0,style:"button",dontShowAgain:!0}],hasDontShowAgainCheckbox:!0,minHeight:150},FT_FILTER_TAGS:{titleKey:"FT_FILTER_TAGS_Title",descriptionKey:"FT_FILTER_TAGS_Description",hasDontShowAgainCheckbox:!0,minHeight:100,nonModal:!0},FT_UoU_FILTERING_ENABLED:{titleKey:"FT_UoU_FILTERING_ENABLED_Title",descriptionKey:"FT_UoU_FILTERING_ENABLED_Description",hasDontShowAgainCheckbox:!0,minHeight:100}}}),b.fields({}),b.methods({initialize:function(a){this._appsEditor2=a,this._logger=new this.imports.WixAppsLogger},showBubble:function(a,b){function c(){if(!b.anchorElement.isNodeDisplayed())return this.resources.W.Utils.callLater(c.bind(this)),void 0;var a=b.anchorElement.getPosition(),e=b.anchorElement.getSize(),g={top:a.y+e.y/2-this.ARROW_VGAP-window.scrollY,left:a.x+e.x+this.ARROW_HGAP,nonModal:d.nonModal||!1,minHeight:d.minHeight||200};this._openBubbleDialog(f,g,b)}var d=this.Sets[b.ftHelpSetName];if(d){var e=(d.links||[]).map(function(a){var b=_.clone(a);return b.title=this.localize(a.titleKey),delete b.titleKey,b}.bind(this)),f={helpLinks:e,title:this.localize(d.titleKey),description:this.localize(d.descriptionKey),iconSrc:d.iconFileName?"images/icons/"+d.iconFileName:"http://images/noimage.png",hasDontShowAgainCheckbox:d.hasDontShowAgainCheckbox};c.call(this)}},_openBubbleDialog:function(a,b,c){var d=c.appPart.getAppInstance();if(this._shouldOpenDialog(c.ftHelpSetName)){var e=this._getDontShowAgainKeyPerSet(c.ftHelpSetName),f=new this.imports.BubblePresenter(c.appPart,a,e),g=this.resources.W.AppsGUI.getDialogParams("","","basicPopup");g=_.assign(g,{width:370,allowScroll:!1,position:Constants.DialogWindow.POSITIONS.DYNAMIC,buttonSet:this.resources.W.EditorDialogs.DialogButtonSet.NONE,left:b.left,top:b.top,minHeight:b.minHeight,nonModal:b.nonModal,semiModal:!0,allowDrag:!1,dialogSkin:"wixapps.integration.skins.dialogs.HelpBubbleDialogWindowSkin"}),this.resources.W.AppsGUI.openDialog(d,"FTHelpBubble_2",f,g,[]),this._logger.reportEvent(this._logger.Events.BUBBLE_OPENED,{g1:a.title})}},_shouldOpenDialog:function(a){var b=this.Sets[a];if(b&&b.alwaysShow)return!0;var c=this.resources.W.Editor.getEditorPreferences(),d=c.get("dontShowAgainDialogs"),e=d.contains(this._getDontShowAgainKeyPerSet(a));return!e},_getDontShowAgainKeyPerSet:function(a){return"appbuilder_help_bubble_"+a},localize:function(a){return this._appsEditor2.localize(a)}})}),define.Class("wixapps.integration.managers.CustomSystemFuctions",function(a){var b=a;b.resources(["W.Theme"]),b.methods({setupCustomFunctions:function(a){var b=this;a.addFunctionWithTrigger("Theme.getColor",function(a){return b.resources.W.Theme.addEvent(Constants.DataEvents.DATA_CHANGED,function(){a()}),function(a){return _.has(b.resources.W.Theme.getProperties(),a)?b.resources.W.Theme.getProperty(a).toString():a}}),a.addFunctionWithTrigger("Theme.getRGBAColor",function(a){return b.resources.W.Theme.addEvent(Constants.DataEvents.DATA_CHANGED,function(){a()}),function(a,c){if(_.has(b.resources.W.Theme.getProperties(),a)){var d=b.resources.W.Theme.getProperty(a);return d.setAlpha(c),"rgba("+d.getRgba()+")"}return a}})}})}),define.Class("wixapps.integration.managers.FieldHighlightHandler",function(a){var b=a;b.inherits(),b.utilize([]),b.traits([]),b.binds([]),b.fields({_highlightedFields:[],_highlightedContainers:[],_editPanelParams:null}),b.methods({initialize:function(){},_resolveHighlightContainer:function(a){switch(a.$className){case"wixapps.integration.proxies.ImageProxy":case"wixapps.integration.proxies.VideoProxy":return a.getElement().firstChild;default:return a.getElement()}},_createFieldRect:function(a){var b=new Element("div",{styles:{border:"1px solid #FFC700","background-color":"#FFDD55",opacity:.3,position:"absolute",top:"0px",right:"0px",bottom:"0px",left:"0px"}});this._highlightedFields.push(b);var c=this._resolveHighlightContainer(a),d=c.getStyle("position");("static"===d||"inherit"===d)&&(c.oldPosition=d,c.setStyle("position","relative")),c.adopt(b)},_createContainerRect:function(a){a.getElement().setStyles({"outline-style":"dashed","outline-width":"1px","outline-offset":"0px","outline-color":"#FFC700"}),this._highlightedContainers.push(a.getElement())},_clearFieldRects:function(){for(;this._highlightedFields.length;){var a=this._highlightedFields.pop();a&&a.parentElement&&a.parentElement.oldPosition&&a.parentElement.setStyle("position",a.parentElement.oldPosition),a.destroy()}},_clearContainerRects:function(){for(;this._highlightedContainers.length;)this._highlightedContainers.pop().setStyles({"outline-style":null,"outline-width":null,"outline-offset":null,"outline-color":null})},highlightField:function(a){a.isInEditPanel&&(this._editPanelParams=a),null!==this._editPanelParams&&this.removeHighlightField({appPart:a.appPart,isInEditPanel:!1},!0);var b=a.appPart.getViewNode();if(b){var c=b.getElements("[vcfield="+a.fieldId+"_proxy]").map(function(a){return a.getViewProxy()}),d=b.getElements("[vcfield="+a.containerId+"]").map(function(a){return a.getViewProxy()}),e=this;d.forEach(function(a){e._createContainerRect(a,b)}),c.forEach(function(a){e._createFieldRect(a,b)})}},removeHighlightField:function(a,b){this._clearContainerRects(),this._clearFieldRects(),b!==!0&&(a.isInEditPanel?this._editPanelParams=null:null!==this._editPanelParams&&this.highlightField(this._editPanelParams))},_createFieldRect2:function(a){a.getElement().setStyles({"outline-style":"dashed","outline-width":"1px","outline-offset":"0px","outline-color":"#0033ff"}),this._highlightedFields.push(a.getElement())},_clearFieldRects2:function(){for(;this._highlightedFields.length;)this._highlightedFields.pop().setStyles({"outline-style":null,"outline-width":null,"outline-offset":null,"outline-color":null})}})}),define.Class("wixapps.integration.managers.LifecycleManager",function(a){var b=a;b.binds(["_defaultInvalidateLayoutAction","_onProxyIrrecoverable"]),b.fields({_dispatcher:null,_pendingComponents:[],_pendingActions:{},_irrecoverableContainers:[]}),b.statics({ExecutionOrder:{Early:-1,Normal:0,Late:1}}),b.methods({initialize:function(a){this._dispatcher=a,this._dispatcher.addEvent(Constants.WixAppEvents.PROXY_IRRECOVERABLE,this._onProxyIrrecoverable)},notifyComponentCreated:function(a){-1==this._pendingComponents.indexOf(a)&&this._pendingComponents.push(a)},notifyComponentReady:function(a){var b=this._pendingComponents.indexOf(a);b>-1&&this._pendingComponents.splice(b,1),this._performCleanup(),0===this._pendingComponents.length&&_.defer(this._executeAllPendingActions.bind(this))},reset:function(){this._pendingComponents=[],this._pendingActions={}},performAction:function(a,b){b=b||this.ExecutionOrder.Normal,this._pendingActions[b]||(this._pendingActions[b]=[]),-1==this._pendingActions[b].indexOf(a)&&this._pendingActions[b].push(a),this._performCleanup(),0===this._pendingComponents.length&&_.defer(this._executeAllPendingActions.bind(this))},_performCleanup:function(){var a=this._pendingComponents;this._pendingComponents=[];for(var b=0;b<a.length;b++){var c=a[b];this._waitsForWixification(c)&&this._pendingComponents.push(c)}},_waitsForWixification:function(a){return a.$viewProxy.isWixificationPending()},_executeAllPendingActions:function(){if(0===this._pendingComponents.length){var a=this._pendingActions;this._pendingActions={},Object.keys(a).sort().each(function(b){a[b].each(function(a){a()})})}},_defaultInvalidateLayoutAction:function(){this._dispatcher.fireEvent(Constants.WixAppEvents.APP_VIEW_READY)},getDefaultInvalidateLayoutAction:function(){return this._defaultInvalidateLayoutAction},_onProxyIrrecoverable:function(a){var b=Boolean(0===this._irrecoverableContainers.length),c=a.sender,d=c.getElement().getParents("[hasproxy]")[0]?c.getElement().getParents("[hasproxy]")[0].getViewProxy():null;d&&-1===this._irrecoverableContainers.indexOf(d)&&this._irrecoverableContainers.push(d),c.dispose(),b&&window.requestAnimFrame(function(){for(;this._irrecoverableContainers.length;){var a=this._irrecoverableContainers.shift();a.isDisposed()||a._reloadProxy()}}.bind(this))}})}),define.Class("wixapps.integration.managers.StylesheetManager",function(a){var b=a;b.inherits(),b.utilize([]),b.traits([]),b.binds(["_onDataChange"]),b.resources(["W.Utils"]);var c=null;b.fields({_namespace:"",_stylesheetItems:[],_cssRules:[],_stylesheet:null}),b.methods({initialize:function(a){this._namespace=a},addStylesheetItem:function(a,b){var c={namespace:this._namespace,viewName:a.getViewName(),forType:a.getForType()},d='{{namespace}} {{key}}[vcview="{{viewName}}"][vctype="{{forType}}"]',e="{{namespace}} {{key}}";_.each(b.getChildren(),function(a){var b,f=a.getChildrenRefs()[0],g=_.clone(c);f.match(/^\s*%view%\s*/)?(g.key=f.replace("%view%","").trim(),b=_.template(d,g)):(g.key=f,b=_.template(e,g));var h=a.getChildByRef(f);this._registerDataItem(h),this._cssRules.push({selector:b,data:h})}.bind(this))},_registerDataItem:function(a){_.contains(this._stylesheetItems,a)||(this._stylesheetItems.push(a),a.addEvent(Constants.DataItemEvents.CHANGE,this._onDataChange))},updateDocumentStylesheet:function(){var a=this._getTargetCSSStyleSheet();_.each(this._cssRules,function(b){this._updateStylesheetItem(a,b.selector,b.data)}.bind(this))},_updateStylesheetItem:function(a,b,c){var d=c.getValue(),e=_.map(d,function(a,b){return b+":"+a}).join("; "),f=_.findIndex(this._getStylesheetRules(a),function(a){return a.selectorText===b});if(f>-1){var g=this._getStylesheetRules(a)[f];g.cssText!==e&&(this._removeStylesheetRule(a,f),this._addStylesheetRule(a,b,e))}else this._addStylesheetRule(a,b,e)},_getStylesheetRules:function(a){return a.cssRules||a.rules},_addStylesheetRule:function(a,b,c){try{a.insertRule?a.insertRule(b+" {"+c+"}",a.cssRules.length):a.addRule(b,c,-1)}catch(d){}},_removeStylesheetRule:function(a,b){a.deleteRule?a.deleteRule(b):a.removeRule(b)},_getTargetCSSStyleSheet:function(){return c=c||this.resources.W.Utils.createStyleSheet("WixAppsStylesheet")},_onDataChange:function(a){var b=this,c=this._getTargetCSSStyleSheet(),d=_.filter(this._cssRules,function(b){return Boolean(a.target===b.data)});_.each(d,function(a){b._updateStylesheetItem(c,a.selector,a.data)})},reset:function(){var a=this._getTargetCSSStyleSheet();_.each(this._cssRules,function(b){var c=_.findIndex(this._getStylesheetRules(a),function(a){return a.selectorText===b.selector});c>-1&&a.deleteRule(c)}.bind(this)),_.forEach(this._stylesheetItems,function(a){a.removeEvent(Constants.DataItemEvents.CHANGE,this._onDataChange)})},dispose:function(){this.reset(),this._stylesheetItems=null}})}),define.Class("wixapps.integration.managers.ViewHolder",function(a){var b=a;b.inherits("bootstrap.utils.Events"),b.utilize(["wixapps.core.events.ProxyEventBus","wixapps.integration.managers.AppResizeHandler","wixapps.integration.managers.LifecycleManager","wixapps.core.views.ProxyFactory","wixapps.integration.proxies.ProxyMap","wixapps.integration.utils.LayoutGeometryMap","wixapps.integration.managers.StylesheetManager"]);var c=0;b.fields({_viewHolderID:0/0,_container:null,_rootProxy:null,_data:null,_viewName:"",_vars:null,_geometryMap:null}),b.methods({initialize:function(a,b,d,e,f,g,h){this._viewHolderID=c++,this._eventDispatcher=new this.imports.ProxyEventBus,this._resizeHandler=new this.imports.AppResizeHandler,this._lifecycleManager=new this.imports.LifecycleManager(this._eventDispatcher,g||!1),this._resourceResolverFunction=e,this._nameSpace=f,this._geometryMap=new this.imports.LayoutGeometryMap,this._stylesheetManager=new this.imports.StylesheetManager(".viewHolder"+this._viewHolderID.toString()),this._proxyFactory=new this.imports.ProxyFactory(a,b,d,this._eventDispatcher,this._resourceResolverFunction,this._nameSpace,this._lifecycleManager,h,this._stylesheetManager),(new this.imports.ProxyMap).registerComponentProxies(this._proxyFactory)},setContainer:function(a){this._container&&this.destroyContent(),"static"==a.getStyle("position")&&a.setStyle("position","relative"),this._container=a},setupViewHolder:function(a,b,c,d){this._formatName=c||"",this._data=a,this._viewName=b,this._vars=d,this._container&&this._updateContent()},setContentHeight:function(a){this._rootProxy.getElement().setStyle("height",a)},invalidateSize:function(){this._eventDispatcher.fireEvent(Constants.WixAppEvents.APP_PART_RESIZE)},getGeometryMap:function(){return this._geometryMap},_updateContent:function(){var a=this._rootProxy;this._stylesheetManager.reset(),this._rootProxy=this._proxyFactory.createView(this._data,this._viewName,this._formatName,this._vars),this._stylesheetManager.updateDocumentStylesheet(),this._updateDirectionInVars();var b=this._rootProxy.createComponent();this._container.addClass("viewHolder"+this._viewHolderID.toString()),this.destroyContent(),this._container.adopt(b),this._resizeHandler.activateResizeHandler(this._eventDispatcher,b),this._rootProxy.setupProxy(),a&&a.dispose(),window.requestAnimFrame(function(){this._lifecycleManager.performAction(function(){this._eventDispatcher.fireEvent(Constants.WixAppEvents.APP_VIEW_READY),this._eventDispatcher.fireEvent(Constants.WixAppEvents.APP_VIEW_CREATED)}.bind(this))}.bind(this))},_updateDirectionInVars:function(){var a=this._rootProxy.getViewContext().getEnvironment();a.getVar("partDirection")||a.setVar("partDirection","ltr")},getRootProxy:function(){return this._rootProxy},getEventDispatcher:function(){return this._eventDispatcher},performActionWhenReady:function(a){this._lifecycleManager.performAction(a)},performActionWhenReadyLate:function(a){this._lifecycleManager.performAction(a,this._lifecycleManager.ExecutionOrder.Late)},destroyContent:function(){this._container&&this._container.empty(),this._geometryMap.dispose()
},dispose:function(){this._stylesheetManager.dispose(),this._rootProxy&&(this._rootProxy.dispose(),this._rootProxy=null),this.destroyContent(),this._container=null,this._data=null}})}),define.Class("wixapps.integration.managers.ViewHolderFactory",function(a){var b=a;b.utilize(["wixapps.integration.managers.ViewHolder","wixapps.core.data.DataItemFactory","wixapps.core.managers.TypesManager","wixapps.core.views.ViewDefinitionsRepository"]),b.methods({intialize:function(){},createViewHolder:function(a,b,c,d){var e=new this.imports.DataItemFactory,f=new this.imports.TypesManager,g=new this.imports.ViewDefinitionsRepository(e);this._fillMissingIdsForItem(b,0);for(var h=Constants.WixAppsSystemTypes,i=0;i<h.length;i++)f.registerType(h[i]);b.name="TheGreatView",b.forType="Array"!=b.forType?"wix:Object":"Array",b.vars=b.vars||{},g.setViewDefinition(b,!1);var j=new this.imports.ViewHolder(e,f,g,function(){},"",!1,{getAppPageUrl:function(){return""}});j.setContainer(a);var k=e.createDataItem(c);return j.setupViewHolder(k,"TheGreatView",d),j},_fillMissingIdsForItem:function(a,b){a.id=a.id||a.data||"def_"+b;var c=b+1,d=this;return a.comp&&a.comp.items&&a.comp.items.forEach&&a.comp.items.forEach(function(a){c=d._fillMissingIdsForItem(a,c)}),a.comp&&a.comp.templates&&Object.each(a.comp.templates,function(a){c=d._fillMissingIdsForItem(a,c)}),a.comp&&a.comp.cases&&Object.each(a.comp.cases,function(a){"array"===typeOf(a)?a.forEach(function(a){c=d._fillMissingIdsForItem(a,c)}):c=d._fillMissingIdsForItem(a,c)}),a.comp&&a.comp.columns&&"Table"==a.comp.name&&a.comp.columns.forEach(function(a){Array.forEach(["item","header","footer"],function(b){void 0!==a[b]&&(c=d._fillMissingIdsForItem(a[b],c))})}),c}})}),define.Class("wixapps.integration.managers.WixAppsEditorData",function(a){var b=a;b.inherits("wixapps.integration.managers.WixAppsEditorDataBase"),b.methods({_setupData:function(){this._addDataPanels(),this._registerAppPartsInAppStore()},_addDataPanels:function(){this.addDataPanel("AppPart","wixapps.integration.components.AppPart",{logic:"wixapps.integration.components.editor.AppPartDataPanel",skin:"wysiwyg.editor.skins.panels.base.AutoPanelSkin"}),this.addDataPanel("AppBuilderComponent","wixapps.integration.components.AppPart2",{logic:"wixapps.integration.components.panels.ListSettingsPanel",skin:"wysiwyg.editor.skins.panels.base.AutoPanelSkin"})},_registerAppPartsInAppStore:function(){this.registerAppPartsInAppStore("faq","9692d594-acfc-42da-9c01-7c140f04beeb","f2c4fc13-e24d-4e99-aadf-4cff71092b88"),this.registerAppPartsInAppStore("menu","e4c4a4fb-673d-493a-9ef1-661fa3823ad7","1660c5f3-b183-4e6c-a873-5d6bbd918224"),this.registerAppPartsInAppStore("news","491f9ddf-cbfd-402b-9991-0ff6e336470d","045dd836-ef5d-11e1-ace3-c0dd6188709b"),this.registerAppPartsInAppStore("ecommerce","55a88716-958a-4b91-b666-6c1118abdee4","30b4a102-7649-47d9-a60b-bfd89dcca135"),this.registerAppPartsInAppStore("ecommerce","55a88716-958a-4b91-b666-6c1118abdee4","adbeffec-c7df-4908-acd0-cdd23155a817"),this.registerAppPartsInAppStore("ecommerce","55a88716-958a-4b91-b666-6c1118abdee4","f72a3898-8520-4b60-8cd6-24e4e20d483d"),this.registerAppPartsInAppStore("ecommerce","55a88716-958a-4b91-b666-6c1118abdee4","c029b3fd-e8e4-44f1-b1f0-1f83e437d45c"),this.registerAppPartsInAppStore("ecommerce","55a88716-958a-4b91-b666-6c1118abdee4","cd54a28f-e3c9-4522-91c4-15e6dd5bc514"),this.registerAppPartsInAppStore("ecommerce","55a88716-958a-4b91-b666-6c1118abdee4","c614fb79-dbec-4ac7-b9b0-419669fadecc"),this.registerAppPartsInAppStore("ecommerce","55a88716-958a-4b91-b666-6c1118abdee4","5fca0e8b-a33c-4c18-b8eb-da50d7f31e4a"),this.registerAppPartsInAppStore("blog","61f33d50-3002-4882-ae86-d319c1a249ab","31c0cede-09db-4ec7-b760-d375d62101e6"),this.registerAppPartsInAppStore("blog","61f33d50-3002-4882-ae86-d319c1a249ab","1b8c501f-ccc2-47e7-952a-47e264752614"),this.registerAppPartsInAppStore("blog","61f33d50-3002-4882-ae86-d319c1a249ab","33a9f5e0-b083-4ccc-b55d-3ca5d241a6eb"),this.registerAppPartsInAppStore("blog","61f33d50-3002-4882-ae86-d319c1a249ab","f72fe377-8abc-40f2-8656-89cfe00f3a22"),this.registerAppPartsInAppStore("blog","61f33d50-3002-4882-ae86-d319c1a249ab","a38ae0cf-96a6-4f6f-b261-4ca6a7f33dfb"),this.registerAppPartsInAppStore("blog","61f33d50-3002-4882-ae86-d319c1a249ab","ea63bc0f-c09f-470c-ac9e-2a408b499f22"),this.registerAppPartsInAppStore("blog","61f33d50-3002-4882-ae86-d319c1a249ab","4de5abc5-6da2-4f97-acc3-94bb74285072"),this.registerAppPartsInAppStore("blog","61f33d50-3002-4882-ae86-d319c1a249ab","e000b4bf-9ff1-4e66-a0d3-d4b365ba3af5"),this.registerAppPartsInAppStore("blog","61f33d50-3002-4882-ae86-d319c1a249ab","43c2a0a8-f224-4a29-bd19-508114831a3a"),this.registerAppPartsInAppStore("playlist","7f5f4fd6-b932-4ede-93db-8ed46f63218f","64f3d173-b4e2-408d-967d-c9ed2bd28125"),this.registerAppPartsInAppStore("miniposts","bf1334c9-9fc0-47a4-adbb-24b702bdb612","053ad9f8-5dce-4c14-ad1f-97397d5bbfe9"),this.registerAppPartsInAppStore("miniposts","bf1334c9-9fc0-47a4-adbb-24b702bdb612","536f7aa5-d722-4048-a1c7-64c9d9c00b33"),this.registerAppPartsInAppStore("youtubeGallery","da747fb0-a04b-4479-81d5-0cd0cd5cc2ea","58806dcd-9fb4-42f9-8ac8-8a8ea2db99a3"),this.registerAppPartsInAppStore("wixpix","92caab98-5c6b-404d-91f8-63fa2b38f104","8e5d8989-8680-4ecb-9edf-289e5be2ffae")}})}),define.Class("wixapps.integration.managers.WixAppsEditorDataBase",function(a){var b=a;b.binds(["_setupData"]),b.methods({initialize:function(){this.appsDefinitionData={}},setup:function(){this._setupData()},_setupData:function(){},addLanguageKey:function(a,b){this.resource.getResourceValue("W.Resources",function(c){c.bundles.EDITOR_LANGUAGE[a]=b})},addDataPanel:function(a,b,c){this.resource.getResourceValue("W.Editor",function(d){d.addDataPanel(a,b,c)})},registerAppPartsInAppStore:function(a,b,c){var d=this.appsDefinitionData[b];d||(d={appDefinitionId:b,widgets:{}},this.appsDefinitionData[b]=d),d.widgets[c]={widgetId:c}}})}),define.Class("wixapps.integration.managers.WixAppsLocalizer",function(a){var b=a;b.inherits("wixapps.integration.managers.BaseLocalizer"),b.fields({}),b.binds(["_bundleLoaded"]),b.methods({_ensureBundleLoaded:function(){this._resourceManager.bundles.hasOwnProperty("WIXAPPS_LANGUAGE")||this._resourceManager.loadLanguageBundle("WIXAPPS_LANGUAGE",this._bundleLoaded)},_bundleLoaded:function(){this._isReady=!0},localize:function(a,b){return this._resourceManager.get("WIXAPPS_LANGUAGE",a,b)||"["+a+"]"}})}),define.Class("wixapps.integration.managers.WixAppsManager",function(a){var b=a;b.utilize(["wixapps.integration.managers.ApplicationInstance","wixapps.core.utils.WixAppsLogger"]),b.resources(["scriptLoader","topology","W.Viewer","W.Config","W.Utils","W.Data","W.Experiments","mode"]),b.traits(["wixapps.integration.components.traits.LoadTimeMeasurementTrait"]),b.fields({_isReady:!1,_userRole:"none"}),b.methods({initialize:function(){this.logStepLoadTime("manager initialization"),this._initialize(),this._isReady=!0,this.logStepLoadTime("manager ready")},_initialize:function(){this._appInstanceMap={},this._appDescriptorMap={},this._descriptionCallBacks={},this._logger=new this.imports.WixAppsLogger,this.resources.W.Utils.AppsUtils.getUserRole(function(a){this._userRole=a}.bind(this)),this.registerAppPageConfiguration(),this._loadInstalledApps()},registerAppPageConfiguration:function(){var a=this._getPageConfigurationRepository();a.registerPageType("AppPage",function(a){return"AppPage"===a.appPageType?a.appPageId:a.appPageType})},_getPageConfigurationRepository:function(){return this.resources.W.Viewer.getPageConfigurationRepository()},_loadInstalledApps:function(){var a=this.resources.W.Viewer.getAppDataHandler().getAppsData();Object.each(a,function(a){-1!=["wixapps","ecommerce"].indexOf(a.type)&&(this.logStepIfCondition("loading ecom","ecommerce"==a.type),this.loadApplication(a))},this)},isReady:function(){return this._isReady},loadApplication:function(a,b){var c=new this.imports.ApplicationInstance(a);this._appInstanceMap[a.applicationId]=c,c.loadDescriptor(b)},reloadApplication:function(a){return this._appInstanceMap[a.applicationId]?(this._appInstanceMap[a.applicationId].updateFromAppSpec(a),!0):(this.loadApplication(a),!1)},getApp:function(a){return this._appInstanceMap[a]||this._logger.reportError(this._logger.Errors.APP_INSTANCE_NOT_LOADED,this.$className,"getApp",this._logger.SubCategory.CORE_WIRING),this._appInstanceMap[a]},getAppByPackageName:function(a){var b=this.getAppIdByPackageName(a);return null!=b?this._appInstanceMap[b]:null},getAppIdByPackageName:function(a){for(var b in this._appInstanceMap)if(this._appInstanceMap[b].getPackageName()==a)return b;return null},_loadExternalAppManifest:function(a,b,c){var d=this.resources.topology[a],e=this.resources.mode.debug?"index.debug.json":"index.json",f=this;this.resources.scriptLoader.loadManifestFromUrl(d+"/"+e,function(){f.resource.getResourceValue(b,function(a){f.registerAppDescriptor(a),c&&c(a)})},function(){f._logger.reportError(f._logger.Errors.FAILED_TO_LOAD_EXTERNAL_APP_MANIFEST,f.$className,"_loadExternalAppManifest",f._logger.SubCategory.CORE_WIRING)})},requestAppDescriptor:function(a,b){return this._appDescriptorMap[a]?(b(this._appDescriptorMap[a]),void 0):(this.resources.W.Data.getDataByQuery("#WIXAPPS_EXTERNAL_APPS",function(c){var d=c.get("items")[a];if(void 0!==d)this._loadExternalAppManifest(a,d.descriptorResourceName,b);else{var e=this._buildDescriptorURL(a);this._loadDescriptorFile(e,a,b)}}.bind(this)),void 0)},getAppsDeploymentConfig:function(a){this.resource.getResourceValue("WixappsAppsDeployment",a)},_loadDescriptorFile:function(a,b,c){var d={id:"js",url:a},e={onLoad:function(){},onFailed:function(){}};this._descriptionCallBacks[b]=this._descriptionCallBacks[b]||[],this._descriptionCallBacks[b].push(c),this.resources.scriptLoader.loadResource(d,e)},_buildDescriptorURL:function(a){var b=this.resources.topology.wixapps+"/javascript/";return b+"wixapps/apps/"+a+"/descriptor.js"},registerAppDescriptor:function(a){a.experiments&&Object.each(a.experiments,function(b,c){var d=c.split("."),e={};e[d[0]]=d[1],this.resources.W.Experiments.isDeployed(e)&&b.apply(this,[a])}.bind(this));var b=0,c=a.packageName;if(this._appDescriptorMap[c]=a,this._descriptionCallBacks[c]){for(b=0;b<this._descriptionCallBacks[c].length;b++)this._descriptionCallBacks[c][b](a);delete this._descriptionCallBacks[c]}},getUserRole:function(){return this._userRole},openPermaLink:function(a){var b=a.get("dataItemRef"),c=W.Data.getDataByQuery(b),d=this._appInstanceMap[c.get("appInnerID")];d.getZoomHandler().openZoomFromHash(a)},setPageState:function(a,b){this._stateByPage||(this._stateByPage={}),this._stateByPage[a]=b},getPageState:function(a){var b=this._stateByPage&&this._stateByPage[a];return b||""}})}),define.Class("wixapps.integration.managers.WixAppsManager2",function(a){var b=a;b.utilize(["wixapps.core.apprepo.ApplicationInstance2","wixapps.core.apprepo.AppRepoTransport","wixapps.core.utils.WixAppsLogger","wixapps.core.data.selectors.AllItemsOfTypeDataSelector"]),b.statics({APP_BUILDER_APP_TYPE:"appbuilder",APP_BUILDER_APP_DEFINITION_ID:"3d590cbc-4907-4cc4-b0b1-ddf2c5edf297"}),b.binds(["_onPageTransitionEnded"]),b.resources(["W.Viewer","W.Config","W.Commands"]),b.fields({_appInstanceMap:{},_erroneousAppInstanceMap:{},_appInstWaitingList:{},_appRepoTransport:null,_isReady:!1,_loadRepoFunc:null,_dataSelectorsForType:{}}),b.methods({initialize:function(){this._appRepoTransport=new this.imports.AppRepoTransport,this._loadInstalledApps(),this._isReady=!0,this._logger=new this.imports.WixAppsLogger,this.resources.W.Viewer.addEvent("pageTransitionEnded",this._onPageTransitionEnded),this.registerAppBuilderPageConfiguration()},registerAppBuilderPageConfiguration:function(){var a=this._getPageConfigurationRepository();a.registerConfig("AppBuilderPage",{options:{canBeDeleted:!0,canBeDuplicated:!1,showSeoSettings:!1,canBeHidden:!1,isHidden:!0,canBeReordered:!0,canHaveChildren:!1,canBeAddedFromMenu:!1,canBeSetAsHomePage:!1,showBasicSettings:!1,repeaterPage:!0,canBeLinkedTo:!1}})},_getPageConfigurationRepository:function(){return this.resources.W.Viewer.getPageConfigurationRepository()},isReady:function(){return this._isReady},_onPageTransitionEnded:function(){var a=this._logger,b=this.resources.W.Viewer.getCurrentPageNode(),c=b.getLogic().getDataItem().getData();if(this._appInstanceMap.hasOwnProperty(c.appInnerID)){var d=this.resources.W.Config.env.$isEditorViewerFrame,e=d?a.Events.APP_BUILDER_MOVED_TO_APP_PAGE_IN_EDITOR:a.Events.APP_BUILDER_MOVED_TO_APP_PAGE_IN_VIEWER;a.reportEvent(e,{c1:c.id,c2:c.appPageId,i1:c.appInnerID})}},_registerAppInstance:function(a,b){this._appInstanceMap[a]=b},_loadInstalledApps:function(){var a=this.resources.W.Viewer.getAppDataHandler().getAppsData();this.resources.W.Commands.executeCommand("ApplicationPerformanceSpy.instanceLogPhase",{step:"requested repo from server"}),Object.each(a,function(a){if(a.type===this.APP_BUILDER_APP_TYPE){var b="Template"===a.state,c=a.instanceId===this.resources.W.Config.getMetaSiteId(),d=b||c;this.resources.W.Viewer.getAppDataHandler().registerAppData(a);var e=a.applicationId,f=a.instanceId;this._loadApplicationFromRepo(e,f,d)}},this)},_isAppInstalled:function(a){return void 0!==this.resources.W.Viewer.getAppDataHandler().getAppsData()[a]},_isAppLoaded:function(a){return void 0!==this._appInstanceMap[a]},_notifyAppInstanceReady:function(a){for(var b=this._getAppInstanceWaitingList(a),c=this._appInstanceMap[a];b.length>0;){var d=b.pop();d(c)}},_getAppInstanceWaitingList:function(a){var b=this._appInstWaitingList[a];return b||(b=[],this._appInstWaitingList[a]=b),b},_loadApplicationFromRepo:function(a,b,c){var d=function(d){var e=new this.imports.ApplicationInstance2(b,d,c);e.setApplicationId(a),e.setIsStubStore(c),this._registerAppInstance(a,e),this.resources.W.Commands.executeCommand("ApplicationPerformanceSpy.instanceLogPhase",{step:"repo was loaded",appInstance:e}),this._notifyAppInstanceReady(a)}.bind(this),e=function(d){this._logger.reportError(d,this.$className,"_loadApplicationFromRepo",this._logger.SubCategory.APP_REPO_SERVICE,this._logger.Severity.ERROR,this._logger.Category.VIEWER);var e=new this.imports.ApplicationInstance2(b);e.setApplicationId(a),e.setIsStubStore(c),e.setError(d),this._registerAppInstance(a,e),this._notifyAppInstanceReady(a)}.bind(this);this._getApplicationRepoInstance(b,d,e)},_getApplicationRepoInstance:function(a,b,c){W.Config.env.$isPublicViewerFrame?this._loadRepoFunc=this._appRepoTransport.getPublishedInstance.bind(this._appRepoTransport,a,b,c):this._appRepoTransport.getSavedInstance(a,b,c)},_createErroneousAppInstance:function(a,b){b=b||{code:-1};var c=new this.imports.ApplicationInstance2(a);return c.createErrorRepoItems(),c.setError(b),c},getErroneousAppInstance:function(a,b){return this._erroneousAppInstanceMap[a]||(this._erroneousAppInstanceMap[a]=this._createErroneousAppInstance(a,b)),this._erroneousAppInstanceMap[a]},getApplicationInstance:function(a,b){this._isAppLoaded(a)?b(this._appInstanceMap[a]):this._isAppInstalled(a)?(this._loadRepoFunc&&(this._loadRepoFunc(),this._loadRepoFunc=null),this._getAppInstanceWaitingList(a).push(b)):b(null)},getApplicationInstanceSync:function(a){return this._appInstanceMap[a]},createApplicationInstance:function(a,b){var c=new this.imports.ApplicationInstance2(b);return c.setApplicationId(a),c},getApplicationInstances:function(){return this._appInstanceMap},getNextGeneratedApplicationId:function(){var a=this.resources.W.Viewer.getAppDataHandler();return a.getLargestApplicationId()+1},getAppPart2Components:function(a){var b=this.resources.W.Viewer.getSiteView(Constants.ViewerTypesParams.TYPES.DESKTOP),c=b.getSiteNode().getElements("div[comp*='AppPart2']"),d=_(c).filter(function(a){return!a.getLogic||!a.getLogic()}).map(function(a){return a.get("id")}).compact().value(),e=_(c).filter(function(a){return a.getLogic&&a.getLogic()}).map(function(a){return a.getLogic()}).compact().value();if(a===!0&&d.length>0)throw"AppPart2 "+JSON.stringify(d)+" has missing logic";return e},getAppPartComponent:function(a){var b=this.getAppPart2Components(),c=b.filter(function(b){return b.getAppPartDefinition().getId()===a});return c&&c[0]},getClientSpecMapEntry:function(){var a=this.APP_BUILDER_APP_TYPE,b=this.resources.W.Viewer.getAppDataHandler(),c=b.getAppsData();return _.find(c,function(b){return b.type===a})},getInstanceIdFromClientSpecMap:function(){var a=this.getClientSpecMapEntry();return a?a.instanceId:null},getClientSpecMapId:function(){var a=this.getClientSpecMapEntry();return a?a.applicationId:null},getAllItemsOfTypeDataSelector:function(a,b){var c=b.getDataProviders().getWixDbDataProvider(),d=this._dataSelectorsForType[a];return d||(d=new this.imports.AllItemsOfTypeDataSelector(b,a,c),this._dataSelectorsForType[a]=d),this._dataSelectorsForType[a]}})}),define.Class("wixapps.integration.managers.applicationhandlers.ZoomHandler",function(a){var b=a;b.inherits("bootstrap.utils.Events"),b.binds(["validateZoomRelatedData"]),b.utilize([]),b.resources(["W.Data","W.Commands","W.Components","W.Utils","W.Viewer","W.Config"]),b.methods({initialize:function(a){this._applicationInstance=a},validateZoomRelatedData:function(){var a=this._applicationInstance.getDescriptorValue(["parts"]).filter(function(a){return!!a.zoomParams}),b=this;this.resources.W.Data.getDataItemsByType("PermaLink",function(c){var d=Object.values(c).map(function(a){return a.get("dataItemRef")});b.resources.W.Data.getDataByQueryList(d,function(d){b._initializePermaLinkAndPartDataMap(a,c,d),b.fireEvent("mapInitialized",b._permaLinkAndPartDataMap)})})},getZoomPartData:function(a,b){this._getPermaLinkAndZoomPartData(a,function(a){b(a&&a.partData)})},_getPermaLinkAndZoomPartData:function(a,b){var c=this,d=function(e){c.removeEvent("mapInitialized",d);var f=e[a];b(f)};this._permaLinkAndPartDataMap?d(this._permaLinkAndPartDataMap):this.addEvent("mapInitialized",d)},_initializePermaLinkAndPartDataMap:function(a,b,c){var d={};Object.forEach(c,function(a){a.get("appInnerID")==this._applicationInstance.getIdInMetasite()&&(d[a.get("appPartName")]=a)},this),this._permaLinkAndPartDataMap={},a.forEach(function(a){var c=this._getPermaLinkAndPartDataForPart(a,b,d);this._permaLinkAndPartDataMap[a.id]=c},this)},_getPermaLinkAndPartDataForPart:function(a,b,c){var d=this._getPermaLinkCorrectId(a),e=b["#"+d];return e||(e=this._getPermaLinkByPartName(b,c,a)),e?{permaLinkData:e,partData:c[a.id]}:this._addPermaLinkAndPartDataItem(a)},_getPermaLinkByPartName:function(a,b,c){var d=c.id,e=b[d]&&b[d].get("id");if(!e)return null;var f=Object.values(a).filter(function(a){return a.get("dataItemRef")=="#"+e}).pick();if(!f)return null;if(this.resources.W.Config.env.$isEditorViewerFrame){var g=this._addPermaLinkItem(c,b[d]);return f.set("correctPermaLinkRef","#"+g.get("id")),g}return f},_addPermaLinkAndPartDataItem:function(a){var b=this._applicationInstance.getIdInMetasite(),c=this.resources.W.Data.addDataItemWithUniqueId("appPart",{type:"AppPart",appInnerID:b,appLogicParams:{},appLogicCustomizations:[],appPartName:a.id,viewName:a.views[0]}),d=this._addPermaLinkItem(a,c.dataObject);return{permaLinkData:d,partData:c.dataObject}},_addPermaLinkItem:function(a,b){return this.resources.W.Data.addDataItem(this._getPermaLinkCorrectId(a),{type:"PermaLink",appType:"ListsApps",dataItemRef:"#"+b.get("id"),mutableSeoTitle:a.zoomParams&&a.zoomParams.urlTitle||""})},_getPermaLinkCorrectId:function(a){if(!a.zoomParams||!a.zoomParams.urlIdPrefix)throw"must define urlIdPrefix on the part definition -> zoomParams which is unique for the app";var b=this._applicationInstance.getIdInMetasite();return a.zoomParams.urlIdPrefix+b},openZoomFromHash:function(a){if(!this._detectCircularZoomUpdate()){var b=this._getZoomExtraParams(a);this.resources.W.Commands.executeCommand("WViewerCommands.OpenZoom",{item:this._getItemFromHash(),getDisplayerDivFunction:this._getAppPartDivFunction(a,b),getHashPartsFunction:this._getHashPartsFunction(a),extraParams:b},this)}},_getZoomExtraParams:function(a){var b=this.resources.W.Data.getDataByQuery(a.get("dataItemRef")),c=this._applicationInstance.getPartDefinition(b.get("appPartName")),d=this.resources.W.Config.mobileConfig.isMobile(),e=d?c.mobileZoomExtraParams:c.zoomExtraParams;return e||{}},_detectCircularZoomUpdate:function(){return this._lastOpenedItem&&(new Date).getTime()-this._lastOpenedItemTimestamp<1e3?this._getItemFromHash().id===this._lastOpenedItem.id:!1},openZoomForItemsList:function(a,b,c,d){var e=this;this._lastOpenedItem=a[b],this._lastOpenedItemTimestamp=(new Date).getTime(),this._getPermaLinkAndZoomPartData(c,function(c){var f=c&&c.partData;if(f&&d&&d.viewName){{e._applicationInstance.getPartDefinition(f.get("appPartName"))}f.set("viewName",d.viewName)}var g=c&&c.permaLinkData,h=e.resources.W.Data.createDataItem({type:"list",items:a},"list");e.resources.W.Commands.executeCommand("WViewerCommands.OpenZoom",{itemsList:h,currentIndex:b,extraParams:d||{},getDisplayerDivFunction:e._getAppPartDivFunction(g,d),getHashPartsFunction:e._getHashPartsFunction(g)},e)})},openZoomForNewItem:function(a,b,c){var d=this;this._getPermaLinkAndZoomPartData(a,function(a){var e=a&&a.permaLinkData,f=d.resources.W.Data.createDataItem({type:"list",items:[{title:"untitled",_iid:"newItem"}]},"list");d.resources.W.Commands.executeCommand("WViewerCommands.OpenZoom",{itemsList:f,currentIndex:0,extraParams:b||{},getDisplayerDivFunction:d._getAppPartDivFunction(e,c),getHashPartsFunction:d._getHashPartsFunction(e)},d)})},_getAppPartDivFunction:function(a,b){return function(c,d,e){this._createZoomContent(a,c,d,e,b)}.bind(this)},_getZoomPartSkinName:function(a){return a&&a.zoomPartSkin?a.zoomPartSkin:"wysiwyg.viewer.skins.area.CleanZoomAreaSkin"},_createZoomContent:function(a,b,c,d,e){var f,g="container"in c?"zoomLayout":"legacy",h=this.resources.W.Data.getDataByQuery(a.get("dataItemRef")),i=this._applicationInstance.getPartDefinition(h.get("appPartName")),j=this._getItemAppPartData(b,a,h,i);f=new Element("div"),"zoomLayout"==g&&c.container.adopt(f);var k=this;this.resources.W.Components.createComponent("wixapps.integration.components.AppPart",this._getZoomPartSkinName(e),j,null,function(a){var b=this.resources.W.Config.env;if(b.$isEditorViewerFrame&&b.$viewingDevice===Constants.ViewerTypesParams.TYPES.MOBILE){var c=this.resources.W.Viewer.getDocWidth();a.setMaxW(c)}a.setExtraLogicParams(e)}.bind(this),function(a){return Q.resolve().then(function(){return k._waitForAppPartReady(a)}).then(function(a){return k._renderZoomLayout(a,c.x,c.y)}).then(function(){return k.fireEvent("zoomContentChanged",a),k._updateAppPartSize(a)}).done(function(){k._listenToViewDefChanges(a,d),d(a.getViewNode())})},null,f)},_listenToViewDefChanges:function(a,b){var c=this,d=function(){Q.resolve().then(function(){return c._updateAppPartSize(a)}).done(function(){b(a.getViewNode())})};a.getMainProxy().getViewDefinition().addEvent(Constants.DataItemEvents.CHANGE,d),a.addEvent("proxyDisplayed",d)},_waitForAppPartReady:function(a){var b=Q.defer();return a.getMainProxy()&&a.getState().contains("content")?b.resolve(a.getMainProxy()):a.getEventDispatcher().addEvent(Constants.WixAppEvents.APP_VIEW_READY,function(){b.resolve(a.getMainProxy())}),b.promise},_renderZoomLayout:function(a,b,c){var d=Q.defer();return a.renderZoomLayout?(a.addEvent(Constants.WixAppEvents.APP_ZOOM_READY,function(){d.resolve(a)}),a.renderZoomLayout(b,c)):d.resolve(a),d.promise},_updateAppPartSize:function(a){var b=Q.defer();return a.setWidth(this._determineZoomWidth(a)),window.requestAnimFrame(function(){if(this._isMobile())this._updateMobileZoomHeight(a);else{var c=a._getMinPhysicalHeight();c&&(a.setHeight(c),a.$view.setStyles({height:c}))}a.fireEvent("autoSized"),b.resolve()}.bind(this)),b.promise},_isMobile:function(){return this.resources.W.Config.env.$viewingDevice===Constants.ViewerTypesParams.TYPES.MOBILE},_determineZoomWidth:function(a){return this._isMobile()?this.resources.W.Viewer.getDocWidth():a.getSkinPart("inlineContent").children[0].getSize().x},_updateMobileZoomHeight:function(a){var b=this.resources.W.Config.env.$viewingDevice===Constants.ViewerTypesParams.TYPES.MOBILE;if(b){var c=document.body.getSize().y;a.getHeight()<c&&(a._allowHeightResize=!0,a.setHeight(c))}},_getItemAppPartData:function(a,b,c,d){var e=this.resources.W.Data.createDataItem({type:c.getType()},c.getType());e.copySchemaFieldsFrom(c,!0);var f=e.get("appLogicParams"),g=d.zoomParams.itemIdParamName?d.zoomParams.itemIdParamName:"itemId";return f[g]={type:"AppPartParam",value:a.id},e},_setComponentSize:function(a,b,c,d){var e=a.defaultWidth?Math.min(a.defaultWidth,c):c,f=this.resources.W.Config.env.$viewingDevice===Constants.ViewerTypesParams.TYPES.MOBILE;f&&(e=this.resources.W.Viewer.getDocWidth()),b.setWidth(e),a.defaultHeight&&!f&&b.setHeight(a.defaultHeight),window.requestAnimFrame(function(){b.getMainProxy().updateLayoutWhenReady(function(){d(b.getViewNode())}.bind(this))}.bind(this))},_getHashPartsFunction:function(a){var b=this.resources.W.Data.getDataByQuery(a.get("dataItemRef")),c=this._applicationInstance.getPartDefinition(b.get("appPartName")).zoomParams;return function(b,d){var e=a.get("mutableSeoTitle"),f=e||c.urlTitle||"";d({id:a.get("id"),title:f,extData:this._getHashExtraDataString(b.id,b.title)})}.bind(this)},_getHashExtraDataString:function(a,b){return a+"/"+encodeURIComponent(b.toLowerCase().replace(/[\s|\/]+/gi,"-"))},_getItemFromHash:function(){var a=this.resources.W.Utils.hash.getHashParts().extData,b=a.split("/");return{id:b[0],title:b[1]}}})}),define.Const("WixAppsDefaultTypeValues",{String:"Text.",Number:0,Boolean:!1,Array:[],Object:{},"wix:Date":{_type:"wix:Date",iso:"1970-01-01T00:00:00.000Z"},"wix:Image":{_type:"wix:Image",title:"",src:"images/items/bloom.jpg",width:1280,height:850},"wix:Video":{_type:"wix:Video",videoId:"83nu4yXFcYU",videoType:"YOUTUBE"},"wix:Link":{_type:"wix:Link",linkType:"",href:"",label:"",target:"_blank",icon:""},"wix:NumberInRange":{_type:"wix:NumberInRange",value:0,minValue:0,maxValue:100},"wix:RichText":{_type:"wix:RichText",text:"RichText.",links:[],version:1},"wix:LinkBase":{_type:"wix:LinkBase"},"wix:TextLink":{_type:"wix:TextLink",text:"I am a text link",link:{_type:"wix:LinkBase"}},"wix:Location":{_type:"wix:Location",address:"",addressInfo:"",latitude:1970,longitude:1970},"wix:ImageList":{_type:"wix:ImageList",items:[{_type:"wix:LinkableImage",title:"Water Droplets",src:"cd6a81b7d29d88425609ecc053a00d16.jpg",description:"Describe your image here",width:1e3,height:750,link:{_type:"wix:LinkBase"}},{_type:"wix:LinkableImage",title:"Budding Tree",src:"44dab8ba8e2b5ec71d897466745a1623.jpg",description:"Describe your image here",width:1e3,height:750,link:{_type:"wix:LinkBase"}},{_type:"wix:LinkableImage",title:"Fallen Apples",src:"8dfce587e3f99f17bba2d3346fea7a8d.jpg",description:"Describe your image here",width:758,height:569,link:{_type:"wix:LinkBase"}}]}}),define.Const("WixAppsSystemTypes",[{_iid:"wix:Type",_type:"wix:Type",fields:[{name:"name",type:"String"},{name:"fields",type:"Array<wix:Field>"},{name:"validations",type:"Array<wix:Validation>",defaultValue:"[]"}]},{_iid:"wix:Field",_type:"wix:Type",fields:[{name:"name",type:"String"},{name:"type",type:"String"},{name:"defaultValue"},{name:"computed",type:"Boolean",defaultValue:!1},{name:"validations",type:"Array<wix:Validation>",defaultValue:[]}]},{_iid:"wix:Validation",_type:"wix:Type",fields:[{name:"func",type:"String"},{name:"params",type:"Array",defaultValue:[]}]},{_iid:"wix:Object",_type:"wix:Type",fields:[]},{_iid:"wix:Map",_type:"wix:Type",fields:[]},{_iid:"wix:Ref",_type:"wix:Type",fields:[{name:"itemId",type:"String"},{name:"collectionId",type:"String"}]},{_iid:"wix:Permission",_type:"wix:Type",fields:[{name:"collectionId",type:"String"},{name:"operation",type:"String"},{name:"role",type:"String"}]},{_iid:"wix:Customizations",_type:"wix:Type",fields:[{name:"rules",type:"Array<wix:Object>",defaultValue:[]}]},{_iid:"wix:Date",_type:"wix:Type",fields:[{name:"iso",type:"String",defaultValue:"1970-01-01T00:00:00.000Z",validations:[{func:"ne",params:["Invalid Date"]}]}]},{_iid:"wix:Image",_type:"wix:Type",fields:[{name:"title",type:"String",defaultValue:""},{name:"src",type:"String"},{name:"width",type:"Number"},{name:"height",type:"Number"}]},{_iid:"wix:Video",_type:"wix:Type",fields:[{_type:"wix:Field",name:"videoId",type:"String",defaultValue:"83nu4yXFcYU"},{_type:"wix:Field",name:"videoType",type:"String",defaultValue:"YOUTUBE"}]},{_iid:"wix:Link",_type:"wix:Type",fields:[{name:"linkType",type:"String"},{name:"href",type:"String"},{name:"label",type:"String"},{name:"target",type:"String"},{name:"icon",type:"String"}]},{_iid:"wix:NumberInRange",_type:"wix:Type",fields:[{name:"value",type:"Number"},{name:"minValue",type:"Number"},{name:"maxValue",type:"Number"}]},{_iid:"wix:RichText",_type:"wix:Type",fields:[{name:"text",type:"String",defaultValue:""},{name:"links",type:"Array<wix:PageLink,wix:DocLink,wix:ExternalLink,wix:MailLink,wix:AnchorLink>",defaultValue:[]},{name:"version",type:"Number",defaultValue:1}]},{_iid:"wix:MediaRichText",_type:"wix:Type",fields:[{name:"text",type:"String",defaultValue:""},{name:"links",type:"Array<wix:PageLink,wix:DocLink,wix:ExternalLink,wix:MailLink,wix:AnchorLink>",defaultValue:[]},{name:"imageList",type:"Array<wix:Image>",defaultValue:[]},{name:"videoList",type:"Array<wix:Video>",defaultValue:[]}]},{_iid:"wix:LinkBase",_type:"wix:Type",fields:[]},{_iid:"wix:PageLink",_type:"wix:Type",baseTypes:["wix:LinkBase"],fields:[{name:"pageId",type:"String"},{name:"linkId",type:"String"}]},{_iid:"wix:DocLink",_type:"wix:Type",baseTypes:["wix:LinkBase"],fields:[{name:"docId",type:"String"},{name:"docName",type:"String"},{name:"linkId",type:"String"}]},{_iid:"wix:ExternalLink",_type:"wix:Type",baseTypes:["wix:LinkBase"],fields:[{name:"address",type:"String"},{name:"target",type:"String"},{name:"protocol",type:"String"},{name:"linkId",type:"String"}]},{_iid:"wix:MailLink",_type:"wix:Type",baseTypes:["wix:LinkBase"],fields:[{name:"email",type:"String"},{name:"subject",type:"String"},{name:"linkId",type:"String"}]},{_iid:"wix:AnchorLink",_type:"wix:Type",baseTypes:["wix:LinkBase"],fields:[{name:"anchorName",type:"String"},{name:"anchorDataId",type:"String"},{name:"pageId",type:"String"}]},{_iid:"wix:Location",_type:"wix:Type",fields:[{name:"address",type:"String"},{name:"latitude",type:"Number"},{name:"longitude",type:"Number"},{name:"addressInfo",type:"String"}]},{_iid:"wix:TextLink",_type:"wix:Type",fields:[{name:"text",type:"String"},{name:"link",type:"wix:LinkBase"}]},{_iid:"wix:Audio",_type:"wix:Type",fields:[{name:"uri",type:"String"},{name:"title",type:"String"},{name:"originalFilename",type:"String"},{name:"iconUri",type:"String"}]},{_iid:"wix:LinkableImage",_type:"wix:Type",baseTypes:["wix:Image"],fields:[{name:"link",type:"wix:LinkBase",defaultValue:{_type:"wix:LinkBase"}},{name:"description",type:"String",defaultValue:""}]},{_iid:"wix:ImageList",_type:"wix:Type",fields:[{name:"items",type:"Array<wix:LinkableImage>",defaultValue:[]}]}]),define.Class("wixapps.integration.managers.preview.AppPart2ComponentDataProvider",function(a){var b=a;b.inherits("wysiwyg.editor.managers.preview.ComponentDataProvider"),b.methods({initialize:function(a,b){this.componentName=a,this.apps2Manager=b},getComponentFriendlyName:function(a){var b=a.get("appInnerID"),c=this.apps2Manager.getApplicationInstanceSync(b),d=c.getAppPartDefinitions(),e=a.get("appPartName"),f=d.getById(e);return f.getDisplayName()}})}),define.Class("wixapps.integration.managers.preview.AppPartComponentDataProvider",function(a){var b=a;b.inherits("wysiwyg.editor.managers.preview.ComponentDataProvider"),b.methods({initialize:function(a,b){this.componentName=a,this.appsManager=b},getComponentFriendlyName:function(a){var b=a.get("appInnerID"),c=a.get("appPartName"),d=this.appsManager.getApp(b),e=d.getPartDefinition(c);return e.name}})}),define.Class("wixapps.integration.managers.traits.FormsEditorManagerTrait",function(a){a.resources(["W.CompDeserializer","W.Components","W.AlignmentTools","W.Commands","W.CommandsNew","W.UndoRedoManager","W.Utils"]),a.fields({_appsUtils:null}),a.methods({initialize:function(){this.resources.W.Commands.registerCommandAndListener("WAppsEditor2Commands.CreateFormBuilder",this,this._createFormBuilder),this.resources.W.Commands.registerCommandAndListener("WAppsEditor2Commands.AddFieldToForm",this,this._addFieldToForm),this.resources.W.Commands.registerCommandAndListener("WAppsEditor2Commands.HideFormField",this,this._hideFormField),this.resources.W.Commands.registerCommandAndListener("WAppsEditor2Commands.ShowFormField",this,this._showFormField)
},_createFormFromTemplate:function(a,b,c){var d,e=this._viewBuilder.getFormTemplateDefinition(b);d=a.getDataProviders().getWixDbDataProvider(),d.registerDataItemsChange(this._addDataItemChangeEvent,this._removeDataItemChangeEvent);var f=Object.clone(e.type);d.updateTypeWithUniqueDisplayName(f),d.createType(f);var g=a.getDataSelectors().createAndRegister(c,d,f.name,{defaultValue:{}}),h=a.getFormDefinitions().createAndRegister(g,f.name,e.friendlyName);return this._addFormContainerComponent(a,h,e,f),h},_addFormContainerComponent:function(a,b,c,d){var e=a.getApplicationId(),f={comp:"wixapps.integration.components.common.formcontainer.viewer.FormContainer",components:[],data:{type:"FormContainer",appInnerID:e,formId:b},layout:{width:c.defaultWidth||500,height:c.defaultHeight||500},skin:"wixapps.integration.components.common.formcontainer.viewer.skins.FormContainerSkin"},g=this._typesHelper.getDisplayableFields(d),h={x:15,y:15};_.each(g,function(c){var e=this._createMiniPartDefinition(a,b,d,c),g={y:h.y,x:h.x},i=this._getFormFieldCompDefinition(a,e,c,g);f.components.push(i),h.y+=i.layout.height+15}.bind(this));var i={x:f.layout.width-150,y:f.layout.height-80};f.components.push(this._getSubmitButtonCompDef(a,b,i));var j={compDef:f};this.resources.W.Commands.executeCommand("WEditorCommands.AddComponentFullParams",j)},_createMiniPartDefinition:function(a,b,c,d){var e=this._viewBuilder.getBaseFieldTemplate(d.type,Constants.WixApps.FORM_INPUT_TEMPLATE_NAME,d.name);e.forType=c.name;var f=d.name+"_"+this.resources.W.Utils.getUniqueId();e.name=f;var g={label:d.displayName,labelSeparator:15,labelWidth:120};return e.vars=_.merge(e.vars||{},g),e=a.getViewsCustomizer().fillMissingIds(e),a.addViewDefinition(e),a.getMiniPartDefinitions().createAndRegister(b,f,d.name)},_getFormFieldCompDefinition:function(a,b,c,d){var e={componentType:"wixapps.integration.components.common.minipart.viewer.MiniPart",data:{type:"MiniPart",appInnerID:a.getApplicationId(),partId:b,field:c.name},layout:{width:200,height:30},skin:"wixapps.integration.components.common.minipart.viewer.skins.MiniPartSkin"};return d&&(e.layout.x=d.x,e.layout.y=d.y),e},_getSubmitButtonCompDef:function(a,b,c){var d={componentType:"wixapps.integration.components.common.submitbutton.viewer.SubmitButton",data:{type:"SubmitButton",label:this.localize("FORM_SETTINGS_PANEL_Submit","Submit"),appInnerID:a.getApplicationId(),formId:b},layout:{width:130,height:60,x:c.x,y:c.y},skin:"wysiwyg.viewer.skins.button.BasicButton",styleId:"b1"};return d},_hideFormField:function(a){var b=a.form.getFieldComponent(a.fieldDef.name);b&&this.resources.W.Editor.doDeleteComponent(b)},_showFormField:function(a){function b(){}var c=a.form.getFormDefinition().getId(),d=a.form.getAppInstance(),e=d.getMiniPartDefinitions().getByFormIdAndField(c,a.fieldDef.name),f=this._getPositionOfLastFieldComp(a.form),g={x:15,y:f.y+15},h=this._getFormFieldCompDefinition(a.form.getAppInstance(),e.getId(),a.fieldDef,g);this.resources.W.CompDeserializer.createAndAddComponent(a.form.$view,h,!0,!1,void 0,b)},_addFieldToForm:function(a){function b(){}var c=a.form.getAppInstance(),d=this._addFieldToTypeDef(a.form,a.fieldDef),e=a.form.getFormDefinition().getId(),f=this._createMiniPartDefinition(c,e,d,a.fieldDef),g=this._getPositionOfLastFieldComp(a.form),h={x:15,y:g.y+15},i=this._getFormFieldCompDefinition(a.form.getAppInstance(),f,a.fieldDef,h);this.resources.W.CompDeserializer.createAndAddComponent(a.form.$view,i,!0,!1,void 0,b)},_addFieldToTypeDef:function(a,b){var c=a.getAppInstance(),d=a.getFormDefinition(),e=d.getType(),f=_.cloneDeep(c.getTypesManager().getType(e));return b.name=W.Utils.getUniqueId(b.name),b.displayName=a.getUniqueFieldName(b.name,b.displayName),f.fields.push(b),c.getDataProviders().getWixDbDataProvider().updateType(f),f},_getPositionOfLastFieldComp:function(a){var b=a.getFieldsComponents();return b.length?_(b).map(function(a){return{x:a.getX(),y:a.getY()+a.getHeight()}}).max("y").value():{x:0,y:0}},_createFormBuilder:function(){var a=this;this.getAppBuilderApplicationInstance(function(b){a._reportUserAddedFormBuilder(),a._createFormFromTemplate(b,"BlankForm","IB.NewItemOfType")})},_onAddNewDataItem:function(a){this.resources.W.Preview.getPreviewManagersAsync(function(b){var c=this,d=function(b,d,e){c._addDataItemChangeEvent(b,d),a.fromUndo||(W.UndoRedoManager.startTransaction(),c.resources.W.Commands.executeCommand("WAppsEditor2Commands.Undo.DataChange",{dataProvider:d,dataSelectors:e,oldValue:null,newValue:b.getValue(),comp:a.comp,compId:a.compId}),W.UndoRedoManager.endTransaction()),a.onDataItemAdded&&a.onDataItemAdded(b,e)};b.Commands.executeCommand("WApps2Commands.AddNewDataItem",{comp:a.comp,compId:a.compId,rawData:a.rawData,dataSelectors:a.dataSelectors,itemIndex:a.itemIndex,action:a.action,onDataItemAdded:d,onError:a.onError})},this)},_reportUserAddedFormBuilder:function(){var a={};this._logger.reportEvent(this._logger.Events.APP_BUILDER_USER_ADDED_NEW_FORM,a)}})}),define.Class("wixapps.integration.proxies.AppLinkProxy",function(a){var b=a;b.inherits("wixapps.integration.proxies.layout.BoxLayoutProxy"),b.binds(["_onClicked","_onDataChanged","_scrollTop"]),b.utilize(["wixapps.core.utils.WixAppsLogger"]),b.resources(["W.Config","W.Utils"]),b.methods({_preventReflowCssClass:function(){return null},createComponent:function(){var a=this.parent();return a.addEvent("click",this._onClicked),this._element.addClass("wixAppsLink"),this._updateLink(),a},_getContainerElementType:function(){return"a"},_onDataChanged:function(){this._updateLink()},_updateLink:function(){var a=this._getHostingComponent(),b=a.getAppInstance(),c=this._resolveAppPageId(this._def.getChildValue("pageId")),d=this._def.getChildValue("linkType");if(("nextPage"===d||"prevPage"===d)&&"samePage"!==this._def.getChildValue("pageId"))throw"AppLinkProxy:: unable to create [nextPage]/[prevPage] page links. pageId should be [samePage]";var e=this;b.getPageLinkResolverPromise(c).then(function(b){if(!e.isDisposed()){var f=a.getLogicParams&&a.getLogicParams()||{};b.resolveLinkUrl(c,e._data,f,d,function(a){!e.isDisposed()&&e._element&&e._element.set("href","#!"+a)})}})},_getHostingComponent:function(){var a=this._viewContext.getEnvironment(),b=a.getProxyFactory();return b.getHostingComponent()},_resolveAppPageId:function(a){if("samePage"===a){if(this.resources.W.Config.env.$isEditorFrame)throw"AppLinkProxy:: cannot resolve [samePage] in editor.";a=W.Data.getDataByQuery("#"+W.Viewer.getCurrentPageId()).get("appPageId")}return a},_scrollTop:function(a){a.isForSureAfterChange&&($(document.body).scrollTo(0,0),this.resources.W.Utils.hash.removeEvent("change",this._scrollTop))},_onClicked:function(){if(this.resources.W.Utils.hash.addEvent("change",this._scrollTop),this.resources.W.Config.env.$isEditorViewerFrame){var a=new this.imports.WixAppsLogger;a.reportEvent(a.Events.APP_BUILDER_APP_LINK_CLICKED,{g1:this._def.getChildValue("pageId"),c1:this._element.get("href")})}}})}),define.Class("wixapps.integration.proxies.AreaProxy",function(a){var b=a;b.inherits("wixapps.integration.proxies.layout.BoxLayoutProxy"),b.utilize(["wixapps.integration.utils.flex.BoxFlexPolyfill"]),b.binds(["_applyBoxLayout"]),b.fields({}),b.methods({createComponent:function(){this._orientation=this._def.getChildValue("orientation")||this._getDefaultOrientation();var a=this._createWixComponent("wixapps.integration.components.Area",void 0,{allowDragChildren:!1,styleNS:this._def.getChildValue("styleNS")||"default"});return this._createChildComponents(a),a},_onComponentWixified:function(){this.parent(),this._componentLogic.addEvent(Constants.DisplayEvents.SKIN_CHANGE,this._applyBoxLayout),this._applyBoxLayout()},_applyBoxLayout:function(){var a=this._getLayoutRootElement();if(this._applyBoxFlexPolyfill(a),this._applyBoxStyles(a),this._setupBox(a),this._element.setStyle("position","relative"),this._componentLogic){var b=this._getInlineContent();this._isLayoutBasedHeight()?(this._componentLogic.getSkinPart("bg").setStyle("height","100%"),b.setStyle("position","absolute"),b.setStyle("height","100%")):(b.setStyle("position","relative"),b.setStyle("width","100%"))}},_getLayoutRootElement:function(){return this._getInlineContent()},_getInlineContent:function(){return this._componentLogic&&this._componentLogic.getSkinPart("inlineContent")},_getDefaultOrientation:function(){return"vertical"},_stylesMap:{"default":{skin:"wysiwyg.viewer.skins.area.AppleArea",style:"c1"},ecomCouponBox:{skin:"wysiwyg.viewer.skins.apps.DefaultBoxSkin",style:"ecom_cbx1"},ecomCartHeader:{skin:"wysiwyg.viewer.skins.apps.DefaultBoxSkin",style:"ecom_ch1"},ecomEmptyCartBG:{skin:"wysiwyg.viewer.skins.apps.DefaultBoxSkin",style:"ecom_ecbg1"}},_getDefaultSkinName:function(){var a=this._def.getChildValue("styleNS")||"default";return this._stylesMap[a].skin},_getDefaultStyleName:function(){var a=this._def.getChildValue("styleNS")||"default";return this._stylesMap[a].style},dispose:function(){this._componentLogic&&this._componentLogic.removeEvent(Constants.DisplayEvents.SKIN_CHANGE,this._applyBoxLayout),this.parent()}})}),define.Class("wixapps.integration.proxies.AudioInputProxy",function(a){var b=a;b.inherits("wixapps.integration.proxies.WProxy"),b.binds(["_onComponentDataChanged","_onFieldReady","_onMediaGalleryDataChange"]),b.methods({createComponent:function(){var a=(this._createRawData(),this._createWixComponent("wysiwyg.editor.components.inputs.AudioInput",null,{labelText:"",buttonText:this._def.getChildValue("label"),uri:this._data.getChildValue("uri"),originalFileName:this._data.getChildValue("originalFileName"),command:"WEditorCommands.OpenMediaFrame",secure:this._def.getChildValue("secure")||!1,mediaType:this._def.getChildValue("secure")===!0||"true"===this._def.getChildValue("secure")?"secure_music":"music",i18nPrefix:this._def.getChildValue("i18nPrefix"),commandParameter:{callback:this._onMediaGalleryDataChange}}));return a.addEvent(Constants.ComponentEvents.READY,this._onFieldReady),a},_getDefaultSkinName:function(){return"wysiwyg.editor.skins.inputs.AudioInputSkin"},_createRawData:function(){var a=this._data.getValue(),b=this._def.getValue();return{type:"AudioPlayer",uri:a.uri,autoPlay:b.autoPlay,loop:b.loop,visible:b.visible,volume:b.volume,title:a.title,description:a.description,icon_uri:void 0,originalFileName:a.title}},_onDataChanged:function(){this._updateAudioInputProxy()},_onFieldReady:function(){this._componentLogic&&(this._componentLogic.setValue(this._createRawData()),this._componentLogic.addEvent("inputChanged",this._onComponentDataChanged))},_onComponentDataChanged:function(){if(this._componentLogic){this._ignoreUpdate=!0;var a=this._componentLogic.getValue();if(a){var b=this._data.getValue(0);b.uri=a.uri,b.originalFileName=a.originalFileName,this._data.setValue(b)}this._ignoreUpdate=!1}},_onMediaGalleryDataChange:function(a){if(this._ignoreUpdate=!0,a){var b=this._data.getValue(0);b.uri=a.uri,b.originalFileName=a.fileName,b.title=a.title,b.songLength=Math.floor(a.duration/1e3),this._data.setValue(b),this._componentLogic.setValue(this._createRawData())}this._ignoreUpdate=!1},_updateAudioInputProxy:function(){},_getAcceptableDataTypes:function(){return["Audio"]}})}),define.Class("wixapps.integration.proxies.Button2Proxy",function(a){var b=a;b.inherits("wixapps.integration.proxies.WProxy"),b.utilize([]),b.binds(["_handleSizeChange"]),b.traits(["wixapps.integration.components.traits.ResizableProxyTrait","wixapps.integration.proxies.traits.AppsLinkTrait"]),b.resources(["W.Data"]),b.methods({createComponent:function(){var a=this._createWixComponent("wixapps.integration.components.SiteButton",this._createRawData(),void 0);return this._innerElement.hasAttribute("height")||this._innerElement.setAttribute("height",this._def.getChildValue("height")||"30"),a},_createRawData:function(){return{type:"LinkableButton",label:this._getLabel(this._data),link:""}},_getLabel:function(a){var b=null;b="String"==this._data.getTypeName()&&a.getValue(),b=b||this._def.getChildValue("label"),b=b||a.label;var c=new Element("div");return c.set("html",b),b=c.get("text")},_onDataChanged:function(a){a.phase===Constants.DataItemEventPhase.ON_TARGET&&(this._refresh(),this.parent(a))},_refresh:function(){this._componentLogic&&this._setNewData()},_setNewData:function(){var a=this._componentLogic.getDataItem();a.setData(this._createRawData())},_getPropSchemaName:function(){return"ButtonProperties"},_setupPropertyHandlers:function(){this._mapToCompProperty("align"),this._mapToCompProperty("margin","margin",function(a){return parseInt(a,10)}),this._handleProperties(["label"],function(){this._refresh()})},_stylesMap:{"default":{skin:"wysiwyg.viewer.skins.button.BasicButton",style:"b3"},ecomViewCart:{skin:"wysiwyg.viewer.skins.button.BasicButton",style:"ecom_vc1"},ecomCheckout:{skin:"wysiwyg.viewer.skins.button.DisabledLayerButton",style:"ecom_co1"},ecomAddToCart:{skin:"wysiwyg.viewer.skins.button.BasicButton",style:"ecom_atc1"},ecomRemoveFromCart:{skin:"wysiwyg.viewer.skins.button.FixedFontButton",style:"ecom_rfc1"},ecomApplyCoupon:{skin:"wysiwyg.viewer.skins.button.ApplyButtonEcom",style:"ecom_apl1"},ecomAddProduct:{skin:"wysiwyg.viewer.skins.button.AddProductButton",style:"ecom_ap1"}},_getDefaultSkinName:function(){var a=this._def.getChildValue("styleNS")||"default";return this._stylesMap[a].skin},_getDefaultStyleName:function(){var a=this._def.getChildValue("styleNS")||"default";return this._stylesMap[a].style},_setNaturalSize:function(){if(this._isCompBasedWidth()){var a=this._getNaturalWidth();this._element.setStyle("width",a),this._innerElement.setStyle("width",a)}if(this._isCompBasedHeight()){var b=this._getNaturalHeight();this._element.setStyle("height",b),this._innerElement.setStyle("height",b)}},_getNaturalWidth:function(){return this._componentLogic.getSizeLimits().minW},_getNaturalHeight:function(){return this._componentLogic.getSizeLimits().minH}})}),define.Class("wixapps.integration.proxies.ButtonProxy",function(a){var b=a;b.inherits("wixapps.integration.proxies.WProxy"),b.utilize([]),b.binds(["_handleSizeChange"]),b.traits(["wixapps.integration.components.traits.ResizableProxyTrait","wixapps.integration.proxies.traits.AppsLinkTrait"]),b.resources(["W.Data","W.Utils"]),b.fields({_linkId:null}),b.methods({_getCompName:function(){return"wysiwyg.viewer.components.SiteButton"},createComponent:function(){var a=this._createWixComponent(this._getCompName(),this._createRawData(),void 0);return this._innerElement.hasAttribute("height")||this._innerElement.setAttribute("height",this._def.getChildValue("height")||"30"),this._hideButtonIfLabelIsEmpty(),a},_hideButtonIfLabelIsEmpty:function(){"String"==this._data.getTypeName()&&""===this._data.getValue()?this._element.collapse():this._element.uncollapse()},_createRawData:function(){var a=this._data.getValue();a.linkId||(this._linkId||(this._linkId=this.resources.W.Utils.getUniqueId()),a.linkId=this._linkId);var b=this._createWLink(a);return{type:"LinkableButton",label:this._getLabel(a),link:b?"#"+a.linkId:""}},_getLabel:function(a){var b=null;return b=this._def.getChildValue("label"),b=b||"String"==this._data.getTypeName()&&a,b=b||a.label,b=b||"Submit"},_getChildValue:function(a,b,c){return this._def.getChildValue(a)||(c[a]?c[a]:b)},_onDataChanged:function(a){this._refresh(),this.parent(a)},_refresh:function(){this._componentLogic&&(this._hideButtonIfLabelIsEmpty(),this._setNewData())},_setNewData:function(){var a=this._componentLogic.getDataItem();a.setData(this._createRawData())},_getPropSchemaName:function(){return"ButtonProperties"},_setupPropertyHandlers:function(){this._mapToCompProperty("align"),this._mapToCompProperty("margin","margin",function(a){return parseInt(a,10)}),this._handleProperties(["label"],function(){this._refresh()})},_stylesMap:{"default":{skin:"wysiwyg.viewer.skins.button.BasicButton",style:"b3"},ecomViewCart:{skin:"wysiwyg.viewer.skins.button.BasicButton",style:"ecom_vc1"},ecomCheckout:{skin:"wysiwyg.viewer.skins.button.DisabledLayerButton",style:"ecom_co1"},ecomAddToCart:{skin:"wysiwyg.viewer.skins.button.BasicButton",style:"ecom_atc1"},ecomRemoveFromCart:{skin:"wysiwyg.viewer.skins.button.FixedFontButton",style:"ecom_rfc1"},ecomApplyCoupon:{skin:"wysiwyg.viewer.skins.button.ApplyButtonEcom",style:"ecom_apl1"},ecomAddProduct:{skin:"wysiwyg.viewer.skins.button.AddProductButton",style:"ecom_ap1"}},_getDefaultSkinName:function(){var a=this._def.getChildValue("styleNS")||"default";return this._stylesMap[a].skin},_getDefaultStyleName:function(){var a=this._def.getChildValue("styleNS")||"default";return this._stylesMap[a].style},_setNaturalSize:function(){if(this._isCompBasedWidth()){var a=this._getNaturalWidth();this._element.setStyle("width",a),this._innerElement.setStyle("width",a)}if(this._isCompBasedHeight()){var b=this._getNaturalHeight();this._element.setStyle("height",b),this._innerElement.setStyle("height",b)}},_getNaturalWidth:function(){return this._componentLogic.getSizeLimits().minW},_getNaturalHeight:function(){return this._componentLogic.getSizeLimits().minH}})}),define.Class("wixapps.integration.proxies.CheckBoxProxy",function(a){var b=a;b.inherits("wixapps.integration.proxies.WProxy"),b.binds(["_onComponentDataChanged","_onValidation"]),b.methods({initialize:function(a,b,c,d){this.parent(a,b,c,d),this._data.addEvent(Constants.DataItemEvents.VALIDATION_PERFORMED,this._onValidation)},_setupPropertyHandlers:function(){this.parent();var a=this;this._handleProperty("label",function(b){a._componentLogic.setLabel(b)})},createComponent:function(){var a=this._createWixComponent("wysiwyg.viewer.components.inputs.CheckBoxInput",this._createRawData(),{label:this._def.getChildValue("label")});return a},_createRawData:function(){return{type:"Boolean",value:this._data.getValue()}},_onDataChanged:function(a){this._refresh(),this.parent(a)},_refresh:function(){this._componentLogic&&this._setNewData()},_setNewData:function(){var a=this._componentLogic.getDataItem();a.setData(this._createRawData()),a.setMeta("isPersistent",!1)},_getDefaultSkinName:function(){return"wysiwyg.viewer.skins.input.CheckBoxInputSkin"},_onComponentDataChanged:function(a){this._data.setValue(!!a.get("value"))},_onValidation:function(a){if(this._componentLogic&&a){if(a.valid)this._componentLogic.setValidationState(!0);else{var b=a.validationMessage||this._def.getValue().validationMessage;this._componentLogic.setError(b)}this._componentLogic.setValidationState(a.valid)}},_getAcceptableDataTypes:function(){return["Boolean"]},_getDefaultStyleName:function(){return null}})}),define.Class("wixapps.integration.proxies.CheckBoxViewProxy",function(a){var b=a;b.inherits("wixapps.integration.proxies.CheckBoxProxy"),b.binds(["_onComponentDataChanged","_onValidation"]),b.methods({_onComponentWixified:function(){this._componentLogic.setDisabled()}})}),define.Class("wixapps.integration.proxies.CheckBoxGroupProxy",function(a){var b=a;b.inherits("wixapps.integration.proxies.WProxy"),b.binds(["_onComponentDataChanged","_onValidation"]),b.methods({initialize:function(a,b,c,d){this.parent(a,b,c,d),this._data.addEvent(Constants.DataItemEvents.VALIDATION_PERFORMED,this._onValidation)},createComponent:function(){var a=Number.random(0,99999).toString(36),b="x_group_"+a;return this._createWixComponent("wixapps.integration.components.inputs.CheckBoxGroupInput",this._createRawData(),{checkboxGroupName:b})},_createRawData:function(){var a=this._data.getChildByRef("items").getValue(),b=a.map(this._getOptionWDataItem),c=this._data.getChildByRef("selectedValues").getValue(),d=[];return c.each(function(a){var c=b.filter(function(b){return b.get("value")==a});c.length>0&&d.push(c[0])}),{type:"MultiSelectableList",items:b,selected:d}},_getOptionWDataItem:function(a){var b={type:"SelectOption",value:a.value,text:a.text,enabled:a.enabled,description:a.description},c=W.Data.createDataItem(b);return c.setMeta("isPersistent",!1),c},_onComponentDataChanged:function(a,b){if("selected"==b&&a){for(var c=a.get("selected"),d=[],e=0;e<c.length;e++){var f=c[e].get("value");d.push(f)}this._data.getChildByRef("selectedValues").setValue(d)}},_onDataChanged:function(a){var b=a.target.getParent().getChildRef(a.target);"selectedValues"!==b&&this._refreshComponentData()},_refreshComponentData:function(){if(this._componentLogic){var a=this._createRawData(),b=this._componentLogic.getDataItem();b.setData(a),b.setMeta("isPersistent",!1)}},_onValidation:function(a){if(this._componentLogic&&a){if(a.valid===!1){var b=a.validationMessage||this._def.getValue().validationMessage;this._componentLogic.setError(b)}this._componentLogic.setValidationState(a.valid)}},_getDefaultSkinName:function(){return"wysiwyg.viewer.skins.input.CheckBoxGroupInputSkin"},_getDefaultStyleName:function(){return"wa_cbg1"}})}),define.Class("wixapps.integration.proxies.ClippedParagraph2Proxy",function(a){var b=a;b.inherits("wixapps.integration.proxies.LabelProxy"),b.binds(["_onPartDirectionChanged"]),b.methods({initialize:function(a,b,c,d){this.parent(a,b,c,d)},_onPartDirectionChanged:function(a){this._componentLogic.setPartDirection(a.newValue)},_setupPropertyHandlers:function(){this.parent(),this._handleProperty("max-chars",function(){this._onDataChanged()}.bind(this))},_createFormattedText:function(){var a=this._getInnerText();a=this._prepareLinks(a);var b=this._getTextAsRichTextElement(a);if(b=this._applyDefaultStyleOnText(b),this._isSingleLine()){var c=b.getFirst()||b;c.addClass("singleLine");var d=this._def.getChildValue("color");d&&(this._isCustomColor(d)?c.setStyle("color",d):c.addClass(d))}var e=this._def.getChildValue("max-chars");return e?this._truncateRichText(b.innerHTML,e):b.innerHTML},_truncateRichText:function(a,b){var c,d,e={READING_WORD:0,STARTING_TO_READ_TAG:1,READING_OPENING_TAG:2,READING_CLOSING_TAG:3},f="<"===a[0]?e.STARTING_TO_READ_TAG:e.READING_WORD,g=0,h=[];for(d=0;d<a.length&&g>=b;d++){var i=a.substring(d,a.length);switch(c=a[d],f){case e.READING_WORD:if("<"!==c){var j=i.indexOf("<");d+=j-1,g+=j,f=e.STARTING_TO_READ_TAG}else f=e.STARTING_TO_READ_TAG;break;case e.STARTING_TO_READ_TAG:f="/"!==a[d+1]?e.READING_OPENING_TAG:e.READING_CLOSING_TAG;break;case e.READING_OPENING_TAG:var k=i.match(/([^\s]+)/)[0];h.push(k),d+=i.indexOf(">"),f="<"===a[d+1]?e.STARTING_TO_READ_TAG:e.READING_WORD;break;case e.READING_CLOSING_TAG:h.pop(),d+=i.indexOf(">"),f="<"===a[d+1]?e.STARTING_TO_READ_TAG:e.READING_WORD}}var l=a.substring(0,d-(g-b));l+=a[d+1]?"...":"";for(var m=h.length-1;m>=0;m--)l+="</"+h[m]+">";return l}})}),define.Class("wixapps.integration.proxies.ClippedParagraphProxy",function(a){var b=a;b.inherits("wixapps.integration.proxies.LabelProxy"),b.traits(["wixapps.integration.components.traits.ResizableProxyTrait"]),b.binds(["_onPartDirectionChanged"]),b.methods({initialize:function(a,b,c,d){this.parent(a,b,c,d);var e=this._viewContext.getEnvironment(),f=e.getVar("partDirection");f&&f.addEvent(Constants.DataItemEvents.CHANGE,this._onPartDirectionChanged)},_onPartDirectionChanged:function(a){this._componentLogic.setPartDirection(a.newValue)},_getCompName:function(){return"wixapps.integration.components.ClippedParagraph"},_getPropSchemaName:function(){return"ClippedParagraphProperties"},_isLayoutBasedHeight:function(){return this._def.getChildValue("maxLines")?!1:this.parent()},_setupPropertyHandlers:function(){this.parent(),this._handleProperties(["maxLines","minLines","pack"],function(){this._componentLogic.getDataItem().set("text",this._createFormattedText())}),this._mapToCompProperties(["maxLines","minLines","pack","showTooltip"])},_getDefaultSkinName:function(){return"wixapps.integration.skins.ClippedParagraphSkin"}})}),define.Class("wixapps.integration.proxies.ColumnGalleryProxy",function(a){a.binds(["_recreateColumns","_recalcColumnSpacing","_recalcRowSpacing"]),a.inherits("wixapps.integration.proxies.ListProxy2"),a.methods({createComponent:function(){var a=800/this._getNumOfColumns();this._viewContext.getEnvironment().setVar("estimatedColumnWidth",a);var b=this.parent(),c=this.getViewContext().getEnvironment().getVar("partDirection");return c.addEvent(Constants.DataItemEvents.CHANGE,this._recalcColumnSpacing),this._recreateColumns(),b},_recreateColumns:function(){for(var a=this._getNumOfColumns(),b=this.getRootElement(),c=0;a>c;c++)b.grab(this._createColumnDiv(a),"top");this._recalcColumnSpacing(),this._reorderChildren();for(var d=b.getChildren(),e=a;e<d.length;e++)d[e].destroy();this.fireEvent(Constants.WixAppEvents.APP_PART_RESIZE,{})},_recalcColumnSpacing:function(){for(var a=this._getNumOfColumns(),b=this.getRootElement().getChildren(),c=this._def.getChildValue("horizontalGap")||0,d=this.getViewContext().getEnvironment().getVar("partDirection").getValue(),e=Math.floor(c/a),f=0;a>f;f++)"rtl"===d?b[f].setStyles({"padding-right":f*e,"padding-left":(a-1-f)*e}):b[f].setStyles({"padding-left":f*e,"padding-right":(a-1-f)*e})},_recalcRowSpacing:function(){for(var a=this._getNumOfColumns(),b=this.getRootElement().getChildren(),c=this._def.getChildValue("verticalGap")||0,d=0;a>d;d++)for(var e=b[d].getChildren(),f=0;f<e.length;f++)0===f?e[f].setStyle("margin-top",0):e[f].setStyle("margin-top",Number(c))},_reorderChildren:function(){for(var a=this._getNumOfColumns(),b=[],c=0;a>c;c++)b.push(0);for(var d=this.getRootElement().getChildren(),e=0;e<this._children.length;e++){var f=_.indexOf(b,_.min(b)),g=this._children[e];d[f].grab(g.getElement()),b[f]+=this._getEstimatedHeight(g)}this._recalcRowSpacing()},_getNumOfColumns:function(){return this._def.getChildValue("columns")||3},_createColumnDiv:function(a){return new Element("div",{styles:{display:"inline-block","vertical-align":"top","box-sizing":"border-box","-moz-box-sizing":"border-box",width:100/a+"%"}})},_setupPropertyHandlers:function(){this.parent(),this._handleProperty("horizontalGap",this._recalcColumnSpacing),this._handleProperty("verticalGap",this._recalcRowSpacing),this._handleProperty("columns",this._recreateColumns)},_setElementStyles:function(a){a.setStyle("display","block")},_insertElementAt:function(a,b){var c=this._children.length;if(0>b||b>c)throw"Invalid index. cannot insert the element at index "+b+".";0===b?this._reorderChildren():b===c?this.getRootElement().getChildren()[this._getNumOfColumns()-1].grab(a):this._reorderChildren()},_getEstimatedHeight:function(a){var b=a.getViewContext().getEnvironment().getVar("estimatedHeight");return b?b.getValue():1}})}),define.Class("wixapps.integration.proxies.ComboBoxProxy",function(a){var b=a;b.inherits("wixapps.integration.proxies.WProxy"),b.binds(["_onValidation","_onComponentDataChanged"]),b.methods({initialize:function(a,b,c,d){this.parent(a,b,c,d),this._data.addEvent(Constants.DataItemEvents.VALIDATION_PERFORMED,this._onValidation)},createComponent:function(){return this._createWixComponent("wysiwyg.viewer.components.inputs.ComboBoxInput",this._createRawData())},_createRawData:function(){var a=this,b=this._data.getValue(),c=null,d=_.map(b.items,function(d){var e=a._createOptionDataItem(d);return d.value==b.selectedValue&&(c=e),e});return{type:"SelectableList",items:d,selected:c}},_createOptionDataItem:function(a){var b={type:"SelectOption",value:a.value,text:a.text,enabled:a.enabled,description:a.description},c=W.Data.createDataItem(b);return c.setMeta("isPersistent",!1),c},_setupPropertyHandlers:function(){this.parent(),this._mapToCompProperties(["hasPrompt","promptText"])},_getOptionWDataItem:function(a){var b={type:"SelectOption",value:a.value,text:a.text,enabled:a.enabled,description:a.description},c=W.Data.createDataItem(b);return c.setMeta("isPersistent",!1),c},_getPropSchemaName:function(){return"ComboBoxInputProperties"},_stylesMap:{"default":{skin:"wysiwyg.viewer.skins.input.ComboBoxInputSkinNoValidation",style:"wa_cb1"},ecomComboBox:{skin:"wixapps.integration.skins.ecommerce.inputs.ComboBoxInputSkin",style:""},ecomShippingComboBox:{skin:"wysiwyg.viewer.skins.appinputs.EcomComboBoxInputSkin",style:"ecom_scb1"},wixAppsGui:{skin:"wixapps.integration.skins.inputs.ComboBoxInputSkin",style:""}},_getDefaultSkinName:function(){var a=this._def.getChildValue("styleNS")||"default";return this._stylesMap[a].skin},_getDefaultStyleName:function(){var a=this._def.getChildValue("styleNS")||"default";return this._stylesMap[a].style},_onDataChanged:function(){this._componentLogic&&!this._ignoreUpdate&&(this._refreshComponentData(),this._updateEnabledItemsState())},_onComponentDataChanged:function(a,b,c){if(!this._fuckyourmama&&"selected"==b&&c.selected){this._ignoreUpdate=!0;var d=this._data.getValue();d.selectedValue=c.selected.get("value"),this._data.setValue(d),this._ignoreUpdate=!1}},_updateEnabledItemsState:function(){for(var a=this._componentLogic.getDataItem().get("items"),b=this._data.getValue().items,c=0;c<a.length;c++){var d=void 0!==b[c].enabled?b[c].enabled:!0;a[c].set("enabled",d)}},_findSelectedWDataItem:function(){var a=this._data.getValue().selectedValue;if(void 0===a||!this._componentLogic)return void 0;for(var b=this._componentLogic.getDataItem().get("items"),c=0;c<b.length;c++){var d=b[c].get("value");if(d===a)return b[c]}return void 0},_refreshComponentData:function(){if(this._componentLogic){var a=this._createRawData(),b=this._componentLogic.getDataItem();this._fuckyourmama=!0,b.setData(a),b.setMeta("isPersistent",!1),this._fuckyourmama=!1}},_onValidation:function(a){if(this._componentLogic&&a){if(a.valid===!1){var b=a.validationMessage||this._def.getValue().validationMessage;this._componentLogic.setError(b)}this._componentLogic.setValidationState(a.valid)}},_getComponentHeight:function(){return this._componentLogic.getViewNode().getHeight()}})}),define.Class("wixapps.integration.proxies.ContainerProxy",function(a){var b=a;b.inherits("wixapps.integration.proxies.WCompositeProxy"),b.binds(["_handleSizeChange","_handleSizeChange"]),b.traits(["wixapps.integration.components.traits.ResizableProxyTrait"]),b.fields({_inlineDiv:null}),b.methods({createComponent:function(){var a=this._createWixComponent(this._getCompName(),void 0,{allowDragChildren:!1});return this._createChildProxies(),this._createChildComponents(this._innerElement),a},_getCompName:function(){return"core.components.ContainerOBC"},_onComponentWixified:function(){this._doStuff()},_onSkinChange:function(){this._doStuff()},_doStuff:function(){this._autoStretchContent(),this.updateLayoutWhenReady(function(){this._handleSizeChange(),this._resizeMechanismActivated||this._activateResizeMechanism(),setTimeout(function(){this._updateComponentDimension("x")}.bind(this),2e3)}.bind(this))},_onLayoutChange:function(){this._autoStretchContent();var a={};this._isLayoutBasedWidth()&&this._updateComponentDimension("x",a),this._isLayoutBasedHeight()&&this._updateComponentDimension("y",a),window.requestAnimFrame(this._handleSizeChange),W.Utils.forceBrowserRepaint(this._innerElement,150,["safari","chrome"]),W.Utils.forceBrowserRepaint(this._componentLogic.getSkinPart("bg"),150,["safari","chrome"])},_autoStretchContent:function(){"stretch"!=this._def.getChildValue("heightMode")&&(this._inlineDiv&&this._inlineDiv.getParent()||(this._inlineDiv=this._componentLogic.getSkinPart("inlineContent"),this._inlineDiv.setStyles({height:"false"==this._def.getChildValue("packHeight")||this._def.getChildValue("packHeight")===!1?"100%":"auto",position:"relative"})))},_getComponentHeight:function(){return this._componentLogic.getSkinPart("inlineContent").getSize().y},_stylesMap:{"default":{skin:"wysiwyg.viewer.skins.area.AppleArea",style:"c1"},ecomCouponBox:{skin:"wysiwyg.viewer.skins.apps.DefaultBoxSkin",style:"ecom_cbx1"},ecomCartHeader:{skin:"wysiwyg.viewer.skins.apps.DefaultBoxSkin",style:"ecom_ch1"},ecomEmptyCartBG:{skin:"wysiwyg.viewer.skins.apps.DefaultBoxSkin",style:"ecom_ecbg1"}},_getDefaultSkinName:function(){var a=this._def.getChildValue("styleNS")||"default";return this._stylesMap[a].skin},_getDefaultStyleName:function(){var a=this._def.getChildValue("styleNS")||"default";return this._stylesMap[a].style}})}),define.Class("wixapps.integration.proxies.DateProxy",function(a){var b=function(){var a=/d{1,5}|m{1,5}|yy(?:yy)?|([HhMsTt])\1?|[LloSZ]|"[^"]*"|'[^']*'/g,c=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[\-+]\d{4})?)\b/g,d=/[^-+\dA-Z]/g,e=function(a,b){for(a=String(a),b=b||2;a.length<b;)a="0"+a;
return a};return function(f,g,h){var i=b;if(1!=arguments.length||"[object String]"!=Object.prototype.toString.call(f)||/\d/.test(f)||(g=f,f=void 0),f=f?new Date(f):new Date,isNaN(f))throw"invalid date";g=String(i.masks[g]||g||i.masks["default"]),"UTC:"==g.slice(0,4)&&(g=g.slice(4),h=!0);var j=h?"getUTC":"get",k=f[j+"Date"](),l=f[j+"Day"](),m=f[j+"Month"](),n=f[j+"FullYear"](),o=f[j+"Hours"](),p=f[j+"Minutes"](),q=f[j+"Seconds"](),r=f[j+"Milliseconds"](),s=h?0:f.getTimezoneOffset(),t={d:k,dd:e(k),ddd:i.i18n.dayNames[l],dddd:i.i18n.dayNames[l+7],ddddd:i.i18n.dayNames[l].toUpperCase(),m:m+1,mm:e(m+1),mmm:i.i18n.monthNames[m],mmmm:i.i18n.monthNames[m+12],mmmmm:i.i18n.monthNames[m].toUpperCase(),yy:String(n).slice(2),yyyy:n,h:o%12||12,hh:e(o%12||12),H:o,HH:e(o),M:p,MM:e(p),s:q,ss:e(q),l:e(r,3),L:e(r>99?Math.round(r/10):r),t:12>o?"a":"p",tt:12>o?"am":"pm",T:12>o?"A":"P",TT:12>o?"AM":"PM",Z:h?"UTC":(String(f).match(c)||[""]).pop().replace(d,""),o:(s>0?"-":"+")+e(100*Math.floor(Math.abs(s)/60)+Math.abs(s)%60,4),S:["th","st","nd","rd"][k%10>3?0:(k%100-k%10!=10)*k%10]};return g.replace(a,function(a){return a in t?t[a]:a.slice(1,a.length-1)})}}();b.masks={"default":"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",mediumDate:"mmm d, yyyy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:ss",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'",eUshortDate:"d/m/yy",eUshortDate2:"d.m.yy"},b.i18n={dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"]};var c=a;c.inherits("wixapps.integration.proxies.LabelProxy"),c.methods({_getInnerText:function(){var a="",c=this._def.getChildValue("prefix"),d=this._def.getChildValue("postfix");c&&(a+=c);var e=this._def.getChildValue("format")||"default",f=this._data.getValue(),g=f.iso||f,h=new Date(g);return h.getTime()>=0&&(a+=b(h,e)),d&&(a+=d),a},_setupPropertyHandlers:function(){this._handleProperties(["format"],function(){this._componentLogic.getDataItem().set("text",this._createFormattedText())}),this.parent()},getProxyMetaTags:function(){return["text"]},_getAcceptableDataTypes:function(){return["wix:Date","String"]}})}),define.Class("wixapps.integration.proxies.DateSelectorProxy",function(a){var b=a;b.inherits("wixapps.integration.proxies.WProxy"),b.binds(["_onComponentDataChanged","_onValidation"]),b.methods({createComponent:function(){this._data.addEvent(Constants.DataItemEvents.VALIDATION_PERFORMED,this._onValidation);var a="wixapps.integration.components.inputs.DateInput";this.useSkinsInsteadOfStyles();var b=this._getIsoDate();return this._createWixComponent(a,{type:"Text",text:b})},_getPropSchemaName:function(){return"DateInputProperties"},_setupPropertyHandlers:function(){this.parent(),this._mapToCompProperties(["allowEmpty"])},_getDefaultSkinName:function(){return"wysiwyg.viewer.skins.appinputs.DateInputSkin"},_getIsoDate:function(){var a=this._data.getValue(),b=new Date(a.iso);return this._allowEmpty()||!isNaN(b.getTime())&&b.getTime()!=new Date(0).getTime()||(a.iso=(new Date).toISOString(),this._userInputChange=!0,this._data.setValue(a),this._userInputChange=!1),a.iso},_onDataChanged:function(){!this._userInputChange&&this._element&&this._element.getLogic()&&this._element.getLogic().getDataItem().set("text",this._getIsoDate())},_onComponentDataChanged:function(){var a=this._element.getLogic().getDataItem().get("text");this._userInputChange=!0,this._data.setValue({_type:"wix:Date",iso:a}),this._userInputChange=!1},_onValidation:function(a){if(this._componentLogic)if(a.valid)this._componentLogic.resetInvalidState();else{var b=a.validationMessage||this._def.getValue().validationMessage;this._componentLogic.showValidationMessage(b)}},_allowEmpty:function(){return!(this._def.getChildValue("allowEmpty")===!1||"false"===this._def.getChildValue("allowEmpty"))},_getAcceptableDataTypes:function(){return["wix:Date"]}})}),define.Class("wixapps.integration.proxies.DeckProxy",function(a){var b=a;b.inherits("wixapps.integration.proxies.ListProxy2"),b.binds(["_onSelectionChange"]),b.methods({_getInitialSelection:function(){var a=this.getViewDefinition().getChildValue("initialSelection");return void 0!==a&&(a=parseInt(a,10)),void 0!==a&&a>=0?a:-1},_onComponentWixified:function(){var a=this.getViewDefinition().getChildValue("selectionChangeScope"),b=this.getViewDefinition().getChildValue("selectionChangeEvent");this.addEventFilteredByScope(a,b,this._onSelectionChange);var c=this._getInitialSelection();c>=0&&this._selectIndex(c)},_onSelectionChange:function(a){if(!this._disposed){for(var b=a.data,c=this._data.getChildren(),d=0,e=0,f=c.length;f>e;e++){var g=c[e];if(g==b){d=e;break}}this._selectIndex(d)}},_selectIndex:function(a){for(var b=this.getRootElement().children,c=0;c<b.length;c++){var d=b[c];c===a?d.uncollapse():d.collapse()}}})}),define.Class("wixapps.integration.proxies.DragAndDropVListProxy",function(a){a.binds(["_onItemDrag","_onItemEndDrag"]),a.inherits("wixapps.integration.proxies.ListProxy2"),a.methods({createComponent:function(){var a=this.parent();return a.setStyle("position","relative"),this._applyExtraDragStyling(),a},_updateItemTemplates:function(){this.parent(),this._applyExtraDragStyling()},_onChildCreated:function(a,b){if(this.parent(a,b),!b.hasClass("container")&&!b.hasClass("non-draggable")){var c=function(b){this._startDragChild(a,this._children.indexOf(a),b)}.bind(this);a.dragEventHandler=c,b.addEvent(Constants.CoreEvents.MOUSE_DOWN,c)}},_onBeforeChildDisposed:function(a){this.parent(a),a.dragEventHandler&&a.getElement().removeEvent(Constants.CoreEvents.MOUSE_DOWN,a.dragEventHandler)},_startDragChild:function(a,b,c){if("INPUT"!=c.target.tagName){this._startIdx=b,this._body=this._body||document.body;var d=c.client.y+window.getScroll().y;this._deltaY=d-a.getElement().getPosition().y,this._lastMouseY=d,this._startedDrag=!1,this._body.addEvent(Constants.CoreEvents.MOUSE_MOVE,this._onItemDrag),this._body.addEvent(Constants.CoreEvents.MOUSE_UP,this._onItemEndDrag),this._body.addClass("blockSelection")}},_doStartDrag:function(){var a=this._children[this._startIdx];this._movedElement=a.getElement(),this._undockMovingItem(),this._startedDrag=!0},_undockMovingItem:function(){var a=this._movedElement.getSize(),b=this._movedElement.getPosition(),c=this.getRootElement().getPosition();this._placeholder=new Element("DIV"),this._placeholder.setStyles({width:a.x,height:a.y,backgroundColor:"#FF8F00",border:"1px dashed #544300"}),this._movedContainer=new Element("DIV"),this._movedContainer.setStyles({width:a.x,height:a.y,position:"absolute",top:b.y-c.y-this._deltaY,"border-radius":5,"box-shadow":"rgba(0, 59, 202, 0.6) 0px 0px 5px 5px",opacity:.8}),this.getRootElement().insertBefore(this._placeholder,this._movedElement),this.getRootElement().grab(this._movedContainer),this._movedContainer.grab(this._movedElement),this._applyExtraDragStyling()},_dockMovingItem:function(){this.getRootElement().replaceChild(this._movedElement,this._placeholder),this._placeholder.destroy(),this._placeholder=void 0,this._movedContainer.destroy(),this._movedContainer=void 0,this._applyExtraDragStyling()},_onItemDrag:function(a){this._startedDrag||this._doStartDrag();var b=a.client.y+window.getScroll().y,c=this.getRootElement().getPosition(),d=b-c.y-this._deltaY;this._movedContainer.setStyle("top",d);var e=b<this._lastMouseY;this._lastMouseY=b;for(var f,g=0;g<this.getRootElement().children.length;g++){var h=this.getRootElement().children[g],i=h.getPosition().y,j=i+h.getSize().y;if(b>=i&&j>b){f=h;break}}if(f!==this._placeholder){0>d&&(f=this.getRootElement().firstChild);var k=this._def.getChildValue("createBoundaryContainers");if(e){if((k===!1||"false"===k)&&f===this.getRootElement().firstChild)return;this.getRootElement().insertBefore(this._placeholder,f)}else{if((k===!1||"false"===k)&&f===this.getRootElement().lastChild)return;this.getRootElement().insertBefore(this._placeholder,f&&f.nextSibling)}this._applyExtraDragStyling()}},_applyExtraDragStyling:function(){this._hideShowContainers()},_hideShowContainers:function(){var a=this.getRootElement().getElements(".container");Array.each(a,function(a){var b=a.getElement(".container-box"),c=a.getNext();!c||c===this._movedContainer||c&&c.hasClass("container")?(b.removeClass("hidden"),a.setStyle("opacity","0.5")):(b.addClass("hidden"),a.setStyle("opacity","1"))}.bind(this))},_onItemEndDrag:function(){if(this._body.removeEvent(Constants.CoreEvents.MOUSE_MOVE,this._onItemDrag),this._body.removeEvent(Constants.CoreEvents.MOUSE_UP,this._onItemEndDrag),this._body.removeClass("blockSelection"),this._startedDrag){for(var a=-1,b=0;b<this.getRootElement().children.length;b++)if(this.getRootElement().children[b]===this._placeholder){a=b;break}this._dockMovingItem(),this._startIdx!=a&&(this._children.splice(a,0,this._children.splice(this._startIdx,1)[0]),this._data.moveChildByIndex(this._startIdx,a),this.fireEvent("itemMoved",{oldIndex:this._startIdx,newIndex:a}))}},_registerProxyEvents:function(a,b){this.parent(a,b),"itemMoved"===a&&this.addEvent(a,b)}})}),define.Class("wixapps.integration.proxies.DraggableListItemProxy",function(a){var b=a;b.inherits("wixapps.integration.proxies.layout.BoxLayoutProxy"),b.binds(["_updateComp"]),b.methods({initialize:function(a,b,c,d){this.parent(a,b,c,d),this._proxyFactory=this._viewContext.getEnvironment().getProxyFactory()},createComponent:function(){this._orientation=this._def.getChildValue("orientation")||this._getDefaultOrientation();var a=this._createRawData(),b=this._createWixComponent("wixapps.integration.components.editor.DraggableListItem",a,{dragEnabled:this._isDragEnabled(),selected:this._def.getChildValue("selected"),iconType:this._def.getChildValue("iconType"),hideEditLink:this._def.getChildValue("hideEditLink"),isHeader:!1});return this._nativeEvents.forEach(function(a){b.addEvent(a.type,a.fn)}),this._createChildComponents(b),b},_setupPropertyHandlers:function(){this.parent(),this._handleProperties(["iconType","dragEnabled","hideEditLink"],this._updateComp)},_isDragEnabled:function(){var a=this._def.getChildValue("dragEnabled");return!("false"===a||a===!1)},_onComponentWixified:function(){this.parent();var a=this._getLayoutRootElement();this._setupBox(a)},_onDataChanged:function(){this._updateComp()},_updateComp:function(){this._componentLogic&&!this._componentLogic.getIsDisposed()&&(this._componentLogic.setSelected(this._data.getChildValue("selected")),this._componentLogic.setIcon(this._data.getChildValue("iconType")),this._componentLogic.setHideEditLink&&this._componentLogic.setHideEditLink(this._def.getChildValue("hideEditLink")))},_getLayoutRootElement:function(){return this._componentLogic&&this._componentLogic.getLayoutElement()},_getDefaultOrientation:function(){return"vertical"},_getDefaultSkinName:function(){return"wixapps.integration.skins.editor.DraggableListItemSkin"},_createRawData:function(){return{type:""}}})}),define.Class("wixapps.integration.proxies.EditLinkProxy",function(a){var b=a;b.inherits("wixapps.integration.proxies.ZoomLinkProxy"),b.binds(["_onClicked"]),b.fields({_eventString:"wix:edit-link:open-editor"})}),define.Class("wixapps.integration.proxies.EmptyProxy",function(a){var b=a;b.inherits("wixapps.integration.proxies.WProxy"),b.methods({createComponent:function(){return this._createElement("div")}})}),define.Class("wixapps.integration.proxies.EnumSelectorProxy",function(a){var b=a;b.inherits("wixapps.integration.proxies.WProxy"),b.binds(["_onOptionSelected","_onSelectionChanged","_recreateOptions"]),b.fields({_showAs:"list",_options:null}),b.methods({createComponent:function(){this._showAs="combo"==this._def.getChildValue("showAs")?"combo":"list";var a=this._createElement("list"==this._showAs?"ul":"select");return"combo"==this._showAs&&a.addEvent("change",this._onSelectionChanged),this._recreateOptions(),a},_recreateOptions:function(){this._clearOptions(this._element);var a="EnumSelector.options should be an array of {value:'',text:''} objects",b=this._def.getChildByRef("options");if("Array"!=b.getTypeName())throw a;for(var c=b.getValue(),d=0;d<c.length;d++){var e=c[d];if(!e.value)throw a;if("list"==this._showAs){var f=new Element("li");f.set("text",e.text),f.addEvent("click",this._onOptionSelected),f.set("opValue",e.value),this._element.grab(f)}else{var g=new Element("option");g.set("text",e.text),g.set("value",e.value),this._element.grab(g)}}this._refreshSelected(),this._options=c},_clearOptions:function(a){for(;a.lastChild;)a.lastChild.removeEvent("click",this._onOptionSelected),a.removeChild(a.lastChild)},_refreshSelected:function(){var a=this._data.getValue();if("list"==this._showAs)for(var b=0;b<this._element.children.length;b++){var c=this._element.children[b];c.get("opValue")==a?(c.addClass("selected"),c.removeClass("not-selected")):(c.addClass("not-selected"),c.removeClass("selected"))}else this._element.set("value",a)},_onOptionSelected:function(a){var b=a.event.currentTarget;this._data.setValue(b.get("opValue"))},_onSelectionChanged:function(a){var b=a.event.currentTarget;this._data.setValue(b.get("value"))},_setupPropertyHandlers:function(){this.parent(),this._handleProperty("options",this._recreateOptions),this._def.getChildByRef("options").addEvent(Constants.DataItemEvents.CHANGE,this._recreateOptions)},_onDataChanged:function(){this.parent(),this._refreshSelected()},_getAcceptableDataTypes:function(){return["String"]},dispose:function(){this._clearOptions(this._element),this._element.removeEvent("change",this._onSelectionChanged),this._def.getChildByRef("options")&&this._def.getChildByRef("options").removeEvent(Constants.DataItemEvents.CHANGE,this._recreateOptions),this.parent()}})}),define.Class("wixapps.integration.proxies.ErasableTextInputProxy",function(a){var b=a;b.inherits("wixapps.integration.proxies.TextInputProxy"),b.methods({_getComponentType:function(){return"wixapps.integration.components.inputs.ErasableTextInput"},_stylesMap:{"default":{skin:"wysiwyg.viewer.skins.appinputs.EcomErasableTextInputSkin",style:"ecom_eti1"}}})}),define.Class("wixapps.integration.proxies.FlowListProxy",function(a){var b=a;b.inherits("wixapps.integration.proxies.ListProxy2"),b.methods({createComponent:function(){var a=this.parent();return a.setStyles({"white-space":"normal"}),a},_setElementStyles:function(a){a.setStyles({display:"block"})},_onChildCreated:function(a,b){var c={};c.display="inline-block",c.width="auto",b.setStyles(c)}})}),define.Class("wixapps.integration.proxies.FormattedPriceProxy",function(a){var b=a;b.inherits("wixapps.integration.proxies.LabelProxy"),b.fields({_currencySymbols:{GBP:"",USD:"$",NIS:""}}),b.methods({_getInnerText:function(){var a=this._data.getValue();return this._currencySymbols[a.currency]+a.amount.toFixed(2)}})}),define.Class("wixapps.integration.proxies.GalleryProxy",function(a){var b=a;b.inherits("wixapps.integration.proxies.ListProxy"),b.binds(["_sequencingHook","_sequencingRolloverHook"]),b.utilize(["wysiwyg.viewer.utils.GalleryUtils"]),b.traits(["wixapps.integration.components.traits.ResizableProxyTrait"]),b.methods({initialize:function(a,b,c,d){this.parent(a,b,c,d),this._galleryUtils=new this.imports.GalleryUtils,this._rolloverTemplate&&(this._repeaterArgs.rolloverHook=this._sequencingRolloverHook),this._repeaterArgs.fixedRowNumber=!0},getRepeaterClass:function(){return"wixapps.integration.components.PaginatedGridGallery"},_setupPropertyHandlers:function(){this.parent(),this._handleProperty("*",function(){this.resetResizingCache()}),this._mapToCompProperties(["transition","autoplayInterval","transDuration"]),this._mapToCompProperty("columns","numCols"),this._mapToCompProperty("rows","maxRows"),this._mapToCompProperty("gap","margin"),this._mapToCompProperty("autoplay","autoplay",function(a){return a===!0||"true"==a}),this._mapToCompProperty("expandEnabled","expandEnabled",function(a){return a===!0||"true"==a}),this._mapToCompProperty("showAutoplay","showAutoplay",function(a){return a===!0||"true"==a}),this._mapToCompProperty("showNavigation","showNavigation",function(a){return!(a===!1||"false"==a)}),this._mapToCompProperty("showCounter","showCounter",function(a){return!(a===!1||"false"==a)})},_getPropSchemaName:function(){return"PaginatedGridGalleryProperties"},_sequencingHook:function(a,b,c){var d=this._createGalleryDisplayer(a,b,c,this._itemTemplate),e=new Element("div",{"class":"displayerBackground"});return e.inject(d,"top"),this._undisposedChildren.push(d.$viewProxy),d},_sequencingRolloverHook:function(a,b,c){var d=this._createGalleryDisplayer(a,b,c,this._rolloverTemplate);return this._undisposedChildren.push(d.$viewProxy),d},_createGalleryDisplayer:function(a,b,c,d){var e=this._viewContext.getEnvironment().getProxyFactory(),f=this._viewContext.newContextForData(a);this._addPositionInParentVars(f,b,c.length);var g=e.createProxyFromItemDefinition(f,d).proxy,h=g.createComponent();if(h.setStyles({overflow:"hidden",width:"1px",height:"1px"}),Browser.firefox){var i=new Element("div");i.getViewProxy=function(){return g},i.$viewProxy=g,i.adopt(h),h.setStyles({width:"100%",height:"100%"}),h=i}return h.setStyle("position","absolute"),this._galleryUtils.createMinimalGalleryDisplayer(h,a),h},_updateSequencerListeners:function(){this.parent(),this._componentLogic.addEvent("render",function(){_(this._undisposedChildren).filter(function(a){return null===a.getElement()||_(a.getElement().getParents("body")).isEmpty()}).each(function(a){a.dispose()})}.bind(this)),this._rolloverSequencer||(this._rolloverSequencer=this._componentLogic.getRolloverSequencer()),this._rolloverSequencer&&(this._rolloverSequencer.addEvent(Constants.ComponentEvents.COMPONENT_SEQUENCER_PRODUCTION_FINISHED,function(){this.updateLayoutWhenReady()}.bind(this)),this._rolloverSequencer.addEvent(Constants.ComponentEvents.COMPONENT_SEQUENCER_COMP_SETUP,function(a){if("create"==a.method){var b=a.compView.getViewProxy();b.setupProxy()}}.bind(this)),this.addEvent("showRollover",function(){this._componentLogic&&this._componentLogic._onMouseMove({page:this._componentLogic._skinParts.itemsContainer.getPosition()})}.bind(this)),this.addEvent("hideRollover",function(){this._componentLogic&&this._componentLogic._resetRollOver()}.bind(this)))},_stylesMap:{"default":{skin:"wysiwyg.viewer.skins.paginatedgrid.PaginatedGridDefaultSkin",style:"pagg1"},productGallery:{skin:"wysiwyg.viewer.skins.paginatedgrid.PaginatedGridSimple",style:"pgg_cg0"},contentGallery:{skin:"wysiwyg.viewer.skins.paginatedgrid.PaginatedGridNoDetail",style:"pgg_cg1"},minipostGallery:{skin:"wysiwyg.viewer.skins.paginatedgrid.wixapps.PaginatedGridNoDetail",style:"pgg_cg2"},hoverGallery:{skin:"wysiwyg.viewer.skins.paginatedgrid.PaginatedGridNoBG",style:"pgg_cg3"},blogGallery:{skin:"wysiwyg.viewer.skins.paginatedgrid.PaginatedGridNoDetail",style:"pgg_cg4"}},_getDefaultSkinName:function(){var a=this._def.getChildValue("styleNS")||"default";return this._stylesMap[a].skin},_getDefaultStyleName:function(){var a=this._def.getChildValue("styleNS")||"default";return this._stylesMap[a].style},_loadTemplates:function(){var a=this._viewContext.getEnvironment();this._itemTemplate=this._getItemTemplate("item")||a.getDataItemFactory().createDataItem({id:this.getFieldId()+"_template_item",comp:{}},this._def),this._rolloverTemplate=this._getItemTemplate("rollover")},_onStylePropertiesChange:function(a){Object.values(a).contains(Constants.SkinParamTypes.SIZE)&&this.updateLayoutWhenReady()},_onComponentWixified:function(){this.parent(),this._activateResizeMechanism(),this._onLayoutChange()}})}),define.Class("wixapps.integration.proxies.GoogleMapProxy",function(a){var b=a;b.inherits("wixapps.integration.proxies.WProxy"),b.traits(["wixapps.integration.components.traits.ResizableProxyTrait"]),b.methods({createComponent:function(){var a="wysiwyg.viewer.components.GoogleMap",b=this._data.getValue(),c={type:"GeoMap",address:b.address,latitude:b.latitude,longitude:b.longitude,addressInfo:b.addressInfo};return this._createWixComponent(a,c)},_getPropSchemaName:function(){return"GoogleMapProperties"},_setupPropertyHandlers:function(){this.parent(),this._mapToCompProperties(["showZoom","showPosition","showStreetView","showMapType","mapDragging","mapType"])},_getDefaultStyleName:function(){return"gm1"},_getDefaultSkinName:function(){return"wysiwyg.viewer.skins.GoogleMapSkin"},_onDataChanged:function(){if(this._componentLogic){var a=this._data.getValue(),b=this._componentLogic.getDataItem();b.set("address",a.address,!0),b.set("latitude",a.latitude,!0),b.set("longitude",a.longitude,!0),b.set("addressInfo",a.addressInfo,!0),b.fireDataChangeEvent()}},_getAcceptableDataTypes:function(){return["wix:Location"]}})}),define.Class("wixapps.integration.proxies.GooglePlusOneProxy",function(a){var b=a;b.inherits("wixapps.integration.proxies.WProxy"),b.methods({createComponent:function(){var a=this._createWixComponent("wysiwyg.viewer.components.WGooglePlusOne",this._createRawData());return a},_createRawData:function(){this._data.getValue();return{size:{type:"string","enum":["small","medium","standard","tall"],"default":"standard",description:"The button size to render"},annotation:{type:"string","enum":["none","bubble","inline"],"default":"inline",description:"The annotation to display next to the button."},width:{type:"string","default":"",description:"If annotation is set to *inline*, the width in pixels to use for the button and its inline annotation. If omitted, a button and its inline annotation use 450px."}}}})}),define.Class("wixapps.integration.proxies.GridGalleryProxy",function(a){var b=a;b.inherits("wixapps.integration.proxies.ListProxy2"),b.utilize(["wixapps.core.data.DataPaginationGalleries"]),b.binds(["_onContentRefresh"]),b.methods({initialize:function(a,b,c,d){this._pagination=new this.imports.DataPaginationGalleries(b,a.getEnvironment().getDataItemFactory(),this._getDefaultPageSize(c)),this.parent(a,this._pagination.getData(),c,d),this._pagination.addEvent(this._pagination.PAGINATION_REFRESH,this._onContentRefresh)},getRootElement:function(){return this._componentLogic&&this._componentLogic.getIntakeContainer?this._componentLogic.getIntakeContainer():this._innerElement||this._element},_getLogicClassName:function(){return"wixapps.integration.components.PaginatedGridGallery2"},_getLogicArgs:function(){return{pagination:this._pagination}},_onDataChanged:function(){},_onContentRefresh:function(){this._children=[],this._childrenTemplateMap=[],_.each(this._data.getChildren(),function(a){this._addChildAndSetup(a,this._children.length,this._children.length)}.bind(this)),this._updateItemTemplates(),this._lifecycleManager.performAction(function(){this._viewContext.getEnvironment().getEventsDispatcher().fireEvent(Constants.WixAppEvents.APP_VIEW_READY),this._componentLogic.invalidate(this._componentLogic.INVALIDATIONS.CONTENT_REFRESH)}.bind(this))},_onComponentWixified:function(){this.parent(),this._componentLogic.on(this._componentLogic.CONTENT_REARRANGED,this,this._onComponentRender)},_onComponentRender:function(){this.updateLayoutWhenReady()},_setupPropertyHandlers:function(){this.parent(),this._mapToCompProperties(["transition","autoplayInterval","transDuration","columns","rows","gap"])},_getPropSchemaName:function(){return"PaginatedGridGallery2Properties"},_getDefaultPageSize:function(a){var b=a.getChildValue("columns")||2,c=a.getChildValue("rows")||2;return b*c},_stylesMap:{"default":{skin:"wysiwyg.viewer.skins.paginatedgrid.PaginatedGridDefaultSkin",style:"pagg1"},productGallery:{skin:"wysiwyg.viewer.skins.paginatedgrid.PaginatedGridSimple",style:"pgg_cg0"},contentGallery:{skin:"wysiwyg.viewer.skins.paginatedgrid.PaginatedGridNoDetail",style:"pgg_cg1"},minipostGallery:{skin:"wysiwyg.viewer.skins.paginatedgrid.PaginatedGridNoDetail",style:"pgg_cg2"},hoverGallery:{skin:"wysiwyg.viewer.skins.paginatedgrid.PaginatedGridNoBG",style:"pgg_cg3"},blogGallery:{skin:"wysiwyg.viewer.skins.paginatedgrid.PaginatedGridNoDetail",style:"pgg_cg4"}},_getDefaultSkinName:function(){var a=this._def.getChildValue("styleNS")||"default";return this._stylesMap[a].skin},_getDefaultStyleName:function(){var a=this._def.getChildValue("styleNS")||"default";return this._stylesMap[a].style}})}),define.Class("wixapps.integration.proxies.HelpProxy",function(a){var b=a;b.inherits("wixapps.integration.proxies.WProxy"),b.resources(["W.Commands","W.Data","W.Utils"]),b.fields({_tooltipId:null,_tooltipsData:null}),b.methods({createComponent:function(){return this._tooltipsData=this.resources.W.Data.getDataByQuery("#TOOLTIPS.toolTips"),this._createTooltipData(),this._createWixComponent("mobile.core.components.base.BaseComponent",void 0,void 0)},_onDataChanged:function(){this._updateTooltipData()},_createTooltipData:function(){if(null!==this._tooltipId)throw"Tooltip data item already exists.";this._tooltipId=this.resources.W.Utils.AppsUtils.getTimeBasedUniqueId("wixapps_tooltip"),this._tooltipsData.set(this._tooltipId,{isMoreLess:!1,isDontShowAgain:!1,content:"<p>"+this._data.getValue()+"</p>",isPublished:!0,help:{isMoreHelp:!1,text:null,url:""}})},_updateTooltipData:function(){var a=this._tooltipsData.get(this._tooltipId);a.content="<p>"+this._data.getValue()+"</p>"},_onComponentWixified:function(){var a=this,b=this._element;b.addEvent("mouseenter",function(){a.resources.W.Commands.executeCommand("Tooltip.ShowTip",{id:a._tooltipId},b)}.bind(this)),b.addEvent("mouseleave",function(){a.resources.W.Commands.executeCommand("Tooltip.CloseTip")}.bind(this))},_getDefaultSkinName:function(){return"wixapps.integration.skins.HelpQuestionMarkIconSkin"},_getAcceptableDataTypes:function(){return["String"]}})}),define.Class("wixapps.integration.proxies.HorizontalLineProxy",function(a){var b=a;b.inherits("wixapps.integration.proxies.WProxy"),b.methods({createComponent:function(){return this._createWixComponent("wysiwyg.viewer.components.FiveGridLine",void 0,void 0,void 0)},_onComponentWixified:function(){if(this.parent(),this._componentLogic&&this._componentLogic.getViewNode){var a=this._componentLogic.getViewNode();a&&a.setStyle("position","relative")}},_getDefaultSkinName:function(){return"wysiwyg.viewer.skins.FiveGridLineSkin"},_getDefaultStyleName:function(){return"hl1"}})}),define.Class("wixapps.integration.proxies.IFrameProxy",function(a){var b=a;b.inherits("wixapps.integration.proxies.WProxy"),b.resources(["W.Commands","W.Data","W.Utils"]),b.fields({_tooltipId:null,_tooltipsData:null}),b.methods({createComponent:function(){return this._createWixComponent("wixapps.integration.components.IFrameComponent",null,{url:this._data.getValue(),width:this._def.getChildValue("width"),height:this._def.getChildValue("height")})},_onDataChanged:function(){this._componentLogic&&this._componentLogic.setUrl(this._data.getValue())},_getDefaultSkinName:function(){return"wysiwyg.viewer.skins.IFrameComponentSkin"},_getAcceptableDataTypes:function(){return["String"]}})}),define.Class("wixapps.integration.proxies.IconProxy",function(a){var b=a;b.inherits("wixapps.integration.proxies.WProxy"),b.methods({createComponent:function(){var a=this._createRawData();return this._createWixComponent("wixapps.integration.components.Icon",a,void 0)},_getDefaultSkinName:function(){return"wixapps.integration.skins.IconSkin"},_createRawData:function(){var a=this._data.getValue();return{type:"Icon",url:this._toAppImageUrl(a.src),width:a.width,height:a.height,title:a.title}},_onDataChanged:function(){this._updateIcon()},_updateIcon:function(){if(this._componentLogic){var a=this._data.getValue();this._componentLogic.getDataItem().set("url",this._toAppImageUrl(a.src),!1),this._componentLogic.getDataItem().set("width",a.width,!1),this._componentLogic.getDataItem().set("height",a.height,!1),this._componentLogic.getDataItem().set("title",a.title,!1),this._componentLogic.getDataItem().fireDataChangeEvent()}},_toAppImageUrl:function(a){return this._viewContext.getEnvironment().getProxyFactory().resolveResourcePath(a)},_getAcceptableDataTypes:function(){return["wix:Image"]}})}),define.Class("wixapps.integration.proxies.ImageButtonProxy",function(a){var b=a;b.inherits("wixapps.integration.proxies.WProxy"),b.resources(["W.Commands","W.Data","W.Utils"]),b.fields({_tooltipsData:null,_tooltipId:null}),b.methods({_getCompName:function(){return"wixapps.integration.components.ImageButton"},_getPropSchemaName:function(){return"WixappsImageButtonProperties"},_getDefaultSkinName:function(){return"wixapps.integration.skins.ImageButtonSkin"},createComponent:function(){return this._tooltipsData=this.resources.W.Data.getDataByQuery("#TOOLTIPS.toolTips"),this._createTooltipData(),this._handleProperty("tooltipValue",function(a){this._tooltipId&&this._tooltipsData.get(this._tooltipId)?this._tooltipsData.set(this._tooltipId,{isMoreLess:!1,isDontShowAgain:!1,content:"<p>"+a+"</p>",isPublished:!0,help:{isMoreHelp:!1,text:null,url:""}}):this._createTooltipData()}),this._createWixComponent(this._getCompName(),this._createRawData())},_toAppImageUrl:function(a){return this._viewContext.getEnvironment().getProxyFactory().resolveResourcePath(a)},_createRawData:function(){var a=this._data.getValue();return{type:"Icon",url:this._toAppImageUrl(a.src),width:a.width,height:a.height,title:a.title}},_createTooltipData:function(){if(null!==this._tooltipId)throw"Tooltip data item already exists.";this._tooltipId=this._def.getChildValue("tooltipId");var a=this._def.getChildValue("tooltipValue");void 0!==a&&(this._tooltipId=this.resources.W.Utils.AppsUtils.getTimeBasedUniqueId("wixapps_tooltip"),this._tooltipsData.set(this._tooltipId,{isMoreLess:!1,isDontShowAgain:!1,content:"<p>"+a+"</p>",isPublished:!0,help:{isMoreHelp:!1,text:null,url:""}}))},_onComponentWixified:function(){var a=this,b=this._element;b.addEvent("mouseenter",function(){a._tooltipId&&a.resources.W.Commands.executeCommand("Tooltip.ShowTip",{id:a._tooltipId},b)}.bind(this)),b.addEvent("mouseleave",function(){a._tooltipId&&a.resources.W.Commands.executeCommand("Tooltip.CloseTip")}.bind(this))},_setupPropertyHandlers:function(){this.parent(),this._mapToCompProperties(["isSprite","spriteDirection","startPositionX","startPositionY"])}})}),define.Class("wixapps.integration.proxies.ImageInputProxy",function(a){var b=a;b.inherits("wixapps.integration.proxies.WProxy"),b.binds(["_onComponentDataChanged","_onFieldReady"]),b.methods({createComponent:function(){var a=this._createWixComponent("wysiwyg.editor.components.inputs.ImageInput",null,{labelText:"",width:"100%",height:"100%",buttonText:this._def.getChildValue("selectImageLabel"),galleryConfigID:this._def.getChildValue("galleryConfigID"),deleteText:this._def.getChildValue("removeImageLabel"),selectionType:this._def.getChildValue("selectionType")||"single",publicMediaFile:this._def.getChildValue("publicMediaFile")||"photos",i18nPrefix:this._def.getChildValue("i18nPrefix")||"single_image",mediaType:this._def.getChildValue("mediaType")||"picture"});return a.addEvent(Constants.ComponentEvents.READY,this._onFieldReady),a},_createRawData:function(){if(this._isEmptyData())return null;var a=this._data.getValue();return{type:"Image",uri:this._toAppImageUrl(a.src),title:a.title,width:a.width,height:a.height}},_toAppImageUrl:function(a){return this._viewContext.getEnvironment().getProxyFactory().resolveResourcePath(a)},_isEmptyData:function(){var a=this._getEmptyImage();return void 0===a?!1:a.src===this._data.getChildValue("src")},_getEmptyImage:function(){return this._def.getChildValue("emptyImage")},_onFieldReady:function(){this._componentLogic&&(this._componentLogic.setValue(this._createRawData()),this._componentLogic.addEvent("inputChanged",this._onComponentDataChanged))},_onDataChanged:function(){!this._ignoreUpdate&&this._componentLogic&&this._componentLogic.setValue(this._createRawData())
},_onComponentDataChanged:function(){if(this._componentLogic){this._ignoreUpdate=!0;var a=this._componentLogic.getValue();if(a){var b=this._data.getValue();b.width=parseInt(a.width,10),b.height=parseInt(a.height,10),b.src=a.uri,b.title=a.title,this._data.setValue(b)}else this._data.setValue(this._getEmptyImage());this._ignoreUpdate=!1}},_getDefaultSkinName:function(){return"wysiwyg.editor.skins.inputs.ImageInputSkin"},_getAcceptableDataTypes:function(){return["wix:Image"]},dispose:function(){this._componentLogic&&this._componentLogic.removeEvent("inputChanged",this._onComponentDataChanged),this._element.removeEvent(Constants.ComponentEvents.READY,this._onFieldReady),this.parent()}})}),define.Class("wixapps.integration.proxies.ImageListEditorButtonProxy",function(a){var b=a;b.inherits("wixapps.integration.proxies.WProxy"),b.utilize(["wixapps.integration.utils.ImageListDataUtils"]),b.resources(["W.Config"]),b.binds(["_onComponentDataChanged"]),b.fields({_imageListData:null,_imageListRealImagesData:null,_previewDataManager:null,_imageListUtils:null}),b.methods({initialize:function(a,b,c,d){if(this.parent(a,b,c,d),!this.resources.W.Config.env.$isEditorFrame)throw"This proxy can be used only in editor frame!!";this._previewDataManager=W.Preview.getPreviewManagers().Data,this._imageListUtils=new this.imports.ImageListDataUtils},createComponent:function(){var a=this._createRawDataObject();return this._imageListData=this._previewDataManager.createDataItem(a.componentData),this._imageListData.setMeta("isPreset",!1),this._imageListRealImagesData=a.wData,this._createWixComponent("wysiwyg.editor.components.inputs.ListEditorButton",null,{buttonLabel:W.Resources.get("EDITOR_LANGUAGE","GALLERY_ORGANIZE_PHOTOS"),listData:this._imageListData,galleryConfigID:this._def.getChildValue("galleryConfigID"),callback:this._onComponentDataChanged})},_resolveResourcePath:function(a){return this._viewContext.getEnvironment().getProxyFactory().resolveResourcePath(a)},_createRawDataObject:function(){var a=this._data.getChildValue("items"),b=[],c=[];return a.forEach(function(a){a.src=this._resolveResourcePath(a.src);var d=this._imageListUtils.createWDataItemFromAppsImageData(a,this._previewDataManager);b.push("#"+d.id),c.push(d.dataObject)},this),{componentData:{type:"ImageList",items:b},wData:c}},_onDataChanged:function(){if(!this._ignoreUpdate&&this._componentLogic){this._ignoreUpdate=!0;var a=this._createRawDataObject();this._imageListData.set("items",a.componentData.items),this._imageListRealImagesData=a.wData,this._ignoreUpdate=!1}},_onComponentDataChanged:function(a){if("CANCEL"===a.result)return this._onDataChanged(),void 0;var b=this._imageListData.get("items");if(!this._ignoreUpdate&&this._componentLogic){this._ignoreUpdate=!0;var c=this;this._imageListUtils.getWDataItemsFromRefItems(b,this._previewDataManager).then(function(a){return c._imageListRealImagesData=a,c._imageListUtils.createAppsImageDataListFromWDataList(a,c._previewDataManager)}).done(function(a){c._data.getChildByRef("items").setValue(a),c._ignoreUpdate=!1})}},_getDefaultSkinName:function(){return"wysiwyg.editor.skins.inputs.button.ButtonInputBlueArrowSkin"},_getAcceptableDataTypes:function(){return["wix:ImageList"]}})}),define.Class("wixapps.integration.proxies.ImageProxy",function(a){var b=a;b.inherits("wixapps.integration.proxies.WProxy"),b.binds(["_handleSizeChange"]),b.traits(["wixapps.integration.components.traits.ResizableProxyTrait"]),b.methods({createComponent:function(){var a=this._createRawData(),b={showZoom:this._def.getChildValue("showZoom")||!1};return this._createWixComponent("wixapps.integration.components.WPhoto",a,b)},_toAppImageUrl:function(a){return this._viewContext.getEnvironment().getProxyFactory().resolveResourcePath(a)},getImageMode:function(){return this._def.getChildValue("imageMode")||"fill"},_fixedAspectRatioModes:["fitWidth","fitHeight"],hasFixedAspectRatio:function(){var a=this.getImageMode();return this._fixedAspectRatioModes.contains(a)},getAspectRatio:function(){var a=this._data.getValue();return parseFloat(a.width)/parseFloat(a.height)},_createImageRawData:function(a){return{type:"Image",uri:this._toAppImageUrl(a.src),title:a.title,width:a.width,height:a.height}},_createRawData:function(){var a=this._data.getValue();return this._createImageRawData(a)},_onImageDataChanged:function(){if(this._componentLogic){var a=this._createRawData();this._componentLogic.getDataItem().set("uri",a.uri,!1),this._componentLogic.getDataItem().set("title",a.title,!1),this._componentLogic.getDataItem().set("width",a.width,!1),this._componentLogic.getDataItem().set("height",a.height,!1),this._componentLogic.getDataItem().fireDataChangeEvent()}},_onDataChanged:function(){this._onImageDataChanged()},_getPropSchemaName:function(){return"WPhotoProperties"},_setupPropertyHandlers:function(){this.parent(),this._mapToCompProperty("imageMode","displayMode",function(a){var b=a||"fill";return"fitWidth"==a?b="fitWidthStrict":"fitHeight"==a&&(b="fitHeightStrict"),this._innerElement&&(this._innerElement.style.height=null,this._innerElement.style.width=null),this.resetResizingCache(),b}.bind(this))},_getDefaultSkinName:function(){return"wysiwyg.viewer.skins.photo.NoSkinPhoto"},_getDefaultStyleName:function(){return"wp1"},maxElementSize:function(){var a=this._def.getChildValue("extendSize");if(a===!1||"false"===a){var b=this._data.getValue();return{x:b.width,y:b.height}}},_isLayoutBasedWidth:function(){var a=this.getImageMode();return"fitWidth"==a?!0:"fitHeight"==a?!1:this.parent()},_isLayoutBasedHeight:function(){var a=this.getImageMode();return"fitWidth"==a?!1:"fitHeight"==a?!0:this.parent()},_checkMinHeight:function(){},getSourceSize:function(){return{width:this.getData().getChildValue("width"),height:this.getData().getChildValue("height")}}})}),define.Class("wixapps.integration.proxies.ImageSelectorProxy",function(a){var b=a;b.inherits("wixapps.integration.proxies.ImageProxy"),b.binds(["_openReplaceMedia","_onImgSelect","_onImgReset"]),b.resources(["W.Commands"]),b.methods({createComponent:function(){var a=this._createRawData(),b=this._createWixComponent("wixapps.integration.components.WPhotoSelector",a);return this._galleryTypeID=this._def.getChildValue("galleryConfigID")||"photos",b.addEvent("click",this._openReplaceMedia),b.setStyle("cursor","pointer"),b.setStyle("position","relative"),b.grab(new Element("div")),b},_createRawData:function(){var a=this.parent(),b=this._def.getChildValue("linkText");return b&&(a.linkText=b),a},_setupPropertyHandlers:function(){this.parent(),this._handleProperty("defaultImage",function(){this._refreshResetState()})},_onComponentWixified:function(){this._componentLogic&&(this._resetButton=this._componentLogic.getViewNode().getElement("div[skinpart=reset]"),this._resetButton&&this._resetButton.addEvent("click",this._onImgReset),this._refreshResetState())},_refreshResetState:function(){if(this._componentLogic){var a=this._getDefaultImage(),b=a&&a.src!=this._data.getChildValue("src");this._componentLogic.getViewNode().set("reset",b?"enabled":"disabled")}},_getDefaultImage:function(){return this._def.getChildValue("defaultImage")},_openReplaceMedia:function(){this.resources.W.Commands.executeCommand("WEditorCommands.OpenMediaFrame",{galleryConfigID:this._def.getChildValue("galleryConfigID"),deleteText:this._def.getChildValue("removeImageLabel"),selectionType:this._def.getChildValue("selectionType")||"single",publicMediaFile:this._def.getChildValue("publicMediaFile")||"photos",i18nPrefix:this._def.getChildValue("i18nPrefix")||"single_image",mediaType:this._def.getChildValue("mediaType")||"picture",callback:this._onImgSelect})},_onImgReset:function(){return this._data.setValue(this._getDefaultImage()),this._refreshResetState(),!1},_onImgSelect:function(a){var b=this._data.getValue();b.width=parseInt(a.width,10),b.height=parseInt(a.height,10),b.src=a.uri,b.title=a.title,this._data.setValue(b),this._refreshResetState()},_getDefaultSkinName:function(){return"wixapps.integration.skins.editor.ImageSelectorSkin"},_getDefaultStyleName:function(){return void 0},_onDataChanged:function(){this.parent(),this._refreshResetState()},dispose:function(){this._resetButton&&(this._resetButton.removeEvent("click",this._onImgReset),this._resetButton=void 0),this.parent()}})}),define.Class("wixapps.integration.proxies.InlineSvgProxy",function(a){var b=a;b.inherits("wixapps.integration.proxies.WProxy"),b.methods({createComponent:function(){var a=this._createElement("div");return a.innerHTML=this._def.getChildValue("svg"),a}})}),define.Class("wixapps.integration.proxies.InlineTextInputProxy",function(a){var b=a;b.inherits("wixapps.integration.proxies.WProxy"),b.binds(["_onComponentDataChanged"]),b.methods({createComponent:function(){var a=this._createRawData();return this._createWixComponent("wixapps.integration.components.inputs.InlineTextInput",a)},_getPropSchemaName:function(){return void 0},_createRawData:function(){var a=this._data.getValue(),b=document.createElement("div");return b.innerHTML=a,a=b.innerText||b.text||b.textContent,{type:"Text",text:a}},_onComponentWixified:function(){},_onDataChanged:function(){this._componentLogic&&!this._ignoreUpdate&&this._componentLogic.getDataItem().set("text",this._data.getValue())},_onComponentDataChanged:function(a,b,c){this._ignoreUpdate=!0,this._data.setValue(c.text),this._ignoreUpdate=!1},_getDefaultSkinName:function(){return"wixapps.integration.skins.inputs.InlineTextInputSkin"}})}),define.Class("wixapps.integration.proxies.InlineTextProxy",function(a){var b=a;b.inherits("wixapps.integration.proxies.LabelProxy"),b.methods({_createFormattedText:function(){var a=this._data.getValue(),b=this._getTextAsRichTextElement(a);return b=this._applyDefaultStyleOnText(b),this._isSingleLine()&&b.getFirst().addClass("singleLine"),b.innerHTML},_getAcceptableDataTypes:function(){return["String","Number"]},_getBlockDefaultStyledElement:function(a){return new Element("span",{"class":a})},_getViewElement:function(){return"span"},_getCompName:function(){return"wixapps.integration.components.InlineText"},_getDefaultSkinName:function(){return"mobile.core.skins.InlineSkin"}})}),define.Class("wixapps.integration.proxies.LabelProxy",function(a){var b=a;b.inherits("wixapps.integration.proxies.WProxy"),b.binds(["_onAppPartResize"]),b.traits(["wixapps.integration.proxies.traits.AppsLinkTrait"]),b.utilize(["wysiwyg.common.utils.TextMigrationHandler","wysiwyg.common.utils.TextMigrationDomHelper"]),b.resources(["W.Theme","W.Utils"]),b.fields({_styleString:""}),b.methods({initialize:function(a,b,c,d){this.parent(a,b,c,d),this._migrationHandler=new this.imports.TextMigrationHandler,this._migrationDomHelper=new this.imports.TextMigrationDomHelper},createComponent:function(){this.useSkinsInsteadOfStyles();var a=this._createRawData();return this._createWixComponent(this._getCompName(),a)},_setupPropertyHandlers:function(){this._handleProperties(["postfix","prefix","disableLinks","lineThrough","underline","singleLine","color","bold","noWrap","style","italic"],function(){this._componentLogic.getDataItem().set("text",this._createFormattedText())})},_createRawData:function(){return{type:"StyledText",text:this._createFormattedText()}},_createFormattedText:function(){var a=this._getInnerText();a=this._prepareLinks(a);var b=this._getTextAsRichTextElement(a);if(b=this._applyDefaultStyleOnText(b),this._isSingleLine()){var c=b.getFirst()||b;c.addClass("singleLine");var d=this._def.getChildValue("color");d&&(this._isCustomColor(d)?c.setStyle("color",d):c.addClass(d))}return b.innerHTML},_prepareLinks:function(a){return W.Editor||this._def.getChildValue("disableLinks")?a=a.replace(/<a\b[^>]*>(.*?)<\/a>/gi,"$1"):this._updateLinkDataItems(),a},_getInnerText:function(){var a="";if("wix:RichText"===this._data.getTypeName()){var b=this._def.getChildrenRefs().some(function(a){return["prefix","postfix"].contains(a)});if(b)throw"Warning:: type [wix:RichText] does not support [prefix] or [postfix].";this._migrateHtml(),a=this._data.getChildValue("text")}else{var c=this._def.getChildValue("prefix"),d=this._def.getChildValue("postfix"),e=this._data.getValue();c&&(a+=c),e&&(a+=String(e).trim()),d&&(a+=d)}return a},_getTextAsRichTextElement:function(a){this._isSingleLine()&&(a=String(a),a=a.replace(/(<p>|<\/p>|<br\/?>)/gi,""));var b=new Element("div");if("wix:RichText"!==this._data.getTypeName()){var c=new Element(this._getDefaultStylePlaceHolderTag());c.set("html",a),b.grab(c)}else b.set("html",a);if(this._isSingleLine()){var d=b.getFirst();null!==d&&(b.empty(),b.grab(d))}return b},_applyDefaultStyleOnText:function(a){var b=a.getElements(this._getDefaultStylePlaceHolderTag());return b.forEach(function(a){this._replaceDefaultStyledElement(a)},this),a},_replaceDefaultStyledElement:function(a){var b=this._getDefaultStyleElement();b.innerElement.innerHTML=a.innerHTML,this._copyAttributesFromOneElementToAnother(a,b),this._copyStylesFromOneElementToAnother(a,b),a.parentNode.replaceChild(b.outerElement,a)},_getDefaultStyleElement:function(){var a=Constants.WixApps.TEXT_STYLES[this._def.getChildValue("style")]||this._getDefaultStyleName(),b=this._getBlockDefaultStyledElement(a),c=b,d=this._def.getChildValue("bold")===!0||"true"===this._def.getChildValue("bold"),e=this._def.getChildValue("italic")===!0||"true"===this._def.getChildValue("italic"),f=this._def.getChildValue("lineThrough")===!0||"true"===this._def.getChildValue("lineThrough"),g=this._def.getChildValue("underline")===!0||"true"===this._def.getChildValue("underline"),h=parseFloat(this._def.getChildValue("line-height")),i=this._getDefaultColorElement(),j=parseFloat(this._def.getChildValue("fontSize"));if(isNaN(h)||b.setStyle("line-height",h+"em"),i&&(c=this._insertElementToParentElement(c,i)),d&&(c=this._insertElementToParentElement(c,new Element("strong"))),e&&(c=this._insertElementToParentElement(c,new Element("em"))),f&&(c=this._insertElementToParentElement(c,new Element("strike"))),g&&(c=this._insertElementToParentElement(c,new Element("u"))),!isNaN(j)){var k=new Element("span");k.setStyle("font-size",j+"px"),c=this._insertElementToParentElement(c,k)}return{outerElement:b,innerElement:c}},_insertElementToParentElement:function(a,b){return a.grab(b),b},_getBlockDefaultStyledElement:function(a){var b=this._getSeoTagForStyleCssClass(a),c=new Element(b,{"class":a});return c},_getDefaultColorElement:function(){var a=null,b=this._def.getChildValue("color");return b&&(a=new Element("span"),this._isCustomColor(b)?a.setStyle("color",b):a.addClass(b)),a},_migrateHtml:function(){var a=this._data.getValue(),b=!1;if(a.hasOwnProperty("version")&&1!==a.version||(a.text=this._migrationHandler.migrateText(a.text,this._getDefaultStylePlaceHolderTag(),this._getDefaultStyleName()),a.version=2,b=!0),/hasproxy=.true/im.test(a.text)){var c=function(a){return new RegExp(a+"=['\"].*?['\"]","mgi")};_.each(["hasproxy","vcfield","vcview","vctype","pos"],function(b){a.text=a.text.replace(c(b),"")}),b=!0}b&&this._data.setValue(a)},_copyAttributesFromOneElementToAnother:function(a,b){for(var c=this._migrationDomHelper.getAllAttributes(a),d=0;d<c.length;d++){var e=c[d],f=e.name;if("style"!==f&&"class"!==f){var g=a.getAttribute(f);g&&b.outerElement.setAttribute(f,g)}}},_copyStylesFromOneElementToAnother:function(a,b){var c=this._createElementStyleMap(a),d=this._createElementStyleMap(b.outerElement);for(var e in c)d[e]=c[e];b.outerElement.setStyles(d)},_createElementStyleMap:function(a){var b={},c=[],d=a.getAttribute("style");return d&&(d.trim().lastIndexOf(";")===d.length-1&&(d=d.substring(0,d.length-1)),c=d.split(";")),c.forEach(function(a){var c=a.split(":");2==c.length&&(b[c[0].trim()]=c[1].trim())}),b},_trimText:function(a){return a.replace(/\s+/gim," ").replace(/^\s*/,"").replace(/\s*$/,"")},_isSingleLine:function(){if(null==this._def)return!1;var a=this._def.getChildValue("singleLine");return a===!0||"true"==a},getStyleString:function(){var a=Constants.WixApps.TEXT_STYLES[this._def.getChildValue("style")]||this._getDefaultStyleName(),b=this._def.getChildValue("color");return b?a+" "+b:a},_onComponentWixified:function(){this._viewContext.getEnvironment().getEventsDispatcher().addEvent(Constants.WixAppEvents.APP_PART_RESIZE,this._onAppPartResize),this._componentLogic&&!this._componentLogic.getIsDisposed()&&this._componentLogic._setLinksDataToElements&&this._componentLogic._setLinksDataToElements("VIEW"),this._onAppPartResize(),window.setTimeout(this._setTooltip.bind(this),100);var a=this._def.getChildValue("noWrap");a===!0||"true"===a?this._element.setStyle("white-space","nowrap"):this._element.setStyle("white-space","normal")},_onDataChanged:function(){this._componentLogic&&!this._componentLogic.getIsDisposed()&&(this._componentLogic.getDataItem().set("text",this._createFormattedText()),this.resources.W.Utils.isIE()&&this._viewContext.getEnvironment().getEventsDispatcher().fireEvent(Constants.WixAppEvents.PROXY_SIZE_INVALID))},_onAppPartResize:function(){this._disposed||this._setTooltip()},_setTooltip:function(){if(this._element)if(this._shouldShowTooltip(this._element)){var a=this._getInnerText();a=new Element("div").set("html",a).get("text"),this._element.setAttribute("title",this._trimText(a))}else this._element.removeAttribute("title")},_shouldShowTooltip:function(a){if(!this._def)return!1;var b=this._def.getChildValue("showTooltip");if(this._isSingleLine()&&("true"===b||b===!0)){var c=a;return a.getFirst()&&(c=a.getFirst()),c.scrollWidth>c.offsetWidth}return!1},_isCustomColor:function(a){return"#"===a.slice(0,1)},_getCompName:function(){return"wysiwyg.viewer.components.WRichText"},_getSeoTagForStyleCssClass:function(){return"p"},_getDefaultStyleName:function(){return"font_8"},_getDefaultStylePlaceHolderTag:function(){return"hatul"},_getDefaultSkinName:function(){return"wysiwyg.viewer.skins.WRichTextNewSkin"},_getAcceptableDataTypes:function(){return["String","wix:RichText","Number"]},getProxyMetaTags:function(){return["text"]},_preventReflowCssClass:function(){return null}})}),define.Class("wixapps.integration.proxies.LinkProxy",function(a){var b=a;b.inherits("wixapps.integration.proxies.layout.BoxLayoutProxy"),b.traits(["wixapps.integration.proxies.traits.AppsLinkTrait"]),b.methods({_preventReflowCssClass:function(){return null},createComponent:function(){var a=this.parent();return this._element.addClass("wixAppsLink"),this._updateLink(),a},_getDefaultOrientation:function(){return"vertical"},_checkDataValidity:function(){if(!this._viewContext.getEnvironment().getTypesManager().isOf(this._data.getTypeName(),"wix:LinkBase"))throw"Link selector only accepts links of type wix:LinkBase or extending. Received ["+this._data.getTypeName()+"]"},_getContainerElementType:function(){return"a"},_onDataChanged:function(){this._updateLink()},_updateLink:function(){this._updateAnchorLink(this._element,this._data.getValue())}})}),define.Class("wixapps.integration.proxies.LinkSelectorProxy",function(a){var b=a;b.inherits("wixapps.integration.proxies.WProxy"),b.binds(["_onClick","_onLinkDialogClosing"]),b.traits(["wixapps.integration.proxies.traits.AppsLinkTrait"]),b.resources(["W.Resources"]),b.methods({createComponent:function(){var a=this._createRawData();return this._createWixComponent("wixapps.integration.components.LinkSelector",a,{descriptionVisible:this._getDescriptorVisibility(),isEditable:this._getIsEditable()})},_createRawData:function(){return{type:"Text",text:this._getLinkDescription()}},_getDefaultSkinName:function(){return"wixapps.integration.skins.LinkSelectorSkin"},_getDescriptorVisibility:function(){var a=this._def.getChildValue("showDescription");return a===!0||"true"==a},_getIsEditable:function(){var a=this._def.getChildValue("isEditable");return void 0===a?!0:a},_onDataChanged:function(a){this._componentLogic&&(this._componentLogic.getDataItem().set("text",this._getLinkDescription()),this._componentLogic.setDescriptionVisibility(this._getDescriptorVisibility())),this.parent(a)},_onComponentWixified:function(){this._componentLogic.addEvent(Constants.CoreEvents.CLICK,this._onClick)},_onClick:function(){var a=this._viewContext.getEnvironment().getProxyFactory().getNameSpace()||this._fieldId,b=this._data.getValue();this._openLinkDialog(b,a,this._onLinkDialogClosing)},_onLinkDialogClosing:function(a,b,c,d){var e=this;this.resource.getResources(["W.EditorDialogs"],function(f){if(d.result!=f.W.EditorDialogs.DialogButtons.CANCEL){a.copySchemaFieldsFrom(c);var g=e._createAppsLink(a).getValue();b!==Constants.LinkState.NO_LINK&&g._type||(g={_type:"wix:LinkBase"}),e._data.setValue(g)}})},_getLinkDescription:function(){var a=this._createWLink(this._data.getValue()),b=new this.imports.LinkRenderer,c=b.renderLinkDataItemForPropertyPanel(a);return c},_getAcceptableDataTypes:function(){return["wix:LinkBase"]}})}),define.Class("wixapps.integration.proxies.ListProxy",function(a){var b=a;b.inherits("wixapps.integration.proxies.WArrayProxy"),b.binds(["_sequencingHook"]),b.utilize(["wixapps.core.data.DataItemUtils"]),b.fields({_sequencerCompleted:!1,_sequencer:null,_repeaterArgs:{}}),b.methods({initialize:function(a,b,c,d){this.parent(a,b,c,d),this._undisposedChildren=[],this._repeaterArgs.sequencingHook=this._sequencingHook,this._dataItemUtils=new this.imports.DataItemUtils},getRepeaterClass:function(){},setComponentStyles:function(){},onChildCreate:function(){},createComponent:function(){var a=this._createRawData(),b=this._createWixComponent(this.getRepeaterClass(),a,this._repeaterArgs);return this._childrenLeftToBeReady=this._data.getChildren().length,this.setComponentStyles(b),b},_sequencingHook:function(a,b,c){var d=this._viewContext.getEnvironment().getProxyFactory(),e=this._itemTemplate;0===b&&this._firstTemplate?e=this._firstTemplate:b==c.length-1&&this._lastTemplate&&(e=this._lastTemplate);var f=this._viewContext.newContextForData(a);e=d.createNewEvaluationScope(e,f),this._addPositionInParentVars(f,b,c.length);var g=d.createProxyFromItemDefinition(f,e).proxy,h=g.createComponent();return this._undisposedChildren.push(g),this.onChildCreate(h,b),h},_updateSequencerListeners:function(){null===this._sequencer&&(this._sequencer=this._componentLogic.getSequencer()),this._sequencer.addEvent(Constants.ComponentEvents.COMPONENT_SEQUENCER_PRODUCTION_FINISHED,function(){this.updateLayoutWhenReady()}.bind(this)),this._sequencer.addEvent(Constants.ComponentEvents.COMPONENT_SEQUENCER_COMP_SETUP,function(a){if("create"==a.method){var b=a.compView.getViewProxy();b.setupProxy()}}.bind(this))},_createRawData:function(){var a=this._data.getChildren();return{type:"ImageList",items:a}},_onDataChanged:function(a){if(a.phase==Constants.DataItemEventPhase.ON_TARGET){var b=this._dataItemUtils.createDataChangeEventList(a,this._data),c=b.some(function(a){return"add"==a.type||"delete"==a.type||a.item.isRef()});if(c){for(;this._undisposedChildren.length>0;){var d=this._undisposedChildren.pop();d.dispose()}this._dataItem.set("items",[]),this._dataItem.set("items",this._data.getChildren())}}},_loadTemplates:function(){var a=this._viewContext.getEnvironment();this._itemTemplate=this._getItemTemplate("item")||a.getDataItemFactory().createDataItem({id:this.getFieldId()+"_template_item",comp:{}},this._def),this._firstTemplate=this._getItemTemplate("first"),this._lastTemplate=this._getItemTemplate("last")},_getItemTemplate:function(a){return this._def.getChildByRef("templates")&&this._def.getChildByRef("templates").getChildByRef(a)},_getDefaultStyleName:function(){return null},_getDefaultSkinName:function(){return"mobile.core.skins.InlineSkin"},_onComponentWixified:function(){this._updateSequencerListeners(),this._componentLogic.getSequencer().isPending()||this.updateLayoutWhenReady()},dispose:function(){if(!this._disposed){for(;this._undisposedChildren.length>0;){var a=this._undisposedChildren.pop();a.dispose()}this.parent()}}})}),define.Class("wixapps.integration.proxies.ListProxy2",function(a){var b=a;b.inherits("wixapps.integration.proxies.WArrayProxy"),b.binds([]),b.fields({_rootElement:null,_childrenTemplateMap:[]}),b.methods({initialize:function(a,b,c,d){this.parent(a,b,c,d)},_getLogicClassName:function(){return"mobile.core.components.base.BaseComponent"},_createRawData:function(){return void 0},_getLogicArgs:function(){return void 0},setComponentStyles:function(){},_onChildCreated:function(a,b){b.setStyle("min-width","100%")},createComponent:function(){var a=this._createWixComponent(this._getLogicClassName(),this._createRawData(),this._getLogicArgs());return a.addClass("wixAppsList2"),this._setElementStyles(a),this._childrenTemplateMap=[],this._createChildren(),this._createChildComponents(this.getRootElement()),this.setComponentStyles(a),a},_setElementStyles:function(a){a.setStyles({display:"flex","flex-direction":"column"})},getRootElement:function(){return this._element},_onDataChanged:function(a){if(a.phase==Constants.DataItemEventPhase.ON_TARGET){for(var b=this._dataItemUtils.createDataChangeEventList(a,this._data),c=b.filter(function(a){var b=1==a.path.length;return b&&("add"==a.type||"delete"==a.type||a.item.isRef())}.bind(this)),d=0;d<c.length;d++){var e=c[d];"add"===e.type?this._addChildAndSetup(e.item,_.last(e.path),this._children.length+1):"delete"===e.type?this._removeChild(_.last(e.path)):e.item&&e.item.isRef()&&this._refreshChildAtIndex(_.last(e.path))}this._updateItemTemplates()}},_updateItemTemplates:function(){for(var a=this._children.length,b=0;a>b;b++){var c=this._resolveTemplateType(b,a);this._childrenTemplateMap[b]!==c.type&&this._refreshChildAtIndex(b);var d=this._children[b].getViewContext();this._addPositionInParentVars(d,b,a)}},_insertElementAt:function(a,b){var c=this.getRootElement().getChildren();if(0>b||b>c.length)throw"Invalid index. cannot insert the element at index "+b+".";0===b?this.getRootElement().grab(a,"top"):b===c.length?this.getRootElement().grab(a,"bottom"):c[b-1].grab(a,"after")},_refreshChildAtIndex:function(a){var b=this._children[a].getData();this._removeChild(a),this._addChildAndSetup(b,a,this._children.length)},_removeChild:function(a){var b=this._children.splice(a,1);this._onBeforeChildDisposed(b),b[0].dispose(),this._childrenTemplateMap.splice(a,1)},_addChildAndSetup:function(a,b,c){var d=this._addChild(a,b,c);if(d){var e=d.createComponent();this._onChildCreated(d,e),this._insertElementAt(e,b),d.setupProxy()}},_addChild:function(a,b,c){var d=this._resolveTemplateType(b,c);this._childrenTemplateMap.splice(b,0,d.type);var e=this._viewContext.getEnvironment().getProxyFactory(),f=this._viewContext.newContextForData(a);this._addTemplateVars(f,b,c),this._addPositionInParentVars(f,b,c);var g=e.createNewEvaluationScope(d.def,f),h=e.createProxyFromItemDefinition(f,g).proxy;return this._children.splice(b,0,h),h},_resolveTemplateType:function(a,b){var c=this._itemTemplate,d="item";return 0===a&&this._firstTemplate?(c=this._firstTemplate,d="first"):a==b-1&&this._lastTemplate&&(c=this._lastTemplate,d="last"),{def:c,type:d}},_loadTemplates:function(){var a=this._viewContext.getEnvironment();this._itemTemplate=this._getItemTemplate("item")||a.getDataItemFactory().createDataItem({id:this.getFieldId()+"_template_item",comp:{}},this._def),this._firstTemplate=this._getItemTemplate("first"),this._lastTemplate=this._getItemTemplate("last")},_getItemTemplate:function(a){return this._def.getChildByRef("templates")&&this._def.getChildByRef("templates").getChildByRef(a)},_getDefaultStyleName:function(){return null},_getDefaultSkinName:function(){return"mobile.core.skins.InlineSkin"},_onComponentWixified:function(){}})}),define.Class("wixapps.integration.proxies.LocationSelectorProxy",function(a){var b=a;b.inherits("wixapps.integration.proxies.WProxy"),b.binds(["_onComponentDataChanged"]),b.methods({createComponent:function(){var a="wixapps.integration.components.inputs.LocationSelector",b=this._data.getValue(),c={type:"GeoMap",address:b.address,latitude:b.latitude,longitude:b.longitude,addressInfo:b.addressInfo};return this.useSkinsInsteadOfStyles(),this._createWixComponent(a,c)},_getDefaultSkinName:function(){return"wixapps.integration.skins.inputs.LocationSelectorSkin"},_onDataChanged:function(){if(!this._userInputChange&&this._componentLogic){var a=this._data.getValue(),b=this._componentLogic.getDataItem();b.set("address",a.address,!0),b.set("latitude",a.latitude,!0),b.set("longitude",a.longitude,!0),b.set("addressInfo",a.addressInfo,!0),b.fireDataChangeEvent()}},_onComponentDataChanged:function(){var a=this._componentLogic.getDataItem(),b={_type:"wix:Location",address:a.get("address"),latitude:a.get("latitude"),longitude:a.get("longitude"),addressInfo:a.get("addressInfo")};this._userInputChange=!0,this._data.setValue(b),this._userInputChange=!1},_getAcceptableDataTypes:function(){return["wix:Location"]}})}),define.Class("wixapps.integration.proxies.MediaLabelProxy",function(a){var b=a;b.inherits("wixapps.integration.proxies.LabelProxy"),b.resources(["W.Utils"]),b.fields({_mediaTextDataUtils:null}),b.utilize(["wixapps.integration.utils.MediaTextDataUtils"]),b.methods({initialize:function(a,b,c,d){this._mediaTextDataUtils=new this.imports.MediaTextDataUtils,this.parent(a,b,c,d)},createComponent:function(){this.useSkinsInsteadOfStyles(),this._createDataItemsForComp(),this._registerResizeEvents();var a=this._createRawData();return this._createWixComponent(this._getCompName(),a)},_registerResizeEvents:function(){var a=this._viewContext.getEnvironment().getEventsDispatcher();a.addEvent(Constants.WixAppEvents.APP_PART_RESIZE,function(){this._updateCompSize()}.bind(this)),a.addEvent(Constants.WixAppEvents.APP_VIEW_READY,function(){this._updateCompSize()}.bind(this))},_updateCompSize:function(){this._componentLogic&&this._componentLogic._updateSize&&this._componentLogic._updateSize(this.getWidth())},_createRawData:function(){return{type:"MediaRichText",text:this._createFormattedText()}},_isLayoutBasedHeight:function(){return!1},_onDataChanged:function(){this._componentLogic&&!this._componentLogic.getIsDisposed()&&(this._createDataItemsForComp(),this._componentLogic.getDataItem().set("text",this._createFormattedText()),this.resources.W.Utils.isIE()&&this._viewContext.getEnvironment().getEventsDispatcher().fireEvent(Constants.WixAppEvents.PROXY_SIZE_INVALID))},_createFormattedText:function(){var a=this._getInnerText();a=this._prepareLinks(a);var b=new Element("div");return b.set("html",a),b=this._applyDefaultStyleOnText(b),b.innerHTML},_createDataItemsForComp:function(){if("wix:MediaRichText"===this._data.getTypeName()){var a=this._data.getValue();this._mediaTextDataUtils.createDataItems(a)}},_getAcceptableDataTypes:function(){return this.parent().concat(["wix:MediaRichText"])},_getCompName:function(){return"wysiwyg.viewer.components.MediaRichText"},_getInnerText:function(){var a="";if("wix:MediaRichText"===this._data.getTypeName()){var b=this._def.getChildrenRefs().some(function(a){return["prefix","postfix"].contains(a)});if(b)throw"Warning:: type [wix:RichText] does not support [prefix] or [postfix].";a=this._data.getChildValue("text")}else{var c=this._def.getChildValue("prefix"),d=this._def.getChildValue("postfix"),e=this._data.getValue();c&&(a+=c),e&&(a+=String(e).trim()),d&&(a+=d)}return a},_isSingleLine:function(){return!1}})}),define.Class("wixapps.integration.proxies.MediaRichTextEditorInlineProxy",function(a){var b=a;b.inherits("wixapps.integration.proxies.RichTextEditorInlineProxy"),b.binds(["_linkIdGenerator","_onEditingCompleted"]),b.utilize(["wixapps.integration.utils.MediaTextDataUtils"]),b.resources(["W.Data","W.Commands","W.Utils"]),b.fields({_mediaTextDataUtils:null}),b.methods({initialize:function(a,b,c,d){this.parent(a,b,c,d),this._mediaTextDataUtils=new this.imports.MediaTextDataUtils},createComponent:function(){this.useSkinsInsteadOfStyles();var a=this._mediaTextDataUtils.getDataManager();return this._updateLinkDataItems(a),this._createWixComponent("wysiwyg.editor.components.richtext.WRichTextEditor",null,{isRichMedia:!0,isFixedHeight:!0,isPersistent:!1,generateLinkIdFunc:this._linkIdGenerator,isFixedToolbar:!1,isDraggable:!1,isAutoClosing:!1,isInitiallyCollapsed:!1,addTextBackground:!0})
},_onComponentWixified:function(){var a=this._def.getChildValue("height");this._migrateHtml();var b=this._data.getValue();this._mediaTextDataUtils.createDataItems(b),this._componentLogic.addEvent(Constants.ComponentEvents.READY,function(){this._mediaTextDataUtils.createDataItems(b),this._componentLogic.startEditing(b.text,a,null,this._stylesMap)}.bind(this)),this._componentLogic.addEvent("endEditing",this._onEditingCompleted),this.resources.W.Commands.registerCommandAndListener("WAppsEditorCommands.FinalizeDataItemEditing",this,this._onFinalizeDataItemEditing)},_onEditingCompleted:function(a){var b=this._data.getValue(),c=this._mediaTextDataUtils.getCompPlaceholdersJsonData(a),d=this._mediaTextDataUtils.getImageJsonDataArray(c);b.imageList=this._convertImagesArrayToWixappsData(d);var e=this._mediaTextDataUtils.getVideoJsonDataArray(c);b.videoList=this._convertVideosArrayToWixappsData(e),b.text=a,b.links=this._getLinksDataFromHtml(b.text),delete b.version,this._data.setValue(b)},_convertImagesArrayToWixappsData:function(a){return _.map(a,function(a){var b=this._mediaTextDataUtils.getDataManager().getDataByQuery("#"+a.dataQuery).getData();return{_type:"wix:Image",src:b.uri,title:b.title,width:b.width,height:b.height}},this)},_convertVideosArrayToWixappsData:function(a){return _.map(a,function(a){var b=this._mediaTextDataUtils.getDataManager().getDataByQuery("#"+a.dataQuery).getData();return{_type:"wix:Video",videoId:b.videoId,videoType:b.videoType}},this)},_onComponentDataChanged:function(){for(var a=this._componentLogic.getDataItem().get("text"),b=a.match(/dataQuery="[^"]*/gi)||[],c=[],d=0;d<b.length;d++){var e=b[d].split('"')[1],f=this._mediaTextDataUtils.getDataManager().getDataByQuery(e);c.push(this._createAppsLink(f))}this._data.getChildByRef("links").setValue(c),this._data.getChildByRef("text").setValue(a)},_getDefaultSkinName:function(){return"wixapps.integration.skins.editor.WMediaRichTextInlineEditorSkin"}})}),define.Class("wixapps.integration.proxies.MediaRichTextProxy",function(a){var b=a;b.inherits("wixapps.integration.proxies.LabelProxy"),b.binds(["_onAppPartResize"]),b.traits(["wixapps.integration.proxies.traits.AppsLinkTrait"]),b.utilize(["wysiwyg.common.utils.TextMigrationHandler","wysiwyg.common.utils.TextMigrationDomHelper"]),b.resources(["W.Theme"]),b.fields({_styleString:""}),b.methods({initialize:function(a,b,c,d){this.parent(a,b,c,d)},_createRawData:function(){return{type:"MediaRichText",text:this._createFormattedText(),imageList:this._createImageData()}},_createFormattedText:function(){var a=this._getInnerText();a=this._prepareLinks(a);var b=this._getTextAsRichTextElement(a);return b=this._applyDefaultStyleOnText(b),b.innerHTML},_getCompName:function(){return"wysiwyg.viewer.components.MediaRichText"},_getInnerText:function(){var a="";return"wix:MediaRichText"===this._data.getTypeName()&&(a=this._data.getChildValue("text")),a},_createImageData:function(){this._getInnerText()}})}),define.Class("wixapps.integration.proxies.MediaThumbProxy",function(a){var b=a;b.inherits("wixapps.integration.proxies.VideoThumbProxy"),b.binds(["_showVideoThumb"]),b.traits(["wixapps.integration.utils.MediaTextDataUtils","wysiwyg.viewer.components.traits.VideoUtils"]),b.methods({_isContainsVideo:function(a){var b=this.getMediaPostPseudoType(a.text);return"VideoPost"===b},_isContainsImage:function(a){var b=this.getMediaPostPseudoType(a.text);return"PhotoPost"===b},_createRawData:function(){var a=this._data.getValue();return this._isContainsVideo(a)?this._createVideoRawData(a.videoList[0]):this._isContainsImage(a)?this._createImageRawData(a.imageList[0]):{type:"Image",uri:this._toAppImageUrl("images/icons/text.png"),width:100,height:66}},_onDataChanged:function(){var a=this._data.getValue();if(this._isContainsVideo(a)){var b=this._createRawData();this._showVideoThumb(b.uri)}else this._onImageDataChanged()},_onComponentWixified:function(){var a=this._data.getValue();this._isContainsVideo(a)?this.parent():this._element.removeClass("videoIndicator")}})}),define.Class("wixapps.integration.proxies.MultiColumnListProxy",function(a){var b=a;b.inherits("wixapps.integration.proxies.ListProxy"),b.methods({getRepeaterClass:function(){return"wixapps.integration.components.MultiColumnList"}})}),define.Class("wixapps.integration.proxies.MusicPlayerProxy",function(a){var b=a;b.inherits("wixapps.integration.proxies.WProxy"),b.resources(["W.Commands","W.Utils"]),b.binds(["_startActualPlay","_onRelevantDataChange","_stopPlaying"]),b.methods({createComponent:function(){var a=this._createRawData(),b=this._createWixComponent("wysiwyg.common.components.singleaudioplayer.viewer.SingleAudioPlayer",a,void 0);return b},_createElement:function(){var a=this.parent();return a.setAttribute("id",this.resources.W.Utils.getUniqueId()),a},_getDefaultStyleName:function(){return"mp1"},_getDefaultSkinName:function(){return"wysiwyg.common.components.singleaudioplayer.viewer.skins.PlaylistMusicPlayerSkin"},_setupPropertyHandlers:function(){this._mapToCompProperties(["autoplay","volume","loop","showArtist","showTrack"])},_makeMeUrlPlz:function(a){a=a||"";var b=a.split(".");if(2===b.length&&"mp3"===b[1])return a;var c=b[0],d="http://storage.googleapis.com/secure.wixstatic.com/preview/",e="-128.mp3";return d+c+e},_createRawData:function(){var a=this._data.getValue();this._data.getChildByRef("originalFileName").addEvent("dataItemChange",this._onRelevantDataChange),this._data.getChildByRef("uri").addEvent("uri",this._onRelevantDataChange);this._def.getValue();return{type:"SingleAudioPlayer",uri:this._makeMeUrlPlz(a.uri),track:a.title,artist:a.songArtist,originalFileName:a.originalFilename}},_onComponentWixified:function(){this.resources.W.Commands.registerCommandAndListener("WAppsEditorCommands.FinalizeDataItemEditing",this,this._onFinalizeDataItemEditing),this._componentLogic.addEvent("playNext",function(a){this.fireEvent("playNext",a)}.bind(this)),this._componentLogic.addEvent("playPrev",function(a){this.fireEvent("playPrev",a)}.bind(this)),(W.Config.env.$isPublicViewerFrame||W.Config.env.$isEditorViewerFrame)&&W.Viewer.addEvent("pageTransitionEnded",this._stopPlaying)},_stopPlaying:function(){this._componentLogic&&this._componentLogic._pauseAudio()},_onFinalizeDataItemEditing:function(){this._componentLogic&&this._componentLogic._stopAudio();var a=this.resources.W.Commands.getCommand("WAppsEditorCommands.FinalizeDataItemEditing");a&&a.unregisterListener(this)},_onRelevantDataChange:function(){if(this._componentLogic){this._componentLogic._stopAudio();var a=this._data.getValue(0),b=this._componentLogic.getDataItem();this._componentLogic.once("soundManagerUpdated",this,this._startActualPlay.bind(this)),b.set("track",a.originalFileName,!0),b.set("originalFileName",a.originalFileName,!0),b.set("uri",this._makeMeUrlPlz(a.uri),!0),b.fireDataChangeEvent({uri:this._makeMeUrlPlz(a.uri)})}},_startActualPlay:function(){var a=this._isPlaying();a&&(this._componentLogic._playAudio(),this.fireEvent("startedPlay",{}))},_isPlaying:function(){return this._componentLogic?"stopped"!==this._componentLogic.getState():!1},_getAcceptableDataTypes:function(){return["Audio"]}})}),define.Class("wixapps.integration.proxies.NumberInputProxy",function(a){var b=a;b.inherits("wixapps.integration.proxies.TextInputProxy"),b.methods({createComponent:function(){this.parent();var a=this._createRawData();return this._createWixComponent("wysiwyg.viewer.components.inputs.NumberInput",a)},_getDefaultSkinName:function(){return"wysiwyg.viewer.skins.input.NumberInputSkin"},_getDefaultStyleName:function(){return"numi1"},_getPropSchemaName:function(){return"NumberInputProperties"},_setupPropertyHandlers:function(){this.parent(),this._mapToCompProperty("minValue","minValue",Number),this._mapToCompProperty("maxValue","maxValue",Number)}})}),define.Class("wixapps.integration.proxies.NumericStepperProxy",function(a){var b=a;b.inherits("wixapps.integration.proxies.WProxy"),b.binds(["_onComponentDataChanged"]),b.methods({createComponent:function(){this.parent();var a=this._createRawData();return this._createWixComponent("wysiwyg.common.components.numericstepper.viewer.NumericStepper",a)},_createRawData:function(){var a=this._data.getValue();return{type:"NumericStepper",text:a.value}},_getDefaultSkinName:function(){return"wysiwyg.common.components.numericstepper.viewer.skins.NumericStepperSimpleSkin"},_createCompProperties:function(){return this._getPropertiesFromData()},_getPropertiesFromData:function(){var a=this._data.getValue();return{type:"NumericStepperProperties",minValue:a.minValue,maxValue:a.maxValue}},_onDataChanged:function(){if(this._componentLogic&&!this._ignoreUpdate){this._componentLogic.getDataItem().set("text",this._data.getValue().value);var a=this._getPropertiesFromData();this._componentLogic.setComponentProperty("minValue",a.minValue),this._componentLogic.setComponentProperty("maxValue",a.maxValue)}},_onComponentDataChanged:function(a,b,c){this._ignoreUpdate=!0;var d=this._data.getValue();d.value=Number(c.text),this._data.setValue(d),this._ignoreUpdate=!1},_getDefaultStyleName:function(){return"nums1"}})}),define.Class("wixapps.integration.proxies.OptionListInputProxy",function(a){var b=a;b.inherits("wixapps.integration.proxies.TextInputProxy"),b.binds(["_onComponentDataChanged"]),b.methods({createComponent:function(){var a=this._createRawData();return this._data.addEvent(Constants.DataItemEvents.VALIDATION_PERFORMED,this._onValidation),this._createWixComponent("wixapps.integration.components.inputs.TextInput",a)},_getPropSchemaName:function(){return"TextInputProperties"},_setupPropertyHandlers:function(){this.parent(),this._mapToCompProperties(["label","placeholder"])},_createRawData:function(){this._data.getValue();return{type:"Text",text:this._getOptionsAsText()}},_getOptionsAsText:function(){for(var a=this._data.getValue(),b="",c=0;c<a.items.length;c++)b+=a.items[c].text+"\n";return b},_getOptionsFromText:function(a){for(var b=a.split("\n"),c=[],d=0;d<b.length;d++)b[d].length>0&&c.push({_type:"Option",value:d,text:b[d]});return c},_onComponentWixified:function(){},_onDataChanged:function(){this._componentLogic&&!this._ignoreUpdate&&this._componentLogic.getDataItem().set("text",this._getOptionsAsText())},_onComponentDataChanged:function(a,b,c){this._ignoreUpdate=!0,this._data.getChildByRef("items").setValue(this._getOptionsFromText(c.text)),this._ignoreUpdate=!1},_getDefaultStyleName:function(){return"ti1"},_getDefaultSkinName:function(){return"wixapps.integration.skins.TextAreaSkin"}})}),define.Class("wixapps.integration.proxies.OptionsListProxy",function(a){var b=a;b.inherits("wixapps.integration.proxies.WProxy"),b.binds(["_onComponentDataChanged","_onValidation"]),b.traits(["wixapps.integration.proxies.traits.WDataExchangeTrait"]),b.statics({listType:{text:{compType:"wysiwyg.viewer.components.inputs.TextOption",compSkin:"wixapps.integration.skins.ecommerce.options.TextOptionSkin"},color:{compType:"wysiwyg.viewer.components.inputs.ColorOption",compSkin:"wixapps.integration.skins.ecommerce.options.ColorOptionSkin"}}}),b.methods({initialize:function(a,b,c,d){this.parent(a,b,c,d),this._listType=this._data.getChildValue("optionType")||"text";var e=c.getChildValue("optionSkin");e&&(this.listType[this._listType].compSkin=e);var f=c.getChildValue("optionComp");f&&(this.listType[this._listType].compType=f),this._data.addEvent(Constants.DataItemEvents.VALIDATION_PERFORMED,this._onValidation)},createComponent:function(){return this.useSkinsInsteadOfStyles(),this._createWixComponent("wysiwyg.common.components.inputs.OptionsListInput",this._createRawData(),this.listType[this._listType])},_createRawData:function(){var a=this._data.getChildByRef("items").getValue(),b=this._data.getChildByRef("selectedValue").getValue(),c=null,d=a.map(function(a){var d=this._getOptionWDataItem(a);return b&&a.value==b&&(c=d),d}.bind(this));return{type:"SelectableList",items:d,selected:c}},_getOptionWDataItem:function(a){var b={type:"SelectOption",value:a.value,text:a.text,enabled:a.enabled,description:a.description},c=W.Data.addDataItemWithUniqueId("apps",b).dataObject;return c.setMeta("isPersistent",!1),c},_onDataChanged:function(){if(this._componentLogic&&!this._ignoreUpdate){for(var a=null,b=this.getData().getChildValue("selectedValue"),c=this._componentLogic.getDataItem().get("items"),d=this.getData().getChildValue("items"),e=0;e<c.length;e++){var f=c[e].get("value");f==b&&(a=c[e]);var g=d[e].enabled;c[e].set("enabled",g)}this._componentLogic.getDataItem().set("selected",a),!a&&this._componentLogic._selectedItem&&this._refreshComponentData()}},_onComponentDataChanged:function(a,b,c){"selected"==b&&c.selected&&(this._ignoreUpdate=!0,this.getData().getChildByRef("selectedValue").setValue(c.selected.get("value")),this._ignoreUpdate=!1)},_setupPropertyHandlers:function(){this._handleProperties(["align","margin","label","href","target","linkType","icon"],function(){this._refreshComponentData()})},_onValidation:function(a){this._componentLogic&&a&&this._componentLogic.setValidationState(a.valid)},_refreshComponentData:function(){if(this._componentLogic){var a=this._createRawData(),b=this._componentLogic.getDataItem(),c=this._convertWItemDataToRawData(b);this._rawDataEquals(this._convertWItemDataToRawData(a),c)||(b.setData(a),b.setMeta("isPersistent",!1))}},_replaceAllTable:function(){var a=this._element,b=this.createComponent();a.parentNode.replaceChild(b,a),this.setupProxy()},_getDefaultSkinName:function(){return"wixapps.integration.skins.ecommerce.options.OptionsListInputSkin"}})}),define.Class("wixapps.integration.proxies.PaginatedColumnGalleryProxy",function(a){a.binds(["_recreateColumns","_recalcColumnSpacing","_recalcRowSpacing"]),a.inherits("wixapps.integration.proxies.PaginatedListProxy"),a.methods({createComponent:function(){var a=800/this._getNumOfColumns();this._viewContext.getEnvironment().setVar("estimatedColumnWidth",a);var b=this.parent(),c=this.getViewContext().getEnvironment().getVar("partDirection");return c.addEvent(Constants.DataItemEvents.CHANGE,this._recalcColumnSpacing),this._recreateColumns(),b},_recreateColumns:function(){for(var a=this._getNumOfColumns(),b=this.getRootElement(),c=0;a>c;c++)b.grab(this._createColumnDiv(a),"top");this._recalcColumnSpacing(),this._reorderChildren();for(var d=b.getChildren(),e=a;e<d.length;e++)d[e].destroy();this.fireEvent(Constants.WixAppEvents.APP_PART_RESIZE,{})},_recalcColumnSpacing:function(){for(var a=this._getNumOfColumns(),b=this.getRootElement().getChildren(),c=this._def.getChildValue("horizontalGap")||0,d=this.getViewContext().getEnvironment().getVar("partDirection").getValue(),e=Math.floor(c/a),f=0;a>f;f++)"rtl"===d?b[f].setStyles({"padding-right":f*e,"padding-left":(a-1-f)*e}):b[f].setStyles({"padding-left":f*e,"padding-right":(a-1-f)*e})},_recalcRowSpacing:function(){for(var a=this._getNumOfColumns(),b=this.getRootElement().getChildren(),c=this._def.getChildValue("verticalGap")||0,d=0;a>d;d++)for(var e=b[d].getChildren(),f=0;f<e.length;f++)0===f?e[f].setStyle("margin-top",0):e[f].setStyle("margin-top",Number(c))},_reorderChildren:function(){for(var a=this._getNumOfColumns(),b=[],c=0;a>c;c++)b.push(0);for(var d=this.getRootElement().getChildren(),e=0;e<this._children.length;e++){var f=_.indexOf(b,_.min(b)),g=this._children[e];d[f].grab(g.getElement()),b[f]+=this._getEstimatedHeight(g)}this._recalcRowSpacing()},_getNumOfColumns:function(){return this._def.getChildValue("columns")||3},_createColumnDiv:function(a){return new Element("div",{styles:{display:"inline-block","vertical-align":"top","box-sizing":"border-box","-moz-box-sizing":"border-box",width:100/a+"%"}})},_setupPropertyHandlers:function(){this.parent(),this._handleProperty("horizontalGap",this._recalcColumnSpacing),this._handleProperty("verticalGap",this._recalcRowSpacing),this._handleProperty("columns",this._recreateColumns)},_setElementStyles:function(a){a.setStyle("display","block")},_insertElementAt:function(a,b){var c=this._children.length;if(0>b||b>c)throw"Invalid index. cannot insert the element at index "+b+".";0===b?this._reorderChildren():b===c?this.getRootElement().getChildren()[this._getNumOfColumns()-1].grab(a):this._reorderChildren()},_getEstimatedHeight:function(a){var b=a.getViewContext().getEnvironment().getVar("estimatedHeight");return b?b.getValue():1}})}),define.Class("wixapps.integration.proxies.PaginatedListProxy",function(a){var b=a;b.inherits("wixapps.integration.proxies.ListProxy2"),b.utilize(["wixapps.core.data.DataPagination","wixapps.core.utils.WixAppsLogger"]),b.resources(["W.Commands","W.Utils"]),b.binds(["_onComponentRender","_onPaginationUpdated","_onTogglePagination","_onItemsPerPageChanged","_initEnvironmentVariables","_nextPage","_prevPage","dispose"]),b.fields({_pagination:null,_logger:null}),b.methods({initialize:function(a,b,c,d){this._def=c,this._logger=new this.imports.WixAppsLogger;var e=a.getEnvironment().getDataItemFactory(),f=c.getChildByRef("itemsPerPage").getValue();f=this._getShouldUsePagination()?parseInt(f):1/0,this._pagination=new this.imports.DataPagination(b,e,f),this._initEnvironmentVariables(a),this.parent(a,this._pagination.getData(),c,d),this._initEvents()},getRootElement:function(){return this._componentLogic&&this._componentLogic.getIntakeContainer?this._componentLogic.getIntakeContainer():this._innerElement||this._element},getPaginationLogic:function(){return this._pagination},_initEvents:function(){var a=this;this._pagination.addEvent(this._pagination.PAGINATION_UPDATED,this._onPaginationUpdated),this.addEventFilteredByScope("descendant","nextPageClicked",this._nextPage),this.addEventFilteredByScope("descendant","prevPageClicked",this._prevPage),this.addEventFilteredByScope("descendant","itemSelectionChanged",function(b){a._pagination.setPageByItemIndex(b.index)}),this._def.getChildByRef("hidePagination").addEvent(Constants.DataItemEvents.CHANGE,this._onTogglePagination),this._def.getChildByRef("itemsPerPage").addEvent(Constants.DataItemEvents.CHANGE,this._onItemsPerPageChanged)},_initEnvironmentVariables:function(a){var b=a.getEnvironment(),c=this._pagination.getCurrentPage(),d=this._pagination.getTotalPageCount();b.setVar("currentPage",c),b.setVar("maxPage",d),b.setVar("hasNext",c!==d),b.setVar("hasPrev",1!==c),b.setVar("hidePagination",this._def.getChildValue("hidePagination"))},_getLogicArgs:function(){return{pagination:this._pagination}},_onComponentWixified:function(){this.parent(),this._onTogglePagination(null,!0)},_onComponentRender:function(){this.updateLayoutWhenReady()},_onDataChanged:function(a){if(a.phase==Constants.DataItemEventPhase.ON_TARGET){for(var b=this._dataItemUtils.createDataChangeEventList(a,this._data),c=b.filter(function(a){var b=1==a.path.length;return b&&("add"==a.type||"delete"==a.type||"replace"===a.type||a.item.isRef())}.bind(this)),d=0;d<c.length;d++){var e=c[d];"add"===e.type?this._addChildAndSetup(e.item,_.last(e.path),this._children.length+1):"delete"===e.type?this._removeChild(_.last(e.path)):"replace"===e.type?this._replaceChild(_.last(e.path),e.item):e.item&&e.item.isRef()&&this._refreshChildAtIndex(_.last(e.path))}this._updateItemTemplates()}},_replaceChild:function(a,b){this._removeChild(a),this._addChildAndSetup(b,a,this._children.length)},_getShouldUsePagination:function(){var a=this._def.getChildValue("hidePagination");return"false"===a||a===!1},_onTogglePagination:function(a,b){var c=this.getViewContext().getEnvironment(),d=this._getShouldUsePagination();if(d){c.setVar("hidePagination","false");var e=parseInt(this._def.getChildValue("itemsPerPage"));this._pagination.setPosition(0,e)}else c.setVar("hidePagination","true"),this._pagination.setPosition(0,1/0);b||this._reportUserToggledPagination(d)},_onItemsPerPageChanged:function(a){var b=this._getShouldUsePagination();b&&a.newValue!==a.oldValue&&this._pagination.setPosition(0,a.newValue)},_onPaginationUpdated:function(){var a=this.getViewContext();if(a){var b=this._getShouldUsePagination(),c=1,d=1;b&&(c=this._pagination.getCurrentPage(),d=this._pagination.getTotalPageCount());var e=this.getViewContext().getEnvironment();e.setVar("currentPage",c),e.setVar("maxPage",d),e.setVar("hasNext",c!==d),e.setVar("hasPrev",1!==c)}else this.resources.W.Utils.callLater(this._onPaginationUpdated(),null,this,300)},_nextPage:function(){this._pagination.nextPage(),this._scrollToTop()},_prevPage:function(){this._pagination.prevPage(),this._scrollToTop()},_scrollToTop:function(){var a=this.getRootElement();if(a){var b=a.getBoundingClientRect().top;0>b&&(a.scrollIntoView(),window.scrollBy(0,-20))}},_reportUserToggledPagination:function(a){var b={g1:a.toString()};this._logger.reportEvent(this._logger.Events.APP_BUILDER_TOGGLE_PAGINATION,b)},dispose:function(){var a=this;this._pagination.dispose(),this._pagination.removeEvent(this._pagination.PAGINATION_UPDATED,this._onPaginationUpdated),this.removeEvent("nextPageClicked",this._nextPage),this.removeEvent("prevPageClicked",this._prevPage),this.removeEvent("itemSelectionChanged",function(b){a._pagination.setPageByItemIndex(b.index)}),this._def.getChildByRef("hidePagination").removeEvent(Constants.DataItemEvents.CHANGE,this._onTogglePagination),this._def.getChildByRef("itemsPerPage").removeEvent(Constants.DataItemEvents.CHANGE,this._onItemsPerPageChanged),this.parent()}})}),define.Class("wixapps.integration.proxies.ProxyMap",function(a){var b=a;b.utilize(["wixapps.integration.proxies.VerticalLineProxy","wixapps.integration.proxies.HorizontalLineProxy","wixapps.integration.proxies.SwitchProxy","wixapps.integration.proxies.LabelProxy","wixapps.integration.proxies.ClippedParagraphProxy","wixapps.integration.proxies.ClippedParagraph2Proxy","wixapps.integration.proxies.DateProxy","wixapps.integration.proxies.DateSelectorProxy","wixapps.integration.proxies.TimeSelectorProxy","wixapps.integration.proxies.InlineTextProxy","wixapps.integration.proxies.TextInputProxy","wixapps.integration.proxies.ErasableTextInputProxy","wixapps.integration.proxies.StringArrayInputProxy","wixapps.integration.proxies.InlineTextInputProxy","wixapps.integration.proxies.NumberInputProxy","wixapps.integration.proxies.NumericStepperProxy","wixapps.integration.proxies.SliderProxy","wixapps.integration.proxies.RichTextEditorProxy","wixapps.integration.proxies.RichTextEditorInlineProxy","wixapps.integration.proxies.FormattedPriceProxy","wixapps.integration.proxies.EnumSelectorProxy","wixapps.integration.proxies.ImageProxy","wixapps.integration.proxies.ImageSelectorProxy","wixapps.integration.proxies.ImageInputProxy","wixapps.integration.proxies.VerticalListProxy","wixapps.integration.proxies.FlowListProxy","wixapps.integration.proxies.MultiColumnListProxy","wixapps.integration.proxies.ButtonProxy","wixapps.integration.proxies.Button2Proxy","wixapps.integration.proxies.LinkProxy","wixapps.integration.proxies.LinkSelectorProxy","wixapps.integration.proxies.layout.CssLayoutProxy","wixapps.integration.proxies.layout.BoxLayoutProxy","wixapps.integration.proxies.layout.StackLayoutProxy","wixapps.integration.proxies.layout.FieldProxy","wixapps.integration.proxies.layout.SwitchBoxProxy","wixapps.integration.proxies.layout.OptionalAreaProxy","wixapps.integration.proxies.layout.FieldBoxProxy","wixapps.integration.proxies.layout.TextFieldProxy","wixapps.integration.proxies.layout.DataEditFieldProxy","wixapps.integration.proxies.SpacerProxy","wixapps.integration.proxies.GalleryProxy","wixapps.integration.proxies.SuperFlowProxy","wixapps.integration.proxies.VerticalListEditorProxy","wixapps.integration.proxies.DraggableListItemProxy","wixapps.integration.proxies.TableProxy","wixapps.integration.proxies.OptionsListProxy","wixapps.integration.proxies.SelectOptionsListProxy","wixapps.integration.proxies.OptionListInputProxy","wixapps.integration.proxies.ComboBoxProxy","wixapps.integration.proxies.RadioGroupProxy","wixapps.integration.proxies.CheckBoxGroupProxy","wixapps.integration.proxies.TabMenuProxy","wixapps.integration.proxies.TextAreaProxy","wixapps.integration.proxies.AreaProxy","wixapps.integration.proxies.SliderGalleryProxy","wixapps.integration.proxies.VideoProxy","wixapps.integration.proxies.VideoThumbProxy","wixapps.integration.proxies.MediaThumbProxy","wixapps.integration.proxies.IconProxy","wixapps.integration.proxies.VideoSelectorProxy","wixapps.integration.proxies.ToggleProxy","wixapps.integration.proxies.DeckProxy","wixapps.integration.proxies.ContainerProxy","wixapps.integration.proxies.ZoomLinkProxy","wixapps.integration.proxies.AppLinkProxy","wixapps.integration.proxies.layout.ZoomLayoutProxy","wixapps.integration.proxies.layout.FixedRatioLayoutProxy","wixapps.integration.proxies.CheckBoxProxy","wixapps.integration.proxies.CheckBoxViewProxy","wixapps.integration.proxies.GoogleMapProxy","wixapps.integration.proxies.LocationSelectorProxy","wixapps.integration.proxies.EmptyProxy","wixapps.integration.proxies.TagInputProxy","wixapps.integration.proxies.ListProxy2","wixapps.integration.proxies.ColumnGalleryProxy","wixapps.integration.proxies.PaginatedColumnGalleryProxy","wixapps.integration.proxies.UnstyledLabelProxy","wixapps.integration.proxies.TooltipIconProxy","wixapps.integration.proxies.HelpProxy","wixapps.integration.proxies.IFrameProxy","wixapps.integration.proxies.ImageButtonProxy","wixapps.integration.proxies.MusicPlayerProxy","wixapps.integration.proxies.AudioInputProxy","wixapps.integration.proxies.GridGalleryProxy","wixapps.integration.proxies.InlineSvgProxy","wixapps.integration.proxies.DragAndDropVListProxy","wixapps.integration.proxies.PaginatedListProxy","wixapps.integration.proxies.MediaRichTextEditorInlineProxy","wixapps.integration.proxies.ImageListEditorButtonProxy","wixapps.integration.proxies.MediaLabelProxy"]),b.methods({registerComponentProxies:function(a){a.registerProxy("Label",this.imports.LabelProxy,"String"),a.registerProxy("ClippedParagraph",this.imports.ClippedParagraphProxy,"String"),a.registerProxy("ClippedParagraph2",this.imports.ClippedParagraph2Proxy,"String"),a.registerProxy("Date",this.imports.DateProxy,"wix:Date"),a.registerProxy("DateEdit",this.imports.DateSelectorProxy,"wix:Date"),a.registerProxy("TimeEdit",this.imports.TimeSelectorProxy,"wix:Date"),a.registerProxy("InlineText",this.imports.InlineTextProxy,"String"),a.registerProxy("InlineTextInput",this.imports.InlineTextInputProxy,"String"),a.registerProxy("TextInput",this.imports.TextInputProxy,"String"),a.registerProxy("ErasableTextInput",this.imports.ErasableTextInputProxy,"String"),a.registerProxy("NumberInput",this.imports.NumberInputProxy,"Number"),a.registerProxy("NumericStepper",this.imports.NumericStepperProxy,"Number"),a.registerProxy("Slider",this.imports.SliderProxy,"Number"),a.registerProxy("CheckBox",this.imports.CheckBoxProxy,"Boolean"),a.registerProxy("CheckBoxViewProxy",this.imports.CheckBoxViewProxy,"Boolean"),a.registerProxy("RichTextEditor",this.imports.RichTextEditorProxy,"wix:RichText"),a.registerProxy("RichTextEditorInline",this.imports.RichTextEditorInlineProxy,"wix:RichText"),a.registerProxy("Price",this.imports.FormattedPriceProxy,"Price"),a.registerProxy("EnumSelector",this.imports.EnumSelectorProxy,""),a.registerProxy("Image",this.imports.ImageProxy,"wix:Image"),a.registerProxy("Video",this.imports.VideoProxy,"wix:Video"),a.registerProxy("VideoSelector",this.imports.VideoSelectorProxy,"wix:Video"),a.registerProxy("VideoThumb",this.imports.VideoThumbProxy,"wix:Video"),a.registerProxy("ImageSelector",this.imports.ImageSelectorProxy,"wix:Image"),a.registerProxy("ImageInput",this.imports.ImageInputProxy,"wix:Image"),a.registerProxy("VerticalList",this.imports.VerticalListProxy,"Array"),a.registerProxy("FlowList",this.imports.FlowListProxy,"Array"),a.registerProxy("MultiColumn",this.imports.MultiColumnListProxy,"Array"),a.registerProxy("VerticalListEditor",this.imports.VerticalListEditorProxy,"Array"),a.registerProxy("DraggableListItem",this.imports.DraggableListItemProxy,""),a.registerProxy("Box",this.imports.BoxLayoutProxy,""),a.registerProxy("VBox",this.imports.BoxLayoutProxy,""),a.registerProxy("HBox",this.imports.BoxLayoutProxy,""),a.registerProxy("Field",this.imports.FieldProxy,""),a.registerProxy("FieldBox",this.imports.FieldBoxProxy,""),a.registerProxy("TextField",this.imports.TextFieldProxy,"String"),a.registerProxy("DataEditField",this.imports.DataEditFieldProxy,""),a.registerProxy("Stack",this.imports.StackLayoutProxy,""),a.registerProxy("Css",this.imports.CssLayoutProxy,""),a.registerProxy("VSpacer",this.imports.SpacerProxy,""),a.registerProxy("HSpacer",this.imports.SpacerProxy,""),a.registerProxy("InlineSpacer",this.imports.SpacerProxy,""),a.registerProxy("HorizontalLine",this.imports.HorizontalLineProxy,""),a.registerProxy("VerticalLine",this.imports.VerticalLineProxy,""),a.registerProxy("Switch",this.imports.SwitchProxy,""),a.registerProxy("SwitchBox",this.imports.SwitchBoxProxy,"String"),a.registerProxy("OptionalArea",this.imports.OptionalAreaProxy,""),a.registerProxy("SuperFlow",this.imports.SuperFlowProxy,""),a.registerProxy("Button",this.imports.ButtonProxy,""),a.registerProxy("Button2",this.imports.Button2Proxy,""),a.registerProxy("Table",this.imports.TableProxy,""),a.registerProxy("Deck",this.imports.DeckProxy,""),a.registerProxy("TabMenu",this.imports.TabMenuProxy,""),a.registerProxy("Icon",this.imports.IconProxy,""),a.registerProxy("StringArrayInput",this.imports.StringArrayInputProxy,"Array"),a.registerProxy("Toggle",this.imports.ToggleProxy,""),a.registerProxy("MusicPlayer",this.imports.MusicPlayerProxy,""),a.registerProxy("AudioInput",this.imports.AudioInputProxy,""),a.registerProxy("InlineSvg",this.imports.InlineSvgProxy,""),a.registerProxy("Link",this.imports.LinkProxy,"wix:LinkBase"),a.registerProxy("LinkSelector",this.imports.LinkSelectorProxy,"wix:LinkBase"),a.registerProxy("OptionsList",this.imports.OptionsListProxy,"OptionsList"),a.registerProxy("SelectOptionsList",this.imports.SelectOptionsListProxy,"OptionsList"),a.registerProxy("OptionsListInput",this.imports.OptionListInputProxy,"OptionsList"),a.registerProxy("ComboBox",this.imports.ComboBoxProxy,"ComboOptionsList"),a.registerProxy("RadioGroup",this.imports.RadioGroupProxy,"ComboOptionsList"),a.registerProxy("CheckBoxGroup",this.imports.CheckBoxGroupProxy,"MultiOptionsList"),a.registerProxy("TextArea",this.imports.TextAreaProxy,"String"),a.registerProxy("Area",this.imports.AreaProxy),a.registerProxy("Container",this.imports.ContainerProxy,""),a.registerProxy("ZoomLink",this.imports.ZoomLinkProxy,""),a.registerProxy("AppLink",this.imports.AppLinkProxy,""),a.registerProxy("ZoomLayout",this.imports.ZoomLayoutProxy,""),a.registerProxy("FixedRatioLayout",this.imports.FixedRatioLayoutProxy,""),a.registerProxy("GoogleMap",this.imports.GoogleMapProxy,"wix:Location"),a.registerProxy("LocationSelector",this.imports.LocationSelectorProxy,"wix:Location"),a.registerProxy("Empty",this.imports.EmptyProxy,""),a.registerProxy("TagInput",this.imports.TagInputProxy,""),a.registerProxy("DragAndDropVList",this.imports.DragAndDropVListProxy,""),a.registerProxy("List2",this.imports.ListProxy2,"Array"),a.registerProxy("PaginatedList",this.imports.PaginatedListProxy,"Array"),a.registerProxy("UnstyledLabel",this.imports.UnstyledLabelProxy,"String"),a.registerProxy("TooltipIcon",this.imports.TooltipIconProxy,""),a.registerProxy("Help",this.imports.HelpProxy,""),a.registerProxy("IFrame",this.imports.IFrameProxy,"String"),a.registerProxy("ImageButton",this.imports.ImageButtonProxy,""),a.registerProxy("MediaRichTextEditorInline",this.imports.MediaRichTextEditorInlineProxy,"wix:MediaRichText"),a.registerProxy("MediaLabel",this.imports.MediaLabelProxy,"wix:MediaRichText"),a.registerProxy("MediaThumb",this.imports.MediaThumbProxy,"wix:MediaRichText"),a.registerProxy("ImageListEditorButton",this.imports.ImageListEditorButtonProxy,"wix:ImageList"),this._registerGalleryProxies(a)},_registerGalleryProxies:function(a){a.registerProxy("Gallery",this.imports.GalleryProxy,"Array"),a.registerProxy("GridGallery",this.imports.GridGalleryProxy,"Array"),a.registerProxy("SliderGallery",this.imports.SliderGalleryProxy,"Array"),a.registerProxy("ColumnGallery",this.imports.ColumnGalleryProxy,"Array"),a.registerProxy("PaginatedColumnGallery",this.imports.PaginatedColumnGalleryProxy,"Array")
}})}),define.Class("wixapps.integration.proxies.RadioGroupProxy",function(a){var b=a;b.inherits("wixapps.integration.proxies.ComboBoxProxy"),b.binds(["_onComponentDataChanged"]),b.methods({createComponent:function(){var a=Number.random(0,99999).toString(36),b="radio_group_"+a;return this._createWixComponent("wysiwyg.viewer.components.inputs.RadioGroupInput",this._createRawData(),{radioGroupName:b,selectedValue:this._data.getChildValue("selectedValue")})},_getDefaultSkinName:function(){return"wysiwyg.viewer.skins.input.RadioGroupInputSkin"},_getDefaultStyleName:function(){return"wa_rg1"}})}),define.Class("wixapps.integration.proxies.RichTextEditorInlineProxy",function(a){var b=a;b.inherits("wixapps.integration.proxies.WProxy"),b.binds(["_linkIdGenerator","_onEditingCompleted"]),b.traits(["wixapps.integration.proxies.traits.AppsLinkTrait"]),b.utilize(["wysiwyg.common.utils.TextMigrationHandler"]),b.resources(["W.Data","W.Commands","W.Utils"]),b.methods({initialize:function(a,b,c,d){this.parent(a,b,c,d),this._stylesMap=this.resources.W.Data.getDataByQuery("#WIXAPPS_EDITOR_STYLES"),this._migrationHandler=new this.imports.TextMigrationHandler},createComponent:function(){this.useSkinsInsteadOfStyles();var a=W.Data;return W.Editor&&(a=W.Preview.getPreviewManagers().Data),this._updateLinkDataItems(a),this._createWixComponent("wysiwyg.editor.components.richtext.WRichTextEditor",null,{isFixedHeight:!0,isPersistent:!1,generateLinkIdFunc:this._linkIdGenerator,isFixedToolbar:!1,isDraggable:!1,isAutoClosing:!1,isInitiallyCollapsed:!1,addTextBackground:!0})},_onComponentWixified:function(){var a=this._def.getChildValue("height");this._migrateHtml();var b=this._data.getChildValue("text");this._componentLogic.addEvent(Constants.ComponentEvents.READY,function(){this._componentLogic.startEditing(b,a,null,this._stylesMap)}.bind(this)),this._componentLogic.addEvent("endEditing",this._onEditingCompleted),this.resources.W.Commands.registerCommandAndListener("WAppsEditorCommands.FinalizeDataItemEditing",this,this._onFinalizeDataItemEditing)},_onFinalizeDataItemEditing:function(){this.resources.W.Commands.executeCommand("WEditorCommands.StopEditingText");var a=this.resources.W.Commands.getCommand("WAppsEditorCommands.FinalizeDataItemEditing");a&&a.unregisterListener(this)},_onEditingCompleted:function(a){var b=this._data.getValue();b.text=a,b.links=this._getLinksDataFromHtml(b.text),b.version=2,this._data.setValue(b)},_migrateHtml:function(){var a=this._data.getValue();"wix:MediaRichText"!==a._type&&(a.hasOwnProperty("version")&&1!==a.version||(a.text=this._migrationHandler.migrateText(a.text,this._getDefaultStylePlaceHolderTag(),this._getDefaultStyleName()),a.version=2,this._data.setValue(a)))},_getLinksDataFromHtml:function(a){for(var b=a.match(/dataQuery="[^"]*/gi)||[],c=[],d=0;d<b.length;d++){var e=b[d].split('"')[1],f=W.Preview.getPreviewManagers().Data.getDataByQuery(e);c.push(this._createAppsLink(f))}return c},_getDefaultSkinName:function(){return"wixapps.integration.skins.editor.WRichTextInlineEditorSkin"},_getDefaultStyleName:function(){return this._stylesMap.get("items").div.cssClass},_getDefaultStylePlaceHolderTag:function(){return this._stylesMap.get("items").div.seoTag},_onComponentDataChanged:function(){for(var a=this._componentLogic.getDataItem().get("text"),b=a.match(/dataQuery="[^"]*/gi)||[],c=[],d=0;d<b.length;d++){var e=b[d].split('"')[1],f=W.Preview.getPreviewManagers().Data.getDataByQuery(e);c.push(this._createAppsLink(f))}this._data.getChildByRef("links").setValue(c),this._data.getChildByRef("text").setValue(a)},_linkIdGenerator:function(){return this.resources.W.Utils.AppsUtils.generateLinkId(this._viewContext.getEnvironment().getProxyFactory().getNameSpace())},dispose:function(){var a=this.resources.W.Commands.getCommand("WAppsEditorCommands.FinalizeDataItemEditing");a&&a.unregisterListener(this),this._componentLogic.removeEvent(Constants.ComponentEvents.READY),this.parent()}})}),define.dataItem.multi({WIXAPPS_EDITOR_STYLES:{type:"map",metaData:{isPersistent:!1},items:{h1:{tag:"h1",cssClass:"font_3"},h2:{tag:"h2",cssClass:"font_4"},h3:{tag:"h3",cssClass:"font_5"},h4:{tag:"h4",cssClass:"font_6"},h5:{tag:"h5",cssClass:"font_7"},h6:{tag:"h6",cssClass:"font_8"},p:{tag:"p",cssClass:"font_9"},div:{tag:"div",cssClass:"font_8",label:"default",seoTag:"hatul"}}}}),define.Class("wixapps.integration.proxies.RichTextEditorProxy",function(a){var b=a;b.inherits("wixapps.integration.proxies.UnstyledLabelProxy"),b.resources(["W.Data","W.Utils","W.Commands"]),b.binds(["_linkIdGenerator","_onPreviewClicked","_onEditingCompleted","_onCKDataChanged","_onScrollContainerScroll"]),b.utilize(["core.utils.css.Color"]),b.fields({_editorElement:void 0,_editorData:void 0,_editorLogic:void 0,_onEditorReady:[],_ignoreEditorDataChange:void 0}),b.methods({_linkIdGenerator:function(){return this.resources.W.Utils.AppsUtils.generateLinkId("appbuilder")},_onComponentWixified:function(){var a=this._def.getChildValue("height");this._componentLogic.setHeight(a);var b=this._componentLogic.getSkinPart("frame");b.setStyle("height",a+"px"),this._componentLogic.getSkinPart("richTextContainer").addEvent(Constants.CoreEvents.CLICK,this._onPreviewClicked),this._createRTEditorComponent()},_createRTEditorComponent:function(){var a=W.Data;W.Editor&&(a=W.Preview.getPreviewManagers().Data),this._updateLinkDataItems(a);var b=new Element("DIV");b.set("comp","wysiwyg.editor.components.richtext.WRichTextEditor"),b.set("skin","wixapps.integration.skins.editor.WRichTextEditorAppBuilderSkin"),b.set("pos",""),this._editorElement=b,this._editorElement.addEvent(Constants.ComponentEvents.WIXIFIED,function(){}.bind(this)),this._editorElement.addEvent(Constants.ComponentEvents.READY,function(){this._editorLogic=b.getLogic(),this._editorLogic.addEvent("richTextEditorReady",function(){this._componentLogic.getSkinPart("richTextContainer").setStyle("visibility","hidden")}.bind(this)),this._scrollContainer=this._findFirstScrollerContainer(),this._notifyEditorReady()}.bind(this)),this._componentLogic.getSkinPart("frame").grab(b);var c={isFixedHeight:!0,isPersistent:!1,generateLinkIdFunc:this._linkIdGenerator,getDataOnCKChange:!0,addTextBackground:!1};this._editorElement.wixify(c,this._editorData)},_onPreviewClicked:function(){this._getEditorComponent(function(a){var b=this._element.getWidth(),c=this._def.getChildValue("height"),d=this._data.getChildValue("text");a.addEvent("endEditing",this._onEditingCompleted),a.addEvent("ckDataChanged",this._onCKDataChanged),this.resources.W.Commands.registerCommand("WAppsEditor2Commands.BeforeListItemSelectionMadafaka",!0),this.resources.W.Commands.registerCommandListenerByName("WAppsEditor2Commands.BeforeListItemSelectionMadafaka",this,this._onBeforeDataItemChanged),this._scrollContainer&&(this._scrollIntoView(),this._scrollContainer.addEvent("scroll",this._onScrollContainerScroll)),this.resources.W.Commands.executeCommand("WAppsEditor2Commands.BeforeStartEditingText");var e=new Element("div");e.innerHTML=d;var f=this._traverseTextAndCheckIfBright(e);f?a.$view.setStyle("background-color","#0383D3"):a.$view.setStyle("background-color","#FFFFFF"),a.startEditing(d,c,b,this._stylesMap)}.bind(this))},_traverseTextAndCheckIfBright:function(a){if(a.children)for(var b=0;b<a.children.length;b++){var c=a.children[b],d=this._isTextNodeBright(c);return d?!0:this._traverseTextAndCheckIfBright(c)}return!1},_isTextNodeBright:function(a){var b=a.classList,c=this._getFontColors(b),d=this._getColors(b),e=this._getInlineColor(a),f=_.union(c,d,e),g=this._areColorsBright(f);return g?!0:void 0},_areColorsBright:function(a){var b=_.filter(a,function(a){return a.getBrightness()>50});return b.length>0},_getFontColors:function(a){var b=W.Preview.getPreviewManagers().Theme,c=_.filter(a,function(a){return a.indexOf("font")>-1}),d=[];return _.forEach(c,function(a){var c=b.getProperty(a),e=c.getColor();d.push(new this.imports.Color(e))}.bind(this)),d},_getColors:function(a){var b=W.Preview.getPreviewManagers().Theme,c=_.filter(a,function(a){return 0===a.indexOf("color_")}),d=[];return _.forEach(c,function(a){d.push(b.getProperty(a))}),d},_getInlineColor:function(a){var b=[],c=a.getStyle("color");return c&&b.push(new this.imports.Color(c)),b},_onScrollContainerScroll:function(){this._getEditorComponent(function(a){a.setToolbarPosition()}.bind(this))},_scrollIntoView:function(){var a=this._scrollContainer,b=this._element.getPosition(a),c=this._element.getHeight()+b.y,d=a.getHeight();b.y<0?a.scrollTop=a.scrollTop+b.y:c>d&&(a.scrollTop=a.scrollTop+Math.abs(c-d))},_findFirstScrollerContainer:function(){for(var a=this._element;a.getParent();)if(a=a.getParent(),"visible"!==a.getStyle("overflow-y"))return a;return null},_onBeforeDataItemChanged:function(){this.resources.W.Commands.executeCommand("WEditorCommands.StopEditingText")},_getEditorComponent:function(a){this._editorLogic?a(this._editorLogic):this._registerToEditorReadyNotification(a)},_onCKDataChanged:function(a){var b=this._data.getValue();b.text!==a&&(b.text=a,b.links=this._getLinksDataFromHtml(b.text),this._data.setValue(b))},_onEditingCompleted:function(a){var b=this._data.getValue();b.text=a,b.links=this._getLinksDataFromHtml(b.text),this._data.setValue(b),this._componentLogic.getSkinPart("richTextContainer").setStyle("visibility","inherit"),this._editorLogic.removeEvent("endEditing"),this._editorLogic.removeEvent("ckDataChanged"),this._scrollContainer&&this._scrollContainer.removeEvent("scroll",this._onScrollContainerScroll);var c=this.resources.W.Commands.getCommand("WAppsEditor2Commands.BeforeListItemSelectionMadafaka");c&&c.unregisterListener(this)},_getLinksDataFromHtml:function(a){for(var b=a.match(/dataQuery="[^"]*/gi)||[],c=[],d=0;d<b.length;d++){var e=b[d].split('"')[1],f=W.Preview.getPreviewManagers().Data.getDataByQuery(e);c.push(this._createAppsLink(f))}return c},_isSingleLine:function(){return!1},_registerToEditorReadyNotification:function(a){this._onEditorReady.push(a)},_notifyEditorReady:function(){for(;this._onEditorReady.length>0;){var a=this._onEditorReady.shift();a(this._editorLogic)}},_getDefaultSkinName:function(){return"wixapps.integration.skins.inputs.RichTextEditorSkin"},_getAcceptableDataTypes:function(){return["wix:RichText"]},dispose:function(){}})}),define.Class("wixapps.integration.proxies.SelectOptionsListProxy",function(a){var b=a;b.inherits("wixapps.integration.proxies.OptionsListProxy"),b.methods({createComponent:function(){return this.useSkinsInsteadOfStyles(),this._createWixComponent("wixapps.integration.components.inputs.SelectOptionsList",this._createRawData(),this.listType[this._listType])},_getDefaultSkinName:function(){return"wixapps.integration.skins.ecommerce.options.SelectOptionsListSkin"}})}),define.Class("wixapps.integration.proxies.SliderGalleryProxy",function(a){var b=a;b.inherits("wixapps.integration.proxies.WProxy"),b.methods({createComponent:function(){this.useSkinsInsteadOfStyles();var a=this._createWixComponent("wysiwyg.viewer.components.SelectableSliderGallery",this._createRawData(),null);return a.setStyle("position","relative"),a},_createRawData:function(){var a=this._data.getChildren(),b=[];return a.forEach(function(a){b.push(this._getWImage(a.getValue()))},this),{type:"ImageList",items:b}},_getWImage:function(a){var b={type:"Image",title:"",uri:a.src,description:"",height:a.height,width:a.width,borderSize:"",alt:""},c=W.Data.createDataItem(b);return c.setMeta("isPersistent",!1),c},_getPropSchemaName:function(){return"SliderGalleryProperties"},_setupPropertyHandlers:function(){this.parent(),this._mapToCompProperties(["showAutoplay","loop","showCounter"]),this._mapToCompProperty("expandEnabled","expandEnabled",function(a){return a===!0||"true"===a})},_getDefaultSkinName:function(){return"wysiwyg.viewer.skins.galleryselectableslider.SelectableSliderGalleryDefaultSkin"}})}),define.Class("wixapps.integration.proxies.SliderProxy",function(a){var b=a;b.inherits("wixapps.integration.proxies.WProxy"),b.binds(["_onComponentDataChanged","_onCompReady"]),b.methods({createComponent:function(){this.parent();var a=this._createWixComponent("wysiwyg.editor.components.inputs.Slider",null,this._getPropertiesFromData());return a.addEvent(Constants.ComponentEvents.READY,this._onCompReady),a},_getDefaultSkinName:function(){return"wysiwyg.editor.skins.inputs.SliderSkin"},_createCompProperties:function(){return this._getPropertiesFromData()},_getPropertiesFromData:function(){var a=this._def.getValue();return a.min=a.min&&Number(a.min),a.max=a.max&&Number(a.max),a.step=a.step&&Number(a.step),a},_onComponentWixified:function(){},_onCompReady:function(){this._componentLogic&&(this._componentLogic.setValue(this._data.getValue()),this._componentLogic.addEvent("inputChanged",this._onComponentDataChanged))},_onComponentDataChanged:function(a){this._ignoreUpdate=!0,this._data.setValue(Number(a.value)),this._ignoreUpdate=!1},_getDefaultStyleName:function(){return"numi1"}})}),define.Class("wixapps.integration.proxies.SpacerProxy",function(a){var b=a;b.inherits("wixapps.integration.proxies.WProxy"),b.fields({_spacerType:"",_spacerSize:10,_sizePropMap:{HSpacer:"width",VSpacer:"height",InlineSpacer:"word-spacing"}}),b.methods({_preventReflowCssClass:function(){return null},getSpacerType:function(){return this._spacerType},createComponent:function(){var a=this._createElement("div");return this._updateSpacerSize(a),a},isBoxFlexEnabled:function(){return"InlineSpacer"!==this._spacerType},getSpacerSize:function(){return this._spacerSize},_setupPropertyHandlers:function(){this._handleProperty("size",function(){this._updateSpacerSize(this._element)})},_updateSpacerSize:function(a){var b;this._spacerType=this._def.getChildValue("name");var c={};"InlineSpacer"===this._spacerType?(this._spacerType="InlineSpacer",c.display="inline",this._element.set("text"," ")):a.setStyle("display","box");var d=this._def.getChildValue("size");void 0!==d&&(this._spacerSize=d),b=this._sizePropMap[this._spacerType];var e="width"===b?"height":"width";c[e]=0,"*"===this._spacerSize?(c[b]=0,c["box-flex"]="1"):b&&(c[b]=parseInt(this._spacerSize,10)+"px",c["box-flex"]="none"),a.setStyles(c)},getProxyMetaTags:function(){var a=["spacer"];return"InlineSpacer"===this._spacerType&&a.push("inline"),a}})}),define.Class("wixapps.integration.proxies.StringArrayInputProxy",function(a){var b=a,c={none:function(a){return a},toLower:function(a){return a.toLowerCase()},toUpper:function(a){return a.toUpperCase()}};b.inherits("wixapps.integration.proxies.TextInputProxy"),b.methods({_createRawData:function(){var a=this._data.getValue(),b=this._arrayToString(a);return{type:"Text",text:b}},_arrayToString:function(a){var b=this._def.getChildValue("joinSeparator")||", ";return a.join(b)},_stringToArray:function(a){var b=this._def.getChildValue("splitRegex")||"\\s*,\\s*",d=this._def.getChildValue("filterEmpty");d=d!==!1&&"false"!==d;var e=this._def.getChildValue("filterDuplicates");e=e!==!1&&"false"!==e;var f=c[this._def.getChildValue("conversion")||"none"],g=f(a).split(new RegExp(b)),h=d?g.filter(function(a){return!!a}):g;if(e){var i={};h=h.filter(function(a){return i[a]!==!0?(i[a]=!0,!0):!1})}return h},_onDataChanged:function(){this._componentLogic&&!this._ignoreUpdate&&this._componentLogic.getDataItem().set("text",this._arrayToString(this._data.getValue()))},_onComponentDataChanged:function(a,b,c){this._ignoreUpdate=!0,this._data.setValue(this._stringToArray(c.text)),this._ignoreUpdate=!1},_getAcceptableDataTypes:function(){return["Array"]}})}),define.Class("wixapps.integration.proxies.SuperFlowProxy",function(a){var b=a;b.inherits("wixapps.integration.proxies.WCompositeProxy"),b.utilize(["wixapps.core.layouts.SuperFlowLayout"]),b.fields({_components:[],_layout:null,_layoutModel:null}),b.methods({createComponent:function(){var a=this.setWidth;this.setWidth=function(b){a.apply(this,[b]),this._setWidth(b)}.bind(this);var b=this._createWixComponent(this._getCompName());return this._layout=new this.imports.SuperFlowLayout,this._buildLayoutModel(),this._createChildComponents(b),this._components.forEach(function(a){a.setStyle("position","absolute")}),b},_getCompName:function(){return"mobile.core.components.ContainerOBC"},_buildLayoutModel:function(){var a=this._def.getValue(),b={items:[]};a.regions&&(b.regions=Object.clone(a.regions)),a.items.forEach(function(a){var c={};a.layout&&Object.each(a.layout,function(a,b){c[b]=a}),b.items.push(c)}),this._layoutModel=b},applyLayout:function(){this._layout.setModel(this._layoutModel,this._children),this._layout.positionElements(),this._element.setStyle("height",this._layout.getHeight())},_setWidth:function(a){this._layoutModel.minWidth=a,this.applyLayout()},_onDefinitionsChanged:function(){this.applyLayout()},_getDefaultStyleName:function(){return"c1"},_getDefaultSkinName:function(){return"mobile.core.skins.InlineSkin"}})}),define.Class("wixapps.integration.proxies.SwitchProxy",function(a){var b=a;b.inherits("wixapps.integration.proxies.WProxy"),b.fields({_child:null,_prevCaseId:null}),b.methods({initialize:function(a,b,c,d){this.parent(a,b,c,d)},_setupPropertyHandlers:function(){this.parent(),this._handleProperties(["cases"],function(){this._updateSwitchState()&&(this._child.setupProxy(),this._child.updateLayoutWhenReady())})},_updateSwitchState:function(){var a=!1,b=this._data?this._data.getValue().toString():"";if(b!==this._prevCaseId&&(this._prevCaseId=b,this._child&&(this._child.dispose(),this._child=null),this._def.getChildByRef("cases"))){var c=this._def.getChildByRef("cases").getChildByRef(b)||this._def.getChildByRef("cases").getChildByRef("default");if(c&&"NO_PROXY"===c.getValue())this._element.collapse();else{this._element.uncollapse(),this._child=this._viewContext.getEnvironment().getProxyFactory().createProxyFromItemDefinition(this._viewContext,c).proxy;var d=this._child.createComponent();if(d){this._element.adopt(d);var e=c.getChildValue("layout")||{};this._applyStyle(d,e),a=!0}}}return a},setupProxy:function(a){this.parent(),this._child?this._child.setupProxy(a):a&&a()},createComponent:function(){var a=this._createElement();return a.setStyles({"flex-direction":"column",display:"flex"}),this._updateSwitchState(),a},_onDataChanged:function(){window.requestAnimFrame(function(){this._updateSwitchState()&&(this._child.setupProxy(),this._child.updateLayoutWhenReady())}.bind(this))},dispose:function(){this._child&&(this._child.dispose(),this._child=null)}})}),define.Class("wixapps.integration.proxies.TabMenuProxy",function(a){var b=a;b.inherits("wixapps.integration.proxies.WProxy"),b.binds(["_onSelectionChanged","_onSelectionChangeRequested"]),b.methods({createComponent:function(){return this._initialSelectedIndex=this.getViewDefinition().getChildValue("initialSelectedIndex")||0,this._selectionRequestEvent=this.getViewDefinition().getChildValue("selectionRequestEvent"),this._selectionRequestEventScope=this.getViewDefinition().getChildValue("selectionRequestScope")||"any",this._titleExpression=this._def.getChildValue("titleExpression")||"this",this._selectionChangedEvent=this.getViewDefinition().getChildValue("selectionChangedEvent"),this._createWixComponent("wixapps.integration.components.TabMenu",this._createRawData(),{initialSelectedIndex:this._initialSelectedIndex})},_createRawData:function(){for(var a=this._data.getChildren(),b=[],c=0;c<a.length;c++)b.push(a[c].evaluatePath(this._titleExpression).getValue(0));return{type:"TextList",items:b}},setSelectedIndex:function(a){this._componentLogic&&this._componentLogic.setSelectedIndex(a)},_onComponentWixified:function(){this._componentLogic.addEvent("selectionChanged",this._onSelectionChanged),this._selectionRequestEvent&&this.addEventFilteredByScope(this._selectionRequestEventScope,this._selectionRequestEvent,this._onSelectionChangeRequested);var a=this._getInitialSelection();a>=0&&this.setSelectedIndex(a)},_onSelectionChanged:function(){this._selectionChangedEvent&&this.fireEvent(this._selectionChangedEvent,{sender:this,data:this.data.getChildren()[this._componentLogic.getSelectedIndex()],context:this.getViewContext(),def:this.getViewDefinition()})},_onSelectionChangeRequested:function(a){var b=a.data;if(b)for(var c=this._data.getChildren(),d=0;d<c.length;d++){var e=c[d];if(e==b)return this.setSelectedIndex(d),void 0}},_setupPropertyHandlers:function(){this._handleProperty("initialSelectedIndex",function(a){a=a||0,a!=this._initialSelectedIndex&&(this._initialSelectedIndex=a,this.setSelectedIndex(a))})},_getDefaultSkinName:function(){return"wixapps.integration.skins.TabMenuSkin"},_getAcceptableDataTypes:function(){return["Array"]},dispose:function(){this._selectionRequestEvent&&this.removeEvent(this._selectionRequestEvent,this._onSelectionChangeRequested),this._componentLogic&&this._componentLogic.removeEvent("selectionChanged",this._onSelectionChanged),this.parent()}})}),define.Class("wixapps.integration.proxies.TableProxy",function(a){var b=a;b.inherits("wixapps.integration.proxies.WProxy"),b.binds(["_bodyCellHookMethod","_headerAndFooterCellHookMethod"]),b.methods({initialize:function(a,b,c,d){this.parent(a,b,c,d),this._proxyFactory=this._viewContext.getEnvironment().getProxyFactory(),this._columnsDefinition=this._getColumnsDef()},createComponent:function(){return this._createWixComponent("wysiwyg.viewer.components.TableComponent",this._createRawData(),{SequencingHook:this._bodyCellHookMethod,HeaderFooterSequencingHook:this._headerAndFooterCellHookMethod})},_setupPropertyHandlers:function(){this.parent(),this._mapToCompProperty("minHeight"),this._handleProperties(["rowsDataArray","columns"],function(){this._columnsDefinition=this._getColumnsDef(),this._refreshComponentData()})},_bodyCellHookMethod:function(a){var b=this._columnsDefinition[a.index].getChildByRef("item");return this._getCellElement(a.data,b)},_headerAndFooterCellHookMethod:function(a){return a.data?this._getCellElement(this._viewContext,a.data):null},_getCellElement:function(a,b){var c=this._proxyFactory.createProxyFromItemDefinition(a,b).proxy,d=c.createComponent();return c.setupProxy(function(){c.updateLayoutWhenReady()}),d},_createRawData:function(){var a=this._getColumnsDef(),b=this._getRowsListRawData(this._getRowsDataArray(),a),c=this._getHeaderOrFooterRawData(a,"header"),d=this._getHeaderOrFooterRawData(a,"footer");return{type:"Table",items:b,header:c,footer:d}},_getRowsDataArray:function(){var a=this._viewContext;if(this._def.getChildByRef("rowsDataArray")){var b=this._def.getChildValue("rowsDataArray");a=this._data.getChildByRef(b)}return a},_onDataChanged:function(a){this.parent(a),a.phase==Constants.DataItemEventPhase.ON_TARGET&&this._refreshComponentData()},_refreshComponentData:function(){if(this._dataItem){var a=this._createRawData();this._dataItem.setData(a),this._dataItem.setMeta("isPersistent",!1)}},_getColumnsDef:function(){return this._def.getChildByRef("columns").getChildren()},_getRowsListRawData:function(a,b){var c=[];return a.getChildren().forEach(function(a){for(var d=[],e=0;e<b.length;e++)d[e]={data:this._viewContext.newContextForData(a),index:e,styleData:b[e].getChildValue("item").styleData};c.push(d)}.bind(this)),c},_getHeaderOrFooterRawData:function(a,b){var c=!1,d=[];return a.forEach(function(a,e){var f=a.getChildByRef(b);f?(c=!0,d.push({data:f,index:e})):d.push({data:null,index:e})}),c?d:null},_getPropSchemaName:function(){return"TableComponentProperties"},_getDefaultSkinName:function(){return"wysiwyg.viewer.skins.table.TableComponentDefaultSkin"},_getDefaultStyleName:function(){return"tblc1"}})}),define.Class("wixapps.integration.proxies.TagInputProxy",function(a){var b=a;b.inherits("wixapps.integration.proxies.layout.RewriteBoxProxy"),b.binds(["_tagClick","_tagMouseOver","_tagMouseOut","_tagsReceived"]);var c=0;b.fields({_uid:null,_tags:null,_visibleTags:null}),b.methods({initialize:function(a,b,d,e){this._uid=e+ ++c,a.getEnvironment().getEventsDispatcher().addEvent(this._uid+"_tag_click",this._tagClick),a.getEnvironment().getEventsDispatcher().addEvent(this._uid+"_tag_mouse_over",this._tagMouseOver),a.getEnvironment().getEventsDispatcher().addEvent(this._uid+"_tag_mouse_out",this._tagMouseOut),this.parent(a,b,d,e)},_rewriteDefinition:function(a,b,c,d){this._tags||(c.getEnvironment().setVar(this._uid+"_tagList",[]),this._updateTags());var e={id:d+"_input",comp:{name:"StringArrayInput",joinSeparator:", ",splitRegex:"\\s*[,;]\\s*",conversion:"toLower",placeholder:b.placeholder}};b.data&&(e.data=b.data),b.value&&(e.value=b.value);var f=this,g={id:d+"_tagContainer",comp:{name:"HBox",items:[{id:d+"_tag",comp:{name:"Label",color:"#379ACF",events:{"dom:click":f._uid+"_tag_click","dom:mouseover":f._uid+"_tag_mouse_over","dom:mouseout":f._uid+"_tag_mouse_out"}},layout:{cursor:"pointer",spacerAfter:10}}]}},h={id:d+"_cssForInline",comp:{name:"Css",items:[g],css:{display:"inline-block"}}},i={id:d+"_tagList",data:"$"+f._uid+"_tagList",comp:{name:"FlowList",templates:{item:h}}},j={id:d+"_tagContainer",comp:{name:"HBox",items:[{id:d+"_topPadder",comp:{name:"VBox",items:[{id:d+"_taglistLabel",value:b.tagListLabel,comp:{name:"Label",color:"#969696"},layout:{spacerBefore:2}}]},layout:{spacerBefore:5,spacerAfter:5}},_.merge(i,{layout:{"box-flex":1}})]}},k={name:"VBox",items:[e,b.tagListLabel?j:i]};return b.pack&&(k.pack=b.pack),k},_tagClick:function(a){var b=a.data.getValue(0),c=this._data.getValue();c.push(b),this._data.setValue(c)},_tagMouseOver:function(a){var b=a.sender.getElement().getElements("span")[0];b.setStyle("text-decoration","underline")},_tagMouseOut:function(a){var b=a.sender.getElement().getElements("span")[0];b.setStyle("text-decoration","none")},_updateTags:function(){var a=this._origDef.getChildValue("tagFullFieldName").split(".");if(3!==a.length)throw"'tagFullFieldName' definition should be collectionId.typeName.field to group by for the tags";var b=a[0],c=a[1],d=a[2],e={};this._getDataService().groupByAndCount(b,c,e,d,{},this._tagsReceived,function(){})},_onDataChanged:function(){this._updateVisibleTags()},_getDataService:function(){return this._viewContext.getEnvironment().getProxyFactory().getHostingComponent().getEnvironment().getDataService()},_tagsReceived:function(a){this._tags=Object.keys(a.getValue()).sort(function(a,b){return b>a?-1:a==b?0:1}),this._updateVisibleTags()},_updateVisibleTags:function(){var a=this._data.getValue(),b=this._tags?this._tags.filter(function(b){return!a.contains(b)}):[];this._viewContext.getEnvironment().setVar(this._uid+"_tagList",b)},dispose:function(){this._viewContext.getEnvironment().getEventsDispatcher().removeEvent(this._uid+"_tag_click",this._tagClick),this._viewContext.getEnvironment().getEventsDispatcher().removeEvent(this._uid+"_tag_mouse_over",this._tagMouseOver),this._viewContext.getEnvironment().getEventsDispatcher().removeEvent(this._uid+"_tag_mouse_out",this._tagMouseOut),this.parent()}})}),define.Class("wixapps.integration.proxies.TextAreaProxy",function(a){var b=a;b.inherits("wixapps.integration.proxies.TextInputProxy"),b.binds(["_onValidation"]),b.methods({initialize:function(a,b,c,d){this.parent(a,b,c,d),this._data.addEvent(Constants.DataItemEvents.VALIDATION_PERFORMED,this._onValidation)},createComponent:function(){var a=this._createRawData(),b={maxLength:this._def.getChildValue("maxLength")};return this._createWixComponent("wysiwyg.viewer.components.inputs.TextAreaInput",a,b)},_onValidation:function(a){if(this._componentLogic&&a){if(a.valid)this._componentLogic.setValidationState(!0);else{var b=a.validationMessage||this._def.getValue().validationMessage;this._componentLogic.setError(b)}this._componentLogic.setValidationState(a.valid)}},_stylesMap:{"default":{skin:"wysiwyg.viewer.skins.input.TextAreaInputSkin",style:"wa_tai1"},ecomTextArea:{skin:"wixapps.integration.skins.ecommerce.inputs.TextAreaInputSkin",style:""}},_getDefaultSkinName:function(){var a=this._def.getChildValue("styleNS")||"default";return this._stylesMap[a].skin},_getDefaultStyleName:function(){var a=this._def.getChildValue("styleNS")||"default";return this._stylesMap[a].style}})}),define.Class("wixapps.integration.proxies.TextInputProxy",function(a){var b=a;b.inherits("wixapps.integration.proxies.WProxy"),b.binds(["_onComponentDataChanged","_onValidation"]),b.methods({createComponent:function(){var a=this._createRawData(),b=document.createElement("div");return b.innerHTML=a.text,a.text=b.innerText||b.text||b.textContent,this._data.addEvent(Constants.DataItemEvents.VALIDATION_PERFORMED,this._onValidation),this._createWixComponent(this._getComponentType(),a)},_getComponentType:function(){return"wixapps.integration.components.inputs.TextInput"},_getPropSchemaName:function(){return"TextInputProperties"},_setupPropertyHandlers:function(){this.parent(),this._handleProperty("enable",function(a){a?this._componentLogic.enable():this._componentLogic.disable()}),this._mapToCompProperties(["label","placeholder"])},_createRawData:function(){var a=this._data.getValue();return{type:"Text",text:a}},_onComponentWixified:function(){("false"===this._def.getChildValue("enable")||this._def.getChildValue("enable")===!1)&&this._componentLogic.disable()},_onDataChanged:function(){this._componentLogic&&!this._ignoreUpdate&&this._componentLogic.getDataItem().set("text",this._data.getValue())},_onComponentDataChanged:function(a,b,c){this._ignoreUpdate=!0,this._data.setValue(c.text),this._ignoreUpdate=!1},_onValidation:function(a){if(this._componentLogic)if(a.valid)this._componentLogic.resetInvalidState();else{var b=a.validationMessage||this._def.getValue().validationMessage;this._componentLogic.showValidationMessage(b)}},_stylesMap:{"default":{skin:"wysiwyg.viewer.skins.appinputs.AppsTextInputSkin",style:"wa_ti1"},ecomTextInput:{skin:"wysiwyg.viewer.skins.appinputs.EcomTextInputSkin",style:"ecom_ti1"}},_getDefaultSkinName:function(){var a=this._def.getChildValue("styleNS")||"default";return this._stylesMap[a].skin},_getDefaultStyleName:function(){var a=this._def.getChildValue("styleNS")||"default";return this._stylesMap[a].style}})}),define.Class("wixapps.integration.proxies.TimeSelectorProxy",function(a){var b=a;b.inherits("wixapps.integration.proxies.WProxy"),b.binds(["_onComponentDataChanged","_onValidation"]),b.methods({createComponent:function(){this._data.addEvent(Constants.DataItemEvents.VALIDATION_PERFORMED,this._onValidation);var a="wixapps.integration.components.inputs.TimeInput";this.useSkinsInsteadOfStyles();var b=this._getIsoDate();return this._createWixComponent(a,{type:"Text",text:b})},_getPropSchemaName:function(){return"TimeInputProperties"},_setupPropertyHandlers:function(){this.parent(),this._mapToCompProperties(["resolution","hourFormat","allowEmpty"])},_getDefaultSkinName:function(){return"wixapps.integration.skins.inputs.TimeInputSkin"},_getIsoDate:function(){var a=this._data.getValue(),b=new Date(a.iso);return this._allowEmpty()||!isNaN(b.getTime())&&b.getDate()!=new Date(0).getDate()||(a.iso=(new Date).toISOString(),this._data.setValue(a)),a.iso},_onDataChanged:function(){!this._userInputChange&&this._element&&this._element.getLogic()&&this._element.getLogic().getDataItem().set("text",this._getIsoDate())},_onComponentDataChanged:function(){var a=this._element.getLogic().getDataItem().get("text");this._userInputChange=!0,this._data.setValue({_type:"wix:Date",iso:a}),this._userInputChange=!1},_onValidation:function(a){if(this._componentLogic)if(a.valid)this._componentLogic.resetInvalidState();else{var b=a.validationMessage||this._def.getValue().validationMessage;this._componentLogic.showValidationMessage(b)}},_allowEmpty:function(){return!(this._def.getChildValue("allowEmpty")===!1||"false"===this._def.getChildValue("allowEmpty"))},_getAcceptableDataTypes:function(){return["wix:Date"]}})}),define.Class("wixapps.integration.proxies.ToggleProxy",function(a){var b=a;b.inherits("wixapps.integration.proxies.WProxy"),b.binds(["_handlePeerToggleEvent","toggle"]),b.methods({initialize:function(a,b,c,d){this.parent(a,b,c,d),this._loadTemplates()},createComponent:function(){var a=this._viewContext.getEnvironment().getProxyFactory();
this._initialState=this.getViewDefinition().getChildValue("initialState")||"off";var b=a.createProxyFromItemDefinition(this._viewContext,this._onTemplate).proxy,c=a.createProxyFromItemDefinition(this._viewContext,this._offTemplate).proxy;this._childrenLeftToBeReady=1;var d=function(a){a.grab(b.createComponent()),b.setupProxy(this._onChildReady)}.bind(this),e=function(a){a.grab(c.createComponent()),c.setupProxy(this._onChildReady)}.bind(this);this._toggleTriggerEvent=this._def.getChildValue("toggleTriggerEvent");var f=this._createWixComponent("wixapps.integration.components.Toggle",void 0,{createOnHook:d,createOffHook:e,initialState:this._initialState,listensToPartsClick:!this._toggleTriggerEvent});if(this._toggleTriggerEvent){var g=this._def.getChildValue("toggleTriggerScope")||"same";this.addEventFilteredByScope(g,this._toggleTriggerEvent,this.toggle)}return f},_onComponentWixified:function(){this._componentLogic.addEvent("wix:toggle",function(a){this.fireEvent("wix:togglegroup",{state:a.state,toggleGroup:this.getToggleGroup()}),this._viewContext.getEnvironment().getEventsDispatcher().fireEvent(Constants.WixAppEvents.APP_PART_RESIZE)}.bind(this)),this.addEventFilteredByScope(this.getToggleScope(),"wix:togglegroup",this._handlePeerToggleEvent)},getToggleGroup:function(){return this.getViewDefinition().getChildValue("toggleGroup")},getToggleScope:function(){return this.getViewDefinition().getChildValue("toggleScope")},turnOff:function(){this._componentLogic.turnOff()},turnOn:function(){this._componentLogic.turnOn()},toggle:function(){this._componentLogic.toggle()},_setupPropertyHandlers:function(){this._handleProperties(["initialState"],function(){this._loadTemplates();var a=this.getViewDefinition().getChildValue("initialState")||"off";a!=this._initialState&&(this._initialState=a,"on"==a?this.turnOn():this.turnOff())})},_loadTemplates:function(){var a=this._viewContext.getEnvironment();this._onTemplate=this._getItemTemplate("on")||a.getDataItemFactory().createDataItem({id:this.getFieldId()+"_template_on",comp:{}},this._def),this._offTemplate=this._getItemTemplate("off")||a.getDataItemFactory().createDataItem({id:this.getFieldId()+"_template_off",comp:{}},this._def)},_getItemTemplate:function(a){return this._def.getChildByRef("templates")&&this._def.getChildByRef("templates").getChildByRef(a)},_handlePeerToggleEvent:function(a){var b=a.state,c=a.toggleGroup;a.sender!=this&&"on"==b&&c&&c==this.getToggleGroup()&&this.turnOff()},_getDefaultSkinName:function(){return"wixapps.integration.skins.ToggleSkin"},dispose:function(){this._toggleTriggerEvent&&this.removeEvent(this._toggleTriggerEvent,this.toggle),this.removeEvent("wix:togglegroup",this._handlePeerToggleEvent),this.removeEvent("wix:toggle",this._handlePeerToggleEvent),this.parent()}})}),define.Class("wixapps.integration.proxies.TooltipIconProxy",function(a){var b=a;b.inherits("wixapps.integration.proxies.IconProxy"),b.resources(["W.Commands","W.Data","W.Utils"]),b.fields({_tooltipsData:null,_tooltipId:null}),b.methods({createComponent:function(){return this._tooltipsData=this.resources.W.Data.getDataByQuery("#TOOLTIPS.toolTips"),this._createTooltipData(),this.parent()},_createTooltipData:function(){if(null!==this._tooltipId)throw"Tooltip data item already exists.";this._tooltipId=this._def.getChildValue("tooltipId");var a=this._def.getChildValue("tooltipValue");void 0!==a&&(this._tooltipId=this.resources.W.Utils.AppsUtils.getTimeBasedUniqueId("wixapps_tooltip"),this._tooltipsData.set(this._tooltipId,{isMoreLess:!1,isDontShowAgain:!1,content:"<p>"+a+"</p>",isPublished:!0,help:{isMoreHelp:!1,text:null,url:""}}))},_onComponentWixified:function(){var a=this,b=this._element;b.addEvent("mouseenter",function(){a.resources.W.Commands.executeCommand("Tooltip.ShowTip",{id:a._tooltipId},b)}.bind(this)),b.addEvent("mouseleave",function(){a.resources.W.Commands.executeCommand("Tooltip.CloseTip")}.bind(this))}})}),define.Class("wixapps.integration.proxies.UnstyledLabelProxy",function(a){var b=a;b.inherits("wixapps.integration.proxies.LabelProxy"),b.resources(["W.Data"]),b.methods({initialize:function(a,b,c,d){this.parent(a,b,c,d),this._stylesMap=this.resources.W.Data.getDataByQuery("#WIXAPPS_EDITOR_STYLES")},_createFormattedText:function(){var a=this.parent(),b=new Element("div");"innerHTML"in b?b.innerHTML=a:b.textContent=a;var c=b.textContent||b.innerText;return'<p class="singleLine">'+c+"</p>"},_getDefaultStyleElement:function(){var a=this._getBlockDefaultStyledElement();return{outerElement:a,innerElement:a}},_getBlockDefaultStyledElement:function(){var a=this._stylesMap.get("items").div.cssClass,b=this._getSeoTagForStyleCssClass(a);return new Element(b,{"class":a})}})}),define.Class("wixapps.integration.proxies.VerticalLineProxy",function(a){var b=a;b.inherits("wixapps.integration.proxies.WProxy"),b.methods({createComponent:function(){return this._createWixComponent("wysiwyg.viewer.components.VerticalLine",void 0,void 0,void 0)},_getDefaultSkinName:function(){return"wysiwyg.viewer.skins.VerticalLineSkin"},_getDefaultStyleName:function(){return"vl1"}})}),define.Class("wixapps.integration.proxies.VerticalListEditorProxy",function(a){var b=a;b.inherits("wixapps.integration.proxies.VerticalListProxy"),b.binds(["onDragItemCopyCreated","disposeDragItemCopy"]),b.methods({initialize:function(a,b,c,d){this.parent(a,b,c,d);var e=c.getChildValue("dragEnabled");this._repeaterArgs.dragEnabled="false"!==e&&this._dragEnabled!==!1,this._repeaterArgs.dragEventHandler=this,this._repeaterArgs.maxDragIndex=c.getChildValue("maxDragIndex")},onDragItemCopyCreated:function(a){var b=a.getViewProxy();b.setupProxy()},disposeDragItemCopy:function(a){var b=a.getViewProxy();this._undisposedChildren.erase(b),b.dispose()},getRepeaterClass:function(){return"wixapps.integration.components.VerticalListEditor"},_getDefaultStyleName:function(){return void 0},_getDefaultSkinName:function(){return"wixapps.integration.skins.editor.VerticalListEditorSkin"}})}),define.Class("wixapps.integration.proxies.VerticalListProxy",function(a){var b=a;b.inherits("wixapps.integration.proxies.ListProxy"),b.fields({_stylesMap:{"default":{style:"vr1"},ecomOptionsList:{style:null}}}),b.methods({getRepeaterClass:function(){return"wysiwyg.viewer.components.VerticalRepeater"},setComponentStyles:function(a){return a.setStyles({display:"flex","flex-direction":"column"}),a},_getDefaultStyleName:function(){var a=this._def.getChildValue("styleNS")||"default";return this._stylesMap[a].style},_onComponentWixified:function(){this.parent();var a=this._componentLogic.getSkinPart("inlineContent");a&&(a.$flexPolyfill||this._applyBoxFlexPolyfill(a),a.setStyles({display:"flex","flex-direction":"column"}))}})}),define.Class("wixapps.integration.proxies.VideoProxy",function(a){var b=a;b.inherits("wixapps.integration.proxies.WProxy"),b.traits(["wixapps.integration.components.traits.ResizableProxyTrait"]),b.methods({createComponent:function(){var a=this._createRawData(this._data.getValue()),b={type:"Video"};return this._createWixComponent("wixapps.integration.components.Video",a,void 0,b)},_createRawData:function(a){var b={type:"Video",videoId:a.videoId,videoType:a.videoType};return b},_getPropSchemaName:function(){return"VideoProperties"},_setupPropertyHandlers:function(){this.parent();var a=function(a){return a===!0||"true"==a};this._mapToCompProperty("autoplay","autoplay",a),this._mapToCompProperty("showinfo","showinfo",a),this._mapToCompProperty("loop","loop",a),this._mapToCompProperty("lightTheme","lightTheme",a),this._mapToCompProperty("showControls","showControls")},_onDataChanged:function(){if(this._componentLogic&&!this._ignoreUpdate){var a=this._data.getValue(),b=this._componentLogic.getDataItem();b.set("videoId",a.videoId,!0),b.set("videoType",a.videoType,!0),b.fireDataChangeEvent()}},_getDefaultSkinName:function(){return"wysiwyg.viewer.skins.video.VideoDefault"},_getDefaultStyleName:function(){return"vl"}})}),define.Class("wixapps.integration.proxies.VideoSelectorProxy",function(a){var b=a;b.inherits("wixapps.integration.proxies.TextInputProxy"),b.binds(["_onComponentDataChanged","_onInputBlur"]),b.traits(["wysiwyg.viewer.components.traits.VideoUtils"]),b.methods({_onComponentWixified:function(){this._componentLogic.addEvent(Constants.CoreEvents.BLUR,this._onInputBlur)},_onInputBlur:function(){this._componentLogic&&(this._ignoreUpdate=!0,this._componentLogic.getDataItem().set("text",this._getVideoUrlForInput()),this._ignoreUpdate=!1)},_createRawData:function(){return{type:"Text",text:this._getVideoUrlForInput()}},_onDataChanged:function(){this._componentLogic&&!this._ignoreUpdate&&this._componentLogic.getDataItem().set("text",this._getVideoUrlForInput())},_onComponentDataChanged:function(a){if(!this._ignoreUpdate){this._ignoreUpdate=!0;var b=this._getDefaultVideo();if(0===a.get("text").trim().length&&b)this._data.setValue(b);else{var c=this._getVideoDataFromVideoUrl(a.get("text"));c&&c.videoType&&c.videoId&&(c._type="wix:Video",this._data.setValue(c))}this._ignoreUpdate=!1}},_getVideoUrlForInput:function(){var a=this._getDefaultVideo(),b=this._data.getValue(),c=a&&b.videoId===a.videoId&&b.videoType===a.videoType;return c?"":this._getVideoUrlFromVideoData(this._data.getValue())},_getDefaultVideo:function(){return this._def.getChildValue("defaultVideo")}})}),define.Class("wixapps.integration.proxies.VideoThumbProxy",function(a){var b=a;b.inherits("wixapps.integration.proxies.ImageProxy"),b.binds(["_showVideoThumb"]),b.traits(["wysiwyg.viewer.components.traits.VideoUtils"]),b.methods({_createRawData:function(){var a=this._data.getValue();return this._createVideoRawData(a)},_createVideoRawData:function(a){var b=this._getServices()[a.videoType],c=this._toAppImageUrl("images/icons/video.png");return b&&(c=b.getPreviewUrl(a.videoId,this._showVideoThumb,c)||c),{type:"Image",uri:c,title:"",width:480,height:360}},_onDataChanged:function(){var a=this._createRawData();this._showVideoThumb(a.uri)},_showVideoThumb:function(a,b){this._componentLogic?this._componentLogic.getDataItem().set("uri",a):this._videoThumbUrl=a,this._element&&a&&(b===!1?this._element.removeClass("videoIndicator"):this._element.addClass("videoIndicator"))},_onComponentWixified:function(){this._componentLogic&&this._componentLogic.getDataItem().set("uri",this._videoThumbUrl),this.parent()}})}),define.Class("wixapps.integration.proxies.WArrayProxy",function(a){var b=a;b.inherits("wixapps.core.views.proxies.ArrayProxy"),b.traits(["wixapps.integration.proxies.WIntegrationTrait","wixapps.integration.proxies.traits.ProxyPropertyChangeTrait"]),b.methods({})}),define.Class("wixapps.integration.proxies.WCompositeProxy",function(a){var b=a;b.inherits("wixapps.core.views.proxies.CompositeProxy"),b.traits(["wixapps.integration.proxies.WIntegrationTrait","wixapps.integration.proxies.traits.ProxyPropertyChangeTrait"]),b.methods({})}),define.Class("wixapps.integration.proxies.WIntegrationTrait",function(a){var b=a;b.utilize(["wixapps.integration.utils.flex.BoxFlexPolyfill"]),b.binds(["_onStyleChangeInternal","_onSkinChange","_onAutoSizeChange","_onHover","_onHoverOut","_onWixComponentWixifiedInternal"]),b.fields({_dataItem:null,_element:null,_initArgs:null,_componentLogic:null,_applyAfterWixifiedActions:[],_prefix:"",_onReadyCallback:null,_childrenLeftToBeReady:0,_useSkinsInsteadOfStyles:!1,_cssPropDict:{},_lifecycleManager:null,_nativeEventHandlers:[]}),b.methods({initialize:function(){W&&W.Viewer&&W.Editor&&this.useSkinsInsteadOfStyles();var a=String(this.injects().Utils.getCSSBrowserFeature("boxOrient")||"");a&&(this._prefix=a.match(/^\-[a-z]+\-/)[0]||"")},_preventReflowCssClass:function(){return"wixAppsInRenderPreventReflow"},_checkViewFlexComputeMode:function(){var a=this._viewContext.getEnvironment().getVars();return a.forceFlexCompute&&a.forceFlexCompute===!0?!0:!1},_applyBoxFlexPolyfill:function(a){this.imports.BoxFlexPolyfill.applyBoxFlexPolyfill(a,this._checkViewFlexComputeMode())},_createElement:function(a){var b,c=this;this._lifecycleManager=this._viewContext.getEnvironment().getLifecycleManager();var d=this._viewContext.getEnvironment();b=new Element(a||this._getViewElement()),b.getViewProxy=function(){return c},b.$viewProxy=c,b.setAttribute("hasProxy","true"),b.setAttribute("vctype",d.getForType()),b.setAttribute("vcview",d.getViewName()),b.setAttribute("vcfield",this.getFieldId()),b.setAttribute("pos",this._getDefaultPosition()),W.Config.isInDebugMode()&&b.setAttribute("proxy",this.$className),this._element=b,this._applyBoxFlexPolyfill(this._element);var e=this._def.getChildValue("cssClass");e&&(b.addClass(e),this._cssClass=e);var f=this._def.getChildValue("hidden");("true"==f||f===!0)&&b.collapse();var g=this._def.getChildValue("hoverVar");g&&(this._viewContext.getEnvironment().setVar(g,!1),b.addEvent("mouseover",this._onHover),b.addEvent("mouseout",this._onHoverOut)),this._nativeEventHandlers.forEach(function(a){b.addEvent(a.type,a.handler)});var h=this._preventReflowCssClass();return h&&this._lifecycleManager&&b.addClass(h),h&&this._lifecycleManager&&this._lifecycleManager.performAction(function(){b.removeClass(h)}.bind(this),this._lifecycleManager.ExecutionOrder.Early),b},_createWixComponent:function(a,b,c){c=c||{},this._initArgs=c,this._isWixificationPending=!0;var d,e,f=this._createCompProperties()||{};!this._def.getChildValue("style")&&this._def.getChildValue("skin")&&this.useSkinsInsteadOfStyles(),e=this._def.getChildValue("style")||this._getDefaultStyleName(),d=this._def.getChildValue("skin")||this._getDefaultSkinName(),this._styleNameSpace=this._def.getChildValue("styleNS")||this._getDefaultStyleNameSpace(),this._initArgs.styleNameSpace=this._styleNameSpace;var g=this._def.getChildValue("skinGroup");g&&(this._initArgs.skinGroup=g);var h=this._createElement();if(this._lifecycleManager.notifyComponentCreated(h),h.setAttribute("comp",a),e&&!this._useSkinsInsteadOfStyles&&h.setAttribute("styleid",e),h.setAttribute("skin",d),b&&(this._dataItem=W.Data.createDataItem(b),this._dataItem.setMeta("isPersistent",!1),this._dataItem.addEvent(Constants.DataEvents.DATA_CHANGED,this._onComponentDataChanged)),f.type){var i=W.ComponentData.addDataItemWithUniqueId("wixApps",f);i&&(i.dataObject.setMeta("isPersistent",!1),h.setAttribute("propertyquery","#"+i.id))}return h.addEvent(Constants.ComponentEvents.WIXIFIED,this._onWixComponentWixifiedInternal),h.addEvent(Constants.ComponentEvents.READY,function(){this._onWixComponentReadyInternal(h)}.bind(this)),h},isWixificationPending:function(){return this._isWixificationPending},useSkinsInsteadOfStyles:function(){this._useSkinsInsteadOfStyles=!0},updateLayoutWhenReady:function(a){this._lifecycleManager.performAction(a||this._lifecycleManager.getDefaultInvalidateLayoutAction())},setupProxy:function(){this._applyCssNode(this._element),this._children&&this._children.each(function(a){a.setupProxy()}.bind(this)),this._componentLogic||(this._element.wixify&&this._element.get("comp")?this._element.wixify(this._initArgs,this._dataItem,"vwprxy"):this._element.wixifySubElement&&this._element.wixifySubElement(this._initArgs,this._dataItem,"vwprxy"));var a=this;window.requestAnimFrame(function(){a._disposed||a._onProxySetup()})},_onReady:function(){},_onWixComponentWixifiedInternal:function(a){this._disposed||(this._componentLogic=a,this._updateComponentState(),this._onComponentWixified(),this._registerStyleChangeHandler(),this._applyAfterWixifiedActions.forEach(function(a){a.apply(this)}.bind(this)),this._applyAfterWixifiedActions=[],this._componentLogic.addEvent("autoSizeChange",this._onAutoSizeChange),this._setComponentReadyIfHidden())},_setComponentReadyIfHidden:function(){},_onWixComponentReadyInternal:function(a){this._isWixificationPending=!1,this._applyAccumulatedPropertyChanges(),this._defferedDataChangeEvent&&this._onDataChanged(this._defferedDataChangeEvent),this._onWixComponentReadyInternalNotifyLifecycle(a)},_onWixComponentReadyInternalNotifyLifecycle:function(a){this.resetResizingCache&&this.resetResizingCache(),this._lifecycleManager.notifyComponentReady(a)},_onAutoSizeChange:function(){this._viewContext.getEnvironment().getEventsDispatcher().fireEvent("innerCompResize",this._componentLogic)},_onHover:function(){var a=this._def.getChildValue("hoverVar");this._viewContext.getEnvironment().setVar(a,!0)},_onHoverOut:function(){var a=this._def.getChildValue("hoverVar");this._viewContext.getEnvironment().setVar(a,!1)},_registerProxyEvents:function(a,b){0===a.indexOf("dom:")?this._nativeEventHandlers.push({type:a.slice(4),handler:b}):this._applyAfterWixified(function(){this._componentLogic.on(a,this,b),this._componentLogic.addEvent(a,b)}.bind(this))},_applyAfterWixified:function(a){this._componentLogic?a.apply(this):this._applyAfterWixifiedActions.push(a)},_onComponentWixified:function(){},_onComponentDataChanged:function(){},_onDataChangedInternal:function(a){if(!this._disposed){if(this._isWixificationPending===!0)return this._defferedDataChangeEvent=a,void 0;this.parent(a),this._componentLogic&&!this._componentLogic.getIsDisplayed()&&this._componentLogic.invalidateComponent&&this._componentLogic.invalidateComponent()}},_onProxySetup:function(){},setWidth:function(a){this._element.setStyle("width",a)},getWidth:function(){return this._element.getWidth()},getHeight:function(){return this._element.getHeight()},setPos:function(a,b){this._element.setStyles({left:a,top:b})},_getViewElement:function(){return"div"},_getDefaultStyleName:function(){return""},_getDefaultSkinName:function(){return""},_getDefaultStyleNameSpace:function(){return null},refreshSize:function(){},_onLayoutChange:function(){},_applyStyle:function(a,b){if(a){var c={};Object.each(b,function(a,b){("width"==b||"height"==b)&&("string"!=typeOf(a)||String.contains(a,"%")||"auto"===a||(a=parseInt(a,10))),c[b]=a}.bind(this)),a.setStyles(c)}},_registerStyleChangeHandler:function(){this._styleObj&&(this._styleObj.removeEvent(Constants.StyleEvents.PROPERTY_CHANGED,this._onStyleChangeInternal),this._styleObj.removeEvent(Constants.StyleEvents.SKIN_CHANGED,this._onSkinChange)),this._styleObj=this._componentLogic.getStyle(),this._styleObj&&(this._styleObj.addEvent(Constants.StyleEvents.PROPERTY_CHANGED,this._onStyleChangeInternal),this._styleObj.addEvent(Constants.StyleEvents.SKIN_CHANGED,this._onSkinChange))},_onStyleChangeInternal:function(a){this._onStylePropertiesChange(a.properties)},_onSkinChange:function(){},_onStylePropertiesChange:function(){},_isLayoutBasedWidth:function(){var a=this._def.getParent().getChildValue("layout");if(this._getImplicitDimensions().contains("width"))return!1;if(a&&("width"in a||"zoomExpand"in a))return!0;var b=this.getParentProxy(),c=b&&b.getLayoutOrientation?b.getLayoutOrientation():"";return"vertical"===c?!0:"horizontal"===c?Boolean(a&&("box-flex"in a||"flex"in a)):!1},_isLayoutBasedHeight:function(){var a=this._def.getParent().getChildValue("layout");if(this._getImplicitDimensions().contains("height"))return!1;if(a&&"height"in a)return!0;var b=this.getParentProxy(),c=b&&b.getLayoutOrientation?b.getLayoutOrientation():"";return"horizontal"===c?b?b._isLayoutBasedHeight():!0:"vertical"===c?a&&("box-flex"in a||"flex"in a):!1},_isCompBasedWidth:function(){return!this._isLayoutBasedWidth()},_isCompBasedHeight:function(){return!this._isLayoutBasedHeight()},_getImplicitDimensions:function(){return[]},_getParentLayoutOrientation:function(){var a=this.getParentProxy();return a&&a.getLayoutOrientation?a.getLayoutOrientation():void 0},_isNBC:function(){return this._componentLogic?!!this._componentLogic.NEW_BASE_COMP:!1},getParentProxy:function(){for(var a=this._element.parentNode;a;){if(a.hasAttributes("hasproxy"))return a.$viewProxy;a=a.parentNode}return null},getProxyMetaTags:function(){return[]},hasMetaTag:function(a){return this.getProxyMetaTags().contains(a)},_getDefaultPosition:function(){return""},getCompLogic:function(){return this._componentLogic},getElement:function(){return this._element},getSourceSize:function(){return void 0},hasFixedAspectRatio:function(){return!1},getAspectRatio:function(){return 0/0},dispose:function(){this._disposed||(this._isWixificationPending=!1,this._dataItem&&this._dataItem.removeEvent(Constants.DataEvents.DATA_CHANGED,this._onComponentDataChanged),this._children&&this._children.forEach(function(a){this._onBeforeChildDisposed&&this._onBeforeChildDisposed(a),a.dispose()}),this._deactivateResizeMechanism&&this._deactivateResizeMechanism(this._element),this._styleObj&&(this._styleObj.removeEvent(Constants.StyleEvents.PROPERTY_CHANGED,this._onStyleChangeInternal),this._styleObj.removeEvent(Constants.StyleEvents.SKIN_CHANGED,this._onSkinChange),this._styleObj=null),this._element&&(this._element.removeEvent("mouseover",this._onHover),this._element.removeEvent("mouseout",this._onHoverOut),this._nativeEventHandlers&&(this._nativeEventHandlers.forEach(function(a){this._element.removeEvent(a.type,a.handler)}.bind(this)),this._nativeEventHandlers=null)),this._componentLogic?this._componentLogic.dispose():this._element&&this._element.destroy(),this._dataItem=null,this._componentLogic=null,this._element=null,this.parent())},getFlexPolyFillInstance:function(){return this._element.$flexPolyfill}})}),define.Class("wixapps.integration.proxies.WProxy",function(a){var b=a;b.inherits("wixapps.core.views.proxies.Proxy"),b.traits(["wixapps.integration.proxies.WIntegrationTrait","wixapps.integration.proxies.traits.ProxyPropertyChangeTrait"]),b.methods({})}),define.Class("wixapps.integration.proxies.ZoomLinkProxy",function(a){var b=a;b.inherits("wixapps.integration.proxies.layout.BoxLayoutProxy"),b.binds(["_onClicked"]),b.fields({_eventString:"wix:zoom-link:open-zoom"}),b.methods({createComponent:function(){var a=this.parent();return a.addEvent("click",this._onClicked),a},_getContainerElementType:function(){return"a"},_dispose:function(){this._element&&this._element.removeEvent("click",this._onClicked)},_onClicked:function(){var a=this._data,b=this._def.getChildValue("listExpression"),c=b?this._viewContext.evaluatePath(b).getChildren():[a],d=this._def.getChildValue("idField")||"_iid",e=this._def.getChildValue("titleField")||"title",f=this._getZoomParams(c,a,e,d);return this.fireEvent(this._eventString,{zoomParams:f}),!1},_getZoomParams:function(a,b,c,d){c=c||"title",d=d||"_iid";var e=b.getChildByRef(d).getValue(),f=a.map(function(a){return{id:a.getChildByRef(d).getValue(),title:a.getChildByRef(c).getValue()}}),g=f.getIndexByField("id",e),h={hideNextPrevBtns:this._def.getChildValue("hideNextPrevBtns")===!0||"true"===this._def.getChildValue("hideNextPrevBtns")};return{list:f,selectedIndex:g,extraParams:h}}})}),define.Class("wixapps.integration.proxies.layout.BoxLayoutProxy",function(a){var b=a;b.inherits("wixapps.integration.proxies.layout.CssLayoutProxy"),b.fields({_prefix:"",_orientation:"vertical",_spacers:[],_shouldBeFlexush:!1,_alignPropMap:{vertical:{left:"start",center:"center",right:"end"},horizontal:{top:"start",middle:"center",bottom:"end",left:"start",center:"center",right:"end",baseline:"baseline"}},_packingSpacers:null,_packingPropMap:{vertical:{start:"flex-start",center:"center",end:"flex-end"},horizontal:{start:"flex-start",center:"center",end:"flex-end"}}}),b.binds(["_updatePacking"]),b.methods({createComponent:function(){var a=this.parent();return a.$flexPolyfill.isComputedFlex()&&(this._shouldBeFlexush=!0),this._orientation=this._def.getChildValue("orientation")||this._getDefaultOrientation(),a.setStyle("box-orient",this._orientation),a},_onProxySetup:function(){this.parent(),this._applyBoxStyles(this._element)},_applyBoxStyles:function(a){var b=this._def.getChildValue("pack"),c=this._def.getChildValue("box-align");this._shouldBeFlexush=this._shouldBeFlexush||b||c,"horizontal"===this._orientation||this._shouldBeFlexush?(a.setStyles({display:"box","box-orient":this._orientation}),a.removeClass("flex_vbox")):(a.setStyles({display:"block","box-orient":this._orientation}),a.addClass("flex_vbox")),this.updateLayoutWhenReady(function(){this._disposed||(this._updateBoxAlign(),this._updatePacking())}.bind(this))},getLayoutOrientation:function(){return this._orientation},_getDefaultOrientation:function(){return"HBox"===this._def.getChildValue("name")?"horizontal":"vertical"},_reloadProxy:function(){this._disposeSpacers(),this._applyBoxStyles(this._element),this.parent()},_setupPropertyHandlers:function(){this.parent(),this._handleProperty("box-align",this._updateBoxAlign),this._handleProperty("orientation",function(a){this._orientation=a,this._reloadProxy()}),this._handleProperty("pack",this._updatePacking)},_updateBoxAlign:function(){var a=this._def.getChildValue("box-align");a&&this._getLayoutRootElement().setStyle("box-align",this._translateBoxAlignValues(this._orientation,a))},_updatePacking:function(){var a=this._def.getChildValue("pack");if(a){this._isRtl()&&("start"===a?a="end":"end"===a&&(a="start"));var b=this._getLayoutRootElement();if(b.$flexPolyfill.hasPackingSupport())b.setStyle("justify-content",this._translatePackingValues(this._orientation,a));else if(this._packingSpacers){switch(a){case"start":this._packingSpacers.start.updateSize(0),this._packingSpacers.end.updateSize("*");break;case"center":this._packingSpacers.start.updateSize("*"),this._packingSpacers.end.updateSize("*");break;case"end":this._packingSpacers.start.updateSize("*"),this._packingSpacers.end.updateSize(0)}this.getViewContext().getEnvironment().getEventsDispatcher().fireEvent(Constants.WixAppEvents.PROXY_SIZE_INVALID,{proxy:this})}else this._replacePackingWithSpacers(a,b);if("horizontal"===this._orientation){var c=this.getViewContext().getEnvironment().getVar("partDirection");c&&c.addEvent(Constants.DataItemEvents.CHANGE,this._updatePacking)}}},_isRtl:function(){var a=this.getViewContext().getEnvironment().getVar("partDirection");return a&&"rtl"===a.getValue()},_setFixedSpacer:function(a,b,c){var d=this._isRtl(),e="vertical"===this._orientation;a&&("before"===b?a.setStyle("margin-"+(e?"top":d?"right":"left"),c):a.setStyle("margin-"+(e?"bottom":d?"left":"right"),c))},_removeFixedSpacer:function(a,b,c){var d=c&&"rtl"===c,e="vertical"===this._orientation;a&&("before"===b?a.setStyle("margin-"+(e?"top":d?"right":"left")):a.setStyle("margin-"+(e?"bottom":d?"left":"right")))},_translatePackingValues:function(a,b){return this._packingPropMap[a][b]},_translateBoxAlignValues:function(a,b){return this._alignPropMap[a][b]},_processChildLayoutDef:function(a,b){if(this._processSpacers(this._components[b],a,b),!this._shouldBeFlexush){var c=_.has(a,"box-flex")&&"0"!==a["box-flex"]&&0!==a["box-flex"],d=_.has(a,"spacer")&&"*"===a.spacer,e=_.has(a,"spacerBefore")&&"*"===a.spacerBefore,f=_.has(a,"spacerAfter")&&"*"===a.spacerAfter;this._shouldBeFlexush=c||d||e||f}return a},_replacePackingWithSpacers:function(a,b){function c(a){var b=d._viewContext.getEnvironment(),c=b.getDataItemFactory().createDataItem(a),e=b.getProxyFactory().createProxyFromItemDefinition(d._viewContext,c).proxy,f=e.createComponent();return f.updateSize=function(a){c.getChildByRef("comp").getChildByRef("size").setValue(a)},f}this._packingSpacers=this._packingSpacers||{};var d=this,e="vertical"===this._orientation?"VSpacer":"HSpacer",f={id:this._fieldId+"_pack_start",comp:{name:e,size:0}},g={id:this._fieldId+"_pack_end",comp:{name:e,size:0}};switch(a){case"center":f.comp.size="*",g.comp.size="*";break;case"end":this._isRtl()?g.comp.size="*":f.comp.size="*";break;case"start":this._isRtl()?f.comp.size="*":g.comp.size="*"}var h=c(f);this._packingSpacers.start=h,b.grab(h,"top");var i=c(g);this._packingSpacers.end=i,b.grab(i)},_processSpacers:function(a,b,c){this._processSpacer(a,b,c,"before"),this._processSpacer(a,b,c,"after")},_setDynamicSpacer:function(a,b,c,d){var e=this._getLayoutRootElement(),f=a.getViewProxy(),g=this._children[b].getFieldId()+"_spacer_"+c,h={id:g,comp:{name:"vertical"==this._orientation?"VSpacer":"HSpacer",hidden:!1,size:"*"},layout:{}};f.hasClassAncestor("wixapps.integration.components.InlineText")&&(h.comp.name="InlineSpacer");var i=this._viewContext.getEnvironment(),j=i.getDataItemFactory().createDataItem(h),k=i.getProxyFactory().createProxyFromItemDefinition(this._viewContext,j).proxy,l=k.createComponent();l.updateSize=function(a){j.getChildByRef("comp").getChildByRef("size").setValue(a)},l.onProxyDefChange=function(){j.getChildByRef("comp").getChildByRef("hidden").setValue(f.isHidden())},l.onRemove=function(){f.getViewDefinition().removeEvent(Constants.DataItemEvents.CHANGE,l.onProxyDefChange),l.destroy()},f.getViewDefinition().addEvent(Constants.DataItemEvents.CHANGE,l.onProxyDefChange);var m=this._spacers[b]||{};m[c]=l;var n=j.getChildValue("layout");if(l.setStyles(n),d)e.appendChild(l);else if("before"==c)e.insertBefore(l,this._components[b]);else{var o=this._components[b].nextSibling;o?e.insertBefore(l,o):e.appendChild(l)}k.setupProxy()},_processSpacer:function(a,b,c,d,e){var f="before"==d?"spacerBefore":"spacerAfter",g=void 0!==b[f]?b[f]:b.spacer;void 0===g&&(g="none");var h=this._spacers[c]||{};if(a){if(a.getViewProxy&&"*"===g){var i=a.getViewProxy().isHidden();(i===!0||"true"===i)&&(g="none")}}else g="none";if(h[d]&&"none"==g)h[d].onRemove(),delete h[d];else if(h[d]||"none"==g){if(!h[d]&&"none"==g)return;"*"!==g&&(h[d].onRemove(),delete h[d],this._setFixedSpacer(a,d,g))}else{var j=this.getViewContext().getEnvironment().getVar("partDirection");if("*"===g){var k=j&&j.getValue();this._removeFixedSpacer(a,d,k),a.updateSpacers&&(j.removeEvent(Constants.DataItemEvents.CHANGE,a.updateSpacers),delete a.updateSpacers),this._setDynamicSpacer(a,c,d,e)}else j&&(a.updateSpacers&&j.removeEvent(Constants.DataItemEvents.CHANGE,a.updateSpacers),a.updateSpacers=function(b){this._removeFixedSpacer(a,d,b.oldValue),this._setFixedSpacer(a,d,g)}.bind(this),j.addEvent(Constants.DataItemEvents.CHANGE,a.updateSpacers)),this._setFixedSpacer(a,d,g)}this._spacers[c]=h,this.updateLayoutWhenReady()},_onChildLayoutPropertyChange:function(a){for(var b=0;b<a.length;b++){var c=a[b],d=_.last(c.path),e=parseInt(c.path[1],10);if(!isNaN(e)){var f={};f[d]=c.item.getValue(),0===d.indexOf("spacer")?(("spacer"==d||"spacerBefore"==d)&&this._processSpacer(this._components[e],f,e,"before"),("spacer"==d||"spacerAfter"==d)&&this._processSpacer(this._components[e],f,e,"after")):(this._applyStyle(this._components[e],f),this.getViewContext().getEnvironment().getEventsDispatcher().fireEvent(Constants.WixAppEvents.PROXY_SIZE_INVALID,{proxy:this}))}}this.parent(a)},_finalizeLayout:function(){},_disposeSpacers:function(){var a=this.getViewContext().getEnvironment().getVar("partDirection");this._packingSpacers&&(_.each(this._packingSpacers,function(a){a.getViewProxy().dispose()}),this._packingSpacers=null,a&&a.removeEvent(Constants.DataItemEvents.CHANGE,this._updatePacking)),a&&_.each(this._components,function(b){b.updateSpacers&&(a.removeEvent(Constants.DataItemEvents.CHANGE,b.updateSpacers),delete b.updateSpacers)}.bind(this))},dispose:function(){this._disposed||(this._disposeSpacers(),this.parent())}})}),define.Class("wixapps.integration.proxies.layout.CssLayoutProxy",function(a){var b=a;b.inherits("wixapps.integration.proxies.WCompositeProxy"),b.fields({_nativeEvents:[]}),b.methods({createComponent:function(){var a=this._createElement(this._getContainerElementType());return this._nativeEvents.forEach(function(b){a.addEvent(b.type,b.fn)}),this._createChildComponents(a),a},_createChildComponents:function(a){this._createChildProxies(),a.set("html",""),this.parent(a);var b=this._def.getChildByRef("items");if(b)var c=b.getChildren();this._children.forEach(function(a,b){var d=c[b].getChildValue("layout");if(d){var e=this._components[b];d.hasOwnProperty("width")&&!String(d.width).contains("%")&&e.setAttribute("width",parseInt(d.width,10)),d.hasOwnProperty("height")&&!String(d.height).contains("%")&&e.setAttribute("height",parseInt(d.height,10))}}.bind(this))},_getContainerElementType:function(){return"div"},_onProxySetup:function(){var a=this._getLayoutRootElement();a&&this._setupBox(a),this.updateLayoutWhenReady()},_setupBox:function(a){this._applyLayoutsAsCss(a)
},_applyLayoutsAsCss:function(a){var b={};this._def.getParent().getParent()||(b=this._def.getParent().getChildValue("layout")||{}),b=this._processLayoutDef(b)||b,this._applyStyle(a,b);var c=this._def.getChildValue("childLayout")||{};this._components.forEach(function(a){this._applyStyle(a,c)}.bind(this));var d=this._def.getChildByRef("items");if(d){var e=d.getChildren();this._children.forEach(function(a,b){var c=e[b].getChildValue("layout")||{};c=this._processChildLayoutDef(c,b)||c,this._applyStyle(this._components[b],c)}.bind(this))}},_processLayoutDef:function(a){return a},_processChildLayoutDef:function(a){return a},_registerProxyEvents:function(a,b){this.parent(a,b),this._nativeEvents.push({type:a,fn:b})},_reloadProxy:function(){this.parent(),this._createChildComponents(this._getLayoutRootElement()),this.setupProxy()},_onChildLayoutPropertyChange:function(a){if(this._getLayoutRootElement())for(var b,c=0;c<a.length;c++){var d=a[c],e=_.last(d.path),f=parseInt(d.path[1],10);b={},b[e]=d.item.getValue(),this._applyStyle(this._components[f],b)}},_getLayoutRootElement:function(){return this._element}})}),define.Class("wixapps.integration.proxies.layout.DataEditFieldProxy",function(a){var b=a;b.inherits("wixapps.integration.proxies.layout.LinkableRewriteBoxProxy"),b.binds(["_linkClick","_onLinkDialogClosing"]),b.traits(["wixapps.integration.proxies.traits.AppsLinkTrait"]),b.fields({_editedViewDef:null}),b.methods({initialize:function(a,b,c,d){this.parent(a,b,c,d),this._editedViewDef=W.AppsEditor2.getSelectionHandler()._appPart.getViewDefinition(),this._editedViewDef.addEvent(Constants.DataItemEvents.CHANGE,this._updateOnOriginalDefinitionChange)},_rewriteDefinition:function(a,b,c,d){if(!b.items||1!==b.items.length)throw"DataEditFieldProxy accepts exactly one child";var e=b.items[0];e.layout=e.layout||{},b.cssClass&&(e.comp.cssClass=b.cssClass);var f=this._linkPath+"_click",g=this._getLinkData(),h=[],i="",j=W.AppsEditor2.getSelectionHandler()._appPart.getViewDefinition(),k=this._linkPath.replace("links.",""),l=W.AppsEditor2.getViewBuilder().getViewFieldByTypeField(j.getValue(),k),m=l&&l.comp.pageLink;m?h=this._generatePageLinkSelectorContent(e,m,d):g?(h=this._generateLinkSelectorContent(e,f,d),i="bottom"):(h=this._generateAddLinkContent(b,e,f,d),i="top");var n={name:"HBox","box-align":i,items:h,events:{}},o=c.getEnvironment(),p=o.getEventsDispatcher();return p.addEvent(f,this._linkClick),n},_generatePageLinkSelectorContent:function(a,b,c){var d=W.Preview.getPreviewManagers().Viewer.getAppPages()[b].data,e=d.get("id"),f={id:c+"_linkSelector",comp:{name:"LinkSelector",skin:"wixapps.integration.skins.LinkSelectorSkinII",showDescription:!0,isEditable:!1},value:{_type:"wix:PageLink",pageId:e,linkId:""}},g={id:c+"_selectorWrapper",comp:{name:"VBox",items:[a,f]},layout:{"box-flex":1}};return[g]},_generateLinkSelectorContent:function(a,b,c){var d={id:c+"_addLinkButton",value:{_type:"wix:Image",src:"http://images/icons/appbuilder_sprite.png",width:25,height:30},comp:{name:"ImageButton",isSprite:"true",spriteDirection:"horizontal",startPositionX:"-991",startPositionY:"-20",css:{cursor:"pointer"},events:{click:{event:b,mode:"remove"}}},layout:{spacerBefore:3}},e={id:c+"_linkSelector",comp:{name:"LinkSelector",skin:"wixapps.integration.skins.LinkSelectorSkinII",showDescription:!0},data:this._linkPath},f={id:c+"_selectorWrapper",comp:{name:"VBox",items:[a,e]},layout:{"box-flex":1}};return[f,d]},_generateAddLinkContent:function(a,b,c,d){b=Object.merge({},b,{layout:{"box-flex":1}});var e={id:d+"_addLinkButton",value:{_type:"wix:Image",src:"http://images/icons/appbuilder_sprite.png",width:25,height:25},comp:{name:"ImageButton",isSprite:"true",spriteDirection:"horizontal",startPositionX:"-916",startPositionY:"-20",css:{cursor:"pointer"},events:{click:{event:c,mode:"add"}}},layout:{spacerBefore:a["link-top-offset"]-1}};return e={id:d+"_addLinkButtonSpacing",comp:{name:"VBox",items:[e]},layout:{spacerBefore:3}},[b,e]},_linkClick:function(a){if("add"===a.mode){var b="appbuilderlink",c=this._getLinkData();c=c&&c.getValue?c.getValue():{_type:"wix:LinkBase"},this._openLinkDialog(c,b,this._onLinkDialogClosing)}if("remove"===a.mode){var d=this._viewContext.evaluatePath("links"),e=d.getValue(),f=this._linkPath.split(".").pop();delete e[f],d.setValue(e)}},_onLinkDialogClosing:function(a,b,c,d){var e=this;this.resource.getResources(["W.EditorDialogs"],function(c){if(d.result===c.W.EditorDialogs.DialogButtons.OK){var f=e._createAppsLink(a).getValue(),g=e._viewContext.evaluatePath("links"),h=g.getValue(),i=e._linkPath.split(".").pop();b!==Constants.LinkState.NO_LINK&&f._type?h[i]=f:delete h[i],g.setValue(h)}})},dispose:function(){var a=this._linkPath+"_click",b=this._viewContext.getEnvironment(),c=b.getEventsDispatcher();c.removeEvent(a),this._editedViewDef.removeEvent(Constants.DataItemEvents.CHANGE,this._updateOnOriginalDefinitionChange),this.parent()}})}),define.Class("wixapps.integration.proxies.layout.FieldBoxProxy",function(a){var b=a;b.inherits("wixapps.integration.proxies.layout.RewriteBoxProxy"),b.methods({_rewriteDefinition:function(a,b,c){var d={},e=b.orientation||"vertical";d.name="Box",d.orientation="vertical"==e?"vertical":"horizontal",d.items=b.items||[],d.events=b.events||{};for(var f=0;f<d.items.length;f++){var g=d.items[f];if(["Field","TextField"].contains(g.comp.name)){g.comp.orientation=e;var h=c.getEnvironment().getProxyFactory().getProxyClassByName(g.comp.name);if(h.getLayoutDefinitions){var i="rtl"===c.getEnvironment().getVar("partDirection"),j=h.getLayoutDefinitions(g.comp,i);g.layout=g.layout||{},g.layout=Object.merge({},g.layout,j)}}}if(b.pack&&(d.pack=b.pack),d.css=d.css||{},"vertical"==e&&this._isWidthAmbiguous()&&this._hasChildContent(b)){var k=this._findMaxManualWidth(d);d.css.width=String(k)}else d.css.width="auto";return d.css.height=d.css.height||"100%",d},_hasChildContent:function(a){var b=["VSpacer","HSpacers"],c=_.filter(a.items,function(a){return!_.contains(b,a.comp.name)});return c.length>0},_isWidthAmbiguous:function(){var a=this._origDef.getParent().getValue().layout||{};return!(a.hasOwnProperty("width")||a.hasOwnProperty("box-flex")||a.hasOwnProperty("flex"))},_getParentBoxProxyCompDefinition:function(){for(var a,b=["HBox","VBox"],c=this._origDef;c._parent;){if(a=c._parent.getChildValue("name"),_.contains(b,a))return c._parent.getValue();c=c._parent}return null},_findMaxManualWidth:function(a){var b=this._getParentBoxProxyCompDefinition();if(b&&"VBox"===b.name)return"auto";var c,d=_.filter(a.items,function(a){return a.comp.hasOwnProperty("width-mode")?"manual"===a.comp["width-mode"]:void 0!==a.comp.width});return c=_.isEmpty(d)?200:_.reduce(d,function(a,b){var c=parseInt(b.comp.width,10)+parseInt(b.comp.spacers["xax-before"]||0,10)+parseInt(b.comp.spacers["xax-after"]||0,10);return c>a?c:a},0)}})}),define.Class("wixapps.integration.proxies.layout.FieldProxy",function(a){var b=a;b.inherits("wixapps.integration.proxies.layout.LinkableRewriteBoxProxy"),b.statics({getLayoutDefinitions:function(a,b){return this._rewriteSpacers(a,b).mainx},_isEmptyValue:function(a){var b=this._typeEmptyCheckers[a.getTypeName()];return b&&b(a)},_typeEmptyCheckers:{"wix:Image":function(a){return"http://images/noimage.png"===a.getChildValue("src")},String:function(a){return""===a.getValue()},"wix:Video":function(a){return"YOUTUBE"===a.getChildValue("videoType")&&"xLk7JoPDx4Q"===a.getChildValue("videoId")}}}),b.methods({_rewriteDefinition:function(a,b,c,d){if(!b.items||1!==b.items.length)throw"field proxy accepts exactly one child";var e={},f=b.orientation||"vertical",g=b.heightMode||"manual",h="vertical"==f,i=c.getEnvironment().getVar("partDirection"),j=i&&"rtl"===i.getValue();e.name=h?"Css":"Box",h||(e.orientation="horizontal"),e.hidden=b.hidden===!0||"true"===b.hidden||this._isEmptyValue(a),e.items=[],e.events=b.events||{},e.css=this._rewriteSpacers(b,j).xax,h&&(e.css.display="block");var k=b.items[0];k.layout=k.layout||{};var l=this._rewriteBoxAlignment(b["box-align"]||"start",h);e=_.merge(e,l);var m=void 0!==b.width?b.width:100,n=void 0!==b.height?b.height:100,o=0;return b.layout&&b.layout["min-width"]&&(o=b.layout["min-width"]),k.layout.width=o>m?o:m,k.layout["min-width"]=o,k.layout.height="manual"==g?n:"auto",e.items.push(this._linkify(k,d,b.pageLink)),e},getInnerProxy:function(){var a=this._children&&1==this._children.length&&this._children[0];return a&&a._element&&"a"==a._element.tagName.toLowerCase()?a&&a._children&&a._children.length&&a._children[0]:a}})}),define.Class("wixapps.integration.proxies.layout.FixedRatioLayoutProxy",function(a){var b=a;b.inherits("wixapps.integration.proxies.layout.BoxLayoutProxy"),b.binds(["_onAppResize"]),b.methods({_onAppResize:function(){this._updateLayoutSize()},_onAppViewCreated:function(){this._updateLayoutSize()},getAspectRatio:function(){return this._def.getChildValue("aspectRatio")||1},hasFixedAspectRatio:function(){return!0},_updateLayoutSize:function(){var a=this.getAspectRatio(),b=parseFloat(a);"golden"==a&&(b=1.61803);var c=this._element.getSize();if(this._isLayoutBasedWidth()){var d=Math.floor(c.x/b);this._element.setStyle("height",d)}else{var e=Math.floor(c.y*b);this._element.setStyle("width",e)}}})}),define.Class("wixapps.integration.proxies.layout.LinkableRewriteBoxProxy",function(a){var b=a;b.inherits("wixapps.integration.proxies.layout.RewriteBoxProxy"),b.binds(["_onLinksDataChanged"]),b.fields({_linkPath:null}),b.methods({initialize:function(a,b,c,d){this._linkPath=this._getLinkPath(c),this.parent(a,b,c,d);var e=a.evaluatePath("links");e&&e.addEvent(Constants.DataItemEvents.CHANGE,this._onLinksDataChanged)},_onLinksDataChanged:function(a){var b=this._dataItemUtils.createDataChangeEventList(a,this._data),c=b.some(function(a){return a.path.slice(-2).join(".")===this._linkPath}.bind(this));if(!c)return this._checkForCleanup(b),void 0;var d=this._origDef.getValue(0),e=this._rewriteDefinition(this._data,d,this._viewContext,this._fieldId);this._def.setValue(e),this._element&&!this._flaggedToReloadAfterRewrite&&this._element.$flexPolyfill.updateGeometry(),this._flaggedToReloadAfterRewrite&&(this._flaggedToReloadAfterRewrite=!1,this._reloadProxy())},_checkForCleanup:function(a){var b=a.some(function(a){return a.path.join(".")===this._linkPath+"._type"&&"wix:LinkBase"===a.item.getValue()}.bind(this));if(b){var c=this._viewContext.evaluatePath("links"),d=c.getValue(),e=this._linkPath.split(".").pop();delete d[e],c.setValue(d)}},_linkify:function(a,b,c){var d;if(c)d={data:"this",id:b+"_app_link",comp:{name:"AppLink",pageId:c,items:[a]},layout:Object.clone(a.layout)};else{var e=this._getLinkData();if(!e)return a;if("wix:LinkBase"===e.getTypeName())return a;if("wix:PageLink"===e.getTypeName()){var f=W.Data.getDataByQuery("#"+e.getChildValue("pageId"),function(){});if(!f)return a}d={data:this._linkPath,id:b+"_link",comp:{name:"Link",items:[a]},layout:Object.clone(a.layout)}}return delete a.layout.spacer,delete a.layout.spacerBefore,delete a.layout.spacerAfter,d},_getLinkPath:function(a){var b="",c=a.getValue(),d=c.items[0];if(c.hasOwnProperty("link")&&c.link)b+=c.link;else if(d.hasOwnProperty("data")&&d.data)b="links."+d.data;else{var e=a.getParent();b="links."+e.getChildValue("data")}return b},_getLinkData:function(){return this._viewContext.evaluatePath(this._linkPath)},dispose:function(){var a=this._viewContext._data.getChildByRef("links");a&&a.removeEvent(Constants.DataItemEvents.CHANGE,this._onLinksDataChanged),this.parent()}})}),define.Class("wixapps.integration.proxies.layout.OptionalAreaProxy",function(a){var b=a;b.inherits("wixapps.integration.proxies.layout.RewriteBoxProxy"),b.methods({_rewriteDefinition:function(a,b,c,d){var e={};e.name=b.name,e.orientation="horizontal"===b.orientation?"horizontal":"vertical",e.events=b.events||{},e.layout=b.layout||{},e.css=b.css||{};var f=a.getValue();if("false"!=f&&f){var g={comp:{name:"Area",styleNS:b.styleNS,items:b.items||[]},id:d+"_area",layout:{},css:{}};b.pack&&(g.comp.pack=b.pack),e.items=[g]}else e.items=b.items||[],b.pack&&(e.pack=b.pack);return e.hidden=b.hidden===!0||"true"===b.hidden||0===e.items.length,e}})}),define.Class("wixapps.integration.proxies.layout.RewriteBoxProxy",function(a){var b=a;b.inherits("wixapps.integration.proxies.layout.BoxLayoutProxy"),b.statics({_rewriteSpacers:function(a,b){var c=a.orientation||"vertical",d="vertical"==c,e={mainx:{},xax:{}};return b?(e.mainx["margin-"+(d?"top":"right")]=a.spacers&&a.spacers.before||0,e.mainx["margin-"+(d?"bottom":"left")]=a.spacers&&a.spacers.after||0,e.xax["padding-"+(d?"right":"top")]=a.spacers&&a.spacers["xax-before"]||0,e.xax["padding-"+(d?"left":"bottom")]=a.spacers&&a.spacers["xax-after"]||0):(e.mainx["margin-"+(d?"top":"left")]=a.spacers&&a.spacers.before||0,e.mainx["margin-"+(d?"bottom":"right")]=a.spacers&&a.spacers.after||0,e.xax["padding-"+(d?"left":"top")]=a.spacers&&a.spacers["xax-before"]||0,e.xax["padding-"+(d?"right":"bottom")]=a.spacers&&a.spacers["xax-after"]||0),e}}),b.binds(["_updateOnOriginalDefinitionChange"]),b.fields({_origName:null,_origDef:null,_flaggedToReloadAfterRewrite:!1,_viewContext:null}),b.methods({initialize:function(a,b,c,d){this._viewContext=a,this._origDef=c;var e=this._rewriteDefinition(b,c.getValue(0),a,d),f=a.getEnvironment().getDataItemFactory().createDataItem(e);f.getParent=function(){return c.getParent()},this._origName=c.getChildValue("name"),this.parent(a,b,f,d),this._origDef.addEvent(Constants.DataItemEvents.CHANGE,this._updateOnOriginalDefinitionChange)},_onDataChanged:function(){this.parent(),this._updateOnOriginalDefinitionChange()},_updateOnOriginalDefinitionChange:function(){var a=this._origDef.getValue(0);if(a.name==this._origName){var b=this._rewriteDefinition(this._data,a,this._viewContext,this._fieldId);this._def.setValue(b),this._element&&!this._flaggedToReloadAfterRewrite&&this._element.$flexPolyfill.updateGeometry(),this._flaggedToReloadAfterRewrite&&(this._flaggedToReloadAfterRewrite=!1,this._reloadProxy())}},_rewriteDefinition:function(){throw"not implemented (should return the manipulated json definition)"},_rewriteBoxAlignment:function(a,b){var c={};if(b)switch(a){case"start":c.cssClass="wixapps-less-spacers-align ltr";break;case"center":c.cssClass="wixapps-less-spacers-align center";break;case"end":c.cssClass="wixapps-less-spacers-align rtl"}else c["box-align"]={start:"top",center:"middle",end:"bottom"}[a];return c},_requestReloadAfterNextRewrite:function(){this._flaggedToReloadAfterRewrite=!0},dispose:function(){this._disposed||(this._origDef&&this._origDef.removeEvent(Constants.DataItemEvents.CHANGE,this._updateOnOriginalDefinitionChange),this._origDef=void 0,this.parent())}})}),define.Class("wixapps.integration.proxies.layout.StackLayoutProxy",function(a){var b=a;b.inherits("wixapps.integration.proxies.layout.CssLayoutProxy"),b.methods({_processLayoutDef:function(a){a.position="relative"},_processChildLayoutDef:function(a,b){var c="absolute";0===b&&(c="layout"==this._def.getChildValue("stackType")?"absolute":"static"),a.position=a.position||c,a.left=a.left||"0px",a.top=a.top||"0px"}})}),define.Class("wixapps.integration.proxies.layout.SwitchBoxProxy",function(a){var b=a;b.inherits("wixapps.integration.proxies.layout.RewriteBoxProxy"),b.methods({_rewriteDefinition:function(a,b){var c={};c.name=b.name,c.orientation="horizontal"===b.orientation?"horizontal":"vertical",c.items=[];var d=""+a.getValue();return c.items=b.cases[d]?b.cases[d]:b.cases["default"],c.hidden=b.hidden===!0||"true"===b.hidden||0===c.items.length,c.events=b.events||{},b.pack&&(c.pack=b.pack),c.css=b.css||{},c}})}),define.Class("wixapps.integration.proxies.layout.TextFieldProxy",function(a){var b=a;b.inherits("wixapps.integration.proxies.layout.LinkableRewriteBoxProxy"),b.statics({defaultManualWidth:150,defaultManualHeight:150,getLayoutDefinitions:function(a,b){var c=this._rewriteSpacers(a,b).mainx;return"horizontal"===a.orientation&&(c["max-width"]=void 0!==a.width?parseInt(a.width,10):this.defaultManualWidth),c}}),b.resources(["W.Utils"]),b.fields({_lastWidthMode:void 0}),b.methods({_rewriteDefinition:function(a,b,c,d){if(!b.items||1!==b.items.length)throw"field proxy accepts exactly one child";var e=b["width-mode"]||"auto";void 0===this._lastWidthMode&&(this._lastWidthMode=e),this._lastWidthMode!==e&&(this._lastWidthMode=e,this._requestReloadAfterNextRewrite());var f={},g=b.orientation||"vertical",h="vertical"==g,i=c.getEnvironment().getVar("partDirection"),j=i&&"rtl"===i.getValue();f.name=h?"Css":"Box",h||(f.orientation="horizontal"),f.hidden=this._shouldHide(a,b),f.events=b.events||{},f.items=[],f.css=this._rewriteSpacers(b,j).xax,h&&(f.css.display="block");var k=b.items[0],l="manual"===e,m=this._rewriteBoxAlignment(b["box-align"]||"start",h);return f=_.merge(f,m),k.layout=k.layout||{},l?k.layout.width=void 0!==b.width?parseInt(b.width,10):this.defaultManualWidth:h?k.layout.width="100%":k.layout["box-flex"]=1,this._setActualComponentName(b,k,a),f.items.push(this._linkify(k,d,b.pageLink)),f},_setActualComponentName:function(a,b,c){var d=void 0!==a["height-mode"]?a["height-mode"]:"auto",e=parseInt(a["min-lines"],10)||0,f=parseInt(a["max-lines"],10)||0;f>0&&e>f&&(f=e);var g=parseInt(a["max-chars"],10)||100,h=parseInt(a["min-height"],10)||100;b.comp.name="Label","auto"==d?(b.comp.singleLine=!1,b.layout.height="auto"):"lines"===d&&0===e&&1===f&&"String"===c.getTypeName()?b.comp.singleLine=!0:"max-chars"===d?(b.comp.name="ClippedParagraph2",b.comp["max-chars"]=g,b.layout["min-height"]=h):"fixed-height"==d?(b.layout["min-height"]=0,b.comp.name="Label",b.layout.height=void 0!==a.height?parseInt(a.height,10):this.defaultManualHeight,b.layout["overflow-y"]="hidden"):"pixels"==d?(b.comp.name="ClippedParagraph",b.comp.minLines=0,b.comp.maxLines=0,b.layout.height=void 0!==a.height?parseInt(a.height,10):this.defaultManualHeight):"lines"==d&&f>0&&(b.comp.name="ClippedParagraph",b.comp.minLines=e,b.comp.maxLines=f)},_isHiddenInDef:function(a){return a.hidden===!0||"true"===a.hidden},_shouldHide:function(a,b){if(this._isHiddenInDef(b))return!0;var c="String"==a.getTypeName()&&!a.getValue()||"wix:RichText"==a.getTypeName()&&!a.getChildValue("text"),d=parseInt(b["min-lines"],10)||0;return c&&0===d},getInnerProxy:function(){var a=this._children&&1==this._children.length&&this._children[0];return a&&a._element&&"a"==a._element.tagName.toLowerCase()?a&&a._children&&a._children.length&&a._children[0]:a}})}),define.Class("wixapps.integration.proxies.layout.ZoomLayoutProxy",function(a){var b=a;b.inherits("wixapps.integration.proxies.layout.CssLayoutProxy"),b.utilize(["wixapps.integration.utils.LayoutGeometryMap"]),b.resources(["W.Config","W.Utils"]),b.fields({_geometryMap:null,_childProxiesWithAspectRatioCache:null,_resizableProxiesCache:null,_richContentListCache:null,_richContentProxies:["wixapps.integration.proxies.ImageProxy","wixapps.integration.proxies.VideoProxy"]}),b.methods({initialize:function(a,b,c,d){a&&b&&c&&(this.parent(a,b,c,d),this._geometryMap=new this.imports.LayoutGeometryMap)},renderZoomLayout:function(a,b){var c=this;this._resetCaches(),a=a||window.innerWidth-200,b=b||window.innerHeight-82;var d=this._element.children[0];this._geometryMap.setContainer(d);var e=this._element.getParents('[skinpart="blockingLayer"]')[0]||this._element,f=this._viewContext.getEnvironment().getEventsDispatcher();this.resources.W.Config.env.$viewingDevice===Constants.ViewerTypesParams.TYPES.MOBILE?(a=Constants.ViewerTypesParams.DOC_WIDTH.MOBILE,this._setContainerWidth(d,a),f.fireEvent(Constants.WixAppEvents.APP_VIEW_READY),f.fireEvent(Constants.WixAppEvents.APP_ZOOM_READY)):(this._getResizableProxies(d).each(this._deactivateChildResizeMechanism),this._limitSizeToNative(d),d.setStyles({"box-sizing":"border-box"}),this._element.setStyles({position:"absolute"}),e.setStyle("overflow","hidden"),this.updateLayoutWhenReady(function(){window.requestAnimFrame(function(){c._contractContainer(d,a,b,function(){c.updateLayoutWhenReady(function(){c._getResizableProxies(d).each(c._activateChildResizeMechanism);var a=c._viewContext.getEnvironment().getEventsDispatcher();a.fireEvent(Constants.WixAppEvents.APP_VIEW_READY),a.fireEvent(Constants.WixAppEvents.APP_ZOOM_READY),e.setStyle("overflow","auto")})})})}))},_resetCaches:function(){this._childProxiesWithAspectRatioCache=null,this._resizableProxiesCache=null,this._richContentListCache=null},_contractContainer:function(a,b,c,d){var e=this,f=7,g=4,h=100;e._childProxiesWithAspectRatioCache=null,e._checkContainerSizes(a,h,b,f,function(f){var h=e._findBestFit(f,b,c);e._checkContainerSizes(a,h[0].appliedWidth,h[1].appliedWidth,g,function(f){var g=e._findBestFit(f,b,c);e._setContainerWidth(a,g[0].appliedWidth),window.requestAnimFrame(function(){e._recalcChildProxiesAspectRatio(a),d()})})})},_checkContainerSizes:function(a,b,c,d,e){var f=Math.floor((c-b)/d);0===f?e([{width:b},{width:c}]):this._checkContainerSizesRecursive(a,c,f,d,[],e)},_checkContainerSizesRecursive:function(a,b,c,d,e,f){var g=this;this._setContainerWidth(a,b),window.requestAnimFrame(function(){g._recalcChildProxiesAspectRatio(a),window.requestAnimFrame(function(){g._geometryMap.updateMap(a);var h=g._geometryMap.get(a),i=e.concat({appliedWidth:b,width:h.width,height:h.height,richContentArea:g._calcRichContentArea(a,h.width,h.height),overflowCount:g._getOverflowCount(a),index:e.length});d>0?g._checkContainerSizesRecursive(a,b-c,c,d-1,i,f):f(i)})})},_findBestFit:function(a,b,c){var d=a.slice(0).sort(this._getSizeInfoCmpFunc(b,c)),e=d[0],f=e.index<a.length-1?e.index+1:e.index-1,g=a[f];return[e,g]},_getSizeInfoCmpFunc:function(a,b){var c=a/b;return function(a,d){var e=function(){return a.overflowCount-d.overflowCount},f=function(){return a.height>b&&d.height<=b?1:d.height>b&&a.height<=b?-1:0},g=function(){return d.richContentArea-a.richContentArea},h=function(){return a.width-d.width},i=function(){var b=a.width/a.height,e=d.width/d.height;return Math.abs(b-c)-Math.abs(e-c)},j=function(){return a.richContentArea>0&&d.richContentArea>0?g()||h():i()};return e()||f()||j()}},_setContainerWidth:function(a,b){a.setStyle("width",b)},_recalcChildProxiesAspectRatio:function(a){this._getChildProxiesWithAspectRatio(a).each(function(a){var b=a.getElement(),c=b.getSize(),d=Math.round(c.x/a.getAspectRatio());b.setStyle("height",d)})},_getChildProxiesWithAspectRatio:function(a){return this._childProxiesWithAspectRatioCache||(this._childProxiesWithAspectRatioCache=a.getElements("[hasproxy]").map(function(a){return a.getViewProxy()}).filter(function(a){return a.hasFixedAspectRatio()})),this._childProxiesWithAspectRatioCache},_getResizableProxies:function(a){return this._resizableProxiesCache||(this._resizableProxiesCache=a.getElements("[hasproxy]").filter(function(a){return Boolean(a.getViewProxy()._activateResizeMechanism)})),this._resizableProxiesCache},_getRichContentList:function(a){return this._richContentListCache||(this._richContentListCache=a.getElements("[hasproxy]").filter(function(a){return this._richContentProxies.contains(a.getViewProxy().getOriginalClassName())}.bind(this))),this._richContentListCache},_calcRichContentArea:function(a,b,c){var d=this,e={left:0,right:b,top:0,bottom:c,width:b,height:c},f=this._getRichContentList(a).reduce(function(a,b){var c=d._geometryMap.get(b),f=d._getRectIntersection(e,c);return f?a+f.width*f.height:a},0);return f},_getRectIntersection:function(a,b){var c=Math.max(a.left,b.left),d=Math.max(a.top,b.top),e=Math.min(a.right,b.right),f=Math.min(a.bottom,b.bottom);return e>=c&&f>=d?{left:c,right:e,top:d,bottom:f,width:e-c,height:f-d}:void 0},_getOverflowCount:function(a){return a.getElements("[hasproxy]").reduce(function(b,c){return this._isOverflowElement(a,c)===!0?b+1:b}.bind(this),0)},_isOverflowElement:function(a,b){var c=b.getParents("[hasproxy]"),d=c.indexOf(a);return d>-1?c.slice(0,d+1).some(function(a){var c=this._geometryMap.get(a),d=this._geometryMap.get(b),e=this._isCoordIntersection(c,d);return e}.bind(this)):void 0},_isCoordIntersection:function(a,b){return!(b.left>=a.left&&b.right<=a.right&&b.top>=a.top&&b.bottom<=a.bottom)},_activateChildResizeMechanism:function(a){if(a.getViewProxy){var b=a.getViewProxy();b&&b._activateResizeMechanism&&b._activateResizeMechanism()}},_deactivateChildResizeMechanism:function(a){if(a.getViewProxy){var b=a.getViewProxy();b&&b._deactivateResizeMechanism&&b._deactivateResizeMechanism(a)}},_limitSizeToNative:function(a){var b=a.getElements("[hasproxy]").map(function(a){return{element:a,nativeSize:a.getViewProxy().getSourceSize()}}).filter(function(a){return void 0!==a.nativeSize});b.each(function(a){a.element.setStyle("max-width",a.nativeSize.width)})}})}),define.Class("wixapps.integration.proxies.traits.AppsLinkTrait",function(a){var b=a;b.utilize(["wysiwyg.common.utils.LinkRenderer"]),b.statics({LINK_PREFIXES:{PAGE_LINK_PREFIX:"#!",MAILTO_PREFIX:"mailto:"},PROTOCOLS:["http","https"]}),b.methods({_updateLinkDataItems:function(a){if("wix:RichText"===this._data.getTypeName()||"wix:MediaRichText"===this._data.getTypeName())for(var b=this._data.getChildValue("links"),c=0;c<b.length;c++)W.Data.getDataByQuery("#"+b[c].linkId)||this._createWLink(b[c],a)},_updateAnchorLink:function(a,b){var c=this._createWLink(b),d=new this.imports.LinkRenderer;d.renderLink(a,c)},_createRawLinkData:function(a,b){var c={};b=b||W.Data;var d=_.clone(a);if("wix:Link"===d._type){var e=d.href;if("WEBSITE"===d.linkType||e.contains("://")||0===e.indexOf("//"))d._type="wix:ExternalLink",d.protocol=e.substr(0,e.indexOf("://")),d.protocol=this.PROTOCOLS.contains(d.protocol.toLowerCase())?d.protocol:"",d.address=""===d.protocol?e:e.substr(e.indexOf("://")+3);else if(0===e.indexOf(this.LINK_PREFIXES.PAGE_LINK_PREFIX))d._type="wix:PageLink",d.pageId=e.substr(1);else if(0===e.indexOf(this.LINK_PREFIXES.MAILTO_PREFIX)){var f=e.split("?");d._type="wix:MailLink",d.email=f[0].substr(f[0].indexOf(":")+1),d.subject="",f.length>1&&f.forEach(function(a){0===a.indexOf("subject=")&&(d.subject=a.substr(f[0].indexOf("=")+1))})}}switch(d._type){case"wix:PageLink":c.type="PageLink",c.pageId="#"+d.pageId;break;case"wix:ExternalLink":c.type="ExternalLink",c.url=d.protocol?d.protocol+"://"+d.address:d.address,c.target=d.target;break;case"wix:DocLink":c.type="DocumentLink",c.docId=d.docId,c.name=d.docName;break;case"wix:MailLink":c.type="EmailLink",c.recipient=d.email,c.subject=d.subject;break;case"wix:AnchorLink":c.type="AnchorLink",c.anchorName=d.anchorName,c.anchorDataId=d.anchorDataId,c.pageId=d.pageId;break;default:return null}return c},_createWLink:function(a,b){b=b||W.Data;var c=this._createRawLinkData(a,b);if(!c)return null;var d=b.addDataItem(a.linkId,c);return d.setMeta("isPersistent",!1),d},_createAppsLink:function(a){var b,c=this._viewContext.getEnvironment().getDataItemFactory(),d={linkId:a.get("id")};switch(a.get("type")){case"PageLink":d._type="wix:PageLink",d.pageId=a.get("pageId").substr(1);break;case"ExternalLink":d._type="wix:ExternalLink",d.target=a.get("target"),b=a.get("url").split("://"),1==b.length&&(b=["http"].concat(b)),d.protocol=b[0],d.address=b[1];break;case"DocumentLink":d._type="wix:DocLink",d.docId=a.get("docId"),d.docName=a.get("name");break;case"EmailLink":d._type="wix:MailLink",d.email=a.get("recipient"),d.subject=a.get("subject");break;case"AnchorLink":d._type="wix:AnchorLink",d.anchorName=a.get("anchorName"),d.anchorDataId=a.get("anchorDataId"),d.pageId=a.get("pageId")}return c.createDataItem(d)},_openLinkDialog:function(a,b,c){var d=this;this.resource.getResources(["W.Preview","W.Commands"],function(e){var f,g=e.W.Preview.getPreviewManagers().Data;f="wix:LinkBase"==a._type?g.createDataItem({link:b?b:null},"StyledTextLinkHelper"):d._createWLink(a,e.W.Preview.getPreviewManagers().Data),e.W.Commands.executeCommand("WEditorCommands.OpenLinkDialogCommand",{position:Constants.DialogWindow.POSITIONS.CENTER,previewComponent:d._previewComponent,data:f,state:f.get("linkType")||Constants.LinkState.NO_LINK,closeCallback:function(a,b,d){b&&(f=g.createDataItem(b._data,b._type)),c(f,a,b,d)}})})}})}),define.Class("wixapps.integration.proxies.traits.ProxyPropertyChangeTrait",function(a){var b=a;b.fields({_propHandlers:{},_compProperties:[],_postWixificationChanges:{}}),b.methods({initialize:function(){this._setupDefaultHandlers(),this._setupPropertyHandlers()},_handleProperty:function(a,b){this._propHandlers[a]=b},_handleProperties:function(a,b){a.forEach(function(a){this._handleProperty(a,function(){b.call(this)})}.bind(this))},_mapToCompProperty:function(a,b,c){b=b||a,this._compProperties.push({propName:a,compPropName:b,setterFunc:c}),this._handleProperty(a,function(a){this._componentLogic.setComponentProperty(b,c?c(a):a)})},_mapToCompProperties:function(a){a.forEach(function(a){this._mapToCompProperty(a)}.bind(this))},_setupPropertyHandlers:function(){},_setupDefaultHandlers:function(){this._handleProperty("name",function(){this._goBellyUp()}),this._handleProperty("enabled",function(){this._updateComponentState()}),this._handleProperty("style",function(){this._updateCompStyle()}),this._handleProperty("css",function(){this._applyCssNode(this._element)}),this._handleProperty("hidden",function(a){this._updateCompVisibility(a)}),this._handleProperty("cssClass",function(a){this._updateCssClass(a)})},_onDefPropertyChanged:function(a){var b,c;if(this._isWixificationPending===!0)return this._accumulateChanges(a),void 0;this._propHandlers["*"]&&this._propHandlers["*"].call(this);for(var d=0;d<a.length;d++)c=a[d].path[0],b=this._propHandlers[c],b&&b.call(this,this._def.getChildValue(c))},_isPropertyChange:function(a){return"css"===_.first(a.path)||this.parent(a)},_accumulateChanges:function(a){a.forEach(function(a){this._postWixificationChanges[a.path[0]]=a}.bind(this))},_applyAccumulatedPropertyChanges:function(){this._onDefPropertyChanged(Object.values(this._postWixificationChanges))},isHidden:function(){if(this._disposed)return!0;var a=this._def.getChildValue("hidden");return a===!0||"true"===a},_createCompProperties:function(){var a=this._getPropSchemaName(),b={};return a&&(b={type:a}),this._compProperties.forEach(function(a){var c=this._def.getChildValue(a.propName);void 0!==c&&(b[a.compPropName]=a.setterFunc?a.setterFunc(c):c)}.bind(this)),b},_updateCompProperties:function(a){var b=this._getPropMap(),c=this._def;a.forEach(function(a){var d=a.path[0],e=b[d];e&&this._componentLogic.setComponentProperty(e,this._processPropValue(d,c.getChildValue(d)))}.bind(this))},_processPropValue:function(a,b){return b},_getPropMap:function(){return{}},_getPropSchemaName:function(){},_updateCompStyle:function(){var a=this._def.getChildValue("style")||this._getDefaultStyleName();a&&!this.getProxyMetaTags().contains("text")&&void 0===Constants.WixApps.TEXT_STYLES[a]&&W.Theme.getStyle(a,function(a){a&&(this._componentLogic.setStyle(a),this._registerStyleChangeHandler())}.bind(this),this._getDefaultSkinName())},_updateComponentState:function(){var a=this._def.getChildValue("enabled");void 0!==a&&("false"===a||a===!1?this._componentLogic.disable():this._componentLogic.enable())},_applyCssNode:function(a){var b=this._def.getChildValue("css");b&&this._applyStyle(a,b)},_updateCompVisibility:function(a){"true"==a||a===!0?this._element.collapse():(this._element.uncollapse(),this.updateLayoutWhenReady())},_updateCssClass:function(a){var b=this._cssClass;a!=b&&(this._cssClass=a,b&&this._element.removeClass(b),a&&this._element.addClass(a))},_goBellyUp:function(){this.fireEvent(Constants.WixAppEvents.PROXY_IRRECOVERABLE,{})}})}),define.Class("wixapps.integration.proxies.traits.WDataExchangeTrait",function(a){var b=a;b.methods({initialize:function(){},_convertWItemDataToRawData:function(a){var b=["metaData"],c={array:Array,object:Object},d=function(a){var e=typeOf(a);if("array"==e||"object"==e){var f=c[e],g=a;"object"==e&&a.hasOwnProperty("_data")&&(g=a._data);var h=f.filter(g,function(a,c){return!b.contains(c)});return f.map(h,function(a){return d(a)})}return a};return d(a)},_rawDataEquals:function(a,b){return JSON.stringify(a)==JSON.stringify(b)
}})}),define.dataSchema("AppBuilderComponent",{appInnerID:"string",appPartName:"string"}),define.dataSchema("AppPage",{"extends":"Page",appPageId:"string",appInnerID:"number",appPageType:"string",repeaterPage:{type:"boolean","default":!1}}),define.dataSchema("AppPart",{appInnerID:"string",appLogicParams:"object",appLogicCustomizations:"array",appPartName:"string",viewName:"string"}),define.dataSchema("AppPartProperties",{direction:{type:"string","enum":["ltr","rtl"],"default":"ltr"}}),define.dataSchema("AppVars",{vars:"object",appDefId:"string"}),define.dataSchema("ClippedParagraphProperties",{minLines:{type:"number","default":0},maxLines:{type:"number","default":0},pack:{type:"string","enum":["top","bottom","middle","none"],"default":"none"},showTooltip:{type:"boolean","default":!1}}),define.dataSchema("Icon",{url:"string",width:"number",height:"number",title:"string"}),define.dataSchema("WixappsImageButtonProperties",{isSprite:{type:"boolean","default":!0},spriteDirection:{type:"string","enum":["horizontal","vertical"],"default":"vertical"},startPositionX:{type:"number","default":0},startPositionY:{type:"number","default":0}}),define.dataSchema("MultiSelectableList",{items:"refList",selected:"refList"}),define.dataSchema("PaginatedGridGallery2Properties",{columns:{type:"number","default":2,description:"Number of columns",minimum:1,maximum:10},rows:{type:"number","default":2,description:"Maximum number of rows",minimum:1,maximum:10},gap:{type:"number","default":20,description:"Margin around each item",minimum:0,maximum:250},transition:{type:"string","enum":["none","swipeVertical","swipeHorizontal","crossfade","outIn"],"default":"swipeHorizontal",description:"Transition between items of the gallery"},transDuration:{type:"number",minimum:0,maximum:5,"default":1,description:"Duration of the transition in sec"},autoplayInterval:{type:"number","default":3,minimum:0,maximum:30,description:"Autoplay interval"},autoplay:{type:"boolean","default":!1,description:""},showNavigation:{type:"boolean","default":!0,description:""},showCounter:{type:"boolean","default":!0,description:""}}),define.skin("wixapps.integration.skins.ClippedParagraphSkin",function(a){var b=a;b.inherits("wysiwyg.viewer.skins.WRichTextNewSkin"),b.html('<div skinPart="richTextContainer" class=""></div>'),b.css([" {word-wrap: break-word;}"," ul { list-style-type: disc; padding-left: 1.3em; margin-left: 0.5em; line-height: normal; letter-spacing: normal;}"," ol {  list-style-type: decimal;padding-left: 1.3em; margin-left: 0.5em; line-height: normal; letter-spacing: normal;}",' ul[dir="rtl"] {padding-right: 1.3em; margin-right: 0.5em;}',' ol[dir="rtl"] {padding-right: 1.3em; margin-right: 0.5em;}'," ul ul {list-style-type: circle; line-height: normal;}"," ol ul {list-style-type: circle; line-height: normal;}"," ol ol ul {list-style-type: square; line-height: normal;}"," ol ul ul {list-style-type: square; line-height: normal;}"," ul ol ul {list-style-type: square; line-height: normal;}"," ul ul ul {list-style-type: square; line-height: normal;}"," li{ color: inherit; font-size: inherit; font-family: inherit; font-style: inherit; font-weight: inherit; line-height: inherit; letter-spacing: normal;}"," p {margin: 0; line-height: normal; letter-spacing: normal;}"," h1 {margin: 0;  line-height: normal; letter-spacing: normal;}"," h2 {margin: 0; line-height: normal; letter-spacing: normal;}"," h3 {margin: 0;  line-height: normal; letter-spacing: normal;}"," h4 {margin: 0; line-height: normal; letter-spacing: normal;}"," h5 {margin: 0;  line-height: normal; letter-spacing: normal;}"," h6 {margin: 0;  line-height: normal; letter-spacing: normal;}"," a { color: inherit}"])}),define.skin("wixapps.integration.skins.DropTargetSkin",function(a){var b=a;b.inherits("mobile.core.skins.BaseSkin"),b.skinParams([{id:"$BorderRadius",type:Constants.SkinParamTypes.BORDER_RADIUS,defaultValue:"3px"},{id:"webThemeDir",type:"themeUrl",defaultTheme:"WEB_THEME_DIRECTORY"}]),b.html('<div skinPart="inlineContent"></div>'),b.css(["{[$BorderRadius] position:relative; [box] height:34px; line-height:34px; border:dashed 1px #A0A0A0; background:#f8f8f8; }","%inlineContent%{ margin:0px 10px 10px 10px; line-height:30px; }","%inlineContent% .disabled { opacity: 0.4; }"])}),define.skin("wixapps.integration.skins.HelpQuestionMarkIconSkin",function(a){var b=a;b.inherits("mobile.core.skins.BaseSkin"),b.skinParams([{id:"baseThemeDir",type:Constants.SkinParamTypes.URL,defaultTheme:"WEB_THEME_DIRECTORY"}]),b.html('<img skinPart="img" src="icons/property_panel_help_sprite.png" />'),b.css()}),define.skin("wixapps.integration.skins.IconSkin",function(a){var b=a;b.inherits("mobile.core.skins.BaseSkin"),b.html('<img skinPart="img"></img>')}),define.skin("wixapps.integration.skins.ImageButtonSkin",function(a){var b=a;b.inherits("mobile.core.skins.BaseSkin"),b.html(""),b.css([])}),define.skin("wixapps.integration.skins.LinkSelectorSkin",function(a){var b=a;b.inherits("mobile.core.skins.BaseSkin"),b.skinParams([{id:"baseThemeDir",type:Constants.SkinParamTypes.URL,defaultTheme:"BASE_THEME_DIRECTORY"}]),b.html('<p skinPart="description"></p>'),b.css(["%description% { background:transparent url([baseThemeDir]wix_apps/link-selector-button.png) left center no-repeat; cursor:pointer; padding-bottom: 3px; padding-left:20px; min-width:1px; min-height:16px; }"])}),define.skin("wixapps.integration.skins.LinkSelectorSkinII",function(a){var b=a;b.inherits("mobile.core.skins.BaseSkin"),b.skinParams([{id:"baseThemeDir",type:Constants.SkinParamTypes.URL,defaultTheme:"BASE_THEME_DIRECTORY"},{id:"maxWidth",type:Constants.SkinParamTypes.SIZE,defaultValue:"245px"}]),b.html('<p class="container singleLine"><span class="sepLine">&nbsp;</span><span skinPart="description"></span></p>'),b.css([" .singleLine { white-space:nowrap; display:block; overflow:hidden; text-overflow:ellipsis; word-wrap:normal; }","%.container% { width:100%; background:transparent url([baseThemeDir]wix_apps/link_sprite.png) 2px top no-repeat; font-size: 1em;  border-radius: 3px; border: 1px solid #B4B4B4; border-image: initial; box-shadow: rgba(0, 0, 0, 0.0980392) 0px 1px 1px 0px inset; background-color: #FFF;margin: 0px 0px 5px; cursor:pointer; padding: 0px 3px; padding-left:20px; min-width:1px; min-height:23px; line-height: 23px; vertical-align: middle;}","[state=nonEditable] %.container% { cursor: default; }",'%description% {font-family: "Helvetica Neue", Helvetica, Arial, sans-serif; }',"%.sepLine% { width: 1px; border-left: solid 1px #B4B4B4; margin-right: 5px; margin-left: 4px;}"])}),define.skin("wixapps.integration.skins.TextAreaSkin",function(a){var b=a;b.inherits("mobile.core.skins.BaseSkin"),b.skinParams([{id:"shadowColor",type:Constants.SkinParamTypes.COLOR_ALPHA,defaultValue:"0,0,0,.3"}]),b.html('<div class="clearfix"><label skinpart="label"></label><textarea skinpart="input" ></textarea><div skinpart="message"></div></div>'),b.css(["%.clearfix% {height:100%}","%input% {width:100%; height:100%; padding:12px; line-height: 1.3em;  font-size:1em; border: 1px solid #e3e3e3; box-shadow: 0 1px 1px 0 [shadowColor] inset;}","%input%:hover{border-color: #a3d9f6; }","%input%:focus{border-color: #19a0e9; }",'[state~="hasLabel"] %label% {display:block; padding-bottom: 5px;}',"[disabled] %label% {opacity:0.5}",'[state~="invalid"] input%input%{background: #f6e0dd; border-color: #de4c3a}','[state~="invalid"] %message% {color: #de4c3a; font-size: .916em;}',"input%input%.isPlaceholder{color: #999;}"])}),define.skin("wixapps.integration.skins.ToggleSkin",function(a){var b=a;b.inherits("mobile.core.skins.BaseSkin"),b.skinParams([{id:"tdr",type:Constants.SkinParamTypes.URL,defaultTheme:"BASE_THEME_DIRECTORY"},{id:"sel",type:Constants.SkinParamTypes.OTHER,defaultValue:"-webkit-touch-callout: none; -webkit-user-select: none; -khtml-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none;"}]),b.html('<div skinPart="on" class="label"></div><div skinPart="off"></div>'),b.css(['[state="on"] > %off% { display: none;}','[state="off"] > %off% { display: block; padding-top: 3px; cursor: pointer; } ','[state="on"] > %on% { display: block; padding-top: 3px; cursor: pointer; }','[state="off"] > %on% { display: none;}'])}),define.skin("wixapps.integration.skins.ToggleSkin2",function(a){var b=a;b.inherits("mobile.core.skins.BaseSkin"),b.skinParams([{id:"tdr",type:Constants.SkinParamTypes.URL,defaultTheme:"BASE_THEME_DIRECTORY"},{id:"sel",type:Constants.SkinParamTypes.OTHER,defaultValue:"-webkit-touch-callout: none; -webkit-user-select: none; -khtml-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none;"}]),b.html('<div skinPart="on" class="label"></div><div skinPart="off"></div>'),b.css(["{ cursor: default; padding:10px 20px; border:1px solid #e6e6e6; border-top:1px solid #ccc; border-radius:5px; }",'[state="on"] > %off% { display: none;}','[state="off"] > %off% { display: block; margin-top: 3px;} ','[state="on"] > %on% { display: block;}','[state="off"] > %on% { display: none;}'])}),define.skin("wixapps.integration.skins.WixAppsButtonSkin",function(a){var b=a;b.inherits("mobile.core.skins.BaseSkin"),b.skinParams([{id:"webThemeDir",type:Constants.SkinParamTypes.URL,defaultTheme:"WEB_THEME_DIRECTORY"},{id:"$borderRadius",type:Constants.SkinParamTypes.BORDER_RADIUS,defaultValue:"4px"},{id:"borderColor",type:Constants.SkinParamTypes.COLOR,defaultValue:"#c4c4c4"},{id:"borderColorOver",type:Constants.SkinParamTypes.COLOR,defaultValue:"#89a4af"},{id:"bgColor",type:Constants.SkinParamTypes.COLOR,defaultValue:"#f9fafc"},{id:"bgColorOver",type:Constants.SkinParamTypes.COLOR,defaultValue:"#f2f3f5"},{id:"bgColorPressed",type:Constants.SkinParamTypes.COLOR,defaultValue:"#f3f3f3"},{id:"shadowColor",type:Constants.SkinParamTypes.COLOR_ALPHA,defaultValue:"0,0,0,.2"},{id:"shadowInsetColor",type:Constants.SkinParamTypes.COLOR_ALPHA,defaultValue:"0,0,0,.7"},{id:"shadowInsetColorOver",type:Constants.SkinParamTypes.COLOR_ALPHA,defaultValue:"255,255,255,.7"},{id:"labelColor",type:Constants.SkinParamTypes.COLOR,defaultValue:"#24a0c4"}]),b.html('<div skinPart="icon"></div><div skinPart="label"></div><div skinPart="link"></div>'),b.css(["{padding: 0 10px; border: 1px solid [borderColor]; [$borderRadius] background:[bgColor] url([webThemeDir]button/button-gradient.png) repeat-x 0 50%; position:relative; text-align:center; cursor:pointer;}",'[state~="over"] {border:1px solid [borderColorOver]; background:[bgColorOver] none; box-shadow:0 2px 3px 0 [shadowColor], 0 1px 2px 0 [shadowInsetColorOver] inset; }','[state~="selected"] { background: [bgColorPressed] none; border-color: transparent; box-shadow: 0 1px 3px 0 [shadowInsetColor] inset; }','[state~="pressed"]  { background: [bgColorPressed] none; border-color: transparent; box-shadow: 0 1px 3px 0 [shadowInsetColor] inset; }',"%icon%     { position:absolute; left: 5px; top: 50%; width:24px; height:24px; margin-top:-12px; }","%label%    { color: [labelColor]; height:30px; line-height:30px; }","[disabled] {opacity: .5;}"])}),define.skin("wixapps.integration.skins.dialogs.AddFieldDialogSkin",function(a){var b=a;b.inherits("mobile.core.skins.BaseSkin"),b.skinParams([{id:"borderRadius",type:Constants.SkinParamTypes.BORDER_RADIUS,defaultValue:"5px 5px 5px 5px"}]),b.compParts({nameYourFieldInput:{skin:"wysiwyg.editor.skins.inputs.InputSkin"},positionYourFieldInput:{skin:"wysiwyg.editor.skins.inputs.ComboBoxSkin"}}),b.html('<div class="clearfix"><div class="compsPerFieldTypeLayout"><strong skinPart="contentLabel"></strong><div skinPart="content"><strong class="sectionTitle"></strong></div></div><div class="previewContainer"><div class="preview"><div skinPart="fieldDescription"></div></div><div skinPart="newFieldSettings"><div skinPart="nameYourFieldContainer"><label skinPart="nameYourFieldLabel"></label><div skinPart="nameYourFieldInput"></div></div><div skinPart="positionYourFieldContainer"><label skinPart="positionYourFieldLabel"></label><div skinPart="positionYourFieldInput"></div></div></div><div skinPart="defaultValueContainer"></div></div></div>'),b.css(["{position: relative;}","%.compsPerFieldTypeLayout% {float:left; width:160px;}","%contentLabel% {line-height:22px;}","%content% {overflow:auto; height:200px; margin-bottom: 5px; background-color:white; border:1px solid #b4b4b4; border-top:1px solid #ccc; [borderRadius]; padding:4px 15px 10px 15px}","%content%:hover{border-color: #a3d9f6; }","%content% .sectionTitle{ display: block; line-height: 20px; color: #4c4c4c; padding-top:6px;}","%fieldDescription% {padding:10px 20px 0}","%.previewContainer% {float:left; margin-left: 0px; padding-top: 19px; width:300px; overflow-x:hidden; overflow-y:visible; min-height:240px}","%.preview% {text-align:left; margin:0 auto; max-height: 280px;}","%newFieldSettings% { }","%nameYourFieldContainer% {padding:10px 20px 0;}","%positionYourFieldContainer% {padding:10px 20px 0;}","%nameYourFieldLabel% {line-height:22px;}","%positionYourFieldLabel% {line-height:22px;}","%nameYourFieldInput% {padding-top:5px}","%defaultValueContainer% { }"])}),define.skin("wixapps.integration.skins.dialogs.AppBuilderDataPanelSkin",function(a){var b=a;b.inherits("mobile.core.skins.BaseSkin"),b.skinParams([{id:"trans",type:Constants.SkinParamTypes.TRANSITION,defaultValue:"background-position 0.7s ease 0.2s"},{id:"webThemeDir",type:Constants.SkinParamTypes.URL,defaultTheme:"WEB_THEME_DIRECTORY"},{id:"$contentAreaShadow",type:Constants.SkinParamTypes.BOX_SHADOW,defaultValue:"0 1px 50px  rgba(0, 0, 0, 0.5)"},{id:"noShadow",type:Constants.SkinParamTypes.BOX_SHADOW,defaultValue:"0 0 0 #000"},{id:"$panelBorderRadius",type:Constants.SkinParamTypes.BORDER_RADIUS,defaultValue:"0 0 5px 0"},{id:"$closeBorderRadius",type:Constants.SkinParamTypes.BORDER_RADIUS,defaultValue:"0 5px 0 0"},{id:"$topBorderRadius",type:Constants.SkinParamTypes.BORDER_RADIUS,defaultValue:"5px 5px 0 0"},{id:"overBorderRadius",type:Constants.SkinParamTypes.BORDER_RADIUS,defaultValue:"0 5px 0 0"},{id:"innerPanelMaxHeight",type:Constants.SkinParamTypes.OTHER,defaultValue:"550px"},{id:"panelWidth",type:Constants.SkinParamTypes.OTHER,defaultValue:"300px"},{id:"titleFontSize",type:Constants.SkinParamTypes.OTHER,defaultValue:"16px"}]),b.html('<div skinPart="topBar"><strong skinPart="panelLabel"></strong><div skinPart="titleContent"></div><div skinPart="help" class="help"><span>&nbsp;</span></div><div skinPart="close"><span>&nbsp;</span></div></div><div skinPart="panelDescription"></div><div skinPart="inlineContent"></div>'),b.css(["{background:#f7f7f7; width:[panelWidth]; [$panelBorderRadius] [noShadow]}","[state=expanded] { [$contentAreaShadow] }","%topBar% {width:100%; height:50px; [$topBorderRadius]; border-bottom:1px solid #dddddd; cursor:move; position:relative}","%panelLabel% {display:inline-block; font-size:[titleFontSize]; padding:0 0 0 8px; margin-left: 8px; overflow:hidden; text-overflow:ellipsis; width:180px; height:40px; line-height:40px; }","%panelDescription% {font-size: 14px; padding:15px; line-height:1.2em; border-top:1px solid #fff; color:#444}","%close% {position:absolute; top:1px; right:0; height:50px; width:34px; border-left:1px solid #ccc; cursor:pointer; [$closeBorderRadius]}",'%close% span {position:absolute; left:8px; top:11px; width:15px; height:15px; display:block; background:url("[webThemeDir]icons/top-bar-icons.png") 0 0 no-repeat}',"%close%:hover span {background-position:0 -140px}","%.help% {width:35px; height:50px; position:absolute; right:35px; top:1px; cursor:default;}","%.help% span {background:url([webThemeDir]icons/help_sprite.png) no-repeat 0 1px; width:19px; height:18px; position:absolute; right:8px; top:15px; cursor:pointer}","%.help% span:hover { background-position: 0 -16px}","%.help% span:active { background-position: 0 -33px}","%inlineContent% { top:10px; padding:0; }",' .font_6 { font: normal bold normal 16px/1.4em "Helvetica Neue Medium", sans-serif; color: #333; }',' .font_7 { font: normal normal normal 13px/1.4em "Helvetica Neue Medium", sans-serif; color: #333; }'])}),define.skin("wixapps.integration.skins.dialogs.AppBuilderDialogExpandablePanelSkin",function(a){var b=a;b.inherits("mobile.core.skins.BaseSkin"),b.skinParams([{id:"webThemeDir",type:Constants.SkinParamTypes.URL,defaultTheme:"WEB_THEME_DIRECTORY"},{id:"$contentAreaShadow",type:Constants.SkinParamTypes.BOX_SHADOW,defaultValue:"0 1px 50px  rgba(0, 0, 0, 0.5)"},{id:"noShadow",type:Constants.SkinParamTypes.BOX_SHADOW,defaultValue:"0 0 0 #000"},{id:"$panelBorderRadius",type:Constants.SkinParamTypes.BORDER_RADIUS,defaultValue:"0 0 0 5px"},{id:"$closeBorderRadius",type:Constants.SkinParamTypes.BORDER_RADIUS,defaultValue:"0 5px 0 0"},{id:"$topBorderRadius",type:Constants.SkinParamTypes.BORDER_RADIUS,defaultValue:"5px 5px 0 0"},{id:"overBorderRadius",type:Constants.SkinParamTypes.BORDER_RADIUS,defaultValue:"0 5px 0 0"},{id:"innerPanelMaxHeight",type:Constants.SkinParamTypes.OTHER,defaultValue:"550px"},{id:"innerPanelMinHeight",type:Constants.SkinParamTypes.OTHER,defaultValue:"150px"},{id:"panelWidth",type:Constants.SkinParamTypes.OTHER,defaultValue:"300px"},{id:"borderColor",type:Constants.SkinParamTypes.COLOR,defaultValue:"#5b8fa7"},{id:"$borderRadius",type:Constants.SkinParamTypes.BORDER_RADIUS,defaultValue:"4px"},{id:"bgColor",type:Constants.SkinParamTypes.COLOR,defaultValue:"#2aa7ea"},{id:"btnShadowInset",type:Constants.SkinParamTypes.BOX_SHADOW,defaultValue:"inset 0 1px 3px 0 rgba(0, 0, 0, 0.7)"},{id:"btnShadowInsetOver",type:Constants.SkinParamTypes.BOX_SHADOW,defaultValue:"inset 0 1px 2px 0 rgba(68,175,233, 0.7)"},{id:"bgColorOver",type:Constants.SkinParamTypes.BGC,defaultValue:"#179ce1"},{id:"borderColorOver",type:Constants.SkinParamTypes.COLOR,defaultValue:"#237aa7"},{id:"titleFontSize",type:Constants.SkinParamTypes.OTHER,defaultValue:"16px"}]),b.html('<div skinPart="topBar"><h4 skinPart="panelLabel"></h4><div skinPart="paneCloseBtn"></div></div><div skinPart="panelDescription"></div><div skinPart="inlineContent"></div>'),b.css(["{background:#f7f7f7; width:[panelWidth]; height:600px; [$panelBorderRadius] [$contentAreaShadow] position:relative; }","%topBar% {width:100%; height: 50px; [$topBorderRadius]; border-bottom:1px solid #dddddd; cursor:move;}",'%panelLabel% {font-family: "Helvetica Neue Medium"; display: inline-block; font-size:[titleFontSize]; padding:0px; margin-left: 8px; width:200px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; height:50px; line-height:50px; }',"%panelDescription% {font-size: 14px; margin:21px 15px; line-height:1.2em; border-top:1px solid #fff; color:#444; height:34px; overflow-y:auto; }","%.topBarActions% {position:absolute; width:100%; right:0; top:0; [$BorderTopRightRadius]}","%paneCloseBtn% {display: inline-block; position:absolute; top:11px; right:8px; padding: 0 10px 1px 20px; font-size: 11px; background: [bgColor] url([webThemeDir]button/button-gradient.png) repeat-x 0 50%; text-align: center; cursor: pointer;color:white; border: 1px solid [borderColor]; [$borderRadius]; line-height:25px; }",'%paneCloseBtn%:after {content:""; display:block; position:absolute; top:8px; left:7px; width:10px; height:10px; background:url([webThemeDir]lists/appbuilder_sprite.png) -150px 50% no-repeat; }',"%paneCloseBtn%:hover {background: [bgColorOver] none; border-color: [borderColorOver]; [btnShadowInsetOver]}","%paneCloseBtn%:active {background: [bgColor] none; border-color: transparent; [btnShadowInset]}","%icon% {position:absolute; left: 5px; top: 50%; width:24px; height:24px; margin-top: -12px;}","%inlineContent% { padding-bottom:25px; margin: 0 0 35px 0; font-size: 12px; line-height: 1.2em;}"])}),define.skin("wixapps.integration.skins.dialogs.AppBuilderDialogPanelSkin",function(a){var b=a;b.inherits("mobile.core.skins.BaseSkin"),b.skinParams([{id:"webThemeDir",type:Constants.SkinParamTypes.URL,defaultTheme:"WEB_THEME_DIRECTORY"},{id:"$contentAreaShadow",type:Constants.SkinParamTypes.BOX_SHADOW,defaultValue:"0 1px 50px  rgba(0, 0, 0, 0.5)"},{id:"$panelBorderRadius",type:Constants.SkinParamTypes.BORDER_RADIUS,defaultValue:"0 0 5px 0"},{id:"$closeBorderRadius",type:Constants.SkinParamTypes.BORDER_RADIUS,defaultValue:"0 5px 0 0"},{id:"$topBorderRadius",type:Constants.SkinParamTypes.BORDER_RADIUS,defaultValue:"5px 5px 0 0"},{id:"overBorderRadius",type:Constants.SkinParamTypes.BORDER_RADIUS,defaultValue:"0 5px 0 0"},{id:"innerPanelMaxHeight",type:Constants.SkinParamTypes.OTHER,defaultValue:"550px"},{id:"innerPanelMinHeight",type:Constants.SkinParamTypes.OTHER,defaultValue:"150px"},{id:"panelWidth",type:Constants.SkinParamTypes.OTHER,defaultValue:"300px"},{id:"titleFontSize",type:Constants.SkinParamTypes.OTHER,defaultValue:"16px"}]),b.html('<div skinPart="topBar"><strong skinPart="panelLabel"></strong><div skinPart="help" class="help"><span>&nbsp;</span></div><div skinPart="close"><span>&nbsp;</span></div></div><div skinPart="panelDescription"></div><div skinPart="inlineContent"></div>'),b.css(["{background:#f7f7f7; width:[panelWidth]; [$panelBorderRadius] [$contentAreaShadow]}","%topBar% {width:100%; height:40px; [$topBorderRadius]; border-bottom:1px solid #dddddd; cursor:move; position:relative}","%panelLabel% {display:inline-block; font-size:[titleFontSize]; padding:0 0 0 8px; overflow:hidden; margin: 0 40px 0 0; text-overflow:ellipsis; width:180px; height:40px; line-height:40px; }","%panelDescription% {font-size: 14px; margin:21px 15px; line-height:1.2em; border-top:1px solid #fff; color:#444; height:58px; overflow-y:auto; }","%close% {position:absolute; top:1px; right:0; height:38px; width:34px; border-left:1px solid #ccc; cursor:pointer; [$closeBorderRadius]}",'%close% span {position:absolute; left:8px; top:11px; width:15px; height:15px; display:block; background:url("[webThemeDir]icons/top-bar-icons.png") 0 0 no-repeat}',"%close%:hover span {background-position:0 -140px}","%.help% {width:35px; height:38px; position:absolute; right:35px; top:1px; cursor:default;}","%.help% span {background:url([webThemeDir]icons/help_sprite.png) no-repeat 0 1px; width:19px; height:18px; position:absolute; right:8px; top:11px; cursor:pointer}","%.help% span:hover { background-position: 0 -16px}","%.help% span:active { background-position: 0 -33px}","%inlineContent% { top:10px; padding:0 0 0 12px; margin: 0 0 35px 0; font-size: 12px; line-height: 1.2em; }"])}),define.skin("wixapps.integration.skins.dialogs.ChooseTemplateDialogWindowSkin",function(a){var b=a;b.inherits("mobile.core.skins.BaseSkin"),b.skinParams([{id:"webThemeDir",type:Constants.SkinParamTypes.URL,defaultTheme:"WEB_THEME_DIRECTORY"},{id:"$blockBg",type:Constants.SkinParamTypes.BG_COLOR,defaultValue:"0,0,0,0.5"},{id:"$tabRadius",type:Constants.SkinParamTypes.BORDER_RADIUS,defaultValue:"5px 5px 0 0"},{id:"$closeRadius",type:Constants.SkinParamTypes.BORDER_RADIUS,defaultValue:"0px 5px 0 0"},{id:"$borderRadius",type:Constants.SkinParamTypes.BORDER_RADIUS,defaultValue:"5px 5px 5px 5px"},{id:"$borderRadiusBottom",type:Constants.SkinParamTypes.BORDER_RADIUS,defaultValue:"0px 0px 5px 5px"},{id:"$contentAreaShadow",type:Constants.SkinParamTypes.BOX_SHADOW,defaultValue:"-3px 0 50px #000"},{id:"titleFontSize",type:Constants.SkinParamTypes.OTHER,defaultValue:"16px"}]),b.html('<div skinPart="blockLayer"></div><div skinPart="dialogBox"><div class="dialogLayout"><div skinPart="dragArea"></div><strong skinPart="dialogTitle"></strong><div class="dialogDescriptionWrapper"><div skinPart="dialogDescription"></div><div skinPart="helplet"></div></div><div skinPart="xButton"><div skinPart="x"></div></div><div class="dialogToolbar clearfix" skinPart="dialogToolbar"><div class="tabs" skinPart="tabs"></div></div><div class="dialogContent clearfix" skinPart="innerDialog"></div><div skinPart="buttonContainer"><div skinPart="cancelContainer" class="leftButton"></div><div skinPart="okContainer" class="rightButton"></div></div></div></div>'),b.css(["{position:absolute;width:850px;height:100%;}","%.dialogLayout% {background:#fdfdfd; padding-bottom: 10px; [$borderRadius] [$contentAreaShadow]}","[state~=modal]      %blockLayer% {[$blockBg]; display:block; position:fixed; top:0; bottom:0; left:0; right:0; visibility:visible; zoom:1; }","[state~=nonModal]   %blockLayer% {display:none}","[state~=semiModal]  %blockLayer% {background: url([webThemeDir]transparent.gif) repeat; display:block; position:fixed; top:0; bottom:0; left:0; right:0; visibility:visible; zoom:1;}","[state~=transparentModal]  %blockLayer% {background: url([webThemeDir]transparent.gif) repeat; display:block; position:fixed; top:0; bottom:0; left:0; right:0; visibility:visible; zoom:1;}","%dragArea%{position:absolute; left:0px; top:0px; height:34px; width:85%; cursor:move; background: url([webThemeDir]transparent.gif) repeat;}","[state~=modal] %dragArea%{cursor: default}","%dialogBox% {position:relative; zoom:0; top:0px; left:0px;}","%xButton% {position:absolute; top:0; right:0; width:34px; height:34px; cursor:pointer; border-left:1px solid #ccc; [$closeRadius]}","%xButton%:hover {background:#ddd;}","%xButton%:hover %x% {background-position:50% -140px;}","%x% {background:url([webThemeDir]icons/top-bar-icons.png) 50% 0; width:16px; height:16px; position:absolute; top: 50%; left: 50%; margin: -8px 0 0 -8px; }","%xButton%[disabled]:hover{cursor: default; background:none;}","%xButton%[disabled] %x%{cursor: default; background-position:50% 0; opacity: .5;}","%buttonContainer% {clear:both; overflow:hidden; padding:15px 10px 5px; background:#fdfdfd; [$borderRadiusBottom]}","%buttonContainer% .leftButton {float:left;}","%buttonContainer% .rightButton {float:right;}","%buttonContainer% .rightButton >div {float:right;margin-left:5px;}","%dialogTitle% {font-size:[titleFontSize]; display:block; padding:0 20px; border-bottom:1px solid #ccc; line-height:34px; }","%.dialogDescriptionWrapper% {border-top:1px solid #fff; padding:20px 45px}","%dialogDescription% {margin-bottom:4px;}","%helplet% {margin-top:10px; cursor:pointer; color:#09f; font-size:90%; }","%helplet%:hover {text-decoration:underline}","[state~=topHelpLocation] %helplet%{position:absolute;right:32px;top:12px;}","%.dialogToolbar% .tabs {top:1px; left:1px; height:45px; margin:0 10px 0; position:relative}","%.dialogToolbar% .tab {font-size:12px; padding:15px 25px; margin-top:1px; margin-right:3px; float:left; position:relative; cursor:pointer; border:1px solid #ccc; border-bottom:none; [$tabRadius]}","%.dialogToolbar% .selectedTab {background-color:#fdfdfd; border-bottom:none;position:relative;top:1px; font-weight:bold;}","%.dialogToolbar% .controlBtn {float:right;margin-top:8px; margin-right:10px}","%innerDialog% {margin:1px 11px 0; overflow:hidden;}","%helpButton% {position:absolute; top:0; right:35px; width:35px; height:35px; cursor:pointer;}","%helpButton%:hover {background:#ddd;}","%helpButton% span {background:url([webThemeDir]icons/help_sprite.png) no-repeat 0 1px; width:19px; height:18px; position:absolute; right:8px; top:10px; cursor:pointer}","%helpButton% span:hover { background-position: 0 -16px}","%helpButton% span:active { background-position: 0 -33px}"])}),define.skin("wixapps.integration.skins.dialogs.EditFieldPanelSkin",function(a){a.inherits("mobile.core.skins.BaseSkin"),a.skinParams([]),a.html('<div skinPart="content"></div>'),a.css(["%content% { margin:none !important}"])}),define.skin("wixapps.integration.skins.dialogs.GrayDialogWindowSkin",function(a){var b=a;b.inherits("mobile.core.skins.BaseSkin"),b.skinParams([{id:"webThemeDir",type:Constants.SkinParamTypes.URL,defaultTheme:"WEB_THEME_DIRECTORY"},{id:"$blockBg",type:Constants.SkinParamTypes.BG_COLOR,defaultValue:"0,0,0,0.5"},{id:"$tabRadius",type:Constants.SkinParamTypes.BORDER_RADIUS,defaultValue:"5px 5px 0 0"},{id:"$closeRadius",type:Constants.SkinParamTypes.BORDER_RADIUS,defaultValue:"0px 5px 0 0"},{id:"$borderRadius",type:Constants.SkinParamTypes.BORDER_RADIUS,defaultValue:"5px 5px 5px 5px"},{id:"$borderRadiusBottom",type:Constants.SkinParamTypes.BORDER_RADIUS,defaultValue:"0px 0px 5px 5px"},{id:"$contentAreaShadow",type:Constants.SkinParamTypes.BOX_SHADOW,defaultValue:"-3px 0 50px #000"},{id:"titleFontSize",type:Constants.SkinParamTypes.OTHER,defaultValue:"16px"}]),b.html('<div skinPart="blockLayer"></div><div skinPart="dialogBox"><div class="dialogLayout"><div skinPart="dragArea"></div><strong skinPart="dialogTitle"></strong><div class="dialogDescriptionWrapper"><div skinPart="dialogDescription"></div><div skinPart="helplet"></div></div><div skinPart="xButton"><div skinPart="x"></div></div><div skinPart="helpButton" class="hidden"><span></span></div><div class="dialogToolbar clearfix" skinPart="dialogToolbar"><div class="tabs" skinPart="tabs"></div></div><div class="dialogContent clearfix" skinPart="innerDialog"></div><div skinPart="buttonContainer" class="buttons"><div skinPart="cancelContainer" class="leftButton"></div><div skinPart="okContainer" class="rightButton"></div></div></div></div>'),b.css(["{position:absolute;width:100%;height:100%;}","%.dialogLayout% {background:#f7f7f7; padding-bottom: 10px; [$borderRadius] [$contentAreaShadow]}","[state~=modal]      %blockLayer% {[$blockBg]; display:block; position:fixed; top:0; bottom:0; left:0; right:0; visibility:visible; zoom:1; }","[state~=nonModal]   %blockLayer% {display:none}","[state~=semiModal]  %blockLayer% {background: url([webThemeDir]transparent.gif) repeat; display:block; position:fixed; top:0; bottom:0; left:0; right:0; visibility:visible; zoom:1;}","[state~=transparentModal]  %blockLayer% {background: url([webThemeDir]transparent.gif) repeat; display:block; position:fixed; top:0; bottom:0; left:0; right:0; visibility:visible; zoom:1;}","%dragArea%{position:absolute; left:0px; top:0px; height:39px; width:85%; cursor:move; background: url([webThemeDir]transparent.gif) repeat;}","[state~=modal] %dragArea%{cursor: default}","%dialogBox% {position:relative; zoom:0; top:0px; left:0px;}","%xButton% {position:absolute; top:0; right:0; width:39px; height:39px; cursor:pointer; border-left:1px solid #ccc; [$closeRadius]}","%xButton%:hover {background:#ddd;}","%xButton%:hover %x% {background-position:50% -140px;}","%x% {background:url([webThemeDir]icons/top-bar-icons.png) 50% 0; width:16px; height:16px; position:absolute; top: 50%; left: 50%; margin: -8px 0 0 -8px; }","%xButton%[disabled]:hover{cursor: default; background:none;}","%xButton%[disabled] %x%{cursor: default; background-position:50% 0; opacity: .5;}","%buttonContainer% {clear:both; overflow:hidden; padding:15px 10px 5px; background:#f7f7f7; [$borderRadiusBottom]}","%buttonContainer% .leftButton {float:left;}","%buttonContainer% .rightButton {float:right;}","%buttonContainer% .rightButton >div {float:right;margin-left:5px;}","%dialogTitle% {font-size:[titleFontSize]; display:block; padding:0 10px; border-bottom:1px solid #ccc; line-height:39px; }","%.dialogDescriptionWrapper% {border-top:1px solid #fff;}","%dialogDescription% {padding:15px 10px; line-height:14px; font-size:12px;}","%helplet% {padding:0px 10px 15px; margin-top: -10px; cursor:pointer; color:#379acf; font-size: .83em; }","%helplet%:hover {text-decoration:underline}","[state~=topHelpLocation] %helplet%{position:absolute;right:32px;top:12px;}","%.dialogToolbar% .tabs {top:1px; left:1px; height:45px; margin:0 10px 0; position:relative}","%.dialogToolbar% .tab {font-size:12px; padding:15px 25px; margin-top:1px; margin-right:3px; float:left; position:relative; cursor:pointer; border:1px solid #ccc; border-bottom:none; [$tabRadius]}","%.dialogToolbar% .selectedTab {background-color:#fdfdfd; border-bottom:none;position:relative;top:1px; font-weight:bold;}","%.dialogToolbar% .controlBtn {float:right;margin-top:8px; margin-right:10px}","%innerDialog% {margin:1px 11px 0; overflow:auto;}","%helpButton% {position:absolute; top:0; right:35px; width:35px; height:35px; cursor:pointer;}","%helpButton% span {background:url([webThemeDir]icons/help_sprite.png) no-repeat 0 1px; width:19px; height:18px; position:absolute; right:8px; top:10px; cursor:pointer}","%helpButton% span:hover { background-position: 0 -16px}","%helpButton% span:active { background-position: 0 -33px}"])
}),define.skin("wixapps.integration.skins.dialogs.HelpBubbleDialogWindowSkin",function(a){var b=a;b.inherits("mobile.core.skins.BaseSkin"),b.skinParams([{id:"webThemeDir",type:Constants.SkinParamTypes.URL,defaultTheme:"WEB_THEME_DIRECTORY"},{id:"$blockBg",type:Constants.SkinParamTypes.BG_COLOR,defaultValue:"0,0,0,0.5"},{id:"$tabRadius",type:Constants.SkinParamTypes.BORDER_RADIUS,defaultValue:"5px 5px 0 0"},{id:"$closeRadius",type:Constants.SkinParamTypes.BORDER_RADIUS,defaultValue:"0px 5px 0 0"},{id:"$borderRadius",type:Constants.SkinParamTypes.BORDER_RADIUS,defaultValue:"5px 5px 5px 5px"},{id:"$borderRadiusBottom",type:Constants.SkinParamTypes.BORDER_RADIUS,defaultValue:"0px 0px 5px 5px"},{id:"$contentAreaShadow",type:Constants.SkinParamTypes.BOX_SHADOW,defaultValue:"-3px 0 50px #000"},{id:"titleFontSize",type:Constants.SkinParamTypes.OTHER,defaultValue:"16px"}]),b.html('<div skinPart="blockLayer"></div><div skinPart="dialogBox"><div class="arrowLeft"></div><div class="dialogLayout"><strong skinPart="dialogTitle"></strong><div class="dialogDescriptionWrapper"><div skinPart="dialogDescription"></div><div skinPart="helplet"></div></div><div skinPart="helpButton" class="hidden"><span></span></div><div class="dialogToolbar clearfix" skinPart="dialogToolbar"><div class="tabs" skinPart="tabs"></div></div><div class="dialogContent clearfix" skinPart="innerDialog"></div><div skinPart="xButton"><div skinPart="x"></div></div><div skinPart="dragArea"></div><div skinPart="buttonContainer" class="buttons"><div skinPart="cancelContainer" class="leftButton"></div><div skinPart="okContainer" class="rightButton"></div></div></div></div>'),b.css(["{position:absolute;width:100%;height:100%;}","%.arrowLeft% {position:absolute; top:40px; left:-14px; width: 0; height: 0; border-top: 7px solid transparent; border-bottom: 7px solid transparent; border-right:14px solid #fdfdfd; }","%.dialogLayout% {background:#fdfdfd; padding-bottom: 10px; [$borderRadius] [$contentAreaShadow]}","[state~=modal]      %blockLayer% {[$blockBg]; display:block; position:fixed; top:0; bottom:0; left:0; right:0; visibility:visible; zoom:1; }","[state~=nonModal]   %blockLayer% {display:none}","[state~=semiModal]  %blockLayer% {background: url([webThemeDir]transparent.gif) repeat; display:block; position:fixed; top:0; bottom:0; left:0; right:0; visibility:visible; zoom:1;}","[state~=transparentModal]  %blockLayer% {background: url([webThemeDir]transparent.gif) repeat; display:block; position:fixed; top:0; bottom:0; left:0; right:0; visibility:visible; zoom:1;}","%dragArea%{position:absolute; left:0px; top:0px; height:34px; width:85%; cursor:move; background: url([webThemeDir]transparent.gif) repeat;}","[state~=modal], [state~=semiModal]  %dragArea%{cursor: default}","%dialogBox% {position:relative; zoom:0; top:0px; left:0px;}","%xButton% {position:absolute; top:0; right:0; width:34px; height:34px; cursor:pointer; [$closeRadius]}","%xButton%:hover %x% {background-position:50% -140px;}","%x% {background:url([webThemeDir]icons/top-bar-icons.png) 50% 0; width:16px; height:16px; position:absolute; top: 50%; left: 50%; margin: -8px 0 0 -8px; }","%xButton%[disabled]:hover{cursor: default; background:none;}","%xButton%[disabled] %x%{cursor: default; background-position:50% 0; opacity: .5;}","%buttonContainer% {clear:both; overflow:hidden; padding:15px 10px 5px; background:#fdfdfd; [$borderRadiusBottom]}","%buttonContainer% .leftButton {float:left;}","%buttonContainer% .rightButton {float:right;}","%buttonContainer% .rightButton >div {float:right;margin-left:5px;}","%dialogTitle% {display:none;}","%.dialogDescriptionWrapper% {display:none;}","%dialogDescription% {padding:15px 10px; line-height:14px; font-size:12px;}","%helplet% {padding:0px 10px 15px; margin-top: -10px; cursor:pointer; color:#379acf; font-size: .83em; }","%helplet%:hover {text-decoration:underline}","[state~=topHelpLocation] %helplet%{position:absolute;right:32px;top:12px;}","%.dialogToolbar% .tabs {top:1px; left:1px; height:45px; margin:0 10px 0; position:relative}","%.dialogToolbar% .tab {font-size:12px; padding:15px 25px; margin-top:1px; margin-right:3px; float:left; position:relative; cursor:pointer; border:1px solid #ccc; border-bottom:none; [$tabRadius]}","%.dialogToolbar% .selectedTab {background-color:#fdfdfd; border-bottom:none;position:relative;top:1px; font-weight:bold;}","%.dialogToolbar% .controlBtn {float:right;margin-top:8px; margin-right:10px}","%innerDialog% {margin:1px 11px 0; overflow:hidden;}","%helpButton% {position:absolute; top:0; right:35px; width:35px; height:35px; cursor:pointer;}","%helpButton% span {background:url([webThemeDir]icons/help_sprite.png) no-repeat 0 1px; width:19px; height:18px; position:absolute; right:8px; top:10px; cursor:pointer}","%helpButton% span:hover { background-position: 0 -16px}","%helpButton% span:active { background-position: 0 -33px}",' .font_5 { font:normal normal normal 25px/1.4em "Helvetica Neue Light", sans-serif; color:#717070; }',' .font_6 { font:normal normal normal 15px/1.4em "Helvetica Neue Medium", sans-serif; color:#404040; }'])}),define.skin("wixapps.integration.skins.dialogs.HelpBubbleDialogWindowSkinUpArrow",function(a){var b=a;b.inherits("mobile.core.skins.BaseSkin"),b.skinParams([{id:"webThemeDir",type:Constants.SkinParamTypes.URL,defaultTheme:"WEB_THEME_DIRECTORY"},{id:"$blockBg",type:Constants.SkinParamTypes.BG_COLOR,defaultValue:"0,0,0,0.5"},{id:"$tabRadius",type:Constants.SkinParamTypes.BORDER_RADIUS,defaultValue:"5px 5px 0 0"},{id:"$closeRadius",type:Constants.SkinParamTypes.BORDER_RADIUS,defaultValue:"0px 5px 0 0"},{id:"$borderRadius",type:Constants.SkinParamTypes.BORDER_RADIUS,defaultValue:"5px 5px 5px 5px"},{id:"$borderRadiusBottom",type:Constants.SkinParamTypes.BORDER_RADIUS,defaultValue:"0px 0px 5px 5px"},{id:"$contentAreaShadow",type:Constants.SkinParamTypes.BOX_SHADOW,defaultValue:"-3px 0 50px #000"},{id:"titleFontSize",type:Constants.SkinParamTypes.OTHER,defaultValue:"16px"}]),b.html('<div skinPart="blockLayer"></div><div skinPart="dialogBox"><div class="arrowUp"></div><div class="dialogLayout"><strong skinPart="dialogTitle"></strong><div class="dialogDescriptionWrapper"><div skinPart="dialogDescription"></div><div skinPart="helplet"></div></div><div skinPart="helpButton" class="hidden"><span></span></div><div class="dialogToolbar clearfix" skinPart="dialogToolbar"><div class="tabs" skinPart="tabs"></div></div><div class="dialogContent clearfix" skinPart="innerDialog"></div><div skinPart="xButton"><div skinPart="x"></div></div><div skinPart="dragArea"></div><div skinPart="buttonContainer" class="buttons"><div skinPart="cancelContainer" class="hidden"></div><div skinPart="okContainer" class="centerButton"></div></div></div></div>'),b.css(["{position:absolute;width:100%;height:100%;}","%.arrowUp% {position:absolute; top:-14px; left:320px; width: 0; height: 0; border-left: 7px solid transparent; border-right: 7px solid transparent; border-bottom:14px solid #fdfdfd; }","%.dialogLayout% {background:#fdfdfd; padding-bottom: 10px; [$borderRadius] [$contentAreaShadow]}","[state~=modal]      %blockLayer% {[$blockBg]; display:block; position:fixed; top:0; bottom:0; left:0; right:0; visibility:visible; zoom:1; }","[state~=nonModal]   %blockLayer% {display:none}","[state~=semiModal]  %blockLayer% {background: url([webThemeDir]transparent.gif) repeat; display:block; position:fixed; top:0; bottom:0; left:0; right:0; visibility:visible; zoom:1;}","[state~=transparentModal]  %blockLayer% {background: url([webThemeDir]transparent.gif) repeat; display:block; position:fixed; top:0; bottom:0; left:0; right:0; visibility:visible; zoom:1;}","%dragArea%{position:absolute; left:0px; top:0px; height:34px; width:85%; cursor:move; background: url([webThemeDir]transparent.gif) repeat;}","[state~=modal], [state~=semiModal]  %dragArea%{cursor: default}","%dialogBox% {position:relative; zoom:0; top:0px; left:0px;}","%xButton% {position:absolute; top:0; right:0; width:34px; height:34px; cursor:pointer; [$closeRadius]}","%xButton%:hover %x% {background-position:50% -140px;}","%x% {background:url([webThemeDir]icons/top-bar-icons.png) 50% 0; width:16px; height:16px; position:absolute; top: 50%; left: 50%; margin: -8px 0 0 -8px; }","%xButton%[disabled]:hover{cursor: default; background:none;}","%xButton%[disabled] %x%{cursor: default; background-position:50% 0; opacity: .5;}","%buttonContainer% {clear:both; overflow:hidden; padding:0px 10px 5px; background:#fdfdfd; [$borderRadiusBottom]}","%buttonContainer% .centerButton {margin:0px auto; display:block; width:120px; height:30px;}","%dialogTitle% {display:none;}","%.dialogDescriptionWrapper% {display:none;}","%dialogDescription% {padding:15px 10px; line-height:14px; font-size:12px;}","%helplet% {padding:0px 10px 15px; margin-top: -10px; cursor:pointer; color:#379acf; font-size: .83em; }","%helplet%:hover {text-decoration:underline}","[state~=topHelpLocation] %helplet%{position:absolute;right:32px;top:12px;}","%.dialogToolbar% .tabs {top:1px; left:1px; height:45px; margin:0 10px 0; position:relative}","%.dialogToolbar% .tab {font-size:12px; padding:15px 25px; margin-top:1px; margin-right:3px; float:left; position:relative; cursor:pointer; border:1px solid #ccc; border-bottom:none; [$tabRadius]}","%.dialogToolbar% .selectedTab {background-color:#fdfdfd; border-bottom:none;position:relative;top:1px; font-weight:bold;}","%.dialogToolbar% .controlBtn {float:right;margin-top:8px; margin-right:10px}","%innerDialog% {margin:1px 11px 0; overflow:hidden;}","%helpButton% {position:absolute; top:0; right:35px; width:35px; height:35px; cursor:pointer;}","%helpButton% span {background:url([webThemeDir]icons/help_sprite.png) no-repeat 0 1px; width:19px; height:18px; position:absolute; right:8px; top:10px; cursor:pointer}","%helpButton% span:hover { background-position: 0 -16px}","%helpButton% span:active { background-position: 0 -33px}",' .font_5 { font:normal normal normal 25px/1.4em "Helvetica Neue Light", sans-serif; color:#717070; }',' .font_6 { font:normal normal normal 15px/1.4em "Helvetica Neue Medium", sans-serif; color:#404040; }'])}),define.skin("wixapps.integration.skins.dialogs.InputGroupSkin",function(a){var b=a;b.inherits("mobile.core.skins.BaseSkin"),b.skinParams([{id:"$BorderRadius",type:Constants.SkinParamTypes.BORDER_RADIUS,defaultValue:"3px"},{id:"webThemeDir",type:"themeUrl",defaultTheme:"WEB_THEME_DIRECTORY"}]),b.html('<div skinPart="inlineContent"></div>'),b.css(["{ height:30px; border:1px solid #c8e5f7; border-top-color:#bfdbf0; [$BorderRadius]}","%inlineContent%{ margin:0px 10px 10px 10px; line-height:30px; }"])}),define.skin("wixapps.integration.skins.dialogs.MessageDialogWithOptOutSkin",function(a){a.inherits("mobile.core.skins.BaseSkin"),a.skinParams([]),a.html('<div skinPart="contentWrapper" class="contentWrapper selectableChildren"><div skinPart="text" class="text"></div><em skinPart="details" class="details"></em><div skinpart="isDontShowAgainCont"><input type="checkbox" skinpart="isDontShowAgain" /></div></div>'),a.css(["%contentWrapper% {padding:10px 0 0;}","%text% {line-height:1.3em;}","%details% {padding-top:10px; color: #666; display:block;}"," p {margin-bottom: 10px;}","%isDontShowAgainCont% {margin-top: 20px; text-align: right;}"])}),define.skin("wixapps.integration.skins.dialogs.NoTitleDialogWindowSkin",function(a){var b=a;b.inherits("mobile.core.skins.BaseSkin"),b.skinParams([{id:"webThemeDir",type:Constants.SkinParamTypes.URL,defaultTheme:"WEB_THEME_DIRECTORY"},{id:"$blockBg",type:Constants.SkinParamTypes.BG_COLOR,defaultValue:"0,0,0,0.5"},{id:"$tabRadius",type:Constants.SkinParamTypes.BORDER_RADIUS,defaultValue:"5px 5px 0 0"},{id:"$closeRadius",type:Constants.SkinParamTypes.BORDER_RADIUS,defaultValue:"0px 5px 0 0"},{id:"$borderRadius",type:Constants.SkinParamTypes.BORDER_RADIUS,defaultValue:"5px 5px 5px 5px"},{id:"$borderRadiusBottom",type:Constants.SkinParamTypes.BORDER_RADIUS,defaultValue:"0px 0px 5px 5px"},{id:"$contentAreaShadow",type:Constants.SkinParamTypes.BOX_SHADOW,defaultValue:"-3px 0 50px #000"},{id:"titleFontSize",type:Constants.SkinParamTypes.OTHER,defaultValue:"16px"}]),b.html('<div skinPart="blockLayer"></div><div skinPart="dialogBox"><div class="dialogLayout"><strong skinPart="dialogTitle"></strong><div class="dialogDescriptionWrapper"><div skinPart="dialogDescription"></div><div skinPart="helplet"></div></div><div skinPart="helpButton" class="hidden"><span></span></div><div class="dialogToolbar clearfix" skinPart="dialogToolbar"><div class="tabs" skinPart="tabs"></div></div><div class="dialogContent clearfix" skinPart="innerDialog"></div><div skinPart="xButton"><div skinPart="x"></div></div><div skinPart="dragArea"></div><div skinPart="buttonContainer" class="buttons"><div skinPart="cancelContainer" class="leftButton"></div><div skinPart="okContainer" class="rightButton"></div></div></div></div>'),b.css(["{position:absolute;width:100%;height:100%;}","%.dialogLayout% {background:#fdfdfd; [$borderRadius] [$contentAreaShadow]}","[state~=modal]      %blockLayer% {[$blockBg]; display:block; position:fixed; top:0; bottom:0; left:0; right:0; visibility:visible; zoom:1; }","[state~=nonModal]   %blockLayer% {display:none}","[state~=semiModal]  %blockLayer% {background: url([webThemeDir]transparent.gif) repeat; display:block; position:fixed; top:0; bottom:0; left:0; right:0; visibility:visible; zoom:1;}","[state~=transparentModal]  %blockLayer% {background: url([webThemeDir]transparent.gif) repeat; display:block; position:fixed; top:0; bottom:0; left:0; right:0; visibility:visible; zoom:1;}","%dragArea%{position:absolute; left:0px; top:0px; height:34px; width:85%; cursor:move; background: url([webThemeDir]transparent.gif) repeat;}","[state~=modal] %dragArea%{cursor: default}","%dialogBox% {position:relative; zoom:0; top:0px; left:0px;}","%xButton% {position:absolute; top:0; right:0; width:34px; height:34px; cursor:pointer; [$closeRadius]}","%xButton%:hover %x% {background-position:50% -140px;}","%x% {background:url([webThemeDir]icons/top-bar-icons.png) 50% 0; width:16px; height:16px; position:absolute; top: 50%; left: 50%; margin: -8px 0 0 -8px; }","%xButton%[disabled]:hover{cursor: default; background:none;}","%xButton%[disabled] %x%{cursor: default; background-position:50% 0; opacity: .5;}","%buttonContainer% {clear:both; overflow:hidden; padding:15px 10px 5px; background:#fdfdfd; [$borderRadiusBottom]}","%buttonContainer% .leftButton {float:left;}","%buttonContainer% .rightButton {float:right;}","%buttonContainer% .rightButton >div {float:right;margin-left:5px;}","%dialogTitle% {display:none;}","%.dialogDescriptionWrapper% {display:none;}","%dialogDescription% {padding:15px 10px; line-height:14px; font-size:12px;}","%helplet% {padding:0px 10px 15px; margin-top: -10px; cursor:pointer; color:#379acf; font-size: .83em; }","%helplet%:hover {text-decoration:underline}","[state~=topHelpLocation] %helplet%{position:absolute;right:32px;top:12px;}","%.dialogToolbar% .tabs {top:1px; left:1px; height:45px; margin:0 10px 0; position:relative}","%.dialogToolbar% .tab {font-size:12px; padding:15px 25px; margin-top:1px; margin-right:3px; float:left; position:relative; cursor:pointer; border:1px solid #ccc; border-bottom:none; [$tabRadius]}","%.dialogToolbar% .selectedTab {background-color:#fdfdfd; border-bottom:none;position:relative;top:1px; font-weight:bold;}","%.dialogToolbar% .controlBtn {float:right;margin-top:8px; margin-right:10px}","%innerDialog% {margin:1px 11px 0; overflow:hidden;}","%helpButton% {position:absolute; top:0; right:35px; width:35px; height:35px; cursor:pointer;}","%helpButton% span {background:url([webThemeDir]icons/help_sprite.png) no-repeat 0 1px; width:19px; height:18px; position:absolute; right:8px; top:10px; cursor:pointer}","%helpButton% span:hover { background-position: 0 -16px}","%helpButton% span:active { background-position: 0 -33px}",' .font_5 { font:normal normal normal 25px/1.4em "Helvetica Neue Light", sans-serif; color:#717070; }',' .font_6 { font:normal normal normal 15px/1.4em "Helvetica Neue Medium", sans-serif; color:#404040; }',' .font_8 { font:normal normal normal 13px/1.3em "Helvetica Neue", sans-serif; color:#444444; }',"[state~=semiModal] %dragArea% {display:none}"])}),define.skin("wixapps.integration.skins.ecommerce.PaginatedGridSimple",function(a){a.inherits("core.managers.skin.BaseSkin2"),a.skinParams([{id:"bg",type:Constants.SkinParamTypes.BG_COLOR,defaultTheme:"color_11"},{id:"bgh",type:Constants.SkinParamTypes.BG_COLOR,defaultTheme:"color_11"},{id:"strip",type:Constants.SkinParamTypes.COLOR_ALPHA,defaultTheme:"color_18"},{id:"rbn",type:Constants.SkinParamTypes.BG_COLOR,defaultTheme:"color_23"},{id:"itemBrw",type:Constants.SkinParamTypes.SIZE,defaultValue:"0px"},{id:"itemBrc",type:Constants.SkinParamTypes.COLOR_ALPHA,defaultTheme:"color_16"},{id:"itemBrch",type:Constants.SkinParamTypes.COLOR_ALPHA,defaultTheme:"color_18"},{id:"txth",type:Constants.SkinParamTypes.COLOR,defaultTheme:"color_18"},{id:"paging",type:Constants.SkinParamTypes.COLOR,defaultTheme:"color_15"},{id:"tdr",type:Constants.SkinParamTypes.URL,defaultTheme:"BASE_THEME_DIRECTORY"},{id:"rd",type:Constants.SkinParamTypes.BORDER_RADIUS,defaultValue:"0px"},{id:"box",type:Constants.SkinParamTypes.OTHER,defaultValue:"box-sizing:border-box; -moz-box-sizing:border-box; -ms-box-sizing:border-box; -webkit-box-sizing:border-box;"},{id:"heightDiff",type:Constants.SkinParamTypes.SIZE,defaultValue:"40px"}]),a.html('<div skinPart="inlineContent"></div><ul><li skinPart="buttonPrev">&#9668;</li><li skinPart="counter"></li><li skinPart="buttonNext">&#9658;</li></ul>'),a.css(["%.hid%           { display:none; }"," .galleryDisplayer       { [box] [rd] [bg] border:[itemBrw] solid [itemBrc]; cursor:pointer !important; }"," .galleryDisplayer .rolloverStrip  { background:transparent; }"," .galleryDisplayer .ribbon  { [rbn] }"," .galleryDisplayer:hover .rolloverStrip  { background:[strip]; }"," .galleryDisplayer:hover .txtHoverColor *  { color:[txth]; }"," .galleryDisplayer:hover { [bgh] border-color:[itemBrch]; }",' .galleryDisplayer:hover .pic:after { content:""; position:absolute; top:0; right:0; bottom:-6px; left:0; background:transparent url([tdr]wix_apps/magnify.png) right top no-repeat; border-bottom:solid 3px [txt]; }',"ul { position:absolute; bottom:10px; left:0; right:0; text-align:center; color:[paging] !important; }","li { padding:0 5px; display:inline !important; font-size:14px; color:[paging] !important;  }"])}),define.skin("wixapps.integration.skins.ecommerce.inputs.ComboBoxInputSkin",function(a){var b=a;b.inherits("mobile.core.skins.BaseSkin"),b.skinParams(),b.html('<select skinpart="collection"></select>'),b.css(["{position:relative;}",'[state~="invalid"]:before { content:"!"; position:absolute; text-align:center;bottom:50%; left:-20px; width:20px; height:20px; line-height:20px !important; margin-bottom:-11px;color:#fff; background:#f00; border:2px solid #fff; border-radius:50%; box-shadow:0 1px 3px rgba(0, 0, 0, 0.5); font-size:12px; font-weight:bold; }','[state~="invalid"]:after { content:""; position:absolute; bottom:50%; left:3px; margin:0 0 -7px -2px;color:#fff; text-shadow:1px 1px 3px rgba(0, 0, 0, 0.5); font-size:10px; }'])}),define.skin("wixapps.integration.skins.ecommerce.inputs.TextAreaInputSkin",function(a){var b=a;b.inherits("mobile.core.skins.BaseSkin"),b.skinParams([{id:"box",type:Constants.SkinParamTypes.OTHER,defaultValue:" -webkit-box-sizing:border-box; -moz-box-sizing:border-box; box-sizing:border-box;"},{id:"bg",type:Constants.SkinParamTypes.BG_COLOR,defaultValue:"#ffffff",enableEdit:!0},{id:"brd",type:Constants.SkinParamTypes.COLOR_ALPHA,defaultValue:"#e3e3e3",enableEdit:!0},{id:"brw",type:Constants.SkinParamTypes.SIZE,defaultValue:"1px"},{id:"brdh",type:Constants.SkinParamTypes.COLOR_ALPHA,defaultValue:"#a3d9f6",enableEdit:!0},{id:"brdf",type:Constants.SkinParamTypes.COLOR_ALPHA,defaultValue:"#19a0e9",enableEdit:!0},{id:"txt",type:Constants.SkinParamTypes.COLOR,defaultValue:"#000000",enableEdit:!0},{id:"rd",type:Constants.SkinParamTypes.BORDER_RADIUS,defaultValue:"0px"}]),b.html('<textarea skinPart="textarea"></textarea><p skinPart="errorMessage"></p>'),b.css(["{ position:relative;}","%textarea% {color:[txt]; [box] [bg] [rd] resize: none; width:100%  !important; min-height:100px; height:100%; overflow:auto; font-size:14px; border:[brw] solid [brd]; box-shadow: 0 1px 1px 0 rgba(0,0,0,.3) inset; }","%textarea%:hover {border-color: [brdh]; }","%textarea%:focus {border-color: [brdf]; }",'[state~="invalid"]:before { content:"!"; position:absolute; text-align:center; bottom:50%; left:-20px; width:20px; height:20px; line-height:20px !important; margin-bottom:-11px; color:#fff; background:#f00; border:2px solid #fff; border-radius:50%; box-shadow:0 1px 3px rgba(0, 0, 0, 0.5); font-size:12px; font-weight:bold; }','[state~="invalid"]:after { content:""; position:absolute; bottom:50%; left:3px; margin:0 0 -7px -2px;color:#fff; text-shadow:1px 1px 3px rgba(0, 0, 0, 0.5); font-size:10px; }'])}),define.skin("wixapps.integration.skins.ecommerce.options.ColorOptionSkin",function(a){var b=a;b.inherits("mobile.core.skins.BaseSkin"),b.skinParams(),b.html('<div skinPart="tooltip" skin="wixapps.integration.skins.ecommerce.options.InfoTipSkin"></div><div class="olo"></div>'),b.css(["%.olo% { height:20px; position:relative; }",'[state~="selected"] %.olo% { box-shadow: inset 0 0 0 1px #444; }','[state~="selected"] %.olo%:after { content:"\\25BC";  position:absolute; left:50%; bottom:-7px; margin-left:-4px; color:#444; font-weight:bold; font-size:8px; font-family:Arial; line-height:1;  }','[state~="disabled"] { display:none; }',"%tooltip%           { min-width:100px !important; margin:-4px 0 0 14px; font-size:12px; text-transform:uppercase; text-align:center; }",'%tooltip%:after     { content:"\\25BC"; position:absolute; left:50%; bottom:-10px; margin-left:-6px;  color:#fffedf; font-size:12px; font-family:Arial; line-height:1; text-shadow:0 1px 2px rgba(0, 0, 0, 0.5); }'])}),define.skin("wixapps.integration.skins.ecommerce.options.InfoTipSkin",function(a){var b=a;b.inherits("mobile.core.skins.BaseSkin"),b.skinParams([{id:"bgcolor",type:Constants.SkinParamTypes.OTHER,defaultValue:"#fffedf"},{id:"txtcolor",type:Constants.SkinParamTypes.OTHER,defaultValue:"#656565"},{id:"fnt",type:Constants.SkinParamTypes.OTHER,defaultValue:'font-family: "Helvetica Neue", "HelveticaNeueW01-55Roma", "HelveticaNeueW02-55Roma", "HelveticaNeueW10-55Roma", Helvetica, Arial, sans-serif; font-size:12px; line-height:16px; '},{id:"shd",type:Constants.SkinParamTypes.BOX_SHADOW,defaultValue:"0 1px 4px rgba(0, 0, 0, 0.6);"},{id:"rd",type:Constants.SkinParamTypes.BORDER_RADIUS,defaultValue:"5px"},{id:"max",type:Constants.SkinParamTypes.OTHER,defaultValue:"min-height:10px; min-width:10px; max-width:300px;"}]),b.html('<div class="toolTipContainer"><p skinPart="content"></p></div>'),b.css(["{  [fnt][rd][shd][max] color:[txtcolor]; background:[bgcolor]; position:absolute;  padding:5px; top:0px; left: 0px;}","p {display:block; margin:0 0 5px 0; }","strong, b, i, big { font-size:12px; }",'[state~="hidden"] {visibility:hidden!important;}'])}),define.skin("wixapps.integration.skins.ecommerce.options.OptionsListInputSkin",function(a){a.inherits("mobile.core.skins.BaseSkin"),a.skinParams([]),a.html(""),a.css(["{position:relative; white-space:normal}"," > div { border:1px solid #444; display:inline-block; min-width:26px; line-height:20px; height:20px; margin:0 3px; text-align:center; text-transform:uppercase; cursor:pointer; }"," > div:last-child { margin-right:0; }",'[state~="invalid"]:before { content:"!"; position:absolute; text-align:center;bottom:50%; left:-20px; width:20px; height:20px; line-height:20px !important; margin-bottom:-11px;color:#fff; background:#f00; border:2px solid #fff; border-radius:50%; box-shadow:0 1px 3px rgba(0, 0, 0, 0.5); font-size:12px; font-weight:bold; }','[state~="invalid"]:after { content:""; position:absolute; bottom:50%; left:3px; margin:0 0 -7px -2px;color:#fff; text-shadow:1px 1px 3px rgba(0, 0, 0, 0.5); font-size:10px; }'])}),define.skin("wixapps.integration.skins.ecommerce.options.SelectOptionsListSkin",function(a){a.inherits("mobile.core.skins.BaseSkin"),a.skinParams([]),a.html('<p skinPart="tooltip"></p><div skinPart="itemsContainer"></div>'),a.css(['[state~="hidden"] %tooltip% {display: none;}','[state~="displayed"] %tooltip% {display: block; width: 100px;}'])}),define.skin("wixapps.integration.skins.ecommerce.options.TextOptionSkin",function(a){a.inherits("mobile.core.skins.BaseSkin"),a.skinParams([]),a.html('<div skinPart="tooltip" skin="wixapps.integration.skins.ecommerce.options.InfoTipSkin"></div><div skinPart="size"/>'),a.css(["{ background:#fff; margin-top:3px !important; }","%size% {  position:relative; }",'[state~="selected"] %size% { box-shadow: inset 0 0 0 1px #444; }','[state~="selected"] %size%:after { content:""; position:absolute; left:50%; bottom:-7px; margin-left:-4px; color:#444; ont-weight:bold; font-size:8px;  font-family:Arial; line-height:1;  }','[state~="disabled"] { display:none; }',"%tooltip%           { min-width:100px !important; margin:-4px 0 0 14px; font-size:12px; text-transform:uppercase; text-align:center; }",'%tooltip%:after     { content:""; position:absolute; left:50%; bottom:-10px; margin-left:-6px;  color:#fffedf; font-size:12px; font-family:Arial; line-height:1; text-shadow:0 1px 2px rgba(0, 0, 0, 0.5); }'])}),define.dataThemeItem("RTInlineAppsToolBar",{type:"TopLevelStyle",skin:"wysiwyg.editor.skins.richtext.ToolBarSkin",metaData:{isPersistent:!1},style:{properties:{"boxShadowToggleOn-shd":!0,dragDisplay:"display:none;",closeDisplay:"display:none;",toolbarMargin:"0;"},groups:{toolbarBackgroundBtn:{properties:{hover:"border:1px solid #ddd !important; background-color:#fff; box-shadow: 0 1px 0 rgba(0,0,0,0.1)",sel:"border:1px solid #fff; background-color:#d5effe; box-shadow: inset 0 1px 0 rgba(0,0,0,0.4)",bgPosition:"1px -19px"},groups:{},propertiesSource:{minWidth:"value",minHeight:"value",icnoWidth:"value",iconHeight:"value",labelDisplay:"value",iconDisplay:"value",hover:"value",sel:"value"}},toolbarBtn:{properties:{hover:"border:1px solid #ddd !important; background-color:#fff; box-shadow: 0 1px 0 rgba(0,0,0,0.1)",sel:"border:1px solid #fff; background-color:#d5effe; box-shadow: inset 0 1px 0 rgba(0,0,0,0.4)"},groups:{},propertiesSource:{minWidth:"value",minHeight:"value",icnoWidth:"value",iconHeight:"value",labelDisplay:"value",iconDisplay:"value",hover:"value",sel:"value",optionsLineHeight:"value"}},ddFontSize:{properties:{optionsWidth:"115px"},groups:{},propertiesSource:{optionsWidth:"value"}},ddStyle:{properties:{optionsWidth:"215px"},groups:{},propertiesSource:{optionsWidth:"value"}},ddFont:{properties:{optionsWidth:"285px"},groups:{},propertiesSource:{optionsWidth:"value"}},ddSize:{properties:{selectPadding:"padding-left:28px;"},groups:{},propertiesSource:{selectPadding:"value"}},shadowBtn:{properties:{hover:"border:1px solid #ddd !important; background-color:#fff; box-shadow: 0 1px 0 rgba(0,0,0,0.1)",sel:"border:1px solid #fff; background-color:#d5effe; box-shadow: inset 0 1px 0 rgba(0,0,0,0.4)",optionsMaxHeight:"261px",optionsMinWidth:"109px",optionsMargin:"5px 0 0 0",optionsLineHeight:"line-height:1;"},groups:{},propertiesSource:{minWidth:"value",minHeight:"value",icnoWidth:"value",iconHeight:"value",labelDisplay:"value",iconDisplay:"value",hover:"value",optionsMargin:"value",optionsLineHeight:"value",sel:"value"}}},propertiesSource:{}}}),define.dataThemeItem("RTAppBuilderToolBar",{type:"TopLevelStyle",skin:"wysiwyg.editor.skins.richtext.ToolBarSkin",metaData:{isPersistent:!1},style:{properties:{"boxShadowToggleOn-shd":!0,dragDisplay:"display:none;",toolbarMargin:"0 20px 0 0;"},groups:{toolbarBackgroundBtn:{properties:{hover:"border:1px solid #ddd !important; background-color:#fff; box-shadow: 0 1px 0 rgba(0,0,0,0.1)",sel:"border:1px solid #fff; background-color:#d5effe; box-shadow: inset 0 1px 0 rgba(0,0,0,0.4)",bgPosition:"1px -19px"},groups:{},propertiesSource:{minWidth:"value",minHeight:"value",icnoWidth:"value",iconHeight:"value",labelDisplay:"value",iconDisplay:"value",hover:"value",sel:"value"}},toolbarBtn:{properties:{hover:"border:1px solid #ddd !important; background-color:#fff; box-shadow: 0 1px 0 rgba(0,0,0,0.1)",sel:"border:1px solid #fff; background-color:#d5effe; box-shadow: inset 0 1px 0 rgba(0,0,0,0.4)"},groups:{},propertiesSource:{minWidth:"value",minHeight:"value",icnoWidth:"value",iconHeight:"value",labelDisplay:"value",iconDisplay:"value",hover:"value",sel:"value",optionsLineHeight:"value"}},ddFontSize:{properties:{optionsWidth:"115px"},groups:{},propertiesSource:{optionsWidth:"value"}},ddStyle:{properties:{optionsWidth:"215px"},groups:{},propertiesSource:{optionsWidth:"value"}},ddFont:{properties:{optionsWidth:"285px"},groups:{},propertiesSource:{optionsWidth:"value"}},ddSize:{properties:{selectPadding:"padding-left:28px;"},groups:{},propertiesSource:{selectPadding:"value"}},shadowBtn:{properties:{hover:"border:1px solid #ddd !important; background-color:#fff; box-shadow: 0 1px 0 rgba(0,0,0,0.1)",sel:"border:1px solid #fff; background-color:#d5effe; box-shadow: inset 0 1px 0 rgba(0,0,0,0.4)",optionsMaxHeight:"261px",optionsMinWidth:"109px",optionsMargin:"5px 0 0 0",optionsLineHeight:"line-height:1;"},groups:{},propertiesSource:{minWidth:"value",minHeight:"value",icnoWidth:"value",iconHeight:"value",labelDisplay:"value",iconDisplay:"value",hover:"value",optionsMargin:"value",optionsLineHeight:"value",sel:"value"}}},propertiesSource:{}}}),define.skin("wixapps.integration.skins.inputs.BUISelectorSkin",function(a){a.inherits("mobile.core.skins.BaseSkin"),a.fields({_tags:[]}),a.skinParams([]),a.html('<div skinPart="bold" skin="wysiwyg.editor.skins.inputs.CheckBoxImageSkin"></div><div skinPart="underline" skin="wysiwyg.editor.skins.inputs.CheckBoxImageSkin"></div><div skinPart="italic" skin="wysiwyg.editor.skins.inputs.CheckBoxImageSkin"></div>'),a.css(["{ margin-left:4px; }","%bold%, %underline%, %italic%{ display:inline-block; }"])}),define.skin("wixapps.integration.skins.inputs.CheckBoxInputInlineSkin",function(a){var b=a;b.inherits("mobile.core.skins.BaseSkin"),b.skinParams([{id:"tdr",type:Constants.SkinParamTypes.URL,defaultTheme:"BASE_THEME_DIRECTORY"},{id:"bg",type:Constants.SkinParamTypes.COLOR_ALPHA,defaultValue:"#ffffff",enableEdit:!0},{id:"brd",type:Constants.SkinParamTypes.COLOR_ALPHA,defaultValue:"#999999",enableEdit:!0},{id:"brw",type:Constants.SkinParamTypes.SIZE,defaultValue:"1px",enableEdit:!0},{id:"shd",type:Constants.SkinParamTypes.BOX_SHADOW,defaultValue:"0 0px 0px rgba(0, 0, 0, 0.0)",enableEdit:!0},{id:"rd",type:Constants.SkinParamTypes.BORDER_RADIUS,defaultValue:"3px",enableEdit:!0},{id:"trns",type:Constants.SkinParamTypes.TRANSITION,defaultValue:"opacity 0.5s ease 0s, border 0.5s ease 0s, color 0.5s ease 0s"},{id:"app",type:Constants.SkinParamTypes.OTHER,defaultValue:"-webkit-appearance:none !important; -moz-appearance:none !important; appearance:none !important;"},{id:"box",type:Constants.SkinParamTypes.OTHER,defaultValue:"box-sizing:border-box; -moz-box-sizing:border-box; -ms-box-sizing:border-box; -webkit-box-sizing:border-box;"}]),b.html('<fieldset class="fieldSet"><input skinPart="checkBox" type="checkbox"/></fieldset><label skinPart="label"></label>'),b.css(["%.fieldSet% { display: inline-block; margin-right: 10px; vertical-align: middle; }","{ position:relative; cursor:pointer; }",'input[type="checkbox"]         { [app][box][rd][shd] width:18px; height:18px; border:[brw] solid [brd]; background:[bg] url([tdr]vi.png) no-repeat -999px -999px; margin:0px; cursor:pointer; }','input[type="checkbox"]:checked { background-position: 50% 50%; }',"p       { [trns][rd] opacity:0; position:absolute; right:0; bottom:18px; width:140px; padding:10px; background:#fff; box-shadow:0 1px 3px rgba(0,0,0,0.6) }",'p:after { content:""; position:absolute; bottom:-12px; right:10px; color:#fff; text-shadow:0 1px 3px rgba(0,0,0,0.6);  }','[state~="invalid"] :hover + p {  opacity:1; color:#d00; }'])
}),define.skin("wixapps.integration.skins.inputs.CheckBoxInputSkin",function(a){var b=a;b.inherits("mobile.core.skins.BaseSkin"),b.skinParams([{id:"tdr",type:Constants.SkinParamTypes.URL,defaultTheme:"BASE_THEME_DIRECTORY"},{id:"bg",type:Constants.SkinParamTypes.COLOR_ALPHA,defaultValue:"#ffffff"},{id:"brd",type:Constants.SkinParamTypes.COLOR_ALPHA,defaultValue:"#aaaaaa"},{id:"rd",type:Constants.SkinParamTypes.BORDER_RADIUS,defaultValue:"3px"},{id:"sz",type:Constants.SkinParamTypes.OTHER,defaultValue:"16px"},{id:"box",type:Constants.SkinParamTypes.OTHER,defaultValue:"box-sizing:border-box !important; -moz-box-sizing:border-box !important; -ms-box-sizing:border-box !important; -webkit-box-sizing:border-box !important;"}]),b.html('<input skinPart="checkBox" type="checkbox"/><div></div><label skinPart="label"></label>'),b.css(["{ position:relative; width:[sz]; height:[sz]; display:inline-block; overflow:visible;}","input[type=checkbox] { position:absolute; top:-9999px; left:-9999px; overflow:visible; }","label { height:[sz]; display:block;  position:absolute; top:0; padding-left:22px; cursor:pointer; font-family: Helvetica, Arial, sans-serif; font-size:12px }","div   { width:[sz]; height:[sz]; border:1px solid [brd]; background:[bg] url([tdr]vi.png) no-repeat -999px -999px; [rd][box]}","input[type=checkbox]:checked ~ div { background-position: 50% 50%; }","input%input%.isPlaceholder{color: #999;}"])}),define.skin("wixapps.integration.skins.inputs.ComboBoxInputSkin",function(a){var b=a;b.inherits("mobile.core.skins.BaseSkin"),b.skinParams([{id:"webThemeDir",type:Constants.SkinParamTypes.URL,defaultTheme:"WEB_THEME_DIRECTORY"},{id:"$borderRadius",type:Constants.SkinParamTypes.BORDER_RADIUS,defaultValue:"4px"},{id:"borderColor",type:Constants.SkinParamTypes.COLOR,defaultValue:"#c4c4c4"},{id:"borderColorOver",type:Constants.SkinParamTypes.COLOR,defaultValue:"#89a4af"},{id:"bgColor",type:Constants.SkinParamTypes.COLOR,defaultValue:"#f9fafc"},{id:"bgColorOver",type:Constants.SkinParamTypes.COLOR,defaultValue:"#f2f3f5"},{id:"bgColorPressed",type:Constants.SkinParamTypes.COLOR,defaultValue:"#f3f3f3"},{id:"shadowColor",type:Constants.SkinParamTypes.COLOR_ALPHA,defaultValue:"0,0,0,.2"},{id:"shadowInsetColor",type:Constants.SkinParamTypes.COLOR_ALPHA,defaultValue:"0,0,0,.7"},{id:"shadowInsetColorOver",type:Constants.SkinParamTypes.COLOR_ALPHA,defaultValue:"255,255,255,.7"}]),b.html('<select skinpart="collection"></select>'),b.css(['::after{content: ""; position: absolute;right: 3px ;top: 2px; color:#3095CB; font-size:25px;}',"%collection% {width: 200px; border: none; -webkit-appearance: none; background-color: transparent; padding: 5px;  cursor:pointer;}","{width:200px; border: 1px solid [borderColor]; [$borderRadius] background:[bgColor] url([webThemeDir]button/button-gradient.png) repeat-x 0 50%; position:relative; text-align:center;}",":hover {border:1px solid [borderColorOver]; background:[bgColorOver] none; box-shadow:0 2px 3px 0 [shadowColor], 0 1px 2px 0 [shadowInsetColorOver] inset; }",'[state~="invalid"]:before { content:"!"; position:absolute; text-align:center;bottom:50%; left:-20px; width:20px; height:20px; line-height:20px !important; margin-bottom:-11px;color:#fff; background:#f00; border:2px solid #fff; border-radius:50%; box-shadow:0 1px 3px rgba(0, 0, 0, 0.5); font-size:12px; font-weight:bold; }','[state~="invalid"]:after { content:""; position:absolute; bottom:50%; left:3px; margin:0 0 -7px -2px;color:#fff; text-shadow:1px 1px 3px rgba(0, 0, 0, 0.5); font-size:10px; }'])}),define.skin("wixapps.integration.skins.inputs.InlineTextInputSkin",function(a){a.inherits("mobile.core.skins.BaseSkin"),a.fields({_tags:[]}),a.skinParams([]),a.html('<div><div skinpart="preview"></div><input skinpart="input" type="text"></div></div>'),a.css(['[state~="preview"] %input% { display: none; }','[state~="input"] %preview% { display: none; }',"%preview%:hover { border:1px solid #C3C3C3; padding:1px 3px; }"])}),define.skin("wixapps.integration.skins.inputs.LocationSelectorSkin",function(a){var b=a;b.inherits("mobile.core.skins.BaseSkin"),b.skinParams([{id:"baseThemeDir",type:Constants.SkinParamTypes.URL,defaultTheme:"BASE_THEME_DIRECTORY"}]),b.html('<div class="clearfix"><div skinpart="container"><input skinpart="address" type="text" /><div skinpart="viewMode"></div></div><div skinpart="message"></div></div>'),b.css(["%container% { height:30px; line-height:30px; padding-right:35px; position:relative; }","%address% { width:100% }","%viewMode% { width:30px; height:30px; position:absolute; right:0px; top:0px; }",'[state~="loading"] %viewMode% { background:transparent url([baseThemeDir]wix_apps/loading.gif) center center no-repeat; }','[state~="error"] %viewMode% { background:transparent url([baseThemeDir]wix_apps/icon_x.png) center center no-repeat; }','[state~="found"] %viewMode% { background:transparent url([baseThemeDir]wix_apps/icon_v.png) center center no-repeat; }','[state~="search"] %viewMode% { background:transparent url([baseThemeDir]wix_apps/spy_glass.png) center center no-repeat; cursor:pointer; }','[state~="invalid"] %message% { height:20px; line-height:20px; color:#d00; font-size:12px; }'])}),define.skin("wixapps.integration.skins.inputs.RichTextEditorSkin",function(a){var b=a;b.inherits("mobile.core.skins.BaseSkin"),b.skinParams([{id:"f0",type:"cssFont",defaultTheme:"font_0",name:"",usedInLogic:!0},{id:"f1",type:"cssFont",defaultTheme:"font_1",name:"",usedInLogic:!0},{id:"f2",type:"cssFont",defaultTheme:"font_2",name:"",usedInLogic:!0},{id:"f3",type:"cssFont",defaultTheme:"font_3",name:"",usedInLogic:!0},{id:"f4",type:"cssFont",defaultTheme:"font_4",name:"",usedInLogic:!0},{id:"f5",type:"cssFont",defaultTheme:"font_5",name:"",usedInLogic:!0},{id:"f6",type:"cssFont",defaultTheme:"font_6",name:"",usedInLogic:!0},{id:"f7",type:"cssFont",defaultTheme:"font_7",name:"",usedInLogic:!0},{id:"f8",type:"cssFont",defaultTheme:"font_8",name:"",usedInLogic:!0},{id:"f9",type:"cssFont",defaultTheme:"font_9",name:"",usedInLogic:!0},{id:"f10",type:"cssFont",defaultTheme:"font_10",name:"",usedInLogic:!0},{id:"$borderRadius",type:Constants.SkinParamTypes.BORDER_RADIUS,defaultValue:"3px"},{id:"shadowColor",type:Constants.SkinParamTypes.COLOR_ALPHA,defaultValue:"0,0,0,.1"}]),b.html('<div skinPart="frame"><div skinPart="richTextContainer" class="richTextContainer"></div></div>'),b.css(["{ background-color:#fff; }","%frame% { [$borderRadius]; border: 1px solid #b4b4b4; box-shadow: 0 1px 1px 0 [shadowColor] inset; padding:2px; position: relative; }","%richTextContainer% { position:relative; width:100%; height:100%; overflow-y:auto; word-wrap: break-word; white-space: normal}"])}),define.skin("wixapps.integration.skins.inputs.SingleLineCheckBoxInputInlineSkin",function(a){var b=a;b.inherits("mobile.core.skins.BaseSkin"),b.skinParams([{id:"tdr",type:Constants.SkinParamTypes.URL,defaultTheme:"BASE_THEME_DIRECTORY"},{id:"bg",type:Constants.SkinParamTypes.COLOR_ALPHA,defaultValue:"#ffffff",enableEdit:!0},{id:"brd",type:Constants.SkinParamTypes.COLOR_ALPHA,defaultValue:"#999999",enableEdit:!0},{id:"brw",type:Constants.SkinParamTypes.SIZE,defaultValue:"1px",enableEdit:!0},{id:"shd",type:Constants.SkinParamTypes.BOX_SHADOW,defaultValue:"0 0px 0px rgba(0, 0, 0, 0.0)",enableEdit:!0},{id:"rd",type:Constants.SkinParamTypes.BORDER_RADIUS,defaultValue:"3px",enableEdit:!0},{id:"trns",type:Constants.SkinParamTypes.TRANSITION,defaultValue:"opacity 0.5s ease 0s, border 0.5s ease 0s, color 0.5s ease 0s"},{id:"app",type:Constants.SkinParamTypes.OTHER,defaultValue:"-webkit-appearance:none !important; -moz-appearance:none !important; appearance:none !important;"},{id:"box",type:Constants.SkinParamTypes.OTHER,defaultValue:"box-sizing:border-box; -moz-box-sizing:border-box; -ms-box-sizing:border-box; -webkit-box-sizing:border-box;"}]),b.html('<fieldset class="fieldSet"><input skinPart="checkBox" type="checkbox"/></fieldset><label skinPart="label"></label>'),b.css(["%.fieldSet% { float: left; display: inline-block; margin-right: 10px; vertical-align: middle; }","{ position:relative; cursor:pointer; }",'input[type="checkbox"]         { [app][box][rd][shd] width:18px; height:18px; border:[brw] solid [brd]; background:[bg] url([tdr]vi.png) no-repeat -999px -999px; margin:0px; cursor:pointer; }','input[type="checkbox"]:checked { background-position: 50% 50%; }',"p      { [trns][rd] opacity:0; position:absolute; right:0; bottom:18px; width:140px; padding:10px; background:#fff; box-shadow:0 1px 3px rgba(0,0,0,0.6); }","%label%  { white-space: nowrap; display: inline-block; overflow: hidden; text-overflow: ellipsis; word-wrap: normal; vertical-align: middle; }",'p:after { content:""; position:absolute; bottom:-12px; right:10px; color:#fff; text-shadow:0 1px 3px rgba(0,0,0,0.6);  }','[state~="invalid"] :hover + p {  opacity:1; color:#d00; }'])}),define.skin("wixapps.integration.skins.inputs.SubmitInputMessageAboveButtonSkin",function(a){var b=a;b.inherits("mobile.core.skins.BaseSkin"),b.skinParams([{id:"$borderRadius",type:Constants.SkinParamTypes.BORDER_RADIUS,defaultValue:"3px"},{id:"shadowColor",type:Constants.SkinParamTypes.COLOR_ALPHA,defaultValue:"0,0,0,.1"}]),b.compParts({button:{skin:"wysiwyg.editor.skins.buttons.ButtonSmallerSkin"}}),b.html('<div class="clearfix"><label skinpart="label"></label><input skinpart="input" type="text" /><div skinpart="message"></div><div class="submitInputContainer"><div skinpart="button"></div></div></div>'),b.css(['[state~="hasLabel"] %label% {display:block; padding-bottom: 5px;}',"input%input% {width:100%; margin:0 0 5px 0; padding: 0 3px; line-height: 1.1em; height: 1.8em; font-size:1em; [$borderRadius]; border: 1px solid #b4b4b4; box-shadow: 0 1px 1px 0 [shadowColor] inset;}","%input%:hover{border-color: #a3d9f6; }","%input%:focus{border-color: #19a0e9; }","%.submitInputContainer%{text-align:right;}","%button% {display:inline-block;}","[disabled] %label% {opacity:0.5;}",'[state~="invalid"] input%input%{background: #f6e0dd; border-color: #de4c3a}','[state~="invalid"] %message% {color: #de4c3a; font-size: .916em;}',"input%input%.isPlaceholder {color: #999; }"])}),define.skin("wixapps.integration.skins.inputs.TextInputWithIconSkin",function(a){var b=a;b.inherits("mobile.core.skins.BaseSkin"),b.skinParams([{id:"webThemeDir",type:"themeUrl",defaultTheme:"WEB_THEME_DIRECTORY"}]),b.html('<div class="clearfix"><label skinpart="label"></label><p class="container"><span class="sepLine"></span><input skinpart="input" type="text"></p><div skinpart="message"></div></div>'),b.css([" .singleLine { white-space:nowrap; display:block; overflow:hidden; text-overflow:ellipsis; word-wrap:normal; }","%.container% { position:relative; background:transparent url([webThemeDir]lists/appbuilder_sprite.png) -558px -19px     no-repeat; font-size: 1em;  border-radius: 3px; border: 1px solid #B4B4B4; border-image: initial; box-shadow: rgba(0, 0, 0, 0.0980392) 0px 1px 1px 0px inset; background-color: #FFF;margin: 0px 0px 5px; cursor:pointer; padding: 0px 3px; padding-left:20px; min-width:1px; min-height:23px; line-height: 23px; vertical-align: middle;}","%input% { border: none; width: 100%; padding-left: 10px; font-size: 14px;}","%.sepLine% { position: absolute; height:19px; top:3px; left: 24px; absolute; width: 1px; border-left: solid 1px #B4B4B4; margin-right: 5px; }"])}),define.skin("wixapps.integration.skins.inputs.TextLinkSkin",function(a){var b=a;b.inherits("mobile.core.skins.BaseSkin"),b.skinParams([{id:"f0",type:"cssFont",defaultTheme:"font_0",name:"",usedInLogic:!0},{id:"f1",type:"cssFont",defaultTheme:"font_1",name:"",usedInLogic:!0},{id:"f2",type:"cssFont",defaultTheme:"font_2",name:"",usedInLogic:!0},{id:"f3",type:"cssFont",defaultTheme:"font_3",name:"",usedInLogic:!0},{id:"f4",type:"cssFont",defaultTheme:"font_4",name:"",usedInLogic:!0},{id:"f5",type:"cssFont",defaultTheme:"font_5",name:"",usedInLogic:!0},{id:"f6",type:"cssFont",defaultTheme:"font_6",name:"",usedInLogic:!0},{id:"f7",type:"cssFont",defaultTheme:"font_7",name:"",usedInLogic:!0},{id:"f8",type:"cssFont",defaultTheme:"font_8",name:"",usedInLogic:!0},{id:"f9",type:"cssFont",defaultTheme:"font_9",name:"",usedInLogic:!0},{id:"f10",type:"cssFont",defaultTheme:"font_10",name:"",usedInLogic:!0}]),b.html(""),b.css(["{ position:relative; cursor:pointer; color:#09f; width:100%; word-wrap: break-word; }"," span { color:#09f; }"," span:hover { text-decoration:underline }"," p { color:#09f; }"," p:hover { text-decoration:underline }"])}),define.skin("wixapps.integration.skins.inputs.TimeInputSkin",function(a){var b=a;b.inherits("mobile.core.skins.BaseSkin"),b.fields({_tags:[]}),b.skinParams([]),b.html('<div class="clearfix"><select skinpart="hours24"></select><select skinpart="hours12"></select><select skinpart="minutes"></select><select skinpart="seconds"></select><select skinpart="ampm"></select><div skinpart="message"></div></div>'),b.css(['[state~="24h"] %hours24% { display: inline; }','[state~="24h"] %hours12% { display: none; }','[state~="24h"] %ampm% { display: none; }','[state~="12h"] %hours24% { display: none; }','[state~="12h"] %hours12% { display: inline; }','[state~="12h"] %ampm% { display: inline; }','[state~="hours"] %minutes% { display: none; }','[state~="hours"] %seconds% { display: none; }','[state~="half-hour"] %seconds% { display: none; }','[state~="quarter-hour"] %seconds% { display: none; }','[state~="minutes"] %minutes% option { display: inline; }','[state~="minutes"] %seconds% { display: none; }','[state~="allowEmpty"] option.empty { display: inline; }','[state~="hideEmpty"] option.empty { display: none; }',"%message% { visibility:hidden; height:20px; line-height:20px; color:#d00; font-size:12px; }",'[state~="invalid"] %message% { visibility:visible; }'])}),define.Class("wixapps.integration.utils.FlexBoxIESupport",function(a){var b=a;b.binds(["_ie_recalcFlexes","_ie_onAppPartResize","_ie_resizeHandler"]),b.statics({_boxProxies:[]}),b.fields({_boxFlexes:[],_boxFlexList:[],_ie_boxAlignCssMap:{vertical:{start:"left",center:"center",end:"right"},horizontal:{start:"top",center:"middle",end:"bottom",baseline:"baseline"}}}),b.methods({initialize:function(){},_boxFlexes:[],_boxFlexList:[],_ie_boxAlignCssMap:{vertical:{start:"left",center:"center",end:"right"},horizontal:{start:"top",center:"middle",end:"bottom",baseline:"baseline"}},applyIESupport:function(){this._applyDisplayStyle=this._ie_applyDisplayStyle,this._processBoxFlex=this._ie_processBoxFlex,this._finalizeLayout=this._ie_recalcFlexes,this._ie_replaceResizeEventMechanism(this._element),Array.forEach(this._element.children,function(a){this._ie_replaceResizeEventMechanism(a)}.bind(this)),this._registerResizeListeners();var a=this._getParentBoxProxies();0===a.length&&(this.addEvent(Constants.WixAppEvents.APP_PART_RESIZE,this._ie_onAppPartResize),this._finalizeLayout=this._ie_onAppPartResize),window._boxProxies=window._boxProxies||[],window._boxProxies.push({proxy:this,depth:a.length})},_ie_replaceResizeEventMechanism:function(a){a.onresize||(a.onresize=function(){a.fireEvent("resize")})},_ie_onAppPartResize:function(){if(this._element){var a=window._boxProxies.sort(function(a,b){return a.depth-b.depth});a.reverse().forEach(function(a){a.proxy._ie_onResize()}),a.forEach(function(a){a.proxy._ie_onResize()})}},_registerResizeListeners:function(){this._element.addEvent("resize",this._ie_resizeHandler),Array.forEach(this._element.children,function(a){a.addEvent("resize",this._ie_resizeHandler)}.bind(this))},_ie_resizeHandler:function(){this._ie_onResize()},_ie_onResize:function(){this._element&&this._ie_recalcFlexes()},_ie_applyDisplayStyle:function(a){var b="horizontal"==a?"inline-block":"block",c="horizontal"==a?"height":"width",d={display:b},e=this._def.getChildValue("box-align"),f=e?this._translateBoxAlignValues(a,e):"start";"horizontal"===a?d["vertical-align"]=this._ie_boxAlignCssMap[a][f]:d["text-align"]=this._ie_boxAlignCssMap[a][f],this._applyToChildren(function(a){a.setStyles(d)}),"height"===c&&"start"==f&&this._ie_stretchChildrenVertically()},_ie_resetChildrenToStretch:function(){this._childrenToStretch&&this._childrenToStretch.forEach(function(a){a.style.height="",a.style["min-height"]="0"})},_ie_stretchChildrenVertically:function(){var a=this._element.getSize().y;this._ie_resetChildrenToStretch(),a>0&&(this._childrenToStretch=this._ie_getChildrenToStretch(),this._ie_getChildrenToStretch().forEach(function(b){b.setStyle("min-height",a-2),b.setStyle("height","100%")}.bind(this)))},_ie_getChildrenToStretch:function(){return Array.filter(this._element.children,function(a){return!a.style.height})},_ie_processBoxFlex:function(a,b){void 0===b["box-flex"]||this._boxFlexList.contains(a)||(this._element.setStyle("white-space","nowrap"),void 0===b["white-space"]&&(b["white-space"]="normal"),this._boxFlexList.push(a),this._boxFlexes.push({element:a,flex:b["box-flex"]})),delete b["box-flex"]},_applyToChildren:function(a){for(var b=0;b<this._element.children.length;b++)a.call(this,this._element.children[b],b,this._element.children.length)},_ie_recalcFlexes:function(){var a=0,b=0,c=0,d=0;this._applyToChildren(function(b){this._boxFlexList.contains(b)||(a+=this._getSize(b,!0))}.bind(this)),b=this._getSize(this._element,!1)-a,this._boxFlexes.forEach(function(a){d+=parseInt(a.flex,10)}),c=b/d,this._boxFlexes.forEach(function(a){this._setSize(a.element,Math.floor(c*a.flex)-1)}.bind(this))},_getSize:function(a,b){var c,d=a.getSize(),e=b===!0?this._getExtraSpace(a,this._orientation):0;return c="horizontal"==this._orientation?d.x+e:d.y+e},_setSize:function(a,b){var c,d=0;d=this._getExtraSpace(a,this._orientation),c="horizontal"==this._orientation?"width":"height";var e=Math.max(b-d,0),f=a.getStyle(c),g=f.contains("%")?1/0:parseInt(f,10);Math.abs(e-g)>1&&a.setStyle(c,e+"px")},_getExtraSpace:function(a,b){var c;return b=b||this._orientation,c="horizontal"==b?(parseInt(a.getComputedStyle("margin-left"),10)||0)+(parseInt(a.getComputedStyle("margin-right"),10)||0):(parseInt(a.getComputedStyle("margin-top"),10)||0)+(parseInt(a.getComputedStyle("margin-bottom"),10)||0)},_getParentBoxProxies:function(){var a=Array.filter(this._element.getParents("[hasproxy]"),function(a){return a.getViewProxy().className.contains("BoxLayoutProxy")});return a.reverse()},dispose:function(){this.removeEvent(Constants.WixAppEvents.APP_PART_RESIZE,this._ie_onAppPartResize),this._element.removeEvent("resize",this._ie_resizeHandler),Array.forEach(this._element.children,function(a){a.removeEvent("resize",this._ie_resizeHandler)}.bind(this)),this.parent()}})}),define.Class("wixapps.integration.utils.FlexShrinkBugDetector",function(a){var b=a;b.utilize(["wixapps.core.utils.WixAppsLogger"]),b.resources(["W.Config"]),b.methods({start:function(a){this._preconditionsValid()&&_.delay(function(){var b=this._findCandidates(a.$view),c=_.filter(b,this._hasTheGruesomeFlexBug).length;if(c>0){var d=new this.imports.WixAppsLogger;d.reportEvent(d.Events.FLEX_SHRINK_BUG_DETECTED,{c1:a._appInstance.getInstanceId(),c2:window.location.href,c3:a.getID(),i1:c})}}.bind(this),1e3)},_preconditionsValid:function(){return(Browser.chrome||Browser.firefox)&&this.resources.W.Config.env.$isPublicViewerFrame},_findCandidates:function(a){var b=[],c=_.reduce(a.getElements("[hasproxy]"),function(a,c){var d=c.getAttribute("vcfield");return _.contains(b,d)?a:a.concat(c)},[]);return _.filter(c,function(a){return"wixapps.integration.proxies.ImageProxy"===a.$viewProxy.className||"wixapps.integration.proxies.VideoProxy"===a.$viewProxy.className})},_hasTheGruesomeFlexBug:function(a){var b=a.getStyle("width");if(_.isNumber(b)||-1===b.indexOf("%")){var c=parseInt(b,10),d=a.getSize().x;return c/d>1.33}return!1}})}),define.Class("wixapps.integration.utils.FunctionCallThrottle",function(a){var b=a;b.statics({createThrottle:function(a,b){var c=!1,d=null;return function(){var e=Array.from(arguments);c?d={args:e,that:this}:(a.apply(this,e),c=!0,window.setTimeout(function(){c=!1,null!==d&&(a.apply(d.that,d.args),d=null)},b))}},debounceFunction:function(a,b){var c=!1,d=null,e=null;return function(){c=!0,d={args:Array.from(arguments),that:this},null!==e&&(window.clearTimeout(e),e=null),e=window.setTimeout(function(){null!==d&&(a.apply(d.that,d.args),d=null),c=!1,e=null},b)}}})}),define.Class("wixapps.integration.utils.GeometryUtils",function(a){var b=a;b.fields({}),b.utilize(["wixapps.core.utils.Map"]),b.methods({calculateBoundaryOverflowSum:function(a,b){var c={width:0,height:0};return this.getOverflowRegions(a,b).forEach(function(a){c.width+=a.left+a.right,c.height+=a.top+a.bottom}),c},getOverflowRegions:function(a,b){var c=new this.imports.Map,d=Array.slice(a.getElementsByTagName("*"));return d.unshift(a),d.forEach(function(a){if(1==a.nodeType&&a.getAttribute("hasproxy")){var d=b.get(a),e=b.get(a.parentNode),f=c.get(a.parentNode);f||(f={container:a.parentNode,left:0,top:0,right:0,bottom:0},c.put(a.parentNode,f)),(d.width>0||d.height>0)&&(d.left<e.left&&(f.left=Math.max(f.left,e.left-d.left)),d.right>e.right&&(f.right=Math.max(f.right,d.right-e.right)),d.top<e.top&&(f.top=Math.max(f.top,e.top-d.top)),d.bottom>e.bottom&&(f.bottom=Math.max(f.bottom,d.bottom-e.bottom)))}}.bind(this)),c.getValues().filter(function(a){return Boolean(a.left||a.right||a.top||a.bottom)})}})}),define.Class("wixapps.integration.utils.ImageListDataUtils",function(a){var b=a;b.utilize(["wixapps.integration.utils.LinksUtils"]),b.resources(["W.Data"]),b.fields({_defaultDataManager:null}),b.methods({initialize:function(a){this._defaultDataManager=a||this.resources.W.Data,this._linksUtils=new this.imports.LinksUtils},createWDataItemFromAppsImageData:function(a,b){b=b||this._defaultDataManager;var c={type:"Image",title:a.title||"",uri:a.src,height:a.height,width:a.width,description:a.description||"",link:"",alt:"",borderSize:""};if(a.link&&"wix:LinkBase"!==a.link._type){var d=this._linksUtils.convertAppsLinkToWLink(a.link,b),e=b.addDataItemWithUniqueId("link",d);c.link="#"+e.id}var f=b.addDataItemWithUniqueId("image",c);return f.dataObject.setMeta("isPersistent",!1),f},createImageListDataFromAppsImagesData:function(a){var b=_.map(a,function(a){return"#"+this.createWDataItemFromAppsImageData(a).id},this);return{type:"ImageList",items:b}},createAppsImageDataFromWData:function(a,b){b=b||this._defaultDataManager;var c=Q.defer(),d={_type:"wix:LinkableImage",title:a.title,src:a.uri,width:parseInt(a.width,10),height:parseInt(a.height,10),description:a.description,link:a.link||null},e=this,f=function(a){d.link=null===a?{_type:"wix:LinkBase"}:e._linksUtils.convertWLinkToAppsLink(a.getData()),c.resolve(d)};return b.getDataItem(d.link,f),c.promise},createAppsImageDataListFromWDataList:function(a,b){var c=_.map(a,function(a){return this.createAppsImageDataFromWData(a.getData(),b||this._defaultDataManager)},this);return Q.all(c)},getWDataItemsFromRefItems:function(a,b){b=b||this._defaultDataManager;var c=_.map(a,function(a){var c=Q.defer();return b.getDataItem(a,function(a){c.resolve(a)}),c.promise}.bind(this));return Q.all(c)}})}),define.Class("wixapps.integration.utils.LayoutGeometryMap",function(a){var b=a;b.utilize(["wixapps.core.utils.Map"]),b.fields({_container:null,_elementMap:null}),b.methods({initialize:function(){this._elementMap=new this.imports.Map},setContainer:function(a){this._container=a,this._elementMap.clear()},get:function(a){var b=this._elementMap.get(a);return void 0===b&&(b=this._createInfo(this._container,a),this._elementMap.put(a,b)),b},updateMap:function(a){this._elementMap.clear();var b=function(a){a.getAttribute("hasproxy")&&this.get(a)}.bind(this);b(a);for(var c=a.getElementsByTagName("*"),d=0;d<c.length;d++)b(c[d])},reset:function(){this._elementMap.clear()},_createInfo:function(a,b){return b.getCoordinates(a)},dispose:function(){this._container=null,this._elementMap.clear()}})}),define.Class("wixapps.integration.utils.LinksUtils",function(a){var b=a;b.statics({LINK_PREFIXES:{PAGE_LINK_PREFIX:"#!",MAILTO_PREFIX:"mailto:"},PROTOCOLS:["http","https"]}),b.methods({convertWLinkToAppsLink:function(a){var b={linkId:a.id};switch(a.type){case"PageLink":b._type="wix:PageLink",b.pageId=a.pageId.substr(1);break;case"ExternalLink":b._type="wix:ExternalLink",b.target=a.target;var c=a.url.split("://");1==c.length&&(c=["http"].concat(c)),b.protocol=c[0],b.address=c[1];break;case"DocumentLink":b._type="wix:DocLink",b.docId=a.docId,b.docName=a.name;break;case"EmailLink":b._type="wix:MailLink",b.email=a.recipient,b.subject=a.subject;break;case"AnchorLink":b._type="wix:AnchorLink",b.anchorName=a.anchorName,b.anchorDataId=a.anchorDataId,b.pageId=a.pageId}return b},convertAppsLinkToWLink:function(a){var b={},c=_.clone(a);if("wix:Link"===c._type){var d=c.href;if("WEBSITE"===c.linkType||d.test(/(:\/\/)|(^\/\/)/))c._type="wix:ExternalLink",c.protocol=d.test(/(.*)(:\/\/)/)?d.match(/(.*)(:\/\/)/)[1]:"",c.protocol=this.PROTOCOLS.contains(c.protocol.toLowerCase())?c.protocol:"",c.address=d.test(/(.*:\/\/)(.*)/)?d.match(/(.*:\/\/)(.*)/)[2]:d;else if(0===d.indexOf(this.LINK_PREFIXES.PAGE_LINK_PREFIX))c._type="wix:PageLink",c.pageId=d.substr(1);else if(0===d.indexOf(this.LINK_PREFIXES.MAILTO_PREFIX)){c._type="wix:MailLink",c.subject="";var e=d.split("?"),f=new RegExp(this.LINK_PREFIXES.MAILTO_PREFIX+"(.*)","g");if(c.email=e[0].match(f)[1],e.length>1){var g=_.find(e,function(a){return 0===a.indexOf("subject=")})||"";g.test(/subject=(.*)/)?g.match(/subject=(.*)/)[1]:""}}}switch(c._type){case"wix:PageLink":b.type="PageLink",b.pageId="#"+c.pageId;break;case"wix:ExternalLink":b.type="ExternalLink",b.url=c.protocol?c.protocol+"://"+c.address:c.address,b.target=c.target;break;case"wix:DocLink":b.type="DocumentLink",b.docId=c.docId,b.name=c.docName;break;case"wix:MailLink":b.type="EmailLink",b.recipient=c.email,b.subject=c.subject;break;case"wix:AnchorLink":b.type="AnchorLink",b.anchorName=c.anchorName,b.anchorDataId=c.anchorDataId,b.pageId=c.pageId;break;default:return null}return b}})}),define.Class("wixapps.integration.utils.MediaTextDataUtils",function(a){var b=a;b.traits(["wysiwyg.viewer.components.traits.MediaTextHandler"]),b.statics({TypesMap:{"wysiwyg.viewer.components.WPhoto":"PhotoPost","wysiwyg.viewer.components.Video":"VideoPost","default":"TextPost"}}),b.methods({createDataItems:function(a){if(a&&a.text){var b=this.getCompPlaceholdersJsonData(a.text);this._createImageWDataItems(b,a),this._createVideoWDataItems(b,a)}},_createImageWDataItems:function(a,b){for(var c=this.getImageJsonDataArray(a),d=0;d<c.length;d++){var e=c[d].dataQuery;if(!this.getDataManager().getDataByQuery("#"+e)){var f=this._createImageWDataItem(e,b.imageList[d]);this._createImagePropertiesItem(e),f.setMeta("isPersistent",!1)}}},getImageJsonDataArray:function(a){return _.filter(a,{componentType:"wysiwyg.viewer.components.WPhoto"})},getVideoJsonDataArray:function(a){return _.filter(a,{componentType:"wysiwyg.viewer.components.Video"})},_createImageWDataItem:function(a,b){var c={type:"Image",uri:b.src,title:b.title,description:"",width:b.width,height:b.height};return this.getDataManager().addDataItemWithId(a,c)},_createVideoWDataItems:function(a,b){for(var c=this.getVideoJsonDataArray(a),d=0;d<c.length;d++){var e=c[d].dataQuery;if(!this.getDataManager().getDataByQuery("#"+e)){var f=this._createVideoWDataItem(e,b.videoList[d]);f.setMeta("isPersistent",!1)}}},_createVideoWDataItem:function(a,b){var c={type:"Video",videoId:b.videoId,videoType:b.videoType};return this.getDataManager().addDataItemWithId(a,c)},getDataManager:function(){return W.Preview?W.Preview.getPreviewManagers().Data:W.Data},convertMediaPostForView:function(a,b){if("MediaPost"!==a.getTypeName())return a;var c=_.clone(a.getValue()),d=this.getMediaPostPseudoType(c.mediaText.text),e=this.cleanText(c.mediaText.text);return c.text.text=e,c._type="TextPost","VideoPost"===d?(c._type="VideoPost",c.video=c.mediaText.videoList[0],c.isHD=!1):"PhotoPost"===d&&(c._type="PhotoPost",c.photo=c.mediaText.imageList[0]),b.createDataItem(c)},updateMediaPostText:function(a){if("MediaPost"===a.getTypeName()){var b=a.getValue(),c=this.cleanText(b.mediaText.text);b.text.text=c,b.text.links=b.mediaText.links,a.setValue(b)}},getMediaPostPseudoType:function(a){var b=this.getCompPlaceholdersJsonData(a),c=this,d=_(b).map(function(a){return c.TypesMap[a.componentType]}).compact().first();return d||this.TypesMap["default"]}})}),define.Class("wixapps.integration.utils.PagingBuffer",function(a){var b=a;b.fields({_locked:!1,_postponed:[],_index:0}),b.methods({lock:function(a){this._locked===!1?(this._locked=!0,a(!1)):this._postponed.push({index:++this._index,closure:a})},unlock:function(){this._locked=!1,this._postponed.length&&this.lock(this._postponed.shift().closure)}})}),define.Class("wixapps.integration.utils.ParagraphClipping",function(a){var b=a,c=1500;b.fields({_reusable:!1,_lastTextContent:null,_lineRectCache:null,_spanList:null,_cache:[],_ellipsisSpan:null,_container:null,_maxWidth:0/0,_maxHeight:0/0,_lastCropIndex:-1,_ellipsisShown:!1}),b.methods({clipParagraph:function(a,b,c,d){if(this._maxWidth!==c||this._maxHeight!==d||a!==this._lastTextContent){this._container=b,this._lastTextContent!==a&&(this._lastTextContent=a,this.rebuildCache(a,b));var e=c-this._maxWidth,f=d-this._maxHeight;this._reusable||this.rebuildCache(a,b),0!==e&&(this._cache=[]),this._maxWidth=c,this._maxHeight=d,isNaN(e)||e>.1*c||f>.1*d?this._cropParagraph(this._spanList,function(){return this._searchBinary(0,this._spanList.length-1)}.bind(this)):e>0||0===e&&f>0?this._cropParagraph(this._spanList,function(){return this._searchSequentially(this._lastCropIndex,1)}.bind(this)):this._cropParagraph(this._spanList,function(){return this._searchSequentially(this._lastCropIndex,-1)}.bind(this))}},rebuildCache:function(a,b){this.resetCache(),this._reusable=!0,this._prepareContent(a,b),this._createEllipsisSpan(b),this._cache=[]},getLastTextContent:function(){return this._lastTextContent},resetCache:function(){this._reusable=!1,this._maxWidth=0/0,this._maxHeight=0/0,this._lastCropIndex=-1},isClipped:function(){return this._ellipsisShown},showEllipsis:function(){this._ellipsisSpan&&this._ellipsisSpan.setStyles({display:"inline"})},hideEllipsis:function(){this._ellipsisSpan&&this._ellipsisSpan.setStyles({display:"none"})},_prepareContent:function(a,b){var c=this.wrapWordsInSpans(a);b.set("html",c),this._spanList=b.getElements("span").filter(function(a){return 1==a.childNodes.length&&3==a.firstChild.nodeType&&a!==this._ellipsisSpan}.bind(this))},_createEllipsisSpan:function(){this._spanList.length>0&&(this._ellipsisSpan=new Element("span"),this._ellipsisSpan.setStyles({position:"absolute"}),this._spanList[this._spanList.length-1].getParent().adopt(this._ellipsisSpan))},_showSpan:function(a){a.setStyle("visibility","visible")},_hideSpan:function(a){a.setStyle("visibility","hidden")},_getSpanRect:function(a){return this._cache[a]||(this._cache[a]=this._spanList[a].getContentRect(this._container)),this._cache[a]},_testPoint:function(a){var b;if(a>=0&&a<this._spanList.length){var c=this._getSpanRect(a);b=c.bottom<=this._maxHeight}else b=!1;return b},_searchSequentially:function(a,b){if(this._testPoint(a)&&!this._testPoint(a+1))return a;var c=a+b;return c>=0&&c<this._spanList.length?this._searchSequentially(a+b,b):-1},_searchBinary:function(a,b){var c=Math.floor((a+b)/2),d=this._testPoint(c);return d&&!this._testPoint(c+1)?c:d?this._searchBinary(c,b):this._searchBinary(a,c)},_cropParagraph:function(a,b){var c;c=this._testPoint(0)===!1?0:this._testPoint(a.length-1)?a.length-1:b(),-1!==c&&(c=this._addEllipsis(c),this._lastCropIndex=c,a.forEach(function(a,b){c>b?this._showSpan(a):this._hideSpan(a)}.bind(this)),!this._ellipsisShown&&this._spanList[c]&&this._showSpan(this._spanList[c]))},_addEllipsis:function(a){if(a>=0&&a<this._spanList.length-1){this._ellipsisShown=!0;var b=this._spanList[a];this._ellipsisSpan.set("text",String(b.firstChild.nodeValue)+"...");var c=b.getContentRect(this._container),d=this._getFontStyleShorthand(b),e=b.getStyle("color"),f=this._ellipsisSpan.getStyle("direction");
if(this._ellipsisSpan.setStyles({visibility:"visible",left:"ltr"===f?c.left:"auto",right:"rtl"===f?this._maxWidth-c.right:"auto",top:c.top,font:d,color:e}),this._ellipsisSpan.getContentRect(this._container).right>this._maxWidth)return this._addEllipsis(a-1)}else this._ellipsisShown=!1,this._ellipsisSpan&&this._ellipsisSpan.setStyles({visibility:"hidden"});return a},_getFontStyleShorthand:function(a){var b=a.getStyle("font");return b?b.replace(/\/\S+/,"/normal"):Array.reduce(["font-style","font-variant","font-weight","font-size","line-height","font-family"],function(b,c){var d=a.getStyle(c);return"line-height"==c?b+"/normal ":b+" "+d},[])},_limitTextContentLength:function(a){if(a.length>c){var b=a.slice(0,c),d=b.match(/<[^>]*$/);d&&d.length&&(b=b.slice(0,d.index)),d=b.match(/&[^;]*$/),d&&d.length&&(b=b.slice(0,d.index));for(var e=b.match(/<\/?[a-zA-z0-9]+/gi),f=[],g=0;g<e.length;g++){var h=e[g];"/"===h.charAt(1)?f.pop():f.push(h.slice(1))}for(;f.length;)b+="</"+f.pop()+">";return b}return a},wrapWordsInSpans:function(a){for(var b=this._limitTextContentLength(a),c=b.replace(/</g," <").replace(/>/g,"> "),d=c.split(/\s+/),e=this._joinHtmlTags(d),f="",g=0;g<e.length;g++){var h=e[g].trim();f+=h&&h.test(/^[^<>]*$/)?"<span>"+h+"</span> ":h}return f},_joinHtmlTags:function(a){var b,c=[],d="",e="";for(b=0;b<a.length;b++)d=a[b],0!==d.length&&("<"!==d.substr(0,1)||d.contains(">")?">"!==d.substr(-1)?e.length?e+=" "+d:c.push(d.trim()):(e+=" "+d,c.push(e.trim()),e=""):e=d);return c}})}),define.Class("wixapps.integration.utils.ParagraphLinesMap",function(a){var b=a;b.binds(["_isParagraph"]);var c=[/^p$/,/^div$/,/^h\d+$/];b.fields({_lineMap:[],_maxWidth:0,_maxLines:0/0}),b.methods({updateMap:function(a){this._lineMap=this.getContainerRectList(a),this._containerTop=a.getBoundingClientRect().top},getLineNum:function(){return this._lineMap.length},getParagraphHeight:function(a){var b=Math.min(this._lineMap.length,a);return b>0?this._lineMap[b-1].bottom-this._lineMap[0].top+1:0},_isParagraph:function(a){var b=a.tagName.toLowerCase();return Array.some(c,function(a){return b.match(a)})},getContainerRectList:function(a){var b,c=a.getElements("*").filter(this._isParagraph);0===c.length&&(c=[a]);var d=c.reduce(function(a,b){return a.concat(Array.slice(b.children,0))},[]);b=d.length>0?d.reduce(function(a,b){return a.concat(Array.slice(b.getClientRects(),0))},[]):c.reduce(function(a,b){return a.concat(Array.slice(b.getClientRects(),0))},[]),0===b.length&&(b=Array.slice(a.getClientRects()));var e=b.reduce(function(a,b){if(0===a.length)return[b];var c=a.indexOfByPredicate(function(a){var c=b.top<=a.top&&b.bottom>=a.bottom,d=a.top<=b.top&&a.bottom>=b.bottom;return c||d});return-1===c?a.concat(b):(a[c].height<b.height&&(a[c]=b),a)},[]);return e}})}),define.Class("wixapps.integration.utils.PerformanceTracker",function(a){var b=a,c=0,d={},e=[];b.methods({startTracking:function(a,b){var f=c++;return d[f]={label:a,start:(new Date).getTime()},this._markTimeline(this._createStartString(f)),b&&console.profile&&(console.profile(a),d[f].cpuProfileOn=!0),e.push(f),f},endTracking:function(a){var b=d[a];b&&(b.end=(new Date).getTime(),this._markTimeline(this._createEndString(a)),b.cpuProfileOn&&console.profileEnd())},_createEndString:function(a){var b=d[a],c=b.end-b.start;return"[ END ] [ "+b.label+" ][ "+c+"ms ][ "+a+" ] "},_createStartString:function(a){{var b=d[a];b.end-b.start}return"[ START ] [ "+b.label+" ][ "+a+" ] "},_markTimeline:function(a){console.markTimeline?console.markTimeline(a):console.timeStamp&&console.timeStamp(a)},printReport:function(a){for(var b=0;b<e.length;b++){var c=e[b],f=d[c];if(f){if(a&&f.label!=a)return;var g=f.end-f.start;console.log(c+"[ "+f.label+"] took "+g)}}},clearTimeTracking:function(){}})}),define.Class("wixapps.integration.utils.ProxySelector",function(a){var b=a;b.inherits("bootstrap.utils.Events"),b.binds(["_onMouseMove","_onContentSelectorDblClick","_onContentSelectorDown"]),b.statics({SELECTION_ACTION:"selectionAction",ACTION_MOUSE_DOWN:"actionMouseDown",ACTION_DOUBLE_CLICK:"actionDoubleClick",ACTION_ROLL_OVER:"actionRollOver"}),b.fields({_editedComponent:null,_selectionFilter:null,_editBoxView:null,_stopClickPropagation:!1}),b.methods({activateProxySelector:function(a,b){this._editedComponent=a,this._selectionFilter=b;var c=this._getEditingLayer();c.addEvent(Constants.CoreEvents.MOUSE_DOWN,this._onContentSelectorDown),c.addEvent("dblclick",this._onContentSelectorDblClick)},deactivateProxySelector:function(){var a=this._getEditingLayer();a.removeEvent(Constants.CoreEvents.MOUSE_DOWN,this._onContentSelectorDown),a.removeEvent("dblclick",this._onContentSelectorDblClick),this._editedComponent=null,this._selectionFilter=null},deactivateProxySelectorIfActivated:function(){var a=this._getEditingLayer();a&&this.deactivateProxySelector()},stopClickPropagation:function(){this._stopClickPropagation=!0},enableClickPropagation:function(){this._stopClickPropagation=!1},_getEditingLayer:function(){return $$("#editorUI")[0].getLogic().getSkinPart("editLayer").getSkinPart("componentEditBox")},_getRelatedComponents:function(a){var b=a.getViewProxy().getViewDefinition(),c=this._editedComponent.getSkinPart("inlineContent").getElements("[hasproxy]");return c.filter(function(a){return a.getViewProxy().getViewDefinition()===b})},_calcComponentCoordinates:function(a){return a.getCoordinates()},_isInside:function(a,b){return a.x>=b.left&&a.x<=b.right&&a.y>=b.top&&a.y<=b.bottom},_filterByPosition:function(a,b){var c=this._calcComponentCoordinates(b);if("span"===b.get("tag")){var d=b.getClientRects(),e=window.getScroll();return Array.map(d,function(a){return a=Object.clone(a),a.top+=e.y,a.bottom+=e.y,a}).some(function(b){return this._isInside(a,b)}.bind(this))}return this._isInside(a,c)},_listElements:function(a,b){var c=[],d=b.getChildren();return Array.forEach(d,function(b){var d=!1;this._filterByPosition(a,b)?(c.push(b),d=!0):("absolute"===b.getStyle("position")||"a"==b.get("tag"))&&(d=!0),d&&(c=c.concat(this._listElements(a,b)))}.bind(this)),c},_findComponents:function(a){if(!a)return[];var b=this._listElements(a,this._editedComponent.getSkinPart("inlineContent"));return b.reverse().filter(function(a){return a.hasAttribute("hasproxy")}).map(function(a){return a.getViewProxy()}).filter(this._selectionFilter)},_onMouseMove:function(a){this._handleMouseAction(a,this.ACTION_ROLL_OVER)},_onContentSelectorDown:function(a){this._stopClickPropagation&&(a.stopPropagation(),a.preventDefault()),this._handleMouseAction(a,this.ACTION_MOUSE_DOWN)},_onContentSelectorDblClick:function(a){this._handleMouseAction(a,this.ACTION_DOUBLE_CLICK)},_handleMouseAction:function(a,b){var c=this.injects().Preview.editorToPreviewCoordinates(a.client),d=this._findComponents(c);d.length>0&&this._sendNotification(b,d)},_sendNotification:function(a,b){this.fireEvent(this.SELECTION_ACTION,{action:a,proxyList:b})}})}),define.Class("wixapps.integration.utils.RichTextClippingUtils",function(a){var b=a;b.methods({findClippedText:function(a,b,c,d){this._findClippedTextCommon(a,b,function(a){return this._isAcceptableSize(a,c,d)}.bind(this))},findClippedTextByLines:function(a,b,c,d){this._findClippedTextCommon(a,b,function(a){return this._isAcceptableByLines(a,c,d)}.bind(this))},_findClippedTextCommon:function(a,b,c){var d=a.replace(/</g," <").replace(/>/g,"> "),e=d.split(/\s+/),f=this._joinHtmlTags(e);this._findClippedTextRecursive(f,b,c,0,f.length,0)},_joinHtmlTags:function(a){var b,c=[],d="",e="";for(b=0;b<a.length;b++)d=a[b],0!==d.length&&(/<\/\w+>/.test(d)?c[c.length-1]+=d:"<"!==d.substr(0,1)||d.contains(">")?">"!==d.substr(-1)?e.length?e+=" "+d:c.push(d):(e+=" "+d,c.push(e),e=""):e=d);return c},_findClippedTextRecursive:function(a,b,c,d,e,f){for(var g,h=Math.floor((d+e)/2),i=Boolean(h<a.length-1),j=i?a.slice(0,h):a;/<.+>/.test(j[j.length-1]);)g=j.pop(),"<"!==g.charAt(0)&&j.push(g.split("<")[0]);var k=j.join(" ").concat(i?"...":"");if(b.set("html",k),15>f){var l=c(b);if(1==l)return this._findClippedTextRecursive(a,b,c,d,h,f+1),void 0;if(-1==l)return this._findClippedTextRecursive(a,b,c,h,e,f+1),void 0}"..."==b.get("text")&&b.set("text","")},_isAcceptableSize:function(a,b,c){var d=0,e=this.getContainerRectList(a);if(e.length>0){var f=e[e.length-1].bottom-e[0].top,g=e[e.length-1].width;f>c?d=1:c-f>20?d=-1:.9>g/b&&(d=-1)}return d},_isAcceptableByLines:function(a,b,c){var d=0,e=this.getContainerRectList(a);if(e.length>0){var f=e[e.length-1].width;e.length>c?d=1:e.length<c?d=-1:.9>f/b&&(d=-1)}return d},getMinimalHeight:function(a,b){var c=this.getContainerRectList(a);if(c.length>=b)return c[b-1].bottom-c[0].top;var d=(c[c.length-1].bottom-c[0].top)/c.length;return Math.round(d*b)},getContainerRectList:function(a){var b,c=a.getElements("*").filter(function(a){return"block"==a.getStyle("display")});0===c.length&&(c=[a]);var d=c.reduce(function(a,b){return a.concat(Array.slice(b.children,0))},[]);b=d.length>0?d.reduce(function(a,b){return a.concat(Array.slice(b.getClientRects(),0))},[]):c.reduce(function(a,b){return a.concat(Array.slice(b.getClientRects(),0))},[]),0===b.length&&(b=Array.slice(a.getClientRects()));var e=b.reduce(function(a,b){if(0===a.length)return[b];var c=a.indexOfByPredicate(function(a){var c=b.top<=a.top&&b.bottom>=a.bottom,d=a.top<=b.top&&a.bottom>=b.bottom;return c||d});return-1===c?a.concat(b):(a[c].height<b.height&&(a[c]=b),a)},[]);return e}})}),define.Class("wixapps.integration.utils.SelectionMarker",function(a){var b=a;b.fields({_markedElements:[]}),b.methods({markSelectedSubComponent:function(a){this.markSingleComponent(a),this._tooltipShown===!1&&(this._tooltipShown=!0)},unmarkSelectedSubComponent:function(){this._markedElements.forEach(this.unMarkSingleComponent),this._markedElements=[]},getMarkedElements:function(){return this._markedElements},markSingleComponent:function(a,b){var c=2;"inline"===a.getStyle("display")&&(c=0),a.setStyles({"outline-style":"dashed","outline-width":"1px","outline-color":b===!0?this._selectionEditColor:this._selectionRollOverColor,"outline-offset":c+"px"}),this._markedElements.push(a)},unMarkSingleComponent:function(a){a.setStyles({outline:"none"})},initUIColors:function(a,b){var c=a.getPropertiesAccordingToType("color"),d=c.map(function(b){return a.getProperty(b)}),e=this._getParentCompBgColor(a,b)||this._getDocumentBgColor(a);if(e){var f=this._getHighlightColors(e,d);this._selectionRollOverColor=f[0],this._selectionEditColor=f[1]}else this._selectionRollOverColor="#999",this._selectionEditColor="#333"},_getParentCompBgColor:function(a,b){var c="",d=b.getParentComponent();if(d&&d.getStyle()){var e=d.getStyle(),f=(e.get||e.getProperty).call(d.getStyle(),"bg");if(f){var g=e.getPropertySource("bg");"theme"==g?c=a.getProperty(f):"value"==g&&(c=f)}}return c},_getDocumentBgColor:function(a){var b,c=a.getProperty("siteBg");return c&&(b=c.getColorReference()),a.getProperty(b||"color_0")},_getHighlightColors:function(a,b){var c=this,d=b.map(function(b){return{color:b,contrast:c._getContrastValue(b,a)}}).sort(function(a,b){return b.contrast-a.contrast}).map(function(a){return a.color.toString()}).filter(function(a,b,c){return!c.slice(0,b).contains(a)});return[d[2],d[4]]},_getContrastValue:function(a,b){return Math.abs(a._l-b._l)}})}),define.Class("wixapps.integration.utils.WindowOpener",function(a){var b=a;b.statics({_defaultOptions:{left:100,top:100,height:400,width:300,menubar:!0,toolbar:!0,location:!0,status:!0,resizable:!0,scrollbars:!0},_trueValue:1,_falseValue:0,_createOptionsString:function(a){return _.reduce(a,function(a,b,c){return a+=a.length?",":"",_.isBoolean(b)&&(b=b?this._trueValue:this._falseValue),a+=c+"="+b},"")},open:function(a,b,c){var d=_.merge({},this._defaultOptions,c);return window.open(a,b,this._createOptionsString(d))}})}),define.Class("wixapps.integration.utils.flex.BoxFlexPolyfill",function(a){var b=a;b.utilize(["wixapps.integration.utils.flex.ComputedFlex","wixapps.integration.utils.flex.NativeFlex","wixapps.integration.utils.flex.WebkitFlex","wixapps.integration.utils.flex.FirefoxFlex","wixapps.integration.utils.flex.MSIEFlex"]),b.statics({forceComputedFlex:void 0,forceLegacyFlex:void 0,defaultStyles:{"box-sizing":"border-box","-moz-box-sizing":"border-box"},applyBoxFlexPolyfill:function(a,b){if(!a.$flexPolyfill){if(void 0===this.forceComputedFlex){var c=W.Utils.getQueryParam("forceComputedFlex");this.forceComputedFlex="true"===c}void 0===this.forceLegacyFlex&&(this.forceLegacyFlex="true"===W.Utils.getQueryParam("forceLegacyFlex"));var d=this.createFlexPolyfill(a,b);this._applyPolyfillToElement(a,d)}},_applyPolyfillToElement:function(a,b){a.$flexPolyfill=b,this.defaultStyles&&a.setStyles(this.defaultStyles);var c=a.setStyle.bind(a);a.setStyle=function(a,d){b.setStyle(a,d,c)};var d=a.getStyle.bind(a);a.getStyle=function(a){return b.hasCachedStyle(a)?b.getCachedStyle(a):d(a)};var e=a.getSize.bind(a);a.getSize=function(){var c=b.getCachedStyle("width"),d=b.getCachedStyle("height");if(c&&(_.isNumber(c)||-1!==c.indexOf("px"))&&d&&-1!==(_.isNumber(d)||d.indexOf("px"))){var f=a.isVisible();return{x:f?parseInt(c,10):0,y:f?parseInt(d,10):0}}return e()}},createFlexPolyfill:function(a,b){var c;if(this.forceComputedFlex||!Modernizr.flexbox&&!Modernizr.flexboxlegacy)c=new this.prototype.imports.ComputedFlex(a);else if(Browser.firefox)c=b?new this.prototype.imports.ComputedFlex(a):Browser.version>=22?new this.prototype.imports.FirefoxFlex(!1):new this.prototype.imports.FirefoxFlex(!0);else{var d=this.forceLegacyFlex===!0||!Boolean(Modernizr.flexbox);c=Browser.chrome||Browser.safari||Browser.Platform.ios?new this.prototype.imports.WebkitFlex(d):W.Utils.isIE()?new this.prototype.imports.ComputedFlex(a):"unknown"===Browser.name&&0===Browser.version?new this.prototype.imports.ComputedFlex(a):new this.prototype.imports.NativeFlex}return c}})}),define.Class("wixapps.integration.utils.flex.ComputedFlex",function(a){var b=a;b.utilize(["wixapps.integration.utils.flex.FlexGeometry"]),b.fields({_element:null,_direction:"column",_flexSuperNode:null,_depth:0,_flexGeometry:null,_flexValue:0/0,_alignment:"",_styleCache:{display:""},_box0:null,_wasStretchPerformed:!1}),b.methods({initialize:function(a){this._element=a},isComputedFlex:function(){return!0},hasPackingSupport:function(){return!1},setStyle:function(a,b,c){this._styleCache[a]=b,"margin"===a?(this._setMargin(b),c(a,b)):"padding"===a?(this._setPadding(b),c(a,b)):"display"!==a||"box"!==b&&"flex"!==b?"box-orient"===a?this._setFlexDirection("horizontal"===b?"row":"column"):"flex-direction"===a?this._setFlexDirection(b):"box-flex"===a||"flex"===a?this.setFlexValue(b):"align-items"==a||"box-align"==a?this._setAlignment(b):c(a,b):this._isFlexDisplay=!0},getSize:function(a){if("x"===a){var b=this._getCachedGeomValue("width");return void 0===b&&(b=this._element.getSize().x),b}if("y"===a){var c=this._getCachedGeomValue("height");return void 0===c&&(c=this._element.getSize().y),c}return 0},_getCachedGeomValue:function(a){var b=this.getCachedStyle(a);if(b){if("number"==typeof b)return b;if(b.indexOf("px")>-1)return parseInt(b,10)}return void 0},_setPadding:function(a){this._styleCache["padding-left"]=a,this._styleCache["padding-top"]=a,this._styleCache["padding-right"]=a,this._styleCache["padding-bottom"]=a},_setMargin:function(a){this._styleCache["margin-left"]=a,this._styleCache["margin-top"]=a,this._styleCache["margin-right"]=a,this._styleCache["margin-bottom"]=a},getCachedStyle:function(a){return this._styleCache[a]},hasCachedStyle:function(a){return void 0!==this._styleCache[a]},clearCachedStyle:function(a){a?delete this._styleCache[a]:this._styleCache={}},getFlexProperties:function(){if(this._element.parentNode.$flexPolyfill){var a=this._element.parentNode.$flexPolyfill.getDirection();return"column"===a?["height","min-height"]:["width"]}return[]},getFlexValue:function(){return this._flexValue},setFlexValue:function(a){if(a=parseInt(a,10),!a&&this._flexValue){var b=this._element.parentNode.$flexPolyfill.getDirection();"row"===b?this._element.style.width="initial":"column"===b&&(this._element.style.height="",this._element.style["min-height"]="")}this._flexValue=a},getDirection:function(){return this._direction},updateGeometry:function(){var a=this._performGeometryUpdateStep();a&&window.requestAnimFrame(function(){this._performGeometryUpdateStep()}.bind(this))},_performGeometryUpdateStep:function(){this._flexGeometry=this._flexGeometry||new this.imports.FlexGeometry,this._flexGeometry.clear(),this._updateChildrenStyles();var a=this._updateDescendants();this._traverseDescendants(this._element,function(a){a.parentNode&&a.parentNode.$flexPolyfill&&this._flexGeometry.registerNodeFlexInfo(a,a.$flexPolyfill.getFlexValue(),a.parentNode.$flexPolyfill.getDirection())}.bind(this)),this.isAutoHeight()&&a.unshift(this._element),this._flexGeometry.recalculateFlexNodes();var b=a.sort(this._autoHeightChildrenSortFunc);return b.forEach(function(a){a.$flexPolyfill.updateAutoHeight()}),a.length>0&&this._flexGeometry.recalculateFlexNodes(),a.length>0},_autoHeightChildrenSortFunc:function(a,b){var c=a.getParents().length,d=b.getParents().length;return d-c},_updateDescendants:function(){var a=[];return this._traverseDescendants(this._element,function(b){b.$flexPolyfill&&(b.$flexPolyfill._updateChildrenStyles(),b.$flexPolyfill.isAutoHeight()&&(b.style.height="",a.push(b)))}),a},_traverseDescendants:function(a,b){for(var c=a.getElementsByTagName("*"),d=0;d<c.length;d++){var e=c[d];e.$flexPolyfill&&b(e)}},_setFlexDirection:function(a){"horizontal"===a&&(a="row"),this._direction!==a&&Array.forEach(this._element.children,function(a){a!==this._box0&&a.$flexPolyfill&&a.$flexPolyfill.clearFlexCache()}),this._direction=a},clearFlexCache:function(){this._flexValue&&this.getFlexProperties().forEach(function(a){this.clearCachedStyle(a)}.bind(this))},_setAlignment:function(a){0===a.indexOf("flex-")&&(a=a.substring(5)),this._alignment!==a&&(this._alignment=a,this._updateChildrenStyles())},_updateChildrenStyles:function(){this._updateBox0(),this._isFlexDisplay&&("row"===this._direction?(this._element.removeClass("flex_vbox"),this._element.addClass("flex_hbox")):(this._element.removeClass("flex_hbox"),this._element.addClass("flex_vbox")));var a=this._getChildCss(),b=""===this._alignment||"stretch"===this._alignment;Array.forEach(this._element.children,function(c){c!==this._box0&&c.setStyles&&c.style&&(b?this._applyCrossAxisStretch(c):this._removeCrossAxisStretch(c),c.setStyles(a))}.bind(this))},isAutoHeight:function(){return"row"===this._direction&&!this.hasCachedStyle("height")},updateAutoHeight:function(){for(var a=0,b=0;b<this._element.children.length;b++){var c=this._element.children[b],d=c.getSize().y;a=Math.max(a,d)}this._element.style.height=a+"px"},_getChildCss:function(){var a={};return this._isFlexDisplay&&(a=this._getAlignmentCss(),a.display="row"===this._direction?"inline-block":"block"),a},_getAlignmentCss:function(){var a={};if("column"===this._direction)switch(this._alignment){case"start":a["margin-left"]="0",a["margin-right"]="auto";break;case"center":a["margin-left"]="auto",a["margin-right"]="auto";break;case"end":a["margin-left"]="auto",a["margin-right"]="0";break;default:a["margin-left"]="",a["margin-right"]=""}else if("row"===this._direction)switch(this._alignment){case"start":a["vertical-align"]="top";break;case"center":a["vertical-align"]="middle";break;case"end":a["vertical-align"]="bottom";break;case"baseline":a["vertical-align"]="baseline";break;default:a["vertical-align"]="top"}return a},_getBox0Css:function(){var a=Object.merge({display:"inline-block",width:0},this._getAlignmentCss());return"middle"===a["vertical-align"]&&(a["vertical-align"]="baseline"),a},_updateBox0:function(){var a=!this._box0&&this._element.children.length>0||this._box0&&this._element.children.length>1,b="row"===this._direction&&a;b?(this._box0?this._box0.setStyles(this._getBox0Css()):(this._box0=new Element("div"),this._box0.setStyles(this._getBox0Css()),this._element.insertBefore(this._box0,this._element.children[0])),this._box0.setStyle("height",this._determineBox0Height())):this._box0&&(this._box0.parentNode&&this._box0.parentNode.removeChild(this._box0),this._box0=null)},_determineBox0Height:function(){switch(this._alignment){case"center":return"50%";case"end":return"100%";default:return"0"}},_applyCrossAxisStretch:function(a){var b,c,d="row"==this._direction?"height":"width";a.$flexPolyfill?(b=a.$flexPolyfill.hasCachedStyle(d),c="absolute"!==a.$flexPolyfill.getCachedStyle("position")):(b=!0,c=!1),!b&&c&&(a.setStyle(d,"100%"),this._wasStretchPerformed=!0)},_removeCrossAxisStretch:function(a){var b="row"==this._direction?"height":"width";this._wasStretchPerformed&&"100%"===a.style[b]&&(a.style[b]="")}})}),define.Class("wixapps.integration.utils.flex.FirefoxFlex",function(a){var b=a;b.inherits("wixapps.integration.utils.flex.NativeFlex"),b.fields({_supportPacking:!1}),b.methods({initialize:function(a){var b;b=a?{display:{box:"-moz-box",flex:"-moz-box"},"box-orient":{_propName_:"-moz-box-orient"},"flex-direction":{_propName_:"-moz-box-orient",column:"vertical",row:"horizontal"},"box-flex":{_propName_:"-moz-box-flex",none:0},flex:{_propName_:"-moz-box-flex"},"align-items":{_propName_:"-moz-box-align","flex-start":"start",center:"center","flex-end":"end","flex-baseline":"baseline"},"box-align":{_propName_:"-moz-box-align"},"justify-content":{_propName_:"-moz-box-pack"},"border-radius":{_propName_:"-moz-border-radius"},"box-shadow":{_propName_:"-moz-box-shadow"}}:{display:{box:"flex",flex:"flex"},"box-orient":{_propName_:"flex-direction",horizontal:"row",vertical:"column"},"flex-direction":{_propName_:"flex-direction"},"box-flex":{_propName_:"flex"},flex:{_propName_:"flex"},"align-items":{_propName_:"align-items"},"box-align":{_propName_:"align-items",start:"flex-start",center:"center",end:"flex-end",baseline:"baseline"},"justify-content":{_propName_:"justify-content"}},this.parent(b),this._supportPacking=!a},hasPackingSupport:function(){return this._supportPacking}})}),define.Class("wixapps.integration.utils.flex.FlexGeometry",function(a){var b=a;b.utilize(["wixapps.core.utils.Map"]),b.fields({_nodeMap:null,_containerMap:null,_enableBorderWidth:!0}),b.methods({initialize:function(){this._nodeMap=new this.imports.Map,this._containerMap=new this.imports.Map},clear:function(){this._nodeMap.clear(),this._containerMap.clear()},registerNodeFlexInfo:function(a,b,c){if(b=parseInt(b,10)){var d={element:a,flexValue:b};this._nodeMap.put(a,d);var e=a.parentNode,f=this._containerMap.get(e);void 0===f&&(f={element:e,depth:this._getElementDepth(e),direction:c},this._containerMap.put(e,f)),d.containerInfo=f,d.flexProperties=this._getFlexProperties(f)}else this._removeNodeFromMap(a)},_getElementDepth:function(a){return a.parentNode?this._getElementDepth(a.parentNode)+1:0},_removeNodeFromMap:function(a){this._nodeMap.remove(a);var b=a.parentNode;this._nodeMap.getValues().some(function(a){return a.containerInfo.element===b})||this._containerMap.remove(b)},_getFlexProperties:function(a){var b=a.direction;return"column"===b?["height","min-height"]:["width"]},recalculateFlexNodes:function(){this._containerMap.getValues().forEach(function(a){a.extraSpace=0/0,a.flexSubTotal=0});var a=this._nodeMap.getValues().filter(function(a){return!a.element.isCollapsed()}).sort(function(a,b){return a.containerInfo.depth-b.containerInfo.depth});a.forEach(function(a){a.containerInfo.flexSubTotal+=a.flexValue,a.flexProperties.forEach(function(b){a.element.setStyle(b,"")})}),a.forEach(function(a){var b=a.containerInfo.direction;isNaN(a.containerInfo.extraSpace)&&(a.containerInfo.extraSpace=this._getContainerExtraSpace(a.containerInfo.element,b));var c=a.flexValue/a.containerInfo.flexSubTotal,d=Math.floor(c*a.containerInfo.extraSpace)-this._getMargins(a.element,b);d=Math.max(d,0),a.flexProperties.forEach(function(b){a.element.setStyle(b,d)})}.bind(this))},_getMargins:function(a,b){var c=0,d=0;return a.$flexPolyfill&&("row"===b?(c=a.$flexPolyfill._getCachedGeomValue("margin-left")||0,d=a.$flexPolyfill._getCachedGeomValue("margin-right")||0):(c=a.$flexPolyfill._getCachedGeomValue("margin-top")||0,d=a.$flexPolyfill._getCachedGeomValue("margin-bottom")||0)),c+d},_getContainerExtraSpace:function(a,b){var c="row"===b?"x":"y",d=0,e=0;"row"===b?(d=parseInt(a.getStyle("border-left-width"),10)+parseInt(a.getStyle("border-right-width"),10),a.$flexPolyfill&&(e=parseInt(a.$flexPolyfill.getCachedStyle("padding-left")||0,10)+parseInt(a.$flexPolyfill.getCachedStyle("padding-right")||0,10))):(d=parseInt(a.getStyle("border-top-width"),10)+parseInt(a.getStyle("border-bottom-width"),10),a.$flexPolyfill&&(e=parseInt(a.$flexPolyfill.getCachedStyle("padding-top")||0,10)+parseInt(a.$flexPolyfill.getCachedStyle("padding-bottom")||0,10)));var f=Array.filter(a.children,function(a){return!this._nodeMap.containsKey(a)&&"absolute"!==a.style.position&&!a.isCollapsed()}.bind(this)).reduce(function(a,d){return d.$flexPolyfill?a+d.$flexPolyfill.getSize(c)+this._getMargins(d,b):a+d.getSize()[c]}.bind(this),0);return Math.max(0,a.getSize()[c]-f-d-e)}})}),define.Class("wixapps.integration.utils.flex.MSIEFlex",function(a){var b=a;b.inherits("wixapps.integration.utils.flex.NativeFlex"),b.fields({}),b.methods({initialize:function(){var a={display:{box:"-ms-flexbox",flex:"-ms-flexbox"},"box-orient":{_propName_:"msFlexDirection",horizontal:"row",vertical:"column"},"flex-direction":{_propName_:"msFlexDirection"},"box-flex":{_propName_:"msFlex"},flex:{_propName_:"msFlex"},"align-items":{_propName_:"msFlexAlign","flex-start":"start","flex-end":"end"},"box-align":{_propName_:"msFlexAlign"},"justify-content":{_propName_:"-ms-flex-pack"}};this.parent(a)}})}),define.Class("wixapps.integration.utils.flex.NativeFlex",function(a){var b=a;b.fields({_cssPropMap:{display:{box:"flex"},"box-orient":{_propName_:"flex-direction",horizontal:"row",vertical:"column"},"box-flex":{_propName_:"flex"},"box-align":{_propName_:"align-items",start:"flex-start",end:"flex-end"}},_styleCache:{display:""}}),b.methods({initialize:function(a){a&&(this._cssPropMap=a)},isComputedFlex:function(){return!1},setStyle:function(a,b,c){var d,e,f=this._cssPropMap[a];f?(d=f.hasOwnProperty("_propName_")?f._propName_:a,e=f.hasOwnProperty(b)?f[b]:b,this._styleCache[d]=e,c(d,e)):(this._styleCache[a]=b,c(a,b))},getCachedStyle:function(a){return this._styleCache[a]},hasCachedStyle:function(a){return void 0!==this._styleCache[a]},hasPackingSupport:function(){return!0},updateGeometry:function(){}})}),define.Class("wixapps.integration.utils.flex.WebkitFlex",function(a){var b=a;b.inherits("wixapps.integration.utils.flex.NativeFlex"),b.fields({}),b.methods({initialize:function(a){var b;b=a?{display:{box:"-webkit-box",flex:"-webkit-box"},"box-orient":{_propName_:"-webkit-box-orient"},"flex-direction":{_propName_:"-webkit-box-orient",column:"vertical",row:"horizontal"},"box-flex":{_propName_:"-webkit-box-flex",none:0},flex:{_propName_:"-webkit-box-flex"},"align-items":{_propName_:"-webkit-box-align","flex-start":"start",center:"center","flex-end":"end",baseline:"baseline"},"box-align":{_propName_:"-webkit-box-align"},"justify-content":{_propName_:"-webkit-box-pack"},"box-shadow":{_propName_:"-webkit-box-shadow"},"border-radius":{_propName_:"-webkit-border-radius"}}:{display:{box:"-webkit-flex",flex:"-webkit-flex"},"box-orient":{_propName_:"-webkit-flex-direction",horizontal:"row",vertical:"column"},"flex-direction":{_propName_:"-webkit-flex-direction"},"box-flex":{_propName_:"-webkit-flex"},flex:{_propName_:"-webkit-flex"},"align-items":{_propName_:"-webkit-align-items"},"box-align":{_propName_:"-webkit-align-items",start:"flex-start",center:"center",end:"flex-end",baseline:"baseline"},"justify-content":{_propName_:"-webkit-justify-content"},"box-shadow":{_propName_:"-webkit-box-shadow"},"border-radius":{_propName_:"-webkit-border-radius"}},this.parent(b)},setStyle:function(a,b,c){("flex"===a||"box-flex"===a)&&c("min-width",0),this.parent.apply(this,arguments)}})});