define.experiment.Class("wixapps.apps.blog.BlogPageConfiguration.BlogAddPages",function(a,b){a.resources(b.merge(["W.Commands"])),a.methods({_getApplicationAppPages:function(a){var b=this.resources.W.Preview.getPreviewManagers().Apps.getApp(a);return b.getAppPages()},_deletePages:function(a,b,c){var d=this,e=0;_.forEach(a,function(a){b(a,function(){e++;var a=d._getApplicationAppPages(c);a.length||d._setApplicationActiveState(c,!1)})})},_getBundledPagesData:function(){var a=this.getBundledPages();if(a){var b=this.resources.W.Preview.getPreviewManagers().Viewer.getPagesData();return _.filter(b,function(b){var c=b.get("appPageId");return c&&_.contains(a,c)})}return[]},_openAllPagesDeletedPopup:function(){this.resources.W.EditorDialogs.openPromptDialog(this.resources.W.Resources.get("EDITOR_LANGUAGE","DELETE_PAGE_LASTPAGE_DIALOG_TITLE"),this.resources.W.Resources.get("EDITOR_LANGUAGE","DELETE_PAGE_LASTPAGE_DIALOG_TEXT"),void 0,this.resources.W.EditorDialogs.DialogButtonSet.OK,function(){})},_openDeleteApprovalPrompt:function(a,b){var c=this.resources.W.Resources.get("EDITOR_LANGUAGE","DELETE_PAGE_DIALOG_TITLE"),d=this.resources.W.Resources.get("EDITOR_LANGUAGE","DELETE_BLOG_PAGE_DIALOG_TEXT");b&&(d+=this.resources.W.Resources.get("EDITOR_LANGUAGE","DELETE_BLOG_PAGE_CONTAINING_TPA_COMPONENTS_TEXT")),this.resources.W.EditorDialogs.openPromptDialog(c,d,void 0,this.resources.W.EditorDialogs.DialogButtonSet.DELETE_CANCEL,function(b){"DELETE"===b.result&&a()})},_getPremiumTPAComponents:function(a){for(var b=null,c=[],d=function(a){return a.isTpa&&a.isPremiumApp()},e=0;e<a.length;e++)b=this.resources.W.Preview.getCompByID(a[e].get("id")),c=c.concat(_.filter(b.getLogic().getPageComponents(),d));return c},handleDeletePage:function(a,b,c){var d=[a].concat(this._getBundledPagesData()),e=W.Editor.getSiteStructure().get("pages");if(e.length===d.length)return this._openAllPagesDeletedPopup(),void 0;var f=a.get("appInnerID"),g=this._deletePages.bind(this,d,b,f);if(c)g();else{var h=this._getPremiumTPAComponents(d).length>0;this._openDeleteApprovalPrompt(g,h)}}})}),define.experiment.Class("wixapps.core.apprepo.AppPartDefinition.AppBuilderTags",function(a){a.inherits("wixapps.core.apprepo.base.AppRepoItem"),a.traits([]),a.fields({_appInstance:null}),a.methods({initialize:function(a,b){delete this._dataSelector,this._appInstance=a,this.setDataSelectorDef(b.dataSelectorDef),this.setViewName(b.viewName),this.setType(b.type),this.setDisplayName(b.displayName)},getDefinition:function(){return{dataSelectorDef:this._dataSelectorDef,viewName:this._viewName,type:this._type,displayName:this._displayName}},setDataSelectorDef:function(a){this._dataSelectorDef=_.cloneDeep(a)},getDataSelectorDef:function(){return _.cloneDeep(this._dataSelectorDef)},setDataSelectorId:function(a){this._dataSelectorDef.id=a},setDataSelectorPredefinedSettings:function(a){this._dataSelectorDef.predefinedSettings=_.cloneDeep(a)},getDataSelector:function(){return this._appInstance.getDataSelectors().getById(this._dataSelectorDef.id)},clearDataSelectorPredefinedSettings:function(){this._dataSelectorDef.predefinedSettings=null},getDataSelectorId:function(){return this._dataSelectorDef.id}})}),define.experiment.Class("wixapps.core.apprepo.AppPartDefinition.AppRepoRefactor",function(a,b){a.inherits("wixapps.core.apprepo.base.AppRepoItem"),a.traits([]),a.fields({_appInstance:null}),a.methods({initialize:function(a,b){this._appInstance=a,this.setDataSelectorId(b.dataSelector),this.setViewName(b.viewName),this.setType(b.type),this.setDisplayName(b.displayName)},getDefinition:function(){return{dataSelector:this._dataSelector,viewName:this._viewName,type:this._type,displayName:this._displayName}},loadFromDefinition:b.remove(),getSerializableProperties:b.remove()})}),define.experiment.Class("wixapps.core.apprepo.AppPartsRepository.AppBuilderTagsEditor",function(a){a.methods({createAndRegister:function(a,b,c,d){var e=this._createAppPartDefinition(a,b,c,d),f=this.register("apppart",e);return f},_createAppPartDefinition:function(a,b,c,d){var e={type:c,dataSelectorDef:a,viewName:b,displayName:d};return new this.imports.AppPartDefinition(this._appInstance,e)}})}),define.experiment.Class("wixapps.core.apprepo.AppPartsRepository.AppRepoRefactor",function(a){a.methods({_createAppPartDefinition:function(a,b,c,d){var e={type:c,dataSelector:a,viewName:b,displayName:d};return new this.imports.AppPartDefinition(this._appInstance,e)}})}),define.experiment.newClass("wixapps.core.apprepo.AppRepoLocalBackupTransport.WixappsCrashRestore",function(a){var b=a;b.inherits("wixapps.core.apprepo.AppRepoTransport"),b.fields({_calls:null}),b.methods({startTracking:function(){this._calls=[]},_postJsonRequest:function(a,b,c){var d=this._buildPostJsonUrl(a,b);this._calls.push({url:d,payload:c,origin:"AppBuilderRepo"})},stopTracking:function(){var a=this._calls;return this._calls=null,a}})}),define.experiment.Class("wixapps.core.apprepo.ApplicationDefinition.AppBuilderTags",function(a){a.statics({TAGS_KEY:"tags"}),a.methods({getTags:function(){return this._appDef[this.TAGS_KEY]},setTags:function(a){this._appDef[this.TAGS_KEY]=a}})}),define.experiment.Class("wixapps.core.apprepo.ApplicationDefinition.BlinkyFormContainer",function(a){a.statics({FORMS_KEY:"forms",MINI_PARTS_KEY:"miniParts"}),a.methods({getForms:function(){return this._appDef[this.FORMS_KEY]},setForms:function(a){this._appDef[this.FORMS_KEY]=a},getMiniParts:function(){return this._appDef[this.MINI_PARTS_KEY]},setMiniParts:function(a){this._appDef[this.MINI_PARTS_KEY]=a}})}),define.experiment.Class("wixapps.core.apprepo.ApplicationInstance2.AppBuilderDeleteType.New",function(a){a.methods({isStubStore:function(){return this._isStubStore},deleteType:function(a,b,c,d){var e=this,f=function(c){var f=e.getTypesManager().getType(a),g=c;e.getDataProviders().getWixDbDataProvider().deleteType(a);var h=e._dataSelectorsRepo.filterByType(a);_.each(h,function(a){e._dataSelectorsRepo.remove(a.getId())});var i=e._partsRepo.filterByType(a,!1,!0);_.each(i,function(a){e._partsRepo.remove(a.getId())});var j=e._pagesRepo.filterByType(a);_.each(j,function(a){e._pagesRepo.remove(a.getId())});var k=e.getViewDefinitions(),l=k.getViewDefinitionsByType(a),m={appInstance:e,typeName:a,typeObj:f,itemsOfType:g,dataSelectors:h,partDefs:i,pageDefs:j,viewDefs:l};if(!d){var n={c1:a};e._logger.reportEvent(e._logger.Events.APP_BUILDER_USER_DELETED_TYPE,n)}b(m)},g=function(a){e._logger.reportError(a,e.$className,"deleteType",l.SubCategory.APP_BUILDER)};this.getDataProviders().getWixDbDataProvider().query(a,{},{title:1},0,-1,f,g)},restoreType:function(a,b,c,d,e,f){var g=this,h=function(a){g._logger.reportError(a,g.$className,"restoreType",l.SubCategory.APP_BUILDER)};this.getDataProviders().getWixDbDataProvider().restoreType(a,b,function(){},h),_.forEach(c,function(a){g._dataSelectorsRepo.registerWithId(a.getId(),a)}),_.forEach(d,function(a){g._partsRepo.registerWithId(a.getId(),a)}),_.forEach(e,function(a){g._pagesRepo.registerWithId(a.getId(),a)});var i=this._viewsDefRepo.getViewDefinitionsByType(a.name);i.length||_.forEach(f,function(a){g.addViewDefinition(a.getValue())})}})}),define.experiment.Class("wixapps.core.apprepo.ApplicationInstance2.AppBuilderTags",function(a,b){a.utilize(b.merge(["wixapps.core.apprepo.TagsRepository"])),a.fields({_tagsRepo:null,_tagsMapping:null}),a.methods({initialize:b.before(function(){this._tagsRepo=new this.imports.TagsRepository(this)}),toObject:function(){var a=new this.imports.ApplicationDefinition;a.setDataProviders(this._dataProvidersRepo.toObject()),a.setDataSelectors(this._dataSelectorsRepo.toArray()),a.setAppPartDefinitions(this._partsRepo.toObject());var b=this.getDataProviders().getWixDbDataProvider();return a.setTypes(b.getManagedTypes()),a.setTags(this._tagsRepo.toObject()),a.setViewDefinitions(this._viewsDefRepo.toArray()),a.setPages(this._pagesRepo.toObject()),a.setAppInstanceVersion(this.getAppInstanceVersion()),a.toObject()},updateDataSelectors:function(a,b){var c=this._dataSelectorsRepo.getByType(a._type);_.each(c,function(c){c.isListSelector()&&c.updateList(a,b)})},_loadAppData:function(){this._dataProvidersRepo.fromObject(this._appDef.getDataProviders()),this._dataProvidersRepo.isWixDbDataProviderDefined()||this._dataProvidersRepo.createWixDbDataProvider(),this._dataSelectorsRepo.fromArray(this._appDef.getDataSelectors()),this._partsRepo.fromObject(this._appDef.getAppPartDefinitions()),this._tagsRepo.fromObject(this._appDef.getTags()),this.loadViews(this._appDef.getViewDefinitions()),this._pagesRepo.fromObject(this._appDef.getPages()),this.setAppInstanceVersion(this._appDef.getAppInstanceVersion())},getTagsRepo:function(){return this._tagsRepo},getTagsMapping:function(){return this._tagsRepo&&!this._tagsMapping&&(this._tagsMapping=this._dataFactory.createDataItem(this._tagsRepo.toObject())),this._tagsMapping},addTag:function(a){var b=this._tagsRepo.createAndRegister(a);return this._tagsMapping&&this._tagsMapping.setValue(this._tagsRepo.toObject()),b},_migrateDefinitions:function(a){var b=this._viewBuilder,c=_.reduce(a._appDef.views,function(a,c){return a.concat(b._find(c,function(a){return a.textAlign&&a["text-align"]}))},[]);_.each(c,function(a){delete a.textAlign});var d=1,e=this._appDef.getAppPartDefinitions();for(var f in e)if(e.hasOwnProperty(f)){var g=e[f];g.hasOwnProperty("displayName")||(g.displayName="List "+d,d++),_.isString(g.dataSelector)&&(g.dataSelectorDef={id:g.dataSelector},delete g.dataSelector)}}})}),define.experiment.Class("wixapps.core.apprepo.ApplicationInstance2.AppRepoRefactor",function(a){a.methods({registerPageLinkResolver:function(a){var b=this;this.resources.W.Classes.getClass(a.getPageLinkResolverClass(),function(c){b._pageLinkResolvers[a.getId()]=new c(a.getDefinition()),b._pageLinkResolversWaitingList=_.filter(b._pageLinkResolversWaitingList,function(c){return c.appPageId===a.getId()?(c.q.resolve(b._pageLinkResolvers[a.getId()]),!1):!0})})}})}),define.experiment.Class("wixapps.core.apprepo.ApplicationInstance2.BlinkyFormContainer",function(a,b){a.utilize(b.merge(["wixapps.core.apprepo.FormsRepository","wixapps.core.apprepo.MiniPartsRepository"])),a.fields({_formsRepository:null,_miniPartsRepository:null}),a.methods({initialize:b.before(function(){this._formsRepository=new this.imports.FormsRepository(this),this._miniPartsRepository=new this.imports.MiniPartsRepository(this)}),toObject:function(){var a=new this.imports.ApplicationDefinition;a.setDataProviders(this._dataProvidersRepo.toObject()),a.setDataSelectors(this._dataSelectorsRepo.toArray()),a.setAppPartDefinitions(this._partsRepo.toObject());var b=this.getDataProviders().getWixDbDataProvider();return a.setTypes(b.getManagedTypes()),a.setTags(this._tagsRepo.toObject()),a.setViewDefinitions(this._viewsDefRepo.toArray()),a.setPages(this._pagesRepo.toObject()),a.setForms(this._formsRepository.toObject()),a.setForms(this._miniPartsRepository.toObject()),a.setAppInstanceVersion(this.getAppInstanceVersion()),a.toObject()},_loadAppData:function(){this._dataProvidersRepo.fromObject(this._appDef.getDataProviders()),this._dataProvidersRepo.isWixDbDataProviderDefined()||this._dataProvidersRepo.createWixDbDataProvider(),this._dataSelectorsRepo.fromArray(this._appDef.getDataSelectors()),this._partsRepo.fromObject(this._appDef.getAppPartDefinitions()),this._tagsRepo.fromObject(this._appDef.getTags()),this._formsRepository.fromObject(this._appDef.getForms()),this._miniPartsRepository.fromObject(this._appDef.getMiniParts()),this.loadViews(this._appDef.getViewDefinitions()),this._pagesRepo.fromObject(this._appDef.getPages()),this.setAppInstanceVersion(this._appDef.getAppInstanceVersion())},getFormDefinitions:function(){return this._formsRepository},getMiniPartDefinitions:function(){return this._miniPartsRepository}})}),define.experiment.Class("wixapps.core.apprepo.ApplicationInstance2.EditorLoadPerPage",function(a){a.methods({performCleanup:function(a){this._cleanupViewDefinitions(a)},_cleanupViewDefinitions:function(a){try{var b=this.getViewDefinitions(),c=b.toArray(),d=_.unique(_.map(a,function(a){return a.getViewName()})),e=_.filter(c,function(a){return!_.contains(d,a.name)});_.each(e,function(a){b.removeViewDefinition(a),this.setDirty()}.bind(this))}catch(f){var g=this._logger,h=Object.clone(g.Errors.APP_INSTANCE2_CLEANUP_FAILED);h.description=h.description+f,g.reportError(h,this.$className,"_cleanupViewDefinitions",g.SubCategory.APP_BUILDER)}}})}),define.experiment.Class("wixapps.core.apprepo.ApplicationInstance2.ServerPagination",function(a){a.methods({_loadAppData:function(){this._dataProvidersRepo.fromObject(this._appDef.getDataProviders()),this._dataProvidersRepo.isWixDbDataProviderDefined()||this._dataProvidersRepo.createWixDbDataProvider();var a=this._appDef.getDataSelectors(),b=this._appDef.getAppPartDefinitions(),c=this._appDef.getViewDefinitions();this._migratePaginationfromViewsToSelectors(a,b,c),this._dataSelectorsRepo.fromArray(a),this._partsRepo.fromObject(b),this.loadViews(c),this._pagesRepo.fromObject(this._appDef.getPages()),this.setAppInstanceVersion(this._appDef.getAppInstanceVersion())},_migratePaginationfromViewsToSelectors:function(a,b,c){var d=function(a){return"comp.hidePagination"===a.key||"comp.itemsPerPage"===a.key};_.forEach(c,function(c){var e,f,g,h;if(c.comp.items&&c.comp.items.length>0&&"paginatedlist"===c.comp.items[0].id){if(f=c.comp.items[0].comp,void 0===f.hidePagination)return!1;g=_.find(b,{viewName:c.name}),h=_.find(a,{id:g.dataSelector}),"false"===f.hidePagination&&f.itemsPerPage&&(h.limit=parseInt(f.itemsPerPage,10)),delete f.hidePagination,delete f.itemsPerPage,e=_.filter(c.customizations,d),_.pull(c.customizations,e[0],e[1])}})}})}),define.experiment.Class("wixapps.core.apprepo.DataProvidersRepository.AppRepoRefactor",function(a){a.methods({createWixDbDataProvider:function(){var a=new this.imports.WixDbDraftDataProvider(this._appInstance,{});return this.registerWixDbDataProvider(a),a}})}),define.experiment.Class("wixapps.core.apprepo.DataSelectorsRepository.AppBuilderDeleteType.New",function(a){a.methods({getByType:function(a){return this._byType[a]||[]},filterByType:function(a){return this.filter(function(b){return b.getSelectionType()===a})}})}),define.experiment.Class("wixapps.core.apprepo.DataSelectorsRepository.AppRepoRefactor",function(a){a.methods({createInstance:function(a,b,c,d){var e=this._getInstanceClass({logicalTypeName:a}),f=_.merge(d||{},{forType:c,dataProviderId:b.getId()});return new e(this._appInstance,f)},createBasedOnOtherSelector:function(a){var b=this._appInstance.getDataSelectors(),c=a.getLogicalTypeName(),d=a.getDataProvider(),e=a.getSelectionType(),f=a.getDefinition(),g=b.createAndRegister(c,d,e,f);return b.getById(g)}})}),define.experiment.Class("wixapps.core.apprepo.PageDefinition.AppRepoRefactor",function(a,b){a.inherits("wixapps.core.apprepo.base.AppRepoItem"),a.traits([]),a.methods({initialize:function(a,b){this._appInstance=a,this.setLogicClass(b.pageLogicClass),this.setType(b.forType),this.setDisplayName(b.displayName),this.setPageLinkResolverClass(b.pageLinkResolverClass||"wixapps.core.logics.page.SingleItemPageLinkResolver")},getDefinition:function(){return{pageLogicClass:this._pageLogicClass,forType:this._forType,displayName:this._displayName,pageLinkResolverClass:this._pageLinkResolverClass}},loadFromDefinition:b.remove(),getSerializableProperties:b.remove()})}),define.experiment.Class("wixapps.core.apprepo.PageRepository.AppRepoRefactor",function(a){a.methods({createAndRegister:function(a,b,c){var d={displayName:c,forType:b};"singleItem"==a&&(d.pageLogicClass="wixapps.core.logics.page.AppBuilderPageLogic",d.pageLinkResolverClass="wixapps.core.logics.page.SingleItemPageLinkResolver");var e=new this.imports.PageDefinition(this._appInstance,d);return this.registerWithGuid(e)}})}),define.experiment.newClass("wixapps.core.apprepo.TagDefinition.AppBuilderTags",function(a){a.fields({_id:null,_displayName:null}),a.methods({initialize:function(a){this._appInstance=a},loadFromDefinition:function(a){this.setDisplayName(a)},setDisplayName:function(a){this._displayName=a},getDisplayName:function(){return this._displayName},getId:function(){return this._id},setId:function(a){this._id=a},fromObject:function(a){this._displayName=a},toObject:function(){return this._displayName}})}),define.experiment.Class("wixapps.core.apprepo.TagDefinition.AppRepoRefactor",function(a,b){a.inherits("wixapps.core.apprepo.base.AppRepoItem"),a.fields({_displayName:null}),a.methods({initialize:function(a,b){this._appInstance=a,this.setDisplayName(b)},setDisplayName:function(a){this._displayName=a},getDisplayName:function(){return this._displayName},getDefinition:function(){return this._displayName},setId:b.remove(),getId:b.remove(),toObject:b.remove(),fromObject:b.remove(),loadFromDefinition:b.remove()})}),define.experiment.newClass("wixapps.core.apprepo.TagsRepository.AppBuilderTags",function(a){a.inherits("wixapps.core.apprepo.base.BaseRepository"),a.utilize(["wixapps.core.apprepo.TagDefinition"]),a.methods({_getInstanceClass:function(){return this.imports.TagDefinition},createAndRegister:function(a){var b=new this.imports.TagDefinition(this._appInstance);b.setDisplayName(a);var c=this.registerWithGuid(b);return c}})}),define.experiment.Class("wixapps.core.apprepo.TagsRepository.AppRepoRefactor",function(a){a.inherits("wixapps.core.apprepo.base.BaseRepository"),a.utilize(["wixapps.core.apprepo.TagDefinition"]),a.methods({createAndRegister:function(a){var b=new this.imports.TagDefinition(this._appInstance,a);return this.registerWithGuid(b)}})}),define.experiment.Class("wixapps.core.apprepo.base.BaseRepository.AppRepoRefactor",function(a){a.methods({toObject:function(){return _.transform(this._getInstances(),function(a,b){a[b.id]=b.instance.getDefinition()},{})},toArray:function(){return _.map(this._getInstances(),function(a){return a.instance.getDefinition()})},_createInstance:function(a){var b,c=this._getInstanceClass(a);if(!c)throw"No Class found for "+a;return b=new c(this._appInstance,a)}})}),define.experiment.Class("wixapps.core.data.providers.ItemBasedDataProvider.AppRepoRefactor",function(a,b){a.methods({initialize:b.remove(),loadFromDefinition:b.remove()})}),define.experiment.Class("wixapps.core.data.providers.ItemBasedDataProvider.ServerPagination",function(a){a.methods({readItems:function(){throw"not implemented"},query:function(){throw"not implemented"}})}),define.experiment.Class("wixapps.core.data.providers.base.BaseDataProvider.AppRepoRefactor",function(a,b){a.inherits("wixapps.core.apprepo.base.AppRepoItem"),a.traits([]),a.methods({initialize:function(a,b){this._appInstance=a,b&&b.type&&(this._type=b.type),this._loadTypes(a.getTypesManager())},getDefinition:function(){return{type:this._type}},loadFromDefinition:b.remove(),getSerializableProperties:b.remove()})}),define.experiment.Class("wixapps.core.data.providers.wixdb.WixDbBaseDataProvider.AppBuilderTags",function(a){a.methods({_matchSingleValue:function(a,b){if("object"==typeof a){if(a.hasOwnProperty("$in"))return a.$in.contains(b);if(a.hasOwnProperty("$ne"))return b!=a.$ne;if(a.hasOwnProperty("$gt"))return b>a.$gt;if(a.hasOwnProperty("$gte"))return b>=a.$gte;if(a.hasOwnProperty("$lt"))return b<a.$lt;if(a.hasOwnProperty("$lte"))return b<=a.$lte;if(a.hasOwnProperty("$size"))return a.$size==b.length;if(_.isArray(a)){var c=this;return _.any(a,function(a){return c._matchIgnoreType(a,b)})}return this._matchIgnoreType(a,b)}return b==a}})}),define.experiment.Class("wixapps.core.data.providers.wixdb.WixDbBaseDataProvider.AppRepoRefactor",function(a,b){a.methods({initialize:function(a,b){this.parent(a,b),this._localStore=new this.imports.ItemsLocalStore(a.getDataItemFactory()),this._queryStore={},this._logger=a.getLogger(),this._typesManager=a.getTypesManager(),this._api=new this.imports.WixDbTransport(a)},loadFromDefinition:b.remove()})}),define.experiment.Class("wixapps.core.data.providers.wixdb.WixDbBaseDataProvider.ClientTimestamps",function(a,b){a.methods({_translateLoadedItem:b.before(function(a){a._timestamp=a._updatedAt}),_updateRawDataAfterSave:function(a){a._timestamp=a._updatedAt}})}),define.experiment.Class("wixapps.core.data.providers.wixdb.WixDbBaseDataProvider.ServerPagination",function(a){a.methods({readItems:function(a,b,c,d){for(var e={},f=0;f<b.length;f++)e[b[f]]=f;for(var g=function(a,b){return e[a.getChildValue("_iid")]-e[b.getChildValue("_iid")]},h=[],i=0,j=[],k=0;k<b.length;k++){var l=this._localStore.get(b[k]);l?(i++,j.push(l)):h.push(b[k])}var m=function(a,b){j.append(a),j.sort(g),c(j,b)};h.length>0?this.query(a,{_iid:{$in:h}},{},0,-1,!1,m,d):m([])},query:function(a,b,c,d,e,f,g,h){this._willThrowIfTypeDoesNotExist(a);var i=JSON.stringify({typeName:a,filter:b,sort:c,skip:d,limit:e}),j=function(d){var e=[];this._queryStore[i]=1;var f=d.totalCount||-1;d.items.forEach(function(a){a=this._translateLoadedItem(a);var b=a._iid;if(!this._localStore.isItemMarkedAsDeleted(b)){var c=this._localStore.get(b);if(!c||!c.isDirty()){var d=this._localStore.put(b,a);d.resetDirtyFlag(),e.push(d)}}}.bind(this));var h=!1;this._localStore.each(function(c){this._isItemModified(c)&&this._match(a,b,c.getValue(0))&&(h=!0,e.push(c))}.bind(this)),h&&this._sortQueryResults(e,c),g(e,f)}.bind(this);if(this._api.isTempStore()||this._queryStore[i]){var k=this.queryLocalStore(a,b,c,d,e);return g(k),void 0}this._rewriteAndQuery(a,b,c,d,e,f,j,h)},_rewriteAndQuery:function(a,b,c,d,e,f,g,h){this._api.query(a,b,c,d,e,f,g,h)}})}),define.experiment.Class("wixapps.core.data.providers.wixdb.WixDbDraftDataProvider.AppRepoRefactor",function(a){a.methods({initialize:function(a,b){this.parent(a,b),this._dataMigrator=new this.imports.DataMigrator(a.getTypesManager()),this._addAdminTypeMigrations();for(var c=this.getManagedTypes(),d=0;d<c.length;d++)this.adminTypeMigration(c[d])}})}),define.experiment.Class("wixapps.core.data.providers.wixdb.WixDbDraftDataProvider.ClientTimestamps",function(a){a.methods({_getInNewState:function(a){return _.omit(a,"_timestamp","_permissions")},_doesExistOnServer:function(a){return a._timestamp}})}),define.experiment.Class("wixapps.core.data.providers.wixdb.WixDbDraftDataProvider.ServerPagination",function(a){a.methods({_rewriteAndQuery:function(a,b,c,d,e,f,g,h){this._newTypes.contains(a)?g({items:[]}):this._api.query(a,b,c,d,e,f,g,h)}})}),define.experiment.Class("wixapps.core.data.providers.wixdb.WixDbDraftDataProvider.WixappsCrashRestore",function(a,b){a.utilize(b.merge(["wixapps.core.data.providers.wixdb.WixLocalBackupTransport"])),a.methods({initialize:b.after(function(a){this._backupApi=new this.imports.WixLocalBackupTransport(a)}),getBackupData:function(){return this._backupApi.startTracking(),this._saveInternal(this._backupApi,!0),this._backupApi.stopTracking()},save:function(a,b,c){this._saveAndResetFlags(a,b,c,this._api)},_saveInternal:function(a,b,c,d){c=c||function(){},d=d||function(){};for(var e=this._localStore.getItemsMarkedAsDeleted(),f=[],g=0;g<this._createdItemIds.length;g++){var h=this._createdItemIds[g];f.push(this._localStore.get(h))}var i=[];this._localStore.each(function(a,b){this._createdItemIds.contains(b)||i.push(a)}.bind(this)),a.activateBatchMode();try{for(var j=0;j<e.length;j++)a.deleteItem(e[j]);for(var k=0;k<f.length;k++)a.createItem(f[k].getValue(0));for(var l=0;l<i.length;l++)a.updateItem(i[l].getValue(0));a.sendBatchAndDeactivate(b,c,d)}finally{a.discardBatch()}},_saveAndResetFlags:function(a,b,c,d){if(b=b||function(){},c=c||function(){},d.isTempStore())throw"cannot save draft to temp store";this._typeDiffs={},this._newTypes=[],this._deletedTypes=[];var e=function(a,d){for(var e=[],f=null,g=null,h=0;h<a.results.length;h++)if(a.results[h].success){var i=a.results[h].payload,j=d[h];switch(j.name){case"CreateItem":f=Object.clone(j.params.item),f._iid=i.id,this._updateRawDataAfterSave(f,i),g=this._localStore.put(i.id,f),this._createdItemIds.erase(i.id),g.resetDirtyFlag();break;case"UpdateItem":f=Object.clone(j.params.item),this._updateRawDataAfterSave(f,i),g=this._localStore.put(f._iid,f),g.resetDirtyFlag();break;case"DeleteItem":this._localStore.unMarkItemAsDeleted(j.params.itemId)}}else e.push(a.results[h]);e.length>0?c(e,a,d):b(a,d)}.bind(this);this._saveInternal(d,a,e,c)}})}),define.experiment.Class("wixapps.core.data.providers.wixdb.WixDbTransport.AppBuilderTemplateReadFix",function(a){a.methods({_savedOrPublished:function(){return this.resources.W.Config.env.$isPublicViewerFrame?"viewer":this.resources.W.Config.siteNeverSavedBefore()?"viewer":"editor"}})}),define.experiment.Class("wixapps.core.data.providers.wixdb.WixDbTransport.ServerPagination",function(a){a.methods({query:function(a,b,c,d,e,f,g,h){var i=this.resources.W.Utils.AppsUtils.getResourceValueSync("W.Apps"),j=i&&"owner"===i.getUserRole();this.doRequest("Query",{consistentRead:j},{applicationInstanceId:this._appInstance.getInstanceId(),applicationInstanceVersion:this._appInstance.getAppInstanceVersion(),type:a,filter:b,sort:c,skip:d,getTotalCount:f,limit:-1==e?null:e},g,h)}})}),define.experiment.newClass("wixapps.core.data.providers.wixdb.WixLocalBackupTransport.WixappsCrashRestore",function(a){var b=a;b.inherits("wixapps.core.data.providers.wixdb.WixDbTransport"),b.fields({_calls:null}),b.methods({startTracking:function(){this._calls=[]},_postJsonRequest:function(a,b,c){var d=this._buildPostJsonUrl(a,b);this._calls.push({url:d,payload:c,origin:"AppBuilderItems"})},stopTracking:function(){var a=this._calls;return this._calls=null,a}})}),define.experiment.Class("wixapps.core.data.selectors.AllItemsOfTypeDataSelector.AppRepoRefactor",function(a,b){a.methods({getData:function(a){var b=this._virtualArray;this._dataProvider.query(this._forType,{},{title:1},0,-1,function(c){b.setChildren(c),a(b)})},initialize:b.remove(),getItems:b.remove(),getItemIds:b.remove(),getItemIdIndex:b.remove(),getItemIdRealIndex:b.remove()})}),define.experiment.Class("wixapps.core.data.selectors.AllItemsOfTypeDataSelector.ServerPagination",function(a){a.methods({getData:function(a){var b=this._virtualArray;this._dataProvider.query(this._forType,{},{title:1},0,-1,!1,function(c){b.setChildren(c),a(b)})}})}),define.experiment.Class("wixapps.core.data.selectors.ItemDataSelector.AppRepoRefactor",function(a,b){a.inherits("wixapps.core.data.selectors.base.BaseDataSelector"),a.fields({_virtualItem:null}),a.methods({_setItem:function(a){this._virtualArray.setChildren([a]),this._virtualItem=this._virtualArray.getChildByIndex(0)},getItem:b.remove(),getSerializableProperties:b.remove()})}),define.experiment.Class("wixapps.core.data.selectors.ListDataSelector.AppBuilderTags",function(a){a.methods({updateList:function(){}})}),define.experiment.Class("wixapps.core.data.selectors.ListDataSelector.AppRepoRefactor",function(a,b){a.fields({_virtualSelectedItem:null}),a.methods({initialize:function(a,b){this.parent(a,b),this._virtualSelectedItem=this._dataItemFactory.createDataItem({})},addItem:function(){throw"not implemented"},removeItem:function(){throw"not implemented"},getItemIdIndex:function(a){return _.indexOf(this.getItemIds(),a)},getItemIds:function(){return _.map(this._virtualArray.getChildren(),function(a){return a.getChildValue("_iid")})},getSelectedItemIndex:function(){var a=this._virtualSelectedItem.getChildValue("_iid");return this.getItemIdIndex(a)},resetSelectedItem:function(){this._virtualSelectedItem.setValue({})},setSelectedItemByIndex:function(a){if(-1===a)this.resetSelectedItem();else{if(a>=this._virtualArray.getChildrenCount()||-1>a)throw"Can't set selected item at "+a+" index in dataSelector id "+this.getId();var b=this._virtualArray.getChildByIndex(a);this.setSelectedItem(b)}},setSelectedItem:function(a){this._virtualSelectedItem.setValue(a.getValue())},loadFromDefinition:b.remove(),getItems:b.remove(),getAllItems:b.remove(),getItemIdRealIndex:b.remove(),_refresh:b.remove()})}),define.experiment.Class("wixapps.core.data.selectors.ListDataSelector.ServerPagination",function(a){a.fields({_skip:0,_limit:-1}),a.methods({setSelectedItemByIndex:function(a,b){if(-1===a)return this.resetSelectedItem(),void 0;if(a>=this.getTotalCount()||-1>a)throw"Can't set selected item at "+a+" index in dataSelector id "+this.getId();if(this._selectedItemIndex=a,this.paginationEnabled()){var c=this;this.setPageByItemIndex(this._selectedItemIndex,function(d){var e=a-c.getCurrentPageIndex()*c._limit,f=d.getChildByIndex(e);c.setSelectedItem(f),b&&b(f)})}else{var d=this._virtualArray.getChildByIndex(a);this.setSelectedItem(d),b&&b(d)}},initialize:function(a,b){this.parent(a,b),this._limit=b.limit||-1,this._virtualSelectedItem=this._dataItemFactory.createVirtualArray([])},resetSelectedItem:function(){this._virtualSelectedItem&&(this._selectedItemIndex=-1,this._virtualSelectedItem.setChildren([]))},_refresh:function(a,b){a||(a=function(){}),b||(b=function(){});var c=this,d=function(b){for(var d=b.getChildren().length,e=!1,f=0;d>f;f++)if(b.getChildByIndex(f)===c.getSelectedItem()){e=!0;break}e||c.setSelectedItemByIndex(0),a(b)};this.getData(d,b)},setSelectedItem:function(a){this._virtualSelectedItem=this._virtualSelectedItem||this._dataItemFactory.createVirtualArray([]),this._virtualSelectedItem.setChildren([a])},getSelectedItem:function(){return this._virtualSelectedItem&&this._virtualSelectedItem.getRealChildren()[0]},setLimit:function(a){this._limit=a,this.fireEvent("limitChanged",{limit:this._limit,numOfPages:this.getNumofPages()}),this.paginationEnabled()?this.firstPage():this._refresh()},getLimit:function(){return this._limit},getSelectedItemIndex:function(){var a;return this._virtualSelectedItem&&this._virtualSelectedItem.getChildByIndex(0)?(a=this._virtualSelectedItem.getChildByIndex(0).getChildValue("_iid"),this.getItemIdIndex(a)):-1},paginationEnabled:function(){return-1!==this._limit},getTotalCount:function(){return this._virtualArray.getChildrenCount()},getNumofPages:function(){return-1===this._limit||this.getTotalCount()<=this._limit?1:Math.ceil(this.getTotalCount()/this._limit)},_setSkip:function(a,b,c){if(!this.paginationEnabled())throw"pagination is not enabled";var d=this._skip;this._skip=a;var e=this,f=function(a){e.fireEvent("pageChanged",e.getCurrentPage()),b&&b(a)},g=function(a){this._skip=d,c&&c(a)};this._refresh(f,g)},getCurrentPage:function(){return this.getCurrentPageIndex()+1},getCurrentPageIndex:function(){return Math.ceil(this._skip/this._limit)},gotoNextPage:function(){return this.getCurrentPage()>=this.getNumofPages()?this.firstPage():(this._setSkip(this._skip+this._limit),void 0)},gotoPreviousPage:function(){return this._skip<this._limit?this._setPage(this.getNumofPages()):(this._setSkip(this._skip-this._limit),void 0)},setPageByItemIndex:function(a,b,c){this.paginationEnabled()||c&&c("pagination is not enabled");var d=Math.floor(a/this._limit);d!=this.getCurrentPageIndex()?this._setSkip(d*this._limit,b,c):b&&b(this._virtualArray)},_setPage:function(a){if(0>=a||a>this.getNumofPages())throw"page index is out of bounds.  Index: "+a+"number of pages: "+this.getNumofPages();return this._setSkip(this._limit*a-this._limit)},firstPage:function(){this._setSkip(0)},getDefinition:function(){return _.merge(this.parent(),{limit:this._limit})},getAllData:function(a,b){var c=this._skip,d=this._limit;this._skip=0,this._limit=-1,this.getData(a,b),this._skip=c,this._limit=d}})}),define.experiment.Class("wixapps.core.data.selectors.ManualSelectedItemDataSelector.AppRepoRefactor",function(a,b){a.inherits("wixapps.core.data.selectors.ItemDataSelector"),a.methods({initialize:function(a,b){this.parent(a,b),this._itemId=b.itemId},getData:function(a,b){var c=function(b){this._setItem(b),a(this._virtualItem)}.bind(this);this._dataProvider.readItem(this._itemId,c,b)},getDefinition:function(){return _.merge(this.parent(),{itemId:this._itemId})},loadFromDefinition:b.remove(),getItem:b.remove(),_refresh:b.remove(),getSerializableProperties:b.remove()})}),define.experiment.Class("wixapps.core.data.selectors.ManualSelectedListDataSelector.AppBuilderTags",function(a){a.methods({getDefinition:function(){var a=this.parent();
return a.itemIds=this._itemIds,a},getItems:function(a,b){this._dataProvider.readItems(this.getSelectionType(),this._getItemIdsForQuery(),function(b){b.length!==this._getItemIdsForQuery().length&&(this.resources.W.Config.env.$isEditorViewerFrame&&this._logger.reportError(this._logger.Errors.DATA_SELECTOR_MISSING_ITEMS,this.$className,"getItems",this._logger.SubCategory.APP_BUILDER),this._itemIds=_.map(b,function(a){return a.getChildValue("_iid")})),this._virtualArray=this._virtualArray||this._dataItemFactory.createVirtualArray(),this._virtualArray.setChildren(b),this._fireSelectorRefreshed(),a(this._virtualArray)}.bind(this),b)}})}),define.experiment.Class("wixapps.core.data.selectors.ManualSelectedListDataSelector.AppRepoRefactor",function(a,b){a.methods({initialize:function(a,b){this.parent(a,b),this._logger=a.getLogger();var c=_.compact(b.itemIds);c.length!==b.itemIds.length&&(this._logger.reportError(this._logger.Errors.DATA_SELECTOR_CONTAINS_NULL,this.$className,"loadFromDefinition",this._logger.SubCategory.APP_BUILDER),b=_.clone(b),b.itemIds=c),b.hiddenItemIds&&b.hiddenItemIds.length&&(b.itemIds=_.difference(b.itemIds,b.hiddenItemIds)),this._itemIds=b.itemIds},getData:function(a,b){this._dataProvider.readItems(this.getSelectionType(),this._getItemIdsForQuery(),function(b){b.length!==this._getItemIdsForQuery().length&&(this.resources.W.Config.env.$isEditorViewerFrame&&this._logger.reportError(this._logger.Errors.DATA_SELECTOR_MISSING_ITEMS,this.$className,"getItems",this._logger.SubCategory.APP_BUILDER),this._itemIds=_.map(b,function(a){return a.getChildValue("_iid")})),this._virtualArray.setChildren(b),this._fireSelectorRefreshed(),a(this._virtualArray)}.bind(this),b)},getAllData:function(a,b){this.getData(a,b)},removeItem:function(a){var b=this._itemIds.indexOf(a);return b>=0&&(this._itemIds.splice(b,1),this._refresh()),b},getDefinition:function(){return _.merge(this.parent(),{itemIds:this._itemIds})},loadFromDefinition:b.remove(),duplicate:b.remove(),getItems:b.remove(),getAllItems:b.remove(),getItemIdIndex:b.remove(),getItemIdRealIndex:b.remove(),getSerializableProperties:b.remove()})}),define.experiment.Class("wixapps.core.data.selectors.ManualSelectedListDataSelector.ServerPagination",function(a){a.fields({_currentItemIds:null}),a.methods({getTotalCount:function(){return this._itemIds.length},_getItemIdsForQuery:function(){return this.paginationEnabled()?_.clone(this._itemIds).splice(this._skip,this._limit):this._itemIds},getAllData:function(a,b){this._dataProvider.readItems(this.getSelectionType(),this._itemIds,function(b){var c=this._dataItemFactory.createVirtualArray();c.setChildren(b),a(c)}.bind(this),b)}})}),define.experiment.Class("wixapps.core.data.selectors.PageSelectedItemDataSelector.AppRepoRefactor",function(a,b){a.methods({initialize:function(a,b){this.parent(a,b),this._appPageId=b.appPageId},getData:function(a){var b=function(b){this._setItem(b),a(this._virtualItem)}.bind(this);this._getPageLogic(function(a){a.getDisplayedDataItem(b)})},getDefinition:function(){return _.merge(this.parent(),{appPageId:this._appPageId})},loadFromDefinition:b.remove(),getItem:b.remove(),_refresh:b.remove(),getSerializableProperties:b.remove()})}),define.experiment.Class("wixapps.core.data.selectors.SelectedItemDataSelector.AppRepoRefactor",function(a,b){a.fields({_dataSelector:null}),a.methods({initialize:function(a,b){this.parent(a,b),this.setListSelectorId(b.listSelectorId)},setListSelectorId:function(a){this._dataSelector=this._appInstance.getDataSelectors().getById(a)},getData:function(a,b){if(this._dataSelector.isListSelector()){var c=this._dataSelector.getSelectedItem();a(c)}else b("Selector id "+this._dataSelector.getId()+" is not a list selector and can't be used with "+this.getLogicalTypeName()+" selector.")},loadFromDefinition:b.remove(),getItem:b.remove(),getSerializableProperties:b.remove()})}),define.experiment.Class("wixapps.core.data.selectors.SortedListDataSelector.AppRepoRefactor",function(a,b){a.methods({initialize:function(a,b){this.parent(a,b),this._sortField=b.sortField||"title",this._sortAscending=void 0===b.sortAscending?!0:b.sortAscending},updateList:function(a,b){var c=b.getValue();a[this._sortField]!==c[this._sortField]&&this._refresh()},loadFromDefinition:b.remove(),getSerializableProperties:b.remove()})}),define.experiment.Class("wixapps.core.data.selectors.StaticItemDataSelector.AppRepoRefactor",function(a,b){a.methods({initialize:function(a,b){this.parent(a,b),this._dataItem=this._dataItemFactory.createDataItem(b.itemRaw||{})},getDefinition:function(){return _.merge(this.parent(),{itemRaw:this._dataItem.getValue()})},setStaticItem:function(a){this._dataItem.setValue(a)},getData:function(a,b){return this._dataItem?(a(this._dataItem),void 0):(b(),void 0)},getLogicalTypeName:function(){return"IB.StaticItem"},loadFromDefinition:b.remove(),getItem:b.remove(),_createDataItem:b.remove(),getSerializableProperties:b.remove()})}),define.experiment.Class("wixapps.core.data.selectors.TagsFilteredItemsDataSelector.AppRepoRefactor",function(a,b){a.methods({initialize:function(a,b){if(this.parent(a,b),!b.tagIds)throw this.getLogicalTypeName()+" must define tagIds in its definition";this._tagIds=b.tagIds},getData:function(a,b){var c=this._tagIds.length?{_tags:this._tagIds.length>1?{$in:this._tagIds}:_.first(this._tagIds)}:{},d=this,e=function(b){d._virtualArray=d._virtualArray||d._dataItemFactory.createVirtualArray(),d._virtualArray.setChildren(b),d._fireSelectorRefreshed(),a&&a(d._virtualArray)};return 0===this._tagIds.length?(setTimeout(e([]),0),void 0):(this._dataProvider.query(this._forType,c,this.getQuerySortParameter(),0,-1,e,b),void 0)},getAllData:function(a,b){return this.getData(a,b)},loadFromDefinition:b.remove(),getItems:b.remove(),getAllItems:b.remove(),getItemIdIndex:b.remove(),getItemIdRealIndex:b.remove(),getItemIds:b.remove(),getSerializableProperties:b.remove()})}),define.experiment.Class("wixapps.core.data.selectors.TagsFilteredItemsDataSelector.ServerPagination",function(a){a.methods({getData:function(a,b){var c=this._tagIds.length?{_tags:this._tagIds.length>1?{$in:this._tagIds}:_.first(this._tagIds)}:{},d=this,e=function(b){function c(){d.fireEvent("dataSelectorRefreshed")}d._virtualArray=d._virtualArray||d._dataItemFactory.createVirtualArray(),d._virtualArray.addEvent(Constants.DataItemEvents.CHANGE,c),d._virtualArray.setChildren(b),d._virtualArray.removeEvent(Constants.DataItemEvents.CHANGE,c),a(d._virtualArray)};this._dataProvider.query(this._forType,c,this.getQuerySortParameter(),0,-1,!1,e,b)}})}),define.experiment.Class("wixapps.core.data.selectors.base.BaseDataSelector.AppBuilderTags",function(a){a.methods({setPredefinedSettings:function(){throw"Not Implemented"},hasPredefinedSettings:function(){return!1}})}),define.experiment.Class("wixapps.core.data.selectors.base.BaseDataSelector.AppRepoRefactor",function(a,b){a.inherits("wixapps.core.apprepo.base.AppRepoItem"),a.traits([]),a.fields({}),a.methods({initialize:function(a,b){this._appInstance=a,this._dataItemFactory=a.getDataItemFactory(),this._virtualArray=this._dataItemFactory.createVirtualArray(),this._forType=b.forType,this._id=b.id,this.setDataProvider(this._appInstance.getDataProviders().getById(b.dataProviderId))},getData:function(){throw"Not Implemented"},setDataProvider:function(a){this._dataProvider=a},_refresh:function(a,b){a||(a=function(){}),b||(b=function(){}),this.getData(a,b)},getSelectedItemIndex:function(){return-1},loadFromDefinition:b.remove(),getFriendlyName:b.remove(),getSerializableProperties:b.remove()})}),define.experiment.Class("wixapps.core.logics.DescriptorDataEditingModel.Playlist",function(a){a.methods({getPanelSkins:function(){return this._getDescriptorValue(["dataEditing","skins"])},getDisplaySectionListCount:function(){return this._getDescriptorValue(["dataEditing","displaySectionCount"])}})}),define.experiment.Class("wixapps.core.views.ViewBuilder.AppBuilderTagsEditor",function(a){a.methods({_getPaginatedListTemplate:function(){return"PaginatedListTemplate3"}})}),define.experiment.Class("wixapps.core.views.ViewBuilder.BlinkyFormContainer",function(a){a.methods({initialize:function(){if(this._typesManager=new this.imports.TypesManager,this._localizer=new this.imports.AppBuilderLocalizer,this._utils=this.resources.W.Utils.AppsUtils,!Constants)throw"ViewBuilder:: where is Constants?";Constants.AppBuilderViewTemplates&&this.registerTemplates(Constants.AppBuilderViewTemplates),Constants.AppBuilderTemplates&&this.registerBundles(),Constants.FormFieldsTemplates&&this.registerTemplates(Constants.FormFieldsTemplates),Constants.FormTemplates&&this.registerFormBundles(),this._buildTypesTemplateMap()},registerTemplates:function(a){this._registerTypes(a.types),this._registerData(a.data),this._registerViews(a.views),this._registerTemplates(a.templates),this._registerFieldTemplates(a.fieldTemplates)},registerFormBundles:function(){var a=this;_.forOwn(Constants.FormTemplates,function(b){a._registerTypes([b.type]),a._registerTemplates([b.template])})},getFormTemplateDefinition:function(a){var b=this._getTemplateDef(a),c={id:b.id,friendlyName:this._localizer.localize("FORM_TEMPLATE_BUNDLE_NAME_"+b.id,b.id),description:this._localizer.localize("FORM_TEMPLATE_BUNDLE_DESC_"+b.id,b.id),defaultWidth:b.defaultWidth,defaultHeight:b.defaultHeight,type:null};return c.type=this._getTypeDef(b.type),c.type.name=c.type.name+this._delimiter+this._utils.getTimeBasedUniqueId(),c.type.displayName=this._localizer.localize("TEMPLATE_BUNDLE_TYPE_NAME_2_"+b.id,b.id),c}})}),define.experiment.Class("wixapps.core.views.ViewBuilder.ServerPagination",function(a){a.methods({_getPaginatedListTemplate:function(){return"PaginatedListTemplate2"}})}),define.experiment.Class("wixapps.core.views.ViewContext.Playlist",function(a){a.methods({_evaluatePathRecursive:function(a,b){if(0===a.length)return b;var c=a.shift(),d=b,e=-1,f=c.match(/^(.*)\[([0-9]+)\]$/);if(f&&(c=f[1],e=f[2]),"parent"==c)return this._parent?this._parent._evaluatePathRecursive(a,-1==e?this._parent._data:this._parent._data.getChildByIndex(e)):void 0;if("dataParent"==c)return b.getParent()?this._evaluatePathRecursive(a,-1==e?b.getParent():b.getParent().getChildByIndex(e)):void 0;if("this"==c)return this._evaluatePathRecursive(a,-1==e?this._data:this._data.getChildByIndex(e));if(0===c.indexOf("$")){if(d=this._env.getVar(c.substr(1)),!d)return void 0}else{if(!d.getChildByRef)return void 0;var g=d.getChildByRef(c);if(d=g?g:this._getComputedChild(d,c),!d)return void 0}if(-1!=e){if(!d.getChildByIndex)return void 0;if(d=d.getChildByIndex(e),!d)return void 0}return this._evaluatePathRecursive(a,d)}})}),define.experiment.component("wixapps.integration.components.AppPage.BlogAddPages",function(a,b){var c=a;c.methods({dispose:function(){this.resources.W.Viewer.removeEvent("hashExtraDataChanged",this._handleHashExtraDataChanged),this._appInstance.unregisterAppPage(this),this.parent()}})}),define.experiment.component("wixapps.integration.components.AppPart.AppBuilderDeleteType.New",function(a){a.fields({isAppPart:!0})}),define.experiment.component("wixapps.integration.components.AppPart.BoxSlideShow",function(a){a.methods({canBeDraggedIntoBoxSlideShow:function(){return!1}})}),define.experiment.component("wixapps.integration.components.AppPart.EcomFeedbackMrg",function(a){var b=a;b.methods({setPreventLogicRun:function(a){this._preventLogicFromRunning=a},_runLogic:function(){if(!this._preventLogicFromRunning){var a=this.getLogicParams(),b=this,c={showView:b.showView,showLoadingIndicator:function(){b.setState("loading")},hideLoadingIndicator:function(){b.setState("content")},showErrorIndicator:function(a,c){a=a||-1,c=c||"Unspecified error",b.setState("error");var d=b._logger;d.reportError({code:a,description:c},this.$className,"showErrorIndicator",d.SubCategory.APP_LOGIC)}},d=this._data.get("viewName");d||(d=this._partDef.views[0],this._data.set("viewName",d,!0)),this._logic.run(d,a,c,this._extraLogicParams)}},invalidateAppPartSize:function(){this._lifecycleManager.performAction(function(){this.fireEvent("invalidateSize")}.bind(this))}})}),define.experiment.component("wixapps.integration.components.AppPart.EditorMetaDataRelocation",function(a,b){a.statics({EDITOR_META_DATA:{general:{help:!1,settings:!0,design:!1},custom:[{label:"EDIT_DATA_BUTTON",command:"WAppsEditorCommands.OpenEditDataDialog",commandParameter:{}}],mobile:{custom:[{label:"FPP_SETTINGS_LABEL",command:"EditorUI.OpenPropertyPanel"}],disablePropertySplit:!0}}}),a.fields({EDITOR_META_DATA:b.remove()})}),define.experiment.component("wixapps.integration.components.AppPart.FeaturedAndRecentPosts",function(a,b){var c=a,d=b;c.methods({_configByFormat:d.remove(),initApp:function(){if(!this._isDisposed){if(this._appInstance.addEvent(Constants.WixAppEvents.INVALIDATE_PART_DATA,this._onContentResize),this._customizations=new this.imports.ViewsCustomizer(this._appInstance.getDataItemFactory()),this._viewDefinitions=new this.imports.ViewDefinitionsOverrideRepository(this._appInstance.getViewDefRepo(),this._customizations,this._appInstance.getDataItemFactory()),this._isMobile()&&(this._formatName="Mobile"),this._applyCustomizationRulesToDefinitions(),this._initializeProxyFactory(),this._partDef=this._appInstance.getPartDefinition(this._data.get("appPartName")),!this._partDef)throw new Error("AppPart.initApp partName ["+this._data.get("appPartName")+"] not found in app descriptor");this._allowHeightResize=this._configByFormatAndView(null,"allowHeightResize",!1),this._allowHeightResize||(this._resizableSides=[Constants.BaseComponent.ResizeSides.LEFT,Constants.BaseComponent.ResizeSides.RIGHT]);var a=this._configByFormatAndView(null,"minWidth",0);a>0&&this.setMinW(a),this._loadPartLogic(),this._view.set("partid",this._appInstance.getPackageName()+"_"+this._partDef.id)}},showView:function(a,b,c,d){if(!this._isDisposed){var e=this;this._currenetViewArguments=arguments,this._appEventHandlers&&_.forEach(this._appEventHandlers,function(a,b){this._eventDispatcher.removeEvent(b,a)},this),this._appEventHandlers=null,this.setState("rendering"),this._mainProxy&&(this._mainProxy.dispose(),this._stylesheetManager&&this._stylesheetManager.reset()),d=d||{},d.partDirection=this.getComponentProperty("direction"),this._partDef.forceFlexCompute&&(d.forceFlexCompute=this._partDef.forceFlexCompute),this._appEventHandlers=c,this._mainProxy=this._proxyFactory.createView(a,b,this._formatName,d),_.forEach(c,function(a,b){this._mainProxy.addEvent(b,a)},this),this._lifecycleManager.reset(),this._mainComponent=this._mainProxy.createComponent(),this._skinParts.inlineContent.set("html",""),this._skinParts.inlineContent.adopt(this._mainComponent),this._allowHeightResize=this._configByFormatAndView(b,"allowHeightResize",this._allowHeightResize),this._allowHeightResize?(this._resizableSides=[Constants.BaseComponent.ResizeSides.LEFT,Constants.BaseComponent.ResizeSides.RIGHT,Constants.BaseComponent.ResizeSides.TOP,Constants.BaseComponent.ResizeSides.BOTTOM],this._mainProxy.getElement().setStyle("height",this.getHeight())):(this._resizableSides=[Constants.BaseComponent.ResizeSides.LEFT,Constants.BaseComponent.ResizeSides.RIGHT],this._updateHeight()),this._mainProxy.setupProxy(),window.requestAnimFrame(function(){e._lifecycleManager.performAction(e._onAppPartRenderComplete)}),this._setupMainProxyListeners.call(this,this._mainProxy)}},getHelpId:function(){var a=this._configByFormatAndView(null,"helpId","");return a?a:this._appInstance.getAppDescriptor().helpId},_configOverride:function(a,b,c){var d;return this._partDef[a]&&b in this._partDef[a]&&c in this._partDef[a][b]&&(d=this._partDef[a][b][c]),d},_configByFormatAndView:function(a,b,c){var d=c,e=this._configOverride("configByFormat",this._formatName,b);if(void 0!==e)return e;if(a){var f=this._configOverride("configByView",a,b);if(void 0!==f)return f}return b in this._partDef&&(d=this._partDef[b]),d}})}),define.experiment.component("wixapps.integration.components.AppPart.WixAppsGalleries",function(a,b){var c=a,d=b;c.resources(d.merge(["W.ComponentLifecycle"])),c.methods({_onResize:d.after(function(){this.resources.W.ComponentLifecycle.forceRender()}),applyCustomizationRule:function(a,b){var c=this.setCustomizationRule(a,!0);if(c!==!1){this._ignoreUpdate=!b;var d=c&&c.length>0?c[0]:void 0,e=this.getCustomizationDefaultValue(a.forType,a.view,a.format||"",a.fieldId,a.key),f=d?!this.injects().Utils.areObjectsEqual(a,d):e!=a.value;f&&this.injects().Commands.executeCommand("WViewerCommands.AppDataChange",[a,d,this]),this._data.fireDataChangeEvent("appLogicCustomizations",a,d,this,!0),this._ignoreUpdate=!1,this._applyCustomizationRulesToDefinitions(),this._eventDispatcher.fireEvent(Constants.WixAppEvents.APP_CONTENT_RESIZE),this._eventDispatcher.fireEvent(Constants.WixAppEvents.APP_PART_RESIZE),window.requestAnimFrame(function(){this.fireEvent("autoSized")}.bind(this))}},_onDataChange:function(a,b){return this._ignoreUpdate?void 0:"AppPartProperties"===a.getType()?(this._skinParts.inlineContent.setStyle("direction",a.get("direction")),this._mainProxy&&this._mainProxy.getViewContext().getEnvironment().setVar("partDirection",a.get("direction")),void 0):(this._appInstance&&"appLogicCustomizations"!==b&&this._runLogic(),void 0)}})}),define.experiment.component("wixapps.integration.components.AppPart2.AppBuilderDeleteType.New",function(a){a.fields({isAppPart2:!0})}),define.experiment.component("wixapps.integration.components.AppPart2.AppBuilderTags",function(a,b){a.binds(b.merge(["_userTagChanged"])),a.methods({setDataSelector:function(a){if(this._dataSelector){var b=this._appInstance.getDataSelectors(),c=this._dataSelector.getId();b.remove(c),b.registerWithId(c,a),this._dataSelector.getLogicalTypeName()!==a.getLogicalTypeName()&&this._appPartDefinition.clearDataSelectorPredefinedSettings()}this._dataSelector=a,this.resources.W.Commands.executeCommand("ApplicationPerformanceSpy.logPhase2",{step:"requesting items from server",appPart:this});var d=function(b){var c=this._appInstance.getViewDefinitions();this._verifyRequiredViewDefinitions(c,this._forType,this._viewName,this._formatName),this._retrieveData(b),this.fireEvent(Constants.WixAppEvents.DATA_SELECTOR_CHANGED,a)}.bind(this);this._dataSelector.getData(d,this._onError)},_createVars:function(){var a=!1,b=[{value:"",text:""}],c="",d=this.getAppPartDefinition().getDataSelectorDef().predefinedSettings;if(d){var e=this._appInstance.getTagsMapping().getValue();b=[{value:"all",text:"all"}];for(var f=0;f<d.tags.length;f++)b.push({value:d.tags[f],text:e[d.tags[f]]});c=d.selectedTag,a=!0}return{userTags:{enabled:a,items:b,selectedValue:c}}},setUserTagSelectedValue:function(a){var b=this._viewHolder.getRootProxy().getViewContext().getEnvironment().getVar("userTags").getChildByRef("selectedValue");b.removeEvent(Constants.DataItemEvents.CHANGE,this._userTagChanged),b.setValue(a),b.addEvent(Constants.DataItemEvents.CHANGE,this._userTagChanged)},getUserTags:function(){return this._viewHolder.getRootProxy().getViewContext().getEnvironment().getVar("userTags")},_userTagChanged:function(a){var b=this,c=function(){b._viewHolder.performActionWhenReady(function(){b.setState("content")})};b.setState("loading"),W.Config.env.$isPublicViewerFrame&&b._logger.reportEvent(b.imports.WixAppsLogger.Events.TAG_SELECTED_IN_VIEWER),this._dataSelector.setPredefinedSettings({tags:this.getAppPartDefinition().getDataSelectorDef().predefinedSettings.tags,selectedTag:a.newValue},c,c)},_subscribeToDataChanges:function(){var a=this._viewHolder.getRootProxy().getViewContext().getEnvironment().getVar("userTags");a.getChildByRef("selectedValue").addEvent(Constants.DataItemEvents.CHANGE,this._userTagChanged)},_setupViewHolder:function(a){this._viewHolder.setupViewHolder(a,this._viewName,this._formatName,this._createVars()),this._subscribeToDataChanges(a)},_initApp:function(){var a=this._appInstance.getAppPartDefinitions(),b=this._appInstance.getDataSelectors(),c=this._data.get("appPartName");if(!a.exists(c))return this._logger.reportEvent(this.imports.WixAppsLogger.Events.APP_PART2_FAILED_TO_LOAD_PART_DEFINITION,{c1:c}),this._itsDeadJim(),void 0;this._appPartDefinition=a.getById(c);var d=this._appPartDefinition.getDataSelectorDef().id;if(!b.exists(d))return this._logger.reportEvent(this.imports.WixAppsLogger.Events.APP_PART2_FAILED_TO_LOAD_DATA_SELECTOR,{c1:d}),this._itsDeadJim(),void 0;this._resizableSides=[Constants.BaseComponent.ResizeSides.LEFT,Constants.BaseComponent.ResizeSides.RIGHT],this._forType=this._appPartDefinition.getType(),this._viewName=this._appPartDefinition.getViewName(),this._formatName=this._isMobile()?"Mobile":"";var e=b.getById(d);this.resources.W.Commands.executeCommand("ApplicationPerformanceSpy.logPhase2",{step:"requesting items from server",appPart:this}),this.setDataSelector(e),this._appPartDefinition.setUsed(!0)}})}),define.experiment.component("wixapps.integration.components.AppPart2.AppBuilderTagsEditor",function(a){a.methods({setDataSelectorPredefinedSettings:function(a){this._appPartDefinition.setDataSelectorPredefinedSettings(a),this.fireEvent(Constants.WixAppEvents.DATA_SELECTOR_PREDEFINED_SETTINGS_CHANGED,a)}})}),define.experiment.component("wixapps.integration.components.AppPart2.AppRepoRefactor",function(a){a.methods({setDataSelector:function(a){if(this._dataSelector){var b=this._appInstance.getDataSelectors(),c=this._dataSelector.getId();this._removeDataSelectorEvents(),b.remove(c),b.registerWithId(c,a)}this._dataSelector=a,this._addDataSelectorEvents(),this.resources.W.Commands.executeCommand("ApplicationPerformanceSpy.logPhase2",{step:"requesting items from server",appPart:this});var d=function(b){var c=this._appInstance.getViewDefinitions();this._verifyRequiredViewDefinitions(c,this._forType,this._viewName,this._formatName),this._retrieveData(b),this.fireEvent(Constants.WixAppEvents.DATA_SELECTOR_CHANGED,a)}.bind(this);this._dataSelector.getData(d,this._onError)},_addDataSelectorEvents:function(){},_removeDataSelectorEvents:function(){},_itsDeadJim:function(a){if(this.setState("error"),this._logger.reportError(this._logger.Errors.APP_PART2_FAILED_TO_LOAD,this.$className,"_onAllSkinPartsReady",this._logger.SubCategory.APP_BUILDER),!W.Config.env.$isPublicViewerFrame){this._resizableSides=[],this.getShowOnAllPagesChangeability=function(){return!1},this.isDuplicatable=function(){return!1},this._appInstance=W.Apps2.getErroneousAppInstance(this._data.get("appInnerID"),a);var b=this._appInstance.getAppPartDefinitions(),c=this._appInstance.getDataSelectors(),d=this._appInstance.getViewDefinitions(),e=this._appInstance.getDataItemFactory(),f=this._appInstance.getTypesManager(),g=this._appInstance.getDataProviders().getWixDbDataProvider();this._viewHolder=new this.imports.ViewHolder(e,f,d,this._appInstance.resolveResourcePath,"",!0,this),this._viewHolder.setContainer(this._skinParts.inlineContent),this._appPartDefinition=b.getById("errAppPartDef"),this._forType="wix:Object",this._viewName="SadPartErrorView",this._formatName="",this._dataSelector=c.createInstance("IB.StaticItem",g,"wix:Object",{item:{errCode:a&&a.code}}),this._dataSelector.getData(function(a){this._viewHolder.setupViewHolder(a,this._viewName,this._formatName)}.bind(this))}},_initApp:function(){var a=this._appInstance.getAppPartDefinitions(),b=this._appInstance.getDataSelectors(),c=this._data.get("appPartName");if(!a.exists(c))return this._logger.reportEvent(this.imports.WixAppsLogger.Events.APP_PART2_FAILED_TO_LOAD_PART_DEFINITION,{c1:c}),this._itsDeadJim(),void 0;this._appPartDefinition=a.getById(c);var d=this._appPartDefinition.getDataSelectorId();if(!b.exists(d))return this._logger.reportEvent(this.imports.WixAppsLogger.Events.APP_PART2_FAILED_TO_LOAD_DATA_SELECTOR,{c1:d}),this._itsDeadJim(),void 0;this._resizableSides=[Constants.BaseComponent.ResizeSides.LEFT,Constants.BaseComponent.ResizeSides.RIGHT],this._forType=this._appPartDefinition.getType(),this._viewName=this._appPartDefinition.getViewName(),this._formatName=this._isMobile()?"Mobile":"";var e=b.getById(d);this.resources.W.Commands.executeCommand("ApplicationPerformanceSpy.logPhase2",{step:"requesting items from server",appPart:this}),this.setDataSelector(e),this._appPartDefinition.setUsed(!0)}})}),define.experiment.component("wixapps.integration.components.AppPart2.BoxSlideShow",function(a){a.methods({canBeDraggedIntoBoxSlideShow:function(){return!1}})}),define.experiment.component("wixapps.integration.components.AppPart2.EditorMetaDataRelocation",function(a,b){a.statics({EDITOR_META_DATA:{mobile:{custom:[{label:"FPP_SETTINGS_LABEL",command:"EditorUI.OpenPropertyPanel"}],disablePropertySplit:!0}}}),a.fields({EDITOR_META_DATA:b.remove()})}),define.experiment.component("wixapps.integration.components.AppPart2.ServerPagination",function(a,b){a.binds(b.merge(["_viewNextPage","_viewPreviousPage","_viewSetPageByItemIndex","_createPaginationVars","setLimit","_pageChanged","_limitChanged"])),a.methods({_initApp:b.before(function(){this._viewHolder.getEventDispatcher().addEvent("nextPage",this._viewNextPage),this._viewHolder.getEventDispatcher().addEvent("previousPage",this._viewPreviousPage),this._viewHolder.getEventDispatcher().addEvent("setPageByItemIndex",this._viewSetPageByItemIndex)}),_addDataSelectorEvents:function(){this._dataSelector.addEvent("pageChanged",this._pageChanged),this._dataSelector.addEvent("limitChanged",this._limitChanged)},_removeDataSelectorEvents:function(){this._dataSelector.removeEvent("pageChanged",this._pageChanged),this._dataSelector.removeEvent("limitChanged",this._limitChanged)},setLimit:function(a){this._dataSelector.setLimit(a)},getLimit:function(){return this._dataSelector.getLimit()},paginationEnabled:function(){return this._dataSelector.paginationEnabled()},_pageChanged:function(a){this._viewHolder.getRootProxy()&&this._viewHolder.getRootProxy().getViewContext().getEnvironment().getVar("currentPage").setValue(a)},_limitChanged:function(a){if(this._viewHolder.getRootProxy()){var b=-1!==a.limit;this._viewHolder.getRootProxy().getViewContext().getEnvironment().getVar("maxPage").setValue(a.numOfPages),this._viewHolder.getRootProxy().getViewContext().getEnvironment().getVar("hidePagination").setValue(b?"false":"true")}},_viewNextPage:function(){this._dataSelector.gotoNextPage()},_viewPreviousPage:function(){this._dataSelector.gotoPreviousPage()},_viewSetPageByItemIndex:function(a){this._dataSelector.setPageByItemIndex(a)},_setupViewHolder:function(a){this._viewHolder.setupViewHolder(a,this._viewName,this._formatName,this._createPaginationVars())},_createPaginationVars:function(){return{limit:this._dataSelector.getLimit(),maxPage:this._dataSelector.getNumofPages(),currentPage:1,hidePagination:!this._dataSelector.paginationEnabled()}},dispose:function(){this._appInstance&&(this._appInstance.getViewDefinitions()&&this._appInstance.getViewDefinitions().removeEvent(Constants.DataItemEvents.CHANGE,this._onViewDefinitionsChanged),this._appPartData&&this._appPartData.removeEvent(Constants.DataItemEvents.CHANGE,this._onAppDataChanged),this._viewHolder&&(this._viewHolder.getEventDispatcher()&&(this._viewHolder.getEventDispatcher().removeEvent(Constants.WixAppEvents.APP_VIEW_READY,this._onAppViewReady),this._viewHolder.getEventDispatcher().removeEvent(Constants.WixAppEvents.APP_CONTENT_RESIZE,this._onContentResize),this._viewHolder.getEventDispatcher().removeEvent("nextPage",this._nextPage),this._viewHolder.getEventDispatcher().removeEvent("previousPage",this._previousPage),this._viewHolder.getEventDispatcher().removeEvent("setPageByItemIndex",this._setPageByItemIndex)),this._viewHolder.dispose())),this._appPartDefinition&&this._appPartDefinition.setUsed(!1),this._viewHolder=null,this._dataSelector=null,this.parent()}})}),define.experiment.component("wixapps.integration.components.MatrixGallery.EditorMetaDataRelocation",function(a,b){a.statics({EDITOR_META_DATA:{general:{settings:!0,design:!0},custom:[{label:"GALLERY_ORGANIZE_PHOTOS",command:"WEditorCommands.OpenListEditDialog",commandParameter:{galleryConfigID:"MatrixGallery",publicMediaFile:"photos",selectionType:"multiple",mediaType:"picture",i18nPrefix:"multiple_images"},commandParameterDataRef:"SELF"}],dblClick:{command:"WEditorCommands.OpenListEditDialog",commandParameter:{galleryConfigID:"MatrixGallery",publicMediaFile:"photos",selectionType:"multiple",mediaType:"picture",i18nPrefix:"multiple_images"},commandParameterDataRef:"SELF"}}}),a.fields({EDITOR_META_DATA:b.remove()})}),define.experiment.component("wixapps.integration.components.SiteButton.OBC_SiteButton.New",function(a){var b=a;b.inherits("wysiwyg.viewer.components.SiteButtonOBC")}),define.experiment.newComponent("wixapps.integration.components.WPhoto.AppsWPhotoNBC",function(a){var b=a,c=b._inheritStrategy_;b.inherits("wysiwyg.viewer.components.WPhotoBase"),b.skinParts(c.inherit()),b.dataTypes(c.inherit()),b.propertiesSchemaType(c.inherit()),b.methods({initialize:function(a,b,c){this.parent(a,b,c),this.on(this.INVALIDATIONS.SKIN_CHANGE,this,this._setLinkStyles),c=c||{},this._showZoom="true"===c.showZoom||c.showZoom===!0?!0:!1},getStyleNameSpace:function(){return this._styleNameSpace||"wysiwyg.viewer.components.WPhoto"},_setLinkStyles:function(){this._skinParts.link.setStyles({"box-sizing":"border-box"})},setSkin:function(a){var b=_.clone(a._html);b=b.replace("<a ","<div ").replace("</a>","</div>");var c={html:b};this.parent(a,c)},_setImageArgs:function(a){var b=this.parent(a);if(b&&b.argObject&&b.argObject.requestExactSize===!0){var c=this._data&&this._data._data.uri&&this._data._data.uri||"";0===c.indexOf("http://")&&0!==c.indexOf(this.resources.W.Config.getMediaStaticUrl())&&(b.argObject.requestExactSize=!1)}return b}})}),define.experiment.component("wixapps.integration.components.WPhotoSelector.AppsWPhotoNBC",function(a){var b=a;b.fields({_renderTriggers:[Constants.DisplayEvents.SKIN_CHANGE]}),b.methods({_onRender:function(a){this.parent(a);var b=a.data.invalidations;b.isInvalidated([this.INVALIDATIONS.SKIN_CHANGE])&&this._skinParts.overlay.set("text",this._localizer.localize("IMAGE_SELECTOR_REPLACE_IMAGE"))}})}),define.experiment.component("wixapps.integration.components.AppPart.ecomApplyQaMode",function(a){var b=a;b.methods({_runLogic:function(){var a=this.getLogicParams(),b=this,c=W.Utils.Url.getSearchParamString(),d=W.Utils.getQueryParam("experiment",c),e={showView:b.showView,showLoadingIndicator:function(){b.setState("loading")},hideLoadingIndicator:function(){b.setState("content")},showErrorIndicator:function(a,c){a=a||-1,c=c||"Unspecified error",b.setState("error");var d=b._logger;d.reportError({code:a,description:c},this.$className,"showErrorIndicator",d.SubCategory.APP_LOGIC)}},f=this._data.get("viewName");f||(f=this._partDef.views[0],this._data.set("viewName",f,!0)),"ecomapplyqamode"===d&&this._logic.runQaMode?this._logic.runQaMode(f,a,e,this._extraLogicParams):this._logic.run(f,a,e,this._extraLogicParams)}})}),define.experiment.component("wixapps.integration.components.editor.DataEditorDialog.Playlist",function(a){a.methods({setDialogOptions:function(a,b,c){this._targetComp=a,this._onCloseCallback=b,this._panelSkins=c,this._view.fireEvent("dialogOptionsSet",this);var d=a.getAppInstance().getAppDescriptor();this._dialogWindow.setCloseCallBack(this._onDialogClosing),this._dialogWindow.setTitle(d.name),this._dialogWindow.clearTabs(),this._treeIdMap={},this._appsEnvironment=a.getEnvironment(),this._appsEnvironment.newDataServiceContext(),this._model=a.getAppPartLogic().getDataEditingModel();var e=this._model.getDataEditingHelpId()||"/node/8748";this._dialogWindow.setState("topHelpLocation"),this._dialogWindow.setHelpLink(e,!0),this._logicParams=a.getLogicParams(),this._selectedItemId=a.getAppPartLogic().getSelectedIId(a.getDataItem(),this._logicParams);var f=this._model.getCategories();this._refreshables=[];for(var g=!1,h=0;h<f.length;h++){var i=this._model.getCategorySections(f[h]),j=new Element("div"),k=null;j.addClass("category"),this._addLabel(j,f[h]);var l=new Element("ul");l.addClass("toplist");
var m=this._model.getCategoryHeight(f[h]);m&&l.setStyle("min-height",m),j.grab(l);var n=this._model.getAddNewTypesInCategory(f[h]);n.length>0&&this._addNewItemButton(n[0],j),this._skinParts.listContainer.grab(j);for(var o=0;o<i.length;o++){var p=i[o].type;"tree"==p?(this._addTreeSection(l,i[o].treeId),this._refreshables.push({type:"tree",treeId:i[o].treeId,div:l}),g=!0):(k||(k=l),this._addListSection(k,f[h],i[o]))}}g||this._updateSelection(),document.body.addClass("fullScreenMode"),this._stylesheetManager=new this.imports.StylesheetManager("#"+this.getID()),this._proxyFactory=new this.imports.ProxyFactory(this._appsEnvironment.getDataItemFactory(),this._appsEnvironment.getTypesManager(),this._appsEnvironment.getViewDefRepo(),this._eventDispatcher,this._appsEnvironment.getAppInstance().resolveResourcePath,this._appsEnvironment.getAppInstance().getPackageName(),new this.imports.LifecycleManager(this._eventDispatcher),this._appsEnvironment.getAppPart(),this._stylesheetManager),(new this.imports.ProxyMap).registerComponentProxies(this._proxyFactory)},_addChildListItemSeqHook:function(a){var b=this._createItemContent(a);return this._listProxies.push(b.proxy),{comp:"wixapps.integration.components.editor.DataEditorItem",skin:this._panelSkins&&this._panelSkins.itemSummary||"wixapps.integration.skins.editor.DataEditorItemSkin",data:null,args:{content:b.view,isHeader:!1,dragEnabled:this._dragEnabled}}},_createHeaderItem:function(a,b){var c=this._createItemContent(a);this._listProxies.push(c.proxy);var d=new Element("div");return b.grab(d),this.resources.W.Components.createComponent("wixapps.integration.components.editor.DataEditorItem",this._panelSkins&&this._panelSkins.headerItem||"wixapps.integration.skins.editor.DataEditorItemSkin",null,{content:c.view,isHeader:!0,dragEnabled:this._dragEnabled},void 0,void 0,void 0,d)},_openItemEditor:function(a,b,c,d){if(!this._openingDialog){this._openingDialog=!0;var e=setInterval(function(){this._openingDialog=!1,clearInterval(e)}.bind(this),200),f=this._panelSkins&&this._panelSkins.itemEdit;this.injects().EditorDialogs.openWixAppsEditItemDialog(a,this._appsEnvironment,this._model,this._onItemEditingCompleted,b,c,d,f)}},_onItemEditingCompleted:function(a){this._clearListPane();for(var b=0;b<a.length;b++){var c=a[b].action,d=a[b].originalItem,e=a[b].editedItem;if("delete"==c){for(var f=this._model.getItemParents(d),g=0;g<f.length;g++)this._model.removeChild(f[g],d);for(var h=this._model.getChildren(d),i=0;i<h.length;i++)this._model.removeChild(d,h[i]);var j=this._model.getDataService().getItemCache(),k={_type:"wix:Ref",collectionId:this._model.getCollectionOfItem(d),itemId:d.getChildValue("_iid")},l=j.key(k.collectionId,k.itemId);j.remove(l),e.getChildValue("_hash")&&j.markItemAsDeleted(l)}var m=this._targetComp.getAppPartLogic();m.onAfterItemEditing&&m.onAfterItemEditing(a[b])}this._updateListView(),this._refreshCategoriesPanel()},_onDialogClosing:function(a){if(this._inSaveProcess)return!1;var b=this.resources.W.Commands.getCommand("WAppsEditorCommands.DataEditorFinish"),c={appId:this._targetComp.getDataItem().get("appInnerID")},d=this._appsEnvironment,e={selectedTreeItem:this._selectedTreeItem};if("DISCARD"==a.result||"CANCEL"==a.result){var f=function(){c.dataChanged=!1,b.execute(c),this._dialogWindow.closeDialog(),d.popDataServiceContext(),document.body.removeClass("fullScreenMode"),this.dispose(),this._onCloseCallback("CANCEL",e)}.bind(this);return this.injects().EditorDialogs.openPromptDialog(this._localizer.localize("DATA_EDIT_DIALOG_DiscardChanges"),this._localizer.localize("DATA_EDIT_DIALOG_DiscardChangesDescription"),"",this.resources.W.EditorDialogs.DialogButtonSet.YES_NO,function(a){a.result==this.resources.W.EditorDialogs.DialogButtons.YES&&setTimeout(f,0)}.bind(this),!1),!1}document.body.removeClass("fullScreenMode"),$$("body").removeEvent("click",this._closeAddItemCombo);var g=d.getDataService();if("SAVE"==a.result){var h,i=g.getItemCache(),j=[],k=[],l=[],m=i.getItemsMarkedAsDeleted(),n=m.length,o=this;i.each(function(a,b){!a.isDirty()&&a.getChildValue("_hash")||i.isItemMarkedAsNonPersistent(b)||j.push(b)});var p=function(){if(this._inSaveProcess=!1,l.length>0)this.injects().EditorDialogs.openErrorDialog("Error Saving Data","Please try again in a few minutes",h.code+"\n"+h.description,null);else{d.popDataServiceContext();try{var a=d.getItemCache();k.forEach(function(b){if(i.isItemMarkedAsDeleted(b))a.remove(b);else{var c=a.put(b,i.get(b).getValue(0));c.resetDirtyFlag()}})}catch(f){var g=d.getLogger();g.reportError(g.Errors.UNABLE_TO_REFRESH_AFTER_SAVE,this.$className,"onSuccess",g.SubCategory.DATA_EDITING)}var j=this.injects().EditorDialogs;j.openPromptDialog(this._localizer.localize("DATA_EDIT_DIALOG_SavedSuccessfully"),this._localizer.localize("DATA_EDIT_DIALOG_SavedSuccessfullyDescription"),"",j.DialogButtonSet.OK),c.dataChanged=!0,b.execute(c),this._dialogWindow.closeDialog(),this._appsEnvironment.getAppInstance().fireEvent(Constants.WixAppEvents.INVALIDATE_PART_DATA,{}),this.dispose(),this._onCloseCallback("SAVE",e)}}.bind(this),q=function(a,b){return function(){"create"==b?k.unshift(a):k.push(a),j.length+n==k.length+l.length&&p()}},r=function(a){return function(b){h=b,l.push(a),j.length+n==k.length+l.length&&p()}};if(j.forEach(function(a){var b=i.get(a),c=i.idsFromKey(a).collectionId;b.getChildValue("_hash")?(g.updateItem(c,b,q(a,"update"),r(a)),o._reportItemUpdated(c,b.getChildValue("_iid"),b.getTypeName())):(g.createItem(c,b,q(a,"create"),r(a)),o._reportItemAdded(c,b.getChildValue("_iid"),b.getTypeName()))}),m.forEach(function(a){var b=i.idsFromKey(a);g.deleteItem(b.collectionId,b.itemId,q(a,"delete"),r(a)),o._reportItemDeleted(b.collectionId,b.itemId)}),j.length>0||m.length>0)return this._inSaveProcess=!0,this.setState("saving"),!1;c.dataChanged=!1,b.execute(c),d.popDataServiceContext(),this._resizeHandler.deactivateResizeHandler(),this.dispose(),this._onCloseCallback("SAVE_NO_CHANGE",e)}},_addSectionListItem:function(a){var b=new Element("li"),c=new Element("p");a.indent>0&&c.setStyle("padding-left",a.indent),b.grab(c),b.addEvent(Constants.CoreEvents.CLICK,function(b){b&&b.stopPropagation(),this._onSectionSelected(a,c)}.bind(this));var d=a.title||a.name;if(this._model.getDisplaySectionListCount()){var e=this._model.getChildren(a.item).length;d+=" <span> - "+e+"</span>"}return c.set("html",d),b}})}),define.experiment.component("wixapps.integration.components.editor.SaveBeforeDataEditingDialog.OpenManageStoreAfterSave",function(a,b){var c=a,d=b;c.binds(d.merge(["_onAfterFirstSave"])),c.methods({_onSave:function(){this._dialogWindow.endDialog(),W.Commands.executeCommand("WEditorCommands.RegisterOpenDialogAfterFirstSave"),this.resources.W.EditorDialogs.openSaveDialog()}})}),define.experiment.component("wixapps.integration.components.editor.ZoomCustomizer.EcomExp5",function(a){a.methods({_handleViewNameChange:function(){this._zoomComp&&this._zoomComp.$view&&this._zoomComp.$view.setStyle("opacity","0"),_.defer(this._updateCustomizationPanel.bind(this))}})}),define.experiment.component("wixapps.integration.components.editor.ZoomCustomizer.EcomFeedbackMrg",function(a){var b=a;b.methods({_doCreateFields:function(){var a=this;if(this._zoomComp&&this._zoomComp.getAppPartLogic){var b=this._zoomComp.getAppPartLogic();!b.preventGeneratingSettingsPanel&&b.generateSettingsPanel&&(this._zoomLogicPropGroup?this._updatedZoomCompGeneralPanel(this._zoomLogicPropGroup):this.addInputGroupField(function(){a._zoomLogicPropGroup=this,a._updatedZoomCompGeneralPanel(this)}))}},_updatedZoomCompGeneralPanel:function(a){a.disposeFields();var b=this._zoomComp.getLogicParams(),c=this._zoomComp.getDataItem(),d=this._zoomComp.getAppPartLogic();d.generateSettingsPanel(a,c,b)},_registerZoomCompListeners:function(a){a.getDataItem().addEvent("dataChanged",this._updateCustomizations),a.addEvent("proxyDisplayed",this._updateCustomizationPanel),this._isMobile()&&a.addEvent("autoSized",this._updatePreviewFrame)},_updateCustomizationPanel:function(){this._updateViewCustomizations(this._customizationsPropGroup,this._zoomComp._mainProxy.getViewContext()),this._doCreateFields()},_updateCustomizations:function(){var a=this._zoomComp.getDataItem().get("appLogicCustomizations");this._targetZoomData.set("appLogicCustomizations",a);var b=this._zoomComp.getDataItem().get("appLogicParams");this._targetZoomData.set("appLogicParams",b)}})}),define.experiment.component("wixapps.integration.components.panels.EditFieldPanel.WixAppsGalleryField",function(a,b){a.fields({_spacingPanelDefer:null}),a.methods({_recreateFieldSettings:b.before(function(){this._spacingPanelDefer=Q.defer()}),_addGenericFieldCustomizations:function(a,b){var c=this,d=!1;a.addInputGroupField(function(){switch(b){case"Image":c._addImageCustomization(this);break;case"Video":c._minWidth=200,c._minHeight=220,c._addVideoCustomization(this);break;case"Button2":c._minHeight=14,c._addButtonCustomization(this);break;case"SliderGallery":c._addSliderGalleryCustomization(this),d=!0;break;default:c._addImageCustomization(this)}}),this._addGenericSizeAndSpacing(a,d)},_addGenericSizeAndSpacing:function(a,b){var c=this;a.addInputGroupField(function(){this.addLabel(c._loc("Size")),this.addBreakLine(7,"1px solid #E5E5E5",10),c.size=c.size||{},c.size.width=c._addSlider(this,c._loc("Width"),{key:"comp.width"},c._minWidth,1200,1,void 0,b),c.size.height=c._addSlider(this,c._loc("Height"),{key:"comp.height"},c._minHeight,1200,1,void 0,b),"auto"==c._heightMode&&c.size.height.disable(),c._addBoxAlign(this,c._loc("SizeAlignmentLabel"))}),c._addSpacing(a,b)},_addSpacing:function(a,b){var c=this;a.addInputGroupField(function(){c._addCollapsiblePanel(this,c._loc("SpacingLabel"),function(){c._spacingPanelDefer.promise.done(function(a){c.spacers=c.spacers||{},c.spacers.top=c._addSlider(a,c._loc("Spacing_Top"),{key:c._isVertical?"comp.spacers.before":"comp.spacers.xax-before"},0,600,1,void 0,b),c.spacers.bottom=c._addSlider(a,c._loc("Spacing_Bottom"),{key:c._isVertical?"comp.spacers.after":"comp.spacers.xax-after"},0,600,1,void 0,b),c.spacers.left=c._addSlider(a,c._loc("Spacing_Left"),{key:c._isVertical?"comp.spacers.xax-before":"comp.spacers.before"},0,600,1,void 0,b),c.spacers.right=c._addSlider(a,c._loc("Spacing_Right"),{key:c._isVertical?"comp.spacers.xax-after":"comp.spacers.after"},0,600,1,void 0,b)}),c._spacingPanelDefer.resolve(this)})})},_addSliderGalleryCustomization:function(a){var b=this;this._addSliderGalleryImageModeCustomization(a),this.addInputGroupField(function(){b._addCollapsiblePanel(this,b._loc("SliderGalleryOther"),function(){var a={fieldId:b._getFieldProxyId(),key:"comp.maxSpeed"},c=(b._addSlider(this,b._loc("SliderGallerySpeed"),a,1,30,1,void 0,!0,b._getCurrentValue(a,8)),this.addCheckBoxField(b._loc("SliderGalleryLoop"))),d={fieldId:b._getFieldProxyId(),key:"comp.loop"};b._bindToCustomization(c,d,b._getCurrentValue(d,!0))})}),this.addInputGroupField(function(){this.setNumberOfItemsPerLine(1);var a=[{value:"disabled",label:b._loc("SliderGalleryOnClickDisabled")},{value:"zoomMode",label:b._loc("SliderGalleryOnClickZoomMode")},{value:"goToLink",label:b._loc("SliderGalleryOnClickGoToLink")}],c=this.addComboBoxField(b._loc("SliderGalleryOnClick"),a,"zoomMode");b._bindToCustomization(c,{fieldId:b._getFieldProxyId(),key:"comp.galleryImageOnClickAction"},"zoomMode")}),this._spacingPanelDefer.promise.done(function(a){var c={fieldId:b._getFieldProxyId(),key:"comp.margin"};b._addSlider(a,b._loc("SliderGallery_ImageSpacers"),c,0,250,1,void 0,!0,b._getCurrentValue(c,8))}),this._addComponentStyleSelector(a,this._getFieldProxyId())},_addSliderGalleryImageModeCustomization:function(a){var b=this,c=[{value:"clipImage",label:this._loc("SliderGalleryImageMode_Crop")},{value:"flexibleWidth",label:this._loc("SliderGalleryImageMode_FitHeight")}],d=this._loc("SliderGallery_ImageModeLabel"),e=a.addComboBoxField(d,c,void 0,void 0,"Slider_Gallery_Settings_Image_Scaling_ttid"),f="radiobuttons/aspRatio/radio_button_states.png",g={w:"46px",h:"52px"},h={options:[{value:"16:9",image:f,dimensions:g,icon:"radiobuttons/aspRatio/16-9.png"},{value:"4:3",image:f,dimensions:g,icon:"radiobuttons/aspRatio/4-3.png"},{value:"1:1",image:f,dimensions:g,icon:"radiobuttons/aspRatio/1-1.png"},{value:"3:4",image:f,dimensions:g,icon:"radiobuttons/aspRatio/3-4.png"},{value:"9:16",image:f,dimensions:g,icon:"radiobuttons/aspRatio/9-16.png"}],display:"inline",defaultValue:"",group:""},i=a.addRadioImagesField(this._loc("SliderGalleryAspectRatio"),h.options,h.defaultValue,h.group,h.display),j={fieldId:b._getFieldProxyId(),key:"comp.imageMode"};b._bindToCustomization(e,j),b._bindToCustomization(i,{fieldId:b._getFieldProxyId(),key:"comp.aspectRatioPreset"},"4:3");var k=function(a){switch(a){case"clipImage":i.uncollapse();break;case"flexibleWidth":i.collapse()}};e.addEvent("inputChanged",function(a){k(a.value)});var l=this._getCurrentValue(j,"clipImage");k(l)}})}),define.experiment.component("wixapps.integration.components.panels.ListSettingsPanel.AppBuilderAddItemBeforeAfter",function(a){a.methods({createItem:function(){W.Commands.executeCommand("WAppsEditor2Commands.AddNewDataItem",{comp:this._appPart,compId:this._appPart.getAppPartDefinition().getId(),onDataItemAdded:function(){this._listCursor.first(),this._loadSharedData()}.bind(this),addedFrom:"PANEL_ADD_NEW_ITEM"})}})}),define.experiment.component("wixapps.integration.components.panels.ListSettingsPanel.AppBuilderTagsEditor",function(a,b){a.fields({_viewName:"ManageItems2.AppBuilderTagsEditor"}),a.binds(b.merge(["_onSelectorChanged"])),a.methods({_addListeners:b.after(function(){this.resources.W.Commands.registerCommandAndListener("WAppsEditor2Commands.OpenFilterPanel",this,this.selectItems),this._appPart.addEvent(Constants.WixAppEvents.DATA_SELECTOR_CHANGED,this._onSelectorChanged)}),_removeListeners:b.after(function(){this.resources.W.Commands.unregisterCommand("WAppsEditor2Commands.OpenFilterPanel"),this._appPart.removeEvent(Constants.WixAppEvents.DATA_SELECTOR_CHANGED,this._onSelectorChanged)}),_onSelectorChanged:function(a){this._removeDataSelectorEvents(),this._usedDataSelector=a,this._addDataSelectorEvents(),this._loadSharedData(function(){this._updateCursor(),this._manageItemPresenter.rebuildModel(),this._dataEditPresenter.rebuildModel(!0)}.bind(this))},_onTabSelected:function(a){this._tabPanels[a.oldTab].setIsOpen(!1),this._tabPanels[a.newTab].setIsOpen(!0),this._setPanelHeader(null,this._loc(a.newTab+(this._isList()?"":"SingleItem")+"TabDescription2")),this.backToSettings()},_loadSharedData:function(a){var b,c=this._usedDataSelector.getSelectionType(),d=this._usedDataSelector.getDataProvider();this._usedDataSelector.isListSelector()?this._usedDataSelector.getData(function(b){this._itemsData.setChildren(b.getRealChildren()),a&&a(this._itemsData)}.bind(this)):(this._usedDataSelector=this.resources.W.AppsEditor2.getAllItemsOfTypeDataSelector(c,this._appInstance),b=this._usedDataSelector.getItemsIdsLocally(),d.readItems(c,b,function(b){this._itemsData.setChildren(b),a&&a(this._itemsData)}.bind(this)))},_getItemIndex:function(a){var b=a||this._selectionHandler.getCurrentDataItem(),c=-1;if(b){var d=b.getChildValue("_iid");c=this._usedDataSelector.getItemIdIndex(d)}return c},_updateCursor:function(a){var b=this._getItemIndex(a);return-1==b?(this._selectionHandler.setSelectedIndex(0,!0),this._updateCursor(),void 0):(this._selectionHandler.setSelectedIndex(b,!0),this._listCursor.setSelectedIndex(b,!0),void 0)},createItem:function(){var a=this;this.resources.W.Commands.executeCommand("WAppsEditor2Commands.AddNewDataItem",{comp:this._appPart,compId:this._appPart.getAppPartDefinition().getId(),onDataItemAdded:function(b){a._loadSharedData(function(){var c=a._getItemIndex(b);a._selectionHandler.setSelectedIndex(c,!0),a._listCursor.setSelectedIndex(c,!1)}),a._showFirstTimeTagBubble()},addedFrom:"PANEL_ADD_NEW_ITEM"})},_shouldntMigrateView:function(a){return a&&a.editorData&&a.editorData.isPaginated&&a.editorData.hasTags},selectItems:function(a){var b=this,c=function(a,c){var d=b._appPart.getDataSelector();if(d===a){var e=a.getDefinition();if(d.loadFromDefinition(e),a.isListSelector)throw"Cannot change to a non-list data selector";a.getData()}else{var f={appPart:b._appPart,dataSelector:a,dataSelectorPredefinedSettings:c,listSettingsPanel:b};b._migrateToPaginatedList(),c&&b.resources.W.Commands.executeCommand("WAppsEditor2Commands.OpenHelpBubble",{appPart:b._appPart,ftHelpSetName:"FT_UoU_FILTERING_ENABLED",anchorElement:b._view.getElement("[vcfield='userTags']")}),b.resources.W.Commands.executeCommand("WAppsEditor2Commands.ChangeDataSelector",f)}};W.Commands.executeCommand("WAppsEditor2Commands.DataItemSelectionRequested",{appPart:this._appPart,type:this._typeName,appInstance:this._appInstance,okCallback:c,args:a})},_onSelectorDataChange:function(a){this._itemsData.setChildren(a.vArray.getRealChildren()),this._manageItemPresenter.rebuildModel(a.vArray),this._updateCursor(this._usedDataSelector.getSelectedItem()),this._dataEditPresenter.rebuildModel(!0)},_addDataEditPanel:function(){this._dataPanelAdded=!0,this.resources.W.AppsGUI.addViewToPanel(this._appPart.getAppInstance(),this._dataEditPanel,"DataEdit2.AppBuilderTags",this._dataEditPresenter),this._showFirstTimeTagBubble()},backToSettings:b.after(function(){this._showFirstTimeTagBubble()}),_showFirstTimeTagBubble:function(){var a=this._view.getElement("[vcview='"+this._viewName+"']");a&&!this._usedDataSelector.isSorted()&&a.isVisible()&&this._itemsData.getChildrenCount()>=5&&this.resources.W.Commands.executeCommand("WAppsEditor2Commands.OpenHelpBubble",{appPart:this._appPart,ftHelpSetName:"FT_START_USING_TAGS",anchorElement:a.getElement("[vcfield='items']").children[0]})},_listCursorChanged:function(a){var b=a.index,c=this._itemsData.getChildByIndex(b);if(c){var d=c.getChildValue("_iid");b=this._usedDataSelector.getItemIdIndex(d),0>b?this._selectionHandler.removeSelection():this._selectionHandler.setSelectedIndex(b,!0),this._handleNonListSelectors(d)}this._dataEditPresenter.rebuildModel()}})}),define.experiment.component("wixapps.integration.components.panels.ListSettingsPanel.AppRepoRefactor",function(a){a.methods({_initCursor:function(){this._selectionHandler=this.resources.W.AppsEditor2.getSelectionHandler();var a=this._selectionHandler.getCurrentDataItem(),b=-1;if(a){var c=a.getChildValue("_iid");b=this._usedDataSelector.getItemIdIndex(c)}this._listCursor=new this.imports.ListCursor(this._itemsData,b),this._listCursor.addEvent(Constants.WixAppEvents.SELECTED_INDEX_CHANGED,this._listCursorChanged)},_loadSharedData:function(a){var b=this._usedDataSelector.getSelectionType();if(this._usedDataSelector.isListSelector()){if(this._ignoreDataRefereshed)return delete this._ignoreDataRefereshed,void 0;this._ignoreDataRefereshed=!0,this._usedDataSelector.getAllData(function(b){this._itemsData.setChildren(b.getRealChildren()),a&&a(this._itemsData)}.bind(this))}else{this._usedDataSelector=this.resources.W.AppsEditor2.getAllItemsOfTypeDataSelector(b,this._appInstance);var c=this._itemsData;this._usedDataSelector.getData(function(b){c.setChildren(b.getChildren()),a&&a(c)})}},_componentSelectionChanged:function(a){if(a.appPart.getDataSelector().isListSelector()!==!1){var b=this.resources.W.Commands.getCommand("WAppsEditor2Commands.BeforeListItemSelectionMadafaka");b&&b.execute();var c=a.dataItem;if(c){var d=c.getChildValue("_iid"),e=this._usedDataSelector.getItemIdIndex(d);this._listCursor.setSelectedIndex(e),a.appPart.getViewHolder().getRootProxy().fireEvent("itemSelectionChanged",{index:a.index}),this._selectionHandler.setSelectedIndex(a.index,!0)}}},_updateCursor:function(a){var b=a||this._selectionHandler.getCurrentDataItem(),c=-1;if(b){var d=b.getChildValue("_iid");c=this._usedDataSelector.getItemIdIndex(d)}return-1==c?(this._selectionHandler.setSelectedIndex(0,!0),this._updateCursor(),void 0):(this._selectionHandler.setSelectedIndex(c,!0),this._listCursor.setSelectedIndex(c,!0),void 0)}})}),define.experiment.component("wixapps.integration.components.panels.ListSettingsPanel.ClientTimestamps",function(a){a.methods({duplicateItem:function(){var a=this._listCursor.getCurrentItemIndex(),b=this._itemsData.getChildByIndex(a),c=this.resources.W.Utils.AppsUtils,d=b.getValue();delete d._createdAt,delete d._updatedAt,delete d._timestamp,d._iid=c.getTimeBasedUniqueId(),_.each(d,function(a){a._type&&"wix:RichText"===a._type&&a.links&&a.links.length>0&&_.each(a.links,function(b){var d=b.linkId;b.linkId=c.generateLinkId("appbuilder"),a.text=a.text.replace("#"+d,"#"+b.linkId)})}),this.resources.W.Commands.executeCommand("WAppsEditor2Commands.AddNewDataItem",{comp:this._appPart,compId:this._appPart.getAppPartDefinition().getId(),rawData:d,onDataItemAdded:function(){this._listCursor.first(),this._loadSharedData()}.bind(this)})}})}),define.experiment.component("wixapps.integration.components.panels.ListSettingsPanel.ScrollManager",function(a,b){a.binds(b.merge(["_onResize"])),a.fields({_viewName:"ManageItems2.ScrollManager"}),a.methods({_addListeners:function(){this._usedDataSelector.addEvent(Constants.DataEvents.DATA_CHANGED,this._onSelectorDataChange),this._usedDataSelector.addEvent("dataSelectorRefreshed",this._onSelectorDataChange),this._appInstance.addEvent(Constants.WixAppEvents.TYPE_CHANGE,this._onTypeChanged),this._viewDataItem.addEvent(Constants.DataItemEvents.CHANGE,this._onViewDefChange),this.resources.W.Commands.registerCommandListenerByName("WAppsEditor2Commands.SelectionChanged",this,this._componentSelectionChanged),this.resources.W.Commands.registerCommandAndListener("WAppsEditor2Commands.SelectItemsPanel",this,this._onSelectItemsPanel,null,!1),this.resources.W.Commands.registerCommandAndListener("WAppsEditor2Commands.SelectDesignPanel",this,this._onSelectDesignPanel,null,!1),this.resources.W.Commands.registerCommandAndListener("WAppsEditor2Commands.SelectOptionsPanel",this,this._onSelectOptionsPanel,null,!1),this.resources.W.Commands.registerCommandAndListener("WAppsEditor2Commands.OpenEditItemPanel",this,this._onOpenItem,null,!1),this.resources.W.Commands.registerCommandAndListener("WAppsEditor2Commands.ShowSelectItemsHelp",this,this._showSelectItemsHelp,null,!1)},_removeListeners:function(){this._usedDataSelector&&this._usedDataSelector.removeEvent(Constants.DataEvents.DATA_CHANGED,this._onSelectorDataChange),this._usedDataSelector&&this._usedDataSelector.removeEvent("dataSelectorRefreshed",this._onSelectorDataChange),this._appInstance&&this._appInstance.removeEvent(Constants.WixAppEvents.TYPE_CHANGE,this._onTypeChanged),this._viewDataItem&&this._viewDataItem.removeEvent(Constants.DataItemEvents.CHANGE,this._onViewDefChange),this.resources.W.Commands.unregisterCommand("WAppsEditor2Commands.ShowSelectItemsHelp"),this.resources.W.Commands.unregisterCommand("WAppsEditor2Commands.OpenEditItemPanel"),this.resources.W.Commands.unregisterCommand("WAppsEditor2Commands.SelectItemsPanel"),this.resources.W.Commands.unregisterCommand("WAppsEditor2Commands.SelectDesignPanel"),this.resources.W.Commands.unregisterCommand("WAppsEditor2Commands.SelectOptionsPanel"),this.resources.W.Editor.getPropertyPanel().removeEvent(Constants.CoreEvents.RESIZE,this._onResize),this.resources.W.Commands.unregisterListener(this)},_initPresenters:b.after(function(){this._tabsPresenter.$ready.then(function(a){this._tabPanelHeight=a.$view.getHeight()}.bind(this))}),_initModels:function(){this._setupAction=Q.defer(),this._tabsReady=Q.defer(),this._manageItemsReady=Q.defer(),this._innerPanelsReady=Q.defer(),this._addDomListeners(),this._initData()},_addDomListeners:function(){this.resources.W.Editor.getPropertyPanel().addEvent(Constants.CoreEvents.RESIZE,this._onResize)},_addDataEditPanel:function(){this._dataPanelAdded=!0,this.resources.W.AppsGUI.addViewToPanel(this._appPart.getAppInstance(),this._dataEditPanel,"DataEdit2.ScrollManager",this._dataEditPresenter)},_createPanels:function(){var a=this;this.resources.W.AppsGUI.addViewToPanel(a._appPart.getAppInstance(),this,"SettingsPanelTabs",this._tabsPresenter),this.addBreakLine(10),this._loading=this.addLabel("Loading..."),this._settingsPanel=this.addInputGroupField(function(){a._addRadioPanel(this,"items",function(){a._itemsTab=this},!0,a._tabPanels),a._addRadioPanel(this,"design",function(){a._designTab=this},!1,a._tabPanels),a._addRadioPanel(this,"settings",function(){a._settingsTab=this},!1,a._tabPanels),a._tabsReady.resolve()},"skinless"),this.addInputGroupField(function(){a._advancedDesignPanel=this},"skinless"),this._advancedDesignPanel.collapse(),this.addInputGroupField(function(){a._dataEditPanel=this},"skinless"),this._dataEditPanel.collapse(),this._manageItemsReady.promise.then(function(){a._dataPanelAdded||a._addDataEditPanel()}),this._settingsPanel.getHtmlElement().setStyle("overflow-y","auto"),this._dataEditPanel.$view.setStyle("overflow-y","auto"),this._advancedDesignPanel.$view.setStyle("overflow-y","auto"),this._innerPanelsReady.resolve(),this._appPart.addEvent(Constants.WixAppEvents.APP_VIEW_READY,this._updateCustomizationPanel),a._showHelpIfNeeded()},_openDataItemEditing:function(){this._tabsReady.promise.then(function(){this._tabsPresenter.selectTab("items"),this._settingsPanel.collapse(),this._advancedDesignPanel.collapse(),this._dataEditPanel.uncollapse(),this._dataPanelAdded||this._addDataEditPanel()}.bind(this))},_openAdvancedDesign:function(){this._settingsPanel.collapse(),this._advancedDesignPanel.uncollapse(),this._dataEditPanel.collapse(),this._advancedDesignAdded||(this._advancedDesignAdded=!0,this.resources.W.AppsGUI.addViewToPanel(this._appPart.getAppInstance(),this._advancedDesignPanel,"CustomizeItems2.ScrollManager",this._customizeItemsPresenter))},_onResize:function(a){Q.all([this._tabsPresenter.$ready,this._innerPanelsReady.promise]).done(function(b){this._tabPanelHeight=this._tabPanelHeight||b[0].$view.getHeight()||32;var c=a-this._tabPanelHeight;this._settingsPanel.getHtmlElement().setStyle("height",c),this._dataEditPanel.$view.setStyle("height",c),this._advancedDesignPanel.$view.setStyle("height",c)}.bind(this))},dispose:function(){this._isDisposed||(this._removeListeners(),this._disposePresenters(),this._appPart.removeEvent(Constants.WixAppEvents.APP_VIEW_READY,this._updateCustomizationPanel),this._bindings&&this._bindings.forEach(function(a){a.dispose()}),this.parent())},_onStopEditingText:b.remove(),_findFirstScrollerContainer:b.remove(),_onBeforeStartEditingText:b.remove()})}),define.experiment.component("wixapps.integration.components.panels.ListSettingsPanel.ServerPagination",function(a,b){a.binds(b.merge(["_onPaginationStatusChanged","_onItemsPerPageChanged","_addAppPartCustomizations"])),a.fields({_paginationEnabled:null,_paginationItemsPerPage:null}),a.methods({_loadSharedData:function(a){var b=this._usedDataSelector.getSelectionType();if(this._usedDataSelector.isListSelector())this._itemsPerPage=this._appPart.getLimit(),this._usedDataSelector.getAllData(function(b){this._itemsData.setChildren(b.getChildren()),a&&a(this._itemsData)}.bind(this));else{this._usedDataSelector=this.resources.W.AppsEditor2.getAllItemsOfTypeDataSelector(b,this._appInstance);var c=this._itemsData;this._usedDataSelector.getData(function(b){c.setChildren(b.getChildren()),a&&a(c)})}},_addAppPartCustomizations:function(a){var b=a.addCheckBoxField(this._loc("UsePagination"));b.setValue(this._appPart.paginationEnabled()),b.addEvent("inputChanged",this._onPaginationStatusChanged),a.addBreakLine("10px");var c=a.addSliderField(this._loc("ItemsPerPage"),1,120,1);c.setValue(this._appPart.getLimit()),c.addEvent("inputChanged",this._onItemsPerPageChanged),c.runWhenReady(function(a){this._paginationItemsPerPage=a}.bind(this)),a.addBreakLine("10px")},_onPaginationStatusChanged:function(a){a.value===!0?(this._paginationItemsPerPage.uncollapse(),setTimeout(function(){this._appPart.setLimit(this._itemsPerPage&&-1!==this._itemsPerPage?this._itemsPerPage:10)}.bind(this),0)):(this._paginationItemsPerPage.collapse(),setTimeout(function(){this._appPart.setLimit(-1)}.bind(this),0)),this._reportUserToggledPagination(a.value)},_reportUserToggledPagination:function(a){var b={g1:a.toString()};this._logger.reportEvent(this._logger.Events.APP_BUILDER_TOGGLE_PAGINATION,b)},_onItemsPerPageChanged:function(a){this._appPart.setLimit(a.value),this._itemsPerPage=a.value}})}),define.experiment.component("wixapps.integration.components.panels.ProxyStylePanel.StylesUR",function(a,b){a.methods({_buildStyleButtons:b.after(function(){this._changeTracker.addFromStyleToUiUpdater(function(a){this._currentlySelectedStyle=this._styleToApply=a.styleName,this._setSelectedSkinInGallery(a.styleName)}.bind(this))}),_onDialogClosing:function(a){var b=this.injects().UndoRedoManager;"CANCEL"==a.result&&this._originalStyle?(this._setStyleByID(this._originalStyle),b.removeTransactionAndAfter(this._openDialogUndoRedoId)):b.removeTransaction(this._openDialogUndoRedoId)}})}),define.experiment.newComponent("wixapps.integration.components.quickactions.SearchPanel.QuickActions.New",function(a){a.inherits("mobile.core.components.base.BaseComponent"),a.resources(["W.Theme","W.AppsGUI","wixapps.integration.gui.QuickActionsSearchViews","W.Config","W.InputBindings","W.Commands"]),a.utilize(["wixapps.integration.managers.ViewHolder","wixapps.core.views.ViewDefinitionsRepository","wixapps.integration.gui.EventBinding","wixapps.core.managers.TypesManager","wixapps.core.data.DataItemBinding","wixapps.core.expressions.FunctionLibrary","wixapps.core.data.DataItemFactory","wixapps.integration.gui.QuickSearchPresenter"]),a.binds(["_resolveResourcePath"]),a.skinParts({inlineContent:{type:"htmlElement"}}),a.states(["idle","searching","results"]),a.fields({_dataItemFactory:null,_viewHolder:null,_viewDefRepo:null,_typeManager:null,_eventBinding:null,_presenter:null,_viewName:null}),a.methods({initialize:function(a,b,c){this.parent.apply(this,arguments),this.setState("idle");var d=c&&c.availableWidth||1/0,e=(new this.imports.FunctionLibrary).createChild();this._dataItemFactory=new this.imports.DataItemFactory,this._dataItemFactory.registerFunctionLibrary(e),this._typesManager=new this.imports.TypesManager,this._viewDefRepo=new this.imports.ViewDefinitionsRepository(this._dataItemFactory),this._setViewDefinitions(),this._viewHolder=new this.imports.ViewHolder(this._dataItemFactory,this._typesManager,this._viewDefRepo,this._resolveResourcePath),this._presenter=new this.imports.QuickSearchPresenter(this._dataItemFactory,d),this._handlePresenterEvents(),this._eventBinding=new this.imports.EventBinding(this._viewHolder.getEventDispatcher(),this._presenter);for(var f=Constants.WixAppsSystemTypes,g=0;g<f.length;g++)this._typesManager.registerType(f[g]);this._bindKeyboardShortcut()},_handlePresenterEvents:function(){this._presenter.on("searching",this,function(){this.setState("searching")}),this._presenter.on("finish-search",this,function(){this.setState("results")}),this._presenter.on("idle",this,function(){this.setState("idle")})},startSearch:function(){this._presenter.startSearch(),this.getViewNode().getElement("input").focus()},updateAvailableWidth:function(a){this._presenter.updateAvailableWidth(a)},_setViewDefinitions:function(){var a=_.pluck(this.resources.wixapps.integration.gui.QuickActionsSearchViews,"name");this._viewName=a[0];var b=this;_.each(a,function(a){var c=b.resources.W.AppsGUI.getViewDescriptor(a);b._viewDefRepo.setViewDefinition(c)})},_bindKeyboardShortcut:function(){var a=this.resources.W.InputBindings;this.resources.W.Commands.registerCommandAndListener("WEditorSearch.StartSearch",this,this.startSearch),a.addBinding(["ctrl+space","command+space"],{commandName:"WEditorSearch.StartSearch"})},_onAllSkinPartsReady:function(){this._updateViewHolder();var a=this._eventBinding;_.each(this.resources.wixapps.integration.gui.QuickActionsSearchViews,function(b){a.setupHandlers(b)})},_resolveResourcePath:function(a){if(a){var b=a.match(/^(http:\/\/)/);if(b)return a;var c=this.resources.W.Theme.getProperty("WEB_THEME_DIRECTORY");
return c+a}return a},_updateViewHolder:function(){this._viewHolder.setContainer(this._skinParts.inlineContent),this._viewHolder.setupViewHolder(this._presenter.getModel(),this._viewName)},dispose:function(){this._presenter.dispose(),this._viewHolder.dispose(),this._eventBinding.dispose(),this._presenter=null,this._viewHolder=null,this._eventBinding=null,this.parent()}})}),define.experiment.Class("wixapps.integration.components.traits.AppsGUITrait.LazyProvision",function(a,b){a.resources(b.merge(["W.AppStoreManager"])),a.methods({_getAppDefinitionId:function(a){var b=a.getAppInstance();return b.getAppDefinitionId()},_getWidgetId:function(a){var b=a.getPartDef();return b.id},_onOpenEditDataDialog:function(a){if(W.Config.siteNeverSavedBefore()){if(W.Editor.getEditorStatusAPI().getSaveInProcess())return;W.EditorDialogs.openWixAppsSiteMustBeSaved()}else{var b=this,c=a.selectedComp;this.resources.W.AppStoreManager.getAppDefinitionData(this._getAppDefinitionId(c),function(d){if(!d)throw"Error: AppData not found";"Template"===d.state?b.resources.W.AppStoreManager.provisionApp(b.WIX_APP_PART_TYPE,b._getAppDefinitionId(c),b._getWidgetId(c),function(c){b.reloadApplication(c),b._actualOpenEditDataDialog(a)}):b._actualOpenEditDataDialog(a)})}}})}),define.experiment.Class("wixapps.integration.components.traits.AppsGUITrait.Playlist",function(a,b){a.resources(b.merge(["W.Commands"])),a.methods({_actualOpenEditDataDialog:function(a){var b=a.selectedComp.getAppPartLogic();if(b.getDataEditDialogParams){var c=b.getDataEditDialogParams();W.EditorDialogs.openIframeDialog(c.url,c.params).addEvent("dialogClosed",c.onClosedCallback)}else{var d=this.resources.W.Commands,e=function(a,c){b.onAfterDataEdit&&b.onAfterDataEdit(a,c,d)},f=function(){var c=b.getDataEditingModel&&b.getDataEditingModel(),d=c.getPanelSkins&&c.getPanelSkins();W.EditorDialogs.openWixAppsDataDialog(a.selectedComp,e,d)};b.onBeforeDataEdit?b.onBeforeDataEdit(d,f):f()}}})}),define.experiment.Class("wixapps.integration.components.traits.FppMetaDataBuilderTrait2.AppBuilderAddItemBeforeAfter",function(a){var b=a;b.methods({_createMetaDataForListAppPart:function(a,b){var c=this._getListTitle(a),d=this._createMetaData(c,a);return b.isSorted()?this._createAddItemLink(d,"FPP_ADD_NEW_ITEM_LABEL",a,0,"FPP_ADD_NEW_ITEM"):(this._createAddItemLink(d,"FPP_ADD_NEW_ITEM_BEFORE_LABEL",a,null,"FPP_ADD_NEW_ITEM_BEFORE","AddBefore"),this._createAddItemLink(d,"FPP_ADD_NEW_ITEM_AFTER_LABEL",a,null,"FPP_ADD_NEW_ITEM_AFTER","AddAfter")),this._createEditItemLink(d,"FPP_EDIT_ITEM_LABEL",a),this._createOpenItemsPanelLink(d,"FPP_LIST_OPEN_ITEMS_PANEL_LABEL"),this._createOpenDesignPanelLink(d,"FPP_LIST_OPEN_DESIGN_PANEL_LABEL",a),this._createOpenOptionsPanelLink(d,"FPP_LIST_OPEN_OPTIONS_PANEL_LABEL",a),this._addMobileCustomItems(d,a),d},_createAddItemLink:function(a,b,c,d,e,f){this._addCustomItem(a,b,"WAppsEditor2Commands.AddNewDataItem",{comp:c,compId:c.getAppPartDefinition().getId(),onDataItemAdded:function(a,b){W.Commands.executeCommand("WAppsEditor2Commands.SelectionChanged",{appPart:c,dataItem:a,index:b[0].index}),W.Commands.executeCommand("WAppsEditor2Commands.OpenEditItem",{reloadBeforeOpen:!0})},itemIndex:d,addedFrom:e,action:f})}})}),define.experiment.Class("wixapps.integration.components.traits.ResizableProxyTrait.AppsWPhotoNBC",function(a,b){var c=a;c.binds(b.merge(["_handleSizeChangeNBConNextRender","_handleSizeChangeNBC"])),c.methods({_activateResizeMechanism:function(){this._disposed||(this._resizeMechanismActivated=!0,this._isNBC()?this._componentLogic.on(this._componentLogic.INVALIDATIONS.SIZE,this._componentLogic,this._handleSizeChangeNBConNextRender):this._componentLogic.addEvent(this.COMPONENT_AUTO_RESIZE_EVENT,this._handleSizeChange),this._def.addEvent(Constants.DataItemEvents.CHANGE,this._onResizableProxyDataChange))},_handleSizeChangeNBConNextRender:function(a){var b=this,c=function(){W.ComponentLifecycle.removeEvent(W.ComponentLifecycle.EVENTS.COMPONENTS_RENDERED,c),b._handleSizeChangeNBC(a)};W.ComponentLifecycle.addEvent(W.ComponentLifecycle.EVENTS.COMPONENTS_RENDERED,c)},_handleSizeChangeNBC:function(a){if(!this.isDisposed()){if(this._componentLogic._sizeDefined=!0,this._isCompBasedWidth()){var b=a.data.current.width;this._element.setStyle("width",b)}if(this._isCompBasedHeight()){var c=a.data.current.height;this._element.setStyle("height",c)}this.fireEvent(Constants.WixAppEvents.APP_CONTENT_RESIZE,{})}}})}),define.experiment.Class("wixapps.integration.components.traits.SelectionResolver.StylesUR",function(a){var b=a;b.methods({_openStyleCustomizer:function(a,b){var c=W.Commands.getCommand("WEditorCommands.AdvancedDesign");c.execute({editedComponent:b.getViewProxy().getCompLogic(),undoRedoSubType:"wixApps"})}})}),define.experiment.Class("wixapps.integration.gui.DataEditPresenter.AppBuilderTagsEditor",function(a,b){a.binds(b.merge(["_updateTagsRepoDataItem","_onDataSelectorChanged","_onTagsChanged"])),a.utilize(b.merge(["wixapps.core.utils.WixAppsLogger"])),a.fields({_logger:null,_tagsRepoDataItem:null}),a.methods({initialize:b.after(function(){this._appPart.addEvent(Constants.WixAppEvents.DATA_SELECTOR_CHANGED,this._onDataSelectorChanged),this._tagsRepoDataItem=this._appInstance.getTagsMapping(),this._tagsRepoDataItem.addEvent(Constants.DataItemEvents.CHANGE,this._updateTagsRepoDataItem),this._logger=new this.imports.WixAppsLogger}),setupPresenter:b.after(function(){this.resources.W.Commands.registerCommandAndListener("WEditorCommands.StartEditingMultiSelection",this,this._onBeforeStartEditingText),this.resources.W.Commands.registerCommandAndListener("WEditorCommands.StopEditingMultiSelection",this,this._onStopEditingText)}),_getNullItemRawData:function(){var a=this._dataItemFactory.createDataItem({_iid:"NULL_ITEM",_type:this._typeName,_tags:[]});this._typesManager.applyDefaults(a);var b=this.resources.W.AppsEditor2.localize("DATA_EDIT_PANEL_ItemNotSelected");return a.getChildByRef("title").setValue(b),a.getValue()},openTagHelpDialog:function(a){this._logger.reportEvent(this._logger.Events.APP_BUILDER_ITEM_TAG_HELP_CLICKED),this.resources.W.Commands.executeCommand("WAppsEditor2Commands.OpenHelpBubble",{appPart:this._appPart,ftHelpSetName:"FT_HELP_ADDING_TAGS_TO_ITEM",anchorElement:a.sender.getParentProxy().getElement()})},_onDataSelectorChanged:function(a){this._usedDataSelector=a,this._updateMetadata()},_updateTagsRepoDataItem:function(a){this._ignoreOriginalChanges=!0,this._model.getChildByRef("_tagMapping").setValue(a.target.getValue()),this._ignoreOriginalChanges=!1},rebuildModel:function(a){this._updateOriginalDataItem();var b=this._originalDataItem?this._originalDataItem.getValue():this._getNullItemRawData();b._tags=b._tags||[],b._tagMapping=this._tagsRepoDataItem.getValue(),this._model.setValue(b),this._model.getChildByRef("_tags").addEvent(Constants.DataItemEvents.CHANGE,this._onTagsChanged),(!this._originalDataItem||a)&&this._updateMetadata()},_onTagsChanged:function(){this._focusElement=this._builderDialogPanel.getViewNode().getElement('div[skinpart="input"]')},_getDataItemValueFromModel:function(){var a=this._model.getValue();return delete a._tagMapping,a},_debouncedDataItemUpdated:_.debounce(function(a){this.resources.W.Commands.executeCommand("WAppsEditor2Commands.DataItemUpdated",a)},1500),_onModelChanged:function(a){if(!this._ignoreOriginalChanges&&this._originalDataItem){this._ignoreModelChanges=!0;var b=this._getDataItemValueFromModel(),c=this._originalDataItem.getValue();this._originalDataItem.setValue(b);var d=a.currentTarget.getChildRef(a.target),e={oldValue:c,dataItem:this._originalDataItem,changedFieldName:d};this._usedDataSelector.isListSelector()&&this._usedDataSelector.isSorted()&&this._usedDataSelector.getSortField()===d?this._debouncedDataItemUpdated(e):this.resources.W.Commands.executeCommand("WAppsEditor2Commands.DataItemUpdated",e),this._ignoreModelChanges=!1,this._updateMetadata()}},_onOriginalItemChanged:function(){if(!this._ignoreModelChanges&&this._originalDataItem){this._ignoreOriginalChanges=!0;var a=this._originalDataItem.getValue();a._tagMapping=this._tagsRepoDataItem.getValue(),this._model.setValue(a),this._ignoreOriginalChanges=!1}},_setTextFocusOnEdit:function(a){var b=this;if(this._builderDialogPanel){var c=Q.defer();Q.resolve().then(function(){var a=b._builderDialogPanel.getViewNode().getParent("[comp*=InputGroup]");return a?a.hidden||c.resolve():c.reject(),c.promise}).then(function(){var c=b._focusElement||a&&"tags"===a.focusOn&&b._builderDialogPanel.getViewNode().getElement('div[skinpart="input"]')||b._builderDialogPanel.getViewNode().getElement('input[type="text"]');c&&c.focus(),delete b._focusElement})}},dispose:b.before(function(){this.resources.W.Commands.unregisterCommand("WEditorCommands.StartEditingMultiSelection"),this.resources.W.Commands.unregisterCommand("WEditorCommands.StopEditingMultiSelection"),this._appPart.removeEvent(Constants.WixAppEvents.DATA_SELECTOR_CHANGED,this._onDataSelectorChanged),this._tagsRepoDataItem&&(this._tagsRepoDataItem.removeEvent(Constants.DataItemEvents.CHANGE,this._updateTagsRepoDataItem),this._tagsRepoDataItem=null)})})}),define.experiment.Class("wixapps.integration.gui.DataEditPresenter.ScrollManager",function(a,b){a.fields({_inputGroupParent:null}),a.binds(b.merge(["_onBeforeStartEditingText","_onStopEditingText"])),a.methods({setupPresenter:b.after(function(){this._inputGroupParent=this._builderDialogPanel.getViewNode().getParent("[comp*=InputGroup]"),this.resources.W.Commands.registerCommandAndListener("WAppsEditor2Commands.BeforeStartEditingText",this,this._onBeforeStartEditingText),this.resources.W.Commands.registerCommandListenerByName("WEditorCommands.StopEditingText",this,this._onStopEditingText)}),_onStopEditingText:function(){this._inputGroupParent.style.overflow="auto"},_onBeforeStartEditingText:function(){this._inputGroupParent.style.overflow="hidden"},dispose:b.before(function(){this.resources.W.Commands.unregisterCommand("WAppsEditor2Commands.BeforeStartEditingText"),this.resources.W.Commands.unregisterListener("WEditorCommands.StopEditingText")})})}),define.experiment.Class("wixapps.integration.gui.DataItemsSelectionPresenter.AppBuilderTagsEditor",function(a,b){a.fields({_tags:[],_dataSelectors:[],_originalDataSelector:null,_appPart:null,_typeDef:null,_type:null}),a.resources(b.merge(["W.Editor","W.AppsGUI","W.EditorDialogs"])),a.utilize(b.merge(["wixapps.integration.gui.FilterByTagsBubblePresenter"])),a.binds(b.merge(["_updateTagsInModel","_onTagsChanged","_userTagChanged"])),a.methods({initialize:function(a,b,c,d,e,f){this._appPart=a,this._predefinedSettings=this._appPart.getAppPartDefinition().getDataSelectorDef().predefinedSettings,this._originalDataSelector=this._appPart.getDataSelector(),this._type=b,this._appInstance=c,this._typeDef=this._appInstance.getTypesManager().getType(this._type),this._initDataSelectors(),this._okCallback=d||function(){},this._cancelCallback=e||function(){},this._selectedTags=[],this._dataItemFactory=this._appInstance.getDataItemFactory(),this._logger=new this.imports.WixAppsLogger,this._args=f||{}},setupPresenter:function(a){this._builderDialogPanel=a;var b=this;this.resource.getResourceValue("W.AppsEditor2",function(a){var c=b._args.logicalTypeName||b._originalDataSelector.getLogicalTypeName();b._appsEditor2Mgr=a,b._buildModel(),b._createMetaData(),b._initSelector(c),b.updateSelector(c)}),this._builderDialogPanel.getViewHolder().performActionWhenReady(function(){b.openNoSelectedTagsBubbleHelp()})},_buildModel:function(){var a=this._appInstance.getDataItemFactory();this._tags=this._appInstance.getTagsMapping(),this._model=a.createDataItem({items:[],allTags:[],userTags:{},sortFields:{items:[],selectedValue:null},sortAscending:!0,selectorTypes:[{value:this.MANUAL_SELECTED_SELECTOR_TYPE,text:this._appsEditor2Mgr.localize("FILTER_DIALOG_Select_Items","Select Items")},{value:this.TAGS_SELECTOR_TYPE,text:this._appsEditor2Mgr.localize("FILTER_DIALOG_Use_Tags","Use Tags")}],selectedType:this._originalDataSelector.getLogicalTypeName(),userDefinedTags:this._predefinedSettings?!0:!1,selectedTags:[]}),this._setSelectedTags(),this._updateTagsInModel(),this._model.getChildByRef("allTags").addEvent(Constants.DataItemEvents.CHANGE,this._onTagsChanged),this._updateSortInModel(this._model.getValue())},_initSelector:function(a){a===this.TAGS_SELECTOR_TYPE&&this._getDataSelector(a).setTags(this._selectedTags)},_setSelectedTags:function(){var a=this._getDataSelector(this._model.getChildByRef("selectedType").getValue());this._selectedTags=this._predefinedSettings?this._predefinedSettings.tags:a.getLogicalTypeName()===this.TAGS_SELECTOR_TYPE?a.getTags():[],this._model.getChildByRef("selectedTags").setValue(this._selectedTags)},_updateTagsInModel:function(){this._model.getChildByRef("allTags").setValue(this._createAllTags(this._selectedTags)),this._updateSelectorPredefinedSettings()},_createUserSelectionTagDropdown:function(){var a=[],b=this._model.getChildByRef("allTags").getValue();b&&(a=_.filter(b,{selected:!0})),a.unshift({value:"all",text:this._appsEditor2Mgr.localize("FILTER_DIALOG_All_Tags","All")}),this._model.getChildByRef("userTags").setValue({items:a,selectedValue:this._predefinedSettings?this._predefinedSettings.selectedTag:""})},enableUserDefinedTags:function(){this._updateSelectorPredefinedSettings(!0),this._logger.reportEvent(this._logger.Events.APP_BUILDER_FILTER_SELECTION_UOU_FILTERING_ENABLE)},disableUserDefinedTags:function(){var a=this.TAGS_SELECTOR_TYPE;this._getDataSelector(a).setTags(this._selectedTags),this._predefinedSettings=null,this.updateSelector(a),this._model.getChildByRef("userDefinedTags").setValue(!1),this._logger.reportEvent(this._logger.Events.APP_BUILDER_FILTER_SELECTION_UOU_FILTERING_DISABLE)},_getSelectedTagsCount:function(){return this._model.getChildByRef("allTags").getChildren().length},_createMetaData:function(){var a={selectionCountLabel:this._createSelectionCountLabel(),selectedTagsCount:this._getSelectedTagsCount()};this._metaData=this._dataItemFactory.createDataItem(a)},_handleDialogButtons:function(){this._selectedTags.length>0?this._builderDialogPanel.enableButton("OK"):this._builderDialogPanel.disableButton("OK")},_onTagsChanged:function(a){var b=this.TAGS_SELECTOR_TYPE,c=this._getDataSelector(b),d=a.target.getChildValue("value");a.target.getChildValue("selected")?this._selectedTags.push(d):_.pull(this._selectedTags,d),c.setTags(this._selectedTags),this._updateSelectorPredefinedSettings(),this._model.getChildByRef("selectedTags").setValue(this._selectedTags),this._handleDialogButtons(),this.updateSelector(b)},closeBubble:function(){this.resources.W.EditorDialogs.closeDialogById("FTHelpBubble_2")},onBeforeDialogClose:function(a){if(this.closeBubble(),a&&"OK"==a.result){var b=this._getDataSelector();this._updateDataSelector(b),this._logger.reportEvent(this._logger.Events.APP_BUILDER_FILTER_SELECTION_CLICK_OK,{i1:b.getLogicalTypeName(),c1:JSON.stringify(b.getDefinition()),c2:this._model.getChildValue("userDefinedTags")}),this._okCallback(b,this._predefinedSettings)}else{var c={};this._logger.reportEvent(this._logger.Events.APP_BUILDER_FILTER_DIALOG_CANCELED,c),this._cancelCallback()}},openNoSelectedTagsBubbleHelp:function(){this._tags.getChildren().length>0&&0===this._selectedTags.length&&this.resources.W.Commands.executeCommand("WAppsEditor2Commands.OpenHelpBubble",{appPart:this._appPart,ftHelpSetName:"FT_FILTER_TAGS",anchorElement:this._builderDialogPanel.getViewNode().getElement("[vcfield=tags]")})},selectDataSelector:function(a){this.closeBubble();var b=a.params.type;b===this.TAGS_SELECTOR_TYPE?(0===this._tags.getChildren().length&&this.openTagsFilterBubbleHelp(a),this._handleDialogButtons()):this._builderDialogPanel.enableButton(this.resources.W.EditorDialogs.DialogButtonSet.OK),this._logger.reportEvent(this._logger.Events.APP_BUILDER_FILTER_SELECTION_SELECT_TYPE,{i1:b}),this.updateSelector(b)},_updateSelectorPredefinedSettings:function(a){if(!this._getDataSelector().hasPredefinedSettings()||!this._predefinedSettings&&!a)return this._model.getChildByRef("userDefinedTags").setValue(!1),void 0;var b=this._selectedTags,c=this._model.getChildByRef("userTags").getChildByRef("selectedValue"),d=c?c.getValue():this._predefinedSettings?this._predefinedSettings.selectedTag:null,e=d&&_.contains(b,d)?d:"all";this._predefinedSettings={tags:b,selectedTag:e},c&&c.removeEvent(Constants.DataItemEvents.CHANGE,this._userTagChanged),this._createUserSelectionTagDropdown(),this._model.getChildByRef("userTags").getChildByRef("selectedValue").addEvent(Constants.DataItemEvents.CHANGE,this._userTagChanged),this._model.getChildByRef("userDefinedTags").setValue(!0)},_updateDataSelector:function(a){if(a.getLogicalTypeName()===this.MANUAL_SELECTED_SELECTOR_TYPE){var b=[];Object.each(this._selectedItems,function(c,d){var e=a.getItemIdIndex(d);e=e>=0?e:b.length,b.splice(e,0,d)}.bind(this)),_.isEqual(_.keys(this._selectedItems),_.keys(this._previouslySelected))?this._reportDataSelectionChange(!1):this._reportDataSelectionChange(!0),a.setItemIds(b)}else a.getLogicalTypeName()===this.TAGS_SELECTOR_TYPE&&a.setPredefinedSettings(this._predefinedSettings);a.hasPredefinedSettings()||(this._predefinedSettings=null)},_userTagChanged:function(){this._updateSelectorPredefinedSettings(),this._logger.reportEvent(this._logger.Events.APP_BUILDER_FILTER_SELECTION_UOU_FILTERING_TAG_SELECTED,{i1:this._predefinedSettings.selectedTag})},updateSelector:function(a){var b="string"==typeof a?a:a.params.type,c=this._getDataSelector(b);if(this._model.getChildByRef("selectedType").setValue(b),"IB.ManualSelectedList"===b)this._updateAllItemsSelector();else{var d=this;c.getData(function(a){var b=d._convertItemsToObjectModel(a.getChildren(),c.getSortField());d._model.getChildByRef("items").setValue(b),d._updateMetadata()})}},_convertItemsToObjectModel:function(a,b){var c=this._originalDataSelector.getItemIds(),d=/^(-?(?:[1-9][0-9]*)?[0-9]{4})-(1[0-2]|0[1-9])-(3[01]|0[1-9]|[12][0-9])T(2[0-3]|[01][0-9]):([0-5][0-9]):([0-5][0-9])(\.[0-9]+)?(Z|[+-](?:2[0-3]|[01][0-9]):[0-5][0-9])?$/,e=function(a){return d.test(a)?new Date(a).toUTCString().replace(" GMT",""):a};return _.map(a,function(a){var d=a.getChildValue("_iid");return{id:d,title:a.getChildValue("title")?a.getChildValue("title"):this._appsEditor2Mgr.localize("DATA_EDIT_PANEL_UntitledItem"),selected:c.contains(d),description:b&&"title"!==b?e(a.getChildValue(b)):""}}.bind(this))},_createAllTags:function(a){var b=_.mapValues(this._tags.getValue(),function(a){return{tag:a,selected:!1}});return _.each(a,function(a){b[a].selected=!0}),_(b).keys().map(function(a){return{value:a,text:b[a].tag,selected:b[a].selected}}).value()},_initDataSelectors:function(){var a=this._originalDataSelector.getDefinition(),b=this._appInstance.getDataSelectors(),c=_.clone(a),d=this._originalDataSelector.getItemIds();c.itemIds=a.itemIds||d;var e=b.createInstance("IB.ManualSelectedList",this._originalDataSelector.getDataProvider(),this._type,c),f=_.clone(a);f.tagIds="IB.TagsFilteredList"===this._originalDataSelector.getLogicalTypeName()?this._originalDataSelector.getTags():[];var g=b.createInstance("IB.TagsFilteredList",this._originalDataSelector.getDataProvider(),this._type,f);this._dataSelectors=[e,g]},openHelpDialog:function(a){var b=a.data.getChildValue("helpId");W.Commands.executeCommand("WEditorCommands.ShowHelpDialog",b)},openTagsFilterBubbleHelp:function(a){var b=a.params&&a.params.forceOpen;if("IB.TagsFilteredList"!==this._originalDataSelector.getLogicalTypeName()&&(!this._dontShowTagsFilterBubbleHelp||b)){this._dontShowTagsFilterBubbleHelp=!0;var c={title:this._appsEditor2Mgr.localize("FILTER_DIALOG_TAGS_HELP_TITLE"),descriptions:[this._appsEditor2Mgr.localize("FILTER_DIALOG_TAGS_HELP_DESCRIPTION")],iconSrc:"images/icons/tags-filter-bubble-help.gif",helpLink:{title:this._appsEditor2Mgr.localize("FILTER_DIALOG_Learn_more"),helpId:"/node/19865"}},d=new this.imports.FilterByTagsBubblePresenter(this._appPart,c,"appbuilder_help_bubble_TagsFilteredList"),e=this._builderDialogPanel.getViewNode().getElement("[vcfield=tab_IB.TagsFilteredList]"),f=e.getPosition(),g=e.getSize(),h=this.resources.W.AppsGUI.getDialogParams("","","basicPopup");h=_.assign(h,{width:600,minHeight:324,allowScroll:!1,position:Constants.DialogWindow.POSITIONS.DYNAMIC,buttonSet:this.resources.W.EditorDialogs.DialogButtonSet.NONE,top:f.y+g.y+17,left:f.x-g.x-86,nonModal:!1,semiModal:!1,allowDrag:!1,dialogSkin:"wixapps.integration.skins.dialogs.HelpBubbleDialogWindowSkinUpArrow"}),this.resources.W.AppsGUI.openDialog(this._appInstance,"TagsHelpBubble",d,h,[])}},_updateSortInModel:function(){this.closeBubble();var a=this._model.getValue(),b=this._getDataSelector();b.isSorted()||(b=this._getDataSelector("IB.TagsFilteredList")),a.sortFields.selectedValue=b.getSortField(),a.sortAscending=b.isSortAscending();var c=this._appsEditor2Mgr.getTypesHelper(),d=_.map(c.getSortableFields(this._typeDef),function(a){return{value:a.name,text:a.displayName}});a.sortFields.items=_.sortBy(d,"text"),this._model.setValue(a)},_getSelectionCount:function(){return Object.keys(this._selectedItems).length},_getTotalItemsCount:function(){return this._model.getChildByRef("items").getChildren().length},_createSelectionCountLabel:function(){var a=this._getSelectionCount()+"",b=this._getTotalItemsCount()+"",c=this._appsEditor2Mgr.localize("DATA_ITEMS_SELECTION_ITEM_COUNT");return c=c.replace("%count%",a).replace("%total%",b)},onSelectAllOrNone:function(){this._getSelectionCount()===this._getTotalItemsCount()?this.selectNone():this.selectAll()},_updateAllItemsInModel:function(a){var b=this._originalDataSelector.getItemIds();this._selectedItems=_.object(b,_.times(b.length,function(){return!0}));var c=this._convertItemsToObjectModel(a);c.sort(function(a,c){var d=b.indexOf(a.id),e=b.indexOf(c.id);return d>-1&&e>-1?d-e:d>-1&&-1===e?1:-1===d&&e>-1?-1:a.title>c.title?1:a.title<c.title?-1:0}),this._model.getChildByRef("items").setValue(c),this._previouslySelected=_.clone(this._selectedItems),this._updateMetadata()},_updateAllItemsWithSelection:function(a){for(var b=this._model.getValue().items,c=0;c<b.length;c++){var d=b[c];d.selected=a,this._setItemSelectionState(d.id,a)}this._model.getChildByRef("items").setValue(b)},_getDataSelector:function(a){return a=a||this._model.getChildValue("selectedType"),_.find(this._dataSelectors,function(b){return b.getLogicalTypeName()===a})},tagSelected:function(a){var b=a.cause.getData().value;if(""!==b){var c="IB.TagsFilteredList",d=this._getDataSelector(c);d.setTags("all"!==b?[b]:[]),this.updateSelector(c)}},setSortField:function(a){var b=a.cause.getData().value,c=this._getDataSelector();c.setSortField(b),this.updateSelector(c.getLogicalTypeName())},changeSortDirection:function(){this.closeBubble();var a=!this._model.getChildValue("sortAscending");this._model.getChildByRef("sortAscending").setValue(a);var b=this._getDataSelector();b.sortAscending(a),this.updateSelector(b.getLogicalTypeName()),this._logger.reportEvent(this._logger.Events.APP_BUILDER_FILTER_SELECTION_CLICK_SORT,{i1:a})}})}),define.experiment.Class("wixapps.integration.gui.DataItemsSelectionPresenter.AppRepoRefactor",function(a){a.methods({updateSelector:function(a){var b="string"==typeof a?a:a.params.type,c=this._getDataSelector(b);if(this._model.getChildByRef("selectedType").setValue(b),"IB.ManualSelectedList"===b)this._updateAllItemsSelector();else{var d=this;c.getData(function(a){var b=d._convertItemsToObjectModel(a.getChildren());d._model.getChildByRef("items").setValue(b)})}},_updateAllItemsSelector:function(){this._allItemsOfTypeSelector=this._appsEditor2Mgr.getAllItemsOfTypeDataSelector(this._type,this._appInstance);var a=this;this._allItemsOfTypeSelector.getData(function(b){a._updateAllItemsInModel(b.getChildren())})}})}),define.experiment.Class("wixapps.integration.gui.ManageItemsPresenter.AppBuilderTagsEditor",function(a,b){a.binds(b.merge(["_onDataSelectorChanged","_onUserTagChanged","_onPredefinedSettingsChanged"])),a.methods({initialize:b.after(function(){delete this._appPartDataSelector,this._model=this._dataItemFactory.createDataItem({}),this._appPart.addEvent(Constants.WixAppEvents.DATA_SELECTOR_PREDEFINED_SETTINGS_CHANGED,this._onPredefinedSettingsChanged),this._appPart.addEvent(Constants.WixAppEvents.DATA_SELECTOR_CHANGED,this._onDataSelectorChanged)}),_onDataSelectorChanged:function(){this._updateMetadata()},_updateMetadata:function(){var a=this._isMobile(),b=this._appPart.getDataSelector(),c={noItems:0===this._itemsData.getChildren().length,allowDrag:"IB.ManualSelectedList"==b.getLogicalTypeName()&&!a,allowListActions:b.isListSelector()&&!a,allowEditItem:!a};this._setMetaDataValue(c)},onItemMoved:function(a){var b=a.cause.oldIndex,c=a.cause.newIndex;this._ignoreChanges=!0,W.UndoRedoManager.startTransaction();var d=this._appPart.getDataSelector();d.moveItem(b,c),this.resources.W.Commands.executeCommand("WAppsEditor2Commands.Undo.DataSelectorDataChange",{changeType:"Move",selector:d,dataItemId:d.getItemIds()[b],newValue:c,oldValue:b,appPart:this._appPart}),W.UndoRedoManager.endTransaction(),this._ignoreChanges=!1;var e=this._listCursor.getCurrentItemIndex(),f=e;e===b?f=c:(e>b&&f--,f>=c&&f++),e!==f&&this._listCursor.setSelectedIndex(f)},rebuildModel:function(a){this._ignoreChanges||(this._createModel(a),this._updateMetadata())},_createUserTagModel:function(){this._itemsTaggedPrefix=this._loc("UserTagsDropdownLabel")+" ";var a=this._predefinedSettings&&this._predefinedSettings.selectedTag;if(this._predefinedSettings=this._appPart.getUserTags().getValue(),a=a||this._predefinedSettings.selectedValue,this._predefinedSettings){for(var b=this._predefinedSettings.items,c=[{value:"all",text:this._loc("FILTER_DIALOG_All_Tags","All")}],d=1;d<b.length;d++)c.push({value:this._predefinedSettings.items[d].value,text:this._itemsTaggedPrefix+b[d].text});return{enabled:this._predefinedSettings.enabled,items:c,selectedValue:a}}return{enabled:!1,items:[{value:"",text:""}],selectedValue:""}},_createModel:function(a){var b=[];a&&this._itemsData.setChildren(a.getRealChildren());for(var c=this._itemsData.getChildren(),d=0;d<c.length;d++){var e=c[d],f=this._createModelItem(e,d);b.push(f)}var g={items:b,userTags:this._createUserTagModel()};this._model.setValue(g),this._predefinedSettings.enabled&&this._model.getChildByRef("userTags").getChildByRef("selectedValue").addEvent(Constants.DataItemEvents.CHANGE,this._onUserTagChanged)},_onPredefinedSettingsChanged:function(a){this._predefinedSettings=a,this._model.getChildByRef("userTags").setValue(this._createUserTagModel())},_onUserTagChanged:function(a){var b=a.newValue;if(this._predefinedSettings.enabled&&b!==this._predefinedSettings.selectedValue){var c=this._appPart.getDataSelector();this._predefinedSettings.selectedValue=b,c.hasPredefinedSettings()&&c.setPredefinedSettings({tags:_(this._predefinedSettings.items).filter(function(a){return"all"!=a.value}).map("value").value(),selectedTag:this._predefinedSettings.selectedValue},function(a){this.rebuildModel(a)}.bind(this)),this._appPart.setUserTagSelectedValue(this._predefinedSettings.selectedValue)}},_onSharedDataChange:function(a){for(var b=this._dataItemUtils.createDataChangeEventList(a,this._itemsData),c=["_iid","title"],d=_.filter(b,function(a){return a.type===Constants.DataItemEvents.CHANGE?2===a.path.length&&_.contains(c,a.path[1]):a.type===Constants.DataItemEvents.CHANGE_EVENT_ACTION_ADD?1===a.path.length:a.type===Constants.DataItemEvents.CHANGE_EVENT_ACTION_DELETE?1===a.path.length:!1}),e=this._model.getChildByRef("items"),f=0;f<d.length;f++){var g,h=d[f],i=h.path[0];if(h.type===Constants.DataItemEvents.CHANGE){var j=h.path[1],k=e.getChildByIndex(i),l=k.getValue();"_iid"===j&&(l.itemId=h.item.getValue()),"title"===j&&(l.title=h.item.getValue()),k.setValue(l)}else if(h.type===Constants.DataItemEvents.CHANGE_EVENT_ACTION_ADD){var m=this._createModelItem(h.item,i);g=e.getValue(),g.splice(i,0,m),e.setValue(g)}else h.type===Constants.DataItemEvents.CHANGE_EVENT_ACTION_DELETE&&(g=e.getValue(),g.splice(i,1),e.setValue(g))}},_listCursorChanged:function(a){var b=a.index,c=a.oldIndex,d=null,e=null,f=this._model.getChildByRef("items");0!==f.getChildrenCount()&&(c>-1&&(d=f.getChildByIndex(c),e=d.getValue(),e.selected=!1,d.setValue(e)),b>-1&&(d=f.getChildByIndex(b),e=d.getValue(),e.selected=!0,d.setValue(e)))},_removeEvents:b.before(function(){this._appPart.removeEvent(Constants.WixAppEvents.DATA_SELECTOR_CHANGED,this._onDataSelectorChanged)})})}),define.experiment.newClass("wixapps.integration.gui.QuickSearchPresenter.QuickActions.New",function(a){var b=a;b.inherits("core.events.EventDispatcher"),b.resources(["W.Data","W.Commands","W.CommandsNew","W.Theme","W.Resources"]),b.binds(["_registerProvider","_updateText"]),b.statics({MAX_CATEGORY_RESULTS:5,BiEvents:{QUICK_FIND_START_SEARCH:{desc:"user start using quick find",type:wixLogLegend.type.userAction,category:wixLogLegend.category.editor,biEventId:100,biAdapter:"hed-misc"},QUICK_FIND_EXECUTE_ACTION:{desc:"user choose an action from the quick actions",type:wixLogLegend.type.userAction,category:wixLogLegend.category.editor,biEventId:101,biAdapter:"hed-misc"},QUICK_FIND_NO_ACTION:{desc:"user leave quick find without selecting an action",type:wixLogLegend.type.userAction,category:wixLogLegend.category.editor,biEventId:102,biAdapter:"hed-misc"},QUICK_FIND_NOT_HELPFUL:{desc:"user did not care for the results",type:wixLogLegend.type.userAction,category:wixLogLegend.category.editor,biEventId:103,biAdapter:"hed-misc"}}}),b.fields({_text:null,_model:null,_providers:[],_visible:!1,_clearingText:!1,_sendBI:!0,_firstUpdate:!0,_hasResults:!0}),b.methods({initialize:function(a,b){this._createModel(a,b),this.resources.W.Commands.executeCommand("WEditorSearch.ReportRegisteredProviders",this._registerProvider),this._actionExecuted=!1},startSearch:function(){this._visible.setValue(!0)},getModel:function(){return this._model},updateAvailableWidth:function(a){var b=this._model.getChildByRef("availableWidth");b.setValue(a)},_registerProvider:function(a){this._providers.push(a)},_createModel:function(a,b){this._model=a.createDataItem({_type:"wix:Object",visible:!1,availableWidth:b,text:"",categories:[]}),this._visible=this._model.getChildByRef("visible"),this._model.getChildByRef("text").addEvent(Constants.DataItemEvents.CHANGE,_.throttle(this._updateText,500));var c=this;this.resources.W.Data.getDataByQuery("#QUICK_ACTIONS_CATEGORIES",function(a){var b=a.get("items"),d=c.resources.W.Theme.getProperty("WEB_THEME_DIRECTORY"),e=_.transform(b,function(a,b){a.push({_type:"wix:Object",name:c.resources.W.Resources.get("EDITOR_LANGUAGE",b.name),id:b.id,color:b.color,icon:{_type:"wix:Image",src:d+b.icon,width:17,height:18},actions:[]})},[]);c._model.getChildByRef("categories").setValue(e)})},_updateModel:function(a){var b=this;this._hasResults=_.filter(a,{isPermanent:!1}).length>0?"Has Results":"No Results";var c=this._model.getChildValue("categories"),d=this._model.getChildByRef("categories"),e=this._firstUpdate;this._firstUpdate=!1,_.each(c,function(c,f){var g=d.getChildByIndex(f),h=g.getChildByRef("actions"),i=g.getChildValue("id"),j=_.filter(a,{category:i,isPermanent:!1}),k=_.filter(a,{category:i,isPermanent:!0});if(!e){var l=h.getValue();j=_.filter(l,{permanent:!1}).concat(j),k=k.concat(_.filter(l,{permanent:!0}))}j=j.slice(0,b.MAX_CATEGORY_RESULTS-k.length),j=j.concat(k),j=_.map(j,function(a){if(a.toObject){var b=a.toObject();return b.selected=!1,b.icon={_type:"wix:Image",src:b.icon||"",width:40,height:40},b.permanent=a.isPermanent,b}return a}),h.setValue(j)})},_search:function(a){this.trigger("searching",{query:a}),this._firstUpdate=!0;var b=this,c=_.map(this._providers,function(c){return c.searchPromise(a).then(function(a){var c=_.sortBy(a,"rating");return b._updateModel(_.pluck(c,"value")),Q.fulfill()})});Q.all(c).done(function(){b.trigger("finish-search")})},_clearText:function(){this.trigger("idle");var a={i1:this._model.getChildValue("text"),c1:this._hasResults};LOG.reportEvent(this.BiEvents.QUICK_FIND_NO_ACTION,a),this._clearingText=!0,this._model.getChildByRef("text").setValue(""),this.resources.W.Commands.executeCommand("WEditorSearch.StartSearch")
},_resetData:function(){this.trigger("idle"),this._visible.setValue(!1),this._model.getChildByRef("text").setValue(""),this._sendBI=!0},_executeAction:function(a){var b=a.data.getValue(),c=this.resources.W.Commands.getCommand(b.command)||this.resources.W.CommandsNew.getCommand(b.command);c.execute(b.commandParameter);var d={i1:this._model.getChildValue("text"),c1:b.category,c2:this._hasResults,g1:b.id};LOG.reportEvent(this.BiEvents.QUICK_FIND_EXECUTE_ACTION,d),this._resetData(),this._actionExecuted=!0},_onBlur:function(){this._actionExecuted||(this._actionExecuted=!1,LOG.reportEvent(this.BiEvents.QUICK_FIND_NOT_HELPFUL)),this.trigger("idle");var a=W.Utils.getQueryParam("disableBlurInSearch");a||setTimeout(function(){this._clearingText||this._resetData(),this._clearingText=!1}.bind(this),500)},_onItemHover:function(a){var b=this._getSelectedActions();b.selectedAction?b.selectedAction.getChildByRef("selected").setValue(!1):b.nextAction.getChildByRef("selected").setValue(!1),a.data.getChildByRef("selected").setValue(!0)},_getSelectedActions:function(){var a=this._model.getChildByRef("categories").getChildren(),b=_.reduce(a,function(a,b){return a.concat(b.getChildByRef("actions").getChildren())},[]),c=_.findIndex(b,function(a){return a.getChildValue("selected")});return-1===c?{previousAction:_.last(b),selectedAction:null,nextAction:_.first(b)}:{previousAction:0===c?_.last(b):b[c-1],selectedAction:b[c],nextAction:c===b.length-1?_.first(b):b[c+1]}},_onKeyUp:function(a){var b;switch(a.cause.key){case"up":b=this._getSelectedActions(),b.selectedAction&&b.selectedAction.getChildByRef("selected").setValue(!1),b.previousAction.getChildByRef("selected").setValue(!0);break;case"down":b=this._getSelectedActions(),b.selectedAction&&b.selectedAction.getChildByRef("selected").setValue(!1),b.nextAction.getChildByRef("selected").setValue(!0);break;case"enter":b=this._getSelectedActions(),b.selectedAction?this._executeAction({data:b.selectedAction}):_.throttle(this._updateText,500);break;case"esc":this._clearText()}},_updateText:function(){var a=this._model.getChildValue("text");switch(a.length){case 0:this._updateModel([]);break;case 1:this._sendBI&&(LOG.reportEvent(this.BiEvents.QUICK_FIND_START_SEARCH),this._sendBI=!1);break;default:;this._search(a)}},_onClick:function(){this._visible.setValue(!this._visible.getValue())}})}),define.experiment.component("wixapps.integration.gui.SelectionHandler.ServerPagination",function(a){a.methods({last:function(){this.setSelectedIndex(this._appPart.getDataSelector().getTotalCount()-1)},setSelectedIndex:function(a,b){if(a!=this._currentItemIndex){var c,d=this._currentItemIndex,e=this._appPart.getDataSelector();return c=e.isListSelector()?e.getTotalCount():this._appPart.getAppPartData().getChildren().length,0===c?(this._currentItemIndex=-1,e.isListSelector()&&e.resetSelectedItem(),void 0):(this._currentItemIndex=a>=c?c-1:0>a?0:a,e.isListSelector()&&e.setSelectedItemByIndex(this._currentItemIndex,function(){this._markCurrentProxy(d,b)}.bind(this)),void 0)}},_markCurrentProxy:function(a,b){var c=this._appPart.getDataSelector();if(this._appPart&&c){var d=this._currentDataItem;this._currentDataItem=c.isListSelector()?c.getSelectedItem():this._appPart.getAppPartData();var e=this._findProxyByDataItem(this._currentDataItem);e?(this._selectionMarker.unmarkSelectedSubComponent(),this._selectionMarker.markSelectedSubComponent(e.getElement()),b||this.notifySelectionChanged(a,d)):this.notifySelectionChanged(a,d)}},_onSelectorAction:function(a){if(a.action==this.imports.ProxySelector.ACTION_MOUSE_DOWN&&this._appPart){var b=a.proxyList[a.proxyList.length-1];if(this._currentDataItem=b.getData(),this._appPart.getDataSelector().isListSelector()){var c=this._appPart.getDataSelector().getItemIdIndex(this._currentDataItem.getChildValue("_iid"));this.setSelectedIndex(c)}else this.setSelectedIndex(0)}}})}),define.experiment.Class("wixapps.integration.managers.ApplicationInstance.WixAppsTranslation",function(a,b){var c=a,d=b;c.methods({initialize:d.after(function(a){this._localizer=new this.imports.ApplicationLocalizer(a.packageName)}),_localizeDescriptor:function(a){return this._localizer.localizeDescriptor(a)},_onDescriptorLoaded:d.around(function(a,b){var c=this;this._localizer.getLocalizerReadyPromise().then(function(){a(b).bind(c)})})})}),define.experiment.Class("wixapps.integration.managers.ApplicationLocalizer.WixAppsTranslation",function(a){a.fields({_bundleName:null,_localizerReadyDeferred:null}),a.methods({initialize:function(a){if(this.parent(),this._localizerReadyDeferred=Q.defer(),this._bundleName=a.toUpperCase(),this.resources.W.Config.isInDebugMode()||this._blackList.push("/views"),!this.resources.W.Resources.isBundleLoaded(this._bundleName)){var b=function(a,b,c){this._locale=c,this._isReady=!0,this._localizerReadyDeferred.resolve(this)},c=function(){this._localizerReadyDeferred.resolve(this)},d={onSuccess:b.bind(this),onFailure:c.bind(this)};this.resources.W.Resources.loadLanguageBundle(this._bundleName,d,this._locale)}},getLocalizerReadyPromise:function(){return this._localizerReadyDeferred.promise},localize:function(a){return this._isReady&&this._resourceManager.isKeyInBundle(this._bundleName,a)?this._resourceManager.get(this._bundleName,a):"["+a+"]"}})}),define.experiment.Class("wixapps.integration.managers.ApplicationPageManager.BlogAddPages",function(a,b){var c=a;c.resources(b.merge(["W.Commands","W.EditorDialogs"]));var d=function(a,b){return a.parentPage&&!b.parentPage?1:b.parentPage&&!a.parentPage?-1:0};c.methods({createAddApplicationPageFunction:function(a,b){var c=this;return function(){var d=Q.defer(),e=c._getApplicationPageBuilder(b.id),f=c.resources.W.Preview.getPreviewManagers().Viewer.getDocWidth(),g=c._getPageIdFromGuid(b.parentPage),h=e({pageName:b.name,appInnerID:a,pageWidth:f});return W.Commands.executeCommand("WEditorCommands.AddPage",{page:h,dontGoToPageUponCreation:!b.showOnCreation,parent:g,callback:function(){return Q.delay(50).then(function(){d.resolve(!0)})}},this),d.promise}},_getAppParentPage:function(a){var b=W.Preview.getPreviewManagers().Apps.getApp(a),c=_.clone(b.getAppPages()),d=_.find(c,function(b){return b.getDataItem().getData().appInnerID===a&&!_.has(b.getPageDefinition(),"parentPage")});return d},addApplicationPages:function(a,b,c,e){var f=W.Preview.getPreviewManagers().Apps.getApp(a),g=this;return f.getDescriptorLoadPromise().then(function(b){if(!b.allowMultiplePageSets&&g._getAppParentPage(a))return g.resources.W.EditorDialogs.openPromptDialog(W.Resources.get("EDITOR_LANGUAGE","ADD_PAGE_"+b.name.toUpperCase()+"_GROUPNAME"),W.Resources.get("EDITOR_LANGUAGE",b.name.toUpperCase()+"_ALREADY_ADDED_APP_TO_SITE"),void 0,g.resources.W.EditorDialogs.DialogButtonSet.OK,function(){}),!1;var f=b.pages||[];f=_.filter(f,function(a){return a.id===e||a.parentPage&&a.parentPage===e}),f.sort(d),c&&f.length&&(f[0].name=c);var h=_.map(f,function(b){return g.createAddApplicationPageFunction(a,b)});return _.reduce(h,Q.when,Q.resolve())}).done(function(a){f.setApplicationActiveState(!0),b(!!a)},function(a){console.log(a.stack||a.message||a)})}})}),define.experiment.Class("wixapps.integration.managers.WixAppsEditorData.ScrollManager",function(a){a.methods({_addDataPanels:function(){this.addDataPanel("AppPart","wixapps.integration.components.AppPart",{logic:"wixapps.integration.components.editor.AppPartDataPanel",skin:"wysiwyg.editor.skins.panels.base.AutoPanelSkin"}),this.addDataPanel("AppBuilderComponent","wixapps.integration.components.AppPart2",{manageOwnScroll:!0,logic:"wixapps.integration.components.panels.ListSettingsPanel",skin:"wysiwyg.editor.skins.panels.base.AutoPanelSkin"})}})}),define.experiment.Class("wixapps.integration.managers.WixAppsEditorManager.BlogAddPages",function(a){a.methods({onProvisionCompleted:function(a,b,c,d,e,f){if(this.registerComponent(a),"wixappsPart"===b)this.addComponentToStage(a,d);else{var g=a.applicationId,h=this.resources.W.Preview.getPreviewManagers().Apps.getApp(g),i=function(a){e.showCategory&&(!e.addWixAppPage||a)&&this._showAddComponentCategoryPanel(e),a&&h.fireEvent(Constants.WixAppEvents.INVALIDATE_PART_DATA,{})}.bind(this);e.addWixAppPage||!h.getApplicationActiveState()?this._applicationPageMgr.addApplicationPages(g,i,e.name,d,f):i(!1)}},_addAppPart:function(a,b){var c=a.applicationId;this._applicationPageMgr.openDestinationPageDialogIfNeeded(c,b,function(){var d=a.widgets[b]||{},e={comp:"wixapps.integration.components.AppPart",data:{type:"AppPart",appInnerID:c,appLogicParams:{"wixapps:first-load-after-add-to-stage":{type:"AppPartParam",value:"true"}},appLogicCustomizations:[],appPartName:b,viewName:""},layout:{width:d.defaultWidth||500,height:d.defaultHeight||500},skin:"wysiwyg.viewer.skins.AppPartSkin"},f=a.packageName+"_"+b+"_1",g=W.Commands.getCommand("WEditorCommands.AddComponentFullParams"),h=this;g.execute({compDef:e,styleId:f,onCreation:function(b){void 0!==b.getAppPartLogic()?h._onAppPartLogicLoaded(b,a):b.addEvent("logicLoaded",function(){h._onAppPartLogicLoaded(b,a)})}})}.bind(this))}})}),define.experiment.Class("wixapps.integration.managers.WixAppsEditorManager.MobileHiddenElementsRefactor",function(a,b){var c=a;c.utilize(b.merge(["wixapps.integration.managers.preview.AppPartComponentDataProvider"])),c.methods({initialize:b.after(function(){this.resources.W.Preview.getPreviewManagersAsync(this._registerPlugins,this)}),_registerPlugins:function(a){var b="wixapps.integration.components.AppPart",c=new this.imports.AppPartComponentDataProvider(b,a.Apps);this.resources.W.Editor.registerComponentDataProviderClass(b,c)}})}),define.experiment.Class("wixapps.integration.managers.WixAppsEditorManager.QuickActions",function(a,b){var c=a;c.utilize(b.merge(["wysiwyg.editor.components.quickactions.WixAppsActionsProvider"])),c.methods({initialize:b.after(function(){new this.imports.WixAppsActionsProvider})})}),define.experiment.Class("wixapps.integration.managers.WixAppsEditorManager.WixAppsTranslation",function(a,b){a.utilize(b.merge(["wixapps.integration.managers.WixAppsLocalizer"])),a.methods({_initialize:function(){this.editorData=new this.imports.WixAppsEditorData,this.editorData.setup(),this.resources.W.Commands.registerCommandAndListener("WAppsEditorCommands.OpenSectionDialog",this,this._openDataSelectionDialog),this.resources.W.Commands.registerCommandAndListener("WAppsEditorCommands.OpenZoomCustomizer",this,this._openZoomCustomizer),this.resources.W.Commands.registerCommandAndListener("WAppsEditorCommands.OpenPageSelectionDialog",this,this._openPageSelectionDialog),this.resources.W.Commands.registerCommandAndListener("WAppsEditorCommands.OpenLayoutCustomizer",this,this._openLayoutCustomizer),this.resources.W.Commands.registerCommandAndListener("WAppsEditorCommands.OpenAppDataViewer",this,this._openDataViewer),this.resources.W.Commands.registerCommandAndListener("WAppsEditorCommands.OpenAppDialog",this,this._openAppDialog),this.resources.W.Commands.registerCommandListenerByName("WEditorCommands.ShowComponentCategories",this,this._onShowComponentCategories),this._applicationPageMgr=new this.imports.ApplicationPageManager,this._localizer=new this.imports.WixAppsLocalizer,this._logger=new this.imports.WixAppsLogger},localize:function(a,b){var c,d=this._localizer.getKeyValue(a);return c=this._localizer.isKeyInWixapps(a)?this._localizer.localize(d,b):this.resources.W.Resources.get("EDITOR_LANGUAGE",d,b)},localizeDescriptorKey:b.remove(),localizeEditorKey:b.remove(),isDescriptorKey:b.remove(),transformToEditorKey:b.remove()})}),define.experiment.Class("wixapps.integration.managers.WixAppsEditorManager2.AppBuilderAddItemBeforeAfter",function(a){a.methods({_onAddNewDataItem:function(a){if(!this._addItemProccessInitiated){var b=a.comp,c=a.fromUndo,d=a.onDataItemAdded,e=a.rawData,f=a.onError,g=b.getDataSelector(),h=a.dataSelectors;if(!h){var i=g.getSelectedItemIndex(),j=a.itemIndex;!j&&i>=0&&("AddBefore"===a.action?j=i:"AddAfter"===a.action&&(j=i+1)),h=[{index:j||0,dataSelector:g}]}var k=b.getAppInstance(),l=g.getSelectionType(),m=k.getTypesManager().getType(l),n=this.getTypesHelper().getDisplayableFields(m);if(0!==n.length){this._addItemProccessInitiated=!0;var o=k.getDataItemFactory();e?this._addClientSideTimestamps(e):e=this._getDataItemDefaultValue(l);var p=o.createDataItem(e);k.getTypesManager().applyDefaults(p);var q=h[0].dataSelector.getDataProvider();q.createItem(p,function(e){this._addDataItemChangeEvent(e,q),_.each(h,function(a){a.dataSelector.addItem(e,a.index)}),c||(W.UndoRedoManager.startTransaction(),this.resources.W.Commands.executeCommand("WAppsEditor2Commands.Undo.DataChange",{dataProvider:q,dataSelectors:h,oldValue:null,newValue:e.getValue(),comp:b,compId:a.compId}),W.UndoRedoManager.endTransaction()),this._addItemProccessInitiated=!1,d&&d(e,h),this._reportItemAdded(k,a.compId,l,a.addedFrom)}.bind(this),function(a,b){this._logger.reportError({code:a,description:b},this.$className,"_onAddNewDataItem",this._logger.SubCategory.DATA_ITEMS,this._logger.Severity.RECOVERABLE,this._logger.Category.EDITOR),f&&f(),this._addItemProccessInitiated=!1}.bind(this))}}},_reportItemAdded:function(a,b,c,d){var e=this.getAllItemsOfTypeDataSelector(c,a),f={c1:c,c2:b,g1:a.getInstanceId(),i1:e.getItemsIdsLocally().length,g2:d||"Unknown-Oops!"};this._logger.reportEvent(this._logger.Events.APP_BUILDER_ITEM_ADDED,f)}})}),define.experiment.Class("wixapps.integration.managers.WixAppsEditorManager2.AppBuilderDeleteType.New",function(a,b){a.resources(b.merge(["W.UndoRedoManager"])),a.binds(b.merge(["_deleteAppPartDialog"])),a.utilize(b.merge(["wysiwyg.editor.commandregistrars.EditCommandRegistrar"])),a.methods({_registerPlugins:b.after(function(){this.resources.W.Commands.executeCommand("WEditorCommands.CommandRegistrarRegisterPlugin",{componentClassName:"wixapps.integration.components.AppPart2",pluginMethods:{onBeforeDelete:this._deleteAppPartDialog}})}),_openDeleteAppPartDialog:function(a,b){var c=this.resources.W.AppsGUI.getDialogParams(this.localize("DELETE_APP_PART_DIALOG_TITLE"),"","");c.width=430,c.minHeight=20,c.allowDrag=!1,c.position=Constants.DialogWindow.POSITIONS.CENTER,c.buttonSet=[W.EditorDialogs.DialogButtons.CANCEL,W.EditorDialogs.DialogButtons.DELETE],this.resources.W.AppsGUI.openDialog(a,"DeleteLastAppPartDialog",b,c)},_deleteAppPartDialog:function(a,b){if(W.Config.env.isViewingSecondaryDevice())return b(),void 0;var c=this._getAppPartFromContainerComp(a);if("error"===c.getState("phase"))return b(),void 0;var d=c.getAppInstance(),e=c.getDataSelector().getSelectionType(),f=this._getAllAppPartsDefinitions(d).then(function(a){var b=_.filter(a,function(a){return a.getType()===e}),c=d.getDataItemFactory().createDataItem({deleteTypeFlag:!1,canDeleteType:1===b.length});return Q.resolve(c)}),g=null,h=this,i=function(){var a=function(a){var c={};h.resources.W.UndoRedoManager.startTransaction(c),b(),h.resources.W.Commands.executeCommand("WAppsEditor2Commands.Undo.TypeDeleted",a),h.resources.W.UndoRedoManager.endTransaction(c)},c=function(){b()};d.deleteType(e,a,c)};f.done(function(a){var c={setupPresenter:function(a){g=a},getModel:function(){return a},onBeforeDialogClose:function(a){if("DELETE"===a.result){var c=this.getModel().getValue();c.deleteTypeFlag?i():b()}},learnMore:function(){h.resources.W.Commands.executeCommand("WEditorCommands.ShowHelpDialog","/node/21939")}};h._openDeleteAppPartDialog(d,c)})},_getAppPartFromContainerComp:function(a){var b=[];return a.isMultiSelect?b=a.getSelectedComps():a.IS_CONTAINER&&(b=a.getDescendantComponentsRecurse(a,b)),b&&b.length&&(b=_.filter(b,function(a){return a.isAppPart2})),b[0]||a},_reportSaveToBi:function(a,b,c){var d=a.getAppPartDefinitions(),e=d.getIds(),f={c1:a.getInstanceId(),i1:e.length,i2:b};c&&(f.error=c);for(var g={},h=0;h<e.length;h++){var i=d.getById(e[h]);if(a.getDataSelectors().exists(i.getDataSelectorId())){var j=a.getDataSelectors().getById(i.getDataSelectorId());g[e[h]]=j.getBiInfo()}}f.g2=JSON.stringify(g),this._logger.reportEvent(this._logger.Events.APP_BUILDER_SAVE,f)}})}),define.experiment.Class("wixapps.integration.managers.WixAppsEditorManager2.AppBuilderTagsEditor",function(a,b){a.resources(b.merge(["W.UndoRedoManager"])),a.methods({_registerCommands:b.before(function(){this.resources.W.Commands.registerCommandAndListener("WAppsEditor2Commands.CreateTag",this,this._createTag),this.resources.W.Commands.registerCommandAndListener("WAppsEditor2Commands.DataItemUpdated",this,this._onDataItemUpdated),this.resources.W.Commands.registerCommandAndListener("WAppsEditor2Commands.ChangeDataSelector",this,this._changeDataSelector)}),_changeDataSelector:function(a){var b=a.appPart.getDataSelector();a.appPart.setDataSelector(a.dataSelector),a.appPart.setDataSelectorPredefinedSettings(a.dataSelectorPredefinedSettings),a.listSettingsPanel.fireEvent(Constants.WixAppEvents.DATA_SELECTOR_CHANGED,a.dataSelector);var c={};this.resources.W.UndoRedoManager.startTransaction(c);var d={appPart:a.appPart,oldValue:b,newValue:a.dataSelector};this.resources.W.Commands.executeCommand("WAppsEditor2Commands.Undo.DataSelectorChanged",d),this.resources.W.UndoRedoManager.endTransaction(c)},_createTag:function(a){var b=this._getApplicationInstance(),c=b.addTag(a.displayName);a.callback&&a.callback(c),this._logger.reportEvent(this._logger.Events.TAG_CREATED,{i1:a.displayName})},_createDataSelectorDefinition:function(a){var b={id:a,predefinedSettings:null};return b},_createAppPage:function(a){var b=a.appInnerID,c=a.pageName,d=a.appPart,e=a.onPageCreated,f=d.getAppInstance(),g=d.getDataSelector().getDataProvider(),h=d.getAppPartDefinition().getType(),i=d.getAppPartDefinition().getViewName(),j=i+"_item_page",k=f.getViewDefinitions().getViewDefinition(h,i,"");k=this._viewBuilder.generatePageView(k.getValue(),"Center",630),k.forType=h,k.name=j,f.addViewDefinition(k);var l,m=f.getPages().getPageDefByType(h);l=m?m.getId():this._createAndRegisterPage(f,h,c);var n=f.getDataSelectors(),o=n.createAndRegister("IB.PageSelectedItem",g,h,{appPageId:l}),p=this._createDataSelectorDefinition(o),q=f.getTypesManager().getType(h),r=q.displayName,s=this.resources.W.Resources.get("EDITOR_LANGUAGE","FPP_LIST_ITEM_TITLE","Item").replace("%friendly_type_name%",r),t=f.getAppPartDefinitions().createAndRegister(p,j,h,s);this._applicationPageMgr.addAppBuilderApplicationPage(b,l,f,c,t),e&&setTimeout(function(){e(l)},1e3)},_prepareDataForCopiedComp:function(a,b,c,d){var e=b.getViewDefinitions(),f=c.getType(),g=c.getViewName(),h=g+"_dup_"+this.resources.W.Utils.AppsUtils.getTimeBasedUniqueId();e.duplicateListViewDefinition(b,g,h,f,f);var i=_.cloneDeep(c.getDataSelectorDef());i.id=d.getId();var j=this._ensureUniqueWidgetName(b,c.getDisplayName()),k=b.getAppPartDefinitions().createAndRegister(i,h,f,j);return{type:"AppBuilderComponent",appInnerID:a,appPartName:k}},_setupAppPart:function(a,b,c){this._closeAppBuilderManageDialog();var d,e=a.getDataItemFactory(),f=b.view,g=f.name,h=f.forType,i=b.data;d=a.getDataProviders().getWixDbDataProvider(),d.registerDataItemsChange(this._addDataItemChangeEvent,this._removeDataItemChangeEvent);var j=a.getTypesManager(),k=Object.clone(b.type);d.createType(k);for(var l=0;l<i.length;l++){var m=i[l];this._addClientSideTimestamps(m),m._tags=m._tags||[];var n=e.createDataItem(m);j.applyDefaults(n),d.createItem(n)}d.adminTypeMigration(k);var o=this._getSelectorLogicalType(c),p=_.pluck(i,"_iid"),q=a.getDataSelectors().createAndRegister(o,d,h,{itemIds:p}),r=this._createDataSelectorDefinition(q);a.addViewDefinition(f),this._setAdditionalViewDefinitions(c,b,a),a.setupCustomizations([]);var s=a.getAppPartDefinitions().createAndRegister(r,g,h,b.friendlyName),t=a.getApplicationId();return this._addAppPartComponent(t,a,s,b),s},_onCreateAppPartByType:function(a){var b=a.typeName,c=a.appInstance,d=a.templateId||"BlankList",e="IB.ManualSelectedList",f=this._generateNewListNameForCollection(c,b),g=a.type||"list",h=c.getDataSelectors(),i=c.getDataProviders().getWixDbDataProvider(),j=c.getApplicationId(),k=this.getAllItemsOfTypeDataSelector(b,c),l=this._viewBuilder.getViewTemplateDefinition(d),m=l.view,n=m.name,o=this;k.getData(function(){var a=k.getItemIds(),d=h.createAndRegister(e,i,b,{itemIds:a}),p=o._createDataSelectorDefinition(d);m.forType=b,c.addViewDefinition(m),o._setAdditionalViewDefinitions(g,l,c);var q=c.getAppPartDefinitions().createAndRegister(p,n,b,f);o._addAppPartComponent(j,c,q,l)})},_getApplicationInstance:function(){var a=this._getApps2Manager().getApplicationInstances(),b=_(a).toArray().first();return b},_onDataItemUpdated:function(a){var b=this._getApplicationInstance();_.isEqual(a.oldValue,a.dataItem.getValue())||b.updateDataSelectors(a.oldValue,a.dataItem)},_getDataItemDefaultValue:function(a){return this._addClientSideTimestamps({_iid:this.resources.W.Utils.AppsUtils.getTimeBasedUniqueId(),_type:a,_tags:[]})},_onDataItemSelectionRequested:function(a){var b=a.appPart,c=a.type,d=a.appInstance,e=a.okCallback,f=a.cancelCallback;this._openDataItemSelectionDialog(b,c,d,e,f,a.args)},_openDataItemSelectionDialog:function(a,b,c,d,e,f){var g=new this.imports.DataItemsSelectionPresenter(a,b,c,d,e,f),h=this.resources.W.AppsGUI.getDialogParams(this.localize("FILTER_DIALOG_Title"));h=Object.merge(h,{dialogSkin:"wysiwyg.editor.skins.dialogs.WDialogWindowSkin",width:610,minHeight:515,position:"center",level:1,allowScroll:!1,showToolbar:!1,nonModal:!1,allowDrag:!0,buttonSet:this.resources.W.EditorDialogs.DialogButtonSet.OK_CANCEL,helpButtonId:"/node/19865"}),this.resources.W.AppsGUI.openDialog(c,this._getFilterSelectionViewName(),g,h,["TabView"]),this._logger.reportEvent(this._logger.Events.APP_BUILDER_FILTER_SELECTION_DIALOG_OPEN,{i1:a.getDataSelector().getLogicalTypeName()})},_getFilterSelectionViewName:function(){return"FilterSelection.AppBuilderTagsEditor2"}})}),define.experiment.Class("wixapps.integration.managers.WixAppsEditorManager2.AppRepoRefactor",function(a){a.methods({_reportAppPartPasted:function(a,b,c){var d={i1:a?1:0,c1:JSON.stringify(b.getDefinition()),c2:JSON.stringify(c.getDefinition())};this._logger.reportEvent(this._logger.Events.APP_PART_PASTED,d)},_onPartCopied:function(a){var b=a.getAppPartDefinition(),c={c1:JSON.stringify(b.getDefinition())};this._logger.reportEvent(this._logger.Events.APP_PART_COPIED,c)},_onCreateAppPartByType:function(a){var b=a.typeName,c=a.appInstance,d=a.templateId||"BlankList",e="IB.ManualSelectedList",f=this._generateNewListNameForCollection(c,b),g=a.type||"list",h=c.getDataSelectors(),i=c.getDataProviders().getWixDbDataProvider(),j=c.getApplicationId(),k=this.getAllItemsOfTypeDataSelector(b,c),l=this._viewBuilder.getViewTemplateDefinition(d),m=l.view,n=m.name,o=this;k.getData(function(){var a=k.getItemIds(),d=h.createAndRegister(e,i,b,{itemIds:a});m.forType=b,c.addViewDefinition(m),o._setAdditionalViewDefinitions(g,l,c);var p=c.getAppPartDefinitions().createAndRegister(d,n,b,f);o._addAppPartComponent(j,c,p,l)})}})}),define.experiment.Class("wixapps.integration.managers.WixAppsEditorManager2.BlinkyFormContainerEditor",function(a,b){a.traits(b.merge(["wixapps.integration.managers.traits.FormsEditorManagerTrait","wixapps.integration.components.common.minipart.editor.MiniPartFppMetaDataBuilderTrait"])),a.methods({_onAddNewDataItem:function(a){this.resources.W.Preview.getPreviewManagersAsync(function(b){var c=this,d=function(b,d,e){c._addDataItemChangeEvent(b,d),a.fromUndo||(W.UndoRedoManager.startTransaction(),c.resources.W.Commands.executeCommand("WAppsEditor2Commands.Undo.DataChange",{dataProvider:d,dataSelectors:e,oldValue:null,newValue:b.getValue(),comp:a.comp,compId:a.compId}),W.UndoRedoManager.endTransaction()),a.onDataItemAdded&&a.onDataItemAdded(b,e)};b.Commands.executeCommand("WApps2Commands.AddNewDataItem",{comp:a.comp,compId:a.compId,rawData:a.rawData,dataSelectors:a.dataSelectors,itemIndex:a.itemIndex,action:a.action,onDataItemAdded:d,onError:a.onError})},this)},_getDataItemDefaultValue:b.remove(),_onDeleteField:function(a){var b,c=a.comp,d=c.getAppInstance(),e=c.getDataSelector(),f=e.getSelectionType(),g=e.getDataProvider(),h=function(){var e={};try{W.UndoRedoManager.startTransaction(e);var h=[],i=d.getViewDefinitions(),j=i.getViewDefinitionsByType(f);for(b=0;b<j.length;b++){for(var k=j[b],l=k.getValue(),m=Object.clone(l),n=this._viewBuilder.findByData(l,a.fieldName),o=0;o<n.length;o++)this._viewBuilder.removeFieldFromView(l,n[o].id);k.setValue(l),h.push({oldValue:m,newValue:l})}var p=this._getMiniPartsOfField(f,a.fieldName);_.each(p,function(a){this.resources.W.Editor.doDeleteComponent(a)}.bind(this));var q=d.getTypesManager().getType(f),r=Object.clone(q);r.fields=r.fields.filter(function(b){return b.name!==a.fieldName});var s=g.updateType(r);this.resources.W.Commands.executeCommand("WAppsEditor2Commands.Undo.FieldRemoved",{viewRepo:i,dataProvider:g,comp:c,fieldName:a.fieldName,modifiedViews:h,modifiedItems:s,typeNewValue:r,typeOldValue:q})}finally{W.UndoRedoManager.endTransaction(e)}}.bind(this);this._beforeDeleteField(d,f,h)},_beforeDeleteField:function(a,b,c){var d=a.getAppPartDefinitions().countAppPartOfType(b,!1),e=a.getFormDefinitions().countFormOfType(b);d+e>0?this._openPromptDialog(this.localize("CONFIRM_REMOVE_FIELD_TITLE"),this.localize("CONFIRM_REMOVE_FIELD_DESCRIPTION"),"",this.resources.W.EditorDialogs.DialogButtonSet.DELETE_CANCEL,function(a){("DELETE"==a.result||"$AUTOMATED$"==a.result)&&c()},this._userExperience.KEYS.DELETE_FIELD_CONFIRM):c()},_getMiniPartsOfField:function(a,b){var c=this.resources.W.Preview.getSiteNode().getElements("[comp=wixapps.integration.components.common.minipart.viewer.MiniPart]");return _(c).map("$logic").compact().filter(function(c){return c.getType()===a&&c.getRawData().field===b}).value()}})}),define.experiment.Class("wixapps.integration.managers.WixAppsEditorManager2.ClientTimestamps",function(a,b){a.resources(b.merge(["W.UndoRedoManager"])),a.methods({_addCreatedAndUpdatedAt:function(a){var b=(new Date).toISOString();return a._updatedAt=b,a._createdAt=b,a},_addClientSideTimestamps:function(a){return this._addCreatedAndUpdatedAt(a)},_removeDataItemChangeEvent:function(a){var b=this._dataItemChangeCallbacks[a];if(b){var c=b.callback,d=b.dataItem;return d.removeEvent(Constants.DataItemEvents.CHANGE,c),b}},_setUpdatedAtAndFireUndoCommandOnIt:function(a){var b=this._removeDataItemChangeEvent(a.target.getChildValue("_iid")),c=a.target.getChildByRef("_updatedAt"),d=c.getValue(),e=(new Date).toISOString();c.setValue(e),b.dataItem.addEvent(Constants.DataItemEvents.CHANGE,b.callback),this.resources.W.Commands.executeCommand("WAppsEditor2Commands.Undo.DataItemChange",{dataItem:c,changeEvents:[{target:c,currentTarget:c,_previousTargets:[c],phase:Constants.DataItemEventPhase.ON_TARGET,oldValue:d,newValue:e}]})},_onDataItemChanged:function(a){if(a.phase==Constants.DataItemEventPhase.ON_TARGET){var b=_.pluck(a.events,"payload"),c=_.filter(b,function(b){return!(b.hasOwnProperty("action")&&a.target===b.target||this._typesHelper.isServerGeneratedField(a.target,b.target))}.bind(this));if(c.length){W.UndoRedoManager.startTransaction();var d=_(c).unique("target").map("target").value();this._setUpdatedAtAndFireUndoCommandOnIt(a),_.each(d,function(a){var c=_.filter(b,{target:a}),d={dataItem:a,changeEvents:c};this.resources.W.Commands.executeCommand("WAppsEditor2Commands.Undo.DataItemChange",d)}.bind(this),this),W.UndoRedoManager.endTransaction()}}}})}),define.experiment.Class("wixapps.integration.managers.WixAppsEditorManager2.EditorLoadPerPage",function(a){a.methods({saveDraft:function(a,b,c,d,e){var f=this,g=this._getApps2Manager();this.getAppBuilderApplicationInstance(function(h){var i=g.getClientSpecMapEntry(),j=f._validateBeforeSaveDraft(a,h,i,c);return j?(e("",j),void 0):(f._reportStartSave(a,h.getInstanceId(),c,b),h.setApplicationId(i.applicationId),h.setInstanceId(i.instanceId),h.setIsStubStore(!1),Q.resolve().then(function(){f.performCleanup(h)}).then(function(){var d=W.ClipBoard.getClip();d&&d.data&&"AppBuilderComponent"===d.data.type&&W.ClipBoard.resetClip();var e={appInstance:h,isOverride:b,isFirstSave:c,metasiteId:a};return f._updateAppRepo(e)}).then(f._updateAppRepo).then(f._updateDataStore).then(f._takeRevisionSnapshot).done(d,function(a){a.code?e(a.description,a.code,a.payload):e("Non-recoverable wixapps error",1970)}),void 0)})},_getAllAppPartsDefinitions:function(a){return this.resources.W.Preview.getSiteDataHandlerPromise().then(function(b){var c=b.getComponentsOfType("wixapps.integration.components.AppPart2"),d=_.reduce(c,function(b,c){if(parseInt(c.appInnerID)===a.getApplicationId()){var d=a.getAppPartDefinitions().getById(c.appPartName);b.push(d)}return b},[]);return Q.resolve(d)})},performCleanup:function(a){return this._getAllAppPartsDefinitions(a).then(function(b){return a.performCleanup(b),Q.resolve()})}})}),define.experiment.Class("wixapps.integration.managers.WixAppsEditorManager2.MobileHiddenElementsRefactor",function(a,b){var c=a;c.utilize(b.merge(["wixapps.integration.managers.preview.AppPart2ComponentDataProvider"])),c.methods({_registerPlugins:b.after(function(a){var b="wixapps.integration.components.AppPart2",c=new this.imports.AppPart2ComponentDataProvider(b,a.Apps2);this.resources.W.Editor.registerComponentDataProviderClass(b,c)})})}),define.experiment.Class("wixapps.integration.managers.WixAppsEditorManager2.WixappsCrashRestore",function(a,b){a.utilize(b.merge(["wixapps.core.apprepo.AppRepoLocalBackupTransport"])),a.methods({initialize:b.after(function(){this._appRepoBackupTransport=new this.imports.AppRepoLocalBackupTransport}),setDataForBackup:function(a){this.getAppBuilderApplicationInstance(function(b){var c=function(){};this._appRepoBackupTransport.startTracking(),this._appRepoBackupTransport.updateInstance(b,b.getInstanceId(),!0,c,c);var d=this._appRepoBackupTransport.stopTracking(),e=b.getDataProviders().getWixDbDataProvider(),f=e.getBackupData();a.wixapps=d.concat(f)}.bind(this))}})}),define.experiment.Class("wixapps.integration.managers.WixAppsEditorManager2.WixAppsTranslation",function(a,b){a.utilize(b.merge(["wixapps.integration.managers.AppBuilderLocalizer"])),a.fields({_localizer:null}),a.methods({initialize:b.after(function(){this._localizer=new this.imports.AppBuilderLocalizer}),localize:function(a,b){return this._localizer.localize(a,b)}})}),define.experiment.Class("wixapps.integration.managers.WixAppsGUIManager.QuickActions.New",function(a,b){var c=a,d=b;c.resources(d.merge(["wixapps.integration.gui.QuickActionsSearchViews"])),c.methods({initialize:d.after(function(){this.registerViewDescriptors(this.resources.wixapps.integration.gui.QuickActionsSearchViews)})})}),define.experiment.Class("wixapps.integration.managers.WixAppsLocalizer.WixAppsTranslation",function(a,b){a.methods({isKeyInWixapps:function(a){return this._resourceManager.isKeyInBundle("WIXAPPS_LANGUAGE",a)},_ensureBundleLoaded:b.remove()})}),define.experiment.Class("wixapps.integration.managers.WixAppsManager.EcomArtifactDeploy",function(a){var b=a;b.methods({requestAppDescriptor:function(a,b){return this._appDescriptorMap[a]?(b(this._appDescriptorMap[a]),void 0):(this.resources.W.Data.getDataByQuery("#WIXAPPS_EXTERNAL_APPS",function(c){var d=c.get("items")[a];if("ecommerce"==a){var e=this;this.resource.getResourceValue("ecommerceDescriptor",function(a){e.registerAppDescriptor(a),b&&b(a)})}else if(void 0!==d)this._loadExternalAppManifest(a,d.descriptorResourceName,b);else{var f=this._buildDescriptorURL(a);this._loadDescriptorFile(f,a,b)}}.bind(this)),void 0)}})}),define.experiment.Class("wixapps.integration.managers.WixAppsManager.EditorLoadPerPage",function(a,b){a.resources(b.merge(["W.Commands"])),a.methods({_initialize:b.after(function(){this._registerCommands()}),_registerCommands:function(){this.resources.W.Commands.registerCommandAndListener("WAppsCommands.LoadAppPage",this,this._loadAppPage)},_loadAppPage:function(a){var b=this;this.resources.W.Viewer.getSiteDataHandlerPromise().done(function(c){var d=c.getComponentsOfType("wixapps.integration.components.AppPage");_.filter(d,{appPageId:a.appPageId}).each(function(a){var c=W.Viewer.getSiteView("DESKTOP").getPageNode(a.id);
b.resources.W.Viewer.loadPageById(a.id,c,function(a){b.resources.W.Commands.executeCommand("WPreviewCommands.BundledPageLoaded",a.pageId)},this)})})}})}),define.experiment.Class("wixapps.integration.managers.WixAppsManager2.AppBuilderTemplateReadFix",function(a){a.methods({_getApplicationRepoInstance:function(a,b,c){W.Config.env.$isPublicViewerFrame?this._loadRepoFunc=this._appRepoTransport.getPublishedInstance.bind(this._appRepoTransport,a,b,c):W.Config.siteNeverSavedBefore()?this._appRepoTransport.getPublishedInstance(a,b,c):this._appRepoTransport.getSavedInstance(a,b,c)}})}),define.experiment.Class("wixapps.integration.managers.WixAppsManager2.AppRepoRefactor",function(a){a.methods({getAllItemsOfTypeDataSelector:function(a,b){var c=this._dataSelectorsForType[a];if(!c){var d={forType:a,dataProviderId:"wixdb"};c=new this.imports.AllItemsOfTypeDataSelector(b,d),this._dataSelectorsForType[a]=c}return this._dataSelectorsForType[a]}})}),define.experiment.Class("wixapps.integration.managers.WixAppsManager2.BlinkyFormContainerEditor",function(a,b){a.utilize(b.merge(["wixapps.core.types.AppBuilderTypesHelper"])),a.resources(b.merge(["W.Utils"])),a.fields({_typesHelper:null}),a.methods({initialize:b.after(function(){this._typesHelper=new this.imports.AppBuilderTypesHelper,this._registerCommands()}),_registerCommands:function(){this.resources.W.Commands.registerCommandAndListener("WApps2Commands.AddNewDataItem",this,this._onAddNewDataItem)},_addCreatedAndUpdatedAt:function(a){var b=(new Date).toISOString();return a._updatedAt=b,a._createdAt=b,a},_getDataItemDefaultValue:function(a,b){var c={_iid:this.resources.W.Utils.AppsUtils.getTimeBasedUniqueId(),_type:a,_tags:[]};return this._addCreatedAndUpdatedAt(_.merge(c,b))},_onAddNewDataItem:function(a){if(!this._addItemProccessInitiated){var b=a.comp,c=b.getAppInstance(),d=b.getDataSelector(),e=d.getSelectionType(),f=this._getDataItemDefaultValue(e,a.rawData),g=a.dataSelectors;if(!g){var h=d.getSelectedItemIndex(),i=a.itemIndex;!i&&h>=0&&("AddBefore"===a.action?i=h:"AddAfter"===a.action&&(i=h+1)),g=[{index:i||0,dataSelector:d}];var j=c.getDataSelectors().getByType(e);_.each(j,function(a){a!==d&&g.push({index:0,dataSelector:a})}),g=_.filter(g,function(a){return a.dataSelector.isListSelector()})}var k=c.getTypesManager().getType(e),l=this._typesHelper.getDisplayableFields(k);if(0!==l.length){this._addItemProccessInitiated=!0;var m=c.getDataItemFactory(),n=m.createDataItem(f);c.getTypesManager().applyDefaults(n);var o=d.getDataProvider();o.createItem(n,function(b){_.each(g,function(a){a.dataSelector.addItem(b,a.index,d)}),this._reportItemAdded(c,a.compId,e,a.addedFrom),a.onDataItemAdded&&a.onDataItemAdded(b,o,g),this._addItemProccessInitiated=!1}.bind(this),function(b,c){this._logger.reportError({code:b,description:c},this.$className,"_onAddNewDataItem",this._logger.SubCategory.DATA_ITEMS,this._logger.Severity.RECOVERABLE,this._logger.Category.EDITOR),a.onError&&a.onError(),this._addItemProccessInitiated=!1}.bind(this))}}},_reportItemAdded:function(a,b,c){var d=this.getAllItemsOfTypeDataSelector(c,a),e={c1:c,c2:b,g1:a.getInstanceId(),i1:d.getItemsIdsLocally().length};this._logger.reportEvent(this._logger.Events.APP_BUILDER_ITEM_ADDED,e)}})}),define.experiment.Class("wixapps.integration.managers.applicationhandlers.ZoomHandler.EcomFeedbackMrg",function(a,b){a.methods({_listenToViewDefChanges:function(a,b){var c=this,d=function(){Q.resolve().then(function(){return c._updateAppPartSize(a)}).done(function(){b(a.getViewNode())})};a.getMainProxy().getViewDefinition().addEvent(Constants.DataItemEvents.CHANGE,d),a.addEvent("proxyDisplayed",d),a.addEvent("invalidateSize",d)}})}),define.experiment.Class("wixapps.integration.managers.undoredomanager.AppBuilderChange.AppBuilderAddItemBeforeAfter",function(a){a.methods({_applyDataChange:function(a,b,c,d,e,f){var g;d?c?(g=this._dataFactory.createDataItem(c),a.updateItem(g)):W.Commands.executeCommand("WAppsEditor2Commands.RemoveDataItem",{fromUndo:!0,dataItemId:d._iid,comp:e,compId:f}):W.Commands.executeCommand("WAppsEditor2Commands.AddNewDataItem",{fromUndo:!0,rawData:c,comp:e,compId:f,dataSelectors:b,addedFrom:"UNDO_REDO_ADD_NEW_ITEM"})}})}),define.experiment.Class("wixapps.integration.managers.undoredomanager.AppBuilderChange.AppBuilderDeleteType",function(a,b){a.resources(b.merge(["W.Commands"])),a.methods({initialize:b.after(function(){this.resources.W.Commands.registerCommand("WAppsEditor2Commands.Undo.TypeDeleted",!0)}),startListen:b.after(function(){this.resources.W.Commands.registerCommandListenerByName("WAppsEditor2Commands.Undo.TypeDeleted",this,this._onTypeDeleted)}),_onTypeDeleted:function(a){var b={type:this.className,changeType:"TypeDeleted",appInstance:a.appInstance,deletedTypeName:a.typeName,deletedTypeObj:a.typeObj,deletedItemsOfType:a.itemsOfType,deletedDataSelectors:a.dataSelectors,deletedPartDefs:a.partDefs,deletedPageDefs:a.pageDefs,deletedViewDefs:a.viewDefs};return this.fireEvent(Constants.UrmEvents.DATA_CHANGE_RECORDED,b),b},_applyRecreateDeletedType:function(a,b,c,d,e,f,g){a.restoreType(b,c,d,e,f,g)},_applyDeleteType:function(a,b){var c=function(){};a.deleteType(b,c,c,!0)},undo:b.after(function(a){"TypeDeleted"===a.changeType&&this._applyRecreateDeletedType(a.appInstance,a.deletedTypeObj,a.deletedItemsOfType,a.deletedDataSelectors,a.deletedPartDefs,a.deletedPageDefs,a.deletedViewDefs)}),redo:b.after(function(a){"TypeDeleted"===a.changeType&&this._applyDeleteType(a.appInstance,a.deletedTypeName)})})}),define.experiment.Class("wixapps.integration.managers.undoredomanager.AppBuilderChange.AppBuilderTagsEditor",function(a,b){a.resources(b.merge(["W.Commands"])),a.methods({initialize:b.after(function(){this.resources.W.Commands.registerCommand("WAppsEditor2Commands.Undo.DataSelectorChanged",!0)}),startListen:b.after(function(){this.resources.W.Commands.registerCommandListenerByName("WAppsEditor2Commands.Undo.DataSelectorChanged",this,this._onDataSelectorChanged)}),_onDataSelectorChanged:function(a){var b={type:this.className,changeType:"DataSelectorChanged",newValue:a.newValue,oldValue:a.oldValue,appPart:a.appPart,changedComponentIds:[a.appPart.getComponentId()]};return this.fireEvent(Constants.UrmEvents.DATA_CHANGE_RECORDED,b),b},_applyDataSelectorChanged:function(a,b){b.setDataSelector(a)},_applyDataItemEvents:function(a,b){function c(a){var b=a.getParent();return b?c(b):a}var d=c(a),e=a.getValue();_.each(b,function(a){if(a.newValue)e=a.newValue;else switch(a.action){case Constants.DataItemEvents.CHANGE_EVENT_ACTION_ADD:_.has(a,"index")?e.splice(a.index,0,a.child.getValue()):e[a.ref]=a.child.getValue();break;case Constants.DataItemEvents.CHANGE_EVENT_ACTION_DELETE:_.has(a,"index")?e.splice(a.index,1):delete e[a.ref];break;case Constants.DataItemEvents.CHANGE_EVENT_ACTION_MOVE:var b=e.splice(a.to,1)[0];e.splice(a.index,0,b);break;case Constants.DataItemEvents.CHANGE_EVENT_ACTION_REPLACE:_.has(a,"index")?e[a.index]=a.child.getValue():e[a.ref]=a.child.getValue();break;default:throw"Can't get the old value of action: "+a.action}});var f=d.getValue();a.setValue(e),this.resources.W.Commands.executeCommand("WAppsEditor2Commands.DataItemUpdated",{oldValue:f,dataItem:d})},undo:b.after(function(a){"DataSelectorChanged"===a.changeType&&this._applyDataSelectorChanged(a.oldValue,a.appPart)}),redo:b.after(function(a){"DataSelectorChanged"===a.changeType&&this._applyDataSelectorChanged(a.newValue,a.appPart)})})}),define.experiment.Class("wixapps.integration.proxies.AppLinkProxy.BlogAddPages",function(a,b){var c=a;c.methods({_resolveAppPageIdPromise:function(a,b){var c=Q.defer(),d=null;if("samePage"===a){if(this.resources.W.Config.env.$isEditorFrame)throw"AppLinkProxy:: cannot resolve [samePage] in editor.";d=W.Data.getDataByQuery("#"+W.Viewer.getCurrentPageId()).get("appPageId")}else{var e=_.map(b.getAppPages(),function(a){return a.getPageDefinition()}),f=null;switch(a){case"parent":f=_.find(e,function(a){return!_.has(a,"parentPage")}),d=f?f.id:null;break;case"singleItem":f=_.find(e,"parentPage"),d=f?f.id:null}}return d?c.resolve(d):_.delay(this._resolveAppPageIdPromise.bind(this,a,b),200),c.promise},_updateLink:function(){var a=this._getHostingComponent(),b=a.getAppInstance(),c=this._def.getChildValue("linkType");if(("nextPage"===c||"prevPage"===c)&&"samePage"!==this._def.getChildValue("pageType"))throw"AppLinkProxy:: unable to create [nextPage]/[prevPage] page links. pageType should be [samePage]";var d=this,e=this._resolveAppPageIdPromise(this._def.getChildValue("pageType"),b);e.then(function(e){b.getPageLinkResolverPromise(e).then(function(b){if(!d.isDisposed()){var f=a.getLogicParams&&a.getLogicParams()||{};b.resolveLinkUrl(e,d._data,f,c,function(a){!d.isDisposed()&&d._element&&d._element.set("href","#!"+a)})}})})}})}),define.experiment.Class("wixapps.integration.proxies.AppLinkProxy.HashRefactor",function(a){var b=a;b.methods({_scrollTop:function(a){a.isChangeFromSetHash||($(document.body).scrollTo(0,0),this.resources.W.Utils.hash.removeEvent("change",this._scrollTop))}})}),define.experiment.Class("wixapps.integration.proxies.Button2Proxy.EcomFeedbackMrg",function(a){var b=a;b.methods({_stylesMap:{"default":{skin:"wysiwyg.viewer.skins.button.BasicButton",style:"b3"},ecomViewCart:{skin:"wysiwyg.viewer.skins.button.BasicButton",style:"ecom_vc1"},ecomCheckout:{skin:"wysiwyg.viewer.skins.button.DisabledLayerButton",style:"ecom_co1"},ecomAddToCart:{skin:"wysiwyg.viewer.skins.button.BasicButton",style:"ecom_atc1"},ecomRemoveFromCart:{skin:"wysiwyg.viewer.skins.button.FixedFontButton",style:"ecom_rfc1"},ecomApplyCoupon:{skin:"wysiwyg.viewer.skins.button.ApplyButtonEcom",style:"ecom_apl1"},ecomAddProduct:{skin:"wysiwyg.viewer.skins.button.AddProductButton",style:"ecom_ap1"},ecomFeedbackCheckout:{skin:"wysiwyg.viewer.skins.button.EcomFeedbackCheckoutButton",style:"ecom_fmc1"},ecomFeedbackContinueShopping:{skin:"wysiwyg.viewer.skins.button.EcomFeedbackContinueShopping",style:"ecom_fmcs1"},ecomFeedbackContinueShopping2:{skin:"wysiwyg.viewer.skins.button.EcomFeedbackContinueShopping2",style:"ecom_fmcs2"}}})}),define.experiment.Class("wixapps.integration.proxies.ButtonProxy.OBC_SiteButton.New",function(a){var b=a;b.methods({_getCompName:function(){return"wysiwyg.viewer.components.SiteButtonOBC"}})}),define.experiment.Class("wixapps.integration.proxies.CheckBoxProxy.AppBuilderTagsEditor",function(a){a.methods({_setupPropertyHandlers:function(){this.parent();var a=this;this._handleProperty("label",function(b){a._componentLogic.setLabel(b)}),this._handleProperty("indeterminate",function(){a._refresh()})},_createRawData:function(){var a=this._def.getChildValue("indeterminate");return{type:"CheckBox",value:this._data.getValue(),indeterminate:a===!0||"true"===a}},_getAcceptableDataTypes:function(){return["Boolean","CheckBox"]}})}),define.experiment.Class("wixapps.integration.proxies.CheckBoxProxy.MediaZoomDispose.New",function(a){a.methods({dispose:function(){this._disposed||(this._data.removeEvent(Constants.DataItemEvents.VALIDATION_PERFORMED,this._onValidation),this.parent())}})}),define.experiment.Class("wixapps.integration.proxies.CheckBoxGroupProxy.MediaZoomDispose.New",function(a){a.methods({dispose:function(){this._disposed||(this._data.removeEvent(Constants.DataItemEvents.VALIDATION_PERFORMED,this._onValidation),this.parent())}})}),define.experiment.Class("wixapps.integration.proxies.ComboBoxProxy.MediaZoomDispose.New",function(a){a.methods({dispose:function(){this._disposed||(this._data.removeEvent(Constants.DataItemEvents.VALIDATION_PERFORMED,this._onValidation),this.parent())}})}),define.experiment.Class("wixapps.integration.proxies.DateSelectorProxy.MediaZoomDispose.New",function(a){a.methods({dispose:function(){this._disposed||(this._data.removeEvent(Constants.DataItemEvents.VALIDATION_PERFORMED,this._onValidation),this.parent())}})}),define.experiment.Class("wixapps.integration.proxies.GridGalleryProxy.WixAppsGalleries.New",function(a){a.methods({_setupPropertyHandlers:function(){this.parent(),this._mapToCompProperties(["transition","autoplayInterval","transDuration","columns","rows","gap"]),this._mapToCompProperty("showNavigation","showNavigation",function(a){return!(a===!1||"false"==a)}),this._mapToCompProperty("showCounter","showCounter",function(a){return!(a===!1||"false"==a)})},_stylesMap:{"default":{skin:"wysiwyg.viewer.skins.paginatedgrid.PaginatedGridDefaultSkin"},productGallery:{skin:"wysiwyg.viewer.skins.paginatedgrid.PaginatedGridSimple",style:"pgg_cg0"},contentGallery:{skin:"wysiwyg.viewer.skins.paginatedgrid.PaginatedGridNoDetail",style:"pgg_cg1"},minipostGallery:{skin:"wysiwyg.viewer.skins.paginatedgrid.PaginatedGridNoDetail",style:"pgg_cg2"},hoverGallery:{skin:"wysiwyg.viewer.skins.paginatedgrid.PaginatedGridNoBG",style:"pgg_cg3"},blogGallery:{skin:"wysiwyg.viewer.skins.paginatedgrid.PaginatedGridNoDetail",style:"pgg_cg4"}},_getDefaultSkinName:function(){var a=this._def.getChildValue("styleNS")||"default";return this._stylesMap[a].skin},_getDefaultStyleName:function(){var a=this._def.getChildValue("styleNS")||"default";return this._stylesMap[a].style}})}),define.experiment.newClass("wixapps.integration.proxies.MultiSelectionProxy.AppBuilderTagsEditor",function(a){a.inherits("wixapps.integration.proxies.WProxy"),a.resources(["W.Data"]),a.utilize(["wixapps.core.utils.WixAppsLogger"]),a.fields({_logger:null}),a.methods({initialize:function(a,b,c,d){this._logger=new this.imports.WixAppsLogger,this.parent(a,b,c,d),this._keyField="value",this._fields=["value","text","selected"],this._itemDataType="SelectOption"},createComponent:function(){return this.items=this._translateToWysiwyg(),this._createWixComponent(this._getComponentType(),{type:"MultiSelectableList",items:this.items})},_onComponentWixified:function(){this._componentLogic.on("itemCreated",this,this._onItemCreated),this._componentLogic.on("itemSelected",this,this._onItemSelected),this._componentLogic.on("itemRemoved",this,this._onItemRemoved)},_onItemCreated:function(a){this._data.addChild(this._translateFromWysiwyg(a))},_onItemRemoved:function(a){this._data.replaceChild(this._translateFromWysiwyg(a),this._getChildIndex(a))},_onItemSelected:function(a){this._data.replaceChild(this._translateFromWysiwyg(a),this._getChildIndex(a))},_getChildIndex:function(a){var b=this._keyField,c=a.data.item.getData()[b];return _.findIndex(this._data.getChildren(),function(a){return a.getChildValue(b)===c})},_getComponentType:function(){return"wysiwyg.common.components.multiselection.viewer.MultiSelection"},_getPropSchemaName:function(){return"MultiSelectionProperties"},_processPropValue:function(a,b){return"selectionOnly"===a?"true"===b||b===!0:b},_setupPropertyHandlers:function(){this.parent(),this._mapToCompProperties(["selectionOnly","placeholder","newItemText"])},_translateToWysiwyg:function(){var a=this;return _(this.getData().getChildren()).map(function(b){var c={type:a._itemDataType};return _.each(a._fields,function(a){c[a]=b.getChildValue(a)}),a.resources.W.Data.createDataItem(c)}).value()},_translateFromWysiwyg:function(a){var b={};return _.each(this._fields,function(c){b[c]=a.data.item.getData()[c]}),b}})}),define.experiment.Class("wixapps.integration.proxies.OptionListInputProxy.MediaZoomDispose.New",function(a){a.methods({dispose:function(){this._disposed||(this._data.removeEvent(Constants.DataItemEvents.VALIDATION_PERFORMED,this._onValidation),this.parent())}})}),define.experiment.Class("wixapps.integration.proxies.OptionsListProxy.MediaZoomDispose.New",function(a){a.methods({dispose:function(){this._disposed||(this._data.removeEvent(Constants.DataItemEvents.VALIDATION_PERFORMED,this._onValidation),this.parent())}})}),define.experiment.Class("wixapps.integration.proxies.PaginatedListProxy.ServerPagination",function(a,b){a.fields({_pagination:b.remove()}),a.binds(["_nextPage","_previousPage"]),a.methods({initialize:function(a,b,c,d){this._def=c,this._logger=new this.imports.WixAppsLogger,this._viewContext=a,this.parent(a,b,c,d),this._initEvents()},_initEvents:function(){this.addEventFilteredByScope("descendant","nextPageClicked",this._nextPage),this.addEventFilteredByScope("descendant","prevPageClicked",this._previousPage)},_initEnvironmentVariables:b.remove(),_onComponentWixified:b.remove(),_getShouldUsePagination:b.remove(),_getLogicArgs:b.remove(),_getPaginationLogic:b.remove(),_onTogglePagination:b.remove(),_reportUserToggledPagination:b.remove(),_onItemsPerPageChanged:b.remove(),_nextPage:function(){this.getViewContext().getEnvironment().getEventsDispatcher().fireEvent("nextPage"),this._scrollToTop()},_previousPage:function(){this.getViewContext().getEnvironment().getEventsDispatcher().fireEvent("previousPage"),this._scrollToTop()},dispose:function(){this.removeEvent("nextPageClicked",this._nextPage),this.removeEvent("prevPageClicked",this._previousPage),this.parent()}})}),define.experiment.Class("wixapps.integration.proxies.ProxyMap.AppBuilderTagsEditor",function(a,b){a.utilize(b.merge(["wixapps.integration.proxies.TagInput2Proxy","wixapps.integration.proxies.MultiSelectionProxy"])),a.methods({registerComponentProxies:b.after(function(a){a.registerProxy("TagInput2",this.imports.TagInput2Proxy,""),a.registerProxy("MultiSelection",this.imports.MultiSelectionProxy,"")})})}),define.experiment.Class("wixapps.integration.proxies.ProxyMap.EcomGalleries.New",function(a){a.methods({_registerGalleryProxies:function(a){"ecommerce"==a.getNameSpace()?(a.registerProxy("Gallery",this.imports.GridGalleryProxy,"Array"),a.registerProxy("SliderGallery",this.imports.SliderGalleryProxy,"Array"),a.registerProxy("ColumnGallery",this.imports.ColumnGalleryProxy,"Array")):(a.registerProxy("Gallery",this.imports.GalleryProxy,"Array"),a.registerProxy("GridGallery",this.imports.GridGalleryProxy,"Array"),a.registerProxy("SliderGallery",this.imports.SliderGalleryProxy,"Array"),a.registerProxy("ColumnGallery",this.imports.ColumnGalleryProxy,"Array"),a.registerProxy("PaginatedColumnGallery",this.imports.PaginatedColumnGalleryProxy,"Array"))}})}),define.experiment.Class("wixapps.integration.proxies.ProxyMap.WixAppsGalleries.New",function(a){a.methods({_registerGalleryProxies:function(a){a.registerProxy("Gallery",this.imports.GridGalleryProxy,"Array"),a.registerProxy("SliderGallery",this.imports.SliderGalleryProxy,"Array"),a.registerProxy("ColumnGallery",this.imports.ColumnGalleryProxy,"Array")}})}),define.experiment.Class("wixapps.integration.proxies.SliderGalleryProxy.WixAppsGalleryField",function(a,b){a.traits(["wixapps.integration.components.traits.ResizableProxyTrait"]),a.utilize(["wixapps.integration.utils.ImageListDataUtils"]),a.binds(b.merge(["_updateComponentSize"])),a.fields({_imageListUtils:null}),a.methods({initialize:function(a,b,c,d){this.parent(a,b,c,d),this._imageListUtils=new this.imports.ImageListDataUtils},createComponent:function(){var a=this._viewContext.getEnvironment().getEventsDispatcher();a.addEvent(Constants.WixAppEvents.APP_VIEW_READY,this._updateComponentSize);var b=this._createWixComponent("wixapps.integration.components.SelectableSliderGallery",this._createRawData(this._data.getValue()),null);return b.setStyle("position","relative"),b},_updateComponentSize:function(){this._componentLogic&&this._componentLogic._onResizeEnd&&this._componentLogic._onResizeEnd()},_createRawData:function(a){return _.forEach(a,function(a){a.src=this._resolveResourcePath(a.src)},this),this._imageListUtils.createImageListDataFromAppsImagesData(a)},_resolveResourcePath:function(a){return this._viewContext.getEnvironment().getProxyFactory().resolveResourcePath(a)},_setupPropertyHandlers:b.after(function(){this._mapToCompProperties(["imageMode","aspectRatioPreset","maxSpeed","loop","galleryImageOnClickAction","margin"])}),_getDefaultStyleName:function(){return"sg1"},_isLayoutBasedWidth:function(){return!0},_isLayoutBasedHeight:function(){return!0},_onDataChanged:function(){if(this._componentLogic){var a=this._data.getValue();this._componentLogic.getDataItem().set("items",this._createRawData(a).items)}},dispose:function(){var a=this._viewContext.getEnvironment().getEventsDispatcher();a.removeEvent(Constants.WixAppEvents.APP_VIEW_READY,this._updateComponentSize),this.parent()},_getWImage:b.remove()})}),define.experiment.newClass("wixapps.integration.proxies.TagInput2Proxy.AppBuilderTagsEditor",function(a){a.inherits("wixapps.integration.proxies.WProxy"),a.binds(["_onItemCreated","_onItemSelected","_onItemRemoved"]),a.resources(["W.Commands"]),a.utilize(["wixapps.core.utils.WixAppsLogger"]),a.fields({_logger:null}),a.methods({initialize:function(a,b,c,d){this._logger=new this.imports.WixAppsLogger,this._ignoreChanges=!1,this.parent(a,b,c,d)},_createAllTags:function(){var a=_.mapValues(this._def.getChildValue("tagMapping"),function(a){return{tag:a,selected:!1}});return _.each(this.getData().getValue(),function(b){a[b].selected=!0}),_(a).keys().map(function(b){return W.Data.createDataItem({type:"SelectOption",value:b,text:a[b].tag,selected:a[b].selected})}).value()},createComponent:function(){return this._createWixComponent(this._getComponentType(),{type:"MultiSelectableList",items:this._createAllTags()})},_onComponentWixified:function(){this._componentLogic.setComponentProperty("newItemText",W.AppsEditor2.localize("EDITOR_TAG_NEW_TAG_TEXT")),this._componentLogic.setComponentProperty("placeholder",W.AppsEditor2.localize("EDITOR_TAG_INPUT_PLACEHOLDER")),this._componentLogic.on("itemCreated",this,this._onItemCreated),this._componentLogic.on("itemSelected",this,this._onItemSelected),this._componentLogic.on("itemRemoved",this,this._onItemRemoved)},_onItemCreated:function(a){this._ignoreChanges=!0;var b=function(b){this.getData().addChild(b),a.data.item.getData().value=b}.bind(this);this.resources.W.Commands.executeCommand("WAppsEditor2Commands.CreateTag",{displayName:a.data.item.get("text"),callback:b}),this._ignoreChanges=!1,this._logger.reportEvent(this._logger.Events.TAG_ADDED_TO_ITEM)},_onItemRemoved:function(a){this._ignoreChanges=!0;var b=_.findIndex(this.getData().getChildren(),function(b){return b.getValue()===a.data.item.get("value")});this.getData().deleteChild(b,1),this._ignoreChanges=!1,this._logger.reportEvent(this._logger.Events.TAG_ADDED_TO_ITEM)},_onItemSelected:function(a){this._ignoreChanges=!0,this.getData().addChild(a.data.item.get("value")),this._ignoreChanges=!1,this._logger.reportEvent(this._logger.Events.TAG_REMOVED_FROM_ITEM)},_getComponentType:function(){return"wysiwyg.common.components.multiselection.viewer.MultiSelection"},_onDataChanged:function(){this._ignoreChanges||this._componentLogic.getDataItem().set("items",this._createAllTags())}})}),define.experiment.Class("wixapps.integration.proxies.TextAreaProxy.MediaZoomDispose.New",function(a){a.methods({dispose:function(){this._disposed||(this._data.removeEvent(Constants.DataItemEvents.VALIDATION_PERFORMED,this._onValidation),this.parent())}})}),define.experiment.Class("wixapps.integration.proxies.TextInputProxy.MediaZoomDispose.New",function(a){a.methods({dispose:function(){this._disposed||(this._data.removeEvent(Constants.DataItemEvents.VALIDATION_PERFORMED,this._onValidation),this.parent())}})}),define.experiment.Class("wixapps.integration.proxies.TimeSelectorProxy.MediaZoomDispose.New",function(a){a.methods({dispose:function(){this._disposed||(this._data.removeEvent(Constants.DataItemEvents.VALIDATION_PERFORMED,this._onValidation),this.parent())}})}),define.experiment.Class("wixapps.integration.proxies.WIntegrationTrait.AppBuilderTags",function(a){a.methods({_applyStyle:function(a,b){if(a){var c={};Object.each(b,function(a,b){if("width"==b||"height"==b)"string"!=typeOf(a)||String.contains(a,"%")||"auto"===a||(a=parseInt(a,10));else if("background"===b||"background-image"===b){var d=/url\((.+)\)/i;if(d.test(a)){var e=_.last(d.exec(a)),f=this._viewContext.getEnvironment().getProxyFactory().resolveResourcePath(e);a=a.replace(e,f)}}c[b]=a}.bind(this)),a.setStyles(c)}}})}),define.experiment.Class("wixapps.integration.proxies.WIntegrationTrait.NBC_RenderOnlyDisplayed",function(a,b){a.binds(b.merge(["_onWixComponentReadyInternal"])),a.methods({_createWixComponent:function(a,b,c){c=c||{},this._initArgs=c,this._isWixificationPending=!0;var d,e,f=this._createCompProperties()||{};!this._def.getChildValue("style")&&this._def.getChildValue("skin")&&this.useSkinsInsteadOfStyles(),e=this._def.getChildValue("style")||this._getDefaultStyleName(),d=this._def.getChildValue("skin")||this._getDefaultSkinName(),this._styleNameSpace=this._def.getChildValue("styleNS")||this._getDefaultStyleNameSpace(),this._initArgs.styleNameSpace=this._styleNameSpace;var g=this._def.getChildValue("skinGroup");g&&(this._initArgs.skinGroup=g);var h=this._createElement();if(this._lifecycleManager.notifyComponentCreated(h),h.setAttribute("comp",a),e&&!this._useSkinsInsteadOfStyles&&h.setAttribute("styleid",e),h.setAttribute("skin",d),b&&(this._dataItem=W.Data.createDataItem(b),this._dataItem.setMeta("isPersistent",!1),this._dataItem.addEvent(Constants.DataEvents.DATA_CHANGED,this._onComponentDataChanged)),f.type){var i=W.ComponentData.addDataItemWithUniqueId("wixApps",f);i&&(i.dataObject.setMeta("isPersistent",!1),h.setAttribute("propertyquery","#"+i.id))}return h.addEvent(Constants.ComponentEvents.WIXIFIED,this._onWixComponentWixifiedInternal),h.addEvent(Constants.ComponentEvents.READY,this._onWixComponentReadyInternal),h},_setComponentReadyIfHidden:function(){this._isNBC()&&this._componentLogic.once(Constants.LifecycleSteps.MEASURE,this,function(){this._componentLogic.isDisplayed()||(this._onWixComponentReadyInternal(),this._element.removeEvent(Constants.ComponentEvents.READY,this._onWixComponentReadyInternal))})},_onWixComponentReadyInternal:function(){this._isWixificationPending=!1,this._applyAccumulatedPropertyChanges(),this._defferedDataChangeEvent&&this._onDataChanged(this._defferedDataChangeEvent),this._onWixComponentReadyInternalNotifyLifecycle(this._element)}})}),define.experiment.Class("wixapps.integration.proxies.WIntegrationTrait.Playlist",function(a){a.methods({_onWixComponentWixifiedInternal:function(a){this._disposed||(this._componentLogic=a,this._updateComponentState(),this._onComponentWixified(),this._registerStyleChangeHandler(),this._applyAfterWixifiedActions.forEach(function(a){a.apply(this)}.bind(this)),this._applyAfterWixifiedActions=[],this._isNBC()?this._componentLogic.on("autoSizeChange",this,this._onAutoSizeChange):this._componentLogic.addEvent("autoSizeChange",this._onAutoSizeChange),this._setComponentReadyIfHidden())},_registerProxyEvents:function(a,b){0===a.indexOf("dom:")?this._nativeEventHandlers.push({type:a.slice(4),handler:b}):this._applyAfterWixified(function(){this._isNBC()?this._componentLogic.on(a,this,b):this._componentLogic.addEvent(a,b)}.bind(this))}})}),define.experiment.Class("wixapps.integration.proxies.traits.AppsLinkTrait.WixAppsGalleryField",function(a,b){var c=a,d=b;c.utilize(d.merge(["wixapps.integration.utils.LinksUtils"])),c.fields({_linksUtils:null}),c.methods({_getLinksUtils:function(){return this._linkUtils?this._linkUtils:this._linkUtils=new this.imports.LinksUtils},_createWLink:function(a,b){b=b||W.Data;var c=this._getLinksUtils().convertAppsLinkToWLink(a);if(!c)return null;var d=b.addDataItem(a.linkId,c);return d.setMeta("isPersistent",!1),d},_createAppsLink:function(a){var b=this._getLinksUtils().convertWLinkToAppsLink(a.getData()),c=this._viewContext.getEnvironment().getDataItemFactory();return c.createDataItem(b)},_createRawLinkData:d.remove()})}),define.experiment.skin("wixapps.integration.skins.WixAppsButtonSkin.NBC_SiteButton.New",function(a){var b=a;b.inherits("core.managers.skin.BaseSkin2")}),define.component("Editor.wixapps.integration.components.common.formcontainer.viewer.FormContainer",function(a,b){var c=a,d=b;c.panel({logic:"wixapps.integration.components.common.formcontainer.editor.FormSettingsPanel",skin:"wysiwyg.editor.skins.panels.base.AutoPanelSkin",manageOwnScroll:!0}),c.styles(1),c.helpIds({componentPanel:"/node/18990"}),c.methods({initialize:d.after(function(){this.EDITOR_META_DATA=_.merge(this.EDITOR_META_DATA,{general:{animation:!1},mobile:{disablePropertySplit:!0}})}),isDeleteableRecurse:function(){if(!this.isDeleteable())return!1;var a=_(this.getViewNode().getElements("[comp]")).map("$logic").filter(function(a){return a&&"wixapps.integration.components.common.submitbutton.viewer.SubmitButton"!==a.$className}).value();return this._isDeleteableRecurse(a)},getShowOnAllPagesChangeability:function(){if(!this._showOnAllPagesChangeability)return!1;for(var a=_(this.getChildComponents()).map("$logic").filter(function(a){return a&&"wixapps.integration.components.common.submitbutton.viewer.SubmitButton"!==a.$className&&"wixapps.integration.components.common.minipart.viewer.MiniPart"!==a.$className}).value(),b=0;b<a.length;b++)if(!a[b].getShowOnAllPagesChangeability())return!1;return!0}})}),define.component("Editor.wixapps.integration.components.common.minipart.viewer.MiniPart",function(a,b){var c=a,d=b;c.panel({logic:"wixapps.integration.components.common.minipart.editor.MiniPartSettingsPanel",skin:"wysiwyg.editor.skins.panels.base.AutoPanelSkin",manageOwnScroll:!0}),c.styles(1),c.helpIds({componentPanel:"/node/18990"}),c.methods({initialize:d.after(function(){this._resizableSides=[Constants.BaseComponent.ResizeSides.LEFT,Constants.BaseComponent.ResizeSides.RIGHT],this.EDITOR_META_DATA=_.merge(this.EDITOR_META_DATA||{},{general:{design:!1,animation:!1,forceHideIconOnRemove:!0}})}),isDeleteable:function(){return this.resources.W.Config.env.$viewingDevice!==Constants.ViewerTypesParams.TYPES.MOBILE},canBeDraggedIntoContainer:function(){return!1},getFormContainer:function(){function a(b){var c=b.getParentComponent();return c?"wixapps.integration.components.common.formcontainer.viewer.FormContainer"===c.$className?c:a(c):null}return a(this)}})}),define.component("Editor.wixapps.integration.components.common.submitbutton.viewer.SubmitButton",function(a,b){var c=a;c.panel({logic:"wixapps.integration.components.common.submitbutton.editor.SubmitButtonPanel",skin:"wysiwyg.editor.skins.panels.base.AutoPanelSkin"}),c.styles(1),c.helpIds({componentPanel:"/node/18990"}),c.methods({isDeleteable:function(){return!1},getShowOnAllPagesChangeability:function(){return!1},canBeDraggedIntoContainer:function(){return!1}})}),define.component("Editor.wixapps.integration.components.AppPage",function(a,b){a.methods({initApp:b.after(function(){this._pageDefinition&&this._pageEnvironment.getBundledPagesIds&&this._loadBundledPages()}),_loadBundledPages:function(){var a=this._pageEnvironment.getBundledPagesIds(this._pageDefinition);_.each(a,function(a){this.resources.W.Commands.executeCommand("WAppsCommands.LoadAppPage",{appPageId:a})},this)}})});