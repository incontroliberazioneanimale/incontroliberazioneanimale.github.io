define.Class("wixapps.automation.AppsEnvInfo",function(a){var b=a;b.methods({generateBreakpointConditionForProxy:function(a,b){b=b||"this._element";var c={element:b,vcField:a.getAttribute("vcfield"),vcType:a.getAttribute("vctype"),vcView:a.getAttribute("vcview")},d="if($element.get('vcfield') === $vcField && $element.get('vctype') === $vcType && $element.get('vcView') === $vcView) debugger;";return Object.keys(c).forEach(function(a){d=d.replace("$"+a,"'"+c[a]+"'")}),d},getApp1Dict:function(){return{menu:"1660c5f3-b183-4e6c-a873-5d6bbd918224",faq:"f2c4fc13-e24d-4e99-aadf-4cff71092b88",news:"045dd836-ef5d-11e1-ace3-c0dd6188709b","ecom-gallery":"30b4a102-7649-47d9-a60b-bfd89dcca135","ecom-cart":"5fca0e8b-a33c-4c18-b8eb-da50d7f31e4a","ecom-view-cart":"c029b3fd-e8e4-44f1-b1f0-1f83e437d45c","ecom-add-to-cart-btn":"c614fb79-dbec-4ac7-b9b0-419669fadecc",rss:"51fbc8b3-e886-4f7e-96bb-9107bca12474"}},app1Views:{menu:["Center","Left","Inline","LeftImage","LeftThumb","Gallery"],faq:["Left","ContainerBox","ExpandQuestions","ExpandQuestionsSep","Expand"],news:["SimpleVList","ImageVList","DateVList"],"ecom-gallery":["SimpleClean","Polaroid","Gallery"],"ecom-cart":["Joined"],"ecom-view-cart":["General"],"ecom-add-to-cart-btn":["Simple"],rss:["List","Grid","Single"]},getApp1List:function(){return Object.keys(this.getApp1Dict())},getApp2List:function(){return Object.keys(Constants.AppBuilderTemplates)}})}),define.Class("wixapps.automation.AutomationLogger",function(a){var b=a;b.resources([]),b.binds(["log","logAction","getLogBuffer"]),b.fields({_logBuffer:[]}),b.methods({startNewIt:function(a){this._logBuffer.push({itName:a,itMessages:[]})},log:function(a){this._logBuffer.length>0&&this._logBuffer[this._logBuffer.length-1].itMessages.push(a)},logAction:function(a){this.log(arguments.length>1?a+"("+[].append(arguments).slice(1).join(", ")+")":a)},toConsole:function(){_.forEach(this._logBuffer,function(a){console.groupCollapsed(a.itName),_.forEach(a.itMessages,function(a){console.log(a)}),console.groupEnd()})},getFailedTests:function(){for(var a=jasmine.runnerResults.suites[0].specs,b=[],c=0;c<a.length;c++)a[c].passed||b.push(c);return b},toString:function(){var a=[];return _.forEach(this._logBuffer,function(b){a.push(b.itName),_.forEach(b.itMessages,function(b){a.push("	"+b)})}),a.join("\n")},getLogBuffer:function(){return this._logBuffer}})}),define.Class("wixapps.automation.AutomationStorage",function(a){var b=a;b.methods({store:function(a,b){var c=Q.defer(),d="write",e=new XMLHttpRequest;return e.onerror=function(){c.reject()},e.onreadystatechange=function(){4===e.readyState&&e.status&&c.resolve(e.response)},e.open("POST","http://127.0.0.1:6660/"+d+"/"+a),e.setRequestHeader("Content-Type","text/plain"),e.send(b),c.promise},retrieve:function(a){var b=Q.defer(),c=new XMLHttpRequest;return c.onerror=function(){b.reject()},c.onreadystatechange=function(){4===c.readyState&&c.status&&b.resolve(c.response)},c.open("GET","http://wysiwyg.pita.wixpress.com/"+a),c.send(),b.promise}})}),define.Class("wixapps.automation.BlogActions",function(a){var b=a;b.resources(["W.EditorDialogs"]),b.binds(["getBlogAppInstance","getBlogFeedPage","removeBlog","getBlogFeed","openFilterPostDialog","getBlogTicker","openFilterPostDialog"]),b.fields({_blog:null}),b.methods({setBlog:function(a){this._blog=a},_saveMessageDialog:function(a){return Q(a).then(wixapps_automation.editor.findDialogWindow).then(function(a){return a.getLogic().triggerConfirmButton(),Q()})},_saveDataEditingDialog:function(a){return a._refreshCategoriesPanel(),a._updateListView(),Q(a).then(wixapps_automation.editor.findDialogWindow).then(function(a){return a.getLogic().triggerConfirmButton(),Q()})},getBlogAppInstance:function(){wixapps_automation.logger.logAction("Action: getBlogAppInstance");var a=W.Preview.getPreviewManagers().Apps.getAppByPackageName("blog");return a?Q(a):Q.reject()},getBlogFeedPage:function(){return wixapps_automation.logger.logAction("Action: getBlogFeedPage"),Q().then(this.getBlogAppInstance).then(function(a){var b=_.filter(a.getAppPages(),{_appPageId:"79f391eb-7dfc-4adf-be6e-64434c4838d9"});if(0==b.length)throw"Blog feed part not found";return Q(b.pop())})},getBlogFeed:function(){return wixapps_automation.logger.logAction("Action: getBlogFeed"),Q().then(this.getBlogAppInstance).then(function(a){var b=_.filter(a.getAppParts(),{_partDef:{id:"4de5abc5-6da2-4f97-acc3-94bb74285072"}});if(0==b.length)throw"Blog feed part not found";return Q(b.pop())})},getBlogTicker:function(){var a=this;return Q().then(function(){return a.getBlogAppInstance()}).then(function(a){var b=_.filter(a.getAppParts(),{_partDef:{id:"33a9f5e0-b083-4ccc-b55d-3ca5d241a6eb"}});if(0==b.length)throw"Blog Ticker part not found";for(var c=[],d=0;d<b.length;d+=2)c.push(b[d]);return Q(c.pop())})},getAllBlogTickerOnStage:function(){return Q().then(this.getBlogAppInstance).then(function(a){var b=_.filter(a.getAppParts(),{_partDef:{id:"33a9f5e0-b083-4ccc-b55d-3ca5d241a6eb"}});if(0==b.length)throw"Blog Ticker part not found";return Q(b)})},addPost:function(a,b,c,d){wixapps_automation.logger.logAction("Action: addPost",a,b,c),void 0===b&&(b=!0);var e=Q.fulfill();c||(e=wixapps_automation.observers.waitForDialogOfType("wixapps.integration.components.editor.DataEditorDialog"),W.Commands.executeCommand("WAppsEditorCommands.OpenEditDataDialog",{selectedComp:this._blog}));var f=this._blog.getAppPartLogic().getDataEditingModel(),g=d||"TextPost",h=f.getItemTemplate(g,!0).getValue();h.title=a;var i=f.addToCache("Posts",h);if(i.setDirty(),b===!0){var j=this;return e.then(function(a){return j._saveDataEditingDialog(a)})}return e},addMediaPost:function(a,b,c){return this.addPost(a,b,c,"MediaPost")},addPosts:function(a){wixapps_automation.logger.logAction("Action: addPosts",a);var b=this;return Q().then(wixapps_automation.editor.openFpp).then(function(){return wixapps_automation.editor.getFppCustomActions(0)}).then(wixapps_automation.element.click).then(function(){return wixapps_automation.observers.waitForDialogOfType("wixapps.integration.components.editor.DataEditorDialog")}).then(function(c){for(var d=[],e=0;a>e;e++)d.push(b.addPost("Test photo post #"+e,!1,!0));return Q.all(d).then(function(){return b._saveDataEditingDialog(c)})}).then(function(){return wixapps_automation.observers.waitForDialogOfType("core.editor.components.dialogs.MessageDialog")}).then(function(a){return b._saveMessageDialog(a)}).then(function(){return wixapps_automation.observers.waitForComponentState(blogFeed,"content")})},removeBlog:function(){return wixapps_automation.logger.logAction("Action: Remove blog"),Q().then(this.getBlogFeedPage).then(function(a){return wixapps_automation.document.deletePage(a.getDataItem().get("id"))})},openFilterPostDialog:function(a){wixapps_automation.logger.logAction("Action: Open filter Dialog ");var b=wixapps_automation.observers.waitForDialogOfType("wixapps.integration.components.editor.DataSelectionDialog");return W.Commands.executeCommand("WAppsEditorCommands.OpenSectionDialog",{selectedComp:a}),b}})}),define.Class("wixapps.automation.ClipBoard",function(a){var b=a;b.resources(["W.ClipBoard","W.Classes"]),b.binds(["cleanUp"]),b.fields({_copiedComponents:null,_addedComponents:[]}),b.methods({copy:function(a){this._copiedComponents=a;var b=a;return Array.isArray(a)&&(b={isMultiSelect:!0,comps:a,getSelectedComps:function(){return a}}),W.ClipBoard.setClip(b),Q()},selectAndCopy:function(a){var b=function(){return W.Commands.executeCommand("EditCommands.Copy"),Q()},c=W.Editor.getSelectedComp();if(c.getDataItem().get("id")!==a.getDataItem().get("id")){var d=Q.fcall(wixapps_automation.observers.waitForSelectionChange).then(function(){return b()});return W.Editor.setSelectedComp(a),d}return b()},_sortAsOriginal:function(a,b){for(var c=[],d=[],e=0;e<this._copiedComponents.length&&d.length<this._copiedComponents.length;e++)for(var f=b(this._copiedComponents[e]),g=0;g<a.length;g++)c.contains(g)||f!==b(a[g])||(c.push(g),d.push(a[g]));return d},paste:function(a,b){var c=this,d=wixapps_automation.observers.waitForSelectionChange().then(function(b){if("wysiwyg.editor.managers.wedit.MultiSelectProxy"===b.$className){var d=b.getSelectedComps();return a&&(d=c._sortAsOriginal(d,function(a){return a.getAppPartDefinition().getType()})),c._addedComponents=c._addedComponents.concat(d),Q(d)}return c._addedComponents.push(b),Q(b)});return W.ClipBoard.paste(b,!0),d},cleanUp:function(){var a=this;return wixapps_automation.editor.cleanUp(this._addedComponents).then(function(){return a._addedComponents=[],a._copiedComponents=null,Q()})}})}),define.Class("wixapps.automation.DataServiceActions",function(a){var b=a;b.resources([]),b.binds(["cleanStore","uploadData","createItem","deleteItem","resetStoreToDescriptorData","resetAppToPreLoadedData"]),b.fields({}),b.methods({getAllItemsInCollection:function(a,b){wixapps_automation.logger.logAction("getAllItemsInCollection",a.getPackageName(),b);var c=Q.defer();return a.getDataService().getTransport().query(b,{},null,0,-1,!1,function(a){c.resolve(a.items)},function(a){c.reject(a)}),c.promise},deleteItem:function(a,b,c){wixapps_automation.logger.logAction("deleteItem",a.getPackageName(),b,c);var d=Q.defer();return a.getDataService().getTransport().deleteItem(b,c,function(){d.resolve(b+"/"+c)},function(a){d.reject(a)}),d.promise},createItem:function(a,b,c){wixapps_automation.logger.logAction("createItem",a.getPackageName(),b,c._iid);var d=Q.defer(),e=_.clone(c,!0);delete e._createdAt,delete e._hash,delete e._updatedAt,delete e._vg;var f=a.getDataItemFactory().createDataItem(e);return a.getDataService().createItem(b,f,function(){d.resolve(b+"/"+c._iid)},function(a){d.reject(a)}),d.promise},cleanStore:function(a){wixapps_automation.logger.logAction("cleanStore",a.getPackageName());var b=this,c={},d=_.map(a.getDescriptorValue(["collections"]),"id"),e=_.map(d,function(d){return Q().then(function(){return b.getAllItemsInCollection(a,d)}).then(function(a){c[d]=a})});return Q.all(e).then(function(){var d=[];return _.forOwn(c,function(c,e){d.append(_.map(c,function(c){return b.deleteItem(a,e,c._iid)}))}),Q.all(d)}).then(function(){return a.getDataService().getItemCache().removeAll(),Q(a)})},extractDescriptorData:function(a){return wixapps_automation.logger.logAction("extractDescriptorData",a.getPackageName()),a.getDescriptorValue(["preLoadedData"])},uploadData:function(a){wixapps_automation.logger.logAction("uploadData",a.getPackageName());var b=this.extractDescriptorData(a),c=this,d=[];return _.forOwn(b,function(b,e){d.append(_.map(b,function(b){return c.createItem(a,e,b)}))}),Q.all(d)},resetStoreToDescriptorData:function(a){return wixapps_automation.logger.logAction("resetStoreToDescriptorData",a.getPackageName()),Q(a).then(this.cleanStore).then(this.uploadData)},resetAppToPreLoadedData:function(a){return wixapps_automation.logger.logAction("resetAppToPreLoadedData",a.getPackageName()),Q(a).then(this.resetStoreToDescriptorData).then(function(){a.getItemCache().removeAll();var b=_.map(a.getAppParts(),this.reloadAppPart);return Q.all(b)})}})}),define.Class("wixapps.automation.Document",function(a){var b=a;b.resources(["W.Commands"]),b.binds(["getPages","cleanUp"]),b.fields({_newPages:[],_viewer:null}),b.methods({_getViewer:function(){return this._viewer?this._viewer:W.Preview?W.Preview.getPreviewManagers().Viewer:W.Viewer},_removePageFromDuplicates:function(a){var b=this._newPages.indexOf(a);-1!=b&&this._newPages.splice(b,1)},getCurrentPageNode:function(){return Q(this._getViewer().getCurrentPageNode())},getPages:function(){return Q(this._getViewer().getPages())},getPage:function(a){return this.getPages().then(function(b){return Q(b[a])})},getCurrentPageId:function(){return Q(this._getViewer().getCurrentPageId())},getCurrentPageTitle:function(){return Q(this._getViewer().getCurrentPageNode().getLogic().getDataItem().get("title"))},getComponentById:function(a){return Q.resolve(this._getCurrentPageNode().getElementById(a).$logic)},deletePage:function(a){wixapps_automation.logger.logAction("Action: delete Page",a);var b,c=this;if(a=a||this.getCurrentPageId(),b=this._getViewer().getPages()[a],!b)throw"Page {0} doesn't exist".format(a);var d=wixapps_automation.observers.waitForDialog().then(function(b){if(c._getViewer().getCurrentPageId()===a){var d=wixapps_automation.observers.waitForEvent(c._getViewer(),"pageTransitionEnded").then(function(){return c._removePageFromDuplicates(a),Q()});return b.triggerConfirmButton(),d}return b.triggerConfirmButton(),c._removePageFromDuplicates(a),Q()});return this.resources.W.Commands.executeCommand("WEditorCommands.DeletePage",b.getLogic().getDataItem()),d},moveToHomePage:function(){wixapps_automation.logger.logAction("Action: Move To home Page :");var a=wixapps_automation.observers.waitForEvent(this._getViewer(),"pageTransitionEnded"),b=W.Preview.getSiteNode(),c=b.getElement("[dataquery=#mainPage]");return c.click(),a},duplicatePage:function(a){var b=this,c=this._getViewer().getCurrentPageId(),d=function(){return b._getViewer().getCurrentPageId()!==c},e=wixapps_automation.observers.waitForEvent(this._getViewer(),"pageTransitionEnded",d).then(function(){var a=b._getViewer().getCurrentPageId();return b._newPages.push(a),Q(a)});if(!a){var f=this._getViewer().getCurrentPageNode();a="Copy of "+f.getLogic().getDataItem().get("title")}return this.resources.W.Commands.executeCommand("WEditCommands.DuplicatePage",{pageHtmlId:c,newPageName:a}),e},registerPage:function(a){return this._newPages.push(a),Q()},cleanUp:function(a){var b=this,c=Q.defer();a||(a=this._newPages);var d=function(){if(a.length){var e=a.pop();Q.fulfill().then(function(){return b.deletePage(e)}).then(function(){d()})}else c.resolve()};return d(),c.promise}})}),define.Class("wixapps.automation.EditorActions",function(a){var b=a;b.resources(["W.AppStoreManager","W.AppsEditor","ecommerceDefObj2G","W.AppsEditor2","W.Editor","W.Preview","W.Commands","W.EditorDialogs"]),b.binds(["addPart1","addComponent","addPart2","getEditedComponent","getFppCustomActions","openFpp","addBlog","selectComponent","reloadAppPart","findDialogWindow","moveToPreviewMode","moveToEditMode"]),b.utilize(["wixapps.automation.drivers.TickerPropertyPanelDriver"]),b.fields({_addedComponents:[],_addedPages:[]}),b.methods({addComponent:function(a,b,c,d,e){wixapps_automation.logger.logAction("addComponent",a.$className,b.$className,JSON.stringify(c._data,null,4));var f=this,g=wixapps_automation.observers.waitForSelectionChange().then(function(a){return f._addedComponents.push(a),wixapps_automation.observers.waitForComponentReady(a)}),h={compData:{comp:a,skin:b,data:c,layout:d,props:e}};return this.resources.W.CommandsNew.executeCommand("WEditorCommands.AddComponent",h,this),g},addPart1:function(a,b,c){wixapps_automation.logger.logAction("addPart1",a,b,c);var d=this,e=wixapps_automation.appsInfo.getApp1Dict();wixapps_automation.appsInfo.app1Views[a]&&"number"===typeOf(b)&&(b=wixapps_automation.appsInfo.app1Views[a][parseInt(b,10)]),a=e[a]||a,c=void 0===c?!0:c;var f=wixapps_automation.observers.waitForSelectionChange(!0).then(function(a){var e=Q.defer();return d._addedComponents.push(a),c&&wixapps_automation.observers.wait(300).then(function(){W.EditorDialogs.closeAllDialogs()}),wixapps_automation.observers.waitForComponentState(a,"content").then(function(){return wixapps_automation.observers.waitForAppPartReady(a)}).then(function(){return d.selectAppPart1View(a,b)}).then(function(){e.resolve(a)}),e.promise}),g=void 0,h=W.AppsEditor.editorData.appsDefinitionData;define.getResourceFetcher().getResourceValue("ecommerceDefObj2G",function(a){g={"55a88716-958a-4b91-b666-6c1118abdee4":a}}),Object.merge(h,g);var i=!1;return Object.each(h,function(b,c){b.widgets&&Object.keys(b.widgets).contains(a)&&(W.AppStoreManager.addComponent("wixappsPart",h[c],a),i=!0)}),i||alert("Relevant application/app-part not found in list provided by app store"),f},_registerAfterAddPart2Actions:function(){var a=this,b=function(a){return a.comp.$className?"wixapps.integration.components.AppPart2"===a.comp.$className:!1},c=wixapps_automation.observers.waitForSelectionChange(!0,b).then(function(b){var c=Q.defer();return a._addedComponents.push(b),wixapps_automation.observers.waitForComponentState(b,"content").then(function(){c.resolve(b)}),c.promise});return c},addPart2:function(a){wixapps_automation.logger.logAction("addPart2",a),a=a||"BasicPosts";var b=this._registerAfterAddPart2Actions();return W.AppsEditor2.getAppBuilderApplicationInstance(function(b){W.AppsEditor2._createAppPartFromTemplate(b,a,"list")}),b},addPart2FromExisting:function(a){wixapps_automation.logger.logAction("addPart2FromExisting",a.getComponentId());var b=a.getAppPartDefinition().getType(),c=this._registerAfterAddPart2Actions();return W.AppsEditor2.getAppBuilderApplicationInstance(function(a){W.Commands.executeCommand("WAppsEditor2Commands.CreateAppByType",{typeName:b,appInstance:a})}),c},getEditedComponent:function(){return wixapps_automation.logger.logAction("getEditedComponent"),Q(W.Editor.getEditedComponent())},getAppPartPropertyPanel:function(a){wixapps_automation.logger.logAction("getPropertyPanel :",a);var b=W.Editor.getPropertyPanel().getViewNode();return wixapps_automation.observers.waitForMinimumElementsToExist(b,b)},createTickerPropertyPanelDriver:function(a){return wixapps_automation.editor.tickerPropertyPanelDriver=new this.imports.TickerPropertyPanelDriver(a),wixapps_automation.editor.tickerPropertyPanelDriver},getFppCustomActions:function(a){return wixapps_automation.logger.logAction("getFppCustomActions",a),Q(W.Editor.getEditorUI().getFloatingPanelComp().getSkinPart("customActions").children[a])},openFpp:function(){wixapps_automation.logger.logAction("openFpp");var a=W.Editor.getComponentEditBox().getPosition();return W.Editor.openComponentPropertyPanels(a,!0,!1),Q(W.Editor.getEditorUI().getFloatingPanelComp())},reloadAppPart:function(a){wixapps_automation.logger.logAction("reloadAppPart",a.getComponentId());var b=wixapps_automation.observers.waitForAppPartReRender(a);return a.getDataItem().fireDataChangeEvent(),b},selectAppPart1View:function(a,b){if(wixapps_automation.logger.logAction("selectAppPart1View",a.getComponentId(),b),a.getDataItem().get("viewName")==b)return Q(a);var c=wixapps_automation.observers.waitForAppPartReRender(a);return a.getDataItem().set("viewName",b),c},addBlog:function(){wixapps_automation.logger.logAction("addBlog");var a,b=this,c=Q.fulfill().then(function(){return wixapps_automation.document.getPages()}).then(function(b){return a=_.keys(b),wixapps_automation.observers.waitForDialogOfType("wysiwyg.editor.components.dialogs.AddAppDialog")}).then(function(a){var b=a.getSkinPart("button").getSkinPart("button"),c=wixapps_automation.observers.waitForDialogWithTitle("Great! You’ve added a blog");return b.getViewNode().click(),c}).then(function(a){return a.triggerConfirmButton(),Q.delay(200)}).then(function(){return wixapps_automation.document.getCurrentPageId().then(function(c){return b._addedPages.push(c),a.push(c),wixapps_automation.document.getPages().then(function(d){var e=_.difference(_.keys(d),a)[0];return b._addedPages.push(e),wixapps_automation.blog.setBlog(W.Preview.getPreviewManagers().Apps.getAppByPackageName("blog").getAppParts()[1]),Q({blogPage:c,singlePostPage:e})})})}),d={showCategory:"blog",widgetId:"31c0cede-09db-4ec7-b760-d375d62101e6"};return this.resources.W.Commands.executeCommand("WEditorCommands.AddWixApp",d),c},addBlankPage:function(){wixapps_automation.logger.logAction("addBlankPage");var a=Q.defer(),b=wixapps_automation.observers.waitForEvent(W.Editor,"site_page_changed!");W.Commands.executeCommand("WEditorCommands.AddPage",{page:{group:"ADD_PAGE_BLANK_GROUPNAME",name:"Blank",applicationType:"HtmlWeb",previewPic:"blank.png",pageDescription:"ADD_PAGE_BLANK_DESCRIPTION",serializedPageData:{componentType:"core.components.Page",type:"Page",id:"mainPage",styleId:"p2",skin:"skins.core.InlineSkin",layout:{x:0,y:0,width:980,height:500,anchors:[]},data:{type:"Page",metaData:{isPreset:!1,schemaVersion:"1.0",isHidden:!1},title:"Blank",hideTitle:!0,icon:"",descriptionSEO:"",metaKeywordsSEO:"",pageTitleSEO:"",pageUriSEO:"blank",hidePage:!1,underConstruction:!1},dataRefs:{},components:[]},isReady:!0}});var c="";return b.then(function(a){return c=a.payload,wixapps_automation.observers.waitForEvent(W.Preview.getPreviewManagers().Viewer,"pageTransitionEnded",function(){return W.Preview.getPreviewManagers().Viewer._currentPageId===c})}).then(function(){a.resolve(c)}),a.promise},addViewHolder:function(a,b,c,d){wixapps_automation.logger.logAction("addViewHolder");var e=Q.defer();return W.Classes.get("wixapps.integration.managers.ViewHolderFactory",function(f){var g=new f,h=g.createViewHolder(a,b,c,d);wixapps_automation.observers.waitForEvent(h,Constants.WixAppEvents.APP_VIEW_CREATED).then(function(){e.resolve(h)})}),e.promise},getAllAppPart2OnPage:function(){return wixapps_automation.logger.logAction("getAllAppPart2OnPage"),wixapps_automation.document.getCurrentPageNode().then(function(a){var b=a.getElements("[comp*=AppPart2]").map(function(a){return a.getLogic()});return Q(b)})},cleanUp:function(a){wixapps_automation.logger.logAction("editor.cleanup",_.map(a,function(a){return a.$className+"#"+a.getComponentId()}));var b=this,c=Q.defer();a||(a=this._addedComponents);var d=function(){a.length?Q(a.pop()).then(b.selectComponent).then(b.deleteSelectedComponent).then(d):wixapps_automation.document.cleanUp(b._addedPages).then(function(){b.resources.W.EditorDialogs.closeAllDialogs(),c.resolve()})};return d(),c.promise},setViewerMode:function(a){wixapps_automation.logger.logAction("setViewerMode",a);var b=wixapps_automation.observers.waitForEvent(this.resources.W.Preview.getPreviewManagers().Viewer,"SiteReady");return this.resources.W.Commands.executeCommand("WEditorCommands.SetViewerMode",{mode:a,src:"automation"}),b},selectComponent:function(a){if(wixapps_automation.logger.logAction("selectComponent",a.$className+"#"+a.getComponentId()),a===this.resources.W.Editor.getSelectedComp())return Q(a);var b=wixapps_automation.observers.waitForSelectionChange(!0);return this.resources.W.Editor.setSelectedComp(a),b},selectComponentQuick:function(a){return wixapps_automation.logger.logAction("selectComponent",a.$className+"#"+a.getComponentId()),this.resources.W.Editor.setSelectedComp(a),Q()},deleteSelectedComponent:function(){var a=wixapps_automation.observers.waitForEvent(W.Editor,"onComponentDelete");return W.Editor.doDeleteSelectedComponent(!0),a},moveToPreviewMode:function(){return wixapps_automation.logger.logAction("moveToPreviewMode"),"PREVIEW"!=W.Config.env.$editorMode&&W.Commands.executeCommand("WEditorCommands.WSetEditMode",{editMode:W.Editor.EDIT_MODE.PREVIEW,src:"previewBtn"}),Q()},moveToEditMode:function(){return wixapps_automation.logger.logAction("moveToEditMode"),"PREVIEW"==W.Config.env.$editorMode&&W.Commands.executeCommand("WEditorCommands.WSetEditMode",{editMode:W.Editor.EDIT_MODE.CURRENT_PAGE,previousEditMode:W.Editor.EDIT_MODE.PREVIEW}),Q()},findDialogWindow:function(a){wixapps_automation.logger.logAction("find dialog window of inner dialog of kind :",a);var b=_.find(W.EditorDialogs._openDialogs,function(b){return b.getLogic().getInnerDialog().getLogic()==a});return b?Q(b):Q.reject("Dialog window for panel not found")}})}),define.Class("wixapps.automation.Element",function(a){var b=a;b.resources(["W.ClipBoard","W.Classes"]),b.binds(["click"]),b.fields({}),b.methods({click:function(a){return a.fireEvent("click"),Q(a)},isVisible:function(a){return"hidden"!=a.getStyle("visibility")&&!_.isEqual(a.getDimensions(),{x:0,y:0,width:0,height:0})}})}),define.Class("wixapps.automation.ListSettings",function(a){var b=a;b.resources(["W.Editor","W.AppsEditor2","W.EditorDialogs","W.Classes","W.Preview"]),b.utilize(["wysiwyg.common.components.traits.LinkableComponent"]),b.binds([]),b.statics({PAGE_LINK_FIELDS:{TITLE:"Title",IMAGE:"Image",DATE:"Date",BUTTON:"Button",PRICE:"Price"},TABS:{ITEMS:"items",DESIGN:"design",OPTIONS:"settings"}}),b.fields({_settingsPanel:null,_component:null}),b.methods({getAppPartSettingsPanel:function(a){if(this._component===a)return Q(this._settingsPanel);var b=this;this._component=a;var c=function(){var a=document.getElement("[comp*=ListSettingsPanel]");return b._settingsPanel=a.getLogic(),Q(b._settingsPanel)};if(a&&a!==this.resources.W.Editor.getSelectedComp()){var d=Q.fcall(wixapps_automation.observers.waitForSelectionChange,!0).then(c);return this.resources.W.Editor.setSelectedComp(a),d}return c()},moveItems:function(a,b,c){var d={cause:{oldIndex:b,newIndex:c}};return this.getAppPartSettingsPanel(a).then(function(a){return a._manageItemPresenter.onItemMoved(d),Q()})},showHideItem:function(a,b,c){var d,e=a.getAppInstance().getDataItemFactory(),f=e.createDataItem(c);return this.getAppPartSettingsPanel(a).then(function(a){var b=wixapps_automation.observers.waitForDialog();return a._manageItemPresenter.selectItems(),b}).then(function(a){d=a;var b=a.getInnerDialog();return Q(b.$logic._presenter)}).then(function(a){var c=a.getModel(),e=c.getChildByIndex(b),g={context:{_data:e},data:f};return a.onItemClick(g),d.triggerConfirmButton(),Q()})},getItems:function(a){var b=Q.defer(),c=a.getDataSelector();return c.getItems(function(a){b.resolve(a)},function(a){b.reject(a)}),b.promise},selectItem:function(a,b){var c=this;return this.getAppPartSettingsPanel(a).then(function(){var a=c.resources.W.AppsEditor2.getSelectionHandler();return a.getCurrentItemIndex()!=b&&a.setSelectedIndex(b),Q()})},addItem:function(a){var b=a.getDataSelector();return this.getAppPartSettingsPanel(a).then(function(a){var c=wixapps_automation.observers.waitForEvent(b,"dataSelectorRefreshed");return a._manageItemPresenter.createItem(),c})},duplicateItem:function(a,b){if(b){var c=this.resources.W.AppsEditor2.getSelectionHandler();c.getCurrentItemIndex()!=b&&c.setSelectedIndex(b)}var d=a.getDataSelector(),e=d.getItemIds().clone();return this.getAppPartSettingsPanel(a).then(function(a){var b=wixapps_automation.observers.waitForEvent(d,"dataSelectorRefreshed");return a._manageItemPresenter.duplicateItem(),b}).then(function(){var a=d.getItemIds(),b=_.difference(a,e);return 1!=b.length?Q.reject():Q(b[0])})},removeItem:function(a,b){var c,d,e,f=this;return this.getAppPartSettingsPanel(a).then(function(c){return e=c,f.selectItem(a,b)}).then(function(){c=a.getDataSelector(),d=c.getItemIds().clone();var b=wixapps_automation.observers.waitForEvent(c,"dataSelectorRefreshed");return e._dataEditPresenter.removeItem(),b}).then(function(){var a=c.getItemIds(),e=_.difference(d,a);return 1!=e.length&&e[0]!==d[b]?Q.reject(new Error("Item was not deleted as expected")):Q()})},getListTypeDisplayName:function(a){return Q(a.getAppPartDefinition().getTypeDef().displayName)},getListPartDisplayName:function(a){return Q(a.getAppPartDefinition().getDisplayName())},changeListTypeDisplayName:function(a,b){return this.getAppPartSettingsPanel(a).then(function(a){var b={data:{getValue:function(){return{name:"settings"}}}};return a.getSkinPart("content").firstChild.getLogic()._presenter.tabSelected(b),Q.delay(300)}).then(function(){var a=document.getElement(".wixApps2ListTypeDisplayName");return a.getLogic().setValue(b),a.getLogic().fireChangeEvent(),Q()})},changeListPartDisplayName:function(a,b){return this.getAppPartSettingsPanel(a).then(function(a){var b={data:{getValue:function(){return{name:"settings"}}}};return a.getSkinPart("content").firstChild.getLogic()._presenter.tabSelected(b),Q.delay(300)}).then(function(){var a=document.getElement(".wixApps2ListDisplayName");return a.getLogic().setValue(b),a.getLogic().fireChangeEvent(),Q()})},copyViewFromComponent:function(a,b){return Q().then(function(){return W.AppsEditor2.openCopyViewDialog(a),wixapps_automation.observers.waitForDialogWithTitle(W.AppsEditor2.localize("COPY_VIEW_Title")).then(function(a){for(var c,d=a.getInnerDialog().getLogic(),e=d._presenter._typeParts,f=0;f<e.length;f++){var g=e[f];g.getDisplayName()===b.getAppPartDefinition().getDisplayName()&&(c=f)}if(void 0===c)throw new Error("The components are not of the same type!");var h=d._presenter._model.getChildByRef("parts").getChildByIndex(c);return d._presenter.selectView({data:h}),a.triggerConfirmButton(),Q()})})},_linkPageCreation:function(a){return Q().then(function(){for(var b=0;b<a.length;b++){var c,d,e;e=W.EditorDialogs._openDialogs[0].getLogic().getInnerDialog().getLogic(),c=$$("[class*="+a[b]+"_link]")[0],c.getLogic().setChecked(!0),c.getProperty("class").split(" ").forEach(function(a){a.contains("_link")&&(d=a.split("_")[2])}),e._fieldClicked(d,!0)}return W.EditorDialogs._openDialogs[0].getLogic().triggerConfirmButton(),wixapps_automation.observers.waitForPageTransition()}).then(function(a){return wixapps_automation.document.registerPage(a.pageId).then(function(){return Q(a.pageDisplayName)})})},addField:function(a,b,c,d,e){a=a||this.resources.W.Editor.getSelectedComp();var f;return this.getAppPartSettingsPanel(a).then(function(a){var b=wixapps_automation.observers.waitForDialogOfType("wixapps.intergration.components.editor.dialogs.AddFieldDialog");return a._customizeItemsPresenter.addField(),b}).then(function(a){f=a;var b=f._selectedItem;if(b&&b.getDataItem().get("text")===c)return Q();var d=_.filter(f.getViewNode().getElements("[comp*=MenuButton]"),function(a){return a.getLogic().getDataItem().get("text")===c})[0],e=wixapps_automation.observers.waitForEvent(f._defaultValueDataItem,Constants.DataItemEvents.CHANGE);return d.click(),e}).then(function(){if(b){var a=f.getSkinPart("nameYourFieldInput");a.setValue(b)}if(d){var c=f.getSkinPart("positionYourFieldInput");c.setValue(d)}var g=f.getParentComponent();return 0==e?Q(g):(g.triggerConfirmButton(),Q())})},getEditFieldDialog:function(a,b){return this.getAppPartSettingsPanel(a).then(function(a){var c=a._customizeItemsPresenter.getModel(),d=_.filter(c.getChildren(),function(a){return a.getChildValue("displayName")===b});if(!d.length)return Q.reject("Can't find field with name "+b);var e=wixapps_automation.observers.waitForDialogOfType("wixapps.integration.components.panels.EditFieldPanel");return a._customizeItemsPresenter.onFieldClicked({data:d[0]}),e})},linkToPageFromSidePanel:function(a,b){var c=this;return this.selectTab(a,this.TABS.OPTIONS).then(function(){return c.getAppPartSettingsPanel(a)}).then(function(a){return a._onEnablePageLinks({value:!0}),Q.delay(300)}).then(function(){return c._linkPageCreation(b)})},linkToPageFromFPP:function(a,b){var c=this;return Q().then(function(){return wixapps_automation.editor.selectComponent(a)}).then(function(){var a,b=$$("[comp *= FloatingPropertyPanel]")[0].getLogic().getSkinPart("customActions").getChildren();return b.each(function(b){b.getLogic().getLabel()===W.Resources.get("EDITOR_LANGUAGE","FPP_PAGE_TEMPLATE_LABEL","FPP_PAGE_TEMPLATE_LABEL")&&(a=b)}),a.click(),Q.delay(300)}).then(function(){return c._linkPageCreation(b)})},_linkItemToWebsite:function(a,b){b&&(b.link&&a.getDataItem().setFields({href:b.link}),b.openInSameWindow&&a.getDataItem().setFields({target:this.imports.LinkableComponent.linkTarget.SAME_WINDOW}))},_linkItemToPage:function(a,b){var c,d=W.Preview.getPreviewManagers().Viewer.getLinkablePagesData();for(pageId in d){var e=d[pageId],f=e.get("title");if(b.pageName===f){c=e;break}}var g=e.get("pageUriSEO"),h=e.get("id"),i="#!"+g+"/"+h;a.getDataItem().setFields({href:i})},_linkItemToEmail:function(a,b){b&&(b.emailAddress&&a.getDataItem().setFields({href:b.emailAddress}),b.subject&&a.getDataItem().setFields({text:b.subject}))},openEditItemPanel:function(a,b){var c=this;return Q().then(function(){return c.getAppPartSettingsPanel(a)}).then(function(b){return _listSettings=b,c.getItems(a)}).then(function(a){var c={data:a.getChildByIndex(b)},d=_listSettings._manageItemPresenter._listCursor;if(d.getCurrentItemIndex()!==b){var e=wixapps_automation.observers.waitForEvent(d,Constants.WixAppEvents.SELECTED_INDEX_CHANGED);return _listSettings._manageItemPresenter.onSelectionChanged(c),e
}return Q()}).then(function(){return W.Commands.executeCommand("WAppsEditor2Commands.OpenEditItemPanel",{reloadBeforeOpen:!0}),Q.delay(500)}).then(function(){return Q(_listSettings)})},linkListItem:function(a,b,c,d,e){var f=this;return Q().then(function(){return f.getAppPartSettingsPanel(a)}).then(function(g){return f.openEditItemPanel(a,b).then(function(){var a=wixapps_automation.observers.waitForDialogOfType("wysiwyg.editor.components.dialogs.LinkDialog");return g.getViewNode().getElements("[proxy*=DataEditFieldProxy]")[c].getViewProxy()._linkClick({mode:"add"}),a}).then(function(a){return a._setState(d),d===f.imports.LinkableComponent.linkType.WEBSITE?f._linkItemToWebsite(a,e):d===f.imports.LinkableComponent.linkType.PAGE?f._linkItemToPage(a,e):d===f.imports.LinkableComponent.linkType.EMAIL&&f._linkItemToEmail(a,e),a._dialogWindow.triggerConfirmButton(),Q()})})},selectTab:function(a,b){return this.getAppPartSettingsPanel(a).then(function(a){var c={data:{getValue:function(){return{name:b}}}};return a.getSkinPart("content").firstChild.getLogic()._presenter.tabSelected(c),Q.delay(300)})}})}),define.Class("wixapps.automation.MapFactory",function(a){var b=a;b.methods({createMap:function(a){var b=this,c=a.getElements("[comp]").filter(function(a){return a.isVisible()});c.unshift(a);var d=c.map(function(c){var d=c.getPosition(a),e=c.getSize(),f=c.$logic.getComponentProperties(),g=c.$logic.getDataItem(),h={id:c.get("id"),comp:c.get("comp"),tags:b._getItemTags(c),coord:{x:d.x,y:d.y,width:e.x,height:e.y}};return f&&(f.takeSnapshot(),h.properties=b._serializeDataItem(f._snapshot),b._normalizeData(h.properties)),g&&(g.takeSnapshot(),h.data=b._serializeDataItem(g._snapshot),b._normalizeData(h.data)),h});return d},_getItemTags:function(a){var b=[];return"inline"===a.getStyle("display")&&b.push("inline"),b},_serializeDataItem:function(a){var b=this;return a?a.getValue?b._serializeDataItem(a.getValue()):"array"===typeOf(a)?Array.map(a,function(a){return b._serializeDataItem(a)}):"object"===typeOf(a)?Object.map(b._normalizeData(a),function(a){return b._serializeDataItem(a)}):a:a},_genericProperties:["_hash","_createdAt","_updatedAt","appPartName"],_normalizeData:function(a){var b={};for(var c in a){var d=a[c];void 0!==d&&(("uri"==c||"url"==c)&&(d=d.replace(/http:\/\/.*\//,"http://{remote-location}/")),this._genericProperties.indexOf(c)>=0&&(d="{"+c+"}"),b[c]=d)}return b},_processAppPartMap:function(){}})}),define.Class("wixapps.automation.MapInspector",function(a){var b=a;b.methods({compareMaps:function(a,b){var c;if(a.length!==b.length)c=[{error:"too_different",expected:a,actual:b}];else{c=[];for(var d=0;d<a.length;d++){var e=a[d],f=b[d];c=c.concat(this._compareProp("component","comp",e,f),this._compareProp("data","data",e,f),this._compareProp("coordinates","coord",e,f))}}return c},_compareProp:function(a,b,c,d){var e;if("coord"===b)e=this._compareBoundingRects(c[b],d[b],c);else{var f=JSON.stringify(c[b]),g=JSON.stringify(d[b]);"wysiwyg.viewer.components.WRichText"===c.comp&&"data"===b&&(g=this._processRichTextData(d),f=this._processRichTextData(c)),e=f===g}return e?[]:[{error:a,property:b,expected:c,actual:d}]},_processRichTextData:function(a){var b=document.createElement("div");return b.innerHTML=a,b.innerHTML},_compareBoundingRects:function(a,b,c){var d={x:2,y:2,width:4,height:4};"wysiwyg.viewer.components.WRichText"==c.comp&&(d.width=Math.round(.2*a.height),d.x=Math.round(d.width/2)),c.tags.contains("inline")&&(d.x=3,d.width=6,d.y=10,d.height=20);var e=["x","y","width","height"];return e.every(function(c){return Math.abs(parseInt(a[c],10)-parseInt(b[c],10))<=d[c]})}})}),define.Class("wixapps.automation.MapManager",function(a){var b=a;b.utilize(["wixapps.automation.MapFactory","wixapps.automation.MapInspector","wixapps.automation.AutomationStorage"]),b.fields({_mapFactory:null,_mapInspector:null,_storage:null,_mapTopology:"src/test/javascript/it/resources/maps/",_mapCache:{}}),b.methods({initialize:function(){this._mapFactory=new this.imports.MapFactory,this._mapInspector=new this.imports.MapInspector,this._storage=new this.imports.AutomationStorage},captureMap:function(a,b){var c,d=Q.defer(),e=this._mapFactory,f=this;return Q.fulfill().then(function(){return Q.delay(500)}).then(function(){return c=e.createMap(a),wixapps_automation.isCaptureMode()?f.storeMap(b,c):Q.resolve()}).then(function(){d.resolve(c)},function(){alert("The captured map could not be stored. Please check that fs_server is up and running.")}),d.promise},retrieveMap:function(a){return this._storage.retrieve(this._mapTopology+a+".json").then(function(a){return Q.resolve(JSON.parse(String(a)))},function(a){return wixapps_automation.isCaptureMode()?Q.resolve():Q.reject(a)})},storeMap:function(a,b){return this._storage.store(this._mapTopology+a+".json",JSON.stringify(b,null,4))},assertMap:function(a,b){var c=this._mapInspector,d=c.compareMaps(a,b);return this.visualizeDifferences(d),d},visualizeDifferences:function(a){var b=this;_(a).where({property:"coord"}).each(function(a){wixapps_automation.document.getComponentById(a.actual.id).then(function(c){b._visualizeCoords(c.$view,a.expected.coord,["expected"],{outline:"1px solid green"}),b._visualizeCoords(c.$view,a.actual.coord,["actual"],{outline:"1px solid red"})})});var c=_.where(a,{property:"data"});c.length&&console.log("Data assert fail:",JSON.stringify(c,null,4));var d=_.where(a,{property:"properties"});d.length&&console.log("Propertes assert fail:",JSON.stringify(d,null,4))},_visualizeCoords:function(a,b,c,d){var e=document.createElement("div");return e.setStyles(_.merge({},d,{position:"absolute",left:b.x,top:b.y,width:b.width,height:b.height})),_.each(c,function(a){e.addClass(a)}),a.insertBefore(e,null)}})}),define.Class("wixapps.automation.Navigation",function(a){var b=a;b.resources(["W.Preview"]),b.methods({goToPage:function(a){wixapps_automation.logger.logAction("Action: Move To  Page :",a);var b=this.resources.W.Preview.getPreviewManagers().Viewer,c=b.getCurrentPageNode();if(c&&c.get("id")===a)return Q.fulfill();var d=wixapps_automation.observers.waitForPageTransition();return b.goToPage(a),d}})}),define.Class("wixapps.automation.Observers",function(a){var b=a;b.resources(["W.EditorDialogs","W.CommandsNew","W.Commands","W.Data"]);var c=function(a){if(a.$logic){if(a.$logic.isReady)return a.$logic.isReady();if(a.$logic.getComponentStatus)return"ready"===a.$logic.getComponentStatus()}return!1};b.methods({wait:function(a){wixapps_automation.logger.logAction("Action: wait",a);var b=Q.defer();return setTimeout(function(){b.resolve()},a),b.promise},waitForRenderFrame:function(){wixapps_automation.logger.logAction("Action: waitForRenderFrame");var a=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,1e3/60)}}(),b=Q.defer();return a(function(){b.resolve()}),b.promise},waitForEvent:function(a,b,c){wixapps_automation.logger.logAction("Action: waitForEvent",a.$className||a,b);var d=Q.defer(),e={onSuccess:function(f){c()&&(a.removeEvent(b,e.onSuccess),d.resolve({target:a,payload:f}))}};return c&&c()?d.resolve(a):(c=c||function(){return!0},a.addEvent(b,e.onSuccess)),d.promise},waitForSelectionChange:function(a,b){wixapps_automation.logger.logAction("Action: waitForSelectionChange",a);var c=Q.defer(),d={onSuccess:function(e){if(!(a&&!e.comp||b&&!b(e))){W.CommandsNew.unregisterListener(d);var f="array"===typeOf(e.comp)?e.comp[0]:e.comp;c.resolve(f)}}};return this.resources.W.Commands.registerCommandAndListener("WEditorCommands.SelectedComponentChange",d,d.onSuccess,null,!0),c.promise},waitForComponentReady:function(a){return wixapps_automation.logger.logAction("Action: waitForComponentReady",a.$className+"#"+a.getComponentId()),this.waitForEvent(a,"componentReady",function(){return c(a.$view)})},waitForComponentState:function(a,b){return wixapps_automation.logger.logAction("Action: waitForComponentState",a.$className+"#"+a.getComponentId(),b),this.waitForEvent(a,"stateChange",function(){var c=a.getState().split(/\s+/);return-1!==c.indexOf(b)})},waitForDocUnload:function(){return wixapps_automation.logger.logAction("Action: waitForDocUnload"),this.waitForEvent(wWindow,"beforeunload")},waitForAllComponentsReady:function(a){wixapps_automation.logger.logAction("Action: waitForAllComponentsReady");var b=Q.defer(),d=this,e=function(){var f=a.getElements("[comp]"),g=f.every(function(a){return c(a)});g?b.resolve():d.wait(100).then(function(){e()})};return e(),b.promise},waitForWysiwygAccess:function(a){wixapps_automation.logger.logAction("Action: waitForWysiwygAccess");var b=Q.defer(),c=a.contentWindow,d=1e3,e=this,f=function(a){var d=!1;try{d=Boolean(c.W)}catch(g){}return d&&c.W&&c.W.Viewer?(b.resolve(),void 0):(a>0&&e.wait(100).then(function(){f(a-1)}),void 0)};return f(d),b.promise},waitForWysiwygDeployment:function(a){wixapps_automation.logger.logAction("Action: waitForWysiwygDeployment");var b=Q.defer(),c=this;return this.waitForWysiwygAccess(a).then(function(){var d=a.contentWindow;d.W.Editor?d.W.Editor.addEvent(d.Constants.EditorEvents.SITE_LOADED,function(){d.W.Editor.removeEvent(d.Constants.EditorEvents.SITE_LOADED,arguments.callee),b.resolve()}):Q.fulfill().then(function(){return c.waitForAllComponentsReady(document.body)}).then(function(){return c.waitForRenderFrame()}).then(function(){b.resolve()})}),b.promise},waitForEditorDeployment:function(){wixapps_automation.logger.logAction("Action: waitForEditorDeployment");var a=this.resources.W.Data,b=function(){return void 0!==a.getDataByQuery("#SITE_SETTINGS")};return this.waitForEvent(W.Editor,Constants.EditorEvents.SITE_LOADED,b)},waitForViewerDeployment:function(){wixapps_automation.logger.logAction("Action: waitForViewerDeployment");var a=this;return Q.fulfill().then(function(){return a.waitForEvent(W.Viewer,"pageTransitionEnded")}).then(function(){return a.waitForAllComponentsReady(document.body)}).then(function(){return a.waitForRenderFrame()})},waitForPageTransition:function(){wixapps_automation.logger.logAction("Action: waitForPageTransition");var a=this;return Q().then(function(){return a.waitForEvent(W.Preview.getPreviewManagers().Viewer,"pageTransitionEnded")}).then(function(){var a=W.Preview.getPreviewManagers().Viewer,b=a.getCurrentPageId(),c=a.getCurrentPageNode().getLogic().getDataItem().get("title");return Q({pageId:b,pageDisplayName:c})})},waitForAppPartReRender:function(a){var b=this;return wixapps_automation.logger.logAction("Action: waitForAppPartReRender",a.getComponentId()),b.waitForEvent(a,"proxyDisplayed").then(function(){return Q(a)})},waitForAppPartReady:function(a){wixapps_automation.logger.logAction("Action: waitForAppPartReady",a.getComponentId());var b=this;return"wixapps.integration.components.AppPart"===a.$className?Q.fulfill().then(function(){return b.waitForEvent(a,"stateChange",function(){var b=a.getState().split(/\s+/);return-1!==b.indexOf("content")&&a._mainProxy})}).then(function(){return b.waitForAllComponentsReady(a.$view)}).then(b.waitForRenderFrame):"wixapps.integration.components.AppPart2"===a.$className?Q.fulfill().then(function(){return b.waitForComponentState(a,"content").then(b.waitForRenderFrame)}):void 0},waitForDialogWithTitle:function(a){wixapps_automation.logger.logAction("Action: waitForDialogWithTitle",a);var b=function(b){var c=b.getSkinPart("dialogTitle");return c&&c.innerText===a};return this.waitForDialog(b)},waitForDialogOfType:function(a){wixapps_automation.logger.logAction("Action: waitForDialogOfType",a);var b=function(b){var c=b.getInnerDialog();return c.getLogic&&c.getLogic().$className===a};return this.waitForDialog(b).then(function(a){return Q(a.getInnerDialog().getLogic())})},waitForDialogWithElement:function(a){return wixapps_automation.logger.logAction("Action: waitForDialogWithElement",a),this.waitForDialog(function(b){return Boolean(b.getViewNode().getElement(a))})},waitForElementToExist:function(a,b){wixapps_automation.logger.logAction("Action: waitForElementToExist",a.toString(),b);var c=Q.defer(),d=jasmine.getEnv().currentSpec.id,e=function(){if(jasmine.getEnv().currentSpec.id!=d)return c.reject("Element "+b+" not found"),void 0;var f=a.getElement(b);f?c.resolve(f):setTimeout(e,100)};return e(),c.promise},waitForElementToHaveInnerText:function(a,b){wixapps_automation.logger.logAction("Action: waitForElementToHaveInnerHtml",a,b);var c=Q.defer(),d=jasmine.getEnv().currentSpec.id,e=function(){if(jasmine.getEnv().currentSpec.id!=d)return c.reject("Element "+a+" not have inner text : "+b),void 0;var f=a.innerText;f==b?c.resolve(a):setTimeout(e,100)};return e(),c.promise},waitForMinimumElementsToExist:function(a,b,c){wixapps_automation.logger.logAction("Action: waitForMinimumElementsToExist",a.toString(),b,c);var d=Q.defer(),e=jasmine.getEnv().currentSpec.id,f=function(){if(jasmine.getEnv().currentSpec.id!=e)return d.reject("Elements array from search pattern :  "+b+" does not have minimum, size :   "+c+"under ancestor : "+a),void 0;var g=a.getElements(b);g.length>=c?d.resolve(g):setTimeout(f,100)};return f(),d.promise},waitForOneOfTheElementsToHaveInnerTextOfType:function(a,b){wixapps_automation.logger.logAction("Action: waitForOneOfTheElementsToHaveInnerTextOfType",b);var c=Q.defer(),d=jasmine.getEnv().currentSpec.id,e=function(){if(jasmine.getEnv().currentSpec.id!=d)return c.reject("Elements array from search pattern :  "+searchPattern+" does not have minimum, size :   "+numberOfElements+"under ancestor : "+ancestor),void 0;var f=_.find(a,function(a){return a.innerText==b});f?c.resolve(f):setTimeout(e,100)};return e(),c.promise},waitForOneOfTheElementsToContainCssTextOfType:function(a,b){wixapps_automation.logger.logAction("Action: waitForOneOfTheElementsToHaveInnerTextOfType",b);var c=Q.defer(),d=jasmine.getEnv().currentSpec.id,e=function(){if(jasmine.getEnv().currentSpec.id!=d)return c.reject("Elements array from search pattern :  "+searchPattern+" does not have minimum, size :   "+numberOfElements+"under ancestor : "+ancestor),void 0;var f=_.find(a,function(a){return a.style.cssText.contains(b)});f?c.resolve(f):setTimeout(e,100)};return e(),c.promise},waitForDialog:function(a){wixapps_automation.logger.logAction("Action: waitForDialog");var b=this,c=Q.defer();a=a||function(){return!0};var d=function(){var d=b.resources.W.EditorDialogs._openDialogs,e=_.filter(d,function(b){return b.getLogic&&b.getLogic().isRendered()?a(b.getLogic()):void 0});return e.length?(e=e[0].getLogic(),e.isRendered()?c.resolve(e):b.waitForEvent(e,Constants.ComponentEvents.RENDER).then(function(){c.resolve(e)}),!0):!1},e=function(){setTimeout(function(){d()||e()},100)};return d()||e(),c.promise},waitForDialogNotToExist:function(a){wixapps_automation.logger.logAction("Action: waitForDialogNotToExist");var b=this,c=Q.defer();a=a||function(){return!0};var d=function(){var d=b.resources.W.EditorDialogs._openDialogs,e=_.filter(d,function(b){return b.getLogic&&b.getLogic().isRendered()?a(b.getLogic()):void 0});return e.length?(e=e[0].getLogic(),e.isRendered()?c.resolve(e):b.waitForEvent(e,Constants.ComponentEvents.RENDER).then(function(){c.resolve(e)}),!0):!1},e=function(){setTimeout(function(){d()||e()},100)};return d()||e(),c.promise},waitForDialogOfSeveralDialogs:function(a){wixapps_automation.logger.logAction("Action: waitForDialogOfSeveralDialogs");var b=this,c=Q.defer();a=a||function(){return!0};var d=function(){var d=b.resources.W.EditorDialogs._openDialogs,e=_.first(d,function(b){return b.getLogic&&b.getLogic().isRendered()?a(b.getLogic()):void 0});return e.length?(e=e[0].getLogic(),e.isRendered()?c.resolve(e):b.waitForEvent(e,Constants.ComponentEvents.RENDER).then(function(){c.resolve(e)}),!0):!1},e=function(){setTimeout(function(){d()||e()},100)};return d()||e(),c.promise}})}),define.Class("wixapps.automation.TestEnvSetup",function(a){var b=a;b.resources(["W.Utils","W.Config"]),b.utilize(["wixapps.automation.Observers","wixapps.automation.BlogActions","wixapps.automation.EditorActions","wixapps.automation.Navigation","wixapps.automation.DataServiceActions","wixapps.automation.AppsEnvInfo","wixapps.automation.MapManager","wixapps.automation.Document","wixapps.automation.ClipBoard","wixapps.automation.ListSettings","wixapps.automation.Element","wixapps.automation.TestResults","wixapps.automation.AutomationLogger"]),b.methods({initialize:function(){var a=this;window.wixapps_automation=window.automation||a._createAutomationDrivers(),wixapps_automation.isCaptureMode=function(){return"true"===a.resources.W.Utils.getQueryParam("captureMode")},window.testCase=this._createTestCaseLib()},waitForDeployment:function(){var a=this.resources.W.Config.env.$isPublicViewerFrame;return a?wixapps_automation.observers.waitForViewerDeployment():wixapps_automation.observers.waitForEditorDeployment()},_createAutomationDrivers:function(){var a={};return a.logger=new this.imports.AutomationLogger,a.observers=new this.imports.Observers,a.blog=new this.imports.BlogActions,a.editor=new this.imports.EditorActions,a.navigation=new this.imports.Navigation,a.dataService=new this.imports.DataServiceActions,a.appsInfo=new this.imports.AppsEnvInfo,a.maps=new this.imports.MapManager,a.document=new this.imports.Document,a.clipboard=new this.imports.ClipBoard,a.listsettings=new this.imports.ListSettings,a.element=new this.imports.Element,a.testResults=new this.imports.TestResults,a},_createTestCaseLib:function(){var a=function(a,b){b=b||2e5;var c=a();if(!c||!c.inspect)throw"waitsForPromise: The closure must return a promise";return waitsFor(function(){var a=c.inspect();if("rejected"==a.state)throw a.reason;return"fulfilled"===a.state},"Time out",b),c};window.waitsForPromise=a;var b,c,d=this,e=!0;return{setup:function(c,f){runs(function(){return this.addMatchers({toFitMap:d._getToFitMapMatcher(),toBeCopy:d._getToBeCopyMatcher()}),wixapps_automation.logger.startNewIt(jasmine.getEnv().currentSpec.description),a(function(){return e?(e=!1,d.waitForDeployment()):Q()})}),runs(function(){a(function(){return wixapps_automation.logger.log("------------ setup -------------"),b=c(Q())},f)})},flow:function(d,e){runs(function(){a(function(){var a=b?b.inspect().value:void 0;return wixapps_automation.logger.log("------------ flow -------------"),c=d(a)},e)})},assert:function(a){runs(function(){var b=c?c.inspect().value:void 0;wixapps_automation.logger.log("------------ assertions -------------"),a(b)})},genericCleanUp:function(){return wixapps_automation.logger.log("------------ generic clean up -------------"),wixapps_automation.editor.cleanUp().then(wixapps_automation.clipboard.cleanUp).then(wixapps_automation.document.cleanUp)}}},_getToFitMapMatcher:function(){return function(a){if(this.message=function(){return["The maps do not match each other.","The maps do match each other."]},wixapps_automation.isCaptureMode())return!0;var b=wixapps_automation.maps.assertMap(a,this.actual);return 0===b.length}},_getToBeCopyMatcher:function(){var a=this;return function(b){if("wixapps.integration.components.AppPart2"===b.$className)return a._assertCopyAppPart2(this.actual,b);var c=_.clone(b);return this.actual._iid&&(c._iid=this.actual._iid),this.toEqual(c),this.spec.results().getItems().getLast().passed()}},_assertCopyAppPart2:function(a,b){var c=a.getAppPartDefinition(),d=b.getAppPartDefinition(),e="The AppParts are not a copy of each other. differences are:\n",f=!1;return c.getType()!==d.getType()&&(e+="[type: actual = {0},  expected = {1}]".format(c.getType(),d.getType()),f=!0),c.getViewName()===d.getViewName()&&(e+="[view name: actual = {0}, expected = {1}]".format(c.getViewName(),d.getViewName()),f=!0),c.getDataSelectorId()===d.getDataSelectorId()&&(e+="[data selector: actual = {0}, expected = {1}]".format(c.getDataSelectorId(),d.getDataSelectorId()),f=!0),this.message=function(){return f?e:"The AppParts are a copy of each other!"},!f}})}),define.Class("wixapps.automation.TestResults",function(a){var b=a;b.fields({_results:[]}),b.methods({addResult:function(a){return this._resuls.push(a),Q()},getResults:function(){return this._results}})}),define.Class("wixapps.automation.drivers.TickerPropertyPanelDriver",function(a){var b=a;b.resources(["W.AppStoreManager","W.AppsEditor","ecommerceDefObj2G","W.AppsEditor2","W.Editor","W.Preview","W.Commands","W.EditorDialogs"]),b.binds(["getFilterPostButton","getAppPartPanel"]),b.fields({_appPartDataPanelDriver:null}),b.methods({initialize:function(){return wixapps_automation.logger.logAction("create ticker Property Panel Driver"),Q()},getAppPartPanel:function(){wixapps_automation.logger.logAction("getAppPartPanel");var a=W.Editor.getPropertyPanel().getViewNode();return wixapps_automation.observers.waitForElementToExist(a,"[comp= wixapps.integration.components.editor.AppPartDataPanel]")},getFilterPostButton:function(){var a=this;return Q().then(function(){return a.getAppPartPanel()}).then(function(a){return wixapps_automation.observers.waitForMinimumElementsToExist(a,"[comp = wysiwyg.editor.components.WButton] [skinpart =label]",2)}).then(function(a){return wixapps_automation.observers.waitForOneOfTheElementsToHaveInnerTextOfType(a,"Filter Posts")})},getAddAndEditBlogPostsButton:function(){var a=this;return Q().then(function(){return a.getAppPartPanel()}).then(function(a){return wixapps_automation.observers.waitForMinimumElementsToExist(a,"[comp = wysiwyg.editor.components.WButton] [skinpart =label]",2)}).then(function(a){return wixapps_automation.observers.waitForOneOfTheElementsToHaveInnerTextOfType(a,"Add & Edit Blog Posts")})},getDataAlignmentButton:function(a){var b,c=this;return Q().then(function(){return c.getAppPartPanel()}).then(function(a){b=a;var c="[comp = wysiwyg.editor.components.inputs.InputGroup]",d="[comp = wysiwyg.editor.components.inputs.RadioImage]";return wixapps_automation.observers.waitForMinimumElementsToExist(b,c+" "+d+" [skinpart = radioIcon]",2)}).then(function(b){return wixapps_automation.observers.waitForOneOfTheElementsToContainCssTextOfType(b,"radiobuttons/alignment/"+a+".png")})},getLanguageDirectionButton:function(a){var b=this;return Q().then(function(){return b.getAppPartPanel()}).then(function(a){return wixapps_automation.observers.waitForMinimumElementsToExist(a,"[comp = wysiwyg.editor.components.inputs.RadioImages] [skinpart =radioIcon]",6)}).then(function(b){return wixapps_automation.observers.waitForOneOfTheElementsToContainCssTextOfType(b,"radiobuttons/alignment/"+a+".png")})},getSpaceAfterTitleSliderDriver:function(){var a=this;return Q().then(function(){return a.getAppPartPanel()}).then(function(a){var b=a._custInputs,c=b[Post|TickerMediaTop||TitleSpace|comp.size],d=c.getHtmlElement();return Q(d.getElement("[getSkinPart = input]"))})}})});