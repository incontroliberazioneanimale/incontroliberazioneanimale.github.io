define.Class("core.utils.BackgroundHelper",function(a){var b=a;b.statics({BG_PROPERTIES:["url","imagesizew","imagesizeh","positionx","positiony","width","repeatx","repeaty","attachment","color"]}),b.methods({createBgCssValueFromDataItem:function(a){for(var b="",c=0;c<this.BG_PROPERTIES.length;c++){var d=a[this.BG_PROPERTIES[c]];d?(d=this._normalizePropertyValue(this.BG_PROPERTIES[c],d),b+=d+" "):(d=this._getDefaultValueForBGProperty(this.BG_PROPERTIES[c]),b+=d+" ")}return b.trim()},_getDefaultValueForBGProperty:function(a){return"imagesizew"===a||"imagesizeh"===a?"0px":""},_normalizePropertyValue:function(a,b){return"repeatx"===a||"repeaty"===a?b=this._normalizeRepeatValueFromDataItem(b):("imagesizew"===a||"imagesizeh"===a)&&(b=this._normalizeImagesizeValueFromDataItem(a,b)),b},normalizeRepeatValueToDataItem:function(a){return a?"no-repeat"===a?"no_repeat":a:""},_normalizeRepeatValueFromDataItem:function(a){return a?"no_repeat"===a?"no-repeat":a:""},_normalizeImagesizeValueFromDataItem:function(a,b){if(b){var c=parseInt(b);return c=isNaN(c)?0:c,c+"px"}return this._getDefaultValueForBGProperty(a)}})}),define.Class("core.utils.BeatStatisticsAndKeepAlive",function(a){var b=a;b.statics({BeatStatisticsAndKeepAliveInstances:[]}),b.fields({beatDefaultPulseTime:900,timeoutTimeMillis:1e3,_JSONPScriptId:"BeatStatisticsAndKeepAliveJSONP",_InstanceId:-1,beatUrl:"//beat.wix.com/alive/jsonp"}),b.methods({initialize:function(a,b,c,d,e,f,g){if(this.isEmpty(a)||this.isEmpty(b)||this.isEmpty(c))throw"the appId, pageId and siteId are mandatory";"preview"!==window.viewMode&&(this._initialize(a,b,c,d,e,f,g),this._gotResponse=!1,this._timeoutCount=0)},sendBeat:function(){this._sendRequestToBeatJSONP()},_initialize:function(a,b,c,d,e,f,g){this._InstanceId=this.BeatStatisticsAndKeepAliveInstances.push(this)-1,this._properties={isKeepAlive:e?e:!1,callback:g},this._requestData={app:a,siteId:b,metaSiteId:f,isTemplate:d?d:0,pageFileName:c,firstTimeInDocPage:!0,etag:this._getEtag()}},_getEtag:function(){return $$("meta[http-equiv=etag]")[0]&&$$("meta[http-equiv=etag]")[0].getAttribute?$$("meta[http-equiv=etag]")[0].getAttribute("content"):null},_addJSONPScriptElement:function(){if(!document.getElementById(this._JSONPScriptId)){var a=document.getElementsByTagName("script")[0],b=document.createElement("script");return b.id=this._JSONPScriptId,b.type="text/javascript",b.async=!0,a.parentNode.insertBefore(b,a),b}},_sendRequestToBeatJSONP:function(){this._gotResponse=!1;var a=this._getRequestUrl(),b=document.getElementById(this._JSONPScriptId);b&&b.parentNode.removeChild(b);var c=this._addJSONPScriptElement();c.src=a},_processJsonResponse:function(a){this._gotResponse=!0,this._timeoutCount=0,this._requestData.firstTimeInDocPage=!1;var b=a&&a.payload&&a.payload.wixBeat?a.payload.wixBeat:this.beatDefaultPulseTime;if(this._properties.isKeepAlive){var c=this;window.setTimeout(function(){c._sendRequestToBeatJSONP()},1e3*b)}this._properties.callback&&this._properties.callback(a)},_getRequestUrl:function(){var a=this.beatUrl+"?";for(var b in this._requestData)a+=b+"="+this._requestData[b]+"&";return a=a.slice(0,-1)},isEmpty:function(a){return void 0===a||null===a}})}),define.utils("ColorUtils:this",function(){return{isValidColor:function(a){return instanceOf(a,String)&&(0===a.indexOf("#")&&(4===a.length||7===a.length)&&!isNaN(a.replace("#","0x"))||Constants.CSS.COLORS.contains(a.toLowerCase()))},getNewColorAccordingToBrightness:function(a,b){var c=W.Utils.rgb2Hsl(a.getRed(),a.getGreen(),a.getBlue());return c.l*=b,"hsl("+c.h+","+c.s+"%,"+c.l+"%)"},rgb2Hsl:function(a,b,c){a/=255,b/=255,c/=255;var d,e,f=Math.max(a,b,c),g=Math.min(a,b,c),h=(f+g)/2;if(f==g)d=e=0;else{var i=f-g;switch(e=h>.5?i/(2-f-g):i/(f+g),f){case a:d=(b-c)/i+(c>b?6:0);break;case b:d=(c-a)/i+2;break;case c:d=(a-b)/i+4}d/=6}return{h:Math.round(360*d),s:Math.round(100*e),l:Math.round(100*h)}},hsl2Rgb:function(a,b,c){var d,e,f,g,h,i;return isFinite(a)||(a=0),isFinite(b)||(b=0),isFinite(c)||(c=0),a/=60,0>a&&(a=6- -a%6),a%=6,b=Math.max(0,Math.min(1,b/100)),c=Math.max(0,Math.min(1,c/100)),h=(1-Math.abs(2*c-1))*b,i=h*(1-Math.abs(a%2-1)),1>a?(d=h,e=i,f=0):2>a?(d=i,e=h,f=0):3>a?(d=0,e=h,f=i):4>a?(d=0,e=i,f=h):5>a?(d=i,e=0,f=h):(d=h,e=0,f=i),g=c-h/2,d=Math.round(255*(d+g)),e=Math.round(255*(e+g)),f=Math.round(255*(f+g)),{r:d,g:e,b:f}}}}),define.utils("CoreDebug:this",function(){return{errorPopup:function(a,b,c){W.EditorDialogs&&(W.Config.isInDebugMode()?W.EditorDialogs.openErrorDialog(a,b,c):W.EditorDialogs.openErrorDialog(a,b))},debugTrace:function(){W.Config.isInDebugMode()&&window.console&&(console.log.apply?console.log.apply(console,arguments):console.log(arguments))}}}),define.utils("linkUtils",function(){var a={linkType:{SMS:"SMS",CALL:"CALL",SKYPE:"SKYPE",MAP:"MAP",EMAIL:"EMAIL",FACEBOOK:"FACEBOOK",FLICKR:"FLICKR",BLOGGER:"BLOGGER",MYSPACE:"MYSPACE",LINKEDIN:"LINKEDIN",TWITTER:"TWITTER",TUMBLR:"TUMBLR",YOUTUBE:"YOUTUBE",VIMEO:"VIMEO",PAGE:"PAGE",FREE_LINK:"FREE_LINK",TEXT:"TEXT",DELICIOUS:"DELICIOUS",WEBSITE:"WEBSITE",DOCUMENT:"DOCUMENT",LOGIN:"LOGIN"},linkTarget:{SAME_WINDOW:"_self",NEW_WINDOW:"_blank"}};return{linkify:function(a,b,c,d){b&&(c&&""!==c?(b.set("href",c),b.setStyle("cursor","pointer"),this._setTarget(b,d),this.hasState("noLink","linkableComponent")&&this.removeState("noLink","linkableComponent")):(b.setStyle("cursor","default"),b.erase("href"),b.erase("target"),this.hasState("noLink","linkableComponent")&&this.setState("noLink","linkableComponent")),this._handleSpecialCases(a,b))},renderLinks:function(a,b){var c=a.getData(),d=c.href,e=c.target,f=c.linkType,g=b?b:this._skinParts.link;if(("same"===e||"self"===e)&&(e="_self",a.set("target","_self")),W.Experiments&&W.Experiments._runningExperiments&&"new"===W.Experiments._runningExperiments.linkutilshreffix){if("PAGE"===f&&!d.indexOf("#!")){var h=new RegExp(/[/].*/);this._pageId=d.match(h)[0].replace("/","#"),W.Data.getDataByQuery(this._pageId,function(a){var b="#!"+a.getData().pageUriSEO+"/"+this._pageId;W.Utils.linkUtils.linkify.call(this,f,g,b,e)}.bind(this))}}else W.Utils.linkUtils.linkify.call(this,f,g,d,e);this._NO_LINK_PROPAGATION&&W.Utils.linkUtils.disableLinkClickPropagation(g)},disableLinkClickPropagation:function(a){a.addEvent("click",function(a){a.stopPropagation()})},_setTarget:function(a,b){a.set("target",b)},_bindPageLeaveWarningToLink:function(a,b){b.erase("href"),b.erase("target"),b.addEvent("click",function(b){b.preventDefault(),this._showNavigationDisabledTooltip(a)}.bind(this))},_showNavigationDisabledTooltip:function(a){this.injects().Commands.executeCommand("linkableComponent.navigateSameWindow",{component:a},a)},linkableComponentEditModeChanged:function(b,c,d){if(!this._isDisposed){var e=d?d:this._skinParts.link,f=!1,g=!1,h=this.getDataItem?this.getDataItem():c,i=h.get("linkType"),j=h.get("target"),k=a.linkTarget.SAME_WINDOW,l=a.linkType.WEBSITE,m=a.linkType.EMAIL;j===k&&i===l&&(f=!0),i===m&&(g=!0),"PREVIEW"==b?f?this._bindPageLeaveWarningToLink(e):g&&(this._bindMailtoLinks(e),this.renderLinks(c)):(e.removeEvents("click"),this.renderLinks(c))}},_bindMailtoLinks:function(a){a=this._skinParts.link,a.addEvent("click",this._temporaryDisableNavigationWarning)},_temporaryDisableNavigationWarning:function(){window.enableNavigationConfirmation=!1,setTimeout(function(){window.enableNavigationConfirmation=!0},50)},_handleSpecialCases:function(b,c){switch(c.removeEvents("click"),b){case a.linkType.LOGIN:c.addEvent("click",function(){if(window.animateForm){var a=this.getDataItem(),b=a.get("text");if(b){b=JSON.parse(b);var c=b.postLoginUrl,d=b.postSignupUrl,e=b.type,f="HTML",g=window.userApi?window.userApi.isSessionValid():!1;g?c&&(window.location.href=c):window.animateForm.callOnContent([d,c,e,f])}}}.bind(this));break;case a.linkType.ADMIN_LOGIN:c.setStyle("cursor","pointer"),c.addEvent("click",function(){this.injects().Commands.executeCommand("WViewerCommands.AdminLogin.Open")}.bind(this))}}}}),define.Class("core.utils.css.Background",function(a){var b=a;b.utilize(["core.utils.css.Color"]),b.methods({initialize:function(a,b){if(this.setThemeManager(b),a){a.getThemeString&&(a=a.getThemeString());var c=a.split(" ").filter(function(a){return!!a});if(1===c.length){var d="^#[\\dA-Fa-f]{3,8}$",e="^rgba?\\([\\d,]+\\)$",f="^[\\[\\{][\\w\\d_]+[\\]\\}]$",g=new RegExp(d+"|"+e+"|"+f),h=c[0];"none"==h?c=["none",0,0,"center","center","auto","repeat","repeat","scroll","none"]:h.test(g)&&(c=["none",0,0,"center","center","auto","repeat","repeat","scroll",h])}this.set.apply(this,c)}},setThemeManager:function(a){this._themeManager=a},set:function(a,b,c,d,e,f,g,h,i,j){this._setColor(j),this.setImage(a,b,c),this.setRepeat(g,h),this.setAttachment(i),this.setPosition(d,e),this.setWidth(f)},setWidth:function(a){var b=parseInt(a,10),c=Constants.Background.VALID_WIDTH;this._width=c.contains(a)||!isNaN(b)?a:this._width||c[0]},setPosition:function(a,b){if("undefined"==typeof b){var c=a.split(" ");2===c.length&&(a=c[0],b=c[1])}var d=Constants.Background.VALID_POSITION_X,e=Constants.Background.VALID_POSITION_Y;this._x=d.contains(a)?a:this._x||d[0],this._y=e.contains(b)?b:this._y||e[0]},setAttachment:function(a){var b=Constants.Background.VALID_ATTACHMENT;this._attachment=b.contains(a)?a:this._attachment||b[0]},setColorReference:function(a){this._colorSource="theme",this._colorName=a,this._color=new this.imports.Color(this._themeManager&&this._themeManager.getProperty(a))},setColor:function(a){("transparent"==a||"none"==a)&&(a="0,0,0,0"),this._colorSource="value",this._colorName="",this._color=new this.imports.Color(a)},_setColor:function(a){var b="",c=a&&(a.test(/\{.+\}/)||a.test(/\[.+\]/));a&&c?(b=c&&a.substring(1,a.length-1)||a,this.setColorReference(b)):this.setColor(a)},setImage:function(a,b,c){this._imageId=a||"none",this._imageW=b||0,this._imageH=c||0},setPyramidSize:function(a){this._pyramid=a},setRepeat:function(a,b){if("undefined"==typeof b){var c=a.split(" ");switch(c.length){case 1:b=a;break;case 2:a=c[0],b=c[1]}}var d=Constants.Background.VALID_REPEAT;this._repeatX=d.contains(a)?a:this._repeatX||d[0],this._repeatY=d.contains(b)?b:this._repeatY||d[0]},getCssValue:function(a){var b=a?"background:":"";return this.getImageId()&&(b+=[this.getUrl(),this.getPosition(),this.getRepeatUnified(),this.getAttachment()].join(" ")+" "),b+=this.getColor()},getCssSizeValue:function(a){return this.getWidth(a)},getCssRule:function(a){var b=this.getCssValue(!0);return a&&(b+=";"+this.getCssSizeValue(!0)),b},getCssRules:function(){return[this.getUrl(!0),this.getPosition(!0),this.getWidth(!0),this.getRepeat(!0),this.getAttachment(!0),this.getColor(!0)].join(";")},getThemeString:function(){var a="theme"===this._colorSource?"{"+this.getColorReference()+"}":this.getColor();return[this.getImageId(),this.getImageSize()[0],this.getImageSize()[1],this.getPosition(),this.getWidth(),this.getRepeat(),this.getAttachment(),a].join(" ")},getWidth:function(a){var b=a?"background-size:":"";return b+=this._width},getWidthInline:function(a){return Modernizr&&Modernizr.backgroundsize||a?"/"+this.getWidth():""},getPosition:function(a){var b=a?"background-position:":"";return b+=this.getPositionX()+" "+this.getPositionY()},getPositionX:function(a){var b=a?"background-position-x:":"";return b+=this._x},getPositionY:function(a){var b=a?"background-position-y:":"";return b+=this._y},getPositionXValue:function(){return this._x},getPositionYValue:function(){return this._y},getAttachment:function(a){var b=a?"background-attachment:":"";return b+=this._attachment},getColor:function(a){var b=a?"background-color:":"";return b+=0===this._color.getAlpha()?"transparent":this._color.getHex()},getColorReference:function(){return this._colorName},getColorThemeValue:function(){return"theme"==this._colorSource?"{"+this._colorName+"}":this.getColor(!1)},getUrl:function(a){var b=W.Config.getServiceTopologyProperty("staticMediaUrl")+"/",c=a?"background-image:":"";return c+="none"==this._imageId?this._imageId:"url("+b+this._imageId+this._getPyramidSuffix()+")"},getImageSize:function(){return[this._imageW,this._imageH]},getImageId:function(){return this._imageId||"none"},_getPyramidSuffix:function(){var a,b,c=this._isMobileView(),d="",e=this._pyramid||(c?1e3:Constants.Background.DEFAULT_PYRAMID_SIZE),f=[],g=1;f[0]=parseInt(this.getImageSize()[0],10),f[1]=parseInt(this.getImageSize()[1],10),g=f[0]/f[1],a=f[0],b=f[1],(f[0]>e||f[1]>e)&&(a=f[0]>=f[1]?e:Math.round(g*e),b=f[1]>=f[0]?e:Math.round(1/g*e));var h=this._getFileExtension(this._imageId);return d=this._getImageSuffixHelper(a,b,h)},_getImageSuffixHelper:function(a,b,c){return"_srz_p_"+a+"_"+b+"_75_22_0.50_1.20_0.00_"+c+"_srz"},_getFileExtension:function(a){var b=/[.]([^.]+)$/.exec(a);return b&&/[.]([^.]+)$/.exec(a)[1]||""},_isMobileView:function(){var a=W.Config.mobileConfig.isMobileOrTablet(),b=W.Config.env.$viewingDevice===Constants.ViewerTypesParams.TYPES.MOBILE;return a||b},getRepeat:function(a){var b=a?"background-repeat:":"";return b+=this._repeatX+" "+this._repeatY},getRepeatUnified:function(a){var b=a?"background-repeat:":"";return b+=this._repeatX==this._repeatY?"no-repeat"==this._repeatX?"no-repeat":"repeat":"repeat"==this._repeatX?"repeat-x":"repeat-y"},getRepeatX:function(){return this._repeatX},getRepeatY:function(){return this._repeatY},toString:function(){return this.getThemeString()}})}),define.Class("core.utils.css.BorderRadius",function(a){var b=a;b.methods({initialize:function(a){a=a.getThemeString?a.getThemeString():Array.isArray(a)?a.join(" "):a.toString();var b=a.split(" ").filter(function(a){return!!a});this.set.apply(this,b)},square:function(){this._isLocked=!1;for(var a=0;a<arguments.length;++a)switch(arguments[a].toLowerCase()){case"tr":this._topRightRadius=0;break;case"tl":this._topLeftRadius=0;break;case"br":this._bottomRightRadius=0;break;case"bl":this._bottomLeftRadius=0}return this},decrease:function(a,b,c,d){return"undefined"==typeof a?this:("undefined"==typeof b?b=a:this._isLocked=!1,"undefined"==typeof c&&(c=a),"undefined"==typeof d&&(d=b),this._topLeftRadius=Math.max(this._topLeftRadius-a,0),this._topRightRadius=Math.max(this._topRightRadius-b,0),this._bottomRightRadius=Math.max(this._bottomRightRadius-c,0),this._bottomLeftRadius=Math.max(this._bottomLeftRadius-d,0),this)},set:function(a,b,c,d){this._isLocked=!1,"undefined"==typeof a&&(a=0),"undefined"==typeof b&&(b=a,this._isLocked=!0),"undefined"==typeof c&&(c=a),"undefined"==typeof d&&(d=b),this.setTopLeft(a,this._isLocked),this.setTopRight(b,this._isLocked),this.setBottomRight(c,this._isLocked),this.setBottomLeft(d,this._isLocked)},setTopLeft:function(a,b){this._isLocked=!!b;var c=this._seperateSizeFromUnit(a,this._topLeftUnits);this._topLeftRadius=c.size,this._topLeftUnits=c.unit},setTopRight:function(a,b){this._isLocked=!!b;var c=this._seperateSizeFromUnit(a,this._topRightUnits);this._topRightRadius=c.size,this._topRightUnits=c.unit},setBottomRight:function(a,b){this._isLocked=!!b;var c=this._seperateSizeFromUnit(a,this._bottomRightUnits);this._bottomRightRadius=c.size,this._bottomRightUnits=c.unit},setBottomLeft:function(a,b){this._isLocked=!!b;var c=this._seperateSizeFromUnit(a,this._bottomLeftUnits);this._bottomLeftRadius=c.size,this._bottomLeftUnits=c.unit},_seperateSizeFromUnit:function(a,b){a=String(a);var c=parseFloat(a),d=a.split(String(c)).join("");return c=isNaN(c)?0:c,c=Math.min(c,99999),d=Constants.BorderRadius.VALID_UNITS.contains(d)?d:b||Constants.BorderRadius.VALID_UNITS[0],{unit:d,size:c}},getCssValue:function(){return this._isLocked?this.getTopLeft():[this.getTopLeft(),this.getTopRight(),this.getBottomRight(),this.getBottomLeft()].join(" ")},getCssRule:function(){return"border-radius:"+this.getCssValue()},getThemeString:function(){return this.getCssValue()},getTopLeft:function(){return this._topLeftRadius+this._topLeftUnits},getTopRight:function(){return this._topRightRadius+this._topRightUnits},getBottomRight:function(){return this._bottomRightRadius+this._bottomRightUnits},getBottomLeft:function(){return this._bottomLeftRadius+this._bottomLeftUnits},getIsLocked:function(){return this._isLocked},getUnits:function(){return[this._topLeftUnits,this._topRightUnits,this._bottomRightUnits,this._bottomLeftUnits]},toString:function(){return this.getCssValue()}})}),define.Class("core.utils.css.BoxShadow",function(a){var b=a;b.utilize(["core.utils.css.Color"]),b.methods({initialize:function(a,b){this._shadow=[];var c="",d=!1;a&&"none"!==a&&(c=a),b!==!1&&c&&(d=!0),c.getThemeString&&(c=c.getThemeString()),this._parseShadowString(c||"0 0 0 0 #000000"),this.setToggleOn(d)},setToggleOn:function(a){this._toggleOn=a},setColor:function(a,b){b=b||0,this._shadow[b].color=new this.imports.Color(a)},setBlurRadius:function(a,b){b=b||0,this._shadow[b].blur=this._getSizeFromUnit(a)},setSpreadRadius:function(a,b){b=b||0,this._shadow[b].spread=this._getSizeFromUnit(a)},setOffset:function(a,b,c){b="undefined"!=typeof b?b:a,this.setOffsetX(a,c),this.setOffsetY(b,c)},setOffsetX:function(a,b){b=b||0,this._shadow[b].x=this._getSizeFromUnit(a),this._shadow[b].angle=this._calcAngle(b),this._shadow[b].distance=this._calcDistance(b)},setOffsetY:function(a,b){b=b||0,this._shadow[b].y=this._getSizeFromUnit(a),this._shadow[b].angle=this._calcAngle(b),this._shadow[b].distance=this._calcDistance(b)},setInset:function(a,b){this._shadow[b||0].inset=a?"inset":""},setDistance:function(a,b){b=b||0,this._shadow[b].distance=this._getSizeFromUnit(a),this._shadow[b].x=this._shadow[b].distance*Math.sin(this._shadow[b].angle),this._shadow[b].y=this._shadow[b].distance*Math.cos(this._shadow[b].angle)},setAngle:function(a,b,c){var d=b?Math.PI/180:1;c=c||0,this._shadow[c].angle=a*d||0,this._shadow[c].x=this._shadow[c].distance*Math.sin(this._shadow[c].angle),this._shadow[c].y=this._shadow[c].distance*Math.cos(this._shadow[c].angle)},setUnit:function(a,b){b=b||0,this._shadow[b].unit=Constants.BoxShadow.VALID_UNITS.contains(a)?a:Constants.BoxShadow.VALID_UNITS[0]},getDistance:function(a){return a=a||0,this._shadow[a].distance},getAngle:function(a,b){b=b||0;var c=a?180/Math.PI:1,d=this._modulo(this._shadow[b].angle,2*Math.PI)*c;return a?Math.round(d):d},getColor:function(a){a=a||0;var b=this._shadow[a].color;return Modernizr&&Modernizr.rgba?"rgba("+b.getRgba()+")":b.getHex()},getBlurRadius:function(a){return a=a||0,this._shadow[a].blur},getSpreadRadius:function(a){return a=a||0,this._shadow[a].spread},getOffsetX:function(a){return a=a||0,this._shadow[a].x.toFixed(3)},getOffsetY:function(a){return a=a||0,this._shadow[a].y.toFixed(3)},getInset:function(a){return a=a||0,this._shadow[a].inset},getToggleOn:function(){return this._toggleOn},getThemeString:function(){var a=!0;return this._getCssValueFromShadowObject(a)},getUnit:function(a){return a=a||0,this._shadow[a].unit},getCssValue:function(){return this._toggleOn?this._getCssValueFromShadowObject():""},_calcAngle:function(a){a=a||0;var b={x:this._shadow[a].x,y:this._shadow[a].y},c={x:0,y:0},d={x:c.x,y:c.y-Math.sqrt((b.x-c.x)*(b.x-c.x)+(b.y-c.y)*(b.y-c.y))};return 2*Math.atan2(b.x-d.x,b.y-d.y)},_calcDistance:function(a){a=a||0;var b=this._shadow[a].x||0,c=this._shadow[a].y||0;return Math.sqrt(b*b+c*c)},_getSizeFromUnit:function(a){a=String(a);var b=parseFloat(a);return b=isNaN(b)?0:b},_parseShadowString:function(a){var b,c,d=[],e=0;if("string"==typeof a){if(b=a.trim().replace(/\s*([\(\)\}\s,])\s*/g,"$1").replace(/([\)\}]|#\w{3,6}),/g,"$1, ").replace(/[,;]$/,""),!b)return"";for(d=b.split(", "),e=0;e<d.length;e++)c=d[e].split(" "),"inset"!=c[0]&&c.unshift(""),this._shadow[e]=[],this.setUnit("px",e),this.setInset(c[0],e),this.setOffset(c[1],c[2],e),this.setBlurRadius(c[3],e),this.setSpreadRadius(c.length>5?c[4]:0,e),this.setColor(c.getLast(),e)}},_getCssValueFromShadowObject:function(a){var b,c=[];for(b=0;b<this._shadow.length;b++)a?c.push([this.getInset(b),this.getOffsetX(b),this.getOffsetY(b),this.getBlurRadius(b),this.getSpreadRadius(b),this.getColor(b)].join(" ").trim()):c.push([this.getInset(b),Math.round(this.getOffsetX(b))+this._shadow[b].unit,Math.round(this.getOffsetY(b))+this._shadow[b].unit,Math.round(this.getBlurRadius(b))+this._shadow[b].unit,Math.round(this.getSpreadRadius(b))+this._shadow[b].unit,this.getColor(b)].join(" ").trim());return c.join(",")},_modulo:function(a,b){return(a%b+b)%b},toString:function(){return this.getCssValue()}})}),define.Class("core.utils.css.Color",function(a){function b(a,b,c){var d,e,f,g,h,i,j,k;return a%=360,0===c?{r:0,g:0,b:0}:(b/=100,c/=100,a/=60,g=Math.floor(a),h=a-g,i=c*(1-b),j=c*(1-b*h),k=c*(1-b*(1-h)),0===g?(d=c,e=k,f=i):1==g?(d=j,e=c,f=i):2==g?(d=i,e=c,f=k):3==g?(d=i,e=j,f=c):4==g?(d=k,e=i,f=c):5==g&&(d=c,e=i,f=j),d=Math.round(255*d),e=Math.round(255*e),f=Math.round(255*f),{r:d,g:e,b:f})}function c(a,b,c){var d,e,f,g,h,i;return a/=255,b/=255,c/=255,d=Math.min(Math.min(a,b),c),e=Math.max(Math.max(a,b),c),d==e?{h:void 0,s:0,b:100*e}:(f=a==d?b-c:b==d?c-a:a-b,g=a==d?3:b==d?5:1,h=Math.round(60*(g-f/(e-d)))%360,i=Math.round((e-d)/e*100),e=Math.round(100*e),{h:h,s:i,b:e})}var d=a;d.methods({initialize:function(a,b,c,d){if("number"==typeOf(c)&&"number"==typeOf(b)&&"number"==typeOf(a))this.setRed(a),this.setGreen(b),this.setBlue(c),this.setAlpha(d);else if("string"==typeOf(a))if(0===a.indexOf("#"))this.setHex(a);else{var e=a.replace(/[rgba\(\)]/g,"");this.setRgba(e)}else this._isUpdateDisabled=!0,a=a||{},this.setRed(a.getRed&&"function"==typeOf(a.getRed)?a.getRed():0),this.setGreen(a.getGreen&&"function"==typeOf(a.getGreen)?a.getGreen():0),this.setBlue(a.getBlue&&"function"==typeOf(a.getBlue)?a.getBlue():0),this.setAlpha(a.getAlpha&&"function"==typeOf(a.getAlpha)?a.getAlpha():1),this._isUpdateDisabled=!1,this._updateHsb()},invert:function(){return this.getInvertColor()},saturation:function(a){return this.setSaturation(a*(this._s/100)),this},brightness:function(a){return this.setBrightness(a*(this._br/100)),this},alpha:function(a){return this.setAlpha(a*(this._a/100)),this},maxSaturation:function(a){return this._s>a&&this.setSaturation(a),this},minSaturation:function(a){return this._s<a&&this.setSaturation(a),this},maxBrightness:function(a){return this._br>a&&this.setBrightness(a),this},minBrightness:function(a){return this._br<a&&this.setBrightness(a),this},getHex:function(a){var b="#"+this._formatHexColor(this._r)+this._formatHexColor(this._g)+this._formatHexColor(this._b);return a&&(b+=this._formatHexColor(255*this._a)),b},getRgb:function(){return this._r+","+this._g+","+this._b},getRgba:function(){return this.getRgb()+","+this.getAlpha()},getRed:function(){return this._getValue(this._r,0)},getGreen:function(){return this._getValue(this._g,0)},getBlue:function(){return this._getValue(this._b,0)},getAlpha:function(){return this._getValue(this._a,1,2)},getHue:function(){return this._getValue(this._h,0)},getSaturation:function(){return this._getValue(this._s,100)},getBrightness:function(){return this._getValue(this._br,100)},getInvertColor:function(){return new this.$class([255-this._r,255-this._g,255-this._b].join(","))},_getValue:function(a,b,c){var d=a||0===a?a:b;return 0!==d&&1!==d&&"number"==typeof c&&"number"==typeof d&&(d=d.toFixed(c),d=Number(d)),d},setRed:function(a){this._r=this._validateValue(a,0,255,0),this._updateHsb()},setGreen:function(a){this._g=this._validateValue(a,0,255,0),this._updateHsb()},setBlue:function(a){this._b=this._validateValue(a,0,255,0),this._updateHsb()},setAlpha:function(a){this._a=this._validateValue(a,0,1,1)},setHue:function(a){this._h=this._validateValue(a,0,360,0),this._updateRgb()},setSaturation:function(a){this._s=this._validateValue(a,0,100,100),this._updateRgb()},setBrightness:function(a){this._br=this._validateValue(a,0,100,100),this._updateRgb()},setHex:function(a){"#"==a.charAt(0)&&(a=a.substr(1)),this._isUpdateDisabled=!0,this.setRed(parseInt(a.substr(0,2),16)),this.setGreen(parseInt(a.substr(2,2),16)),this.setBlue(parseInt(a.substr(4,2),16));var b=parseInt(a.substr(6,2),16);isNaN(b)&&this._a||this.setAlpha(0===b?0:b/255),this._isUpdateDisabled=!1,this._updateHsb()},setRgba:function(a){this._isUpdateDisabled=!0;var b=this._formatSplitValue(a,["r","g","b","a"]);this.setRed(b.r),this.setGreen(b.g),this.setBlue(b.b),this.setAlpha(b.a),this._isUpdateDisabled=!1,this._updateHsb()},setHsb:function(a){this._isUpdateDisabled=!0;var b=this._formatSplitValue(a,["h","s","b"]);this.setHue(b.h),this.setSaturation(b.s),this.setBrightness(b.b),this._isUpdateDisabled=!1,this._updateRgb()},_formatSplitValue:function(a,b){var c={};if("string"==typeOf(a)&&(a=a.split(",")),"array"==typeOf(a))for(var d=0;d<b.length;++d)c[b[d]]=a[d];return c},_validateValue:function(a,b,c,d){return a=isNaN(a)?parseFloat(a):a,0!==a&&(a=a||d||b),a=isNaN(a)?a:Number(String(a).trim()),(isNaN(a)||a>c)&&(a=c),b>a&&(a=b),a},_formatHexColor:function(a){for(a=a||"00","number"==typeOf(a)&&(a=Math.round(a),a=a.toString(16));a.length<2;)a="0"+a;return a.toUpperCase()},_updateHsb:function(){if(this._isUpdateDisabled!==!0){var a=c(this._r,this._g,this._b);this._h=a.h||0,this._s=a.s||0,this._br=a.b||0}},_updateRgb:function(){if(this._isUpdateDisabled!==!0){var a=b(this._h,this._s,this._br);this._r=a.r,this._g=a.g,this._b=a.b}},toString:function(){return this.getHex(!1)}})}),define.Class("core.utils.css.Font",function(a){var b=a;b.utilize(["core.utils.css.Color"]),b.methods({initialize:function(a,b){if(this.setThemeManager(b),"string"==typeOf(a))this._parseFontString(a);else{var c=a||{};if(this.setStyle(c.getStyle&&"function"==typeOf(c.getStyle)?c.getStyle():void 0),this.setVariant(c.getVariant&&"function"==typeOf(c.getVariant)?c.getVariant():void 0),this.setWeight(c.getWeight&&"function"==typeOf(c.getWeight)?c.getWeight():void 0),this.setSize(c.getSize&&"function"==typeOf(c.getSize)?c.getSize():void 0),this.setLineHeight(c.getLineHeight&&"function"==typeOf(c.getLineHeight)?c.getLineHeight():void 0),this.setFontFamily(c.getFontFamily&&"function"==typeOf(c.getFontFamily)?c.getFontFamily():void 0),c.getColorReference&&"function"==typeOf(c.getColorReference)&&""!==c.getColorReference())this.setColorReference(c.getColorReference());else{var d=c.getColor&&"function"==typeOf(c.getColor)?c.getColor():"#000000";this.setColor(d)}}},getThemeString:function(){var a="theme"===this._colorSource?"{"+this.getColorReference()+"}":this.getColor();return[this._style,this._variant,this._weight,this.getSize()+"/"+this.getLineHeight(),this.getFontFamilyWithNoSpaces(),a].join(" ")},getCssRule:function(){return["font:",this.getCssValue(),"; color:",this.getColor()].join(" ")},getCssValue:function(){var a=this.getFontFamilyWithFallbacks();return[this._style,this._variant,this._weight,this.getSize()+"/"+this.getLineHeight(),a].join(" ")},getStyle:function(){return this._style},getVariant:function(){return this._variant},getWeight:function(){return this._weight},getSize:function(){return this._fontSize+this._fontUnit},getLineHeight:function(){return this._lineHeightSize+this._lineHeightUnit},getFontFamily:function(){return this._fontFamily},getFontFamilyWithNoSpaces:function(){return this._fontFamily.replace(/\s/g,"+")},getFontFamilyWithFallbacks:function(){return W.Css.getFontFallbacksCss(this._fontFamily)},getColorReference:function(){return this._colorName},getColor:function(){return this._color},_parseFontString:function(a){var b=a.split(" "),c=b[3]?b[3].split("/"):[];this.setStyle(b[0]),this.setVariant(b[1]),this.setWeight(b[2]),this.setSize(c[0]),this.setLineHeight(c[1]),this.setFontFamily(b[4]),this._setColor(b[5])},setThemeManager:function(a){this._themeManager=a},setStyle:function(a){a=Constants.FONT.STYLE.contains(a)?a:Constants.FONT.STYLE[0],this._style=a},setVariant:function(a){a=Constants.FONT.VARIANT.contains(a)?a:Constants.FONT.VARIANT[0],this._variant=a},setWeight:function(a){a=Constants.FONT.WEIGHT.contains(a)?a:Constants.FONT.WEIGHT[0],this._weight=a},setSize:function(a){var b=this._seperateSizeFromUnit(a);this._fontSize=b.size,this._fontUnit=b.unit},setLineHeight:function(a){var b=this._seperateSizeFromUnit(a);this._lineHeightSize=b.size,this._lineHeightUnit=b.unit},setFontFamily:function(a){a=a&&a.replace(/\+/g," ");var b=W.Css.getFontType(a);b||(a=W.Css.getDefaultFont(),b="system"),this._fontFamily=a},setColorReference:function(a){this._colorSource="theme",this._colorName=a,this._color=new this.imports.Color(this._themeManager&&this._themeManager.getProperty(a)).getHex()},setColor:function(a){this._colorSource="value",this._colorName="",this._color=new this.imports.Color(a).getHex()},_setColor:function(a){var b="",c=a&&(a.test(/\{.+\}/)||a.test(/\[.+\]/));a&&c?(b=c&&a.substring(1,a.length-1)||a,this.setColorReference(b)):this.setColor(a)},_seperateSizeFromUnit:function(a){a=String(a);var b=parseFloat(a),c=a.split(String(b)).join("");return b=isNaN(b)?this._getDefaultFontSize():b,c=Constants.FONT.UNITS.contains(c)?c:this._getDefaultFontUnit(),{unit:c,size:b}},_getDefaultFontSize:function(){return this._fontSize?this._fontSize:12},_getDefaultFontUnit:function(){return this._fontUnit?this._fontUnit:Constants.FONT.UNITS[0]},toString:function(){return this.getCssValue()}})}),define.Class("core.utils.css.Size",function(a){var b=a;b.statics({UNITS:["px","%","em"],DEFAULT_AMOUNT_FOR_UNIT:{px:12,"%":100,em:1}}),b.methods({initialize:function(a){if("string"==typeOf(a))this._parseSizeString(a);else{var b=a||{};this.setUnit(b.getUnit&&"function"==typeOf(b.getUnit)?b.getUnit():void 0),this.setAmount(b.getAmount&&"function"==typeOf(b.getAmount)?b.getAmount():void 0)}},multiply:function(a){return this._amount*=a,this},decrease:function(a){return this._amount-=a,this},increase:function(a){return this._amount+=a,this},getThemeString:function(){return this.getCssValue()},getCssRule:function(){return this.getCssValue()},getCssValue:function(){return this._amount+this._unit},getAmount:function(){return this._amount},getUnit:function(){return this._unit},add:function(a){var b=new this.$class(a);this._unit===b.getUnit()&&(this._amount+=b.getAmount())},_parseSizeString:function(a){var b=this._seperateAmountFromUnit(a);this.setAmount(b.amount),this.setUnit(b.unit)},setAmount:function(a){this._amount=a||0===a?a:this._getDefaultAmountForUnit(this._unit)},setUnit:function(a){this._unit=a||this._getDefaultUnit()},_seperateAmountFromUnit:function(a){a=String(a);var b=parseFloat(a),c=a.split(String(b)).join("");return c=this.UNITS.contains(c)?c:this._getDefaultUnit(),b=isNaN(b)?this._getDefaultAmountForUnit(c):b,{unit:c,amount:b}},_getDefaultAmountForUnit:function(a){return this.DEFAULT_AMOUNT_FOR_UNIT[a]||1},_getDefaultUnit:function(){return this._unit?this._unit:this.UNITS[0]},toString:function(){return this.getCssValue()}})}),define.Const("Background",{VALID_WIDTH:["auto","contain","cover"],VALID_POSITION_X:["left","right","center"],VALID_POSITION_Y:["top","bottom","center"],VALID_ATTACHMENT:["scroll","fixed"],VALID_REPEAT:["repeat","no-repeat"],DEFAULT_PYRAMID_SIZE:1920}),define.Const("BorderRadius",{VALID_UNITS:["px","%","em"]}),define.Const("BoxShadow",{VALID_UNITS:["px"]}),define.Const("FONT",{STYLE:["normal","italic"],VARIANT:["normal","small-caps","inherit"],WEIGHT:["normal","bold","bolder","lighter"],UNITS:["px","em","pt","ex","in","cm","mm","pc"]}),define.bootstrapClass("core.utils.Wixify",function(){function a(a,b,c){this._requiredParams={compData:null,compProperties:null,idPrefix:null,logicClass:null,skinClass:null,dataInstance:null,viewNode:null,style:null},this._wixifyDone=!1,this._wixifyCallback=a,this._paramsSet={},this._className=c,this._startTime=(new Date).getTime(),this._wixifyTimeout=b?b:j}var b={getType:function(){return""}},c=function(a){a.viewNode.$logic||(a.logicClass.NEW_BASE_COMP===!0?d(a):f(a))},d=function(a){var c=a.logicClass,d=a.skinClass,f=a.dataInstance,g=a.viewNode;g.wixificationState.startedWixify=!0;var i=a.compProperties,j=a.style||a.compData.innerStyle,k=e(c,g,a.idPrefix,a.compData.argsObject);W.ComponentLifecycle.registerComponent(k),f&&f!==b&&k.setDataItem(f),i&&k.setComponentProperties(i);var l=new d;j&&l.setParamMapper(j,!!a.innerStyle),k.setSkin(l),h(g)},e=function(a,b,c,d){var e=b.getProperty("id")||i(a,c),f=new a(e,b,d);
return f.invalidate(f.INVALIDATIONS.FIRST_RENDER),b.$logic=f,b.getLogic=function(){return f},f},f=function(a){a.dataInstance||(a.dataInstance=b);var c=a.viewNode;c.wixificationState.startedWixify=!0;var d=c.getProperty("id")||i(a.logicClass,a.idPrefix),e=new a.logicClass(d,c,a.compData.argsObject),f=new a.skinClass,j=a.style||a.compData.innerStyle;j&&(f.applyStyle(j),e.wixifySetStyle(j,!!a.style)),e.wixifySetSkin(f);var k=e._dataTypes_||e.getAcceptableDataTypes(),l=a.dataInstance.getType();a.compProperties&&e.setComponentProperties(a.compProperties,!0),-1!=k.indexOf(l)?a.dataInstance!==b&&e.setDataItem(a.dataInstance):LOG.reportError(wixErrors.WIXIFY_INVALID_DATA_TYPE,"wrong data type",l,", data type: "+l+", acceptable types: "+k+", component: "+e.className),g(c,e),h(c)},g=function(a,b){a.$logic=b,a.getLogic=function(){return b}},h=function(a){var b=Constants.ComponentEvents.WIXIFIED,c=a.$logic;a.wixificationState.wixifyDone=!0,delete a.wixificationState.wixifyObj,a.fireEvent(b,c),c.fireEvent(b,c),a.trigger&&a.trigger(b,c),c.trigger&&c.trigger(b,c)},i=function(a,b){b=b||"";a.prototype.className.match(/[^.]*$/)[0];return b+W.Utils.getUniqueId()};Element.implement({wixify:function(a,b,c,d,e){var f,g,h,i,j;f=this.getProperty("comp"),g=this.getProperty("skin"),h=this.getProperty("dataQuery"),i=this.getProperty("propertyQuery"),j=this.getProperty("styleId"),this.__wixifyInner__(f,g,h,i,j,a,b,c,d,e)},__wixifyInner__:function(d,e,f,g,h,i,j,k,l,m){var n,o={argsObject:i,innerStyle:m};this.wixificationState={startedLookingForResources:!0,startedWixify:!1,wixifyDone:!1,wixifyObj:{}},!l&&Constants.WixifyTimeOut&&(l=Constants.WixifyTimeOut);var p=new a(c,l,d);if(this.wixificationState.wixifyObj=p,h)W.Theme.getStyle(h,function(a){p.setParam("style",a),W.Skins.getSkin(a.getSkin(),p.getAsyncSetterFor("skinClass"))},e);else{if(p.setParam("style",void 0),!e)return LOG.reportError(wixErrors.WIXIFY_NO_SKIN,"Element","wixify",d),void 0;W.Skins.getSkin(e,p.getAsyncSetterFor("skinClass"))}if(!d)return LOG.reportError(wixErrors.WIXIFY_NO_COMP,"Element","wixify",d),void 0;if(this.getLogic)return LOG.reportError(wixErrors.WIXIFY_ALREADY_WIXIFIED,"Element","wixify",d),void 0;if(n=this,n.fireEvent("wixifyStarted"),p.setParam("viewNode",n),p.setParam("idPrefix",k),p.setParam("compData",o),j)p.setParam("dataInstance",j);else if(f){var q,r=this.getProperty("dataQuerySource");q=r&&"preview"==r&&W.Editor?W.Preview.getPreviewManagers().Data:W.Data,q.getDataByQuery(f,p.getAsyncSetterFor("dataInstance"))}else p.setParam("dataInstance",b);if(g){this.isTimedOut=!1,this.propQueryTimer=setTimeout(function(){this.isTimedOut=!0,p.setParam("compProperties",void 0)}.bind(this),1e4);var s=W.ComponentData.getDataByQuery(g,function(a){this.isTimedOut||(clearTimeout(this.propQueryTimer),p.getAsyncSetterFor("compProperties")(a))}.bind(this));s||p.setParam("compProperties",void 0)}else p.setParam("compProperties",void 0);return W.Components.getComponent(d,p.getAsyncSetterFor("logicClass")),p.run(),this}}),Elements.implement({wixify:function(a,b){for(var c=this.length-1;c>-1;--c)this[c].wixify(a,b);return this}});var j=2e3;return a.prototype={_timedOut:null,_timeOutId:null,run:function(){this._wixifyDone||(this._timeOutHandler=setTimeout(function(){this._clearTimeout(),this._onWixifyTimeout()}.bind(this),this._wixifyTimeout))},_clearTimeout:function(){clearTimeout(this._timeOutHandler)},setParam:function(a,b){if(!this._requiredParams.hasOwnProperty(a))throw"this wixifier is not waiting for a parameter named "+a;this._requiredParams[a]=b,this._paramsSet[a]=(new Date).getTime()-this._startTime,this._checkIfEverythingIsThere()},getAsyncSetterFor:function(a){return function(b){this.setParam(a,b)}.bind(this)},_checkIfEverythingIsThere:function(){var a=!0;for(var b in this._requiredParams)if(this._requiredParams.hasOwnProperty(b)&&void 0===this._paramsSet[b]){a=!1;break}a&&this._onAllWixifyParamsReady()},_onAllWixifyParamsReady:function(){if(!this._wixifyDone&&(this._wixifyDone=!0,this._clearTimeout(),this._wixifyCallback&&this._wixifyCallback(this._requiredParams),this._timedOut)){var a=(new Date).getTime()-this._startTime;LOG.reportError(wixErrors.WIXIFY_FINISHED_AFTER_TIMEOUT,a,this._timeOutId,a)}},_onWixifyTimeout:function(){this._timedOut=(new Date).getTime()-this._startTime,this._timeOutId="["+this._className+":"+this._timedOut+"]";var a=this.getMissingData(),b="Time: "+this._wixifyTimeout+". missing: "+a.join(",");W.Utils.debugTrace("Wixify Error",this._className,this._timeOutId,b),1==a.length&&"compProperties"==a[0]&&(LOG.reportError(wixErrors.WIXIFY_TIMEOUT,this._className,this._timeOutId,b),this._onAllWixifyParamsReady())},getMissingData:function(){var a=this._requiredParams,b=this._paramsSet,c=[];for(var d in a)a.hasOwnProperty(d)&&void 0===b[d]&&c.push(d);return c},toString:function(){return"[Wixifier]"}},function(){}}),define.dataSchema("BackgroundImage",{url:"string",positionx:{type:"string","enum":["left","right","center"],"default":"center"},imagesizew:{type:"number"},imagesizeh:{type:"number"},positiony:{type:"string","enum":["top","bottom","center"],"default":"center"},width:"string",repeatx:{type:"string","enum":["no_repeat","repeat"],"default":"repeat"},repeaty:{type:"string","enum":["no_repeat","repeat"],"default":"repeat"},attachment:{type:"string","enum":["scroll","fixed","inherit","local"],"default":"inherit"},color:"string"}),define.dataSchema("Button",{label:"resourceKey",toggleMode:"boolean",disabled:"boolean",iconSrc:"string",command:"string",commandParameter:"string",action:"string"}),define.dataSchema("Document",{renderModifiers:"object",name:"string",mainPage:"ref",mainPageId:"string",pages:"refList"}),define.dataSchema("FlatTheme",{THEME_DIRECTORY:{type:"themeUrl","default":"base"},BG_DIRECTORY:{type:"themeUrl","default":"base"},CONTACT_DIRECTORY:{type:"themeUrl","default":"base"},NETWORKS_DIRECTORY:{type:"themeUrl","default":"base"},EXTERNAL_LINKS_DIRECTORY:{type:"themeUrl","default":"base"},PAGES_DIRECTORY:{type:"themeUrl","default":"base"},WEB_THEME_DIRECTORY:{type:"webThemeUrl","default":"base"},font:{type:"font-family","default":"Arial,sans-serif"},bgId:{type:"imageId","default":"BG_USES_THEME_IMAGE"},bgSize:{type:"size","default":","},bgType:{type:"bgMode","default":"BG_USES_THEME_IMAGE"},siteBgColor:{type:"color","default":"0,0,0,1"},headerTextColor:{type:"color","default":"255,255,255,1"},headerBgColor:{type:"color","default":"0,0,0,0"},textColor:{type:"color","default":"255,255,255,1"},areaBgColor:{type:"color","default":"130,81,13,1"},iconBgColor:{type:"color","default":"255,255,255,1"},borderColor:{type:"color","default":"255,255,255,1"},fontHeader:{type:"font","default":"normal normal bold 2.4em/1.0em [font] {headerTextColor}"},fontTitle:{type:"font","default":"italic normal bold 2.0em/2.0em [font] {siteBgColor}"},fontSubTitle:{type:"font","default":"normal normal bold 1.2em/1.4em [font] {siteBgColor}"},fontButton:{type:"font","default":"normal normal bold 1.4em/2.2em [font] {areaBgColor}"},fontText:{type:"font","default":"normal normal normal 1.1em/1.1em [font] {siteBgColor}"},fontSmallText:{type:"font","default":"normal normal normal 0.5em/0.7em [font] {siteBgColor}"},borderContainer:{type:"border","default":"0.15em solid [borderColor]"},borderThumb:{type:"border","default":"0.15em solid [borderColor]"},borderButton:{type:"border","default":"0.15em solid [borderColor]"},borderIcon:{type:"border","default":"0.15em solid [borderColor]"},radiusContainer:{type:"radius","default":"0.6em 0.6em 0.6em 0.6em"},radiusThumb:{type:"radius","default":"0.6em 0.6em 0.6em 0.6em"},radiusButton:{type:"radius","default":"0.6em 0.6em 0.6em 0.6em"},radiusIcon:{type:"radius","default":"0.6em 0.0em 0.0em 0.6em"},padding1:{type:"padding","default":"1em 1em 1em 1em"},padding2:{type:"padding","default":"0.0em 0.5em 0.0em 0.5em"},padding3:{type:"padding","default":"1.0em 0.0em 1.0em 0.0em"},iconSize:{type:"number","default":"3.2"},bulletSize:{type:"number","default":"1.5"},headerSpacing:{type:"number","default":"0em"},componentSpacing:{type:"number","default":"0.45em"},itemSpacing:{type:"number","default":"0.75em"},thumbSpacing:{type:"number","default":"0.23em"},iconSpacing:{type:"number","default":"0.75em"}}),define.dataSchema("Header",{title:"string",imageSize:{type:"string","default":"medium"},image:"ref"}),define.dataSchema("Image",{link:"ref",title:"string",uri:"string",description:"string",height:"number",width:"number",borderSize:"string",alt:"string",originalImageDataRef:{type:"ref",description:"Original Image before edit","default":null}}),define.dataSchema("ImageList",{items:"refList"}),define.dataSchema("Link",{linkType:{type:"string","default":"FREE_LINK"},href:"string",text:"string",target:"string",icon:"string"}),define.dataSchema("TextLink",{linkType:{type:"string","default":"FREE_LINK"},href:"string",text:"string",target:"string",icon:"string"}),define.dataSchema("LinkList",{items:"refList",subType:"string"}),define.dataSchema("MediaItem",{componentType:"string",dateCreated:"string",description:"",fileName:"string",fileSize:"number",height:"number",width:"number",iconURL:"string",mediaType:"string",mimeType:"string",originalFileName:"string",sourceURL:null,tags:null,title:"",version:null}),define.dataSchema("MediaRichText",{text:"string",stylesMapId:"string",linkList:"refList",componentDataList:"refList"}),define.dataSchema("MenuItem",{text:"string",refId:"ref",items:"list"}),define.Class("core.datatypes.NavigationTreeDataClass",function(a){var b=a;b.inherits("core.managers.data.DataItemBase"),b.resources(["W.Data"]),b.methods({initialize:function(a,b){var c=a.items,d=[];c&&this._convertRawItemsToMenuItems(c,d),a.items=d,this.parent(a,b),this.setIsPersistent(!0)},_convertRawItemsToMenuItems:function(a,b){for(var c=0;c<a.length;c++){var d=a[c],e={refId:d.refId,items:[],type:"MenuItem"},f=this.resources.W.Data.createDataItem(e);b.push(f),d.items&&d.items.length>0&&this._convertRawItemsToMenuItems(d.items,f.get("items"))}},getItems:function(){return this._data.items||(this._data.items=[]),this._data.items},getAllItems:function(){var a=this.getItems(),b=[];return this._collectInternalItems(a,b)},getSubItems:function(a){var b=a.get("items"),c=[];return this._collectInternalItems(b,c)},_collectInternalItems:function(a,b){for(var c=0;c<a.length;c++){var d=a[c];b.push(d),this._collectInternalItems(d.get("items"),b)}return b},getItemByRefId:function(a){var b=this.getItems();return this._getItemFromItemsByRefId(b,a)},getAllItemRefIds:function(){var a=this.getAllItems();return _.map(a,function(a){return a.get("refId").slice(1)})},_getItemFromItemsByRefId:function(a,b){for(var c=0;c<a.length;c++){var d=a[c];if(d.get("refId")==b)return d;if(d.get("items")&&d.get("items").length>0){var e=this._getItemFromItemsByRefId(d.get("items"),b);if(e)return e}}},addItem:function(a,b,c){b?this._addSubItem(a,b,c):"number"==typeof c?this.getItems().splice(c,0,a):this.getItems().push(a)},_addSubItem:function(a,b,c){var d=this.getItemByRefId(b),e=d.get("items");"number"==typeof c?e.splice(c,0,a):e.push(a)},_createNavigationItem:function(a){var b={refId:a,items:[],type:"MenuItem"};return this.resources.W.Data.createDataItem(b)},createAndAddNavigationItem:function(a,b,c){var d=this._createNavigationItem(a),e=this.getItemByRefId(b);this.addItem(d,b,c),this.fireDataChangeEvent({cause:"CREATED_AND_ADDED",parentItem:e,item:d})},deleteNavigationItem:function(a){var b=this.getItemByRefId(a),c=this.getItemParent(b,this),d=c.get("items"),e=b.get("items"),f=d.indexOf(b);if(e)for(var g=0;e.length>0;){var h=e[0];this._moveItem(h,c,f+g),g++}d.erase(b),this.fireDataChangeEvent({cause:"DELETE",item:b})},getItemLevel:function(a,b,c){var d;d=b?b.get("items"):this.getItems(),c||(c=0);for(var e=0;e<d.length;e++){var f=d[e];if(f==a)return c;if(f.get("items")&&f.get("items").length>0){var g=this.getItemLevel(a,f,c+1);if("number"==typeof g)return g}}},moveItemToParentAtIndex:function(a,b,c){this._moveItem(a,b,c),this.fireDataChangeEvent({cause:"MOVE",parentItem:b,item:a,newIndex:c})},_moveItem:function(a,b,c){var d=b?b.get("refId"):null,e=this.getItemParent(a,this),f=e.get("items");this._addBIonMovedPageToBeSubPage(d,e),f.erase(a),this.addItem(a,d,c)},_addBIonMovedPageToBeSubPage:function(a,b){!a||b&&b.get("refId")||LOG.reportEvent(wixEvents.MOVED_PAGE_TO_BE_SUB_PAGE)},getItemParent:function(a,b){b=b||this;for(var c=b.get("items"),d=0;d<c.length;d++){var e=c[d];if(e==a)return b;if(e.get("items")&&e.get("items").length>0){var f=this.getItemParent(a,e);if(f)return f}}},isSubItemByRefId:function(a){var b=this.getItemByRefId(a),c=this.getItemParent(b);return c==this?!1:!0},getItemParentByRedId:function(a){var b=this.getItemByRefId(a);return this.getItemParent(b)},fireDataChangeEvent:function(a){this._dataManager.markDirtyObject(this),this._dataManager.flagDataChange(),this.trigger(Constants.DataEvents.DATA_CHANGED,a),this.fireEvent(Constants.DataEvents.DATA_CHANGED,a)},cloneData:function(){var a={},b=[];return a.type=this._dataType,a.metaData=this._data.metaData,a.id="MAIN_MENU",this.cloneItems(this.getItems(),b),a.items=b,a},cloneItems:function(a,b){for(var c=0;c<a.length;c++){var d=a[c],e=this.cloneSingleItem(d);b.push(e),d.get("items")&&d.get("items").length>0&&this.cloneItems(d.get("items"),e.items)}},cloneSingleItem:function(a){return{refId:a.get("refId"),items:[]}},isReady:function(){if(this._isReady)return!0;var a=this.getWaitingForReadyList();return this._isReady=a.length>0?!1:!0,this._isReady},getWaitingForReadyList:function(){for(var a=[],b=this.getAllItems(),c=(this.getDataManager(),0);c<b.length;c++){var d=b[c],e=d.get("refId"),f=this.resources.W.Data.isDataAvailable(e);f||a.push(e)}return a}})}),define.dataSchema("Menu",{dataClassRef:"core.datatypes.NavigationTreeDataClass"}),define.Class("core.datatypes.PageDataClass",function(a){var b=a;b.inherits("core.managers.data.DataItemWithSchema"),b.methods({initialize:function(a,b,c,d){this.parent(c,a,b,d)},get:function(a){var b=this.parent(a);return"mobileHidePage"===a&&null===b&&(b=this.parent("hidePage")),b}})}),define.dataSchema("Page",{title:"string",hideTitle:"boolean",icon:"string",windowTitle:"string",descriptionSEO:"string",metaKeywordsSEO:"string",pageTitleSEO:"string",pageUriSEO:"string",hidePage:"boolean",underConstruction:"boolean",tpaApplicationId:"number",tpaPageId:"string",pageSecurity:{type:"object","default":{requireLogin:!1,passwordDigest:"",dialogLanguage:""}},indexable:{type:"boolean","default":!0},mobileHidePage:{type:"boolean","default":null},dataClassRef:"core.datatypes.PageDataClass",pageBackgrounds:{desktop:{custom:"boolean",ref:"ref",isPreset:"boolean"},mobile:{custom:"boolean",ref:"ref",isPreset:"boolean"}}}),define.dataSchema("RichText",{text:"string",defaultStyle:"string"}),define.dataSchema("RichTextImage",{text:"ref",image:"ref"}),define.dataSchema("Service",{title:"string",description:"string",image:"ref"}),define.dataSchema("ServiceList",{serviceType:"string",items:"refList"}),define.dataSchema("Text",{text:{type:"string","default":"asdf"}}),define.dataSchema("Theme",{properties:"object"}),define.dataSchema("TopLevelStyle",{skin:"string",style:"object",styleType:{type:"string","enum":["system","custom","userDefined"],description:"type of the style, defaults to system style","default":"system"},pageId:{type:"string",description:"for custom styles - id of the page where the component is"},compId:{type:"string",description:"for custom styles - id of the component that has the custom style"},componentClassName:{type:"string",description:"class name of the component type this style applies to"}}),define.dataSchema("TwitterFollow",{accountToFollow:{type:"string","default":"wix"}}),define.dataSchema("TwitterTweet",{defaultText:"string",accountToFollow:"string"}),define.dataSchema("WFlatTheme",{THEME_DIRECTORY:{type:"themeUrl","default":"base"},BG_DIRECTORY:{type:"themeUrl","default":"base"},CONTACT_DIRECTORY:{type:"themeUrl","default":"base"},NETWORKS_DIRECTORY:{type:"themeUrl","default":"base"},EXTERNAL_LINKS_DIRECTORY:{type:"themeUrl","default":"base"},PAGES_DIRECTORY:{type:"themeUrl","default":"base"},WEB_THEME_DIRECTORY:{type:"webThemeUrl","default":"base"},BASE_THEME_DIRECTORY:{type:"webThemeUrl","default":"base"},siteBg:{type:"background","default":"none 0 0 center center auto repeat no-repeat fixed {color_2}"},color:{type:"array",itemType:"color",defaultItems:["#000000","#000000","#FFFFFF","#FF0000","#00FF00","#0000FF","#333333","#666666","#999999","#AAAAAA","#DCDCDC","#FFFFFF","#FFFFFF","#FFFFFF","#FFFFFF","#FFFFFF","#FFFFFF","#FFFFFF","#FFFFFF","#FFFFFF","#FFFFFF","#FFFFFF","#FFFFFF","#FFFFFF","#FFFFFF","#FFFFFF","#FFFFFF","#FFFFFF","#FFFFFF","#FFFFFF","#FFFFFF","#FFFFFF","#FFFFFF","#FFFFFF","#FFFFFF","#FFFFFF"]},font:{type:"array",itemType:"font",defaultItems:["normal normal normal 24px/1.2em Arial {color_5}","normal normal bold 16px/1.1em Arial {color_5}","italic normal bold 18px/1.1em Lobster {color_5}","normal normal bold 22px/1.1em Arial {color_5}","normal normal bold 20px/1.1em Arial {color_5}","normal normal normal 18px/1.3em Arial {color_5}","normal normal normal 16px/1.2em Arial {color_6}","normal normal normal 14px/1.3em Arial {color_6}","normal normal normal 12px/1.3em Arial {color_6}","normal normal normal 10px/1.3em Arial {color_6}","normal normal normal 8px/1.3em Arial {color_6}"]},border:{type:"array",itemType:"border",defaultItems:["0.15em solid [color_0]","0.15em solid [color_0]","0.15em solid [color_0]"]},padding1:{type:"padding","default":"0 0 0 0"},padding2:{type:"padding","default":"0.0em 0.5em 0.0em 0.5em"},padding3:{type:"padding","default":"1.0em 0.0em 1.0em 0.0em"},iconSize:{type:"number","default":"3.2"},bulletSize:{type:"number","default":"1.5"},headerSpacing:{type:"number","default":"0em"},componentSpacing:{type:"number","default":"0.45em"},itemSpacing:{type:"number","default":"0.75em"},thumbSpacing:{type:"number","default":"0.23em"},iconSpacing:{type:"number","default":"0.75em"},mobileBg:{type:"background","default":"[siteBg]"},themePresets:{type:"object"}}),define.dataSchema("AnchorLink",{anchorName:{type:"string"},anchorDataId:{type:"string"},pageId:{type:"string"}}),define.dataSchema("DocumentLink",{docId:"string",name:"string"}),define.dataSchema("EmailLink",{recipient:"string",subject:"string",body:"string"}),define.dataSchema("ExternalLink",{url:"string",target:{type:"string","enum":["_self","_blank"],"default":"_blank"}}),define.dataSchema("LoginToWixLink",{postLoginUrl:"string",postSignupUrl:"string",dialog:{"enum":["createUser","login"],type:"string","default":"login"}}),define.dataSchema("PageLink",{pageId:"string"}),define.dataSchema("testType",{}),define.dataSchema("TemplateList",{id:"string",name:"string",previewSource:"string"}),define.dataSchema("PhotoProperties",{imageSize:{type:"string","enum":["small","medium","large"],"default":"medium",description:"size of the image in runtime"}}),define.Class("core.managers.ConfigurationManager",function(a){var b=a;b.inherits("bootstrap.managers.BaseManager"),b.utilize(["core.managers.configuration.MobileConfigurationManager","core.managers.Environment"]),b.resources(["BrowserUtils"]),b.statics({NO_HS:"NO_HS",NO_SV:"NO_SV"});var c=null;b.methods({initialize:function(){this.mobileConfig=new this.imports.MobileConfigurationManager,this.env=new this.imports.Environment,window.loadedFromStatic?(this._isLoadedFromStatic=!0,window.loadedFromStatic=void 0):this._isLoadedFromStatic=!1,this._hs=null,this._svSession=null},getPublishedVersion:function(){return this.getRendererModelProperty("revision")},getAppsRepoServerUrl:function(){return this.getServiceTopologyProperty("appRepoUrl")},getCacheKillerVersion:function(){return this.getRendererModelProperty("scriptsCacheKiller")},_getEditorModel:function(){return window.editorModel},getEditorModelProperty:function(a){var b=this._getEditorModel();return b&&b[a]},_getParentEditorModelProperty:function(a){var b=this.env.isInIframeInEditor()&&window.top.editorModel;return b&&b[a]},_getEditorModelPropertyWithParentFallback:function(a,b){var c=this.getEditorModelProperty(a);return void 0===c&&(c=this._getParentEditorModelProperty(a)),void 0===c&&(c=b),c},getRendererModelProperty:function(a){return window.rendererModel&&window.rendererModel[a]},getPublicModelProperty:function(a){return window.publicModel&&window.publicModel[a]},isMobileOptimizedViewOn:function(){var a=this.getPublicModelProperty("adaptiveMobileOn")||!1;return a},getExternalBaseUrl:function(){return this.getPublicModelProperty("externalBaseUrl")},getEditedSiteLoadTimeVersion:function(){return this._getEditorModel().siteHeader.version},getEditedSiteRevision:function(){return this._getEditorModel().siteHeader.revision},getLocationMapProperty:function(a){return window.serviceTopology&&window.serviceTopology.scriptsLocationMap&&window.serviceTopology.scriptsLocationMap[a]},getServiceTopologyProperty:function(){return function(a){var b={scriptsRoot:this.getLocationMapProperty("web")+"/",staticSkinUrl:this.getLocationMapProperty("skins")+"/",staticThemeUrl:this.getLocationMapProperty("web")+"/images/mobile/core/themes",staticThemeUrlWeb:this.getLocationMapProperty("skins")+"/images/wysiwyg/core/themes"};return window.serviceTopology&&(b[a]||window.serviceTopology[a])}}(),getImagesUrl:function(){var a=window.serviceTopology&&window.serviceTopology.scriptsLocationMap;return(a.web||a["html-wysiwyg"])+"/images"},getCoreThemesUrl:function(){var a=window.serviceTopology&&window.serviceTopology.scriptsLocationMap;return(a.core||a["html-client-core"])+"/images/core/themes"},getHelpServerUrl:function(){var a=this.getServiceTopologyProperty("helpServer")||"http://help.wixpress.com/support/main/html5";return window.wixEditorLangauge&&"en"!==window.wixEditorLangauge&&(a=a.replace("www",window.wixEditorLangauge)),a},setServiceTopologyProperty:function(a,b){window.serviceTopology[a]=b},getUserPublicUrl:function(){return this._getEditorModelPropertyWithParentFallback("publicUrl","")},getUserDomainListUrl:function(){var a=this.getServiceTopologyProperty("premiumServerUrl");return a+"/wix/api/domainConsole"},getSiteId:function(){return window.siteId},getMetaSiteId:function(){return this.getEditorModelProperty("metaSiteId")||this.getRendererModelProperty("metaSiteId")},isMetaSiteTemplate:function(){return this.getEditorModelProperty("metaSiteTemplate")||!1},getSiteTitleSEO:function(){return this.getRendererModelProperty("siteTitleSEO")||""},siteNeverSavedBefore:function(){return this._getEditorModelPropertyWithParentFallback("firstSave",!1)},setMetaSiteId:function(a){window.editorModel.metaSiteId=a},userHasFacebookSite:function(){return this._userHasAppType(Constants.WEditManager.SITE_TYPE_FACEBOOK)},userHasMobileSite:function(){return this._userHasAppType(Constants.WEditManager.SITE_TYPE_MOBILE)},userHasWebSite:function(){return this._userHasAppType(Constants.WEditManager.SITE_TYPE_WEB)},_userHasAppType:function(a){var b=this.getEditorModelProperty("serviceMappings");if(!b)return!1;for(var c in b)if(b[c].applicationType==a)return!0;return!1},getPremiumFeatures:function(){var a=this.getRendererModelProperty("premiumFeatures");if(!a){var b=this.getMetaSiteData();a=b&&b.premiumFeatures}return a},isPremiumUser:function(){var a=this.getPremiumFeatures();return!!(a&&a.length>0)},isNonWixDomain:function(){return"wix.com"!==this.getSiteDomain()},getSiteDomain:function(){return this.getPublicModelProperty("domain")},getCreateMobileSiteLink:function(){var a=this.getServiceTopologyProperty("createMobileUrl"),b=this.getEditorModelProperty("metaSiteData").siteName,c=this.getMetaSiteId(),d=a+b+"?flashSiteId="+c;return d},getCreateFacebookSiteLink:function(){return this._getCreateWysiwygSiteLink(Constants.WEditManager.SITE_TYPE_FACEBOOK)},getCreateWebsiteLink:function(){return this._getCreateWysiwygSiteLink(Constants.WEditManager.SITE_TYPE_WEB)},_getCreateWysiwygSiteLink:function(a){var b=a==Constants.WEditManager.SITE_TYPE_WEB?this.getServiceTopologyProperty("createWebsiteUrl"):this.getServiceTopologyProperty("createFacebookUrl"),c=this.getMetaSiteId(),d=b+"?metasite="+c;return d},isInDebugMode:_.memoize(function(){return"nodebug"!==this.getDebugMode()}),isFacebookSite:function(){var a=this.getApplicationType();return a&&"htmlfacebook"===a.toLowerCase()},getDebugMode:_.memoize(function(){return/[?&]debugArtifacts?\b/i.test(window.location.search)?"debug":this.env.$isEditorFrame?window.editorModel.mode:window.rendererModel.debugMode}),getApplicationType:function(){return window.rendererModel&&window.rendererModel.applicationType||window.siteHeader&&window.siteHeader.applicationType},getDocumentType:function(){return this.env.$isEditorFrame?window.siteHeader&&window.siteHeader.documentType:this.getRendererModelProperty("documentType")},_removeProtocol:function(a){var b=a;if(void 0!==a)return 0===b.indexOf("http://")&&(b=b.substr(5)),0===b.indexOf("https://")&&(b=b.substr(6)),b},getMediaStaticUrl:function(a){var b=this.getServiceTopologyProperty("staticMediaUrl")+"/";return a&&0===a.indexOf("micons/")?b=b.replace("media/",""):"ico"==/[^.]+$/.exec(a)[0]&&(b=b.replace("media","ficons")),b},getResourcesStaticUrl:function(){var a=this.getServiceTopologyProperty("resourcesRoot");return a||this.getServiceTopologyProperty("scriptsRoot")+"/resources/wysiwyg/bundles/"},getLanguage:function(){return window.wixEditorLangauge||this.getEditorModelProperty("languageCode")},isReady:function(){return!0},clone:function(a){return this.parent(a)},createPackage:function(){},getCurrentOrigin:function(){var a="//"+window.location.host;return a},getMetaSiteData:function(){return this._getEditorModelPropertyWithParentFallback("metaSiteData",void 0)},getMetaSiteProperty:function(a,b){var c=this.getMetaSiteData();return c&&c.hasOwnProperty(a)?c[a]:b},getRunningExperiments:function(){return this.getEditorModelProperty("runningExperiments")||this.getRendererModelProperty("runningExperiments")},getViewMode:function(){return window.viewMode},getSiteOwner:function(){var a="",b=_.find(document.cookie.split(";"),function(a){return a.match(/wixClient/)});if(b){var c=b.split("|");c=c[0].split("="),a=c[1]}return a},forceMobileOptimizedViewOn:function(){return window.location.search.indexOf("showMobileView=true")>=0},forceTabletViewOn:function(){return window.location.search.indexOf("showTabletView=true")>=0},setSessionData:function(a){this._hs=a.hs,this._svSession=a.svSession},getSvSession:function(){return this._svSession=this._svSession||Cookie.read("svSession"),this._svSession||this.NO_SV},getHS:function(){return this._hs||this.NO_HS},getMobileHelpParamIfNeeded:function(){return W.Config.env.$viewingDevice===Constants.ViewerTypesParams.TYPES.MOBILE?"?mobile&quicktour":""},getUserEmail:function(){var a=window.editorModel?window.editorModel.userInfo:this._getParentEditorModelProperty("userInfo");return a&&a.email},getMyAccountPageUrl:function(){var a=this.getMetaSiteId();return["//www.wix.com/my-account/sites#/",a].join("")},getBusinessAppsPageUrl:function(){var a=this.getMetaSiteId();return["//www.wix.com/my-account/site/",a,"/apps"].join("")},getAppInMyAccountUrl:function(a,b){var c=this.getMetaSiteId();return["//www.wix.com/my-account/site/",c,"/app#/",a,b?"?autoProvision=true":""].join("")},isCapturing:function(){return this._isCapturing||!1},_setIsCapturing_:function(a){this._isCapturing=a},isLoadedFromStatic:function(){return this._isLoadedFromStatic},getSafeMode:function(a){if("string"!=typeof a)return{badSafeModeRequested:a};if(a=a.toLowerCase(),!c){c={};var b=this.resources.BrowserUtils.getQueryParams().safemode;if(b){var d=b.join(","),e=d.split(",");_.forEach(e,function(a){a=a.trim?a.trim():a,c[a.toLowerCase()]=!0},this)}}return c.all||!!c[a]}})}),define.Class("core.managers.Environment",function(a){var b=a;b.resources(["W.Commands","W.Utils"]),b.statics({frameNames:{PUBLIC:"site",PREVIEW:"preview",EDITOR:"editor"}}),b.methods({initialize:function(){var a=this._getFrameName();this.$frameName=a,this.$isPublicViewerFrame=a===this.frameNames.PUBLIC,this.$isEditorViewerFrame=a===this.frameNames.PREVIEW,this.$isEditorlessPreview=this.$isEditorViewerFrame&&!this.isInIframeInEditor(),this.$isEditorFrame=a===this.frameNames.EDITOR,this.$viewingDevice=Constants.ViewerTypesParams.TYPES.DESKTOP,this.$editingDevice=Constants.ViewerTypesParams.TYPES.DESKTOP,this.$editorMode=this._getInitialEditorMode(),this._listenToModeChangeCommands()},_getFrameName:function(){var a="",b=window.viewMode;return a=b===this.frameNames.PUBLIC?window.publicModel?this.frameNames.PUBLIC:this.frameNames.PREVIEW:b},_getInitialEditorMode:function(){return this.$isEditorFrame||this.$isEditorViewerFrame&&this.isInIframeInEditor()?"CURRENT_PAGE":"PREVIEW"},isInIframeInEditor:function(){return window.top&&window.top!==window&&"true"===this.resources.W.Utils.getQueryParam("isEdited")},isInEditorlessPreview:function(){return this.$isEditorlessPreview},_listenToModeChangeCommands:function(){if(this.$isPublicViewerFrame||this.resources.W.Commands.registerCommandAndListener("WPreviewCommands.WEditModeChanged",this,this._onEditorModeChanged),this.$isEditorFrame){var a=this;resource.getResourceValue("W.Preview",function(b){b.getPreviewManagersAsync(function(a){a.Commands.registerCommandAndListener("WPreviewCommands.ViewerStateChanged",this,this._onViewerDeviceModeChanged)},a)})}else this.resources.W.Commands.registerCommandAndListener("WPreviewCommands.ViewerStateChanged",this,this._onViewerDeviceModeChanged)},_onViewerDeviceModeChanged:function(a){this.$viewingDevice=a.viewerMode},_onEditorModeChanged:function(a){this.$editorMode=a},isInInteractiveViewer:function(){return this.$isEditorFrame?!1:this.$isPublicViewerFrame||this.isEditorInPreviewMode()},isPublicViewer:function(){return"site"===this._getFrameName()},isInDeactivatedViewer:function(){return this.$isEditorViewerFrame&&!this.isEditorInPreviewMode()},isInTemplatePublicViewer:function(){return this.$isPublicViewerFrame&&window.rendererModel&&"Template"===window.rendererModel.documentType},getCurrentFrameDevice:function(){return this.$isEditorFrame?this.$editingDevice:this.$viewingDevice},isViewingDesktopDevice:function(){return this.$viewingDevice===Constants.ViewerTypesParams.TYPES.DESKTOP},isViewingSecondaryDevice:function(){return this.$viewingDevice!==Constants.ViewerTypesParams.TYPES.DESKTOP},isEditorInPreviewMode:function(){return"PREVIEW"===this.$editorMode},setViewingDevice:function(a){this.$viewingDevice=a}})}),define.Class("core.managers.LinkTypesManager",function(a){var b=a;b.inherits("bootstrap.managers.BaseManager"),b.fields({langFlag:!1,_allTypes:{FACEBOOK:{target:"http://www.facebook.com/wix",text:"Facebook",linkType:["EXTERNAL_LINKS","NETWORKS"],protocol:"http://",tip:"navigate to"},LINKEDIN:{target:"http://www.linkedin.com/wix",text:"LinkedIn",linkType:["NETWORKS"],protocol:"http://",tip:"navigate to"},TWITTER:{target:"http://www.twitter.com/wix",text:"Twitter",linkType:["EXTERNAL_LINKS","NETWORKS"],protocol:"http://",tip:"navigate to"},CALL:{target:"212.000.0000",text:"Call Me",linkType:["CONTACT","EXTERNAL_LINKS","NETWORKS"],protocol:"tel:",tip:"call"},SMS:{target:"212.000.0000",text:"Text Me",linkType:["CONTACT","EXTERNAL_LINKS","NETWORKS"],protocol:"sms:",tip:"text"},EMAIL:{target:"feedback@wix.com",text:"Email",linkType:["CONTACT","EXTERNAL_LINKS","NETWORKS"],protocol:"mailto:",tip:"send an email to"},MAP:{target:"wix offices new york",text:"Address",linkType:["CONTACT","EXTERNAL_LINKS","NETWORKS"],protocol:"http://maps.google.com/maps?f=q&source=s_q&hl=en&q=",tip:"open map for address "},BLOGGER:{target:"http://www.blogger.com/wix",text:"Blogger",linkType:["NETWORKS"],protocol:"http://",tip:"navigate to"},YOUTUBE:{target:"http://www.youtube.com/wix",text:"Youtube",linkType:["NETWORKS"],protocol:"http://",tip:"navigate to"},FREE_LINK:{target:"http://www.wix.com",text:"Any link",linkType:["CONTACT","EXTERNAL_LINKS","NETWORKS"],protocol:"http://",tip:"navigate to"},FLICKR:{target:"http://www.flickr.com/wix",text:"Flickr",linkType:["NETWORKS"],protocol:"http://",tip:"navigate to"},SKYPE:{target:"http://www.skype.com/wix",text:"Skype",linkType:["NETWORKS"],protocol:"http://",tip:"navigate to"},MYSPACE:{target:"http://www.myspace.com/wix",text:"MySpace",linkType:["NETWORKS"],protocol:"http://",tip:"navigate to"},VIMEO:{target:"http://www.vimeo.com/wix",text:"Vimeo",linkType:["NETWORKS"],protocol:"http://",tip:"navigate to"},DELICIOUS:{target:"http://www.delicious.com/wix",text:"Delicious",linkType:["NETWORKS"],protocol:"http://",tip:"navigate to"}}}),b.methods({getLinkTypesByMeta:function(a){var b;
if(this.langFlag===!1){for(b in this._allTypes)this._allTypes[b].text=W.Resources.get("EDITOR_LANGUAGE",b+"_TITLE");this.langFlag=!0}var c=[],d={},e=!0;for(b in this._allTypes)c=this._allTypes[b].linkType,c.indexOf(a)>=0&&(d[b]=this._allTypes[b],e=!1);return e===!0&&LOG.reportError(wixErrors.LT_LINK_UNKNOWN,"LinkTypesManager","getLinkTypesByMeta",a+""),d},getNewLink:function(a){this._allTypes[a]||LOG.reportError(wixErrors.LT_INVALID_LINK_TYPE,"LinkTypesManager","getNewLink",a+"");var b=Object.clone(this._allTypes[a]);return b.metaData={isPreset:!0},b.linkType=a,b.type="Link",delete b.tip,delete b.protocol,b},getLinkIcon:function(a){return a.toLowerCase()+".png"},gotoLink:function(a){var b=a.get("linkType"),c=a.get("target");if(W.Config.env.$isPublicViewerFrame){var d=!this._skipForceFlash(c.toLowerCase())&&this._matchCurrentUrl(c.toLowerCase());d&&this.setForceFlashCookie();var e=0===c.toLowerCase().indexOf("https://");e?c=c.replace("https://",""):0===c.toLowerCase().indexOf("http://")&&(c=c.replace("http://",""));var f=this._allTypes[b].protocol;"http://"==f&&e&&(f="https://");var g=f+c;this._changeLocation(g)}else W.Viewer.getLinkTipFunc()&&W.Viewer.getLinkTipFunc()(a,this)},_changeLocation:function(a){document.location.href=a},showLinkTip:function(a){var b=a.get("linkType"),c=this._allTypes[b].tip+" "+a.get("target");W.Preview.showPreviewTip("Link will",c)},isReady:function(){return!0},clone:function(a){return this.parent(a)},stripUrl:function(a){var b=a.replace(/(\w+:\/\/)*([\w\-_]+\.)*([\w\-_]+\.[\w\-_]+).*/,"$3"),c={com:!0,org:!0,net:!0,edu:!0,gov:!0,mil:!0,info:!0,co:!0,ac:!0},d=b.split("."),e=d[0];return c[e]?a.replace(/(\w+:\/\/)*([\w\-_]+\.)*([\w\-_]+\.[\w\-_]+\.[\w\-_]+).*/,"$3"):b},setForceFlashCookie:function(){var a=new Date;a.setTime(a.getTime());var b=20,c=new Date(a.getTime()+1e3*b*60);document.cookie="forceFlashSite=true;path="+window.location.pathname+";domain=."+this.stripUrl(window.location.hostname)+";expires="+c.toGMTString()},_skipForceFlash:function(a){return window.location.href.toLowerCase()==a},_matchCurrentUrl:function(a){return this.stripUrl(window.location.href.toLowerCase())==this.stripUrl(a)}})}),define.Class("core.managers.configuration.MobileConfigurationManager",function(a){var b=a;b.statics({MOBILE_WIDTH:320,TINY_MENU_SIZE:50,SITE_SEGMENT_PADDING_X:20,COMPONENT_MOBILE_MARGIN_Y:20,MOBILE_MAX_WIDTH:600,TABLET_MAX_WIDTH:1100}),b.methods({isAppleMobileDevice:function(){return W.Config.env.$isPublicViewerFrame&&window.MobileUtils?MobileUtils.isAppleMobileDevice():!1},isAndroidMobileDevice:function(){return W.Config.env.$isPublicViewerFrame&&window.MobileUtils?MobileUtils.isAndroidMobileDevice():!1},isMSMobileDevice:function(){return W.Config.env.$isPublicViewerFrame&&window.MobileUtils?MobileUtils.isMSMobileDevice():!1},getMobileScreenWidth:function(){return W.Config.env.$isPublicViewerFrame?window.MobileUtils?MobileUtils.getScreenWidth():!1:(LOG.reportError(wixErrors.NO_MOBILE_IN_EDITOR,this.className,"getMobileScreenWidth"),!1)},getMobileScreenHeight:function(){return W.Config.env.$isPublicViewerFrame?window.MobileUtils?MobileUtils.getScreenHeight():!1:(LOG.reportError(wixErrors.NO_MOBILE_IN_EDITOR,this.className,"getMobileScreenHeight"),!1)},isMobile:function(){return W.Config.env.$isPublicViewerFrame&&window.MobileUtils?W.Config.isCapturing()?this._isMobile=W.Config.env.isViewingSecondaryDevice():"boolean"!=typeof this._isMobile&&(this._isMobile=MobileUtils.isMobile()):this._isMobile=!1,this._isMobile},_getTabletScreenWidth:function(){var a=this.isAppleMobileDevice();return a||this.isNewChromeOnAndroid()?screen.width:screen.width/this._getDevicePixelRatio()},isTablet:function(){if("boolean"!=typeof this._isTablet&&W.Config.forceTabletViewOn()&&(this._isTablet=!0),"boolean"==typeof this._isTablet)return this._isTablet;if(!W.Config.env.$isPublicViewerFrame)return this._isTablet=!1,this._isTablet;var a=this._getTabletScreenWidth();return this._isTablet=a>=this.MOBILE_MAX_WIDTH&&a<this.TABLET_MAX_WIDTH&&this.isTouchScreen(),this._isTablet},isMobileOrTablet:function(){return this.isMobile()||this.isTablet()},isTouchScreen:function(){return this._isTouch=this._isTouch||Modernizr.touch,this._isTouch},isPortrait:function(){return W.Config.env.$isPublicViewerFrame&&window.MobileUtils?MobileUtils.isPortrait():!0},isNewChromeOnAndroid:function(){return W.Config.env.$isPublicViewerFrame?window.MobileUtils?MobileUtils.isNewChromeOnAndroid():!1:(LOG.reportError(wixErrors.NO_MOBILE_IN_EDITOR,this.className,"isNewChromeOnAndroid"),!1)},isAndroidOldBrowser:function(){var a=/chrome/i.test(navigator.userAgent.toLowerCase());return this.isAndroidMobileDevice()&&!a?!0:!1},getZoom:function(){return W.Config.env.$isPublicViewerFrame?window.MobileUtils?MobileUtils.getZoom():!1:(LOG.reportError(wixErrors.NO_MOBILE_IN_EDITOR,this.className,"getZoom"),!1)},getInitZoom:function(){return W.Config.env.$isPublicViewerFrame?((!this._deviceInitZoom||this._deviceInitZoom<0||this._deviceInitZoom>5)&&(this._deviceInitZoom=this.getMobileScreenWidth()/document.body.offsetWidth),this._deviceInitZoom):(LOG.reportError(wixErrors.NO_MOBILE_IN_EDITOR,this.className,"getInitZoom"),!1)},_getDevicePixelRatio:function(){return this.isMSMobileDevice()?Math.round(window.screen.availWidth/document.documentElement.clientWidth):window.devicePixelRatio}})}),define.Class("core.managers.ResourceManager",function(a){var b=a;b.inherits("bootstrap.managers.BaseManager"),b.resources(["scriptLoader","topology","W.Utils","W.Config","W.Experiments"]),b.fields({_bundleMap:{EDITOR_LANGUAGE:"/resources/editor/bundles/_generated/html_editor_",WIXAPPS_LANGUAGE:"/resources/editor/wixapps/wixapps_",WIXAPPS2_LANGUAGE:"/resources/editor/wixapps2/wixapps2_",FEEDBACK_REVIEW:"/resources/editor/bundles/feedback_review/feedback_review_"},_bundleWaitList:{}}),b.statics({STABLE_LANGUAGES:["en","de","es","fr","it","pl","pt","ru","ja","ko","tr"],EXPERIMENTAL_LANGUAGES:[]}),b.methods({initialize:function(){this.bundles={},this._currentBundle="EDITOR_LANGUAGE",this.langSymbol=this.getLanguageSymbol(),this._missingTranslation=[]},get:function(a,b,c){var d=this.getBundle(a,b);return d?d.hasOwnProperty(b)?d[b]:c?c:(this._missingTranslation.push(b),"localized item not found: [ "+b+"] in bundle: [ "+a+" ] "):c?c:(this._missingTranslation.push(b),"bundle wasn't loaded yet: [ "+a+" ] when requesting [ "+b+" ]")},getCur:function(a,b){return this.get(this._currentBundle,a,b)},getBundle:function(a,b){var c=this.bundles[a];return c||LOG.reportError(wixErrors.RESOURCE_MANAGER_BUNDLE_NOT_FOUND,"mobile.editor.managers.ResourceManager","getBundle",[a,b]),c},isKeyInBundle:function(a,b){var c=this.getBundle(a);return!(!c||!c.hasOwnProperty(b))},waitForBundleReady:function(a){var b=Q.defer(),c=this.bundles[a];return c?b.resolve():(this._bundleWaitList[a]||(this._bundleWaitList[a]=[]),this._bundleWaitList[a].push(b)),b.promise},getUrlForLanguage:function(a,b){b=b||this.langSymbol;var c=this.resources.topology.langs;return c+(this._bundleMap[a]||this._bundleMap.EDITOR_LANGUAGE)+b+".json"},setBundle:function(a,b){this.bundles[a]=b,this._bundleWaitList[a]&&(_.each(this._bundleWaitList[a],function(a){a.resolve()}),delete this._bundleWaitList[a])},replacePlaceholders:function(a,b){if("string"!=typeof b)return"";var c=this.getBundle(a,b);return b.replace(/\[.+?\]/g,function(a){var b=a.substring(1,a.length-1),d=c[b];return void 0!==d?d:a})},loadLanguageBundle:function(a,b,c){var d=this.getUrlForLanguage(a),e=this;this.resources.scriptLoader.loadResource({url:d},{onLoad:function(d){e.setBundle(a,d),e.define.resource(a,d),b.call(e,d,a,c)},onFailed:function(f){e.setBundle(a,{}),e.define.resource(a,{}),b.call(e,f,a,c),LOG.reportError(wixErrors.LANGUAGE_PACK_FAILED_TO_LOAD,{c1:a,c2:d,language:c})}})},_getEnvLangCode:function(){return this.resources.W.Config.getLanguage()},_isLanguageSupportedByEditor:function(a){var b=a.toLowerCase(),c="lang_"+b;return this.STABLE_LANGUAGES.contains(a)?!0:this.EXPERIMENTAL_LANGUAGES.contains(a)?W.Experiments.isExperimentOpen("multilang")||W.Experiments.isExperimentOpen(c):void 0},getLanguageSymbol:function(){var a="en",b=this.resources.W.Utils.getQueryParam("lang"),c=String(b||this._getEnvLangCode()||a).toLowerCase();return this._isLanguageSupportedByEditor(c)&&(a=c),window.wixEditorLangauge=a,window.wixEditorLangauge},getMissingTranslations:function(){return this._missingTranslation},clone:function(a){var b=this.parent(a);return b.bundles=this.bundles,b._currentBundle=this._currentBundle,b}})}),define.Class("core.managers.components.BCComponentDeserializer",function(a){var b=a;b.utilize(["core.managers.components.ComponentBuilder"]),b.resources(["W.Data","W.Preview"]),b.methods({initialize:function(){this._previewDataManager=null},deserializeComponents:function(a,b,c){var d=a.map(this._createBuilderFromCompDescription.bind(this)),e=[];d.forEach(function(a){a.onCreated(function(a,f){e.push(a),e.length===d.length&&b(e),(c||function(){})(a,f)}).create()})},deserialize:function(a,b){this._createBuilderFromCompDescription(a).onCreated(b).create()},_createBuilderFromCompDescription:function(a){var b=a.node;this._isComponentRichText(a)&&this._cloneDataWithNewId(a);var c=this._initBuilder(a,b),d=a.components||[];return this._createChildren(d).each(this._attchToBuilder(c)),c},_isComponentRichText:function(a){return a.dataQuery&&-1!==a.componentType.indexOf("WRichText")},_cloneDataWithNewId:function(a){this._previewDataManager=this._previewDataManager||this.resources.W.Preview.getPreviewManagers().Data;var b=this._previewDataManager.getDataByQuery(a.dataQuery);this._handleTextComponentPaste(b.getData())},_handleTextComponentPaste:function(a){var b=a.text;if(b){var c,d=/<a[^>]*?dataquery\=\"([^\"]+)\"/g,e=d.exec(b);this._previewDataManager=this._getPreviewManagerData();for(var f=this._previewDataManager;e&&e.length>0;){c=e[1];var g=f.getDataByQuery(c);if(g=g||f.getDataByQuery("#"+c),!g)return LOG.reportError(wixErrors.LINK_DATA_ITEM_DOESNT_EXIST,"WClipBoard","_handleTextComponentPaste",c),void 0;var h=g.getData(),i=Object.clone(h);delete i.id;var j=f.addDataItemWithUniqueId("Link",i),k="#"+j.id;b=b.replace(c,k),e=d.exec(b)}a.text=b}},_getPreviewManagerData:function(){return this._previewDataManager||this.resources.W.Preview.getPreviewManagers().Data},_createChildren:function(a){return a.map(this._createBuilderFromCompDescription.bind(this))},_attchToBuilder:function(a){return function(b){a.data.node.appendChild(b.data.node),a.withChild(b)}},_initBuilder:function(a,b){var c=new this.imports.ComponentBuilder(b);return c.withType(a.comp||a.componentType).withSkin(a.skin)._with("htmlId",a.htmlId||a.id).withUid(a.uId)._with("propertyQuery",a.propsID)._with("styleId",a.styleId).withData(a.dataQuery).withArgs(a.argObject)._with("layout",a.layout)._with("paddingBottom",a.paddingBottom)._with("minHeight",a.minHeight).withIdPrefix(a.idPrefix)}})}),define.Class("core.managers.component.BaseCompSchemaGenerator",function(a,b){var c=a,d=b;c.statics({generateComponentSchema:function(a,b){if(a){var c=this._aggregateSchema(a,b);a.$compSchema=c,a.prototype.$compSchema=c}},_aggregateSchema:function(a,b){b=b||{};for(var c={},d=this._getTraitsWithNewSchemaField(a),e=0;e<d.length;++e){var f=d[e],g=f._definitionFieldName_,h=f._fieldName_,i=f._aggregateSchema_,j=b[g];c[h]=this._aggregateSchemaField(a,j,i,g,h)}return c},_aggregateSchemaField:function(a,b,c,e,f){var g;switch(d.getInheritStrategy(b)){case d.STRATEGIES.INHERIT:g=this._aggregateInheritSchema(a,c,f),g=this._aggregateTraits(a,g,c,e);break;case d.STRATEGIES.MERGE:g=this._aggregateInheritSchema(a,c,f),g=this._mergeFieldData(g,b,c),g=this._aggregateTraits(a,g,c,e);break;case d.STRATEGIES.OVERRIDE:g=c(b),g=this._aggregateTraits(a,g,c,e)}return g},_aggregateInheritSchema:function(a,b,c){var d=a.prototype._extends_;return d.$compSchema&&d.$compSchema[c]||null},_aggregateTraits:function(a,b,c,e){for(var f=this._getClassTraitsWithoutParentTraits(a),g=0;g<f.length;++g){var h=(f[g].prototype,f[g]._classDef_),i=h[e];d.getInheritStrategy(i)===d.STRATEGIES.MERGE&&(b=this._mergeFieldData(b,i,c))}return b},_mergeFieldData:function(a,b,c){var d=b.include||null,e=b.exclude||null;return c(a,d,e)},_getClassTraitsWithoutParentTraits:function(a){var b=a.prototype._traits_,c=a.prototype._extends_;if(c){var d=c.prototype._traits_;b=b.filter(function(a){return d.contains(a)?void 0:a})}return b},_getTraitsWithNewSchemaField:function(a){var b=a.prototype._traits_;return _.filter(b,function(a){return"string"==typeof a._fieldName_&&"function"==typeof a._aggregateSchema_?a:void 0})}})}),define.Class("mobile.core.components.base.BaseComponent",function(a){var b=a;b.utilize(["core.components.base.SizeLimits"]),b.inherits("core.events.EventDispatcher"),b.traits(["bootstrap.utils.Events","core.components.base.traits.BaseCompBehaviors"]),b.binds(["getComponentProperties","_setSkinPartElements","_onDefaultAction","_replaceSkin","_replaceSkinAsync","_onRenderingTriggerEvent","_onComponentWixified","_skinParamsChange","_onRender","initComponentLayout","_onFocus","_onBlur","_onReadyForDomDisplay","_onReadyWhenCapturing"]),b.statics({MINIMUM_X_DEFAULT:-2e3,MAXIMUM_X_DEFAULT:2e3,MINIMUM_Y_DEFAULT:-1e3,MAXIMUM_Y_DEFAULT:4e4,MINIMUM_WIDTH_DEFAULT:5,MINIMUM_HEIGHT_DEFAULT:5,MAXIMUM_WIDTH_DEFAULT:2500,MAXIMUM_HEIGHT_DEFAULT:15e3,DISPLAY_EVENTS:_.toArray(Constants.DisplayEvents),EDITOR_META_DATA:{general:{settings:!0,design:!0,animation:!0},custom:[],dblClick:{},mobile:{}}}),b.fields({_renderTriggers:[]}),b.methods({initialize:function(a,b,c){this._lastMeasureHeight=0,this._$scale=1,this._layoutInitialized=!1,this._anchors=[],this._$x=this._$y=0,this._$width=this._$height=100,this._reverseAnchors=[],this._actualHeight=-1,this._autoSizeTimerIntervals=-1,this._rotatable=!1,this.addEvent("render",this._onRender),this.addEvent("autoSized",this._onAutoSized),this.addEvent("autoSizedAnimation",this._onAutoSizedAnimation),this._baseComponentOriginalInitialize(a,b,c),this._showOnAllPagesChangeability=!0,this._resizableSides=[Constants.BaseComponent.ResizeSides.TOP,Constants.BaseComponent.ResizeSides.LEFT,Constants.BaseComponent.ResizeSides.BOTTOM,Constants.BaseComponent.ResizeSides.RIGHT],this._moveDirections=[Constants.BaseComponent.MoveDirections.HORIZONTAL,Constants.BaseComponent.MoveDirections.VERTICAL],this._view.setStyle("visibility","hidden"),this.addEvent(Constants.ComponentEvents.READY_FOR_RENDER,this.initComponentLayout),(W.Config.isCapturing()||W.Config.isLoadedFromStatic())&&(this.addEvent(Constants.ComponentEvents.READY,this._onReadyWhenCapturing),this._view.addEvent(Constants.ComponentEvents.DOM_DISPLAY_READY,this._onReadyForDomDisplay))},isDraggable:function(){return!0},_baseComponentOriginalInitialize:function(a,b,c){this._idPrefix=b.get("idprefix"),this._uniqueCompId=a,this._compId=this._removeIdPrefix(a),this._view=b,this.$view=b,this._styleNameSpace=c&&c.styleNameSpace,this._isEnabled=!b.disabled,this._view.setProperty("id",c&&c.id||a),this._allComponentPartsReady=!1,this._componentReady=!1,this._isRenderNeeded=!0,this._autoBoundParts=null,this._isDisposed=!1,this._isRendered=!1;var d=c&&c.command||b.getAttribute("command");this._commandParameter=c&&c.commandParameter||b.getAttribute("commandParameter"),this._command=null,this._commandName=null,this._usesExternalData=!1,this._callLaterIDs=[],this._stateGrpDict={},this._sizeLimits=this.getSizeLimits(),this._minimumTimeBetweenRenders=this._minimumTimeBetweenRenders||0,this._lastRenderTime=-9999,this._renderDelayed=!1,d&&this.setCommand(d,this._commandParameter),this._isDisplayed=!1,b.addEvent(Constants.ComponentEvents.WIXIFIED,this._onComponentWixified)},toString:function(){return"[Component "+this.className+" #"+this._compId+"]"},getComponentId:function(){return this._compId},getComponentUniqueId:function(){return this._uniqueCompId},_removeIdPrefix:function(a){return this._idPrefix?a.replace(this._idPrefix,""):a},_getDataManager:function(){return this._data.getDataManager()},getViewNode:function(){return this._view},getStyleNameSpace:function(){return this._styleNameSpace||this.getOriginalClassName()},getSizeLimits:function(){return void 0===this._sizeLimits&&(this._sizeLimits=new this.imports.SizeLimits,this._sizeLimits.minW=this._sizeLimits.minW||this.MINIMUM_WIDTH_DEFAULT,this._sizeLimits.minH=this._sizeLimits.minH||this.MINIMUM_HEIGHT_DEFAULT,this._sizeLimits.maxW=this._sizeLimits.maxW||this.MAXIMUM_WIDTH_DEFAULT,this._sizeLimits.maxH=this._sizeLimits.maxH||this.MAXIMUM_HEIGHT_DEFAULT,this._originalSizeLimits=this._sizeLimits.clone()),this._sizeLimits},_initSizeLimits:function(){},setMinW:function(a){this.getSizeLimits().minW=a,this._originalSizeLimits.minW=a,this._applySizeLimitsIfNeeded()},setMinH:function(a){this.getSizeLimits().minH=a,this._originalSizeLimits.minH=a,this._applySizeLimitsIfNeeded()},setMaxW:function(a){this.getSizeLimits().maxW=a,this._originalSizeLimits.maxW=a,this._applySizeLimitsIfNeeded()},setMaxH:function(a){this.getSizeLimits().maxH=a,this._originalSizeLimits.maxH=a,this._applySizeLimitsIfNeeded()},_applySizeLimitsIfNeeded:function(){(this._$width<this.getSizeLimits().minW||this._$width>this.getSizeLimits().maxW)&&this.setWidth(this._$width),(this._$height<this.getSizeLimits().minH||this._$height>this.getSizeLimits().maxH)&&this.setHeight(this._$height)},getAcceptableDataTypes:function(){return this._dataTypes_||[""]},getRawData:function(){return this._data?this._data.getData():void 0},getDataItem:function(){return this._data},isUsingExternalData:function(){return this._usesExternalData},setDataItem:function(a){var b=this._data;try{b&&this._dataItemCleanup(b,!0)}catch(c){}this._data=a,a&&a!=b&&(this._data.addComponentWithInterest(this),this._data.on(Constants.DataEvents.DATA_CHANGED,this,this._onDataChangeInner),this._view.setAttribute("dataquery","#"+this._data.get("id"))),this._onDataChange(a),this._tryCreatingComponentParts()},setDataByQuery:function(a,b){this.injects().Data.getDataByQuery(a,function(a){this.setDataItem(a),b&&b()}.bind(this))},_updateSkinParts_:function(a){this._setSkinPartElements(a)},_setSkinPartElements:function(a){this._validateSkinParts(a),this._skinPartElements=a,this._tryCreatingComponentParts()},_validateSkinParts:function(a){var b;for(var c in this._skinPartsSchema)if(b=this._skinPartsSchema[c],!a[c]&&!b.optional&&b.autoCreate!==!1&&!b.repeater){var d="class:"+this.$className+"|skin-class:"+this._skin.$className+"|skin-part:"+c;LOG.reportError(wixErrors.SKIN_PART_MISSING,"BaseComponent","_validateSkinParts",d)}},_tryCreatingComponentParts:function(){var a=this.getAcceptableDataTypes().indexOf("")>=0,b=this._data||a;this._skinPartElements&&b&&this._loadComponentParts()},_loadComponentParts:function(){this._allComponentPartsReady=!1,this._skinParts=this._skinPartElements;var a={},b=[],c={};for(var d in this._skinPartsSchema)if("view"!=d){var e=this.getSkinPartDefinition(d),f=this._doesSkinPartNeedAutoWixification(d,!0,e);if(f){var g=this._skinParts[d]||new Element("div");a[d]=g,c[d]=e,b.push(g)}}delete this._skinPartElements,0!==b.length?this._wixifyPartsAndSetToSkinParts(b,a,c):this._setAllPartsReady()},_wixifyPartsAndSetToSkinParts:function(a,b,c){var d=this;W.Utils.waitForAnEventOnObjects(a,this._getEventToWaitForOnSkinParts(),function(a){if(a&&!d._isDisposed){for(var c in b){var e=b[c];c=e.get("skinPart"),c&&(d._skinParts[c]=e.getLogic())}d._setAllPartsReady()}},!0);for(var e in b)this._createInnerComponent(e,b[e],!0,c[e])},_getEventToWaitForOnSkinParts:function(){return this._isDisplayed?Constants.ComponentEvents.READY:Constants.ComponentEvents.WIXIFIED},_doesSkinPartNeedAutoWixification:function(a,b,c){return c=c||this.getSkinPartDefinition(a),c.type==Constants.ComponentPartTypes.HTML_ELEMENT||c.repeater?!1:b&&c.autoCreate===!1?!1:!0},_createInnerComponent:function(a,b,c,d){return d=d||this.getSkinPartDefinition(a),d.type==Constants.ComponentPartTypes.HTML_ELEMENT||d.repeater||c&&d.autoCreate===!1?void 0:(d.skin=d.skin||b.getProperty("skin"),this._createComponentbyDefinition(d,b))},_createComponentbyDefinition:function(a,b,c){b=b||new Element("div"),b.setProperty("skinPart",a.id);var d;if(a.dataQuery)d=a.dataQuery;else if(a.dataRefField){var e=a.dataRefField;d="*"===e?this._data:this._data.get(e)}else if(a.dataItem)d=a.dataItem;else if(a.dataType){var f=this._data?this._data.getDataManager():W.Data;d=f.addDataItemWithUniqueId("",{type:a.dataType}).dataObject,d.setMeta("isPersistent",!1)}this._data&&this._data.getDataManager()!==W.Data?b.set("dataQuerySource","preview"):a.dataQuerySource&&b.set("dataQuerySource",a.dataQuerySource),a.argObject=a.argObject||{};var g;a.styleGroup&&this._style&&(g="inherit"===a.styleGroup?this._style:this._style.getStyleByGroupName(a.styleGroup)),!g&&a.styleId&&b.setProperty("styleId",a.styleId);var h;return(c||g)&&(h=function(a){c&&c(a)}),this.injects().Components.createComponent({compNode:b,type:a.type,skin:a.skin,data:d,args:a.argObject,componentReadyCallback:h,innerStyle:g})},getSkinPartDefinition:function(a){var b=this._skinPartsSchema[a];if(!b)return LOG.reportError(wixErrors.CM_NO_PART,this.className,"getSkinPartParams",a),null;var c=this._skinPartsSchema[a]||{},d=this._skin&&this._skin.getCompPartsDefinition()[a]||{},e=Object.merge({id:a},d,c);return e.hookMethod&&"function"==typeOf(this[e.hookMethod])&&(e.argObject=e.argObject||{},e=this[e.hookMethod](e)),e},_setAllPartsReady:function(){this._allComponentPartsReady||(this._allComponentPartsReady=!0,this._registerDataBindings(),this._registerSkinPartCommands(),this._applySizeLimitsIfNeeded(),this._onAllSkinPartsReady(this._skinParts),this._renderIfReady())},setTextContent:function(){W.Utils.debugTrace("")},setSkin:function(a){if(this._skin&&this._skin.unRegister(),this._skinParts&&this._skinParts.inlineContent){var b=this._skin.getInlineContent?this._skin.getInlineContent():this._skin._getInlineContent();this._view.empty(),this._view.adopt(b)}this._skin=a;var c=this.getSizeLimits(),d=this._originalSizeLimits;c.minW=this._skin.minW||d.minW,c.minH=this._skin.minH||d.minH,c.maxW=this._skin.maxW||d.maxW,c.maxH=this._skin.maxH||d.maxH,this._skin.register(this._view,this._setSkinPartElements,this._skinParamsChange,this)},initSkinAndStyle:function(a,b){if(!this._skin){this._skin=a,this._style=b;var c=this.getSizeLimits(),d=this._originalSizeLimits;c.minW=this._skin.minW||d.minW,c.minH=this._skin.minH||d.minH,c.maxW=this._skin.maxW||d.maxW,c.maxH=this._skin.maxH||d.maxH,this._skin.applyStyle(b),this._updateViewAttributes(),this._style.addEvent("skinChange",this._replaceSkinAsync),this._skin.register(this._view,this._setSkinPartElements,this._skinParamsChange,this),this._onStyleReady()}},setStyle:function(a){a!==this._style&&(this._style&&this._style.removeEvent("skinChange",this._replaceSkinAsync),this._style=a,a.getSkin()!=this._skin.getOriginalClassName()?this._skin.injects().Skins.getSkin(a.getSkin(),this._replaceSkin):this._skin.applyStyle(a),this._updateViewAttributes(),this._style.addEvent("skinChange",this._replaceSkinAsync),this._onStyleReady())},_onStyleReady:function(){},getStyle:function(){return this._style},_replaceSkinAsync:function(){this._skin.injects().Skins.getSkin(this._style.getSkin(),this._replaceSkin)},_replaceSkin:function(a){var b=new a;b.applyStyle(this._style),this.setSkin(b)},_updateViewAttributes:function(){this._view.removeAttribute("styleId"),this._view.setAttribute("skin",this._skin.$className),this._style&&(this._view.removeAttribute("skin"),this._view.setAttribute("styleId",this._style.getId()))},render:function(){},_onAllSkinPartsReady:function(){},_onDataChange:function(a,b,c){this._preventRenderOnDataChange(a,b,c)||this._renderIfReady()},_preventRenderOnDataChange:function(){},_renderIfReady:function(){this._componentReady?this._tryRender(!0):this._testComponentReady()},renderIfNeeded:function(){this._componentReady?this._tryRender(!1):this._testComponentReady()},_tryRender:function(a){if(this._isRenderNeeded=this._isRenderNeeded||!!a,!this._componentReady||!this._needsRender()||!this._allComponentPartsReady)return this._componentReady&&this._allComponentPartsReady;var b=!1;if(0===this._minimumTimeBetweenRenders||this._timeSinceLastRender()>this._minimumTimeBetweenRenders)this._prepareForRender()&&(b=!0,this.fireEvent(Constants.ComponentEvents.READY_FOR_RENDER),!this._skipRender&&this._isDisplayed&&(this._isRenderNeeded=!1,this._newlyDisplayed=!1,this._lastRenderTime=(new Date).getTime(),this.render(),this._isRendered=!0,this._refreshDataBindings(),this._areRenderingTriggersAttached||(this._areRenderingTriggersAttached=!0,this._attachRenderTriggers()),this.fireEvent(Constants.ComponentEvents.RENDER),this._view.fireEvent(Constants.ComponentEvents.RENDER)));else if(!this._renderDelayed){this._renderDelayed=!0;var c=Math.max(10,this._minimumTimeBetweenRenders-this._timeSinceLastRender());this.callLater(this._delayedRenderCB,[a],c)}return b},_delayedRenderCB:function(a){this._renderDelayed=!1,this._tryRender(a)},_timeSinceLastRender:function(){return(new Date).getTime()-this._lastRenderTime},_needsRender:function(){return this._isRenderNeeded},isReady:function(){return this._componentReady},isRendered:function(){return this._isRendered},isDomDisplayReadyOnReady:function(){return!0},isPartiallyFunctionalInStaticHtml:function(){return!1},isInvisibleInStaticHtml:function(){return!1},_onReadyWhenCapturing:function(){this.isDomDisplayReadyOnReady()&&this._onCompNoChildrenReady()},_onCompNoChildrenReady:function(){var a=this._getNodesDomDisplayReadyPromises(this._skinParts),b=this;Q.allSettled(a).then(function(){b._view.fireEvent(Constants.ComponentEvents.DOM_DISPLAY_READY)})},_getNodesDomDisplayReadyPromises:function(a){return _.map(a,function(a){var b=Q.defer(),c=!!a.getComponentId;return a=a.$view||a,(!c||a.$logic.isReadyForDomDisplay())&&b.resolve(),a.addEvent(Constants.ComponentEvents.DOM_DISPLAY_READY,function(){b.resolve()}),b.promise})},_onReadyForDomDisplay:function(){this._isReadyForDomDisplay=!0},isReadyForDomDisplay:function(){return!!this._isReadyForDomDisplay},setCollapsed:function(a){a?this.collapse():this.uncollapse()},callLater:function(a,b,c){if(!this._isDisposed){var d=this.injects().Utils.callLater(a,b,this,c);return d&&this._callLaterIDs.push(d),d}},callRenderLater:function(a){this._isDisposed||(a=a||100,this._renderDelayed||(this._renderDelayed=!0,this.callLater(function(){this._renderDelayed=!1,this._renderIfReady()}.bind(this),[],a)))},collapse:function(){this._view&&this._view.collapse()},uncollapse:function(a){this._view&&this._view.uncollapse(a)},setState:function(a,b){this._processStates();this._currentState;b||(b=this._stateGrpDict[a]||"DEFAULT"),b=b.toUpperCase();var c=this._stateMap[b];c?c.indexOf(a)<0?LOG.reportError(wixErrors.CM_UNKNOWN_STATE_NAME,this.$className,"setState",b+":"+a):(this._currentStateMap[b]=a,this._syncState()):LOG.reportError(wixErrors.CM_UNKNOWN_STATE_GROUP,this.$className,"setState",b)},hasState:function(a,b){this._processStates(),b||(b=this._stateGrpDict[a]||"DEFAULT"),b=b.toUpperCase();var c=this._stateMap[b];return c?c.indexOf(a)<0?!1:!0:!1},removeState:function(a,b){this._processStates(),b=(b||"DEFAULT").toUpperCase();var c=this._stateMap[b];if(c){var d=this._currentStateMap[b];d==a&&delete this._currentStateMap[b],this._syncState()}else LOG.reportError(wixErrors.CM_UNKNOWN_STATE_GROUP,this.$className,"removeState",b)},_syncState:function(){var a=[];for(var b in this._stateMap)this._currentStateMap[b]&&a.push(this._currentStateMap[b]);var c=a.join(" "),d=this._view,e=this._currentState||"";this._currentState=c,null!==d&&(d.setProperty("state",c),d.addClass("FOCRE_REFLOW_PLEASE"),d.removeClass("FOCRE_REFLOW_PLEASE"),c!=e&&(this._onStateChange(c,e),this.fireEvent("stateChange",{newState:c,oldState:e}),d.triggerDisplayChanged()))},getState:function(a){var b;return a?(this._currentStateMap||this._processStates(),b=this._currentStateMap[a.toUpperCase()]):b=this._view.getProperty("state"),b||""},_processStates:function(){if(!this._stateMap){var a,b;this._currentStateMap={},this._stateMap={DEFAULT:[]};var c=this._states_||[],d={};if(c instanceof Array)for(a=0;a<c.length;++a)b=c[a],"string"!=typeof b?LOG.reportError(wixErrors.CM_MALFORMED_STATES,this.$className,"_processStates",c):this._stateMap.DEFAULT.push(b);else if("object"==typeof c)for(var e in c){var f=c[e];if(f instanceof Array){var g=e.toUpperCase();for(this._stateMap[g]=f.concat(),a=0;a<f.length;++a)b=f[a],b in d&&LOG.reportError(wixErrors.CM_DUPLICATE_STATE_NAME,this.$className,"_processStates",b),d[b]=!0,this._stateGrpDict[b]=g}else LOG.reportError(wixErrors.CM_MALFORMED_STATES,this.$className,"_processStates",e)}else LOG.reportError(wixErrors.CM_MALFORMED_STATES,this.$className,"_processStates",c)}},requestToDie:function(a,b){this.$view.trigger(Constants.ComponentEvents.REQUESTING_TO_DIE,{errorObj:a,messageToUserObj:b})},dispose:function(){if(W.Layout&&W.Layout.deleteSavedAnchorsById(this.getID()),this._isDisposed)return LOG.reportError(wixErrors.COMPONENT_ALREADY_DISPOSED,this.className,"dispose",this._compId);for(this.fireEvent(Constants.ComponentEvents.DISPOSED),this._view&&(this._disposeElement(this._view),this._view=null,this.$view=null,this._isDisposed=!0),this._dataItemCleanup(this._data),this._dataItemCleanup(this._properties),delete this._data,delete this._properties;this._callLaterIDs.length>0;){var a=this._callLaterIDs.pop();a&&this.injects().Utils.clearCallLater(a)}if(this._disposeEvents(),this.getSkin()&&this.getSkin().dispose(),this._style&&this._style.removeEvent("skinChange",this._replaceSkinAsync),this._skinParts){for(var b in this._skinParts){var c=this._skinParts[b];if(c)if(c._compId)try{c.dispose()}catch(d){}else try{this._disposeElement(c)}catch(e){}}this._skinParts=null}},_disposeElement:function(a){a.exterminate?a.exterminate():(a.cleanup(),a.destroy())},_disposeEvents:function(){this.removeEvents(),this.exterminate()},_dataItemCleanup:function(a,b){a&&(a.removeComponentWithInterest(this),a.offByListener(this),b&&this._removeSkinPartsListenersFromItem(a),a.getDataManager().removeDataItem(a))},_removeSkinPartsListenersFromItem:function(a){if(this._skinParts)for(var b in this._skinParts){var c=this._skinParts[b];c._compId&&a.offByListener(c)}},getIsDisposed:function(){return this._isDisposed},_onComponentWixified:function(){var a,b=this._view;this._canFocus&&(b.addEvent(Constants.CoreEvents.FOCUS,this._onFocus),b.addEvent(Constants.CoreEvents.BLUR,this._onBlur)),this._isDisplayed=b.isNodeDisplayed(),this._areRenderingTriggersAttached=!1;var c=this._triggers;if(c)for(a=c.length-1;a>=0;--a){var d=c[a];b.addEvent(d,this._onDefaultAction)}var e=this.DISPLAY_EVENTS,f=this._onRenderingTriggerEvent;for(a=0;a<e.length;a++)b.addEvent(e[a],f)},_onComponentReady:function(){this._view},_attachRenderTriggers:function(){for(var a=this._renderTriggers||[],b=this._view,c=a.length-1;c>=0;--c)b.addEvent(a[c],this._onRenderingTriggerEvent)},_testComponentReady:function(){if(!this._componentReady)if(this._view.$logic)this._isBaseComponentReady()&&(this._componentReady=!0,this._isEnabled?this._handleEnabled():this._handleDisabled(),this._tryRender()?(this.fireEvent(Constants.ComponentEvents.READY),this._view.trigger(Constants.ComponentEvents.READY),this._view.fireEvent(Constants.ComponentEvents.READY)):this._componentReady=!1);else{var a=function(){this._view.removeEvent(Constants.ComponentEvents.WIXIFIED,a),this._testComponentReady()}.bind(this);this._view.addEvent(Constants.ComponentEvents.WIXIFIED,a)}},_isBaseComponentReady:function(){var a=this.getAcceptableDataTypes().indexOf("")>=0,b=this._data||a;return this._allComponentPartsReady&&!!this._skinParts&&b},_prepareForRender:function(){return!0},_onStateChange:function(){},_refreshDataBindings:function(){var a=this._autoBoundParts;if(a&&a.length)for(var b=this._data&&this._data.getData(),c=this.injects(),d=c.Resources,e=c.Utils,f=this._skinParts,g=a.length-1;g>=0;--g){var h,i=a[g],j=f[i.skinPart];if(j){if(i.bindToData){if(h=b&&b[i.bindToData],null===h||void 0===h){LOG.reportError(wixErrors.CM_NO_DATA,this.className,"refreshDataBindings",i.bindToData);
continue}}else if(i.bindToDictionary){if(h=d.get("EDITOR_LANGUAGE",i.bindToDictionary),null===h||void 0===h){LOG.reportError(wixErrors.CM_NO_DICTIONARY_DATA,this.className,"refreshDataBindings",i.bindToDictionary);continue}}else i.bindToSelf&&(h=this[i.bindToSelf]);if(i.dictionaryFallback&&h.match(/^\s*$/)&&(h=d.get("EDITOR_LANGUAGE",i.dictionaryFallback)),i.isView){var k=i.viewType;if(""===k){var l=j.nodeName;if("input"==l.toLowerCase()){var m=j.getAttribute("type").toLowerCase();"text"==m?k="textinput":("checkbox"==m||"radio"==m)&&(k="check")}else k="text";i.viewType=k}if("textinput"==k)j.setAttribute("value",h);else if("check"==k){var n=e.stringToBoolean(h);n?j.setAttribute("checked",!0):j.removeAttribute("checked")}else j.innerHTML=h}else j.setTextContent(h)}}},hide:function(){this._view&&this._view.hide()},show:function(){this._view&&this._view.show()},_disableLinks:function(a){var b=this;a.addEvent("click",function(a){if(W.Config.env.$isEditorViewerFrame&&(a.preventDefault(),W.Viewer.getLinkTipFunc())){var c=$(this).getProperty("href")||"",d=b.injects().Data.createDataItem({type:"Link",target:c,linkType:"FREE_LINK"});W.Viewer.getLinkTipFunc()(d)}})},_sanitizeLinks:function(a){for(var b=0;b<a.length;++b){var c=a[b];this._sanitizeLink(c)}},_sanitizeLink:function(a){var b=a.get("href");b&&0!==b.indexOf("http://")&&0!==b.indexOf("https://")&&0!==b.indexOf("telnet://")&&0!==b.indexOf("ftp://")&&0!==b.indexOf("mailto:")&&(b.indexOf("@")>0?a.set("href","mailto:"+b):(0===b.indexOf("www")||0!==b.indexOf("www")&&0!==b.indexOf("#"))&&a.set("href","http://"+b))},_onFocus:function(){},_onBlur:function(){},_onDefaultAction:function(){this.executeCommand()},executeCommand:function(a){if(!this._command&&this._commandName){var b;b="WEditorCommands.AddComponent"==this._commandName?W.CommandsNew.getCommand(this._commandName):W.Commands.getCommand(this._commandName),b&&this.setCommand(b,this._commandParameter)}if(this._command){var c=arguments.length>0?a:this._commandParameter;c&&(c=this._parseDataReference(c)),this._command.execute(c,this)}},enable:function(){this._isEnabled||(this._isEnabled=!0,this._view.removeAttribute("disabled"),this._handleEnabled())},disable:function(){this._isEnabled&&(this._isEnabled=!1,this._view.setAttribute("disabled","disabled"),this._handleDisabled())},isEnabled:function(){return this._isEnabled},setCommand:function(a,b){var c=this.injects().Commands;if(("WEditorCommands.AddComponent"==this._commandName||"WEditorCommands.AddComponent"==a)&&(c=this.injects().CommandsNew),"string"==typeof a)this._commandName=a,a=c.getCommand(a);else if(!a instanceof c.Command&&!c.isCommandInstance(a))return LOG.reportError(wixErrors.BAD_COMMAND,this.className,"setCommand",a),void 0;this._commandParameter=b,this._command&&(this._command.unregisterListener(this),this._command=null),a?(this._command=a,a.registerListener(this,null,this._onCommandStatusChanged),this._commandName&&delete this._commandName):this._commandName&&c.registerCommandListenerByName(this._commandName,this,null,this._onCommandStatusChanged)},removeCommand:function(){this._command=null,this._commandName=null},getCommandName:function(){return this._command?this._command.getName():this._commandName},getCommandParameter:function(){return this._commandParameter},_onCommandStatusChanged:function(a){a.isEnabled()?this.enable():this.disable()},_onEnabled:function(){},_handleEnabled:function(){var a=this._view,b=a.tabIndex,c=a._savedTabIndex;(null===b||void 0===b)&&(b=-1),-1==b&&(void 0!==c?a.tabIndex=c:this._canFocus&&(a.tabIndex=0)),this._canFocus&&a.addClass("focusable"),this._componentReady&&this._onEnabled()},_onDisabled:function(){},_handleDisabled:function(){var a=this._view,b=a.tabIndex;(null===b||void 0===b)&&(b=-1),b>=0&&(a._savedTabIndex=b,a.tabIndex=-1),document.activeElement==a&&a.blur(),this._canFocus&&a.removeClass("focusable"),this._componentReady&&this._onDisabled()},_onRenderingTriggerEvent:function(a){var b=this._view.isNodeDisplayed();switch(a){case Constants.DisplayEvents.COLLAPSED:case Constants.DisplayEvents.REMOVED_FROM_DOM:this._isDisplayed=!1,this._newlyDisplayed=!1;break;case Constants.DisplayEvents.SKIN_CHANGE:this._renderTriggers.contains(Constants.DisplayEvents.SKIN_CHANGE)&&(b?this._renderIfReady():this._componentInvalidated=!0);break;case Constants.DisplayEvents.MOVED_IN_DOM:b&&this._renderTriggers.contains(Constants.DisplayEvents.MOVED_IN_DOM)&&this._renderIfReady(),this._skin.renderCssIfNeeded();break;default:var c=this._isDisplayed;this._isDisplayed=b,this._newlyDisplayed=this._newlyDisplayed||!c&&this._isDisplayed;var d=this._renderTriggers.contains(a)||this._renderTriggers.contains(Constants.DisplayEvents.DISPLAY_CHANGED);this._newlyDisplayed&&(d||!this._areRenderingTriggersAttached||this._componentInvalidated)&&(this._componentInvalidated=!1,this._renderIfReady()),this._skin.renderCssIfNeeded(),this._addedToDom()}},invalidateComponent:function(){this._componentInvalidated=!0},getIsDisplayed:function(){return this._isDisplayed},checkVisibility:function(){return this._isDisplayed=this._view.isNodeDisplayed(),this._isDisplayed},_setDataField:function(a,b){this._data.set(a,b,!0)},_setMetaDataField:function(a,b){this._data.setMeta(a,b)},getFocusNode:function(){var a=this._skinParts.view;for(var b in this._skinPartsSchema)this._skinPartsSchema[b].focus&&(a=this._skinParts[b]||a);return a},getSkinPart:function(a){return this._skinParts[a]},getSkin:function(){return this._skin},setComponentProperties:function(a,b){var c=this._properties;if(this._properties=a,a.addComponentWithInterest(this),a&&a!=c){try{c&&this._dataItemCleanup(c)}catch(d){}this._properties.on(Constants.DataEvents.DATA_CHANGED,this,this._onDataChangeInner),b||this._onDataChange(this._properties)}},getComponentProperty:function(a){return this._properties||this._createComponentProperties(),this._properties.get(a)},setComponentProperty:function(a,b,c){this._properties||this._createComponentProperties(),this._properties.set(a,b,c)},_createComponentProperties:function(){if(this._view){var a=this._compId,b=this._propertiesSchemaType_;if(!b)return null;this._properties=W.ComponentData.addDataItem(a,{type:b},this),this._properties.addComponentWithInterest(this),this._view.setProperty("propertyQuery",a),this._properties.on(Constants.DataEvents.DATA_CHANGED,this,this._onDataChangeInner),this.setIsPropertiesSavedInServer()}},setIsPropertiesSavedInServer:function(){this._properties&&this._properties.setMeta("isPersistent",!0)},_onDataChangeInner:function(a){var b=a.data;this._onDataChange(b.dataItem,b.field,b.newValue,b.oldValue)},deleteComponentProperty:function(){},_onComponentPropertyChange:function(){},_loadComponentProperties:function(){},getComponentProperties:function(){return this._properties||this._createComponentProperties(),this._properties},_registerSkinPartCommands:function(){var a=this._skinPartsSchema,b=this.injects().Commands;for(var c in a){var d=a[c],e=this._skinParts[c],f=this._parseDataReference(d.command);if(e&&f){var g;if(g="string"==typeof f?b.getCommand(f):f,"view"==c||d.type==Constants.ComponentPartTypes.HTML_ELEMENT){var h=this._parseDataReference(d.commandParameter);g?e._command=g:e._commandName=f,e._commandParameter=h;var i=e.nodeName.toLowerCase();"select"==i?e.addEvent(Constants.CoreEvents.CHANGE,this._elementChangeExecuteCommand):e.addEvent(Constants.CoreEvents.CLICK,this._elementExecuteCommand)}else e.setCommand(g||f,d.commandParameter)}}},_registerDataBindings:function(){var a=[],b=this._skinPartsSchema;for(var c in b){var d=b[c],e=this._skinParts[c];if(e){var f=d.type==Constants.ComponentPartTypes.HTML_ELEMENT,g=f?e:e.getViewNode(),h=null,i=d.autoBindData||g&&g.getAttribute("autoBindData");i?h={bindToData:i}:(i=d.autoBindDictionary||g&&g.getAttribute("autoBindDictionary"),i?h={bindToDictionary:i}:(i=d.autoBindThis||g&&g.getAttribute("autoBindThis"),i&&(h={bindToSelf:i}))),h&&(h.skinPart=c,h.isView=f,h.viewType="",h.dictionaryFallback=d.dictionaryFallback,a.push(h))}}a.length&&(this._autoBoundParts=a)},_parseDataReference:function(a){if(!a||"string"!=typeof a)return a;var b=a;try{var c=a.indexOf("this.");if(0===c){try{b=this[a.substring(5)]}catch(d){b=null}b||W.Utils.debugTrace(this.className+" unknown part data reference "+a)}else c=a.indexOf("data."),0===c&&(this._data&&(b=this._data.get(a.substring(5)))||W.Utils.debugTrace(this.className+" missing data for skinpart "+a))}catch(e){W.Utils.debugTrace(this.className+" error processing partData "+a)}return b},_elementExecuteCommand:function(a){var b=W.Commands;"WEditorCommands.AddComponent"==this._commandName&&(b=W.CommandsNew);var c=this._command||(this._command=b.getCommand(this._commandName));c&&c.execute(this._commandParameter||a,this)},_elementChangeExecuteCommand:function(){var a=this.value,b=W.Commands;"WEditorCommands.AddComponent"==this._commandName&&(b=W.CommandsNew);var c=this._command||(this._command=b.getCommand(this._commandName));c&&c.execute(a)},hasChildren:function(){return!1},onPageVisibilityChange:function(){},initComponentLayout:function(){this._view.setStyle("visibility","visible"),this.removeEvent(Constants.ComponentEvents.READY_FOR_RENDER,this.initComponentLayout),this._valueFetchingRegex=/[-\d\.]+/;for(var a=this._getLayoutParamsArray(),b=!1,c=0;c<a.length;c++){var d=a[c],e=this._view.get(d);if(null!=e&&""!==e){b=!0;var f="set"+d.capitalize();this[f](e,!0)}}this._layoutInitialized=!0,this.initComponentLayoutPosition(b),this.saveCurrentDimensions(),this.saveCurrentCoordinates()},_getLayoutParamsArray:function(){return["x","y","width","height","scale","angle","pos"]},_onRender:function(){this._intervalID&&clearInterval(this._intervalID),this._wCheckForSizeChangeAndFireAutoSized(5),this.flushMinPhysicalHeightCache()},_wCheckForSizeChangeAndFireAutoSized:function(a){if(this._view){this._autoSizeTimerIntervals=Math.max(a,this._autoSizeTimerIntervals);var b=function(){try{this._autoSizeTimerIntervals>1&&window.requestAnimFrame(b),this._autoSizeTimerIntervals>-1&&this._onAutoSized()}catch(a){}finally{this._autoSizeTimerIntervals--}}.bind(this);window.requestAnimFrame(b)}},_addedToDom:function(){this._pendingAutoSize&&(this._onAutoSized(this._pendingAutoSizeArgs),delete this._pendingAutoSize,delete this._pendingAutoSizeArgs)},_onAutoSized:function(a){this._view&&!this._isDisposed&&this._anchors&&(a&&a.ignoreLayout||!(this._anchors.length>0)||(this._needsMeasure=!0,W.Layout&&W.Layout.callForMeasure(this)),this.fireEvent("autoSizeChange"))},isAnchorsInvalidated:function(){return this._anchorsInvalidated===!0},isMeasureNeeded:function(){return this._needsMeasure},measure:function(){this._needsMeasure=!1,this.flushPhysicalHeightCache();var a=this.getPhysicalHeight();return this._heightChanged=a!=this._lastMeasureHeight,this._lastMeasureHeight=a,this._heightChanged&&this.fireEvent("autoSizeChange"),this._heightChanged},wasHeightChanged:function(){return this._heightChanged},validateHeight:function(){this._heightChanged=!1},_onAutoSizedAnimation:function(){this._wCheckForSizeChangeAndFireAutoSized(20)},_skinParamsChange:function(){this._view&&this._view.fireEvent(Constants.DisplayEvents.SKIN_CHANGE,Constants.DisplayEvents.SKIN_CHANGE),this._onAutoSized()},saveCurrentCoordinates:function(){this._lastCoords={x:this.getX(),y:this.getY()}},getCurrentCoordinates:function(){return this._lastCoords={x:this.getX(),y:this.getY()},this._lastCoords},getLastCoordinates:function(){return this._lastCoords||this.saveCurrentCoordinates(),this._lastCoords},saveCurrentDimensions:function(){this._lastDimensions={w:this.getWidth(),h:this.getHeight(),angle:this.getAngle()}},getCurrentDimensions:function(){return this._lastDimensions={w:this.getWidth(),h:this.getHeight(),angle:this.getAngle()},this._lastDimensions},setPos:function(a){this._$pos!==a&&this._setPos_(a)},_setPos_:function(a){this._$pos=a,this._saveLayoutPosition_();var b={comp:this};this.fireEvent("positionChanged",b)},applyPos:function(a){this._applyLayoutPosition_(a)},_applyLayoutPosition_:function(a){var b=a||this._$pos;"fixed"===b?(this.$view.setStyle("position","fixed"),this.$view.addClass("fixedPosition")):"absolute"===b&&(this.$view.setStyle("position","absolute"),this.$view.removeClass("fixedPosition"))},_saveLayoutPosition_:function(){"fixed"===this._$pos?this.$view.setAttribute("pos","fixed"):this.$view.removeAttribute("pos")},getLayoutPosition:function(){return this._$pos||this._getLayoutPositionFromDOM_()},_getLayoutPositionFromDOM_:function(){return this.$view.getAttribute("pos")||"absolute"},initComponentLayoutPosition:function(a){if(a&&this._view.hasAttribute("pos")===!1)"relative"!=this._view.getStyle("position")&&this._view.setStyle("position","absolute");else{var b=this._view.getAttribute("pos");b&&this._view.setStyle("position",b)}},getLastDimensions:function(){return this._lastDimensions||this.saveCurrentDimensions(),this._lastDimensions},getX:function(){return this._$x},setX:function(a,b){this._setCoordinate("_$x","left",a,!b)},getY:function(){return this._$y},setY:function(a,b){this._setCoordinate("_$y","top",a,!b)},_setCoordinate:function(a,b,c,d){var e=parseInt(c,10),f=!W.Utils.getCSSBrowserFeature("transform");if(this[a]!=e||f){if(isNaN(e))return W.Utils.debugTrace("WbaseComp","setCoordinate","NaN passed as value"),void 0;if(this[a]=e,f)switch(b){case"left":this._$leftAdjustment&&(e+=this._$leftAdjustment);break;case"top":this._$topAdjustment&&(e+=this._$topAdjustment)}this._view.setStyle(b,"".concat(e,"px")),d&&this.onMovement()}},isRotatable:function(){return this._rotatable},setAngle:function(a){var b=parseInt(a,10);if(this._$angle!=b){if(isNaN(b))return W.Utils.debugTrace("WbaseComponent","setAngle","NaN passed as value"),void 0;this._$angle=b,this._rotateComponent(b)}},getAngle:function(){return this._$angle||0},_rotateComponent:function(a){this.$view.style.webkitBackfaceVisibility=0!==a?"hidden":"";var b=W.Utils.getCSSBrowserFeature("transform");return b||0===a?(this._view.style[b]=0===a?"":"rotate("+a+"deg)",void 0):(this._rotateIEComponent(),void 0)},_rotateIEComponent:function(){var a=Math.cos(W.Utils.Math.degreesToRadians(this._$angle)),b=Math.sin(W.Utils.Math.degreesToRadians(this._$angle)),c=.5*(this._$width+this._$height*b-this._$width*a),d=.5*(this._$height-this._$height*a-this._$width*b);this._view.style.filter="progid:DXImageTransform.Microsoft.Matrix(M11="+a+", M12="+-b+", M21="+b+", M22="+a+", Dx="+c+", Dy="+d+",sizingMethod='auto expand')",this._view.style.zIndex=1,this._updateIE8FilterAdjustments(),this._setCoordinate("_$x","left",this.getX(),!1),this._setCoordinate("_$y","top",this.getY(),!1)},_updateIE8FilterAdjustments:function(){var a=W.Utils.Math.degreesToRadians(this._$angle),b=.5*(this._$width-(this._$height*Math.abs(Math.sin(a))+this._$width*Math.abs(Math.cos(a)))),c=.5*(this._$height-(this._$width*Math.abs(Math.sin(a))+this._$height*Math.abs(Math.cos(a))));this._$leftAdjustment=b,this._$topAdjustment=c},getBoundingX:function(){return parseInt(this.getX()-(this.getBoundingWidth()-this.getWidth())/2,10)},getBoundingY:function(){return parseInt(this.getY()-(this.getBoundingHeight()-this.getPhysicalHeight())/2,10)},getBoundingWidth:function(){var a=W.Utils.Math.degreesToRadians(this.getAngle()),b=this.getWidth(),c=this.getPhysicalHeight();return parseInt(Math.abs(b*Math.cos(a))+Math.abs(c*Math.sin(a)),10)},getBoundingHeight:function(){var a=W.Utils.Math.degreesToRadians(this.getAngle()),b=this.getWidth(),c=this.getPhysicalHeight();return parseInt(Math.abs(b*Math.sin(a))+Math.abs(c*Math.cos(a)),10)},_unlockSafe:function(a){var b=[61,120,13,0];if(this._rotateCounter||(this._rotateCounter=0),this.getAngle()===b[this._rotateCounter]?this._rotateCounter++:this._rotateCounter=0,4===this._rotateCounter&&"wysiwyg.viewer.components.WPhoto"===this.className&&a){var c=W.Config.getServiceTopologyProperty("staticThemeUrlWeb")+"/editor_web/easterEggs/rotate-safe.png";this._skinParts.img._skinParts.image.src=c,this._rotateCounter=0}},getWidth:function(){return this._$width},setWidth:function(a,b,c){return c!==!1&&(c=!0),a=parseInt(a,10),isNaN(a)?(W.Utils.debugTrace("WbaseComp","setWidth","NaN passed as value"),void 0):(a=this._limitWidth(a),(this._$width!=a||b)&&(this._$width=a,this._view.setStyle("width",a+"px"),c&&this._onResize(),this.flushMinPhysicalHeightCache(),this.flushPhysicalHeightCache()),void 0)},setHeight:function(a,b,c){return c!==!1&&(c=!0),a=parseInt(a,10),isNaN(a)?(W.Utils.debugTrace("WbaseComp","setHeight","NaN passed as value"),void 0):(a=this._limitHeight(a),(this._$height!=a||b)&&(this._$height=a,this._view.setStyle("min-height",this._$height+"px"),this.flushPhysicalHeightCache(),c&&this._onResize()),void 0)},isInstanceOfClass:function(a){if(this.className==a)return!0;for(var b=this.$parentPrototype;b;){if(b.className==a)return!0;b=b.$parentPrototype}return!1},canBeFixedPosition:function(){return!1},isFixedPositioned:function(){var a=W.Config.env.$viewingDevice===Constants.ViewerTypesParams.TYPES.MOBILE;return!a&&"fixed"===this._$pos},shouldBeFixedPosition:function(){return!1},getSelectableX:function(){return this.getX()},getSelectableY:function(){return this.getY()},getSelectableWidth:function(){return this.getWidth()},getSelectableHeight:function(){return this.getPhysicalHeight()},_limitWidth:function(a){var b=this.getSizeLimits();return this._limitDimension(a,b.minW,b.maxW)},_limitHeight:function(a){var b=this.getSizeLimits();return this._limitDimension(a,b.minH,b.maxH)},_limitDimension:function(a,b,c){return Math.min(Math.max(a,b),c)},getHeight:function(){return this._$height},_onResize:function(){this.fireEvent("resize"),this.trigger("resize")},onMovement:function(){this.fireEvent("componentMoved")},getPosition:function(){var a=this.getViewNode().getSize();return{y:this.getY(),x:this.getX(),height:a.y,width:a.x}},getGlobalPosition:function(){return this._view.getPosition()},getGlobalPositionRefNode:function(){return this._getEditBoxReferenceNode().getPosition()},getSizeRefNode:function(){return this._getEditBoxReferenceNode().getSize()},getID:function(){var a=this._view.getProperty("id");return this._removeIdPrefix(a)},getMinPhysicalHeight:function(){if(!this._minPhysicalHeight){var a=this.getHeight();this.setHeight(1),this._minPhysicalHeight=this.getPhysicalHeight(),this.flushPhysicalHeightCache(),this.setHeight(a)}return this._minPhysicalHeight},getPhysicalHeight:function(){return this._actualHeight=this._actualHeight||this.getViewNode().getSize().y,this._actualHeight=Math.max(this.getHeight(),this._actualHeight),this._actualHeight},getExtraPixels:function(a){return this.getDivExtraPixels(this._view,a)},getDivExtraPixels:function(a,b){var c=Number.from(a.getStyle("border-top"))+Number.from(a.getStyle("padding-top")),d=Number.from(a.getStyle("border-bottom"))+Number.from(a.getStyle("padding-bottom")),e=Number.from(a.getStyle("border-left"))+Number.from(a.getStyle("padding-left")),f=Number.from(a.getStyle("border-right"))+Number.from(a.getStyle("padding-right"));return b&&(c+=Number.from(a.getStyle("margin-top")),d+=Number.from(a.getStyle("margin-bottom")),e+=Number.from(a.getStyle("margin-left")),f+=Number.from(a.getStyle("margin-right"))),{top:c,bottom:d,left:e,right:f,height:c+d,width:e+f}},flushPhysicalHeightCache:function(){delete this._actualHeight},flushMinPhysicalHeightCache:function(){delete this._minPhysicalHeight},getAnchors:function(){return this._anchors},setAnchors:function(a){var b=this._anchors;this._anchors=a,a.forEach(this.addReverseAnchor),(!b||_.isEmpty(b))&&this.fireEvent("autoSized")},addAnchor:function(a){this._anchors.push(a),this.addReverseAnchor(a)},addReverseAnchor:function(a){a.toComp===this?this._reverseAnchors.include(a):a.toComp.addReverseAnchor(a)},getReverseAnchors:function(){return this._reverseAnchors},getHorizontalGroup:function(){return this._horizontalGroup},setHorizontalGroup:function(a){this._horizontalGroup=a},getLayoutMode:function(){return"NORMAL"},getMinDragY:function(a){return W.Layout&&W.Layout.getComponentMinDragY(this,a)},getParentComponent:function(){var a=this.getViewNode().getParent("[comp]");return a&&a.$logic?a.$logic:null},getParentSiteSegmentContainer:function(){if(this.isSiteSegment())return null;for(var a=this.getParentComponent();a&&!a.isSiteSegment();)a=a.getParentComponent();return a},isChildOfFixedPositionHeader:function(){var a=this.getParentSiteSegmentContainer();return a&&"wysiwyg.viewer.components.HeaderContainer"===a.$className&&a.isFixedPositioned()},isChildOfFooter:function(){var a=this.getParentSiteSegmentContainer();return a&&"wysiwyg.viewer.components.FooterContainer"===a.$className},getResizableSides:function(){return this._resizableSides},isResizable:function(){return this._resizableSides.length>0},isHorizResizable:function(){return this._resizableSides.contains(Constants.BaseComponent.ResizeSides.RIGHT)||this._resizableSides.contains(Constants.BaseComponent.ResizeSides.LEFT)},isVertResizable:function(){return this._resizableSides.contains(Constants.BaseComponent.ResizeSides.TOP)||this._resizableSides.contains(Constants.BaseComponent.ResizeSides.BOTTOM)},isHorizontallyMovable:function(){return this._moveDirections.contains(Constants.BaseComponent.MoveDirections.HORIZONTAL)},isVerticallyMovable:function(){return this._moveDirections.contains(Constants.BaseComponent.MoveDirections.VERTICAL)},allowHeightLock:function(){return this.isVertResizable()},useLayoutOnDrag:function(){return!1},useLayoutOnResize:function(){return!1},getEditedContent:function(){return null},isContainable:function(){return!0},isAnchorable:function(){return{to:{allow:!0,lock:Constants.BaseComponent.AnchorLock.BY_THRESHOLD},from:{allow:!0,lock:Constants.BaseComponent.AnchorLock.BY_THRESHOLD}}},isSelectable:function(){return!0},isContainer:function(){return!1},isDeleteable:function(){return!0},isDuplicatable:function(){return!0},isDeleteableRecurse:function(){if(!this.isDeleteable())return!1;for(var a=this.getViewNode().getElements("[comp]"),b=0;b<a.length;b++)if(a[b].$logic&&!a[b].$logic.isDeleteable())return!1;return!0},isMultiSelectable:function(){return!0},_createClickOverlay:function(){if(W.Config.env.$isPublicViewerFrame||this._debugMode)return this._socialOverlayElement&&this._socialOverlayElement.clear(),void 0;if(!this._socialOverlayElement){var a={};this._socialOverlayElement=new Element("A",a);var b=W.Config.getServiceTopologyProperty("staticThemeUrlWeb")+"/transparent.gif";this._socialOverlayElement.setStyles({position:"absolute",top:"0",left:"0",height:"100%",width:"100%",background:"transparent url("+b+") repeat top left;"}),this._socialOverlayElement.addEvent("click",function(a){a.stopPropagation();var b={component:this};this.injects().Commands.executeCommand("socialWidget.interact",b,this)}.bind(this)),this.getViewNode().adopt(this._socialOverlayElement)}},_getEditBoxReferenceNode:function(){return this._view},getShowOnAllPagesChangeability:function(){return this._showOnAllPagesChangeability},setShowOnAllPagesChangeability:function(a){this._showOnAllPagesChangeability=a},isSiteSegment:function(){return this.isInstanceOfClass("wysiwyg.viewer.components.SiteSegmentContainer")},_addToolTipToSkinPart:function(a,b){a&&a.getViewNode&&(a=a.getViewNode()),a.addEvent("mouseenter",function(){W.Commands.executeCommand("Tooltip.ShowTip",{id:b},a)}.bind(this)),a.addEvent("mouseleave",function(){W.Commands.executeCommand("Tooltip.CloseTip")}.bind(this))},wixifySetSkin:function(a){if(!this._skin){this._skin=a;var b=this.getSizeLimits(),c=this._originalSizeLimits;b.minW=this._skin.minW||c.minW,b.minH=this._skin.minH||c.minH,b.maxW=this._skin.maxW||c.maxW,b.maxH=this._skin.maxH||c.maxH,this._updateViewAttributes(),this._skin.register(this._view,this._setSkinPartElements,this._skinParamsChange,this)}},wixifySetStyle:function(a,b){this._style=a,b&&this._style.addEvent("skinChange",this._replaceSkinAsync),this._onStyleReady()},canMoveToOtherScope:function(){return!0},getScale:function(){return this._$scale},setScale:function(a){this._$scale=parseFloat(a)},normalizeScaleIfNeeded:function(a){return a},disableReportLayoutChange:function(){},enableReportLayoutChange:function(){},canBeDraggedIntoContainer:function(){return!0}})}),define.Class("core.managers.components.BaseDomBuilder",function(a){"use strict";var b=a;b.methods({initialize:function(a){this._idPrefix=a},_getDomId_:function(a){return this._idPrefix?this._idPrefix+a:a},_getNodeCompId_:function(a){var b=a.getAttribute("id");return this._idPrefix?b.replace(this._idPrefix,""):b},_createViewNodeBase:function(a,b,c,d){var e=new Element("div");return e.setAttribute("id",this._getDomId_(a)),e.setAttribute("skin",c),e.setAttribute("comp",b),this._idPrefix&&e.setAttribute("idprefix",this._idPrefix),e.$domLevel=d||0,e}})}),define.Class("core.managers.components.ComponentBuilder",function(a){var b=a;b.resources(["W.Utils"]),b.methods({initialize:function(a){this.data={},this.data.children=[],this.withNode(a)},_with:function(a,b){return this.data[a]=b,void 0===b&&delete this.data[a],this},withType:function(a){return this._with("type",a)._with("comp",a)},withData:function(a){var b="string"==typeof a?"dataQuery":"dataObject",c="string"!=typeof a?"dataQuery":"dataObject";return this._with(b,a)._with(c,void 0)},withChild:function(a){return this.data.children.push(a),this._appendChild(a),this},_appendChild:function(a){this.data.node.appendChild(a.data.node)},withNode:function(a){return this._with("node",this._createNodeWithUidSoMooToolsWouldNotStackEventsOnAllNodes(a)),0!==this.data.children.length&&this.data.children.forEach(function(a){this._appendChild(a)}.bind(this)),this},_createNodeWithUidSoMooToolsWouldNotStackEventsOnAllNodes:function(a){if(a||(a=W.Preview&&W.Preview.getPreviewSite?W.Preview.getPreviewSite().document.createElement("div"):document.createElement("div")),!a.uid){var b="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0,c="x"==a?b:3&b|8;return c.toString(16)});a.uid=b}return a},withUid:function(a){return this._with("uid",a)},withSkin:function(a){return this._with("skin",a)},withParentLogic:function(a){return this._with("parentLogic",a)},withSkinParamMapper:function(a){return this._with("skinParamMapper",a)},withIdPrefix:function(a){return this._with("idPrefix",a)},withArgs:function(a){return this._with("args",a)},onSkinRequest:function(a){return this.skinProvider=a,this},onCreated:function(a){return this.onCreatedCallback=a,this},onWixified:function(a){return this.onWixifiedCallback=a,this},create:function(){this._validate()&&this._setCreatedEvent()._wixifyNodeWithChildren()},_wixifyNodeWithChildren:function(){var a=this.data.children.filter(function(a){return!a._isWixified()}),b=a.map(function(a){return a.data.node}),c=this;0!==a.length?(this.resources.W.Utils.waitForAnEventOnObjects(b,Constants.ComponentEvents.WIXIFIED,function(a){a&&c._wixifyNode()}),a.each(function(a){a.onError(c.onErrorCallback).create()})):this._wixifyNode()},onError:function(a){return this.onErrorCallback=a,this},_wixifyNode:function(){this._setNodeAttribute("comp")._setNodeAttribute("skin")._setNodeAttribute("dataQuery")._setNodeAttribute("propertyQuery")._setNodeAttribute("styleId")._setNodeAttribute("paddingBottom")._setNodeAttribute("minHeight")._setNodeAttribute("idPrefix"),this._setNodeLayout()._setNodeIds(),this.data.node.wixify(this.data.args,this.data.dataObject,this.data.idPrefix,void 0,this.data.skinParamMapper,this.data.parentLogic)},_clearPrefixFromId:function(a,b){return b&&a&&0!==a.indexOf(b)?b+a:a},_setNodeIds:function(){return this.data.node.uid=this.data.uid||this.data.node.uid,this.data.node.id=this._clearPrefixFromId(this.data.htmlId||this.data.node.id,this.data.idPrefix),this},_setNodeLayout:function(){return this.data.layout?(this.data.node.setAttribute("x",this.data.layout.x),this.data.node.setAttribute("y",this.data.layout.y),this.data.node.setAttribute("width",this.data.layout.width),this.data.node.setAttribute("height",this.data.layout.height),this.data.node.setAttribute("angle",this.data.layout.rotationInDegrees||0),this.data.layout.fixedPosition===!0&&this.data.node.setAttribute("pos","fixed"),this):this},_setNodeAttribute:function(a){return this.data[a]&&this.data.node.setAttribute(a,this.data[a]),this},_setCreatedEvent:function(){if("function"==typeof this.onCreatedCallback){var a=this.onCreatedCallback;this.data.node.addEvent(Constants.ComponentEvents.READY,function(){a(this.$logic,this)})}if("function"==typeof this.onWixifiedCallback){var b=this.onWixifiedCallback;this.data.node.addEvent(Constants.ComponentEvents.WIXIFIED,function(){b(this.$logic,this)})}return this},_validate:function(){return this._validateType()&&this._validateSkin()&&this._validateNotWixified()},_validateType:function(){return this.data.type?!0:(this._callErrorHandler("you must set type before creating a component!"),!1)},_validateSkin:function(){return this.data.skin?!0:"function"==typeof this.skinProvider?this._validateSkinWithProvider():(this._callErrorHandler("you must set skin or set a skin-provider before creating a component!"),!1)},_validateSkinWithProvider:function(){var a=this.skinProvider();return a?(this.withSkin(a),!0):(this._callErrorHandler("skin-provider did not supply any skin"),!1)},_isWixified:function(){return!!this.data.node.$logic},_validateNotWixified:function(){return this._isWixified()?(this._callErrorHandler("you cannot create component on a wixified element"),!1):!0},_callErrorHandler:function(a){if("function"!=typeof this.onErrorCallback)throw a;this.onErrorCallback(a)}})}),define.bootstrapClass("core.managers.component.ComponentDefinition",function(){function a(){b.apply(this,arguments),this.$constructor=a,this._skinParts_=void 0,this._dataTypes_=void 0,this._states_=void 0,this._propertiesSchemaType_=void 0}var b=this.define.getBootstrapClass("bootstrap.managers.classmanager.ClassDefinition");return a.prototype=Object.create(b.prototype),a.extendPrototype({skinParts:function(a){this._skinParts_=a},dataTypes:function(a){this._dataTypes_=a},states:function(a){this._states_=a},styles:function(a){this._styles_=a},panel:function(a){this._panel_=a},helpIds:function(a){this._helpIds_=a},toolTips:function(a){this._toolTips_=a},propertiesSchemaType:function(a){this._propertiesSchemaType_=a}}),a}),define.Class("core.managers.components.ComponentDomBuilder",function(a){var b=a;b.inherits("core.managers.components.BaseDomBuilder"),b.resources(["W.Config"]),b.methods({initialize:function(a){this.parent(a)},createComponent:function(a,b,c){b=b||"components";var d=this._createViewNodeBase(a.id,a.componentType,this._getSkin(a),c);this._setDataAttributes(d,a),this._setLayoutAttributes(d,a),this._setAdditionalAttributes(d,a);var e=this._createChildComponents(d,a,b);return e.push(d),{rootCompNode:d,compNodes:e}},_setAdditionalAttributes:function(a,b){b.styleId&&a.setAttribute("styleId",b.styleId),b.behaviors&&(a.$behaviors=b.behaviors),a.$isContainerOrPage="Container"===b.type||"Page"===b.type},_createChildComponents:function(a,b,c){var d=[],e=b[c]||[];return _.forEach(e,function(b){var c=this.createComponent(b,null,a.$domLevel+1);a.appendChild(c.rootCompNode),d=d.concat(c.compNodes)},this),d},_getSkin:function(a){return"wysiwyg.viewer.components.PagesContainer"===a.componentType?"wysiwyg.viewer.skins.screenwidthcontainer.BlankScreen":a.skin},_setDataAttributes:function(a,b){b.dataQuery&&a.setAttribute("dataQuery",0!==b.dataQuery.indexOf("#")?"#"+b.dataQuery:b.dataQuery),b.propertyQuery&&a.setAttribute("propertyQuery",0!==b.propertyQuery.indexOf("#")?"#"+b.propertyQuery:b.propertyQuery)},_setLayoutAttributes:function(a,b){b.layout&&(a.setAttribute("width",b.layout.width),b.layout.height&&(a.setAttribute("height",b.layout.height),a.setAttribute("x",b.layout.x),a.setAttribute("y",b.layout.y),a.setAttribute("scale",b.layout.scale||1),a.setAttribute("angle",b.layout.rotationInDegrees||0)),b.layout.fixedPosition===!0&&a.setAttribute("pos","fixed"),b.layout.staticPosition===!0&&a.setAttribute("pos","static"))}})}),define.Class("core.managers.component.ComponentManager",function(a){var b=a;
b.utilize(["bootstrap.utils.Queue","mobile.core.components.base.BaseComponent","core.managers.component.BaseCompSchemaGenerator"]),b.resources(["W.Classes","W.Experiments"]),b.inherits("bootstrap.managers.BaseManager"),b.binds(["_onClassReady","getComponent"]),b.methods({initialize:function(){this._componentQue=new this.imports.Queue,this._componentMap={},this._componentDefinitions={},this._pendingComponentClassMap={},this.resource.getResources(["W.Classes","W.Experiments"],function(a){this._experimentManager=a.W.Experiments,this._classManager=a.W.Classes,this._classManager.addClassNamespaceHook(this.getComponent),this._classManager.addClassReadyHandler(this._onClassReady)}.bind(this)),this._componentMap["mobile.core.components.base.BaseComponent"]=this.imports.BaseComponent,this.define.component.definitionModifier=this._onCompDefineCallBack.bind(this),this.COMPONENT_INFORMATION_MAP={},this._definitionModifierFunc=null},getComponentInformation:function(a){return this.COMPONENT_INFORMATION_MAP[a]},getComponentsInformation:function(){return this.COMPONENT_INFORMATION_MAP},setComponentInformation:function(a,b){this.getComponentInformation(a)||(this.COMPONENT_INFORMATION_MAP[a]=b)},setComponentDefinitionModifier:function(a){this._definitionModifierFunc=a},_onCompDefineCallBack:function(a,b){var c=this._componentQue.getQueue(a);return c&&c.length>0&&this.registerNewComponent(a,b),b},registerNewComponent:function(a,b){var c=this.getComponentDefinitionObject(a,b);this._validateNewComponent(a,c),this._pendingComponentClassMap[a]="pending",this._componentDefinitions[a]=c,this._classManager.registerClassDefinition(a,c),c._panel_&&this.addComponentToInfoMap(a,c)},getComponentDefinitionObject:function(a,b){var c=this._createDefinitionInstance(b);return this._experimentManager.applyExperiments(a,c,"ExperimentComponentPlugin"),this._definitionModifierFunc&&this._definitionModifierFunc(a,c),this._organizeCompDefinition(a,c),c},_createDefinitionInstance:function(a){var b=this.define.getBootstrapClass("core.managers.component.ComponentDefinition"),c=new b;return a(c,c._inheritStrategy_),c},_organizeCompDefinition:function(a,b){var c=b._imports_||[];this._organizeSkinPartsDef(b,c),b.utilize(c),b._statics_=b._statics_||{},b._statics_._propertiesSchemaType_=b._propertiesSchemaType_,b._dataTypes_&&(b._statics_._dataTypes_=b._dataTypes_),b._states_&&(b._statics_._states_=b._states_),b._panel_&&(b._statics_._panel_=b._panel_),b._styles_&&(b._statics_._styles_=b._styles_),b._helpIds_&&(b._statics_._helpIds_=b._helpIds_),b._toolTips_&&(b._statics_._toolTips_=b._toolTips_);var d=b._methods_.onComponentReady;d&&this._componentQue.add(a,d)},_organizeSkinPartsDef:function(a,b){if(a._skinParts_){var c=a._skinParts_||{};_(c).forEach(function(c){if(c){_(c).keys().forEach(function(b){this._replaceFunctionsByIdRecursive(c,b,a)},this);var d=c.type;if(d&&d!=Constants.ComponentPartTypes.HTML_ELEMENT&&b.indexOf(d)<0){var e=this.getNameOverride(d);b.push(e)}}},this),a._statics_=a._statics_||{},a._statics_._skinPartsSchema=c}},_replaceFunctionsByIdRecursive:function(a,b,c){var d=a[b];"object"==typeof d?_(d).forEach(function(a,b){this._replaceFunctionsByIdRecursive(d,b,c)},this):"function"==typeof d&&this._replaceFunctionById(a,b,c)},_replaceFunctionById:function(a,b,c){var d=a[b],e="#"+W.Utils.getPrefixedUniqueId("fnc");c._statics_||(c._statics_={}),c._statics_._bindMethodsMap_||(c._statics_._bindMethodsMap_={}),c._statics_._bindMethodsMap_[e]=d,a[b]=e},_validateNewComponent:function(a){return this._componentMap[a]?(LOG.reportError(wixErrors.CM_NAME_ALREADY_EXIST,this.className,"newComponent",a)(),void 0):void 0},addComponentToInfoMap:function(a,b){if(!b){var c=define.getDefinition("component"),d=nsUtil.getNameSpace(c,a);b=this.getComponentDefinitionObject(a,d)}var e=this._generateComponentBasicInfo(a,b);this.setComponentInformation(a,e)},_generateComponentBasicInfo:function(a,b){var c={},d=a.substring(a.lastIndexOf(".")+1);return this._setComponentSkinsInfo(d,c),c.styles=this._getStyleIdArray(d,b._styles_),c.data=this._getDataType(b),c.helpIds=b._helpIds_,c.toolTips=b._toolTips_,c.type="map",W.Data.createDataItem(c)},_setComponentSkinsInfo:function(a,b){this.resource.getResourceValue(a.toLowerCase()+"SkinMap",function(a){var c=function(a){return!a.hidden},d=function(a){return!a.experimentInclude||this.resources.W.Experiments.isDeployed(a.experimentInclude)}.bind(this),e=_.pick(a,c);b.skins=_.pick(e,d)}.bind(this),function(){throw new Error(a+" skin map is missing. Try running grunt")})},_getDataType:function(a){var b=a._dataTypes_;return b&&{type:b[0]}},_getStyleIdArray:function(a,b){var c=[];if("array"!==typeOf(b)){for(var d=0;b>d;d++)c[d]=a+"_"+(d+1);return c}},getComponent:function(a,b){if(a=this.getNameOverride(a),this._componentMap[a])return b&&b(this._componentMap[a]),this._componentMap[a];var c=this.define.getDefinition("component"),d=nsUtil.getNameSpace(c,a),e=this._componentQue.hasQueue(a)===!1;return this._componentQue.add(a,b),e&&(d?this.registerNewComponent(a,d):this._classManager.getClass(a,function(){})),this._componentMap[a]||null},getNameOverride:function(a){return this.define.Class.$nameOverrides[a]||a},_onClassReady:function(a,b){return this._pendingComponentClassMap[a]?(this._onComponentClassReady(b,a),void 0):(this._componentQue.removeKey(a),void 0)},_onComponentClassReady:function(a,b){this._componentMap[b]=a;var c=this._componentDefinitions[b];this.imports.BaseCompSchemaGenerator.generateComponentSchema(a,c);var d=this._componentQue.getQueue(b);d.forEach(function(a){a&&a(this._componentMap[b])}.bind(this)),this._componentQue.removeKey(b)},createComponent:function(a,b,c,d,e,f,g,h,i,j){if(a&&"object"==typeOf(a)){var k=a;a=k.type,b=k.skin||b,c=k.data||c,d=k.args||d,e=k.wixifyCallback||e,f=k.componentReadyCallback||f,g=k.domIdPrefix||g,h=k.compNode||h,j=k.innerStyle||k.skinParamMapper}if(!a||"string"!=typeOf(a))return LOG.reportError(wixErrors.CM_LOGIC_TYPE,this.className,"createComponent","created from:"+this.className),new Element("span");var l={comp:a,skin:b};if(c){var m=typeof c;"string"==m?(l.dataQuery=c,c=null):"object"==m&&(c._dataType||LOG.reportError(wixErrors.WIXIFY_MISSING_DATA_TYPE,this.className,"createComponent","created from:"+this.className))}return h?h.setProperties(l):h=new Element("div",l),e&&"function"==typeof e&&h.addEvent("wixified",function(){e(h.getLogic())}),f&&"function"==typeof f&&h.addEvent(Constants.ComponentEvents.READY,function n(){h.removeEvent(Constants.ComponentEvents.READY,n),f(h.getLogic())}),c&&c._dataType?h.wixify(d,c,g,i,j):h.wixify(d,null,g,i,j),h},isReady:function(){return!0}})}),define.experimentPlugin("ExperimentComponentPlugin",function(a){function b(a,b){var c=this.define.createBootstrapClassInstance("bootstrap.managers.experiments.ExperimentStrategy"),e=this.define.createBootstrapClassInstance("core.managers.component.ComponentDefinition"),f=a;return"function"==typeof a&&(f=new d,a(f)),b(e,c),f.inherits(e._extends_||f._extends_),f.resources(c._mergeField_(f._resources_,e._resources_)),f.binds(c._mergeField_(f._binds_,e._binds_)),f.traits(c._mergeField_(f._traits_,e._traits_)),f.utilize(c._mergeField_(f._imports_,e._imports_)),f.statics(c._mergeObjects_(f._statics_,e._statics_)),f.fields(c._mergeObjects_(f._fields_,e._fields_)),f.methods(c._mergeObjects_(f._methods_,e._methods_)),f.skinParts(c._mergeField_(f._skinParts_,e._skinParts_)),f.states(c._mergeField_(f._states_,e._states_)),f.dataTypes(c._mergeField_(f._dataTypes_,e._dataTypes_)),f.propertiesSchemaType(e._propertiesSchemaType_||f._propertiesSchemaType_),f.panel(e._panel_||f._panel_),f.styles(e._styles_||f._styles_),f.helpIds(e._helpIds_||f._helpIds_),f.toolTips(e._toolTips_||f._toolTips_),f}function c(a,b){define.component(a,b)}var d,e=a;e.init("component","newComponent",b,c)}),define.Const("components",{DEFAULT_PREFIX:"c",BASE_LIST_ITEM_PREFIX:"bli"}),define.Class("core.managers.componentlifecyclemanager.ComponentInfo",function(a){var b=a;b.statics({STATES:{INITIATED:"initiated",MEASURED:"measured",READY:"ready",ERROR:"error_in_comp",PAUSED:"paused"}}),b.fields({component:null,state:"",isDisplayed:!1,isDisplayedBefore:!1,error:null,parentComp:null,forceSingleMeasure:!1}),b.methods({initialize:function(a){this.component=a,this.state=this.STATES.INITIATED,this.childComps={}}})}),define.Class("core.managers.componentlifecyclemanager.ComponentLifecycleManager",function(a){var b=a;b.inherits("bootstrap.managers.BaseManager"),b.utilize(["core.managers.componentlifecyclemanager.ReflowTimer","core.managers.componentlifecyclemanager.ComponentMeasurer","core.managers.componentlifecyclemanager.ComponentRenderer","core.managers.componentlifecyclemanager.ComponentInfo"]),b.binds(["_beforeReflow","_afterReflow","_onComponentSkinChange"]),b.statics({PHASES:{MEASURE_INITIATED:"measureInitiatedComps",MEASURE:"measure",COLLECT_RENDER_COMPS:"collectCompsForRender",RENDER:"render"},EVENTS:{BEFORE_RENDER:"beforeRender",COMPONENTS_RENDERED:"componentsRendered",AFTER_LAYOUT_UPDATE:"afterLayout"}}),b.methods({initialize:function(){this._registeredComponents={};var a=this.imports.ReflowTimer;this._reflowTimer=new a,this._reflowTimer.on(a.REFLOW_EVENTS.BEFORE_REFLOW,this,this._beforeReflow),this._reflowTimer.on(a.REFLOW_EVENTS.AFTER_REFLOW,this,this._afterReflow),this._reflowTimer.on(a.REFLOW_EVENTS.IDLE,this,this._onIdle),this._forceReflowsXMoreTimes=0,this._compMeasurer=new this.imports.ComponentMeasurer(this),this._compRenderer=new this.imports.ComponentRenderer(this),this.ComponentInfo=this.imports.ComponentInfo,this.run()},run:function(){this._reflowTimer.run()},pause:function(){this._reflowTimer.stop()},forceRender:function(a){a||0===a||(a=5),this._forceReflowsXMoreTimes=Math.max(a-1,this._forceReflowsXMoreTimes),this._reflowTimer.forceReflow()},_beforeReflow:function(){this._compRenderer.updateLayoutForDisplayedComps(),this._compRenderer.renderComponents(),this.fireEvent(this.EVENTS.COMPONENTS_RENDERED)},_afterReflow:function(){this._compMeasurer.invalidateDisplayAndMeasureAllDisplayedComponents()},_onIdle:function(){this._forceReflowsXMoreTimes>0&&(this._forceReflowsXMoreTimes--,this.forceRender(this._forceReflowsXMoreTimes))},registerComponent:function(a,b){var c=a.getComponentUniqueId();if(this._registeredComponents[c]&&!a.IS_DEAD)return LOG.reportError(wixErrors.COMPONENT_ALREADY_REGISTERED_IN_LIFECYCLE,"ComponentLifecycleManager","registerComponent",c),void 0;var d=new this.ComponentInfo(a);return this._registeredComponents[c]=d,a.on(a.INVALIDATIONS.SKIN_CHANGE,this,this._onComponentSkinChange),a.on(Constants.EventDispatcher.Events.EXTERMINATING,this,this._componentExterminated),b&&this._renderImmediate(d),this.forceRender(),d},_onComponentSkinChange:function(a){var b=this.getComponentInfo(a.target);b.state=b.STATES.INITIATED},_renderImmediate:function(){},getComponentInfo:function(a,b){var c=a.getComponentUniqueId();return this._registeredComponents[c]?this._registeredComponents[c]:(!b&&LOG.reportError(wixErrors.COMPONENT_NOT_REGISTERED_IN_LIFECYCLE,"ComponentLifecycleManager",c),null)},getAllComponentsInfo:function(){return this._registeredComponents},setParentComponentProcess:function(a,b){var c=a.getComponentUniqueId(),d=this.getComponentInfo(a,!0),e=this.getComponentInfo(b,!0);e&&d&&(this.removeChildComponentProcess(a),e.childComps[c]=d,d.parentComp=e)},removeChildComponentProcess:function(a){var b=this.getComponentInfo(a,!0),c=b&&b.parentComp;if(c){var d=a.getComponentUniqueId();delete c.childComps[d],b.parentComp=null}},getComponentChildList:function(a,b,c){c=c||[];var d=a.childComps;for(var e in d){var f=d[e];f&&(b&&this.getComponentChildList(f,!0,c),c.push(f))}return c},_onComponentError:function(a,b,c){a.component;a.state=a.STATES.ERROR,a.error=b,this._errorHandler&&this._errorHandler(a,b,c)},_componentExterminated:function(a){var b=a.target,c=b.getComponentUniqueId(),d=this._registeredComponents[c];d&&(this.removeChildComponentProcess(d.component),delete this._registeredComponents[c])},setComponentErrorHandler:function(a){this._errorHandler=a},clone:function(a){return this._reflowTimer.stop(),this.parent(a)},"@testRenderNow":function(a){if(!a)throw'specified null for required arg "component"';var b=this.getComponentInfo(a);if(!b)throw"component isn't registered to lifecycle";b.state===b.STATES.INITIATED&&(b.state=b.STATES.MEASURED),this._compRenderer.runRender([a])},isRemovingFromObjectsMapOnlyUponDeath:function(){return!0}})}),define.Class("core.managers.componentlifecyclemanager.ComponentMeasurer",function(a){var b=a;b.methods({initialize:function(a){this._compLC=a,window.HTMLElement||(this._getNodeForMeasure=this._ie8_getNodeForMeasure)},invalidateDisplayAndMeasureAllDisplayedComponents:function(){this._markAllCompsAsNotDisplayed(),this._runMeasureForFirstTimeInitiatedComps();var a=this._getDisplayedCompList(document.body);this.measureComponents(a.reverse()),this._invalidateAllDisplayModifiedComps()},measureComponents:function(a){var b,c,d;if(a.length)try{for(b=0;b<a.length;++b)c=a[b],d=this._compLC.getComponentInfo(c),d.isDisplayed=!0,this._measureComponent(d)}catch(e){a.splice(0,b+1),this._compLC._onComponentError(d,e,this._compLC.PHASES.MEASURE),a.length>0&&this.measureComponents(a)}},_measureComponent:function(a){var b=a.component;if(b._skinParts){a.state!=a.STATES.MEASURED&&(b._invalidations_.clearInvalidationType(b.INVALIDATIONS.SIZE),b._invalidations_.clearInvalidationType(b.INVALIDATIONS.POSITION));for(var c in b._skinParts){var d=this._getNodeForMeasure(b._skinParts[c]);if(d&&d.parentNode){var e=this._getOldMeasure(d),f=this._getNewMeasure(d);d.$measure=f,this._invalidateSizeIfChanged(b,c,d,f,e),this._invalidatePositionIfChanged(b,c,d,f,e)}}b.isInvalidated([b.INVALIDATIONS.SIZE])&&b.reportLayoutChange()}b.trigger(Constants.LifecycleSteps.MEASURE)},_getNodeForMeasure:function(a){return a instanceof HTMLElement?a:a.getViewNode instanceof Function?a.getViewNode():null},_ie8_getNodeForMeasure:function(a){return a.nodeType?a:a.getViewNode instanceof Function?a.getViewNode():null},_getOldMeasure:function(a){return a.$measure||{width:0,height:0,top:0,left:0}},_getNewMeasure:function(a){var b=a.getSize(),c=a.getPosition(a.parentNode);return{width:b.x,height:b.y,top:c.y,left:c.x}},_invalidateSizeIfChanged:function(a,b,c,d,e){if(d.width!==e.width||d.height!==e.height){var f="view"===b?a.INVALIDATIONS.SIZE:a.INVALIDATIONS.PART_SIZE;a.invalidate(f,{current:d,old:e,partName:b,reference:c},!0),f===a.INVALIDATIONS.SIZE&&(a.getWidth()<d.width||a.getHeight()<d.height)&&a.invalidate(a.INVALIDATIONS.MEASURED_SIZE_DIFFERS_FROM_REQUESTED,{measured:d})}},_invalidatePositionIfChanged:function(a,b,c,d,e){if(d.top!==e.top||d.left!==e.left){var f="view"===b?a.INVALIDATIONS.POSITION:a.INVALIDATIONS.PART_POSITION;a.invalidate(f,{current:d,old:e,partName:b,reference:c},!0)}},_markAllCompsAsNotDisplayed:function(){var a=this._compLC.getAllComponentsInfo();for(var b in a){var c=a[b];c.isDisplayedBefore=c.isDisplayed,c.isDisplayed=!1}},_runMeasureForFirstTimeInitiatedComps:function(){var a=this._compLC.getAllComponentsInfo();for(var b in a){var c=a[b];if(c.state===c.STATES.INITIATED)try{c.state=c.STATES.MEASURED,this._measureComponent(c)}catch(d){this._compLC._onComponentError(c,d,this._compLC.PHASES.MEASURE_INITIATED),this._runMeasureForFirstTimeInitiatedComps()}}},_invalidateAllDisplayModifiedComps:function(){var a=this._compLC.getAllComponentsInfo();for(var b in a){var c=a[b];if(c.isDisplayedBefore!==c.isDisplayed){var d=c.component;d.invalidate(d.INVALIDATIONS.DISPLAY,{current:c.isDisplayed})}}},_getDisplayedCompList:function(a,b){b=b||[];var c=this._isNodeDisplayed(a);if(c)for(var d=a.childNodes,e=0;e<d.length;++e)this._getDisplayedCompList(d[e],b);if(c&&a.$logic){var f=a.$logic,g=f.getComponentUniqueId(),h=this._compLC.getAllComponentsInfo(),i=h[g];i&&b.push(f)}return b},_isNodeDisplayed:function(a){return a.style?a.style.display?"none"!==a.style.display.toLowerCase():a.className&&"function"==typeof a.className.indexOf&&-1!==a.className.indexOf("hidden")?!1:a._displayed_?!!a._displayed_:-1!==navigator.appVersion.indexOf("MSIE 8.0")&&a.getComputedStyle?"svg"===a.nodeName.toLowerCase()?"none"!==window.getComputedStyle(a).display.toLowerCase():"none"!==a.getComputedStyle("display").toLowerCase():a.currentStyle?"none"!==a.currentStyle.display.toLowerCase():!0:!1}})}),define.Class("core.managers.componentlifecyclemanager.ComponentRenderer",function(a){var b=a;b.methods({initialize:function(a){this._compLC=a},renderComponents:function(){this._collectCompListForRender(),this.runRender(this._compsForRender)},runRender:function(a){var b,c,d;if(a.length)try{for(b=0;b<a.length;++b)c=a[b],d=this._compLC.getComponentInfo(c),this._renderComponent(d)}catch(e){a.splice(0,b+1),this._compLC._onComponentError(d,e,this._compLC.PHASES.RENDER),a.length>0&&this.runRender(a)}},_renderComponent:function(a){var b=a.component,c={invalidations:b._invalidations_};b._invalidations_=new b.imports.InvalidationCollector,b.trigger(Constants.LifecycleSteps.RENDER,c),a.state===a.STATES.MEASURED&&(a.state=a.STATES.READY,b.trigger(Constants.LifecycleSteps.FIRST_RENDER,c))},updateLayoutForDisplayedComps:function(){var a=this._compLC.getAllComponentsInfo();for(var b in a){var c=a[b];c.isDisplayed&&this._updateCompLayout(c.component)}},_updateCompLayout:function(a){var b=this._getComponentResizeData(a);if(b)for(var c in b){var d=b[c];switch(c){case"width":a._setWidth_(d);break;case"height":a._setHeight_(d);break;case"x":a._setX_(d);break;case"y":a._setY_(d)}}},_getComponentResizeData:function(a){return this._getLayoutChangeData({width:a.getLastInvalidationByType(a.INVALIDATIONS.WIDTH_REQUEST),height:a.getLastInvalidationByType(a.INVALIDATIONS.HEIGHT_REQUEST),x:a.getLastInvalidationByType(a.INVALIDATIONS.X_REQUEST),y:a.getLastInvalidationByType(a.INVALIDATIONS.Y_REQUEST)})},_getLayoutChangeData:function(a){var b;for(var c in a){var d=a[c];d&&!d._used_&&(d._used_=!0,b=b||{},b[c]=d[c])}return b},_collectCompListForRender:function(a){var b,c=a?a.compList:[],d=a?a.checkedCompIds:{},e=function(a){b=a;var e=a.component,f=e.getComponentUniqueId();d[f]=!0,this._isComponentReadyForRender(b)&&c.push(e)}.bind(this);try{var f=this._compLC.getAllComponentsInfo();for(var g in f)if(!d[g]){var h=f[g],i=this._compLC.getComponentChildList(h,!0);i.forEach(e),e(h)}}catch(j){this._compLC._onComponentError(b,j,this.PHASES.COLLECT_RENDER_COMPS),this._collectCompListForRender({compList:c,checkedCompIds:d})}this._compsForRender=c},_isComponentReadyForRender:function(a){var b=a.component;return a.isDisplayed&&(a.state===a.STATES.MEASURED||a.state===a.STATES.READY&&b.isRenderNeeded(b._invalidations_))}})}),define.Class("core.managers.componentlifecyclemanager.ReflowTimer",function(a){var b=a;b.inherits("bootstrap.managers.events.EventDispatcherBase"),b.resources(["W.Utils"]),b.binds(["_beforeReflow","_onIdleDone"]),b.statics({REFLOW_EVENTS:{IDLE:"idle",BEFORE_REFLOW:"beforeReflow",AFTER_REFLOW:"afterReflow"}}),b.methods({initialize:function(){this._isRunning=!1,this._isInIdleMode=!1,this._idleFPS=.2},run:function(a){this._isRunning||(this._idleFPS=a||this._idleFPS,this._isRunning=!0,this._listenForNextReflow())},stop:function(){this._isRunning=!1,this._stopListening(),this._removeTestNode()},forceReflow:function(){this._isInIdleMode&&(this._stopListening(),this._isInIdleMode=!1,this._forceReflowTimeoutIndex=this.resources.W.Utils.callLater(this._onIdleDone,[],this,0))},_listenForNextReflow:function(){this._beforeReflowTimoutIndex=this.resources.W.Utils.callOnNextRenderPriority(this._beforeReflow,20),this._beforeReflowTimeoutFallbackIndex=this.resources.W.Utils.callLater(this._beforeReflow,[],this,150)},_listenForAfterReflow:function(){this._isReflowTestNodeValid()?this._afterReflow():this._checkReflowTimoutIndex=this.resources.W.Utils.callLater(this._listenForAfterReflow,[],this,0)},_stopListening:function(){this.resources.W.Utils.clearOnNextRenderPriority(this._beforeReflowTimoutIndex),this.resources.W.Utils.clearCallLater(this._checkReflowTimoutIndex),this.resources.W.Utils.clearCallLater(this._idleTimoutIndex),this.resources.W.Utils.clearCallLater(this._forceReflowTimeoutIndex),this.resources.W.Utils.clearCallLater(this._beforeReflowTimeoutFallbackIndex)},_beforeReflow:function(){this._isRunning&&(this._stopListening(),this.trigger(this.REFLOW_EVENTS.BEFORE_REFLOW),this._updateReflowTestNode(),this._setIdleDelay())},_afterReflow:function(){this._isRunning&&(this.trigger(this.REFLOW_EVENTS.AFTER_REFLOW),this._listenForNextReflow())},_setIdleDelay:function(){var a=1e3/this._idleFPS;this._isInIdleMode=!0,this._idleTimoutIndex=W.Utils.callLater(this._onIdleDone,[],this,a),this.trigger(this.REFLOW_EVENTS.IDLE)},_onIdleDone:function(){this._stopListening(),this._isInIdleMode=!1,this._listenForAfterReflow()},_updateReflowTestNode:function(){this._textNode||(this._reflowTestConNode=this._createElementWithStyle("ReflowTestContainer",{width:"1px",height:"1px",overflow:"hidden"}),this._textNode=this._createElementWithStyle("ReflowTestNode",{width:"1000px",height:"0px"}),this._textNodeInnerDiv=this._createElementWithStyle("ReflowTextInnerNode",{width:"10%"}),this._textNode.appendChild(this._textNodeInnerDiv),this._reflowTestConNode.appendChild(this._textNode),document.body.appendChild(this._reflowTestConNode));var a=parseInt(this._textNode.style.width,10),b=a>=3e3?1e3:a+1e3;this._reflowTextExpectedWidth=.1*b,this._textNode.style.width=b+"px"},_createElementWithStyle:function(a,b){var c=document.createElement("div");return c.setAttribute("id",a),_.forEach(b,function(a,b){c.style[b]=a}),c},_removeTestNode:function(){this._textNode&&(this._textNode.parentNode&&this._textNode.parentNode.removeChild(this._textNode),this._reflowTestConNode.parentNode&&this._reflowTestConNode.parentNode.removeChild(this._reflowTestConNode),delete this._textNode,delete this._reflowTestConNode,delete this._reflowTextExpectedWidth)},_isReflowTestNodeValid:function(){var a=this._textNodeInnerDiv.offsetWidth,b=Math.abs(a-this._reflowTextExpectedWidth);return 5>=b}})}),define.Const("LifecycleSteps",{FIRST_RENDER:"firstRender",RENDER:"render",MEASURE:"measure"}),function(){var a=null;define.Class("core.managers.css.CssManager",function(b){var c=b;c.resources(["W.Resources","W.Data","W.Utils","W.Commands","W.Config","scriptLoader","topology","W.Experiments"]),c.inherits("bootstrap.managers.BaseManager"),c.binds(["_onThemePropertyChange","updateAllThemeCss"]),c.statics({GLOBAL_THEME_CSS_TYPES:["font","color"],FONT_SERVICE_URL:"//fonts.googleapis.com/css?family="}),c.fields({possibleCharacterSets:["latin-ext","cyrillic","japanese","korean","arabic","hebrew","latin"]}),c.methods({initialize:function(){this.fontsCssBaseUrl=this.resources.topology.wysiwyg+"/css/wysiwyg/user-site-fonts/",this._initCharacterSets(),this._initFontsList(),this._themeStyleSheet=this._generateThemeStylesSheet(),this._addWixSiteOnlyFonts(),this._addLegacyFonts(),this._configureCustomFonts(),this.resource.getResourceValue("W.Theme",function(a){this._themeManager=a,a.addEvent("propertyChange",this._onThemePropertyChange),a.isDataReady()?this.updateAllThemeCss():a.addEvent("dataReady",this.updateAllThemeCss)}.bind(this)),this.reportFontsComPageViewIfApplicable()},_addWixStoredFontsCss:function(){var a,b=this.getWixStoredFontsCssUrls();for(a=0;a<b.length;a++)this._addFontsLoaderCssTag(b[a])},getWixStoredFontsCssUrls:function(){var a=[],b=this.getCharacterSets();if(b)for(var c=this.fontsCssBaseUrl,d=0;d<b.length;d++)a.push(c+b[d]+".css");return a},_removeStyleSheets:function(a){for(var b=new RegExp(a.join("|"),"i"),c=document.styleSheets,d=0;d<c.length;d++){var e=c[d];if(e.href&&b.test(e.href)){var f=e.ownerNode,g=f.parentNode;g.removeChild(f),d--}}},_configureCustomFonts:function(){this._customFontsCssDefinition={},this._customFontsNames=[];var a=this.getFontsData(),b=Object.filter(a,function(a){return"google"==a.provider});for(var c in b)this._customFontsNames.push(c),this._customFontsCssDefinition[c]=c},_initFontsList:function(){this._fontsList={},this._languagesFontsLists={};for(var a=0;a<this.possibleCharacterSets.length;a++)this._languagesFontsLists[this.possibleCharacterSets[a]]=[];this._addFontsByPermissionToFontsList(["all"])},_addFontsByPermissionToFontsList:function(a){for(var b in Constants.FONT_METADATA.fonts){var c=Constants.FONT_METADATA.fonts[b],d=c.characterSets;_.contains(a,c.permissions)&&(c.cssFontFamily=this.getFontFallbacksCss(b),_.forEach(d,function(a){this._languagesFontsLists[a].push(_.clone(c))},this),this._fontsList[b]=c)}this._sortLanguagesFontsLists()},_sortLanguagesFontsLists:function(){_.forOwn(this._languagesFontsLists,function(a,b){this._languagesFontsLists[b]=_.sortBy(a,function(a){return a.displayName})},this)},getLanguagesFontsLists:function(){return _.cloneDeep(this._languagesFontsLists)},getCurrentSelectablefonts:function(){for(var a=[],b=0;b<this.possibleCharacterSets.length;b++){var c=this.possibleCharacterSets[b];_.contains(this._characterSets,c)&&a.push({lang:c,fonts:_.cloneDeep(this._languagesFontsLists[c])})}return a},getUsedFonts:function(){var a=[],b=[],c=this.resources.W.Data.getDataMap(),d=/(<[^>]+"font-family:\s*)([^,;]+)([,;])/g,e=/(<[^>]+class=")([^"]*)(font_[0-9]+)([^"]*)(")/g;_.each(c,function(c){var f,g,h=c.getData();if("StyledText"===h.type||"RichText"===h.type){for(d.lastIndex=0,f=d.exec(h.text);f;)a.push(f[2]),f=d.exec(h.text);e.lastIndex=0,g=e.exec(h.text),g&&b.push(g[3])}}),a=_.unique(a),b=_.unique(b);var f=this._usedFontsCache=_.filter(_.union(a,this.getFontNamesByStyles(b)),function(a){return void 0!==this._fontsList[a]},this);return f},getCachedUsedFontsList:function(){return this._usedFontsCache?this._usedFontsCache:this.getUsedFonts()},reportSiteFontsBiEvent:function(a){var b=this._getUsedFontPerVendor(a),c={c1:a.length,c2:b.google,i1:b.monotype,i2:b.typekit};LOG.reportEvent(wixEvents.FONTS_USED_ON_SITE,c)},_getUsedFontPerVendor:function(a){for(var b={google:0,monotype:0,typekit:0},c=this.getFontsData(),d=0;d<a.length;d++){var e=a[d];switch(c[e].provider){case"google":b.google++;break;case"monotype":b.monotype++;break;case"typekit":b.typekit++}}return b},getFontNamesByStyles:function(a){var b=W.Theme;return _.map(a,function(a){var c=b.getProperty(a);return c?c.getFontFamily().toLowerCase():""})},getFontsData:function(){return this._fontsList},_addQuoteToArrayElementsIfContainSpaces:function(a){for(var b=0;b<a.length;++b)a[b].indexOf(" ")&&(a[b]='"'+a[b]+'"')},_onThemePropertyChange:function(a){var b=this._themeManager.getPropertyType(a.name);this.GLOBAL_THEME_CSS_TYPES.contains(b)&&this._updateThemeGlobalCssByPropertyName(a.name,b)},updateAllThemeCss:function(){for(var a=0;a<this.GLOBAL_THEME_CSS_TYPES.length;++a)for(var b=this.GLOBAL_THEME_CSS_TYPES[a],c=this._themeManager.getPropertiesAccordingToType(b),d=0;d<c.length;++d)this._updateThemeGlobalCssByPropertyName(c[d],b)},_updateThemeGlobalCssByPropertyName:function(a,b){var c=this.getThemeGlobalPropertyCssRules(a,b);if(c.forEach(function(a){this._themeStyleSheet.updateRule(a.selector,a.rules)},this),"font"==b){var d=this._themeManager.getProperty(a).getFontFamily(),e=this.getFontType(d);"custom"==e&&this.loadFont(d)}},getThemeGlobalPropertyCssRules:function(a,b,c){b=b||this._themeManager.getPropertyType(a);var d=this._themeManager.getProperty(a),e=[];switch(b){case"font":var f="."+a,g="";g=c?"font: "+d.getCssValue():d.getCssRule(),e.push({selector:f,rules:g});break;case"color":var h="."+a,i="color:"+d.getHex(!1),j=".back"+a,k="background-color:"+d.getHex(!1);e.push({selector:h,rules:i}),e.push({selector:j,rules:k})}return e},getThemeGlobalPropertyCssDefinition:function(a,b,c){b=b||this._themeManager.getPropertyType(a);var d,e=this._themeManager.getProperty(a),f="";switch(b){case"font":d="."+a,f=c?"font: "+e.getCssValue():e.getCssRule();break;case"color":d="."+a,f="color:"+e.getHex(!1)}return{selector:d,rules:f}},_generateThemeStylesSheet:function(){return a||(a=W.Utils.createStyleSheet("WIX_THEME_STYLES")),this._themeStyleNodeId=a.styleNode.get("id"),a},getCssNodeId:function(){return this._themeStyleNodeId},getDefaultFont:function(){return"Arial"},getFontFallbacksCss:function(a){var b,c,d=Constants.FONT_METADATA.fonts,e=d[a.toLowerCase()],f=e.fontFamily;return e?(b=f,""!==e.fallbacks&&(b+=","+e.fallbacks),b+=","+e.genericFamily):b=a,c=b.split(","),c=_.map(c,function(a){var b=a.replace(/.*[^\w\d\-].*/,'"$&"');return b}),b=c.join(",")},getFontList:function(){return[].concat(this._systemFontsNames,this._customFontsNames).sort()},getFontsListSpriteUrl:function(){return"richtext/fonts.png"},getFontType:function(a){var b=a?this._fontsList[a.toLowerCase()]:!1;return b?"system"==b.provider?"system":"custom":null},_testIfNeedToReloadFontOnPreview:function(a){var b=this.getFontUrl(a);b&&this._previewCssManager._addFontsLoaderCssTag(b)},loadFont:function(a){a=a?a.toLowerCase():null,this._previewCssManager&&this._testIfNeedToReloadFontOnPreview(a),this._readyFonts=this._readyFonts||{},this._loadedFonts=this._loadedFonts||{};var b=-1!=this._customFontsNames.indexOf(a),c=this._readyFonts[a],d=this._loadedFonts[a];!b||c||d||(this._loadedFonts[a]=a,this._fontLoadCallLater||(this._fontLoadCallLater=W.Utils.callLater(this._loadFonts,void 0,this,50)))},_reloadFonts:function(){this._readyFonts=this._readyFonts||{},this._loadedFonts=this._loadedFonts||{};var a=["user-site-fonts"],b=_.size(this._readyFonts)>0;if(b&&a.push("googleapis"),this._removeStyleSheets(a),this._addWixStoredFontsCss(),b){for(var c in this._readyFonts)this._loadedFonts[c]=c;this._loadFonts()}},_loadFonts:function(){delete this._fontLoadCallLater;var a=this._getFontsUrl(this._loadedFonts);for(var b in this._loadedFonts)this._readyFonts[b]=b,delete this._loadedFonts[b];this._addFontsLoaderCssTag(a)},getCharacterSets:function(){return _.clone(this._characterSets)},addCharacterSets:function(a){this._characterSets.indexOf(a)<0&&(this._previewCssManager&&this._previewCssManager.addCharacterSets(a),this._characterSets.push(a),this._updateCharacterSetsDataItem(),this._reloadFonts(),this._fireCharacterSetChangedCommand())},removeCharacterSets:function(a){var b=this._characterSets.indexOf(a);b>-1&&(this._previewCssManager&&this._previewCssManager.removeCharacterSets(a),this._characterSets.splice(b,1),this._updateCharacterSetsDataItem(),this._reloadFonts(),this._fireCharacterSetChangedCommand())},_fireCharacterSetChangedCommand:function(){this.resources.W.Commands.executeCommand("W.CssCommands.CharacterSetChange")},getCustomUsedFontsUrl:function(){return this._readyFonts&&0!==Object.keys(this._readyFonts).length?{missingFontsNames:this._readyFonts,missingFontsUrl:this._getFontsUrl(this._readyFonts)}:null},getFontUrl:function(a){if(this._customFontsNames.indexOf(a)<0)return null;var b={};return b[a]=1,this._getFontsUrl(b)},_getFontsUrl:function(a){var b=this._getFontsQuery(a);return this.FONT_SERVICE_URL+b},getFontsUrl:function(a){return this._getFontsUrl(a)},_getFontsQuery:function(a){var b="",c=this.getFontsData();for(var d in a){var e=c[d];e&&e.cdnName&&(b+=e.cdnName,b+=":n,b,i,bi|")}return""===b?null:(this._characterSets&&(b+="&subset="+this._characterSets.join(",")),b)},_addFontsLoaderCssTag:function(a){if(0===$$('[href="'+a+'"]').length){var b=document.createElement("link");b.rel="stylesheet",b.type="text/css",b.href=a;var c=document.getElementsByTagName("link")[0];if(c)c.parentNode.insertBefore(b,c);else{var d=document.getElementsByTagName("head")[0];d&&d.insertBefore(b,d.childNodes[0])}}},_addWixSiteOnlyFonts:function(){if(window.rendererModel&&"WixSite"===rendererModel.documentType){this._addFontsByPermissionToFontsList(["studio"]);var a=this.getHelveticaCssUrl();a&&this._addFontsLoaderCssTag(a)}},_addLegacyFonts:function(){window.rendererModel&&this._addFontsByPermissionToFontsList(["legacy"])},_initCharacterSets:function(){var a=function(a){this._siteStructureData=a;var b=_.clone(this._siteStructureData.get("characterSets")),c=this.resources.W.Config.getDocumentType(),d=c&&"template"===c.toLowerCase();
b&&b.length>1&&!(d&&_.contains(b,"arabic")&&_.contains(b,"hebrew"))?this._characterSets=b:(this._addLocalizedCharacterSets(d),this._updateCharacterSetsDataItem(),this.resources.W.Commands.registerCommandListenerByName("EditorCommands.SiteLoaded",this,function(){this._siteStructureData.markDataAsDirty()})),this._addWixStoredFontsCss()}.bind(this);this.resources.W.Config.env.$isEditorFrame?resource.getResources(["W.Preview"],function(b){b.W.Preview.getPreviewManagersAsync(function(b){this._previewCssManager=b.Css,b.Data.getDataByQuery("#SITE_STRUCTURE",a)}.bind(this))}.bind(this)):this.resources.W.Data.getDataByQuery("#SITE_STRUCTURE",a)},_addLocalizedCharacterSets:function(a){this._characterSets=["latin"];var b=this._getWixLanguageCharacterSets(),c=this._getBrowserLanguageCharacterSet(),d=this._getLocationCharacterSetsArray(),e=this.resources.W.Config.getUserEmail(),f=e&&_.contains(e.toLowerCase(),"wix.com"),g=b||c||d||[];return a&&!f&&_.forEach(g,function(a){this.addCharacterSets(a)},this),g},_getLocationCharacterSetsArray:function(){var a=[],b=this.resources.W.Utils.getCountryCode();return b&&Constants.COUNTRY_LANGUAGES.countries[b]&&(a=_.clone(Constants.COUNTRY_LANGUAGES.countries[b].characterSets)),a.length>0?a:void 0},_getBrowserLanguageCharacterSet:function(){var a,b=this.resources.W.Utils.getBrowserLanguage();return b&&(b=b.split("-")[0]),_.forOwn(Constants.BROWSER_LANGUAGES.languages,function(c,d){_.contains(c,b)&&(a=[d])},this),a},_getWixLanguageCharacterSets:function(){var a=[],b=this.resources.W.Resources.getLanguageSymbol();switch(b){case"pl":a.push("latin-ext");break;case"ru":a.push("cyrillic");break;case"ja":a.push("japanese");break;case"ko":a.push("korean");break;default:a=void 0}return a},_updateCharacterSetsDataItem:function(){this._siteStructureData.set("characterSets",_.clone(this._characterSets),!1,this,[])},_trackPageWithFontsCom:function(){var a=document.createElement("script");a.type="text/javascript",a.async="true",a.src=("https:"==document.location.protocol?"https:":"http:")+"//fast.fonts.net/t/trackingCode.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(a)},reportFontsComPageViewIfApplicable:function(){!W.Config.env.$isEditorFrame&&this.resources.W.Config.getRendererModelProperty("published")&&this.resources.W.Data.getDataByQuery("#SITE_STRUCTURE",function(a){var b=a.get("usedFonts"),c=_.any(b,function(a){var b=this._fontsList[a];return b?"all"==b.permissions&&"monotype"==b.provider:(LOG.reportError(wixErrors.MISSING_FONT_IN_USE,"CssManager",a,{desc:"font "+a+" is used in site but doesnt exist in fonts list"}),!0)},this);c&&this._trackPageWithFontsCom()}.bind(this))},getHelveticaCssUrl:function(){return window.rendererModel&&"WixSite"===rendererModel.documentType?window.serviceTopology.publicStaticsUrl+"/css/Helvetica/fontFace.css":null},_pushUnique:function(a,b){var c=this._doesArrayExistInArrayOfArrays(a,b);c||a.push(b)},_doesArrayExistInArrayOfArrays:function(a,b){for(var c=0;c<a.length;c++){var d=a[c];if(d.length===b.length)for(var e=0;e<b.length&&d[e]===b[e];e++)if(e===b.length-1)return!0}return!1},clone:function(a){return this.parent(a)},isReady:function(){return!0}})})}(),define.Const("BROWSER_LANGUAGES",{languages:{"latin-ext":["pl","cs","hr","hu","lv","ro","af","eu","br","ca","eo","et","fy","lt","mt","rm","sk","sl"],cyrillic:["ru","bg","uk","be","sr","mk","bs"],japanese:["ja"],korean:["ko"],arabic:["ar"],hebrew:["he"]}}),define.Const("CSS",{COLORS:["transparent","aliceblue","antiquewhite","aqua","aquamarine","azure","beige","bisque","black","blanchedalmond","blue","blueviolet","brown","burlywood","cadetblue","chartreuse","chocolate","coral","cornflowerblue","cornsilk","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgray","darkgreen","darkkhaki","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategray","darkturquoise","darkviolet","deeppink","deepskyblue","dimgray","dodgerblue","firebrick","floralwhite","forestgreen","fuchsia","gainsboro","ghostwhite","gold","goldenrod","gray","green","greenyellow","honeydew","hotpink","indianred","indigo","ivory","khaki","lavender","lavenderblush","lawngreen","lemonchiffon","lightblue","lightcoral","lightcyan","lightgoldenrodyellow","lightgreen","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslategray","lightsteelblue","lightyellow","lime","limegreen","linen","magenta","maroon","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","mintcream","mistyrose","moccasin","navajowhite","navy","oldlace","olive","olivedrab","orange","orangered","orchid","palegoldenrod","palegreen","paleturquoise","palevioletred","papayawhip","peachpuff","peru","pink","plum","powderblue","purple","red","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","seashell","sienna","silver","skyblue","slateblue","slategray","snow","springgreen","steelblue","tan","teal","thistle","tomato","turquoise","violet","wheat","white","whitesmoke","yellow","yellowgreen"]}),define.Const("COUNTRY_LANGUAGES",{countries:{AFG:{countryName:"Afghanistan",characterSets:[],phoneCode:"+93"},ALA:{countryName:"land Islands",characterSets:[],phoneCode:"+358 18"},ALB:{countryName:"Albania",characterSets:[],phoneCode:"+355"},DZA:{countryName:"Algeria",characterSets:["arabic"],phoneCode:"+213"},ASM:{countryName:"American Samoa",characterSets:[],phoneCode:"+1 684"},AND:{countryName:"Andorra",characterSets:[],phoneCode:"+376"},AGO:{countryName:"Angola",characterSets:[],phoneCode:"+244"},AIA:{countryName:"Anguilla",characterSets:[],phoneCode:"+1 264"},ATA:{countryName:"Antarctica",characterSets:[],phoneCode:""},ATG:{countryName:"Antigua and Barbuda",characterSets:[],phoneCode:"+1 268"},ARG:{countryName:"Argentina",characterSets:[],phoneCode:"+54"},ARM:{countryName:"Armenia",characterSets:[],phoneCode:"+374"},ABW:{countryName:"Aruba",characterSets:[],phoneCode:"+297"},AUS:{countryName:"Australia",characterSets:[],phoneCode:"+61"},AUT:{countryName:"Austria",characterSets:[],phoneCode:"+43"},AZE:{countryName:"Azerbaijan",characterSets:[],phoneCode:"+994"},BHS:{countryName:"Bahamas",characterSets:[],phoneCode:"+1 242"},BHR:{countryName:"Bahrain",characterSets:["arabic"],phoneCode:"+973"},BGD:{countryName:"Bangladesh",characterSets:[],phoneCode:"+880"},BRB:{countryName:"Barbados",characterSets:[],phoneCode:"+1 246"},BLR:{countryName:"Belarus",characterSets:["cyrillic"],phoneCode:"+375"},BEL:{countryName:"Belgium",characterSets:[],phoneCode:"+32"},BLZ:{countryName:"Belize",characterSets:[],phoneCode:"+501"},BEN:{countryName:"Benin",characterSets:[],phoneCode:"+229"},BMU:{countryName:"Bermuda",characterSets:[],phoneCode:"+1 441"},BTN:{countryName:"Bhutan",characterSets:[],phoneCode:"+975"},BOL:{countryName:"Bolivia, Plurinational State of",characterSets:[],phoneCode:"+591"},BES:{countryName:"Bonaire, Sint Eustatius and Saba",characterSets:[],phoneCode:"+599 7"},BIH:{countryName:"Bosnia and Herzegovina",characterSets:["cyrillic"],phoneCode:"+387"},BWA:{countryName:"Botswana",characterSets:[],phoneCode:"+267"},BVT:{countryName:"Bouvet Island",characterSets:[],phoneCode:""},BRA:{countryName:"Brazil",characterSets:[],phoneCode:"+55"},IOT:{countryName:"British Indian Ocean Territory",characterSets:[],phoneCode:"+246"},BRN:{countryName:"Brunei Darussalam",characterSets:[],phoneCode:"+673"},BGR:{countryName:"Bulgaria",characterSets:["cyrillic"],phoneCode:"+359"},BFA:{countryName:"Burkina Faso",characterSets:[],phoneCode:"+226"},BDI:{countryName:"Burundi",characterSets:[],phoneCode:"+257"},KHM:{countryName:"Cambodia",characterSets:[],phoneCode:"+855"},CMR:{countryName:"Cameroon",characterSets:[],phoneCode:"+237"},CAN:{countryName:"Canada",characterSets:[],phoneCode:"+1"},CPV:{countryName:"Cape Verde",characterSets:[],phoneCode:"+238"},CYM:{countryName:"Cayman Islands",characterSets:[],phoneCode:"+1 345"},CAF:{countryName:"Central African Republic",characterSets:[],phoneCode:"+236"},TCD:{countryName:"Chad",characterSets:["arabic"],phoneCode:"+235"},CHL:{countryName:"Chile",characterSets:[],phoneCode:"+56"},CHN:{countryName:"China",characterSets:[],phoneCode:"+86"},CXR:{countryName:"Christmas Island",characterSets:[],phoneCode:"+61"},CCK:{countryName:"Cocos (Keeling) Islands",characterSets:[],phoneCode:"+61"},COL:{countryName:"Colombia",characterSets:[],phoneCode:"+57"},COM:{countryName:"Comoros",characterSets:["arabic"],phoneCode:"+269"},COG:{countryName:"Congo",characterSets:[],phoneCode:"+242"},COD:{countryName:"Congo, the Democratic Republic of the",characterSets:[],phoneCode:"+243"},COK:{countryName:"Cook Islands",characterSets:[],phoneCode:"+682"},CRI:{countryName:"Costa Rica",characterSets:[],phoneCode:"+506"},CIV:{countryName:"Cte d'Ivoire",characterSets:[],phoneCode:"+225"},HRV:{countryName:"Croatia",characterSets:["latin-ext"],phoneCode:"+385"},CUB:{countryName:"Cuba",characterSets:[],phoneCode:"+53"},CUW:{countryName:"Curaao",characterSets:[],phoneCode:"+599 9"},CYP:{countryName:"Cyprus",characterSets:[],phoneCode:"+357"},CZE:{countryName:"Czech Republic",characterSets:["latin-ext"],phoneCode:"+420"},DNK:{countryName:"Denmark",characterSets:[],phoneCode:"+45"},DJI:{countryName:"Djibouti",characterSets:["arabic"],phoneCode:"+253"},DMA:{countryName:"Dominica",characterSets:[],phoneCode:"+1 767"},DOM:{countryName:"Dominican Republic",characterSets:[],phoneCode:"+1 809"},ECU:{countryName:"Ecuador",characterSets:[],phoneCode:"+593"},EGY:{countryName:"Egypt",characterSets:["arabic"],phoneCode:"+20"},SLV:{countryName:"El Salvador",characterSets:[],phoneCode:"+503"},GNQ:{countryName:"Equatorial Guinea",characterSets:[],phoneCode:"+240"},ERI:{countryName:"Eritrea",characterSets:["arabic"],phoneCode:"+291"},EST:{countryName:"Estonia",characterSets:[],phoneCode:"+372"},ETH:{countryName:"Ethiopia",characterSets:[],phoneCode:"+251"},FLK:{countryName:"Falkland Islands (Malvinas)",characterSets:[],phoneCode:"+500"},FRO:{countryName:"Faroe Islands",characterSets:[],phoneCode:"+298"},FJI:{countryName:"Fiji",characterSets:[],phoneCode:"+679"},FIN:{countryName:"Finland",characterSets:[],phoneCode:"+358"},FRA:{countryName:"France",characterSets:[],phoneCode:"+33"},GUF:{countryName:"French Guiana",characterSets:[],phoneCode:"+594"},PYF:{countryName:"French Polynesia",characterSets:[],phoneCode:"+689"},ATF:{countryName:"French Southern Territories",characterSets:[],phoneCode:""},GAB:{countryName:"Gabon",characterSets:[],phoneCode:"+241"},GMB:{countryName:"Gambia",characterSets:[],phoneCode:"+220"},GEO:{countryName:"Georgia",characterSets:[],phoneCode:"+995"},DEU:{countryName:"Germany",characterSets:[],phoneCode:"+49"},GHA:{countryName:"Ghana",characterSets:[],phoneCode:"+233"},GIB:{countryName:"Gibraltar",characterSets:[],phoneCode:"+350"},GRC:{countryName:"Greece",characterSets:[],phoneCode:"+30"},GRL:{countryName:"Greenland",characterSets:[],phoneCode:"+299"},GRD:{countryName:"Grenada",characterSets:[],phoneCode:"+1 473"},GLP:{countryName:"Guadeloupe",characterSets:[],phoneCode:"+590"},GUM:{countryName:"Guam",characterSets:[],phoneCode:"+1 671"},GTM:{countryName:"Guatemala",characterSets:[],phoneCode:"+502"},GGY:{countryName:"Guernsey",characterSets:[],phoneCode:"+44"},GIN:{countryName:"Guinea",characterSets:[],phoneCode:"+224"},GNB:{countryName:"Guinea-Bissau",characterSets:[],phoneCode:"+245"},GUY:{countryName:"Guyana",characterSets:[],phoneCode:"+592"},HTI:{countryName:"Haiti",characterSets:[],phoneCode:"+509"},HMD:{countryName:"Heard Island and McDonald Islands",characterSets:[],phoneCode:""},VAT:{countryName:"Holy See (Vatican City State)",characterSets:[],phoneCode:""},HND:{countryName:"Honduras",characterSets:[],phoneCode:"+504"},HKG:{countryName:"Hong Kong",characterSets:[],phoneCode:"+852"},HUN:{countryName:"Hungary",characterSets:["latin-ext"],phoneCode:"+36"},ISL:{countryName:"Iceland",characterSets:[],phoneCode:"+354"},IND:{countryName:"India",characterSets:[],phoneCode:"+91"},IDN:{countryName:"Indonesia",characterSets:[],phoneCode:"+62"},IRN:{countryName:"Iran, Islamic Republic of",characterSets:[],phoneCode:"+98"},IRQ:{countryName:"Iraq",characterSets:["arabic"],phoneCode:"+964"},IRL:{countryName:"Ireland",characterSets:[],phoneCode:"+353"},IMN:{countryName:"Isle of Man",characterSets:[],phoneCode:"+44"},ISR:{countryName:"Israel",characterSets:["hebrew","arabic"],phoneCode:"+972"},ITA:{countryName:"Italy",characterSets:[],phoneCode:"+39"},JAM:{countryName:"Jamaica",characterSets:[],phoneCode:"+1 876"},JPN:{countryName:"Japan",characterSets:["japanese"],phoneCode:"+81"},JEY:{countryName:"Jersey",characterSets:[],phoneCode:"+44"},JOR:{countryName:"Jordan",characterSets:["arabic"],phoneCode:"+962"},KAZ:{countryName:"Kazakhstan",characterSets:[],phoneCode:"+7 6"},KEN:{countryName:"Kenya",characterSets:[],phoneCode:"+254"},KIR:{countryName:"Kiribati",characterSets:[],phoneCode:"+686"},PRK:{countryName:"Korea, Democratic People's Republic of",characterSets:["korean"],phoneCode:"+850"},KOR:{countryName:"Korea, Republic of",characterSets:["korean"],phoneCode:"+82"},KWT:{countryName:"Kuwait",characterSets:["arabic"],phoneCode:"+965"},KGZ:{countryName:"Kyrgyzstan",characterSets:[],phoneCode:"+996"},LAO:{countryName:"Lao People's Democratic Republic",characterSets:[],phoneCode:"+856"},LVA:{countryName:"Latvia",characterSets:["latin-ext"],phoneCode:"+371"},LBN:{countryName:"Lebanon",characterSets:["arabic"],phoneCode:"+961"},LSO:{countryName:"Lesotho",characterSets:[],phoneCode:"+266"},LBR:{countryName:"Liberia",characterSets:[],phoneCode:"+231"},LBY:{countryName:"Libya",characterSets:["arabic"],phoneCode:"+218"},LIE:{countryName:"Liechtenstein",characterSets:[],phoneCode:"+423"},LTU:{countryName:"Lithuania",characterSets:[],phoneCode:"+370"},LUX:{countryName:"Luxembourg",characterSets:[],phoneCode:"+352"},MAC:{countryName:"Macao",characterSets:[],phoneCode:"+853"},MKD:{countryName:"Macedonia, the former Yugoslav Republic of",characterSets:["cyrillic"],phoneCode:"+389"},MDG:{countryName:"Madagascar",characterSets:[],phoneCode:"+261"},MWI:{countryName:"Malawi",characterSets:[],phoneCode:"+265"},MYS:{countryName:"Malaysia",characterSets:[],phoneCode:"+60"},MDV:{countryName:"Maldives",characterSets:[],phoneCode:"+960"},MLI:{countryName:"Mali",characterSets:[],phoneCode:"+223"},MLT:{countryName:"Malta",characterSets:[],phoneCode:"+356"},MHL:{countryName:"Marshall Islands",characterSets:[],phoneCode:"+692"},MTQ:{countryName:"Martinique",characterSets:[],phoneCode:"+596"},MRT:{countryName:"Mauritania",characterSets:["arabic"],phoneCode:"+222"},MUS:{countryName:"Mauritius",characterSets:[],phoneCode:"+230"},MYT:{countryName:"Mayotte",characterSets:[],phoneCode:"+262"},MEX:{countryName:"Mexico",characterSets:[],phoneCode:"+52"},FSM:{countryName:"Micronesia, Federated States of",characterSets:[],phoneCode:"+691"},MDA:{countryName:"Moldova, Republic of",characterSets:[],phoneCode:"+373"},MCO:{countryName:"Monaco",characterSets:[],phoneCode:"+377"},MNG:{countryName:"Mongolia",characterSets:[],phoneCode:"+976"},MNE:{countryName:"Montenegro",characterSets:["cyrillic"],phoneCode:"+382"},MSR:{countryName:"Montserrat",characterSets:[],phoneCode:"+1 664"},MAR:{countryName:"Morocco",characterSets:["arabic"],phoneCode:"+212"},MOZ:{countryName:"Mozambique",characterSets:[],phoneCode:"+258"},MMR:{countryName:"Myanmar",characterSets:[],phoneCode:""},NAM:{countryName:"Namibia",characterSets:[],phoneCode:"+264"},NRU:{countryName:"Nauru",characterSets:[],phoneCode:"+674"},NPL:{countryName:"Nepal",characterSets:[],phoneCode:"+977"},NLD:{countryName:"Netherlands",characterSets:[],phoneCode:"+31"},NCL:{countryName:"New Caledonia",characterSets:[],phoneCode:"+687"},NZL:{countryName:"New Zealand",characterSets:[],phoneCode:"+64"},NIC:{countryName:"Nicaragua",characterSets:[],phoneCode:"+505"},NER:{countryName:"Niger",characterSets:[],phoneCode:"+227"},NGA:{countryName:"Nigeria",characterSets:[],phoneCode:"+234"},NIU:{countryName:"Niue",characterSets:[],phoneCode:"+683"},NFK:{countryName:"Norfolk Island",characterSets:[],phoneCode:"+672"},MNP:{countryName:"Northern Mariana Islands",characterSets:[],phoneCode:"+1 670"},NOR:{countryName:"Norway",characterSets:[],phoneCode:"+47"},OMN:{countryName:"Oman",characterSets:["arabic"],phoneCode:"+968"},PAK:{countryName:"Pakistan",characterSets:[],phoneCode:"+92"},PLW:{countryName:"Palau",characterSets:[],phoneCode:"+680"},PSE:{countryName:"Palestine, State of",characterSets:["arabic"],phoneCode:"+970"},PAN:{countryName:"Panama",characterSets:[],phoneCode:"+507"},PNG:{countryName:"Papua New Guinea",characterSets:[],phoneCode:"+675"},PRY:{countryName:"Paraguay",characterSets:[],phoneCode:"+595"},PER:{countryName:"Peru",characterSets:[],phoneCode:"+51"},PHL:{countryName:"Philippines",characterSets:[],phoneCode:"+63"},PCN:{countryName:"Pitcairn",characterSets:[],phoneCode:"+64"},POL:{countryName:"Poland",characterSets:["latin-ext"],phoneCode:"+48"},PRT:{countryName:"Portugal",characterSets:[],phoneCode:"+351"},PRI:{countryName:"Puerto Rico",characterSets:[],phoneCode:"+1 787"},QAT:{countryName:"Qatar",characterSets:["arabic"],phoneCode:"+974"},REU:{countryName:"Runion",characterSets:[],phoneCode:"+262"},ROU:{countryName:"Romania",characterSets:["latin-ext"],phoneCode:"+40"},RUS:{countryName:"Russian Federation",characterSets:["cyrillic"],phoneCode:"+7"},RWA:{countryName:"Rwanda",characterSets:[],phoneCode:"+250"},BLM:{countryName:"Saint Barthlemy",characterSets:[],phoneCode:"+590"},SHN:{countryName:"Saint Helena, Ascension and Tristan da Cunha",characterSets:[],phoneCode:"+290"},KNA:{countryName:"Saint Kitts and Nevis",characterSets:[],phoneCode:"+1 869"},LCA:{countryName:"Saint Lucia",characterSets:[],phoneCode:"+1 758"},MAF:{countryName:"Saint Martin (French part)",characterSets:[],phoneCode:"+590"},SPM:{countryName:"Saint Pierre and Miquelon",characterSets:[],phoneCode:"+508"},VCT:{countryName:"Saint Vincent and the Grenadines",characterSets:[],phoneCode:"+1 784"},WSM:{countryName:"Samoa",characterSets:[],phoneCode:"+685"},SMR:{countryName:"San Marino",characterSets:[],phoneCode:"+378"},STP:{countryName:"Sao Tome and Principe",characterSets:[],phoneCode:"+239"},SAU:{countryName:"Saudi Arabia",characterSets:["arabic"],phoneCode:"+966"},SEN:{countryName:"Senegal",characterSets:[],phoneCode:"+221"},SRB:{countryName:"Serbia",characterSets:["cyrillic"],phoneCode:"+381"},SYC:{countryName:"Seychelles",characterSets:[],phoneCode:"+248"},SLE:{countryName:"Sierra Leone",characterSets:[],phoneCode:"+232"},SGP:{countryName:"Singapore",characterSets:[],phoneCode:"+65"},SXM:{countryName:"Sint Maarten (Dutch part)",characterSets:[],phoneCode:"+1 721"},SVK:{countryName:"Slovakia",characterSets:[],phoneCode:"+421"},SVN:{countryName:"Slovenia",characterSets:[],phoneCode:"+386"},SLB:{countryName:"Solomon Islands",characterSets:[],phoneCode:"+677"},SOM:{countryName:"Somalia",characterSets:["arabic"],phoneCode:"+252"},ZAF:{countryName:"South Africa",characterSets:[],phoneCode:"+27"},SGS:{countryName:"South Georgia and the South Sandwich Islands",characterSets:[],phoneCode:"+500"},SSD:{countryName:"South Sudan",characterSets:[],phoneCode:"+211"},ESP:{countryName:"Spain",characterSets:[],phoneCode:"+34"},LKA:{countryName:"Sri Lanka",characterSets:[],phoneCode:"+94"},SDN:{countryName:"Sudan",characterSets:["arabic"],phoneCode:"+249"},SUR:{countryName:"Suriname",characterSets:[],phoneCode:"+597"},SJM:{countryName:"Svalbard and Jan Mayen",characterSets:[],phoneCode:"+47 79"},SWZ:{countryName:"Swaziland",characterSets:[],phoneCode:"+268"},SWE:{countryName:"Sweden",characterSets:[],phoneCode:"+46"},CHE:{countryName:"Switzerland",characterSets:[],phoneCode:"+41"},SYR:{countryName:"Syrian Arab Republic",characterSets:["arabic"],phoneCode:"+963"},TWN:{countryName:"Taiwan, Province of China",characterSets:[],phoneCode:"+886"},TJK:{countryName:"Tajikistan",characterSets:[],phoneCode:"+992"},TZA:{countryName:"Tanzania, United Republic of",characterSets:[],phoneCode:"+255"},THA:{countryName:"Thailand",characterSets:[],phoneCode:"+66"},TLS:{countryName:"Timor-Leste",characterSets:[],phoneCode:""},TGO:{countryName:"Togo",characterSets:[],phoneCode:"+228"},TKL:{countryName:"Tokelau",characterSets:[],phoneCode:"+690"},TON:{countryName:"Tonga",characterSets:[],phoneCode:"+676"},TTO:{countryName:"Trinidad and Tobago",characterSets:[],phoneCode:"+1 868"},TUN:{countryName:"Tunisia",characterSets:["arabic"],phoneCode:"+216"},TUR:{countryName:"Turkey",characterSets:[],phoneCode:"+90"},TKM:{countryName:"Turkmenistan",characterSets:[],phoneCode:"+993"},TCA:{countryName:"Turks and Caicos Islands",characterSets:[],phoneCode:"+1 649"},TUV:{countryName:"Tuvalu",characterSets:[],phoneCode:"+688"},UGA:{countryName:"Uganda",characterSets:[],phoneCode:"+256"},UKR:{countryName:"Ukraine",characterSets:["cyrillic"],phoneCode:"+380"},ARE:{countryName:"United Arab Emirates",characterSets:["arabic"],phoneCode:"+971"},GBR:{countryName:"United Kingdom",characterSets:[],phoneCode:"+44"},USA:{countryName:"United States",characterSets:[],phoneCode:"+1"},UMI:{countryName:"United States Minor Outlying Islands",characterSets:[],phoneCode:""},URY:{countryName:"Uruguay",characterSets:[],phoneCode:"+598"},UZB:{countryName:"Uzbekistan",characterSets:[],phoneCode:"+998"},VUT:{countryName:"Vanuatu",characterSets:[],phoneCode:"+678"},VEN:{countryName:"Venezuela, Bolivarian Republic of",characterSets:[],phoneCode:"+58"},VNM:{countryName:"Viet Nam",characterSets:[],phoneCode:"+84"},VGB:{countryName:"Virgin Islands, British",characterSets:[],phoneCode:""},VIR:{countryName:"Virgin Islands, U.S.",characterSets:[],phoneCode:""},WLF:{countryName:"Wallis and Futuna",characterSets:[],phoneCode:"+681"},ESH:{countryName:"Western Sahara",characterSets:[],phoneCode:""},YEM:{countryName:"Yemen",characterSets:["arabic"],phoneCode:"+967"},ZMB:{countryName:"Zambia",characterSets:[],phoneCode:"+260"},ZWE:{countryName:"Zimbabwe",characterSets:[],phoneCode:"+263"}}}),define.Class("core.managers.data.ComponentDataManager",function(a){var b=a;b.utilize(["core.managers.data.PropertiesItem"]),b.inherits("core.managers.data.DataManager"),b.fields({DEFINE_NAMESPACE:"dataPropertyItem",EXPERIMENT_PLUGIN_NAME:"ExperimentDataPropertyItemPlugin"}),b.methods({initialize:function(){this._PropertiesItem=this.imports.PropertiesItem,this.parent()},addDataItem:function(a,b,c){var d=this.createDataItem(b,c);return d._data.id=a,this.dataMap[a]=d,this._runCallbacks(a,d),this.markDirtyObject(d),d},createDataItem:function(a,b){var c=a.type,d=this.getDataTypeSchema(c);return d?new this._PropertiesItem(d,a,this,b):new this._DataItemBase(a,this)}})}),define.Class("core.managers.data.DataItemBase",function(a){var b=a;b.inherits("core.events.EventDispatcher"),b.traits(["bootstrap.utils.Events"]),b.binds(["fireDataChangeEvent"]),b.statics({METADATA_DEFAULTS:{isPreset:!0,isHidden:!1,description:"",isPersistent:!0,schemaVersion:"1.0",autoGenerated:!1},getFieldsFilterArray:function(a){return"array"==typeOf(a)?a:Object.keys(a)}}),b.methods({initialize:function(a,b){if(this._data=a,a.type&&"string"!=typeof a.type)throw"invalid data type. must be string";this._dataType=a.type,this._dataManager=b||this.injects().Data,this.componentsWithInterest=[],this._isPersistent=!1},setData:function(a,b){var c=this._data,d=this._data!==a;this._data=a,this._dataType=a.type,d&&!b&&this.fireDataChangeEvent(void 0,a,c)},setFields:function(a,b){var c={},d={},e=this._data;Object.forEach(a,function(a,b){e[b]!==a&&(c[b]=e[b],d[b]=a),this.set(b,a,!0)}.bind(this)),Object.keys(c).length>0&&this.fireDataChangeEvent(d,d,c,b)},setMeta:function(a,b,c){if(a in this.METADATA_DEFAULTS){if(this._data.metaData=this._data.metaData||{},this._data.metaData[a]=b,c){var d={key:b},e={};this.fireDataChangeEvent(d,e)}}else LOG.reportError(wixErrors.INVALID_METADATA_FIELD,"DataItemBase","setMeta",a)()},set:function(a,b,c,d,e){if(b=this.injects().Utils.sanitizeUnicode(b),this._data[a]!==b){var f=this._getDataOldValue(a,e);if(this._data[a]=b,this.setMeta("isPreset",!1),!c){var g={};g[a]=b,this.fireDataChangeEvent(a,g,f,d)}}},_getDataOldValue:function(a,b){return b||(b={},b[a]=this._data[a]),b},getFields:function(a){var b={},c=this.getFieldsFilterArray(a);return c.forEach(function(a){b[a]=this.get(a)}.bind(this)),b},getData:function(){return this._data},getType:function(){return this._data.type},getMeta:function(a){if(a in this.METADATA_DEFAULTS){var b=this._data.metaData&&this._data.metaData[a];return void 0!==b?b:this.METADATA_DEFAULTS[a]}LOG.reportError(wixErrors.INVALID_METADATA_FIELD,"DataItemBase","getMeta",a)()},get:function(a){var b=this._data[a];return"string"==typeof b&&(b=this._sanitizeString(b)),b},_sanitizeString:function(a){return a.replace(/[\u0080\u0099\u009C]/g,"")},fireDataChangeEvent:function(a,b,c,d,e){this.markDataAsDirty();var f=void 0!==a?[this,a,b,c]:[this],g=void 0!==a?{dataItem:this,field:a,newValue:b,oldValue:c}:{dataItem:this};this.trigger(Constants.DataEvents.DATA_CHANGED,g),this.fireEvent(Constants.DataEvents.DATA_CHANGED,f),this._dataManager.reportDataItemChangeEvent(this,b,c,d,e)},markDataAsDirty:function(){this.getMeta("isPersistent")!==!1&&(this._dataManager.markDirtyObject(this),this._dataManager.flagDataChange())},markDataAsClean:function(){var a=this.get("id");this._dataManager.clearDirtyObject(a)},toString:function(){return"[Data Object]"},getDataManager:function(){return this._dataManager},addComponentWithInterest:function(a){this.componentsWithInterest.include(a)},removeComponentWithInterest:function(a){this.componentsWithInterest.erase(a)},cloneData:function(){return Object.clone(this.getData())},hasField:function(a){var b=this._data[a];return null!==b&&void 0!==b},isReady:function(){return!0},getIsPersistent:function(){return this._isPersistent},setIsPersistent:function(a){this._isPersistent=a}})}),define.Class("core.managers.data.DataItemWithSchema",function(a){var b=a;b.inherits("core.managers.data.DataItemBase"),b.utilize(["core.utils.css.Color"]),b.traits(["bootstrap.utils.Events"]),b.statics({FIELD_TYPE_DEFAULTS:{refList:[],ref:"",number:Number.NaN,string:"",color:"255,255,255,1","boolean":!1,object:{},list:[]}}),b.methods({initialize:function(a,b,c,d){this._schema=a,this._schemaType=d,this._snapshot={},this.parent(b,c),this._setSchemaDefaults()},reset:function(){for(var a in this._schema){var b=this._getDefaultValue(a);this._data[a]!=b&&this.set(a,b)}},removeField:function(a){delete this._data[a]},takeSnapshot:function(){var a={};this._cloneBySchema(a,this._data),this._snapshot=a},restoreSnapshot:function(a){this._snapshot?(this._cloneBySchema(this._data,this._snapshot),this.discardSnapshot(),a!==!1&&this.fireDataChangeEvent()):LOG.reportError(wixErrors.DATA_MISSING_SNAPSHOT,"DataItem","restoreSnapshot",this._dataType)},discardSnapshot:function(){this._snapshot=null},getSchemaType:function(){return this._schemaType},getSchema:function(){return this._schema},setSchema:function(a){this._schema=a},getFieldSchema:function(a){return this._schema[a]},_setSchemaDefaults:function(){for(var a in this._schema){var b=this._schema[a];if(b&&b["default"]){var c=this._data[a],d=this.get(a);c||c==d||this.set(a,d)}}},get:function(a){var b=this.parent(a),c=this._schema[a];if(void 0!==b&&null!==b){if(Constants.DataTypes.TYPE_RESOURCE_KEY==c){var d=this.getDataManager().getResourceManager();d&&(b=d.get("EDITOR_LANGUAGE",b,b))}}else b=this._getDefaultValue(a),this._data[a]=b;return"color"==c?new this.imports.Color(b):b},getFieldType:function(a){return this._schema[a]},_getDefaultValue:function(a){var b,c=this._schema[a];return c?(b="string"==typeof c?this.FIELD_TYPE_DEFAULTS[c]:c.hasOwnProperty("default")?c["default"]:this.FIELD_TYPE_DEFAULTS[c.type],this._cloneDefaultObject(b)):void 0},_cloneDefaultObject:function(a){return Array.isArray(a)?a.splice(0,0):"object"==typeof a&&null!==a?Object.clone(a):a},_cloneBySchema:function(a,b){return _.forOwn(this._schema,function(c,d){var e=b[d];a[d]=_.clone(e,!1)}),a},copySchemaFieldsFrom:function(a,b){this._cloneBySchema(this._data,a._data),b||this.fireDataChangeEvent()},copySchemaFieldsTo:function(a,b,c){var d=this._cloneBySchemaAndReturnDataChange(a._data,this._data),e=Object.keys(d.newValue).length+Object.keys(d.oldValue).length===0;e||b||a.fireDataChangeEvent(void 0,d.newValue,d.oldValue,c)},_cloneBySchemaAndReturnDataChange:function(a,b){var c,d,e={},f={};for(var g in this._schema){var h=b[g],i=typeof h;c=a[g],instanceOf(h,Array)?(d=h.slice(),a[g]=d):"object"==i?(d=Object.clone(h),a[g]=d):(d=h,a[g]=d),(c||d)&&c!=d&&(f[g]=c,e[g]=d)}return{dataItem:a,newValue:e,oldValue:f}},set:function(a,b,c,d,e){var f=this._validateByPresenceInSchema(a);f?this.parent(a,b,c,d,e):LOG.reportError(wixErrors.SCHEMA_MISSING_KEY,"DataItemWithSchema","set",{c1:"key: "+a+", schemaType: "+this._schemaType})},setData:function(a,b){return a!==this._data?this._hasValidType(a.type)?(this._data?this._data.type==a.type&&(a.id=this._data.id,this.parent(a,!1),this._setSchemaDefaults(),b!==!1&&this.fireDataChangeEvent()):this.parent(a,b),void 0):(LOG.reportError(wixErrors.SCHEMA_MISSING,"DataItemWithSchema","setData",{c1:"type: "+a.type+", schemaType: "+this._schemaType}),void 0):void 0},hasField:function(a){var b=this._data[a];return null!==b&&void 0!==b},_hasValidType:function(a){return this._schemaType===a},_hasCheckableSchema:function(){return this._schemaType&&"Document"!==this._schemaType},_isKeyPresentedInSchema:function(a){return void 0!==this._schema[a]},_validateByPresenceInSchema:function(a){return this._hasCheckableSchema()?this._isKeyPresentedInSchema(a):!0},isReady:function(){if(this._isReady)return!0;var a=this.getWaitingForReadyList();return this._isReady=a.length>0?!1:!0,this._isReady},getWaitingForReadyList:function(){var a=[],b=this.getData(),c=this.getDataManager();for(var d in b){var e,f,g=this.getFieldType(d);if("ref"==g){if(e=this.get(d),!e)continue;f=c.isDataAvailable(e),f||a.push(e)}else if("refList"==g)for(var h=this.get(d),i=0;i<h.length;i++)e=h[i],f=c.isDataAvailable(e),f||a.push(e)}return a}})}),define.Class("core.managers.data.DataManager",function(a){var b=a;b.inherits("bootstrap.managers.BaseManager"),b.utilize(["core.managers.data.DataItemBase","core.managers.data.DataItemWithSchema","bootstrap.utils.Queue"]),b.resources(["W.Classes","W.Experiments"]),b.fields({DEFINE_NAMESPACE:"dataItem",EXPERIMENT_PLUGIN_NAME:"ExperimentDataItemPlugin"}),b.methods({initialize:function(){this._classManager=this.resources.W.Classes,this._readyDataSchemaMap={},this.dataMap={},this.dirtyDataObjectsMap={},this._dirtyDataCompIds={},this.callbackQueue=new this.imports.Queue,this._DataItemBase=this.imports.DataItemBase,this._DataItemWithSchema=this.imports.DataItemWithSchema,this.define[this.DEFINE_NAMESPACE].definitionModifier=this._onDataItemDefineCallBack.bind(this),this._notReadyDataMap={},this._waitingForReadyDataMap={},this._corruptDataItemRefs={}},markCorruptDataItemRef:function(a,b){-1===a.indexOf("#")&&(a="#"+a),this._corruptDataItemRefs[a]=b},fixCorruptDataItemRef:function(a){a.link&&"string"==typeof a.link&&this.isDataItemRefCorrupt(a.link)&&(a.link=""),a.linkList&&_.remove(a.linkList,function(a){return a&&"string"==typeof a&&this.isDataItemRefCorrupt(a)}.bind(this))},isDataItemRefCorrupt:function(a){return-1===a.indexOf("#")&&(a="#"+a),!!this._corruptDataItemRefs[a]},flagDataChange:function(){this._dataChanged=!0},clearDataChange:function(){this._dataChanged=!1},isDataChange:function(){return this._dataChanged===!0},_onDataItemDefineCallBack:function(a,b){return this.addDataItem(a,b),b},getDataTypeSchema:function(a){if(!this._readyDataSchemaMap[a]){var b=this.define.getDefinition("dataSchema"),c=b[a];if(!c){var d="/schema=["+a+"]";return LOG.reportError(wixErrors.SCHEMA_MISSING,"DataManager","getSchema"+d,[a])(),null}this._applySchemaInheritance(c),c=this.resources.W.Experiments.applyExperiments(a,c,"ExperimentDataSchemaPlugin"),this._readyDataSchemaMap[a]=c
}return this._readyDataSchemaMap[a]},_applySchemaInheritance:function(a){var b=a["extends"];if(b){var c=this.getDataTypeSchema(b);Object.merge(a,c)}},clearDirtyObjectsMap:function(){this.dirtyDataObjectsMap={}},clearDirtyObject:function(a){delete this.dirtyDataObjectsMap[a]},hasDirtyObjects:function(){return W.Utils.objectSizeDelta(this.dirtyDataObjectsMap)},markDirtyObject:function(a){var b=a._data,c=b.id;this.dirtyDataObjectsMap[c]=a},markDirtyCompIdForLater:function(a){this._dirtyDataCompIds[a]=a},_markDirtyDataItemsForCompIds:function(){_.forOwn(this._dirtyDataCompIds,function(a){var b=this.getDataByQuery("#"+a);b&&this.markDirtyObject(b),delete this._dirtyDataCompIds[a]},this)},addDataItems:function(a){for(var b in a)this.addDataItem(b,a[b])},addDataItemsForPage:function(a){var b=this.define.getDefinition(this.DEFINE_NAMESPACE);for(var c in a){var d=nsUtil.getNameSpace(b,c);this.dataMap[c]||d||define[this.DEFINE_NAMESPACE](c,a[c])}},addDataItem:function(a,b){this.fixCorruptDataItemRef(b),b=this.resources.W.Experiments.applyExperiments(a,b,this.EXPERIMENT_PLUGIN_NAME);var c=this.createDataItem(b);c._data.id=a,this.markDirtyObject(c);var d=c.isReady();return d?this._setDataReady(c):this._addToWaitingForReady(c),c},_setDataReady:function(a){var b=a.get("id");this.dataMap[b]=a,this._runCallbacks(b,a),this._updateDataWaitingList(a),this._notReadyDataMap[b]&&delete this._notReadyDataMap[b]},_updateDataWaitingList:function(a){var b=a.get("id"),c=this._waitingForReadyDataMap[b];if(c){delete this._waitingForReadyDataMap[b];for(var d=0;d<c.length;d++){var e=this._notReadyDataMap[c[d]];e&&e.isReady()&&this._setDataReady(e)}}},_addToWaitingForReady:function(a){var b=a.get("id");this._notReadyDataMap[b]=a;for(var c=a.getWaitingForReadyList(),d=0;d<c.length;d++){var e=c[d];0===e.indexOf("#")&&(e=e.substr(1)),this._waitingForReadyDataMap[e]||(this._waitingForReadyDataMap[e]=[]),this._waitingForReadyDataMap[e].push(b)}},addDataItemWithId:function(a,b){if(!a)return this.addDataItemWithUniqueId("dataPrefix",b).dataObject;if(this.isDataAvailable("#"+a)){var c=this.getDataByQuery("#"+a);return this.markDirtyObject(c),c}return this.addDataItem(a,b)},override:function(a,b){if(!a||!this.dataMap[a])throw new Error("Invalid data id name for override: "+a);this.dataMap[a]=b},addDataItemWithUniqueId:function(a,b){var c;do c=a+Number.random(0,99999).toString(36),c=c.replace(" ","_");while(this.dataMap[c]);var d=this.addDataItem(c,b);return{id:c,dataObject:d}},reportDataItemChangeEvent:function(a,b,c,d,e){this.fireEvent(Constants.DataEvents.DATA_CHANGED,[a,b,c,d]),e||void 0===b||void 0===c||!a._data.id||this.injects().Utils.areObjectsEqual(b,c)||this.fireEvent("undoDataChangedEvent",[a,b,c,d])},_runCallbacks:function(a,b){this.callbackQueue.popQueue(a).forEach(function(a){a&&a(b)})},createDataItem:function(a,b){b=b||a.type;var c;if(b&&(c=this.getDataTypeSchema(b)),c){if(c.dataClassRef){var d;return this._classManager.getClass(c.dataClassRef,function(a){d=a}),d?new d(a,this,c,b):(LOG.reportError(wixErrors.SCHEMA_MISSING,"DataManager","getSchema"+c.dataClassRef,[c.dataClassRef])(),null)}return new this._DataItemWithSchema(c,a,this,b)}return new this._DataItemBase(a,this)},isDataItem:function(a){return a&&instanceOf(a,this._DataItemBase)},getDataByQuery:function(a,b){var c=null;if(0===a.indexOf("#")&&a.length>1){var d=a.substr(1);if(c=this.dataMap[d],b=b||function(){},c)return b(c),c;this.callbackQueue.add(d,b);var e=this.define.getDefinition(this.DEFINE_NAMESPACE),f=nsUtil.getNameSpace(e,d);if(f)return this.addDataItem(d,f)}else LOG.reportError(wixErrors.DM_MALFORMED_QUERY,"DataManager","getDataByQuery",a),W.Utils.callLater(b,[null])},isDataAvailable:function(a){var b=null;if(0===a.indexOf("#")){var c=a.substr(1);if(!c)return!1;if(b=this.dataMap[c])return!0;var d=this.define.getDefinition(this.DEFINE_NAMESPACE),e=nsUtil.getNameSpace(d,c);return e?!0:!1}return LOG.reportError(wixErrors.DM_MALFORMED_QUERY,"DataManager","isDataAvailable",a),!1},getDataByQueryList:function(a,b){var c={},d=function(d){return function(e){c[d]=e;for(var f=!0,g=0;g<a.length;++g)if(!c[a[g]]){f=!1;break}f&&b&&b(c)}};if(0===a.length){var e={};W.Utils.callLater(b,[e])}else{for(var f={},g=!0,h=0;h<a.length;++h){var i=this.getDataByQuery(a[h],d(a[h]));i?f[a[h]]=i:g=!1}if(g)return f}},getDataMap:function(){return this.dataMap},getDirtyDataObjectsMap:function(){return this._markDirtyDataItemsForCompIds(),Object.filter(this.dirtyDataObjectsMap,function(a){return a.getMeta("isPersistent")})},clone:function(a){var b=this.parent(a);return b},isReady:function(){return Object.getLength(this._notReadyDataMap)>0&&Object.getLength(this._waitingForReadyDataMap)>0?!1:!0},_copyData:function(a){for(var b in this.dataMap){var c=Object.clone(this.dataMap[b].getData());a.addDataItem(b,c)}},toString:function(){return"[Data Manager]"},markAllDirty:function(){for(var a in this.dataMap){var b=this.dataMap[a];b.getMeta("isPersistent")!==!1&&(this.dirtyDataObjectsMap[a]=this.dataMap[a])}},getResourceManager:function(){return W.Resources},removeDataItem:function(a){var b="string"==typeof a?a:this.getQueryOfDataItem(a);this._removeIfSafe(b)},_removeIfSafe:function(a){var b=a&&this.dataMap[a.substr(1)];b&&(0!==b.componentsWithInterest.length||this._isReferenced(a)||b.getIsPersistent()||(b.removeAllEvents(),b.exterminate(),delete this.dataMap[a.substr(1)]))},_isReferenced:function(a){var b,c;for(b in this.dataMap)if(c=this.dataMap[b].getData(),c&&c.items&&c.items.indexOf&&-1!==c.items.indexOf(a))return!0;return!1},getQueryOfDataItem:function(a){var b;for(b in this.dataMap)if(a===this.dataMap[b])return"#"+b},getDataItem:function(a,b){"string"==typeof a?this.injects().Data.getDataByQuery(a,b):b(a)},getDataItemsList:function(){},getDataItemsByType:function(a,b){var c=this._getDataItemsByTypeFromMap(a),d=this._getDefinitionsByType(a),e=Object.keys(d),f=e.map(function(a){return"#"+a});this.getDataByQueryList(f,function(a){var d=Object.append(a,c);b(d)})},_getDataItemsByTypeFromMap:function(a){var b=Object.values(this.dataMap),c=b.filter(function(b){return b.getType()==a});return c.toMap(function(a){return"#"+a.get("id")})},_getDefinitionsByType:function(a){var b=Object.filter(this.define.getDefinition(this.DEFINE_NAMESPACE),function(b){return b&&b.type===a});return b}})}),define.experimentPlugin("ExperimentDataItemPlugin",function(a){function b(a,b){var c=this.define.createBootstrapClassInstance("bootstrap.managers.experiments.ExperimentStrategy"),d=b(c),e=c._mergeField_(a,d);return e}function c(a,b){define.dataItem(a,b())}var d=a;d.init("dataItem","newDataItem",b,c)}),define.experimentPlugin("ExperimentDataPropertyItemPlugin",function(a){function b(a,b){var c=this.define.createBootstrapClassInstance("bootstrap.managers.experiments.ExperimentStrategy"),d=b(c),e=c._mergeField_(a,d);return e}function c(a,b){define.dataPropertyItem(a,b())}var d=a;d.init("dataPropertyItem","newDataPropertyItem",b,c)}),define.experimentPlugin("ExperimentDataSchemaPlugin",function(a){function b(a,b){var c=this.define.createBootstrapClassInstance("bootstrap.managers.experiments.ExperimentStrategy"),d=b(c),e=c._mergeField_(a,d);return e}function c(a,b){define.dataSchema(a,b())}var d=a;d.init("dataSchema","newDataSchema",b,c)}),define.Class("core.managers.data.PropertiesItem",function(a){var b=a;b.inherits("core.managers.data.DataItemWithSchema"),b.methods({initialize:function(a,b,c,d){this.parent(a,b,c),this._ownerComponent=d}})}),define.Const("DataEvents",{DATA_CHANGED:"dataChanged",BEFORE_CHANGE:"beforeDataChange",AFTER_CHANGE:"afterDataChange"}),define.Const("DataTypes",{TYPE_RESOURCE_KEY:"resourceKey"}),define.Const("PropertyEvents",{PROPERTY_CHANGED:"propertyChanged"}),define.Const("UrmEvents",{DATA_CHANGE_RECORDED:"dataChanged",UNDO_COMPLETE:"undoComplete",REDO_COMPLETE:"redoComplete",DATA_CHANGED_EVENT:"undoDataChangedEvent"}),define.Class("core.managers.serverfacade.CorsRESTClient",function(a){var b=a;b.inherits("core.managers.serverfacade.RESTClient"),b.methods({initialize:function(){},get:function(a,b,c){var d=this._createCorsXhr(a);this._setCallbacks(d,c),d.send()},_createCorsXhr:function(a,b){var c=b||"GET",d=null;try{d=new XMLHttpRequest}catch(e){}return d&&"withCredentials"in d?d.open(c,a,!0):"undefined"!=typeof XDomainRequest&&(d=new XDomainRequest,d.open(c,a),d.setRequestHeader=function(){}),d},_onXhrEvent:function(a,b,c){if("load"!=a||!this._isIExplorer()&&4!=b.readyState)this._onError(b,c);else{var d={};try{d=JSON.parse(b.responseText)}catch(e){}this._onSuccess(d,c)}},_isIExplorer:function(){return-1!=navigator.userAgent.indexOf("MSIE")},_setCallbacks:function(a,b){a.onabort=function(){this._onXhrEvent("abort",a,b)}.bind(this),a.ontimeout=function(){this._onXhrEvent("timeout",a,b)}.bind(this),a.onerror=function(){this._onXhrEvent("error",a,b)}.bind(this),a.onload=function(){this._onXhrEvent("load",a,b)}.bind(this),a.onprogress=function(){}},post:function(a,b,c){var d=this._createCorsXhr(a,"POST");d.setRequestHeader("Content-Type","application/json; charset=utf-8"),d.onload=function(){d.status>=200&&d.status<400?c.onSuccess():Browser.ie||c.onError()},d.send(b)},jsonp:void 0,jsonrpc:void 0})}),define.Class("core.managers.serverfacade.FeedbackClient",function(a){var b=a;b.utilize(["core.managers.serverfacade.CorsRESTClient","core.managers.serverfacade.RESTClient"]),b.statics({COMMENT_SERVER:"wixfeedbackserver.appspot.com"}),b.methods({initialize:function(){this._corsRestClient=new this.imports.CorsRESTClient,this._restClient=new this.imports.RESTClient},deleteComment:function(a){var b="http://"+this.COMMENT_SERVER+"/delete";this._corsRestClient.post(b,JSON.stringify({commentId:a}),{onSuccess:function(){},onError:function(){}})},loadSiteComments:function(a,b){var c="http://"+this.COMMENT_SERVER+"/list?siteId="+a;this._corsRestClient.get(c,null,{onSuccess:function(a){_.forEach(a,function(a){a.commentId=a.key.id,a.x=a.propertyMap.x.value,a.y=a.propertyMap.y.value,a.face=a.propertyMap.face.value,a.submitter=a.propertyMap.submitter.value,a.text=a.propertyMap.text.value.value,a.pageId=a.propertyMap.pageId,a.unread=a.propertyMap.unread,a.time=new Date(a.propertyMap.time)});var c=_.groupBy(a,function(a){return a.pageId});b(c)},onError:function(){throw new Error("Failed to get comments from feedback server")}})},_getShortenUrl:function(a,b){try{this._corsRestClient.get("https://api-ssl.bitly.com/v3/shorten?access_token=6e283dc921f56df2eff5951bd2bf5bab041d8ac2&longUrl="+a.replace(/&/g,"%26"),null,{onSuccess:function(a){200===a.status_code?b(a.data.url):b(!1)}.bind(this)})}catch(c){b(a)}},getPreviewUrl:function(a,b,c){var d=W.Config.getCurrentOrigin(),e="http:"+d+"/html/editor/web/review/createToken/"+b+"?metaSiteId="+a;this._restClient.get(e,null,{onSuccess:function(a){a.success===!0?this._getShortenUrl(a.payload.url+"?feedback=true",c):c(!1)}.bind(this)})},markAsReadComment:function(a){var b="http://"+this.COMMENT_SERVER+"/markAsRead";this._corsRestClient.post(b,JSON.stringify({commentId:a}),{onSuccess:function(){},onError:function(){}})},appendComments:function(a,b,c,d){var e="http://"+this.COMMENT_SERVER+"/append";this._corsRestClient.post(e,JSON.stringify({siteId:a,data:b,generalComment:c,submitter:d,userGuid:rendererModel.userId,metaSiteId:rendererModel.metaSiteId,siteName:rendererModel.siteName}),{onSuccess:function(){},onError:function(){throw new Error("failed to append comments to server")}})},markSiteShared:function(a){var b="http://"+this.COMMENT_SERVER+"/markSiteShared";this._corsRestClient.post(b,JSON.stringify({siteId:a}),{onSuccess:function(){},onError:function(){}})},isSiteShared:function(a,b){var c="http://"+this.COMMENT_SERVER+"/markSiteShared?siteId="+a;this._corsRestClient.get(c,null,{onSuccess:function(a){b(a)}.bind(this)})}})}),define.Class("core.managers.serverfacade.RESTClient",function(a){var b=a;b.statics({CALLBACK_STATUS:{SUCCESS:"success",ERROR:"error"},REQUEST_OBJECT:{jsonrpc:"2.0",id:1,method:"",params:[]}}),b.resources(["W.Utils"]),b.methods({initialize:function(){},get:function(a,b,c,d){var e=this._createRequestOptions(a,b,c);this._overrideDefaultRequestOptions(e,d);var f=new Request.JSON(e);b?f.get(JSON.encode(b)):f.get()},post:function(a,b,c,d){var e=this._createRequestOptions(a,b,c);e.headers={"Content-Type":"application/json; charset=utf-8"},this._overrideDefaultRequestOptions(e,d);var f=new Request.JSON(e);f.post(JSON.encode(b))},put:function(a,b,c,d){var e=this._createRequestOptions(a,b,c);this._overrideDefaultRequestOptions(e,d);var f=new Request.JSON(e);f.put(JSON.encode(b))},del:function(a,b,c,d){var e=this._createRequestOptions(a,b,c);this._overrideDefaultRequestOptions(e,d);var f=new Request.JSON(e);b?f.send({method:"delete",data:JSON.encode(b)}):f.send({method:"delete"})},jsonp:function(a,b,c){var d=this._createRequestOptions(a,b,c),e=new Request.JSONP(d);e.send(JSON.encode(b))},jsonrpc:function(a,b,c,d){var e=Object.clone(this.REQUEST_OBJECT);e.method=b,e.params=c,this.post(a,e,{onSuccess:function(a){a.result&&"function"==typeof d.onSuccess?d.onSuccess(a.result):"function"==typeof d.onError&&d.onError({errorDescription:"json-rpc returned an error",errorCode:-9999,payload:a.error})},onError:d.onError})},responseCallback:null,_createRequestOptions:function(a,b,c){var d=function(a){this._onSuccess(a,c)}.bind(this),e=function(a){this._onError(a,c)}.bind(this),f=function(a){this._onComplete(a,c)}.bind(this),g=function(a,b){this._onRequest(a,b,c)}.bind(this),h={url:a,urlEncoded:!1,onSuccess:d,onFailure:e,onComplete:f,onRequest:g};return h},_overrideDefaultRequestOptions:function(a,b){_.merge(a,b)},_onSuccess:function(a,b){a?this._executeSuccessCallback(b.onSuccess,a):this._executeFailureCallback(b.onError,Constants.ServerErrors.NO_DATA),this._executeUsersCallback(this.CALLBACK_STATUS.SUCCESS,a)},_onError:function(a,b){if(a){var c=Object.clone(Constants.ServerErrors.SERVER_UNHANDLED_ERROR);c.errorCode=a.status,this._executeFailureCallback(b.onError,c)}else this._executeFailureCallback(b.onError,Constants.ServerErrors.NO_DATA);this._executeUsersCallback(this.CALLBACK_STATUS.ERROR,a)},_onComplete:function(a,b){this._executeSuccessCallback(b.onComplete,a)},_onRequest:function(a,b,c){for(var d=this.resources.W.Utils.getQueryParam("callback",a).split("."),e=window,f=0;f<d.length;f++)e=e[d[f]];"function"==typeof c.onRequest&&c.onRequest(e,a,b)},_executeSuccessCallback:function(a,b){"function"===typeOf(a)&&a(b)},_executeFailureCallback:function(a,b){"function"===typeOf(a)&&a(b.errorDescription,b.errorCode,b.payload)},_executeUsersCallback:function(a,b){this.responseCallback&&"function"===typeOf(this.responseCallback)&&this.responseCallback(a,b)}})}),define.Class("core.managers.serverfacade.WixRESTClient",function(a){var b=a;b.inherits("core.managers.serverfacade.RESTClient"),b.methods({initialize:function(){},jsonp:function(a,b,c,d){if(d){var e=this._createRequestOptions(a,b,c);e.onSuccess=function(b,d){this._onSuccess(d,c,a)}.bind(this),e.onComplete=function(){},e.timeout=5e3;var f=new Request.JSONP(e);f.send(JSON.encode(b))}else this.parent(a,b,c)},_onSuccess:function(a,b,c){this._validateServerSuccessResponse(a,c),a?a.success?this._executeSuccessCallback(b.onSuccess,a):this._executeFailureCallback(b.onError,a):this._executeFailureCallback(b.onError,Constants.ServerErrors.NO_DATA),this._executeUsersCallback(this.CALLBACK_STATUS.SUCCESS,a.payload)},_onComplete:function(a,b){this._validateServerSuccessResponse(a),this.parent(a,b)},_validateServerSuccessResponse:function(a,b){a&&a.success!==!1||(a||(a=b?"WixRESTClient req:"+b:"WixRESTClient: no request/response"),LOG.reportError(wixErrors.SERVER_RETURNED_ERROR,"RESTClient","_onComplete",a))},_executeSuccessCallback:function(a,b){var c=b&&b.payload||b;this.parent(a,c)},_executeUsersCallback:function(a,b){var c=b&&b.payload||b;this.parent(a,c)}})}),define.Const("ServerErrors",{NO_DATA:{errorDescription:"no data",errorCode:-9999,payload:"no data"},SERVER_UNHANDLED_ERROR:{errorDescription:"server unhandled error",errorCode:-9999,payload:"no data"}}),define.Class("mobile.core.skins.BaseSkin",function(a){var b=a;b.resources(["W.Skins"]),b.binds(["_onStylePropChange"]),b.statics({_params:[{type:"domId",name:"Component ID",id:"compId",inherited:!0}],_html:"<div></div>",_css:["base {}"]}),b.fields({_viewNode:null,_updatePartsCallback:null,_skinParts:null,_inlineContainer:null}),b.methods({initialize:function(){this._isDisposed=!1},applyStyle:function(a){a&&this._style!==a&&(this._removeOldStyle(),this._addStyle(a),a.isDynamic&&a.isDynamic()||this._render())},_removeOldStyle:function(){this._style&&this._style.removeEvent(Constants.StyleEvents.PROPERTY_CHANGED,this._onStylePropChange),delete this._style},_addStyle:function(a){this._style=a,this._style.addEvent(Constants.StyleEvents.PROPERTY_CHANGED,this._onStylePropChange)},register:function(a,b,c){this._isRegistered()?LOG.reportError(wixErrors.SKIN_MANAGER_RE_REGISTER,"mobile.core.skins.BaseSkin","register",a.getProperty("id")):(this._viewNode=a,this._updatePartsCallback=b,this._skinParamChangeCallback=c,this._render())},unRegister:function(){this._viewNode=null,this.dispose()},_isRegistered:function(){return this._viewNode&&this._updatePartsCallback},getInlineContent:function(){return this._skinParts?this._skinParts.inlineContent?this._skinParts.inlineContent.getChildren():null:this._viewNode.getChildren()},_render:function(){if(this._isRegistered()){var a=this.getInlineContent();this._skinParts=this._buildSkin();var b=this._skinParts.inlineContent;if(b&&a&&a.length){b.empty();var c=Constants.DisplayEvents.MOVED_IN_DOM;b.empty();for(var d=0;d<a.length;d++)a[d].insertInto(b,"bottom",c)}this._updatePartsCallback(this._skinParts)}},_onStylePropChange:function(a){this.resources.W.Skins.stylePropertiesChangedForSkin(this.className,this._style,a.properties),this._skinParamChangeCallback(a.properties)},_informLogicOfParamChanges:function(){},_buildSkin:function(a){return this._renderCss(),this._renderHtml(a)},_renderCss:function(){this.resources.W.Skins.buildSkinCSS(this.className,this._style)},_renderHtml:function(a){var b=this._viewNode;return a&&a.viewNode&&(b=a.viewNode),this.resources.W.Skins.buildSkinHTML(this.className,b,this._style)},renderCssIfNeeded:function(){var a=!0;if(this._style)a=this._style.isStyleRenderedForAllSkins();else{var b=this.getSkinClassData(),c=b.CSSBuildFlags;for(var d in c)if(!c[d]){a=!1;break}}a||this._renderCss()},getStyle:function(){return this._style},getParams:function(){return this._params},getCompPartsDefinition:function(){return this.compParts||{}},getCompPartSkinName:function(a){var b=this.compParts;return b&&b[a].skSin},getUniqueClass:function(a){return this.resources.W.Skins.getUniqueClass(a,this.$className)},dispose:function(){this._isDisposed=!0,this._updatePartsCallback=null,this._removeOldStyle()},getParamValue:function(a){return this.resources.W.Skins.getSkinParamValue(this.$className,a,this._style)}})}),define.Class("core.managers.skin.BaseSkin2",function(a){var b=a;b.utilize(["mobile.core.skins.BaseSkin"]),b.inherits("core.events.EventDispatcher"),b.binds(["_onParamChange","_onParamMapperSkinChange","_onStylePropChange","_onParamMapperStyleChange","_onParamMapperStyleChange"]),b.resources(["W.Skins"]),b.methods({initialize:function(){},applyStyle:function(a){a&&this._paramMapper!==a&&(this.removeParamMapper(),this._paramMapper=a,this._paramMapper.addEvent(Constants.StyleEvents.PROPERTY_CHANGED,this._onStylePropChange),this._render())},_onStylePropChange:function(a){this.resources.W.Skins.stylePropertiesChangedForSkin(this.className,this._paramMapper,a.properties),this._logic&&this._logic._skinParamsChange(a.properties)},unRegister:function(){this._removeLogic_()},register:function(a,b,c,d){this._logic||(this._viewNode=a,this._setLogic_(a.$logic||d))},setParamMapper:function(a,b){this.removeParamMapper(),this._paramMapper=a,this._paramMapper.addEvent(Constants.StyleEvents.PROPERTY_CHANGED,this._onParamChange),b||(this._paramMapper.addEvent(Constants.StyleEvents.SKIN_CHANGED,this._onParamMapperSkinChange),this._paramMapper.addEvent(Constants.StyleEvents.STYLE_CHANGED,this._onParamMapperStyleChange)),this._render()},getParamMapper:function(){return this._paramMapper||null},removeParamMapper:function(){this._paramMapper&&(this._paramMapper.removeEvent(Constants.StyleEvents.PROPERTY_CHANGED,this._onParamChange),this._paramMapper.removeEvent(Constants.StyleEvents.SKIN_CHANGED,this._onParamMapperSkinChange),delete this._paramMapper)},_onParamMapperSkinChange:function(){this._paramMapper.getSkinClassName()!==this.$className&&this._logic&&this._logic.setSkinMapper(this._paramMapper)},_onParamMapperStyleChange:function(){this._logic&&this._logic.setSkinMapper(this._paramMapper)},_onParamChange:function(a){if(this.resources.W.Skins.stylePropertiesChangedForSkin(this.className,this._paramMapper,a.properties),this._logic){var b=this._logic.INVALIDATIONS.STYLE_PARAM_CHANGE;this._logic.invalidate(b,{properties:a.properties})}},_setLogic_:function(a){this._logic=a,this._render()},_removeLogic_:function(){delete this._logic},_getInlineContent:function(){return this._logic&&this._logic.getInlineContent?this._logic.getInlineContent():this.imports.BaseSkin.prototype.getInlineContent.apply(this,arguments)},getStyle:function(){return this._paramMapper},_render:function(){if(this._logic){var a=this._getInlineContent();if(this._skinParts=this._buildSkin(),this._skinParts.inlineContent&&a&&a.length){this._skinParts.inlineContent.empty();for(var b=0;b<a.length;b++)a[b].insertInto(this._skinParts.inlineContent,"bottom",Constants.DisplayEvents.MOVED_IN_DOM)}this._logic._updateSkinParts_(this._skinParts)}},_buildSkin:function(){return this._renderCss(),this._renderHtml()},_renderCss:function(){this.resources.W.Skins.buildSkinCSS(this.$className,this._paramMapper)},_renderHtml:function(){var a=this._logic.getViewNode();return this.resources.W.Skins.buildSkinHTML(this.$className,a,this._paramMapper)},getCompPartsDefinition:function(){return this.compParts||{}},getParams:function(){return this._params},getCompPartSkinName:function(a){var b=this.compParts;return b&&b[a].skSin},getUniqueClass:function(a){return this.resources.W.Skins.getUniqueClass(a,this.getOriginalClassName())},getParamValue:function(a){return this.resources.W.Skins.getSkinParamValue(this.getOriginalClassName(),a,this._paramMapper)},renderCssIfNeeded:function(){var a=!0;if(this._paramMapper)a=this._paramMapper.isStyleRenderedForAllSkins();else{var b=this.getSkinClassData(),c=b.CSSBuildFlags;for(var d in c)if(!c[d]){a=!1;break}}a||this._renderCss()},dispose:function(){this.exterminate()},exterminate:function(){this._removeLogic_(),this.removeParamMapper(),this.parent()}})}),define.Class("core.managers.skin.CssGarbageCollector",function(a){var b=a;b.utilize(["core.managers.skin.GCDomTraverse"]),b.binds(["runGarbageCollector"]),b.methods({initialize:function(a,b,c){this._styleDataMap=a,this._skinDataMap=b,this._skinRenderer=c,this._DomTraverserClass=this.imports.GCDomTraverse},runGarbageCollector:function(){this._domTraverser=new this._DomTraverserClass,this._domTraverser.traverseDomAndCollectUsedStyles(function(a,b){this._runGarbageCollectorOnStyles(a),this._runGarbageCollectorOnSkins(b)}.bind(this))},_runGarbageCollectorOnStyles:function(a){var b=this._findUnusedStyles(a);for(var c in b)if(b[c]){var d=b[c];this._processUnusedStyles(d)}},_findUnusedStyles:function(a){var b=Object.filter(this._styleDataMap,function(b,c){return!a.contains(c)});return b},_runGarbageCollectorOnSkins:function(a){var b=this._findUnusedSkins(a);for(var c in b){var d=this._skinDataMap[c];d&&this._removeUnusedSkinRules(d)}},_findUnusedSkins:function(a){var b=Object.filter(this._skinDataMap,function(b,c){return!a.contains(c)});return b},_processUnusedStyles:function(a){var b=a.getSkinArray(),c=a.getGroups();for(var d in c){var e=c[d];this._processUnusedStyles(e)}for(var f=0;f<b.length;f++){var g=this._skinDataMap[b[f]];g&&this._removeUnusedSkinRules(g,a.getId())}a.setStyleRenderFlag(!1)},_removeUnusedSkinRules:function(a,b){var c=a.css;if(c)for(var d=0;d<c.length;d++){b||(b="");var e=this._skinRenderer.replaceStylePlaceHolder(c[d].selector,b);this._skinRenderer.removeCssRule(e),a.CSSBuildFlags[b]=!1}}})}),define.experimentPlugin("ExperimentSkinPlugin",function(a){function b(a,b){var c=this.define.createBootstrapClassInstance("core.managers.skin.SkinDefinition"),e=this.define.createBootstrapClassInstance("bootstrap.managers.experiments.ExperimentStrategy"),f=a;return"function"==typeof a&&(f=new d,a(f)),b(c,e),f.inherits(c._extends_||f._extends_),f.utilize(e._mergeField_(f._imports_,c._imports_)),f.fields(e._mergeObjects_(f._fields_,c._fields_)),f.compParts(e._mergeField_(f._compParts_,c._compParts_)),f.skinParams(e._mergeField_(f._skinParams_,c._skinParams_)),f.html(c._html_||f._html_),f.css(e._mergeField_(f._css_,c._css_)),f.iconParams(e._mergeField_(f._iconParams_,c._iconParams_)),f.statics(e._mergeObjects_(f._statics_,c._statics_)),f}function c(a,b){define.skin(a,b)}var d,e=a;e.init("skin","newSkin",b,c)}),define.Class("core.managers.skin.GCDomTraverse",function(a){var b=a;b.methods({initialize:function(){this._usedStyles=[],this._usedSkins=[]},traverseDomAndCollectUsedStyles:function(a){this._traverseElementAndCollect($(document.body)),a(this._usedStyles,this._usedSkins)},_traverseElementAndCollect:function(a){var b=a.isDisplayed();if(b){this._collectElementStylesSkins(a);var c=a.getChildren();if(c&&c.length)for(var d=0;d<c.length;d++)this._traverseElementAndCollect(c[d])}},_collectElementStylesSkins:function(a){var b=a.getAttribute("styleId");b&&this._usedStyles.push(b);var c=a.getAttribute("skin");c&&this._usedSkins.push(c);var d=a.getLogic&&a.getLogic().getSkin&&a.getLogic().getSkin().$className;d&&this._usedSkins.include(d)}})}),define.bootstrapClass("core.managers.skin.SkinDefinition",function(){function a(){b.apply(this,arguments),this.$constructor=a,this._compParts_={},this._skinParams_=[],this._html_="",this._css_=[],this._iconParams_={}}var b=this.define.getBootstrapClass("bootstrap.managers.classmanager.ClassDefinition");return a.prototype=Object.create(b.prototype),a.extendPrototype({compParts:function(a){this._compParts_=a},skinParams:function(a){this._skinParams_=a},html:function(a){this._html_=a},css:function(a){this._css_=a},iconParams:function(a){this._iconParams_=a}}),a}),define.Class("core.managers.skin.SkinManager",function(a){var b=a;b.utilize(["core.managers.skin.SkinParser","core.managers.skin.SkinRenderer","core.managers.skin.CssGarbageCollector","bootstrap.utils.Queue"]),b.inherits("bootstrap.managers.BaseManager"),b.resources(["W.Classes","W.Theme","W.Utils","W.Experiments"]),b.binds(["_onClassReady","getSkin","buildSkinCSS","_onThemeChange","_checkThemePropChanges","_checkStylePropChanges","_onSkinDefineCallBack"]),b.methods({initialize:function(){this._SkinParserClass=this.imports.SkinParser,this._SkinRendererClass=this.imports.SkinRenderer,this._CssGarbageCollectorClass=this.imports.CssGarbageCollector,this._skinParser=new this._SkinParserClass,this._skinRenderer=new this._SkinRendererClass,this._skinQue=new this.imports.Queue,this._skinClassMap={},this._pendingSkinClassMap={},this._skinDataMap={},this._styleDataMap={},this._cssGarbageCollector=new this._CssGarbageCollectorClass(this._styleDataMap,this._skinDataMap,this._skinRenderer),this._classManager=this.resources.W.Classes,this._classManager.addClassNamespaceHook(this.getSkin),this._classManager.addClassReadyHandler(this._onClassReady),this.resources.W.Theme.addEvent("propertyChange",this._onThemeChange),this.define.skin.definitionModifier=this._onSkinDefineCallBack.bind(this)},_onSkinDefineCallBack:function(a,b){var c=this._skinQue.getQueue(a);return c&&c.length>0&&this.registerNewSkin(a,b),b},registerNewSkin:function(a,b){if(!this._isSkinRegister()){var c=this.define.getBootstrapClass("core.managers.skin.SkinDefinition"),d=new c;b(d),d=this.resources.W.Experiments.applyExperiments(a,d,"ExperimentSkinPlugin"),this._fixSkinDefinition(a,d),this._validateNewSkin(a),this._addSkinDependencies(a,d),this._pendingSkinClassMap[a]="pending",this._classManager.registerClassDefinition(a,d)}},_isSkinRegister:function(a){return this._pendingSkinClassMap[a]||this._skinDataMap[a]},_fixSkinDefinition:function(a,b){b._statics_=b._statics_||{},b._statics_._html=b._html_,b._statics_._css=b._css_,b._statics_._params=b._skinParams_,b._statics_.compParts=b._compParts_,b._statics_.iconParams=b._iconParams_},_validateNewSkin:function(a){return this._skinClassMap[a]||this._skinDataMap[a]?(LOG.reportError(wixErrors.SKIN_ALREADY_EXIST,this.className,"newSkin",a+""),void 0):void 0},_addSkinDependencies:function(a,b){var c=b._imports_||[],d=b._compParts_||{};for(var e in d){var f=d[e].skin;if(f&&c.indexOf(f)<0){var g=this.getNameOverride(f);c.push(g)}}b.utilize(c)},override:function(a,b){if(!a)throw new Error("null/undefine skin name to override: ");this.getSkin(a,function(){this._skinClassMap[a]=b}.bind(this))},getSkin:function(a,b){if(a=this.getNameOverride(a),this._skinClassMap[a])return b&&b(this._skinClassMap[a]),this._skinClassMap[a];var c=this._skinQue.hasQueue(a)===!1;if(this._skinQue.add(a,b),c){var d=this.define.getDefinition("skin"),e=nsUtil.getNameSpace(d,a);e?this.registerNewSkin(a,e):this._classManager.getClass(a,function(){})}return this._skinClassMap[a]||null},getNameOverride:function(a){return this.define.Class.$nameOverrides[a]||a},_onClassReady:function(a,b){return this._pendingSkinClassMap[a]?(this._onSkinClassReady(a,b),this._skinQue.getQueue(a).forEach(function(a){a&&a(b)}.bind(this)),void 0):(this._skinQue.removeKey(a),void 0)},_onSkinClassReady:function(a,b){var c=this._skinParser.parseSkinData(a,b);this._skinDataMap[a]=c,b.prototype.getSkinClassData=function(){return c},this._onSkinReady(b,a)},_onSkinReady:function(a,b){this._skinClassMap[b]=a,this._skinQue.getQueue(b).forEach(function(a){a&&a(this._skinClassMap[b])}.bind(this)),this._skinQue.removeKey(b)},_$getCssId:function(){return this._skinRenderer.getCssNodeId()},isReady:function(){return!this._skinQue.hasQueue()},buildSkinCSS:function(a,b){var c=this._skinDataMap[a];if(!c)return LOG.reportError(wixErrors.SKIN_MANAGER_NO_DATA_FOR_SKIN,"mobile.core.managers.SkinManager","buildSkinCSS",a),void 0;var d=this._skinRenderer.getStyleId(b);c.CSSBuildFlags[d]||b&&b.isStyleRenderedForSkin(a)||(b?(this._styleDataMap[d]=b,b.setStyleRenderFlagForSkin(a,!0)):c.CSSBuildFlags[d]=!0,this._skinRenderer.registerSkinCSSNow(c,b))},buildSkinHTML:function(a,b,c){if(!a||!b){var d=b&&b.getProperty("id");return LOG.reportError(wixErrors.SKIN_MANAGER_MISSING_ARGUMENTS,"mobile.core.managers.SkinManager","buildSkinHTML","skinName="+a+" compId="+d+"compViewNode: "+b),{}}var e=this._skinDataMap[a];return e?this._skinRenderer.buildSkinHTML(e,b,c):(LOG.reportError(wixErrors.SKIN_MANAGER_NO_DATA_FOR_SKIN,"mobile.core.managers.SkinManager","buildSkinHTML",a),{})},stylePropertiesChangedForSkin:function(a,b,c){var d=b&&b.getId();if(a&&d&&c){this._styleChangedProps||(this._styleChangedProps={}),this._styleChangedProps[a]=this._styleChangedProps[a]||{},this._styleChangedProps[a][d]=this._styleChangedProps[a][d]||{style:b,props:{}};for(var e in c)this._styleChangedProps[a][d].props[e]="";this._styleChangeCallLater||(this._styleChangeCallLater=this.resources.W.Utils.callOnNextRender(this._checkStylePropChanges,100))}},_onThemeChange:function(a){var b=a.name;b&&(this._themeChangedProps||(this._themeChangedProps={}),this._themeChangedProps[b]=a,this._themeChangeCallCallLater||(this._themeChangeCallCallLater=this.resources.W.Utils.callOnNextRender(this._checkThemePropChanges,100)))},_checkStylePropChanges:function(){var a,b,c,d,e,f,g,h;delete this._styleChangeCallLater;for(a in this._styleChangedProps){b=this._styleChangedProps[a],c=this._skinDataMap[a];for(d in b)for(e=b[d].style,f=b[d].props,g=c.css,h=0;h<g.length;++h)this._isSkinCssClassContainsPartialParams(g[h],f,"id")&&this._skinRenderer.updateSkinCSSClass(g[h].selector,g[h].rules,g[h].params,c.params,e)
}delete this._styleChangedProps},_checkThemePropChanges:function(){if(delete this._themeChangeCallCallLater,this===W.Skins)for(var a in this._skinDataMap)for(var b=this._skinDataMap[a],c=this._skinDataMap[a].css,d=0;d<c.length;++d)this._isSkinCssClassContainsPartialParams(c[d],this._themeChangedProps,"defaultTheme")&&this._skinRenderer.updateSkinCSSClass(c[d].selector,c[d].rules,c[d].params,b.params);delete this._themeChangedProps},_isSkinCssClassContainsPartialParams:function(a,b,c){var d=a.params;for(var e in b)for(var f=0;f<d.length;++f)if(d[f][c]&&d[f][c]==e)return!0;return!1},getSkinParamValue:function(a,b,c){for(var d=this._skinDataMap[a].params,e=0;e<d.length;e++){var f=d[e];if(f.id==b)return this._skinRenderer.getParamValue(f,c)}return null},getUniqueClass:function(a,b){var c=this._skinParser.getSkinCSSName(b),d=this._skinParser.getUniqueClass(a,c);return d.uniqueClass}})}),define.Class("core.managers.skin.SkinParser",function(a){var b=a;b.methods({parseSkinData:function(a,b){var c=b.prototype,d=c._params||[],e=c._html||"",f=c._css||[],g=[],h={},i={},j=this._addStylePlaceHolder(this.getSkinCSSName(a));d=this._processSkinParams(d,a);for(var k=0;k<f.length;++k){var l=f[k];if(l)this._processSkinCssClass(l,d,j,i,h,g);else{var m="";try{m=f.join(",")}catch(n){}LOG.reportError(wixErrors.SKIN_PROBLEM_WITH_RULE,this.className,"_registerSkinData",a+"("+k+") : "+m)}}return{name:a,params:d,html:e,css:g,compParts:c.compParts||{},skinPartClasses:h,skinSpecificClasses:i,skinCSSName:j,CSSBuildFlags:{},canFocus:!!c.canFocus}},getSkinCSSName:function(a){return a.replace(/\./g,"_")},_processSkinParams:function(a,b){for(var c=0;c<a.length;++c){var d=a[c];if(d.defaultParam&&(d.defaultParam=this._getParamById(a,d.defaultParam),d.defaultParam||(LOG.reportError(wixErrors.SKIN_PARAM_REF_NOT_FOUND,b,"_processSkinParams/defaultParam",d.id)(),delete d.defaultParam,d.defaultValue="")),d.sumParams){for(var e=[],f=0;f<d.sumParams.length;++f){var g=this._getParamById(a,d.sumParams[f]);g?e.push(g):LOG.reportError(wixErrors.SKIN_PARAM_REF_NOT_FOUND,b,"_processSkinParams/sumParams",d.sumParams[f])()}d.sumParams=e}}return a},_getParamById:function(a,b){for(var c=0;c<a.length;++c)if(a[c].id===b)return a[c];return null},_processSkinCssClass:function(a,b,c,d,e,f){var g=a.indexOf("{"),h=a.lastIndexOf("}");if(-1!=g&&-1!=h&&h-1>g)for(var i=a.substr(0,g),j=a.substring(g+1,h),k=this._getParamsUsed(j,b),l=i.split(","),m=0;m<l.length;++m)i=this._processSkinCssSelector(l[m],c,d,e),f.push({selector:i,rules:j,params:k})},_processSkinCssSelector:function(a,b,c,d){var e=this._convertCssSelector(a,b,c,d),f=a.length?a.charAt(0):"",g="["==f||":"==f||""===f||"{"==f||"."==f||">"==f;if(g||e==a){var h=g?"":" ";e="."+b+h+e}return e=e.trim().replace(/\s+/g," ")},_convertCssSelector:function(a,b,c,d){var e,f,g=/%(\.?[a-z0-9]+)%/i;for(e=a.match(g);e&&!(e.length<2);){f=e[1];var h=this.getUniqueClass(f,b);"class"==h.type?c[f.substring(1)]=h.uniqueClass:d[f]=h.uniqueClass,a=a.replace(g,"."+h.uniqueClass),e=a.match(g)}return a},getUniqueClass:function(a,b){var c={};if("."==a.charAt(0)){var d=a.substring(1);c.uniqueClass=b+"-c-"+d,c.type="class"}else c.uniqueClass=b+"-"+a,c.type="skinPart";return c},_getParamsUsed:function(a,b){var c=[];if(!a||!b||0===b.length)return c;for(var d=0,e=b.length;e>d;++d)-1!=a.indexOf("["+b[d].id+"]")&&(c[b[d].id]=b[d]);var f={};for(var g in c){var h=c[g];if(h.defaultParam){for(;void 0!==h.defaultParam;)h=h.defaultParam;f[h.id]=h}}return Object.values(Object.merge(c,f))},_addStylePlaceHolder:function(a){return a+Constants.skinManager.STYLE_CSS_PLACEHOLDER}})}),function(){var a=null;define.Class("core.managers.skin.SkinRenderer",function(b){var c=b;c.utilize(["core.utils.css.BorderRadius","core.utils.css.Color","core.utils.css.Size","core.utils.css.Font","core.utils.css.BoxShadow"]),c.methods({initialize:function(){this._stylesheet=this._generateSkinsStylesSheet()},replaceStylePlaceHolder:function(a,b){return a.split(Constants.skinManager.STYLE_CSS_PLACEHOLDER).join(b)},registerSkinCSSNow:function(a,b){for(var c=a.css,d=0;d<c.length;++d)this.updateSkinCSSClass(c[d].selector,c[d].rules,c[d].params,a.params,b)},updateSkinCSSClass:function(a,b,c,d,e){for(var f=this.getStyleId(e),g=0;g<c.length;++g){var h=c[g],i=h.id,j=this._getParamValue(h,e),k=this._paramValueToCss(j,h);null===k&&(k=""),b=b.split("["+i+"]").join(k)}if(a=this.replaceStylePlaceHolder(a,f),e&&e.isCssRedirectedToStyle())e.updateCssRule(a,b);else try{this._stylesheet.updateRule(a,b)}catch(l){}},getParamValue:function(a,b){return this._getParamValue(a,b)},_getParamValue:function(a,b){var c=null;if(a.defaultParam){var d=a.defaultParam;return this._applyParamMutators(this._getParamValue(d,b),a)}if(b&&b.getProperty(a.id)){var e=b.getPropertySource(a.id);return c=b.getProperty(a.id),"theme"==e&&(c=this.injects().Theme.getProperty(c)),c=this._castToType(c,a,e),c=this._addExtraToParamByType(a,c,b),this._applyParamMutators(c,a)}if(a.defaultTheme){var f=a.defaultTheme,g=W.Theme.getProperty(f);return g=this._castToType(g,a),this._applyParamMutators(g,a)}if(a.sumParams){var h=a.sumParams;if(h&&"array"==typeOf(h)&&h.length>0){var i=this._getParamValue(h[0],b);if(i.add&&"function"==typeof i.add)for(var j=1;j<h.length;j++)i.add(this._getParamValue(h[j],b));return this._applyParamMutators(i,a)}}return a.defaultValue?(c=this._castToType(a.defaultValue,a),this._applyParamMutators(c,a)):null},_castToType:function(a,b,c){switch(b.type){case Constants.SkinParamTypes.COLOR:case Constants.SkinParamTypes.COLOR_ALPHA:case Constants.SkinParamTypes.BG_COLOR:a=new this.imports.Color(a);break;case Constants.SkinParamTypes.SIZE:a=new this.imports.Size(a);break;case Constants.SkinParamTypes.BOX_SHADOW:a=new this.imports.BoxShadow(a);break;case Constants.SkinParamTypes.BORDER_RADIUS:a=new this.imports.BorderRadius(a);break;case Constants.SkinParamTypes.FONT:a=new this.imports.Font(a),c&&"value"===c&&W.Css.loadFont(a._fontFamily)}return a},_addExtraToParamByType:function(a,b,c){var d=c.getPropertyType(a.id);if("color"==d){var e=c.getPropertyExtraParamValue(a.id,"alpha");b.setAlpha(e)}return"boxShadow"==d&&b.setToggleOn(c.getPropertyExtraParamValue(a.id,"isOn")===!0),b},_applyParamMutators:function(a,b){if(b.mutators)for(var c=0;c<b.mutators.length;c+=2){var d=a[b.mutators[c]];if(d&&"function"==typeof d){var e=b.mutators[c+1];e&&"array"==typeOf(e)||(e=e?[e]:[]),a=d.apply(a,e)}else LOG.reportError(wixErrors.SKIN_PARAM_MUTATOR_FUNC_NOT_FOUND,"SkinRenderer","_applyParamMutators",d)()}return a},_paramValueToCss:function(a,b){var c=Constants.skinManager.FEATURES;if(void 0!==a&&null!==a){switch(b=b||{},b.type){case Constants.SkinParamTypes.BG_COLOR:var d=a,e=d.getAlpha();e>0?Modernizr.rgba===!0&&1>e?a="background-color:rgba("+d.getRgba()+");":(a="background-color:"+d.getHex(!1)+";",c.filter_alpha&&1>e&&(a+="filter:alpha(opacity="+100*e+");")):a="background-color:transparent;";break;case Constants.SkinParamTypes.BORDER_RADIUS:var f=W.Utils.getCSSBrowserFeature("border-radius");a=f?f+":"+a+";":"";break;case Constants.SkinParamTypes.TRANSITION:f=W.Utils.getCSSBrowserFeature("transition"),a=f?f+":"+a+";":"";break;case Constants.SkinParamTypes.BOX_SHADOW:a=W.Utils.getCSSBrowserFeature("box-shadow")?W.Utils.getCSSBrowserFeature("box-shadow")+":"+a.getCssValue()+";":"";break;case Constants.SkinParamTypes.FONT:a="font:"+a.getCssValue()+";";break;case Constants.SkinParamTypes.SIZE:a=a.getCssValue();break;case Constants.SkinParamTypes.COLOR:a=void 0!==a.getHex?a.getHex(!1):a;break;case Constants.SkinParamTypes.COLOR_ALPHA:d=a,e=d.getAlpha(),a=e>0?Modernizr.rgba===!0&&1>e?"rgba("+d.getRgba()+")":d.getHex(!1):"transparent"}return a}return null},buildSkinHTML:function(a,b,c){var d=this.getStyleId(c),e=a.html,f=this.replaceStylePlaceHolder(a.skinCSSName,d);b.empty(),b.set("html",e),b.set("styleId",d),b.set("skin",a.name),a.canFocus?b.tabIndex=0:0===b.tabIndex&&(b.tabIndex=-1),b._wixCSSName&&(b.removeClass(b._wixCSSName),delete b._wixCSSName),f&&(b.addClass(f),b._wixCSSName=f);var g=a.compParts||{},h=a.skinPartClasses||{},i=this._handleSkinParts(b,g,h,c,d);return this._handleSkinClasses(a,b,d),i},_handleSkinParts:function(a,b,c,d,e){for(var f={view:a},g=$$(a.getElements("[skinPart]")),h=0;h<g.length;++h){var i=g[h],j=i.getAttribute("skinPart");f[j]=i;var k=c[j];k&&i.addClass(this.replaceStylePlaceHolder(k,e));var l=i.getAttribute("skin");!l&&b[j]&&b[j].skin&&(l=b[j].skin,l&&i.setAttribute("skin",l))}return f},_handleSkinClasses:function(a,b,c){var d=a.skinSpecificClasses||{};for(var e in d){var f=$(b).getElements("."+e);f.removeClass(e).addClass(this.replaceStylePlaceHolder(d[e],c))}},getStyleId:function(a){return a&&a.getMapId()||""},_skinStyleNodeId:null,_generateSkinsStylesSheet:function(){return a||(a=W.Utils.createStyleSheet("WIX_SKIN_STYLES")),this._skinStyleNodeId=a.styleNode.get("id"),a},getCssNodeId:function(){return this._skinStyleNodeId},removeCssRule:function(a){this._stylesheet.removeRuleBySelector(a)}})})}(),function(){var a={},b=document.createElement("div"),c=function(c,d,e){b.style.cssText=d,a[c]=e(b)};c("filter_alpha","filter:alpha(opacity=0.9);",function(a){return void 0!==a.style.filter&&-1!=a.style.filter.indexOf("alpha")}),c("opacity","opacity:0.7;",function(a){return void 0!==a.style.opacity&&"0.7"==a.style.opacity}),c("background-color_rgba","background-color:rgba(255,0,0,0.5);",function(a){return void 0!==a.style.backgroundColor&&-1!=a.style.backgroundColor.indexOf("rgba")}),c("border-radius","border-top-right-radius:0.1em;",function(a){return void 0!==a.style.borderTopRightRadius&&-1!=a.style.borderTopRightRadius.indexOf("0.1em")}),c("-webkit-border-radius","-webkit-border-top-right-radius:0.2em;",function(a){return void 0!==a.style.webkitBorderTopRightRadius&&-1!=a.style.webkitBorderTopRightRadius.indexOf("0.2em")}),c("-moz-border-radius","-moz-border-radius-topright:0.3em;",function(a){return void 0!==a.style.MozBorderRadiusTopright&&-1!=a.style.MozBorderRadiusTopright.indexOf("0.3em")}),define.Const("skinManager",{STYLE_CSS_PLACEHOLDER:"[STYLE_PH]",FEATURES:a})}(),define.Const("SkinParamCssTypesToGeneralTypesMap",{cssBorderRadius:"radius",cssBgColor:"color",boxShadow:"boxShadow",color:"color",color_alpha:"color",cssFont:"font",size:"size",cssStr:"string",url:"url",transition:"transition"}),define.Const("SkinParamTypes",{BORDER_RADIUS:"cssBorderRadius",BG_COLOR:"cssBgColor",BOX_SHADOW:"boxShadow",COLOR:"color",COLOR_ALPHA:"color_alpha",FONT:"cssFont",SIZE:"size",OTHER:"cssStr",URL:"url",TRANSITION:"transition"}),define.Class("core.managers.style.SkinExtraParamHandler",function(a){var b=a;b.inherits("bootstrap.utils.Events"),b.statics({PROPERTY_TYPE_EXTRA_PARAMS:{color:{alpha:{prefix:"alpha",defaultValue:1,type:"number"}},boxShadow:{isOn:{prefix:"boxShadowToggleOn",defaultValue:!0,type:"boolean"}}}}),b.methods({initialize:function(a,b,c){this._properties=a,this._propertiesTypes=b,this._propertiesCounter=c},getPropertyExtraParamValue:function(a,b){var c=this._getPropertyExtraParamDefinition(a,b);if(c){var d=this._getPropertyExtraParamId(a,c.prefix);return this._convertStringToType(this._properties[d],c.type)}},_getPropertyExtraParamDefinition:function(a,b){var c=this._propertiesTypes[a],d=this._getExtraParamDefinitionByType(c,b);return d?d:(LOG.reportError(wixErrors.STYLE_EXTRA_PARAM_DEFINITION_MISSING,"SkinExtraParamHandler","_getPropertyExtraParamDefinition",c+"-"+b)(),void 0)},_getExtraParamDefinitionByType:function(a,b){return this.PROPERTY_TYPE_EXTRA_PARAMS[a]&&this.PROPERTY_TYPE_EXTRA_PARAMS[a][b]},_getPropertyExtraParamId:function(a,b){return b+"-"+a},_convertStringToType:function(a,b){switch(b){case"number":a=Number(a);break;case"boolean":a="true"===String(a).toLowerCase()}return a},setPropertyExtraParamValue:function(a,b,c){var d=this._getPropertyExtraParamDefinition(a,b);if(d){var e=this._getPropertyExtraParamId(a,d.prefix);return this._properties[e]=String(c),e}},setPropertyExtraParams:function(a,b){var c=b.type,d=this.PROPERTY_TYPE_EXTRA_PARAMS[c];if(d){var e=b.styleDefaults;for(var f in d){var g,h=d[f],i=this._getPropertyExtraParamId(a,h.prefix);g=this._properties[i]?this._properties[i]:e&&e[h.prefix]?e[h.prefix]:h.defaultValue,this._properties[i]=g,this._propertiesTypes[i]=c+"-"+f,this._increasePropertyUseCount(i)}}},_increasePropertyUseCount:function(a){this._propertiesCounter[a]?this._propertiesCounter[a]+=1:this._propertiesCounter[a]=1}})}),define.Class("core.managers.style.SkinParamMapper",function(a){var b=a;b.inherits("bootstrap.utils.Events"),b.utilize(["bootstrap.utils.BufferFunction","core.managers.style.SkinParamParser","core.managers.style.SkinParamRenderHandler"]),b.methods({initialize:function(a,b,c,d){this.SkinParserClass=this.imports.SkinParamParser,this.SkinParamRenderHandlerClass=this.imports.SkinParamRenderHandler,this._dataItem=a,this._rawData=b,this._mapId=this._dataItem.get("id")+(d?"-"+d:""),c="string"==typeof c?W.Skins.getSkin(c):c,this._skin=new c,this._initMapProperties(),this._skinParser=new this.SkinParserClass(this._dataItem,this._rawData,this._skin,this.$class),this._skinParamRenderHandler=new this.SkinParamRenderHandlerClass(this.getGroups()),this._garbageCollection(),this.resource.getResourceValue("W.Theme",function(a){a.getDataItem().on(Constants.DataEvents.DATA_CHANGED,this,this._onThemePropertiesChange)}.bind(this))},_initMapProperties:function(){this._rawData.properties=this._rawData.properties||{},this._rawData.groups=this._rawData.groups||{},this._rawData.propertiesSource=this._rawData.propertiesSource||{}},setSkin:function(a){var b=new a;return this._skin.$className==b.$className?!1:(this._skin=b,this._dataItem.set("skin",this._skin.$className),this._rawData.properties={},this._rawData.propertiesSource={},this._rawData.groups={},this._skinParser=new this.SkinParserClass(this._dataItem,this._rawData,this._skin,this.$class),this._skinParamRenderHandler=new this.SkinParamRenderHandlerClass(this.getGroups()),this.fireEvent(Constants.StyleEvents.SKIN_CHANGED),this.fireEvent(Constants.StyleEvents.READY),!0)},addDynamicProperty:function(a){this._skinParser.addProperty(a)},isDynamic:function(){return!!this._skinParser.isDynamicStyle},setDynamic:function(a){this._skin.isDynamicStyle=a,this._skinParser.isDynamicStyle=a},getSkin:function(){return this.getSkinClassName()},getSkinClassName:function(){return this._skin.$className},getSkinClass:function(){return this._skin.$class},getDataItem:function(){return this._dataItem},getPropertyExtraParamValue:function(a,b){return this._skinParser.getPropertyExtraParamValue(a,b)},setPropertyExtraParamValue:function(a,b,c,d){var e=this._skinParser.setPropertyExtraParamValue(a,b,c),f={},g={};f[e]=this._skinParser.getProperty(e),this._dataItem.fireDataChangeEvent(a,f,g),d&&this._firePropertyChangesEvent(a,f)},_onThemePropertiesChange:function(a){var b=a.data.field;for(var c in b){var d=this._skinParser.getProperties();for(var e in d)this.getPropertySource(e)==Constants.STYLE.SOURCE.THEME&&d[e]==c&&this._firePropertyChangesEvent(e)}},_firePropertyChangesEvent:function(a){this._changes||(this._changes={}),this._changes[a]=this._skinParser.getPropertyType(a),this.injects().Utils.clearCallLater(this._dispatchEventId),this._dispatchEventId=this.injects().Utils.callLater(this._dispatchChangeEventAndResetChanges,[],this,50)},_dispatchChangeEventAndResetChanges:function(){this.fireEvent(Constants.StyleEvents.PROPERTY_CHANGED,{style:this,properties:this._changes}),this._changes={}},updateCssRule:function(a,b){this._changedCssClasses||(this._changedCssClasses={}),this._changedCssClasses[a]=b,this._dispatchCssChanges()},_dispatchCssChanges:function(){this.fireEvent("cssChanged",this._changedCssClasses),this._changedCssClasses={}},setRedirectCssTarget:function(a){this._redirectCssTarget=a===!0},isCssRedirectedToStyle:function(){return this._redirectCssTarget},_garbageCollection:function(){this.setStyleRenderFlag(!1),this._skinParser.garbageCollection()},addInnerSkin:function(a,b,c){this._skinParser.parseSkinByInstance(a,b,c)},getMapId:function(){return this._mapId},getId:function(){return this._dataItem.get("id")},getProperty:function(a){return this._skinParser.getProperty(a)},setProperty:function(a,b){this._skinParser.setProperty(a,b);var c={},d={};c[a]=b,d[a]=this.getProperty(a),this._dataItem.fireDataChangeEvent(a,c,d),this._firePropertyChangesEvent(a)},getProperties:function(){return this._skinParser.getProperties()},getGroups:function(){return this._skinParser.getInnerSkins()},isPropertyAvailable:function(a){return this._skinParser.getProperty(a)?!0:!1},getPropertySource:function(a){return this._skinParser.getPropertySource(a)},getPropertyType:function(a){return this._skinParser.getPropertyType(a)},getStyleByGroupName:function(a){return this._skinParser.getInnerSkin(a)},getSkinArray:function(){return this._skinParser.getUsedSkinArray()},changePropertySource:function(a,b,c){this._skinParser.setPropertySource(a,c),this.setProperty(a,b)},getPropertyLangKey:function(a){return this._skinParser.getPropertyLangKey(a)},isStyleRenderedForSkin:function(a){return this._skinParamRenderHandler.isSkinParamRenderedForSkin(a)},isStyleRenderedForAllSkins:function(){return this._skinParamRenderHandler.isSkinParamRenderedForAllSkins()},setStyleRenderFlag:function(a){this._skinParamRenderHandler.setSkinParamRenderFlag(a)},setStyleRenderFlagForSkin:function(a,b){this._skinParamRenderHandler.setSkinParamRenderFlagForSkin(a,b)},invalidateStyle:function(){this._skinParamRenderHandler.invalidateSkinParamMapper()},resetStyleFromData:function(a,b){this._skin=new b,this._rawData=Object.clone(a),this._dataItem.set("skin",this._skin.$className),this._skinParser=new this.SkinParserClass(this._dataItem,this._rawData,this._skin,this.$class),this._skinParamRenderHandler=new this.SkinParamRenderHandlerClass(this.getGroups()),this._dataItem.set("style",a),this.fireEvent(Constants.StyleEvents.SKIN_CHANGED),this.fireEvent(Constants.StyleEvents.STYLE_CHANGED),this.fireEvent(Constants.StyleEvents.READY)},getStyleType:function(){return this._dataItem.get("styleType")},setStyleType:function(a){this._dataItem.set("styleType",a)},getIsCustomStyle:function(){return"custom"===this.getStyleType()},setIsCustomStyle:function(a){this.setStyleType(a?"custom":"system")},getCompClassName:function(){return this._dataItem.get("componentClassName")},setCompClassName:function(a){this._dataItem.set("componentClassName",a)},getPageId:function(){return this._dataItem.get("pageId")},setPageId:function(a){this._dataItem.set("pageId",a)},getCompId:function(){return this._dataItem.get("compId")},setCompId:function(a){this._dataItem.set("compId",a)},getRawData:function(){return this._rawData},getRawSkin:function(){return this._skin},getRawParams:function(){return this._skin._params}})}),define.Class("core.managers.style.SkinParamParser",function(a){var b=a;b.utilize(["core.managers.style.SkinParamSourceHandler","core.managers.style.SkinExtraParamHandler"]),b.inherits("bootstrap.utils.Events"),b.statics({STYLE_PROPERTIES_FILTER:{color:[Constants.STYLE.SOURCE.THEME],font:[Constants.STYLE.SOURCE.THEME],radius:[Constants.STYLE.SOURCE.VALUE],size:[Constants.STYLE.SOURCE.VALUE],boxShadow:[Constants.STYLE.SOURCE.VALUE]}}),b.methods({initialize:function(a,b,c,d){this._innerSkinMaps={},this._properties=b.properties||{},this._propertiesTypes={},this._propertiesCounter={},this._propertiesLangKey={},this._usedSkinNamesArray=[],this.SkinMapperClass=d;var e=this.imports.SkinParamSourceHandler,f=this.imports.SkinExtraParamHandler;this._paramSourceHandler=new e(b.propertiesSource),this._extraParamHandler=new f(this._properties,this._propertiesTypes,this._propertiesCounter),this.isDynamicStyle=c.isDynamicStyle,this._parseSkinAndData(a,b,c)},parseSkinByInstance:function(a,b,c){var d=new c;this._parseSkinAndData(a,b,d)},_parseSkinAndData:function(a,b,c){this._addUsedSkinName(c.$className),this.isDynamicStyle||(this._saveSkinParams(c.getParams()),this._parseSkinInnerComponents(a,b,c.getCompPartsDefinition(),c.imports))},_addUsedSkinName:function(a){this._usedSkinNamesArray.push(a)},_saveSkinParams:function(a){for(var b=0;b<a.length;b++)this._addProperty(a[b])},addProperty:function(a){this._addProperty(a)},_addProperty:function(a){var b=a.id,c=this._createParamDataObj(a);if("unknown"!=c.source&&!c.ignore){this._properties[b]=this._properties[b]||a.defaultTheme||a.defaultValue,this._propertiesTypes[b]=c.type,this._propertiesLangKey[b]=c.langKey;var d=this.getPropertySource(b)||c.source;this.setPropertySource(b,d),this._increasePropertyUseCount(b),this._extraParamHandler.setPropertyExtraParams(b,c)}},_createParamDataObj:function(a){var b={};a.defaultTheme?(b.source=Constants.STYLE.SOURCE.THEME,b.value=a.defaultTheme,b.type=W.Theme.getPropertyType(a.defaultTheme)):a.defaultValue&&(b.source=Constants.STYLE.SOURCE.VALUE,b.value=a.defaultValue,b.type=this._getGeneralTypeFromCssType(a.type)),b.langKey=a.lang||a.id,b.styleDefaults=a.styleDefaults||{};var c=a.noshow===!0,d=this.STYLE_PROPERTIES_FILTER[b.type],e=d&&d.contains(b.source);return b.ignore=c===!0||e!==!0,b.ignore=a.enableEdit===!0?!1:b.ignore,b},_getGeneralTypeFromCssType:function(a){return Constants.SkinParamCssTypesToGeneralTypesMap[a]||"unknown"},_increasePropertyUseCount:function(a){this._propertiesCounter[a]?this._propertiesCounter[a]+=1:this._propertiesCounter[a]=1},garbageCollection:function(){if(!this.isDynamicStyle)for(var a in this._properties)this._propertiesCounter[a]||delete this._properties[a]},_parseSkinInnerComponents:function(a,b,c,d){for(var e in c){var f=c[e].skin,g=c[e].styleGroup,h=this._findSkinByName(f,d);if(g)if("inherit"===g)this.parseSkinByInstance(a,b,h);else if(this._hasGroupInRawData(b,g)){var i=b.groups[g];this._innerSkinMaps[g]?this._innerSkinMaps[g].addInnerSkin(a,i,h):this._innerSkinMaps[g]=new this.SkinMapperClass(a,i,h,g)}}},_hasGroupInRawData:function(a,b){return a.groups&&a.groups[b]?!0:!1},_findSkinByName:function(a,b){var c=a.substring(a.lastIndexOf(".")+1),d=Object.filter(b,function(a,b){return b==c});return d[c]},getInnerSkins:function(){return this._innerSkinMaps},getInnerSkin:function(a){return this._innerSkinMaps[a]},getProperties:function(){return this._properties},getProperty:function(a){return this._properties[a]},setProperty:function(a,b){this._properties[a]=b},getPropertiesTypes:function(){return this._propertiesTypes},getPropertySource:function(a){return this._paramSourceHandler.getPropertySource(a)},setPropertySource:function(a,b){return this._paramSourceHandler.setPropertySource(a,b)},getPropertyType:function(a){return this._propertiesTypes[a]},getUsedSkinArray:function(){return this._usedSkinNamesArray},setPropertyExtraParamValue:function(a,b,c){return this._extraParamHandler.setPropertyExtraParamValue(a,b,c)},getPropertyExtraParamValue:function(a,b){return this._extraParamHandler.getPropertyExtraParamValue(a,b)},getPropertyLangKey:function(a){return this._propertiesLangKey[a]}})}),define.Class("core.managers.style.SkinParamRenderHandler",function(a){var b=a;b.methods({initialize:function(a){this._innerSkinMaps=a,this._skinParamRenderFlags={}},isSkinParamRenderedForSkin:function(a){return this._skinParamRenderFlags[a]||!1},isSkinParamRenderedForAllSkins:function(){for(var a in this._skinParamRenderFlags)if(!this._skinParamRenderFlags[a])return!1;return!0},setSkinParamRenderFlag:function(a){for(var b in this._skinParamRenderFlags)this.setSkinParamRenderFlagForSkin(b,a)},setSkinParamRenderFlagForSkin:function(a,b){this._skinParamRenderFlags[a]=b},invalidateSkinParamMapper:function(){this.setSkinParamRenderFlag(!1);for(var a in this._innerSkinMaps)this._innerSkinMaps[a].invalidateStyle()}})}),define.Class("core.managers.style.SkinParamSourceHandler",function(a){var b=a;b.methods({initialize:function(a){this._propertiesSource=a||{}},getPropertiesSource:function(){return this._propertiesSource},getPropertySource:function(a){return this._propertiesSource[a]},setPropertySource:function(a,b){this._isPropertySourceValid(b)?this._propertiesSource[a]=b:LOG.reportError(wixErrors.STYLE_PROP_SRC_UNKNOWN,"SkinParamSourceHandler","setPropertySource",b)()},_isPropertySourceValid:function(a){var b=!1;for(var c in Constants.STYLE.SOURCE)Constants.STYLE.SOURCE[c]===a&&(b=!0);return b}})}),define.Class("core.managers.style.Style",function(a){var b=a;b.inherits("core.managers.style.StyleProperties"),b.methods({initialize:function(a){this._ready=!1,a&&this._setStyleDataItem(a)},_setStyleDataItem:function(a){this._skinName=a.get("skin"),this._resetDataCollection(),a.get("style")||a.set("style",{}),this._configStyle(a.get("style"),a,this._skinName,this)},_resetDataCollection:function(){this._groupIdCounter=0;var a=this._onProcessAllSkins.bind(this);this.unprocessedSkins={map:{},size:0,add:function(a){this.map[a]?this.map[a]=1:this.map[a]++,this.size++},remove:function(b){this.map[b]&&this.map[b]--,this.size--,0===this.size&&a()}}},_onProcessAllSkins:function(){this._garbageCollection(),this._oldSkinName!=this._skinName&&this.fireEvent(Constants.StyleEvents.SKIN_CHANGED),this.fireEvent(Constants.StyleEvents.READY,this),this._ready=!0},isReady:function(){return this._ready},getNewGroupId:function(){return this._groupIdCounter=this._groupIdCounter||0,this._groupIdCounter++,this._groupIdCounter},setSkin:function(a){return this._skinName==a?!1:(this._ready=!1,this._resetUsedSkinNameArray(),this.setStyleRenderFlag(!1),this._oldSkinName=this._skinName,this._skinName=a,this._styleDataItem.set("skin",a),this._styleRawData.properties={},this._styleRawData.propertiesSource={},this._styleRawData.groups={},this._resetData(this._styleRawData.properties,this._styleRawData.propertiesSource,this._styleRawData.groups),this.createStylesAndRawData(this._styleRawData,a),!0)},getSkin:function(){return this._skinName},getId:function(){return this._styleDataItem.get("id")}})}),define.Class("core.managers.style.StyleProperties",function(a){var b=a;b.utilize(["bootstrap.utils.BufferFunction"]),b.inherits("bootstrap.utils.Events"),b.statics({STYLE_PROPERTIES_FILTER:{color:[Constants.STYLE.SOURCE.THEME],font:[Constants.STYLE.SOURCE.THEME],radius:[Constants.STYLE.SOURCE.VALUE],size:[Constants.STYLE.SOURCE.VALUE],boxShadow:[Constants.STYLE.SOURCE.VALUE]},PROPERTY_TYPE_EXTRA_PARAMS:{color:{alpha:{prefix:"alpha",defaultValue:1,type:"number"}},boxShadow:{isOn:{prefix:"boxShadowToggleOn",defaultValue:!0,type:"boolean"}}}}),b.methods({initialize:function(a,b,c,d){a&&b&&c&&d&&this._configStyle(a,b,c,d)},setRedirectCssTarget:function(a){this._redirectCssTarget=a===!0},isCssRedirectedToStyle:function(){return this._redirectCssTarget},updateCssRule:function(a,b){this._changedCssClasses[a]=b,this._dispatchCssChanges()},_dispatchCssChanges:function(){this.fireEvent("cssChanged",this._changedCssClasses),this._changedCssClasses={}},_configStyle:function(a,b,c,d){this._redirectCssTarget=!1,this._changedCssClasses={};var e=new this.imports.BufferFunction(this,"_dispatchCssChanges");e.setBufferTime(50),this._resetUsedSkinNameArray(),this.StyleClass=W.Classes.get("core.managers.style.StyleProperties"),this._isStyleRendered={},this._groupId=b.get("id")+"-"+d.getNewGroupId(),this._topLevelStyle=d,this._styleDataItem=b,this._styleRawData=a,a.properties=a.properties||{},a.propertiesSource=a.propertiesSource||{},a.groups=a.groups||{},this._resetData(a.properties,a.propertiesSource,a.groups),this._changes={},this.createStylesAndRawData(a,c),this.resource.getResourceValue("W.Theme",function(a){a.getDataItem().on(Constants.DataEvents.DATA_CHANGED,this,this._onThemePropertiesChange)}.bind(this))},_resetData:function(a,b,c){this._properties=a||{},this._propertiesSource=b||{},this._groups=c||{},this._propertiesTypes={},this._propertiesCounter={},this._propertiesLangKey={},this._groupsStyleObjects={}},_onThemePropertiesChange:function(a){var b=a.data.changeMap;for(var c in b)for(var d in this._properties)this._propertiesSource[d]==Constants.STYLE.SOURCE.THEME&&this._properties[d]==c&&this._firePropertyChangesEvent(d)},_firePropertyChangesEvent:function(a){this._changes[a]=this._propertiesTypes[a],this.injects().Utils.clearCallLater(this._dispatchEventId),this._dispatchEventId=this.injects().Utils.callLater(this._dispatchChangeEventAndResetChanges,[],this,50)},_dispatchChangeEventAndResetChanges:function(){this.fireEvent(Constants.StyleEvents.PROPERTY_CHANGED,{style:this,properties:this._changes}),this._changes={}},isStyleRenderedForSkin:function(a){return this._isStyleRendered[a]||!1},isStyleRenderedForAllSkins:function(){for(var a in this._isStyleRendered)if(!this._isStyleRendered[a])return!1;return!0},setStyleRenderFlag:function(a){for(var b in this._isStyleRendered)this.setStyleRenderFlagForSkin(b,a)},setStyleRenderFlagForSkin:function(a,b){this._isStyleRendered[a]=b},invalidateStyle:function(){this.setStyleRenderFlag(!1);for(var a in this._groupsStyleObjects)this._groupsStyleObjects[a].invalidateStyle()},get:function(a){return this._properties[a]},getStyleByGroupName:function(a){return this._groupsStyleObjects[a]},set:function(a,b){var c={},d={};c[a]=b,d[a]=this._properties[a],this._properties[a]=b,this._styleDataItem.fireDataChangeEvent(a,c,d),this._firePropertyChangesEvent(a)},changePropertySource:function(a,b,c){this._isPropertySourceValid(c)?(this._propertiesSource[a]=c,this.set(a,b)):LOG.reportError(wixErrors.STYLE_PROP_SRC_UNKNOWN,"StyleProperties","changePropertySource",c)()},_isPropertySourceValid:function(a){var b=!1;for(var c in Constants.STYLE.SOURCE)Constants.STYLE.SOURCE[c]===a&&(b=!0);return b},getPropertyExtraParamValue:function(a,b){var c=this.getPropertyType(a),d=this._getExtraParamDefinitionByType(c,b);if(!d)return LOG.reportError("STYLE_EXTRA_PARAM_DEFINITION_MISSING","StyleProperties","setPropertyExtraParamValue",c+"-"+b)(),void 0;var e=this._getPropertyExtraParamId(a,d.prefix);return this._convertStringToType(this._properties[e],d.type)},setPropertyExtraParamValue:function(a,b,c,d){var e=this.getPropertyType(a),f=this._getExtraParamDefinitionByType(e,b);if(!f)return LOG.reportError("STYLE_EXTRA_PARAM_DEFINITION_MISSING","StyleProperties","setPropertyExtraParamValue",e+"-"+b)(),void 0;var g=this._getPropertyExtraParamId(a,f.prefix);this._properties[g]=String(c);var h={},i={};h[g]=this._properties[g],this._styleDataItem.fireDataChangeEvent(a,h,i),d&&this._firePropertyChangesEvent(a,h,i)},_convertStringToType:function(a,b){switch(b){case"number":a=Number(a);break;case"boolean":a="true"===String(a).toLowerCase()}return a},_getExtraParamDefinitionByType:function(a,b){return this.PROPERTY_TYPE_EXTRA_PARAMS[a]&&this.PROPERTY_TYPE_EXTRA_PARAMS[a][b]},_getPropertyExtraParamId:function(a,b){return b+"-"+a},isPropertyAvailable:function(a){return this._propertiesTypes.hasOwnProperty(a)},createStylesAndRawData:function(a,b){this._topLevelStyle.unprocessedSkins.add(b),W.Skins.getSkin(b,function(c){this._addUsedSkinName(b);var d=new c;this._saveSkinParamsAsProperties(d.getParams()),this._parseSkinInnerComponents(a,d.getCompPartsDefinition()),this._topLevelStyle.unprocessedSkins.remove(b)}.bind(this))},_saveSkinParamsAsProperties:function(a){for(var b=0;b<a.length;b++)this._addProperty(a[b])},_addProperty:function(a){var b=a.id,c=this._getParamData(a);"unknown"==c.source||c.ignore||(this._properties[b]=this._properties[b]||a.defaultTheme||a.defaultValue,this._propertiesTypes[b]=c.type,this._propertiesSource[b]=this._propertiesSource[b]||c.source,this._propertiesLangKey[b]=c.langKey,this._increasePropertyUseCount(b),this._setPropertyExtraParams(b,c))},_parseSkinInnerComponents:function(a,b){for(var c in b){var d=b[c].skin,e=b[c].styleGroup;if(e&&"undefined"!=e.toLowerCase())if("inherit"==e)this.createStylesAndRawData(a,d);else{a.groups[e]||(a.groups[e]={properties:{},groups:{}});var f=a.groups[e];if(this._groupsStyleObjects[e])this._groupsStyleObjects[e].createStylesAndRawData(f,d);else{var g=new this.StyleClass(f,this._styleDataItem,d,this._topLevelStyle);this._groupsStyleObjects[e]=g}}}},_getParamData:function(a){var b={source:"unknown"};a.defaultTheme?(b.source=Constants.STYLE.SOURCE.THEME,b.value=a.defaultTheme,b.type=W.Theme.getPropertyType(a.defaultTheme)):a.defaultValue&&(b.source=Constants.STYLE.SOURCE.VALUE,b.value=a.defaultValue,b.type=this._getGeneralTypeFromCssType(a.type)),b.langKey=a.lang||a.id,b.styleDefaults=a.styleDefaults||{};
var c=a.noshow===!0,d=a.enableEdit===!0,e=this.STYLE_PROPERTIES_FILTER[b.type],f=e&&e.contains(b.source);return b.ignore=c===!0||f!==!0,b.ignore=d?!1:b.ignore,b},_increasePropertyUseCount:function(a){this._propertiesCounter[a]?this._propertiesCounter[a]+=1:this._propertiesCounter[a]=1},_garbageCollection:function(){for(var a in this._properties)this._propertiesCounter[a]||delete this._properties[a];this.setStyleRenderFlag(!1);for(var b in this._groupsStyleObjects)this._groupsStyleObjects[b]._garbageCollection()},_getGeneralTypeFromCssType:function(a){return Constants.SkinParamCssTypesToGeneralTypesMap[a]||"unknown"},_setPropertyExtraParams:function(a,b){var c=b.type,d=this.PROPERTY_TYPE_EXTRA_PARAMS[c];if(d){var e=b.styleDefaults;for(var f in d){var g=d[f],h=this._getPropertyExtraParamId(a,g.prefix);this._properties[h]=this._properties[h]||e[g.prefix]||g.defaultValue,this._propertiesTypes[h]=c+"-"+f,this._increasePropertyUseCount(h)}}},getId:function(){return this._groupId},getProperties:function(){return this._properties},getGroups:function(){return this._groupsStyleObjects},getPropertyType:function(a){return this._propertiesTypes[a]},getPropertySource:function(a){return this._propertiesSource[a]},getPropertyLangKey:function(a){return this._propertiesLangKey[a]},_addUsedSkinName:function(a){this._usedSkinNamesArray.push(a)},_resetUsedSkinNameArray:function(){this._usedSkinNamesArray=[]},getSkinArray:function(){return this._usedSkinNamesArray}})}),define.Const("SKIN_PARAM",{SOURCE:{THEME:"theme",VALUE:"value"}}),define.Const("STYLE",{SOURCE:{THEME:"theme",VALUE:"value"}}),define.Const("StyleEvents",{SKIN_CHANGED:"skinChange",READY:"styleReady",PROPERTY_CHANGED:"propertyChange",STYLE_CHANGED:"styleChanged"}),define.experimentPlugin("ExperimentDataThemeItemPlugin",function(a){function b(a,b){var c=this.define.createBootstrapClassInstance("bootstrap.managers.experiments.ExperimentStrategy"),d=b(c),e=c._mergeField_(a,d);return e}function c(a,b){define.dataThemeItem(a,b())}var d=a;d.init("dataThemeItem","newDataThemeItem",b,c)}),define.Class("core.managers.theme.ThemeManager",function(a){var b=a;b.inherits("core.managers.data.DataManager"),b.utilize(["core.managers.style.SkinParamMapper","bootstrap.utils.Queue","core.utils.css.BorderRadius","core.utils.css.Color","core.utils.css.Size","core.utils.css.Font","core.utils.css.BoxShadow","core.utils.css.Background"]),b.binds(["_onDataReady","_onPropChange","_updateEffectedProps"]),b.statics({INIT_STYLE_RAW_DATA:{type:"TopLevelStyle",skin:"skin-name-place-holder",style:{properties:{},groups:{}}},TEXT_STYLE_SHEET:""}),b.fields({DEFINE_NAMESPACE:"dataThemeItem",EXPERIMENT_PLUGIN_NAME:"ExperimentDataThemeItemPlugin"}),b.methods({initialize:function(){this.parent(),this.SkinParamMapperClass=this.imports.SkinParamMapper,this._placeHoldersMap={},this._isReady=!0,this._isDataReady=!1,this._styleQueue=new this.imports.Queue,this._styleCache={},this._stylesInProcess={},this._isOperating=!1,this.getDataByQuery("#THEME_DATA",this._onDataReady)},getStyle:function(a,b,c){if(this._styleCache[a])b(this._styleCache[a]);else{if(this._styleQueue.add(a,b),this._styleQueue.getQueue(a).length>1)return;var d=function(b){this._styleCache[a]=b,this._styleQueue.getQueue(a).forEach(function(a){a(b)}),this._styleQueue.removeKey(a)}.bind(this);this.isStyleAvailable(a)?this.getDataByQuery("#"+a,function(a){W.Skins.getSkin(a.get("skin"),function(b){var c=new this.SkinParamMapperClass(a,a.get("style"),b);d(c)}.bind(this))}.bind(this)):this.createStyle(a,"",c,d)}},isStyleAvailable:function(a){return this.isDataAvailable("#"+a)},invalidateStyle:function(a){this._styleCache[a]&&this._styleCache[a].invalidateStyle()},createStyle:function(a,b,c,d){this._styleCache[a]&&LOG.reportError(wixErrors.STYLE_ALREADY_EXISTS,"ThemeManager","createStyle",a);var e=Object.clone(this.INIT_STYLE_RAW_DATA);e.skin=c;var f=this.addDataItem(a,e);W.Skins.getSkin(f.get("skin"),function(a){var b=new this.SkinParamMapperClass(f,f.get("style"),a),c=b.getId();this._styleCache[c]=b,d(b)}.bind(this))},createStyleFromData:function(a,b,c,d){var e=b?b+"_":"",f=e+Date.now().toString(36);return this.createStyleFromDataWithId(a,f,c,d)},createStyleFromDataWithId:function(a,b,c,d){d=d||function(){};var e=c||a.skin,f=Object.clone(a),g=this.addDataItem(b,f),h=function(a){var b=new this.SkinParamMapperClass(g,g.get("style"),a),c=b.getId();return this._styleCache[c]=b,b}.bind(this);if(c){var i=h(c);d(i)}else W.Skins.getSkin(e,function(a){var b=h(a);d(b)}.bind(this));return b},cloneStyle:function(a,b){var c=a.getDataItem(),d=a.getSkinClass(),e=c.getData(),f=this.createStyleFromDataWithSkin(e,b,d);return f},createStyleFromDataWithSkin:function(a,b,c){var d=this.createStyleFromData(a,b,c);return this._styleCache[d]},getPropertyType:function(a){return this._data.getFieldSchema(a)?this._data.getFieldSchema(a).type:void 0},_onDataReady:function(a){var b="Theme"===a.get("type");if(b){var c=a;a=this.addDataItem(c.get("id"),{type:this._getThemeSchemaTypeName()});var d=c.get("properties");for(var e in d)a.set(e,d[e].value)}this._setData(a),this._isDataReady=!0,this.fireEvent("dataReady")},isDataReady:function(){return this._isDataReady},_getThemeSchemaTypeName:function(){return"WFlatTheme"},_setData:function(a){this._flattenData(a),this._data&&this._data.offByListener(this),this._data=a,this._data.on(Constants.DataEvents.DATA_CHANGED,this,function(a){this._onDataChanged(a.data.dataItem,a.data.field)}),this._indexAllPlaceholders(),this._data.addComponentWithInterest(this)},_flattenData:function(a){this._flattenedDataItems={};var b,c,d,e=a.getData(),f=a.getSchema(),g={};for(d in e)if("array"==typeOf(e[d])){b=d;var h=e[d],i=h.length,j=f[d].defaultItems;if(j.length>i)for(var k=i;k<j.length;k++)h.push(j[k]),i++;for(c=0;i>c;c++)g[b+"_"+c]=h[c],this._flattenedDataItems[b+"_"+c]=b}else g[d]=e[d];a.setData(g);var l={};for(d in f)if("array"==f[d].type){b=d;var m=f[d].itemType,n=f[d].defaultItems;for(c=0;c<n.length;c++)l[b+"_"+c]={type:m,"default":n[c]},this._flattenedDataItems[b+"_"+c]||(this._flattenedDataItems[b+"_"+c]=b)}else l[d]=f[d];a.setSchema(l)},_indexAllPlaceholders:function(){this._placeHoldersMap={};var a=this._data.getSchema();for(var b in a)this._updatePlaceholdersInProperty(b,this.getRawProperty(b))},_updatePlaceholdersInProperty:function(a,b,c){var d=this._getPlaceholders(b,!0),e=c?this._getPlaceholders(c,!0):{},f=Object.merge({},e,d);for(var g in f)this._placeHoldersMap[g]=this._placeHoldersMap[g]||{},d[g]&&!e[g]?this._placeHoldersMap[g][a]=a:d[g]||delete this._placeHoldersMap[g][a]},_getPlaceholders:function(a,b){for(var c=/\[([^}]+)\]/g,d=/\{([^}]+)\}|\[([^}]+)\]/g,e=b?d:c,f={},g=e.exec(a);g;){var h=g[1]||g[2];h&&(f[h]=h),g=e.exec(a)}return f},clone:function(a){var b=this.parent(a);return b},isReady:function(){return this._isReady},getProperties:function(){var a={},b=this._data.getSchema();for(var c in b)a[c]={value:this.getRawProperty(c),type:this._data.getFieldSchema(c).type};return a},getProperty:function(a,b,c){if(a===Constants.Theme.DEFAULT_STYLE_CLASS)return null;var d=this._data.get(a);if(!d)return LOG.reportError(wixErrors.THEME_MANAGER_MISSING_PROPERTY,"ThemeManager","getProperty",[a,this._data.getData(),null]),null;var e="string"===typeOf(d)?d:d.clone?d.clone():Object.clone(d),f=this._data.getFieldSchema(a);if(!f)return LOG.reportError(wixErrors.SCHEMA_MISSING_KEY,"ThemeManager","getProperty",[a,this._data.getData(),null]),null;var g=this.getPropertyType(a);if(!b&&"string"==typeOf(e)&&-1!=e.indexOf("["))for(var h in this._data.getSchema())-1!=e.indexOf("["+h+"]")&&(e=e.split("["+h+"]").join(this.getProperty(h)));if(c)return e;switch(g){case"themeUrl":return W.Config.getImagesUrl()+"/web/";case"color":return new this.imports.Color(e);case"background":return new this.imports.Background(e,this);case"font":return new this.imports.Font(e,this);case"radius":return new this.imports.BorderRadius(e);case"webThemeUrl":return W.Config.getServiceTopologyProperty("staticThemeUrlWeb")+"/"+e+"/"}return e},_onDataChanged:function(a,b){if(!this._isOperating){if(this._isOperating=!0,this._isDesktopBackgroundChange(b)&&this._isMobileBackgroundPreset()&&this._resetMobileBackground(),this._indexAllPlaceholders(),"string"==typeof b)this._updateEffectedProps(b);else for(var c in b)this._updateEffectedProps(c);this._isOperating=!1}},_isDesktopBackgroundChange:function(a){return"string"==typeof a?"siteBg"===a||"color_0"===a:!(!a.siteBg&&!a.color_0)},_isMobileBackgroundPreset:function(){var a=this._data.get("themePresets");return a&&a.mobileBg},_resetMobileBackground:function(){this._updateThemePresets("mobileBg"),this._changeMobileBackgroundValue()},_updateThemePresets:function(a){var b=this._data.get("themePresets");b||(b={}),b[a]=!1,this._data.set("themePresets",b)},_changeMobileBackgroundValue:function(){this._data.set("mobileBg","[siteBg]")},reportDataItemChangeEvent:function(a,b,c,d,e){if(this.fireEvent(Constants.DataEvents.DATA_CHANGED,[a,b,c,d]),!e&&void 0!==b&&void 0!==c&&a._data.id&&!this.injects().Utils.areObjectsEqual(b,c)){if(!d)return;this.fireEvent("undoDataChangedEvent",[a,b,c,d])}},getRawProperty:function(a){return this.getProperty(a,!0,!0)},clearOverrides:function(){this._data.reset()},getOverrides:function(){return this.getProperties()},getDataItem:function(){return this._data},setProperty:function(a,b){var c=this._data.getFieldSchema(a);if(!c)return LOG.reportError(wixErrors.SCHEMA_MISSING_KEY,"ThemeManager","setProperty",[a,this._data.getData(),null]),void 0;var d=c.type;"color"==d&&b&&b.getRgba&&(b=b.getRgba()),this._updatePlaceholdersInProperty(a,b,this.getRawProperty(a)),this._data.set(a,b),this._updateEffectedProps(a)},getPropertiesAccordingToType:function(a){var b=[],c=this._data.getSchema();for(var d in c)a==this._data.getFieldSchema(d).type&&b.push(d);return b},_onPropChange:function(a,b){var c=[a];b=b||this.getProperty(a),this.fireEvent("propertyChange",{name:a,newVal:b,type:"propertyChange"});var d=this._placeHoldersMap[a];for(var e in d)c.combine(this._onPropChange(e,this.getProperty(e)));return c},_updateEffectedProps:function(a){var b=this._onPropChange(a),c={};b.forEach(function(a){c[a]=this._data.get(a)}.bind(this)),this._data.fireDataChangeEvent(c)},getDirtyDataObjectsMap:function(){var a=this.parent();if(a&&a.THEME_DATA){a.THEME_DATA=this.createDataItem(Object.clone(a.THEME_DATA.getData()),this._getThemeSchemaTypeName());var b=a.THEME_DATA.getData();for(var c in b)if(this._flattenedDataItems&&this._flattenedDataItems[c]){var d=this._flattenedDataItems[c];b[d]||(b[d]=[]),b[d].push(b[c]),delete b[c]}}return a},getColorClassInstance:function(a){return new this.imports.Color(a)}})}),define.Const("Theme",{COLOR_PALETTE_INDEX:11,COLOR_SUB_PALETTE_SIZE:5,DEFAULT_STYLE_CLASS:"font_100"}),define.Const("ViewEvents",{ORIENTATION_CHANGE:"orientationchange"}),define.Const("ViewManager",{VIEW_MODE_SITE:"site",VIEW_MODE_EDITOR:"editor",VIEW_MODE_PREVIEW:"preview"}),define.Const("ViewerTypesParams",{TYPES:{DESKTOP:"DESKTOP",MOBILE:"MOBILE"},DOM_ID_PREFIX:{DESKTOP:"",MOBILE:"mobile_"},DOM_ID_STATIC_PREFIX:"static_",SERVER_JSON_PREFIX:{DESKTOP:"",MOBILE:"mobile"},DOC_WIDTH:{DESKTOP:980,MOBILE:320}}),define.component("core.components.BaseList",function(a){var b=a;b.inherits("mobile.core.components.base.BaseComponent"),b.binds(["_onItemReady","_onDataItemsReady","_onChildAutoSized","_onChildAutoSizedAnimation"]),b.methods({initialize:function(a,b,c){this.parent(a,b,c),this._itemClassName=c&&c.itemClassName||this._itemClassName,this._itemsNodes=[]},_renderItems:function(a,b){a=a||[],0===a.length?(this.getItemsContainer().empty(),this._onAllItemsReady()):b?this._onDataItemsReady(null,a):this._data.getDataManager().getDataByQueryList(a,function(b){this._onDataItemsReady(a,b)}.bind(this))},_createHiddenItems:function(){return!0},_createItem:function(a,b,c,d){var e=this._skin.itemSkinClassName,f=a&&a.component||this.getItemClassName();if(!e)return LOG.reportError(wixErrors.NO_SKIN,"BaseList","_createItem",{c1:this.className}),new Element("b");if(!f)return LOG.reportError(wixErrors.MISSING_METHOD,this.className,"_createItem",""),new Element("b");var g=W.Utils.getUniqueId(),h=new Element("div",{id:g});return this._getParamsToPassToItem(a,function(c){var g=a;this.injects().Data.isDataItem(a)||(g=null),this.injects().Components.createComponent(f,e,g,c,function(){b(h,!0,a,d)},void 0,void 0,h)}.bind(this)),h},getSkinElementByIndex:function(a){var b=this.getItemsContainer().getChildren();return b[a]},_getParamsToPassToItem:function(a,b){b(void 0)},_onItemReady:function(){},_onAllItemsReady:function(){},getItemClassName:function(){return this._itemClassName},getItemsContainer:function(){return this._view},_onChildAutoSizedAnimation:function(){this.fireEvent("autoSizedAnimation")},_onChildAutoSized:function(){this.fireEvent("autoSized")},_onDataItemsReady:function(a,b){var c=this._itemsNodes||[];this._itemsNodes=[],this.getItemsContainer().empty();var d,e,f,g=[],h=0,i=function(a,b,c,d){if(a){var e=a.getLogic();this.fireEvent("itemReady",[e,e.getDataItem(),b]),e.addEvent("autoSizedAnimation",this._onChildAutoSizedAnimation),e.addEvent("autoSized",this._onChildAutoSized),this._onItemReady(e,b,c)}if(++h>=d){var f=this._itemsNodes.clean();f.length>1&&(f[0].addClass("firstItem"),f[f.length-1].addClass("lastItem")),this._itemsNodes=f,this._onAllItemsReady()}}.bind(this),j=this.getItemsContainer(),k=function(a,b,d){if(!this._createHiddenItems()&&a.getMeta("isHidden"))return i(null,!1,a,d),void 0;for(var e,f=(this.injects().Data,0);f<c.length;++f){var g=c[f];if(g&&g.getLogic&&a===g.getLogic().getDataItem()){e=g,c.splice(f,1);break}}e?i(e,!1,a,d):e=this._createItem(a,i,b,d),this._itemsNodes[b]=e,e.removeClass("firstItem").removeClass("lastItem"),e.insertInto(j)}.bind(this);if(a)for(e=0,d=a.length;d>e;++e)f=b[a[e]],k(f,e,d);else for(e=0,d=b.length;d>e;++e)f=b[e],k(f,e,d);g.length>1&&(g[0].addClass("firstItem"),g[g.length-1].addClass("lastItem"))},_disposeItems:function(a){if(a)for(var b=a.length-1;b>=0;--b){var c=a[b],d=c.getLogic&&c.getLogic();d&&(this._disposeItem(d),d.dispose())}},_disposeItem:function(){}})}),define.component("core.components.BaseRepeater",function(a){var b=a;b.inherits("mobile.core.components.base.BaseComponent"),b.statics({repeaterStates:{INITIATE:"init",LOADING:"loading",READY:"ready"}}),b.fields({_elementPool:[],_usedElementPool:[],_stillLoading:!1}),b.methods({_onDataChange:function(){this._allRepeatersReady=!1,this.parent()},_setSkinPartElements:function(a){this._allRepeatersReady=!1,this.parent(a)},_prepareForRender:function(){return this._data&&0!==this._data.length?(this._allRepeatersReady===!1&&(this._repeaterDefinitions=this._getRepeaterDefinitions(),this._startRepeaterCreations()),this._allRepeatersReady):!0},_getRepeaterDefinitions:function(){var a=[];for(var b in this._skinPartsSchema)if(this._skinPartsSchema[b].repeater&&this._skinPartsSchema[b].autoCreate!==!1){var c=this.getSkinPartDefinition(b);c.hookMethod&&"function"==typeOf(this[c.hookMethod])&&(c=this[c.hookMethod](c)),a.push(c)}return a},_startRepeaterCreations:function(){if(!this._stillLoading){this._usedElementPool=[],this._beforeRepeatersCreation(),this._repeatersDataOld=this._repeatersData,this._repeatersData={},this._stillLoading=!0;for(var a=0;a<this._repeaterDefinitions.length;++a){var b=this._repeaterDefinitions[a],c={};this._repeatersData[b.id]=c,c.definition=b,c.pendingItems=[],c.readyItems=[],c.readyItemsLogic=[],c.state=this.repeaterStates.INITIATE,this._loadRepeater(c)}this._checkIfRepeatersReady()}},_checkIfRepeatersReady:function(){for(var a in this._repeatersData){var b=this._repeatersData[a];if(b.state!=this.repeaterStates.READY)return!1}return!0},_loadRepeater:function(a){if(a.definition.autoCreate!==!1){var b=function(b,c){this._onLoadRepeaterReady(b,c,a)}.bind(this),c=this._getRepeaterContainer(a);c&&c.empty();var d,e=this._getRepeaterDataList(a.definition);if(e=this._processDataRefs(e),a.itemsAmount=e.length,e.length>0)for(var f=0;f<e.length;++f)d=Object.clone(a.definition),d.dataQuery=this._getDataQueryField(a.definition,e[f]),this._createRepeaterItem(d,a,c,b);else this._disposeOldRepeaters(),this._onRepeaterReady(a),this._stillLoading=!1,this._allRepeatersReady=!0,this._renderIfReady()}else a.state=this.repeaterStates.READY},_getDataQueryField:function(a,b){return a.repeaterDataQueryField?b.get(a.repeaterDataQueryField):b},_onLoadRepeaterReady:function(a,b,c){var d=!b,e=a.getViewNode(),f=c.pendingItems.indexOf(e),g=a.getDataItem();c.pendingItems.splice(f,1),c.readyItems.push(e),c.readyItemsLogic.push(a),c.definition.hideHidden&&g.getMeta("isHidden")&&e.collapse(),this._onRepeaterItemReady(c,a,g,d),c.readyItems.length==c.itemsAmount&&(c.state=this.repeaterStates.READY,this._checkIfRepeatersReady()&&(this._disposeOldRepeaters(),this._onRepeaterReady(c),this._stillLoading=!1,this._allRepeatersReady=!0,this._renderIfReady()))},_disposeOldRepeaters:function(){var a=[];this._elementPool.forEach(function(b){this._usedElementPool.contains(b)?a.push(b):b.getLogic().dispose()}.bind(this)),this._elementPool=a},_processDataRefs:function(a){return a},_createRepeaterItem:function(a,b,c,d){var e=this._getOldRepeaterItemMatchingDefinition(b.definition.id,a);if(e){c&&a.moveOldItemsToContainer!==!1&&e.insertInto(c),this._usedElementPool.push(e);var f,g,h=e.getLogic(),i=h.getSkin(),j=!1;if(a.styleGroup&&this._style&&(f="inherit"==a.styleGroup?this._style:this._style.getStyleByGroupName(a.styleGroup),g=i.getStyle(),j=f!==g),j){var k=function(){h.removeEvent(Constants.ComponentEvents.READY_FOR_RENDER,k),d(h,!0)};h.addEvent(Constants.ComponentEvents.READY_FOR_RENDER,k),i.applyStyle(f)}else d(h,!0)}else{var l=new Element("div");this._elementPool.push(l),this._usedElementPool.push(l),l.repeaterDefinition=a,b.pendingItems.push(l),c&&l.insertInto(c),this._createComponentbyDefinition(a,l,d)}},_getOldRepeaterItemMatchingDefinition:function(a,b){if(this._repeatersDataOld)for(var c=this._repeatersDataOld[a].readyItems,d=0;d<c.length;++d){var e=c[d].repeaterDefinition;if(e.skin==b.skin&&e.dataQuery===b.dataQuery)return c.splice(d,1)[0]}return null},_getRepeaterContainer:function(a){var b=a.definition.container;return b&&this._skinParts[b]?this._skinParts[b]:null},_getRepeaterDataList:function(a){if(a.dataRefList)return a.dataRefList;if(a.dataRefField){var b=[];return"*"!=a.dataRefField&&(b=this._data.get(a.dataRefField)),b}return a.inlineDataField?this._data.get(a.inlineDataField):void 0},dispose:function(){this._elementPool.forEach(function(a){a.getLogic().dispose()}),this._elementPool=[],this.parent()},_beforeRepeatersCreation:function(){},_onRepeaterItemReady:function(){},_onRepeaterReady:function(){}})}),define.component("core.components.Button",function(a){var b=a;b.inherits("mobile.core.components.base.BaseComponent"),b.states(["up","over","selected","pressed"]),b.binds(["_onClick","_onOver","_onOut","_onMouseDown","_onMouseUp","render"]),b.dataTypes(["","Button"]),b.skinParts({icon:{type:"htmlElement",optional:"true"},label:{type:"htmlElement"}}),b.fields({_triggers:["click"],_canFocus:!0,_toggleMode:!1,_disabled:!1,_iconSrc:"",_tmpCommand:null,_tmpCommandParameter:null}),b.methods({initialize:function(a,b,c){this.parent(a,b,c),c=c||{};var d=_.clone(c);d.label=c.label||b.getAttribute("label"),this.setParameters(d),c.shouldRenderOnDisplay&&this.startRenderingComponentOnDisplay()},startRenderingComponentOnDisplay:function(){this._renderTriggers.indexOf(Constants.DisplayEvents.DISPLAY_CHANGED)<0&&this._renderTriggers.push(Constants.DisplayEvents.DISPLAY_CHANGED)},_onDataChange:function(a,b,c){a&&(this._label=a.get("label")||this._label,this._toggleMode=a.get("toggleMode")||this._toggleMode,this._disabled=a.get("disabled")||this._disabled,this._iconSrc=a.get("iconSrc")||this._iconSrc,this._tmpCommand=a.get("command")||this._tmpCommand,this._tmpCommandParameter=a.get("commandParameter")||this._tmpCommandParameter),this.parent(a,b,c)},render:function(){this._setPreDefinedCommand(),this._skinParts.label.set("html",this._label||""),this._skinParts.icon&&(this._iconSrc?(this._skinParts.icon.setStyle("background","url("+this._iconSrc+") no-repeat 50% 50%"),this._skinParts.icon.uncollapse()):(this._skinParts.icon.setStyle("background",""),this._skinParts.icon.collapse()))},_setPreDefinedCommand:function(){this._tmpCommand&&this.setCommand(this._tmpCommand,this._tmpCommandParameter),this._tmpCommand=null,this._tmpCommandParameter=null},_onEnabled:function(){var a=this._skinParts.view;a.addEvent(Constants.CoreEvents.CLICK,this._onClick),a.addEvent(Constants.CoreEvents.MOUSE_OVER,this._onOver),a.addEvent(Constants.CoreEvents.MOUSE_OUT,this._onOut),a.addEvent(Constants.CoreEvents.MOUSE_DOWN,this._onMouseDown),a.addEvent(Constants.CoreEvents.MOUSE_UP,this._onMouseUp)},_onDisabled:function(){var a=this._skinParts.view;a.removeEvent(Constants.CoreEvents.CLICK,this._onClick),a.removeEvent(Constants.CoreEvents.MOUSE_OVER,this._onOver),a.removeEvent(Constants.CoreEvents.MOUSE_OUT,this._onOut),a.removeEvent(Constants.CoreEvents.MOUSE_DOWN,this._onMouseDown),a.removeEvent(Constants.CoreEvents.MOUSE_UP,this._onMouseUp)},setLabel:function(a){this._label=a,this._renderIfReady()},setIcon:function(a){this._iconSrc=a,this._renderIfReady()},setTextContent:function(a){this.setLabel(a)},setToggleMode:function(a){this._toggleMode=a},setDisabled:function(a){this._disabled=!!a,this._renderIfReady()},setParameters:function(a){a=a||{},this._label=a.label||this._label,this._toggleMode=a.toggleMode||this._toggleMode,this._disabled=a.disabled||this._disabled,this._iconSrc=a.iconSrc||this._iconSrc,this._tmpCommand=a.command||this._tmpCommand,this._tmpCommandParameter=a.commandParameter||this._tmpCommandParameter,this._renderIfReady()},getLabel:function(){return this._label},toggleSelected:function(a){var b=!1;"undefined"!=typeof a?b=a:this.getState().contains("selected")||(b=!0),b?this.setState("selected"):this.removeState("selected")},_onClick:function(a){if(this.isEnabled()&&(this._command||(a=a||{},a.target=this.getViewNode(),this.fireEvent(Constants.CoreEvents.CLICK,a)),this._toggleMode)){var b=this.getState().contains("selected")?"over":"selected";this.setState(b)}},_onOver:function(a){this.isEnabled()&&!this.getState().contains("selected")&&(this.fireEvent("over",a),this.setState("over"))},_onOut:function(a){this.isEnabled()&&!this.getState().contains("selected")&&(this.fireEvent("up",a),this.setState("up"))},_onMouseDown:function(){this.isEnabled()&&!this.getState().contains("selected")&&this.setState("pressed")},_onMouseUp:function(){this.removeState("pressed")}})}),define.component("core.components.Container",function(a){var b=a;b.inherits("core.components.base.BaseComp"),b.skinParts({inlineContent:{type:"htmlElement"}}),b.fields({EDITOR_META_DATA:{general:{settings:!0,design:!0},mobile:{allInputsHidden:!0}},_allowDragChildren:!0}),b.statics({Z_INDEX_CHANGE_TYPES:{BACK:"BACK",FORWARD:"FORWARD",TOP:"TOP",BOTTOM:"BOTTOM"},IS_CONTAINER:!0}),b.states({displayDevice:["desktopView","mobileView"]}),b.methods({initialize:function(a,b,c){c&&null!=c.allowDragChildren&&(this._allowDragChildren=c.allowDragChildren),this.parent(a,b,c),this.setMaxH(8e3)},_onRender:function(a){var b=a.data.invalidations;b.isInvalidated([this.INVALIDATIONS.FIRST_RENDER])&&(this._isMobileView=W.Config.env.getCurrentFrameDevice()===Constants.ViewerTypesParams.TYPES.MOBILE,this._isMobileView&&(this.setState("mobileView","displayDevice"),this.setMaxH(24e3)))},getShowOnAllPagesChangeability:function(){if(!this._showOnAllPagesChangeability)return!1;for(var a=this.getChildComponents(),b=0;b<a.length;b++)if(!a[b].$logic.getShowOnAllPagesChangeability())return!1;return!0},getInlineContentContainer:function(){return this._skinParts.inlineContent?this._skinParts.inlineContent:this._view},getChildren:function(){return this.getInlineContentContainer().getChildren()},addChild:function(a){var b,c=a.getParentComponent();c&&(b=c.getChildComponents().map(function(a){return a.getLogic().getComponentId()})),a.getViewNode().insertInto(this.getInlineContentContainer()),c&&this._reportComponentsZOrderChanged(a,c,b),this.moveChild(a,this.Z_INDEX_CHANGE_TYPES.TOP),this._setPageIdToComponent(a),this._setDomLevelToComponent(a)},moveChildFromIndexToIndex:function(a,b,c){var d=this.getChildComponents().map(function(a){return a.getLogic().getComponentId()});W.Utils.setChildIndex(this.getInlineContentContainer(),b,c),this._reportComponentsZOrderChanged(a,this,d)},_reportComponentsZOrderChanged:function(a,b,c){var d=b.getChildComponents().map(function(a){return a.getLogic().getComponentId()}),e={subType:"explicitZOrderChange",changedComponentIds:[a.getComponentId()],oldState:{children:c},newState:{children:d}};this.injects().Commands.executeCommand("WViewerCommands.ComponentZIndexChanged",{editedComponent:a,urmData:e})},removeChild:function(a){var b=a.getViewNode?a.getViewNode():a;this.getInlineContentContainer().removeChild(b)},canMoveForward:function(a){var b=this.getChildren(),c=b.indexOf(a.getViewNode());return-1==c?!1:c<b.length-1},canMoveBack:function(a){var b=this.getChildren().indexOf(a.getViewNode());return-1==b?!1:b>0},moveChild:function(a,b){var c,d=this.getChildren(),e=this._getChildIndex(a);switch(b){case this.Z_INDEX_CHANGE_TYPES.BACK:c=e-1;break;case this.Z_INDEX_CHANGE_TYPES.FORWARD:c=e+1;break;case this.Z_INDEX_CHANGE_TYPES.BOTTOM:c=0;break;case this.Z_INDEX_CHANGE_TYPES.TOP:c=d.length-1}this.moveChildFromIndexToIndex(a,e,c)},_getChildIndex:function(a){var b=this.getChildren(),c=a.getViewNode();return b.indexOf(c)},hasChildren:function(){return!0},isContainer:function(){return this._allowDragChildren},getChildComponents:function(){return this.getInlineContentContainer().getChildren("[comp]")},getContainerComponents:function(a){for(var b=this.getChildComponents(),c=0;c<b.length;c++){var d=b[c].getLogic();a.push(d),d.IS_CONTAINER&&a.concat(d.getContainerComponents(a))}return a},getDescendantComponents:function(){return this.getDescendantComponentsRecurse(this,[])},getDescendantComponentsRecurse:function(a,b){for(var c=a.getChildComponents(),d=0;d<c.length;d++)b.push(c[d]),c[d].getLogic&&c[d].getLogic().getChildComponents&&this.getDescendantComponentsRecurse(c[d].getLogic(),b);return b},disposeChildren:function(){for(var a=this.getChildren(),b=0;b<a.length;b++)a[b].getLogic&&a[b].getLogic().dispose()},dispose:function(){this.disposeChildren(),this.parent()},_setPageIdToComponent:function(a){var b,c=a.$view.$pageId,d=a.$isPage?a.getComponentId():this.$view.$pageId;c!==d&&(a.$view.$pageId=d,a.trigger(Constants.ComponentEvents.PAGE_ID_CHANGED,{comp:a,oldPageId:c,pageId:d}),a.isContainer()&&(b=a.getChildComponents(),_.forEach(b,function(b){a._setPageIdToComponent(b.$logic)})))},_setDomLevelToComponent:function(a){var b,c=a.$view.$domLevel,d=this.$view.$domLevel+1;c!==d&&(a.$view.$domLevel=d,a.isContainer()&&(b=a.getChildComponents(),_.forEach(b,function(b){a._setDomLevelToComponent(b.$logic)})))}})}),define.component("core.components.ContainerOBC",function(a){var b=a;b.inherits("mobile.core.components.base.BaseComponent"),b.skinParts({inlineContent:{type:"htmlElement"}}),b.fields({EDITOR_META_DATA:{general:{settings:!0,design:!0},mobile:{allInputsHidden:!0}},_allowDragChildren:!0}),b.statics({Z_INDEX_CHANGE_TYPES:{BACK:"BACK",FORWARD:"FORWARD",TOP:"TOP",BOTTOM:"BOTTOM"},IS_CONTAINER:!0}),b.states({displayDevice:["mobileView"]}),b.methods({initialize:function(a,b,c){c&&null!=c.allowDragChildren&&(this._allowDragChildren=c.allowDragChildren),this.parent(a,b,c),this.setMaxH(8e3),this._isMobileView=W.Config.env.getCurrentFrameDevice()===Constants.ViewerTypesParams.TYPES.MOBILE,this._isMobileView&&(this.setState("mobileView","displayDevice"),this.setMaxH(24e3))},getShowOnAllPagesChangeability:function(){if(!this._showOnAllPagesChangeability)return!1;for(var a=this.getChildComponents(),b=0;b<a.length;b++)if(!a[b].$logic.getShowOnAllPagesChangeability())return!1;return!0},getInlineContentContainer:function(){return this._skinParts.inlineContent?this._skinParts.inlineContent:this._view},getChildren:function(){return this.getInlineContentContainer().getChildren()},addChild:function(a){var b,c=a.getParentComponent();c&&(b=c.getChildComponents().map(function(a){return a.getLogic().getComponentId()})),a.getViewNode().insertInto(this.getInlineContentContainer()),c&&this._reportComponentsZOrderChanged(a,c,b),this.moveChild(a,this.Z_INDEX_CHANGE_TYPES.TOP),this._setPageIdToComponent(a),this._setDomLevelToComponent(a)},moveChildFromIndexToIndex:function(a,b,c){var d=this.getChildComponents().map(function(a){return a.getLogic().getComponentId()});W.Utils.setChildIndex(this.getInlineContentContainer(),b,c),this._reportComponentsZOrderChanged(a,this,d)},_reportComponentsZOrderChanged:function(a,b,c){var d=b.getChildComponents().map(function(a){return a.getLogic().getComponentId()}),e={subType:"explicitZOrderChange",changedComponentIds:[a.getComponentId()],oldState:{children:c},newState:{children:d}};this.injects().Commands.executeCommand("WViewerCommands.ComponentZIndexChanged",{editedComponent:a,urmData:e})},removeChild:function(a){var b=a.getViewNode?a.getViewNode():a;this.getInlineContentContainer().removeChild(b)},canMoveForward:function(a){var b=this.getChildren(),c=b.indexOf(a.getViewNode());return-1==c?!1:c<b.length-1},canMoveBack:function(a){var b=this.getChildren().indexOf(a.getViewNode());return-1==b?!1:b>0},moveChild:function(a,b){var c,d=this.getChildren(),e=this._getChildIndex(a);switch(b){case this.Z_INDEX_CHANGE_TYPES.BACK:c=e-1;break;case this.Z_INDEX_CHANGE_TYPES.FORWARD:c=e+1;break;case this.Z_INDEX_CHANGE_TYPES.BOTTOM:c=0;break;case this.Z_INDEX_CHANGE_TYPES.TOP:c=d.length-1}this.moveChildFromIndexToIndex(a,e,c)},_getChildIndex:function(a){var b=this.getChildren(),c=a.getViewNode();return b.indexOf(c)},hasChildren:function(){return!0},isContainer:function(){return this._allowDragChildren},getChildComponents:function(){return this.getInlineContentContainer().getChildren("[comp]")},getContainerComponents:function(a){for(var b=this.getChildComponents(),c=0;c<b.length;c++){var d=b[c].getLogic();a.push(d),d.IS_CONTAINER&&a.concat(d.getContainerComponents(a))}return a},getDescendantComponents:function(){return this.getDescendantComponentsRecurse(this,[])},getDescendantComponentsRecurse:function(a,b){for(var c=a.getChildComponents(),d=0;d<c.length;d++)b.push(c[d]),c[d].getLogic&&c[d].getLogic().getChildComponents&&this.getDescendantComponentsRecurse(c[d].getLogic(),b);return b},disposeChildren:function(){for(var a=this.getChildren(),b=0;b<a.length;b++)a[b].getLogic&&a[b].getLogic().dispose()},dispose:function(){this.disposeChildren(),this.parent()},_setPageIdToComponent:function(a){var b,c=a.$view.$pageId,d=a.$isPage?a.getComponentId():this.$view.$pageId;c!==d&&(a.$view.$pageId=d,a.trigger(Constants.ComponentEvents.PAGE_ID_CHANGED,{comp:a,oldPageId:c,pageId:d}),a.isContainer()&&(b=a.getChildComponents(),_.forEach(b,function(b){a._setPageIdToComponent(b.$logic)})))},_setDomLevelToComponent:function(a){var b,c=a.$view.$domLevel,d=this.$view.$domLevel+1;c!==d&&(a.$view.$domLevel=d,a.isContainer()&&(b=a.getChildComponents(),_.forEach(b,function(b){a._setDomLevelToComponent(b.$logic)})))}})}),define.component("core.components.Image",function(a){var b=a;b.utilize(["core.components.image.ImageDimensions","core.components.image.ImageUrl"]),b.inherits("mobile.core.components.base.BaseComponent"),b.states(["loading","loaded"]),b.binds(["_onImageLoaded","_onOrientationChange"]),b.dataTypes(["Image",""]),b.statics({unitOptions:{EM:"em",PX:"px",PERCENT:"%"}}),b.skinParts({image:{type:"htmlElement"}}),b.fields({_renderTriggers:[Constants.DisplayEvents.DISPLAY_CHANGED],_invalidProps:{}}),b.methods({initialize:function(a,b,c){this._initGlobalResources(),this.parent(a,b,c),this.lockRefresh(),this._imageDimensions=new this.imports.ImageDimensions,this._imageUrl=new this.imports.ImageUrl,this._setParametersToDefaults(),this._initializeParametersFromArgs(c),this._requestExactSize=this._globals.config&&!this._globals.config.env.$isEditorViewerFrame
},_initGlobalResources:function(){this._globals={};var a=this.injects();this._globals.viewer=a.Viewer,this._globals.utils=a.Utils,this._globals.config=a.Config},_setParametersToDefaults:function(){this._sizeOfComponentInPx={x:0,y:0},this._units={x:this.unitOptions.PERCENT,y:this.unitOptions.PERCENT},this._sizeOfComponentInUnits={x:100,y:100},this._uri=""},_initializeParametersFromArgs:function(a){a=a||{},this.setCropMode(a.cropMode),this.setAlign(a.align,a.valign),this._passedUnit=this._isValueInObject(this.unitOptions,a.unit)?a.unit:null,this.setSize(a.width,a.height),this._renderDelay=a.renderDelay||1,this._useWebUrl=a.useWebUrl||!1,this._imageUrl.setFetchImageForMobile(a.fetchImageForMobile||!1)},_onOrientationChange:function(){setTimeout(this.refresh.bind(this,!0),50)},render:function(){this.unLockRefresh(),0===this._renderDelay?this.refresh(!0):this._globals.utils.callLater(this.refresh,[!0],this,this._renderDelay)},_needsRender:function(){var a=this._data&&this._data.get("uri")&&this._uri!==this._data.get("uri"),b=this._getComponentSizeInPx();return a?!0:b?this._sizeOfComponentInPx.x!=b.x||this._sizeOfComponentInPx.y!=b.y||this._isPropInvalid("size")||this._isPropInvalid("cropMode"):!1},_onAllSkinPartsReady:function(){this._skinParts.image.setStyle("position","absolute"),this._skinParts.view.setStyles({position:"relative",overflow:"hidden"})},lockRefresh:function(){this._isLock=!0},unLockRefresh:function(){this._isLock=!1},refresh:function(a){(a||this._needsRender())&&(0===this._renderDelay?this._onRefresh(a):this._globals.utils.callLater(this._onRefresh,[a],this,this._renderDelay))},_setNewImage:function(a,b){this._loadStart=LOG.getSessionTime(),this._getImagesPerformance().started++,(!a.isSameImage||a.isSameImageWithBiggerPyramidSize)&&this.setState("loading"),this._skinParts.image.addEvent("load",this._onImageLoaded),this._skinParts.image.removeEvents("error"),this._skinParts.image.addEvent("error",this._onImageError.bind(this,b)),this._skinParts.image.set("src",b)},_onRefresh:function(a){if(!(this._isDisposed||this._isLock&&!a)&&this._data){this._skinParts.image.set("alt",this._data.get("alt"));var b=this._getImageDimensionsAndSetCompSize(a),c=this._validateImageDimensions(b);if(c){var d={isSameImage:null,isSameImageWithBiggerPyramidSize:null},e=this._getImageFullUrl(b.imageRequestSize,d);this.fireEvent("loading",{url:e,imgWidth:b.imageObjectSize.x,imgHeight:b.imageObjectSize.y,requestSize:this._pyramidRequestSize,imgX:b.imagePosition.x,imgY:b.imagePosition.y}),this._skinParts.image.setStyles({width:b.imageObjectSize.x+"px",height:b.imageObjectSize.y+"px",top:b.imagePosition.y+"px",left:b.imagePosition.x+"px"}),e!==this._skinParts.image.get("src")?this._setNewImage(d,e):this._moveImageToBackground()}else this._globals.utils.callLater(this._renderIfReady,[],this,50);this._validate()}},_validateImageDimensions:function(a){if(!a||!a.imageRequestSize)return!1;var b=a.imageRequestSize,c=0===b.x||0===b.y;return c?this._isLastImageRequestZero=!0:(this._isLastImageRequestZero&&LOG.reportError(wixErrors.IMG_VALID_SIZE_AFTER_ZERO,this.$className,"_validateImageDimensions",this._data.get("uri")),this._isLastImageRequestZero=!1),!c},_getImageDimensionsAndSetCompSize:function(a){var b=null,c=parseInt(this._data.get("width"),10),d=parseInt(this._data.get("height"),10);if(c||d||(c=d=128),a||this._isPropInvalid("size")){var e=this._getComponentSizeInUnits();this._skinParts.view.setStyles({width:e.x,height:e.y})}return(a||this._isPropInvalid("size")||this._isPropInvalid("cropMode"))&&(this._sizeOfComponentInPx=this._getComponentSizeInPx(),b=this._imageDimensions.getDimensionsForContainerSize({x:c,y:d},this._sizeOfComponentInPx,this._isGIF())),b},_getImageFullUrl:function(a,b){var c,d,e,f=this._uri;return this._uri=this._data.get("uri"),b.isSameImage=f===this._uri,e=this._uri.test(/(^https?)|(^http?)|(^data)/),this._useWebUrl||e?c=this._uri:this._isGIF()?c=this._imageUrl.getImageUrlExactSize(this._getOriginalSizeFromData(),this._uri,this._getOriginalSizeFromData()):this._isICO()?c=this._imageUrl.getBaseImageUrl(this._uri):this._requestExactSize?c=this._imageUrl.getImageUrlExactSize(a,this._uri,this._getOriginalSizeFromData()):(d=this._imageUrl.getImageUrlFromPyramid(a,this._uri,b.isSameImage,this._pyramidRequestSize),c=d.url,b.isSameImageWithBiggerPyramidSize=b.isSameImage&&d.pyramidRequestSize>this._pyramidRequestSize,this._pyramidRequestSize=d.pyramidRequestSize),c},_getOriginalSizeFromData:function(){return{x:this._data.get("width"),y:this._data.get("height")}},_isGIF:function(){return this._data.get("uri").test(/(\.gif$)/)},_isICO:function(){return this._data.get("uri").test(/(\.ico$)/)},_onImageLoaded:function(){this._handleLoadEnd(!1);var a=window.Browser.ie7?7e3:1;this.callLater(this._validateResultImageSize,[],a),this.setState("loaded"),this._moveImageToBackground(),this._view.fireEvent(Constants.ComponentEvents.DOM_DISPLAY_READY),this._renderIfReady()},_validateResultImageSize:function(){this._renderIfReady()},_moveImageToBackground:function(){var a=this._skinParts.image;if(0!==this._sizeOfComponentInPx.x&&0!==this._sizeOfComponentInPx.y&&Modernizr.backgroundsize){var b=this._globals.utils.getCSSBrowserFeature("backgroundSize"),c={};c["background-image"]="url('"+a.get("src")+"')",c[b]=a.getStyle("width")+" "+a.getStyle("height"),c["background-position"]=parseInt(a.getStyle("left"),10)+"px "+parseInt(a.getStyle("top"),10)+"px",c["background-repeat"]="no-repeat",this._skinParts.view.setStyles(c),a.setStyles({visibility:"hidden"})}},_onImageError:function(a){this._handleLoadEnd(!0),LOG.reportError(wixErrors.IMAGE_LOAD_ERROR,"Image","refresh",a),this._renderIfReady()},_getComponentSizeInUnits:function(){return{x:this._sizeOfComponentInUnits.x+this._units.x,y:this._sizeOfComponentInUnits.y+this._units.y}},_getComponentSizeInPx:function(){return null!==this._skinParts?this._units.x!==this.unitOptions.PX||this._units.y!==this.unitOptions.PX?this._skinParts.view.getSize():{x:Number(this._sizeOfComponentInUnits.x),y:Number(this._sizeOfComponentInUnits.y)}:void 0},_invalidate:function(a){switch(typeOf(a)){case"string":this._invalidProps[a]="invalid";break;case"array":for(var b=0;b<a.length;++b)this._invalidProps[a[b]]="invalid"}},_validate:function(a){switch(typeOf(a)){case"string":delete this._invalidProps[a];break;case"array":for(var b=0;b<a.length;++b)delete this._invalidProps[a[b]];break;default:this._invalidProps={}}},_isPropInvalid:function(a){return Boolean(this._invalidProps[a])},isDomDisplayReadyOnReady:function(){return!1},setCropMode:function(a){this._imageDimensions.setCropMode(a)&&(this._invalidate("cropMode"),this._renderIfReady())},setAlign:function(a,b){var c=!1;this._imageDimensions.setHorizontalAlign(a)&&(c=!0),this._imageDimensions.setVerticalAlign(b)&&(c=!0),c&&(this._invalidate("align"),this._renderIfReady())},setSize:function(a,b,c){var d=!1;this._passedUnit=c||this._passedUnit,a&&(d=this._passedUnit&&this._passedUnit!==this._units.x||this._sizeOfComponentInUnits.x!==parseInt(a,10),this._units.x=this._passedUnit||this._units.x,this._sizeOfComponentInUnits.x=parseInt(a,10)),b&&(d=d||this._passedUnit&&this._passedUnit!==this._units.y||this._sizeOfComponentInUnits.y!==parseInt(b,10),this._units.y=this._passedUnit||this._units.y,this._sizeOfComponentInUnits.y=parseInt(b,10)),d&&(this._invalidate("size"),this._renderIfReady())},_isValueInObject:function(a,b){for(var c in a)if(a[c]===b)return!0;return!1},_getImagesPerformance:function(){return window._imagePerformance||(window._imagePerformance={started:0,timing:[]}),window._imagePerformance},_handleLoadEnd:function(a){var b=this._getImagesPerformance(),c=LOG.getSessionTime(),d=this._skinParts.image.fileSize?parseInt(this._skinParts.image.fileSize):this._skinParts.image.width*this._skinParts.image.height;b.timing.push({url:this._skinParts.image.src,start:this._loadStart,end:c,hadError:a,width:this._skinParts.image.width,height:this._skinParts.image.height,size:d,speed:d/(c-this._loadStart)})}})}),define.component("core.components.MenuButton",function(a){var b=a;b.inherits("mobile.core.components.base.BaseComponent"),b.skinParts({label:{type:"htmlElement"},icon:{type:"htmlElement",optional:!0},description:{type:"htmlElement",optional:!0},bullet:{type:"htmlElement",optional:!0}}),b.binds(["_buttonClick","_onMouseOver","_onMouseOut","_setImages","_onThemePropChange"]),b.states(["selected","idle","up","over","down","disable"]),b.dataTypes(["Link","Page","","AppPage","Text"]),b.fields({_renderTriggers:[Constants.DisplayEvents.DISPLAY_CHANGED],_selected:!1,_dropdownOpen:!1,_menu:null,_transitionValue:null,dropdownMode:!1,children:[]}),b.methods({initialize:function(a,b,c){this.parent(a,b,c),this._listSubType="NONE",c&&c.listSubType&&this.setListSubtype(c.listSubType),this.injects().Theme.addEvent("propertyChange",this._onThemePropChange)},createSubButton:function(a,b,c){var d=this;a(b,null,function(a){d.children.push(a),c(a)})},setMenu:function(a){this._menu=a},getMinimalWidth:function(){return Math.max(this.getOffsetWidth(),this._skinParts.label.offsetWidth)},fillWidthByPadding:function(a){this.setPadding(0);var b=a-this.getOffsetWidth();this.setPadding(b)},getPads:function(){return{left:parseInt(this._skinParts.bg.getStyle("padding-left"),10),right:parseInt(this._skinParts.bg.getStyle("padding-right"),10)}},disableTransition:function(){this._transitionValue=this.getViewNode().getStyle("-webkit-transition-duration"),this.getViewNode().setStyle("-webkit-transition-duration","0s")},enableTransition:function(){null!=this._transitionValue&&this.getViewNode().setStyle("-webkit-transition-duration",this._transitionValue)},setPadding:function(a){0>+a&&(a=0);var b,c=a/2;switch(c-Math.floor(c)===0?b=c:(c=Math.floor(c),b=c+1),this._menu.getComponentProperty("alignText")){case"center":this._skinParts.bg.setStyle("padding-left",c+"px"),this._skinParts.bg.setStyle("padding-right",b+"px");break;case"right":this._skinParts.bg.setStyle("padding-left",a+"px"),this._skinParts.bg.setStyle("padding-right","0px");break;case"left":this._skinParts.bg.setStyle("padding-left","0px"),this._skinParts.bg.setStyle("padding-right",a+"px")}},getMinimalDropdownWidth:function(){var a=0,b=this.getViewNode().getElements(".dropSizeTarget");return b&&b.length>0?b.forEach(function(b){a+=b.offsetWidth}):a=this.getViewNode().offsetWidth,a},isHidden:function(){var a=!1;return this._data.get("hidePage")===!0&&(a=!0),a},compareRefID:function(a){return this._data?this._data.get("id")===a.substr(1):!1},alignText:function(){var a=this.getPads();this.setPadding(a.left+a.right)},getOffsetWidth:function(){return this.getViewNode().offsetWidth},getOffsetLeft:function(){return this.getViewNode().offsetLeft},_onThemePropChange:function(a){this._setImages(a)},_onDataChange:function(a){return this._updateButtonView(),this.fireEvent("dataChanged"),this.parent(a)},render:function(){this._updateButtonView()},setSelected:function(a){this._selected=a,this._selected?this.setState("selected"):(this.removeState("selected"),this._dropdownOpen&&this.setState("over"))},setDropdownOpen:function(a){this._dropdownOpen=a,this._selected||(this._dropdownOpen?this.setState("over"):this.removeState("over"))},_getButtonLabelTextField:function(){return this._data.getType().contains("Page")?"title":"text"},_updateButtonView:function(){if(this._data&&this._skinParts){var a=this._getButtonLabelTextField(),b=this._data.get(a);this._skinParts.label.set("html",this._getNonEmptyText(b));var c=this._skinParts.description;if(c){var d=this._data.get("target");c.set("html",this._getNonEmptyText(d))}this._setImages()}},getID:function(){return this._data?this._data.get("id"):""},_getNonEmptyText:function(a){return a=a.trim().replace(/ /g,"&nbsp;"),a||"&nbsp;"},_onAllSkinPartsReady:function(a){this.injects().Theme.addEvent(Constants.ComponentEvents.PROPERTY_CHANGE,this._setImages);var b=a.hitArea||a.view;b.addEvent(Constants.CoreEvents.CLICK,this._buttonClick),b.addEvent("mouseenter",this._onMouseOver),b.addEvent("mouseleave",this._onMouseOut)},_setImages:function(a){var b,c=this._listSubType+"_DIRECTORY";if(!a||a.name==c){var d=this.injects().Theme.getProperty(c);if("Link"==this._data.getType())this._skinParts.icon.uncollapse(),b="PAGES"==this._listSubType?d+this._data.get("icon"):d+this.injects().LinkTypes.getLinkIcon(this._data.get("linkType")),this._skinParts.icon.set("src",b);else if(this._skinParts.icon){var e=this._data.get("icon");e?(b=d+this._data.get("icon"),this._skinParts.icon.set("src",b)):this._skinParts.icon.setStyle("display","none")}}},getWidthOnLayout:function(){function a(a){var c=b.getStyle(a);return""!==c?parseInt(c,10):0}var b=this.getViewNode();return b.offsetWidth+a("margin-right")+a("margin-left")},setLabel:function(a){this._skinParts.label.set("html",this._getNonEmptyText(a))},setListSubtype:function(a){this._listSubType=a},_buttonClick:function(){this.fireEvent("click")},_onMouseOver:function(){this.dropdownMode&&(this._selected||this.setState("over")),this.fireEvent("over")},_onMouseOut:function(){this.dropdownMode&&(this._selected||this._dropdownOpen||this.removeState("over")),this.fireEvent("out")}})}),define.component("core.components.Page",function(a){var b=a;b.inherits("core.components.ContainerOBC"),b.resources(["W.Layout","W.Viewer"]),b.binds(["_notifyPageComponentsOnPageVisibilityChange","_doNotification"]),b.statics({MAX_HEIGHT:6e4,MIN_HEIGHT:500,MIN_HEIGHT_MOBILE:200,$isPage:!0}),b.dataTypes(["Page"]),b.fields({EDITOR_META_DATA:{general:{settings:!0,design:!0,animation:!1}}}),b.methods({initialize:function(a,b,c){this.parent(a,b,c),this._isContentWixified=!1,this._contentReady=!1,this.setMaxH(this.MAX_HEIGHT);var d=W.Config.env.getCurrentFrameDevice()===Constants.ViewerTypesParams.TYPES.MOBILE?this.MIN_HEIGHT_MOBILE:this.MIN_HEIGHT;this.setMinH(d),c&&c.isWaitingForRender||b.collapse(),this.resources.W.Viewer.addEvent("pageTransitionEnded",this._notifyPageComponentsOnPageVisibilityChange),b.setStyle("position","absolute").setStyle("top","0px").setStyle("left","0px")},delayedDispose:function(a){this.disposeChildren(),this._view.setStyle("visibility","hidden");var b=this,c=function(){b.dispose(),a&&a()};setTimeout(c,500)},dispose:function(){this.resources.W.Viewer.removeEvent("pageTransitionEnded",this._notifyPageComponentsOnPageVisibilityChange),this.parent()},getPageComponents:function(){var a=[];return this.getContainerComponents(a)},render:function(){this.setHeight(0)},setHeight:function(a,b,c){var d=a;this.isContentReady()&&!b&&(d=this.resources.W.Layout.getComponentMinResizeHeight(this)),this.parent(d,b,c)},preparePageForShow:function(){this._isContentWixified=!0,this._contentReady||(this.resources.W.Layout&&this.resources.W.Layout.attachSavedAnchors(this._view),this._contentReady=!0,this.setHeight(0),this.fireEvent("pageContentReady",this))},isAnchorable:function(){return{to:{allow:!0,lock:Constants.BaseComponent.AnchorLock.NEVER},from:!1}},isSelectable:function(){return!1},isContentReady:function(){return this._contentReady},getInlineContentContainer:function(){return this._skinParts.inlineContent?this._skinParts.inlineContent:this._view},getThirdPartyApplicationComponent:function(){var a=this._view.getElement("[comp*='TPASection']");return a&&a.getLogic()},isThirdPartyApplicationPage:function(){return this._data.get("tpaApplicationId")?!0:void 0},isHiddenThirdPartyApplicationPage:function(){return this.isThirdPartyApplicationPage()&&this._data.tpaPageId},_doNotification:function(){var a=this.resources.W.Viewer.getCompLogicById(this._newPageId),b=this.getPageComponents(),c=!1;this._compId==this._newPageId&&(c=!0),b.forEach(function(b){b.onPageVisibilityChange(c,a)})},_notifyPageComponentsOnPageVisibilityChange:function(a){var b=this.resources.W.Viewer.getCompLogicById(a);b&&(this._newPageId=a,this._isContentWixified&&this._doNotification())}})}),define.component("core.components.SimpleBaseList",function(a){var b=a;b.inherits("core.components.BaseList"),b.dataTypes(["PropertyList"]),b.methods({initialize:function(a,b,c){this.parent(a,b,c),this._allItemsLoaded=!1,this._isLoadingItems=!1},getItemsContainer:function(){return this._skinParts.itemsContainer||this._view},_prepareForRender:function(){if(this._allItemsLoaded)return!0;if(this._isLoadingItems)return!1;this._isLoadingItems=!0;var a=this._getItemsData();return this._renderItems(a),this._allItemsLoaded},_onDataChange:function(){this._allItemsLoaded=!1,this._isLoadingItems=!1,this.parent()},_getItemsData:function(){return this._data?this._data.get("items"):void 0},_onAllItemsReady:function(){this._isLoadingItems=!1,this._allItemsLoaded=!0,this._renderIfReady()}})}),define.component("core.components.SimpleButton",function(a){var b=a;b.utilize(["mobile.core.components.base.BaseComponent"]),b.binds(["_buttonClick"]),b.dataTypes(["Button","Link","Page"]),b.skinParts({label:{type:"htmlElement"},hitArea:{type:"htmlElement"}}),b.states(["up","over","down","disable"]),b.methods({render:function(){var a="Page"==this._data.getType()?"title":"text";this._skinParts.label.set("html",this._data.get(a))},_onAllSkinPartsReady:function(a){a.hitArea.addEvent("click",this._buttonClick)},_buttonClick:function(){this.fireEvent("click")}})}),function(){var a="BG_USES_CUSTOM_IMAGE",b="BG_USES_THEME_IMAGE";define.component("mobile.core.components.SiteStructure",function(c){var d=c;d.inherits("core.components.ContainerOBC"),d.binds(["changeBGImage"]),d.resources(["W.Viewer"]),d.fields({_bgSizes:[{w:204,h:309},{w:320,h:452},{w:320,h:646},{w:320,h:800},{w:400,h:591},{w:480,h:480},{w:533,h:239},{w:683,h:334},{w:768,h:896},{w:1024,h:640}]}),d.methods({initialize:function(a,b,c){this.parent(a,b,c),window.onorientationchange&&window.addEvent("orientationchange",this.changeBGImage),window.addEvent("resize",this.changeBGImage),W.Theme.addEvent("propertyChange",this.changeBGImage),this.changeBGImage({type:"init"})},render:function(){this.sitePagesNode=this.resources.W.Viewer.getPageGroupElement(),this.sitePagesNode||LOG.reportError(wixErrors.SITE_STRUCTURE_NO_SITE_PAGES,"core.components.SiteStructure","render");var a=this.injects().Theme.getProperty("padding1");a=a.split(" ");var b="0";switch(a.length){case 1:b="0 "+a[0];break;case 2:case 3:b="0 "+a[1];break;case 4:b="0 "+a[1]+" 0 "+a[3]}this.sitePagesNode.setStyle("margin",b)},_getReformattedBgColor:function(){var a=this.injects().Theme.getProperty("bgSize").split(",");return{width:a[0],height:a[1]}},changeBGImage:function(){var c,d=this.injects().Utils.getWindowSize(),e=this._getBestFit(d,this._bgSizes),f=this.injects().Theme.getProperty("bgType");switch(f){case b:c=this.injects().Theme.getProperty("BG_DIRECTORY")+"bg_"+e.w+"x"+e.h+".jpg",$(document.body).setStyle("background",'url("'+c+'") repeat');break;case a:var g=this.injects().Config.getServiceTopologyProperty("staticMediaUrl")+"/",h=this.injects().Theme.getProperty("bgId"),i=this._getReformattedBgColor(),j=i.width,k=i.height;if(j>100){j=e.w;var l=i.width/i.height;k=Math.round(j/l)}var m=g+h+"_crp_0_0_"+i.width+"_"+i.height+"_"+j+"_"+k+"_crp";$(document.body).setStyle("background",'url("'+m+'") repeat');break;default:$(document.body).setStyle("background","")}c=this.injects().Theme.getProperty("siteBgColor"),$(document.body).setStyle("background-color",c.getHex(!1))},_getWantedBgSize:function(){var a,b,c,d=this._getReformattedBgColor(),e=d.width,f=d.height,g=this._view.clientWidth,h=this._view.clientHeight,i=f/e,j=h/g;j>i?(b=h,a=b/i):(a=g,b=a*i);for(var k=a>b?b:a,l=0;l<this._bgSizes.length;l++)if(this._bgSizes[l]>=k){c=this._bgSizes[l];break}return c},_getBestFit:function(a,b){for(var c=b[0],d=1;d<b.length;++d){var e=b[d],f=e.w-a.width,g=c.w-a.width;f>=0?c=0>g?b[d]:g>f?b[d]:c:0>g&&(c=f>g?b[d]:c)}return c}})})}(),define.component("core.components.TwitterFollow",function(a){var b=a;b.utilize(["mobile.core.components.base.BaseComponent"]),b.skinParts({twitter:{type:"htmlElement"}}),b.dataTypes(["TwitterFollow"]),b.fields({propertiesSchema:{showCount:{type:"string","enum":["true","false"],"default":"true",description:"Followers count display"},button:{type:"string","enum":["blue","gray"],"default":"blue",description:"Button color"},textColor:{type:"string","default":"",description:"HEX color code for the text color"},linkColor:{type:"string","default":"",description:"HEX color code for the Username link color"},width:{type:"string","default":"",description:"width of the Follow Button"},align:{type:"string","default":"",description:"alignment of the Follow Button"},dataLang:{type:"string","enum":["en","fr","de","it","es","ko","ja"],"default":"en",description:"The language for the Tweet Button"}}}),b.methods({initialize:function(a,b){this.parent(a,b)},render:function(){this._runTwitterScript(),this._rebuildTwitterElement()},_onComponentPropertyChange:function(){this._rebuildTwitterElement()},_rebuildTwitterElement:function(){this._skinParts.twitter.empty();var a=this._data.get("accountToFollow").replace("@","");a||(a="wix");var b={"class":"twitter-follow-button",href:"https://twitter.com/"+a,"data-show-count":this.getComponentProperty("showCount"),"data-button":this.getComponentProperty("button"),"data-text-color":this.getComponentProperty("textColor"),"data-link-color":this.getComponentProperty("linkColor"),"data-lang":this.getComponentProperty("dataLang"),"data-width":this.getComponentProperty("width"),"data-align":this.getComponentProperty("align")},c=new Element("a",b);this._skinParts.twitter.adopt(c),void 0!==window.twttr&&twttr.widgets.load()},_runTwitterScript:function(){define.getDefinition("resource","TwitterWidgetsApi")||define.resource("TwitterWidgetsApi").withUrls("//platform.twitter.com/widgets.js"),resource.getResourceValue("TwitterWidgetsApi",function(){})}})}),define.component("core.components.base.BaseComp",function(a){var b=a;b.inherits("core.events.EventDispatcher"),b.traits(["core.components.base.traits.BaseCompInvalidation","core.components.base.traits.BaseCompSkinHandler","core.components.base.traits.BaseCompChildCompHandler","core.components.base.traits.BaseCompStates","core.components.base.traits.BaseCompDataHandler","core.components.base.traits.BaseCompProperties","core.components.base.traits.BaseCompLayout","core.components.base.traits.BaseCompBehaviors","core.components.base.traits.OldBaseCompIntegration","core.components.base.traits.OldBaseCompLayoutIntegration","core.components.base.traits.OldBaseCompEditorPropIntegration"]),b.resources(["W.ComponentLifecycle"]),b.skinParts({}),b.dataTypes([""]),b.states({}),b.statics({NEW_BASE_COMP:!0,INVALIDATIONS:{SKIN_CHANGE:"skinChange",DATA_CHANGE:"dataChange",DISPLAY:"display",WIDTH_REQUEST:"widthRequest",HEIGHT_REQUEST:"heightRequest",X_REQUEST:"xRequest",Y_REQUEST:"yRequest",SIZE:"sizeChanged",POSITION:"positionChanged",PART_SIZE:"partSize",PART_POSITION:"partPosition",STYLE_PARAM_CHANGE:"styleParamChange",FIRST_RENDER:"firstRender",SCALE_CHANGE:"scaleChange",PROPERTIES_CHANGE:"propertiesChange",MEASURED_SIZE_DIFFERS_FROM_REQUESTED:"measuredSizeDiffersFromRequested",SOCIAL_DATA_CHANGE:"socialDataChange"}}),b.methods({initialize:function(a,b){this._idPrefix=b.get("idprefix"),this._initializeIds(a,b),this.$view=b,this.on(Constants.LifecycleSteps.RENDER,this,this._onRender),this._rotatable=!1},_initializeIds:function(a,b){return a?(b.setProperty("id",a),this._uniqueCompId=a,this._compId=this._removeIdPrefix(a),void 0):(this.console.error("Wixify should have provided a compId."),void 0)},getComponentId:function(){return this._compId},getComponentUniqueId:function(){return this._uniqueCompId},_removeIdPrefix:function(a){return this._idPrefix?a.replace(this._idPrefix,""):a},isRenderNeeded:function(a){var b=[this.INVALIDATIONS.SKIN_CHANGE,this.INVALIDATIONS.DATA_CHANGE,this.INVALIDATIONS.WIDTH_REQUEST,this.INVALIDATIONS.HEIGHT_REQUEST];return a.isInvalidated(b)},_onRender:function(){},isDisplayed:function(){var a=this.resources.W.ComponentLifecycle.getComponentInfo(this);return a.isDisplayed},getComponentStatus:function(){var a=this.resources.W.ComponentLifecycle.getComponentInfo(this);return a.state},exterminate:function(){return this._isExterminated?LOG.reportError(wixErrors.COMPONENT_ALREADY_DISPOSED,this.$className,"exterminate",this.getComponentId()):(this._isExterminated=!0,this.parent(),void 0)},getSkinPart:function(a){return this._skinParts[a]||null},requestToDie:function(a,b){this.$view.trigger(Constants.ComponentEvents.REQUESTING_TO_DIE,{errorObj:a,messageToUserObj:b})}})}),define.Class("core.components.base.BaseLayoutEngine",function(a){var b=a;b.methods({initialize:function(a){this._viewNode=a},updateLayoutFromViewNode:function(){},setSize:function(){},setPosition:function(){},getSize:function(){},getPosition:function(){}})}),define.Const("ComponentEvents",{DISPLAYED:"displayed",READY:"componentReady",WIXIFIED:"wixified",PROPERTY_CHANGE:"componentPropertyChange",READY_FOR_RENDER:"readyForRender",DOM_DISPLAY_READY:"domDisplayReady",RENDER:"render",COMPONENT_SEQUENCER_COMP_SETUP:"componentSetup",COMPONENT_SEQUENCER_PRODUCTION_FINISHED:"productionFinished",DISPOSED:"disposed",PAGE_ID_CHANGED:"componentPageIdChanged",REQUESTING_TO_DIE:"requestingToDie",REMOVE_ANIMATION_ON_ADD_BOX:"removeAnimationBehaviorOnAddToContainer",RETURN_ANIMATION_ON_REMOVE_FROM_BOX:"returnAnimationBehaviorOnRemovalFromContainer"}),define.Const("ComponentPartTypes",{HTML_ELEMENT:"htmlElement"}),define.Class("core.components.base.InvalidationCollector",function(a){var b=a;b.methods({initialize:function(){this._invalidations={}},invalidate:function(a,b){if(a){var c=this._invalidations[a]||[];c.push(b),this._invalidations[a]=c}},clearInvalidationType:function(a){delete this._invalidations[a]},isInvalidated:function(a){for(var b,c=0;c<a.length;++c)if(b=a[c],void 0!==this._invalidations[b])return!0;return!1},getInvalidationByType:function(a){return this._invalidations[a]},getLastInvalidationByType:function(a){var b=this._invalidations[a];return b?b[b.length-1]:null}})}),define.Class("core.components.base.SizeLimits",function(a){var b=a;b.methods({initialize:function(){this.minW=null,this.minH=null,this.maxW=null,this.maxH=null},clone:function(){var a=new this.$class;return a.minW=this.minW,a.minH=this.minH,a.maxW=this.maxW,a.maxH=this.maxH,a}})}),define.Const("BaseComponent",{ResizeSides:{TOP:"RESIZE_TOP",LEFT:"RESIZE_LEFT",BOTTOM:"RESIZE_BOTTOM",RIGHT:"RESIZE_RIGHT"},MoveDirections:{HORIZONTAL:"HORIZONTAL_MOVE",VERTICAL:"VERTICAL_MOVE"},AnchorLock:{NEVER:"never",BY_THRESHOLD:"threshold",ALWAYS:"always"}}),define.Class("core.components.base.traits.BaseCompBehaviors",function(a){var b=a;b.binds(["initializeBehaviors","removeBehaviorsRegistration","updateBehaviorsRegistration"]),b.resources(["W.Config"]),b.methods({initialize:function(){return this._behaviors=null,this._isDeviceMobile=this.resources.W.Config.mobileConfig.isMobileOrTablet(),this._isEditorFrame=this.resources.W.Config.env.$isEditorFrame,this._isEditorFrame?void 0:this._isDeviceMobile?(this.removeBehaviorsFromViewNode(),void 0):(window.addEventListener&&(this.initializeBehaviors(),this.addEvent(Constants.ComponentEvents.PAGE_ID_CHANGED,this.updateBehaviorsRegistration),this.on(Constants.ComponentEvents.PAGE_ID_CHANGED,this,this.updateBehaviorsRegistration),this.on(Constants.EventDispatcher.Events.EXTERMINATING,this,this.removeBehaviorsRegistration)),void 0)},initializeBehaviors:function(){var a=this.$view.$behaviors;return a?(this.setBehaviors(a),this.removeBehaviorsFromViewNode(),a):null},setBehaviors:function(a){return this._behaviors=a?"string"==typeof a?JSON.parse(a):a:null,this.updateBehaviorsRegistration(),this.getBehaviors()},updateBehaviorsRegistration:function(){var a=this.$view.$pageId,b=this.getBehaviors();resource.getResourceValue("W.Actions",function(c){c.registerComponent(a,this,b)}.bind(this))},removeBehaviorsRegistration:function(){var a=this.getBehaviors();a&&resource.getResourceValue("W.Actions",function(a){a.registerComponent(null,this,null)}.bind(this))},getBehaviors:function(){return this._behaviors?_.cloneDeep(this._behaviors):null},removeBehaviorsFromViewNode:function(){delete this.$view.$behaviors}})}),define.Class("core.components.base.traits.BaseCompChildCompHandler",function(a){var b=a;b.utilize(["core.managers.components.ComponentBuilder"]),b.resources(["W.ComponentLifecycle","W.Data"]),b.binds(["_onChildComponentReady"]),b.fields({SKIN_PART_ATTR_NAME:"skinPart",STYLE_ATTR_NAME:"styleId"}),b.methods({_createInnerComponent:function(a,b){b=b||new Element("div"),b.setProperty(this.SKIN_PART_ATTR_NAME,a.id);var c=this._getInnerComponentStyle(a);!c&&a.styleId&&b.setProperty(this.STYLE_ATTR_NAME,a.styleId);var d=a.argObject||{},e=this._getInnerComponentData(a),f=a.skin,g=a.type,h=new this.imports.ComponentBuilder(b);return h.withType(g).withSkin(f).withData(e).withArgs(d).withSkinParamMapper(c).onWixified(this._onChildComponentReady).create(),b.$logic},_onChildComponentReady:function(a){this.resources.W.ComponentLifecycle.setParentComponentProcess(a,this)},_getInnerComponentData:function(a){var b;if(a.dataQuery)b=a.dataQuery;else if(a.dataRefField){var c=a.dataRefField;b="*"==c?this._data:this._data.get(c)}else if(a.dataItem)b=a.dataItem;else if(a.dataType){var d=this._data?this._data.getDataManager():this.resources.W.Data;b=d.addDataItemWithUniqueId("",{type:a.dataType}).dataObject,b.setMeta("isPersistent",!1)}return b},_getInnerComponentStyle:function(a){var b,c=this._skin&&this._skin.getParamMapper();return a.styleGroup&&c&&(b="inherit"==a.styleGroup?c:c.getStyleByGroupName(a.styleGroup)),b}})}),define.Class("core.components.base.traits.BaseCompDataHandler",function(a){var b=a;b.utilize(["core.components.base.traits.BaseCompDataHandlerHelper"]),b.statics({_definitionFieldName_:"_dataTypes_",_fieldName_:"dataTypes",_aggregateSchema_:function(a,b,c){if((!a||a&&"array"!==typeOf(a))&&(a=[""]),b&&"array"===typeOf(b)&&(a=a.combine(b)),"array"===typeOf(c)){for(var d=[],e=0;e<a.length;++e)-1===c.indexOf(a[e])&&d.push(a[e]);a=d}return a}}),b.methods({initialize:function(){this._helper||(this._helper=new this.imports.BaseCompDataHandlerHelper),this._data=null,this.on(Constants.EventDispatcher.Events.EXTERMINATING,this,this._exterminateData),this.$compSchema.dataTypes||(this.$compSchema.dataTypes=[""])},_getDataManager:function(){return this._data?this._data.getDataManager():null},getRawData:function(){return this._data?this._data.getData():void 0},getDataItem:function(){return this._data},setDataItem:function(a){this.isDataTypeValid(a)&&this._helper.connectDataItemToComponent(a,this._data,this,this._onCompDataChanged)&&(this._data=a,this.invalidate(this.INVALIDATIONS.DATA_CHANGE,this._helper.getChangesObjectWhenNewItem(a),!0))},_onCompDataChanged:function(a){var b=this._helper.getChangesObject(a);this.invalidate(this.INVALIDATIONS.DATA_CHANGE,b,!0)},setDataByQuery:function(a){this.injects().Data.getDataByQuery(a,function(a){this.setDataItem(a)}.bind(this))},isDataTypeValid:function(a){var b=a?a.getType():"";return this.$compSchema.dataTypes.contains(b)},_setDataField:function(a,b){this._data.set(a,b,!0)},_setMetaDataField:function(a,b){this._data.setMeta(a,b)},hasDataFieldBeenInvalidated:function(a,b){return this._helper.isFieldInvalidated(a,b,this.INVALIDATIONS.DATA_CHANGE)},hasDataReallyBeenInvalidated:function(a){var b=a.getInvalidationByType(this.INVALIDATIONS.DATA_CHANGE);return _.some(b,function(a){return!a.isProperties})},_exterminateData:function(){this._helper.disconnectDataItemFromComponent(this,this._data)}})}),define.Class("core.components.base.traits.BaseCompDataHandlerHelper",function(a){var b=a;b.methods({connectDataItemToComponent:function(a,b,c,d){return a!==b?(this.disconnectDataItemFromComponent(c,b),a&&(a.addComponentWithInterest(c),a.on(Constants.DataEvents.DATA_CHANGED,c,d)),!0):!1},disconnectDataItemFromComponent:function(a,b){if(b){b.removeComponentWithInterest(a),b.offByListener(a),this._removeSkinPartsListenersFromItem(a,b);var c=b.getDataManager();c&&c.removeDataItem(b)}},_removeSkinPartsListenersFromItem:function(a,b){if(a._skinParts)for(var c in a._skinParts){var d=a._skinParts[c];
d._compId&&b.offByListener(d)}},getChangesObject:function(a){var b=a.data;return{dataItem:b.dataItem,field:b.field,value:b.newValue}},getChangesObjectWhenNewItem:function(a){return{dataItem:a,field:void 0,value:void 0}},isFieldInvalidated:function(a,b,c){var d=b.getInvalidationByType(c),e=_.pluck(d,"field");return _.some(e,function(b){return!b||b===a||b[a]})}})}),define.Class("core.components.base.traits.BaseCompInvalidation",function(a){var b=a;b.resources(["W.ComponentLifecycle"]),b.utilize(["core.components.base.InvalidationCollector"]),b.methods({initialize:function(){this._invalidations_=new this.imports.InvalidationCollector},invalidate:function(a,b,c){a&&(this._invalidations_.invalidate(a,b),c&&this.trigger(a,b)),this.resources.W.ComponentLifecycle.forceRender()},isInvalidated:function(a){return this._invalidations_.isInvalidated(a)},getInvalidationByType:function(a){return this._invalidations_.getInvalidationByType(a)},getLastInvalidationByType:function(a){return this._invalidations_.getLastInvalidationByType(a)}})}),define.Class("core.components.base.traits.BaseCompLayout",function(a){var b=a;b.methods({initialize:function(){this.on(Constants.EventDispatcher.Events.EXTERMINATING,this,this._exterminateLayout)},setWidth:function(a,b){var c=parseInt(a,10);isNaN(c)||(c=this._limitWidth(c),this._setWidth_(c),this.getRequestDimensions().width=c,b||(this.invalidate(this.INVALIDATIONS.WIDTH_REQUEST,{width:c,requestedWeight:a},!0),this.resources.W.ComponentLifecycle.forceRender()))},setHeight:function(a,b){var c=parseInt(a,10);isNaN(c)||(c=this._limitHeight(c),this._setHeight_(c),this.getRequestDimensions().height=c,b||(this.invalidate(this.INVALIDATIONS.HEIGHT_REQUEST,{height:c,requestedHeight:a},!0),this.resources.W.ComponentLifecycle.forceRender()))},setX:function(a){var b=parseInt(a,10);isNaN(b)||(this._setX_(b),this.getRequestDimensions().left=b,this.invalidate(this.INVALIDATIONS.X_REQUEST,{x:b,requestedX:a},!0),this.resources.W.ComponentLifecycle.forceRender())},setY:function(a){var b=parseInt(a,10);isNaN(b)||(this._setY_(b),this.getRequestDimensions().top=b,this.invalidate(this.INVALIDATIONS.Y_REQUEST,{y:b,requestedY:a},!0),this.resources.W.ComponentLifecycle.forceRender())},getWidth:function(){return this.getRequestDimensions().width},getHeight:function(){return this.getRequestDimensions().height},getAngle:function(){return this.getRequestDimensions().angle||0},setAngle:function(a){var b=parseInt(a,10),c=this.getRequestDimensions();if(c.angle!=b){if(isNaN(b))return W.Utils.debugTrace("WbaseComponent","setAngle","NaN passed as value"),void 0;c.angle=b,this._setAngle_(b),this.resources.W.ComponentLifecycle.forceRender()}},getScale:function(){return this._$scale||1},setScale:function(a){var b=this._$scale;this._setScale_(a),this.invalidate(this.INVALIDATIONS.SCALE_CHANGE,{newValue:this._$scale,oldValue:b},!0)},getBoundingWidth:function(){var a=W.Utils.Math.degreesToRadians(this.getAngle()),b=this.getWidth(),c=this.getPhysicalHeight();return parseInt(Math.abs(b*Math.cos(a))+Math.abs(c*Math.sin(a)),10)},getBoundingHeight:function(){var a=W.Utils.Math.degreesToRadians(this.getAngle()),b=this.getWidth(),c=this.getPhysicalHeight();return parseInt(Math.abs(b*Math.sin(a))+Math.abs(c*Math.cos(a)),10)},getX:function(){return this.getRequestDimensions().left},getY:function(){return this.getRequestDimensions().top},getBoundingX:function(){return parseInt(this.getX()-(this.getBoundingWidth()-this.getWidth())/2,10)},getBoundingY:function(){return parseInt(this.getY()-(this.getBoundingHeight()-this.getPhysicalHeight())/2,10)},getInvalidatedWidth:function(){var a=this.getLastInvalidationByType(this.INVALIDATIONS.WIDTH_REQUEST);return a?a.width:null},getInvalidatedHeight:function(){var a=this.getLastInvalidationByType(this.INVALIDATIONS.HEIGHT_REQUEST);return a?a.height:null},getInvalidatedX:function(){var a=this.getLastInvalidationByType(this.INVALIDATIONS.X_REQUEST);return a?a.x:null},getInvalidatedY:function(){var a=this.getLastInvalidationByType(this.INVALIDATIONS.Y_REQUEST);return a?a.y:null},isRotatable:function(){return this._rotatable},setUseWidthOverMinWidth:function(a){this._useWidthOverMinWidth=a},_setWidth_:function(a){a=this._limitWidth(a),this._minSetWidth=a,this._useWidthOverMinWidth===!0?this.$view.style.width=a+"px":this.$view.style.minWidth=a+"px"},_setHeight_:function(a){a=this._limitHeight(a),this._minSetHeight=a,this._useHeightOverMinHeight?this.$view.style.height=a+"px":this.$view.style.minHeight=a+"px"},_setX_:function(a){this._$leftAdjustment&&!W.Utils.getCSSBrowserFeature("transform")&&(a+=this._$leftAdjustment),this.$view.style.left=a+"px"},_setY_:function(a){this._$topAdjustment&&!W.Utils.getCSSBrowserFeature("transform")&&(a+=this._$topAdjustment),this.$view.style.top=a+"px"},_setAngle_:function(a){this.$view.style.webkitBackfaceVisibility=0!==a?"hidden":"";var b=W.Utils.getCSSBrowserFeature("transform");return b||0===a?(this.$view.style[b]=0===a?"":"rotate("+a+"deg)",void 0):(this._rotateIEComponent(),void 0)},_setScale_:function(a){this._$scale=parseFloat(a)},setPos:function(a){this._$pos!==a&&this._setPos_(a)},_setPos_:function(a){this._$pos=a,this._saveLayoutPosition_();var b={comp:this};this.fireEvent("positionChanged",b)},applyPos:function(a){this._applyLayoutPosition_(a)},_applyLayoutPosition_:function(a){var b=a||this._$pos;"fixed"===b?(this.$view.setStyle("position","fixed"),this.$view.addClass("fixedPosition")):"absolute"===b&&(this.$view.setStyle("position","absolute"),this.$view.removeClass("fixedPosition"))},_saveLayoutPosition_:function(){"fixed"===this._$pos?this.$view.setAttribute("pos","fixed"):"static"===this._$pos?this.$view.setAttribute("pos","static"):this.$view.removeAttribute("pos")},getLayoutPosition:function(){return this._$pos||this._getLayoutPositionFromDOM_()},_getLayoutPositionFromDOM_:function(){return this.$view.getAttribute("pos")||"absolute"},_rotateIEComponent:function(){var a=Math.cos(W.Utils.Math.degreesToRadians(this.getRequestDimensions().angle)),b=Math.sin(W.Utils.Math.degreesToRadians(this.getRequestDimensions().angle)),c=this.getRequestDimensions().width,d=this.getRequestDimensions().height,e=.5*(c+d*b-c*a),f=.5*(d-d*a-c*b);this.$view.style.filter="progid:DXImageTransform.Microsoft.Matrix(M11="+a+", M12="+-b+", M21="+b+", M22="+a+", Dx="+e+", Dy="+f+",sizingMethod='auto expand')",this.$view.style.zIndex=1,this._updateIE8FilterAdjustments(),this.setX(this.getX()),this.setY(this.getY())},_updateIE8FilterAdjustments:function(){var a=W.Utils.Math.degreesToRadians(this.getRequestDimensions().angle),b=this.getRequestDimensions().width,c=this.getRequestDimensions().height,d=.5*(b-(c*Math.abs(Math.sin(a))+b*Math.abs(Math.cos(a)))),e=.5*(c-(b*Math.abs(Math.sin(a))+c*Math.abs(Math.cos(a))));this._$leftAdjustment=d,this._$topAdjustment=e},getPhysicalHeight:function(){var a=this.getMeasure().height,b=this.getInvalidatedHeight();return Math.max(a,b,this._minSetHeight)},getPhysicalWidth:function(){var a=this.getMeasure().width,b=this.getInvalidatedWidth();return Math.max(a,b,this._minSetWidth)},getRequestDimensions:function(){return this.$view.$requestDimensions=this.$view.$requestDimensions||{width:0,height:0,top:0,left:0,angle:0},this.$view.$requestDimensions},getMeasure:function(){return this.$view.$measure||{width:0,height:0,top:0,left:0}},getMinDragY:function(a){return W.Layout&&W.Layout.getComponentMinDragY(this,a)},isSizeInvalidated:function(){return!!this.getInvalidatedWidth()||!!this.getInvalidatedHeight()},_limitWidth:function(a){return this._limitDimension(a,this.getSizeLimits().minW,this.getSizeLimits().maxW)},_limitHeight:function(a){return this._limitDimension(a,this.getSizeLimits().minH,this.getSizeLimits().maxH)},_limitDimension:function(a,b,c){return Math.min(Math.max(a,b),c)},disableReportLayoutChange:function(){this._isReportLayoutChangeDisabled=!0},enableReportLayoutChange:function(){this._isReportLayoutChangeDisabled=!1},isFixedPositioned:function(){var a=W.Config.env.$viewingDevice===Constants.ViewerTypesParams.TYPES.MOBILE;return!a&&"fixed"===this._$pos},shouldBeFixedPosition:function(){return!1},canBeFixedPosition:function(){return!1},_unlockSafe:function(a){var b=[61,120,13,0];if(this._rotateCounter||(this._rotateCounter=0),this.getRequestDimensions().angle===b[this._rotateCounter]?this._rotateCounter++:this._rotateCounter=0,4===this._rotateCounter&&"wysiwyg.viewer.components.WPhoto"===this.className&&a){var c=W.Config.getServiceTopologyProperty("staticThemeUrlWeb")+"/editor_web/easterEggs/rotate-safe.png";this._skinParts.img._skinParts.image.src=c,this._rotateCounter=0}},reportLayoutChange:function(){this._isReportLayoutChangeDisabled||(this._heightInvalidated=!0,this.getAnchors()&&this.getAnchors().length&&W.Layout.callForMeasure(this))},_exterminateLayout:function(){W.Layout&&W.Layout.deleteSavedAnchorsById(this.getComponentId())},normalizeScaleIfNeeded:function(a){return a},wasHeightChanged:function(){return this._heightInvalidated},validateHeight:function(){this._heightInvalidated=!1},flagSingleMeasureNeeded:function(){var a=this.resources.W.ComponentLifecycle.getComponentInfo(this);a.forceSingleMeasure=!0},canBeDraggedIntoContainer:function(){return!0}})}),define.Class("core.components.base.traits.BaseCompProperties",function(a){var b=a;b.resources(["W.ComponentData"]),b.utilize(["core.components.base.traits.BaseCompDataHandlerHelper"]),b.statics({_definitionFieldName_:"_propertiesSchemaType_",_fieldName_:"propertiesSchemaType",_aggregateSchema_:function(a){return a||""}}),b.methods({initialize:function(){this._helper||(this._helper=new this.imports.BaseCompDataHandlerHelper),this._properties=null,this.on(Constants.EventDispatcher.Events.EXTERMINATING,this,this._exterminateProperties)},setComponentProperties:function(a,b){this._helper.connectDataItemToComponent(a,this._properties,this,this._onCompPropertiesChanged)&&(this._properties=a,this.$view.setProperty("propertyQuery","#"+this._properties.get("id")),this.invalidate(this.INVALIDATIONS.DATA_CHANGE,this._helper.getChangesObjectWhenNewItem(a),b),this.invalidate(this.INVALIDATIONS.PROPERTIES_CHANGE,this._helper.getChangesObjectWhenNewItem(a),!0))},_onCompPropertiesChanged:function(a){var b=this._helper.getChangesObject(a),c=_.clone(b);c.isProperties=!0,this.invalidate(this.INVALIDATIONS.PROPERTIES_CHANGE,c,!0),this.invalidate(this.INVALIDATIONS.DATA_CHANGE,b,!0)},getComponentProperties:function(){return this._properties||this._createComponentProperties(),this._properties},getComponentProperty:function(a){return this._properties||this._createComponentProperties(),this._properties.get(a)},setComponentProperty:function(a,b,c){this._properties||this._createComponentProperties(),this._properties.set(a,b,c)},_createComponentProperties:function(){if(this.$view){var a=this._compId,b=this.$compSchema.propertiesSchemaType;if(!b)return null;var c=this.resources.W.ComponentData.addDataItem(a,{type:b},this);this.setComponentProperties(c),this.setIsPropertiesSavedInServer()}},setIsPropertiesSavedInServer:function(){this._properties&&this._properties.setMeta("isPersistent",!0)},deleteComponentProperty:function(){console.error("base comp deleteComponentProperty isn't implemented")},_exterminateProperties:function(){this._helper.disconnectDataItemFromComponent(this,this._properties)},hasPropertyFieldBeenInvalidated:function(a,b){return this._helper.isFieldInvalidated(a,b,this.INVALIDATIONS.PROPERTIES_CHANGE)}})}),define.Class("core.components.base.traits.BaseCompSkinHandler",function(a){var b=a;b.statics({_definitionFieldName_:"_skinParts_",_fieldName_:"skinParts",_aggregateSchema_:function(a,b,c){if((!a||a&&"object"!==typeOf(a))&&(a={}),b&&"object"===typeOf(b)&&Object.merge(a,b),c&&"object"===typeOf(c))for(var d in c)delete a[d];return a}}),b.methods({initialize:function(a,b,c){this.on(Constants.EventDispatcher.Events.EXTERMINATING,this,this._exterminateView),this._styleNameSpace=c&&c.styleNameSpace,this.$compSchema.skinParts||(this.$compSchema.skinParts={})},setSkin:function(a){this._removeOldSkinAndExtractInlineContent(),this._skin=a,this._skin._setLogic_(this)},getSkin:function(){return this._skin||null},setSkinMapper:function(a){if(this._skin.getOriginalClassName()===a.getSkin())this._skin.setParamMapper(a);else{var b=a.getSkinClass(),c=new b;c.setParamMapper(a),this.setSkin(c)}},getSkinMapper:function(){return this._skin&&this._skin.getParamMapper()||null},getStyleNameSpace:function(){return this._styleNameSpace||this.$className},getInlineContent:function(){return this._skinParts&&this._skinParts.inlineContent?this._skinParts.inlineContent.getChildren():!this._skinParts&&this.$view?this.$view.getChildren():null},_removeOldSkinAndExtractInlineContent:function(){var a=this.getInlineContent();a&&(this.$view.empty(),this.$view.adopt(a)),this._skin&&(this._skin._removeLogic_(),this._skin.exterminate()),this._exterminateSkinParts(),delete this._skinParts},_updateSkinParts_:function(a){this._validateSkinParts(a),this._skinParts=this._processCompParts(a),this.invalidate(this.INVALIDATIONS.SKIN_CHANGE,{},!0)},_validateSkinParts:function(a){var b=this.$compSchema.skinParts;if(b)for(var c in b){var d=b[c];a[c]||d.optional||d.autoCreate===!1||LOG.reportError(wixErrors.SKIN_PART_MISSING,this.$className+" / "+this._skin.$className,"_validateSkinParts",c)()}},_processCompParts:function(a){var b=Object.clone(a),c=this.$compSchema.skinParts;for(var d in c){var e=c[d];if("htmlElement"!==e.type&&e.autoCreate!==!1){var f=this.getSkinPartDefinition(d),g=a[d];b[d]=this._createInnerComponent(f,g,!1)}}return b},getSkinPartDefinition:function(a){var b=this.$compSchema.skinParts[a],c=this._skin&&this._skin.getCompPartsDefinition()[a]||{},d={id:a};return b?d=Object.merge(d,c,b):(d.partDefinitionNotFound="maybe you missed a letter?",LOG.reportError(wixErrors.CM_NO_PART,this.getOriginalClassName(),"getSkinPartDefinition",a)()),d.hookMethod&&"function"==typeOf(this[d.hookMethod])&&(d.argObject=d.argObject||{},d=this[d.hookMethod](d)),d},_exterminateView:function(){this._exterminateSkinParts(),this._skin&&this._skin.exterminate(),this.$view&&(this.$view.exterminate(),this.$view=null)},_exterminateSkinParts:function(){this._skinParts&&_.forOwn(this._skinParts,function(a,b){"view"!==b&&(a.$view&&!a.NEW_BASE_COMP?a.dispose():a.exterminate())})}})}),define.Class("core.components.base.traits.BaseCompStates",function(a){var b=a;b.fields({DEFAULT_GROUP_NAME:"DEFAULT",ATTR_NAME:"state"}),b.statics({_definitionFieldName_:"_states_",_fieldName_:"states",_aggregateSchema_:function(a,b,c){if(a=a||[],"array"===typeOf(a)&&(a={DEFAULT:a}),b&&("array"===typeOf(b)?a.DEFAULT=b:Object.merge(a,b)),c)if("array"===typeOf(c))a.DEFAULT=[];else for(var d in c)delete a[d];var e={};for(var f in a)Array.each(a[f],function(a){return e[a]?(LOG.reportError(wixErrors.CM_DUPLICATE_STATE_NAME,"BaseCompStates","_aggregateSchema_",a)(),null):(e[a]=1,void 0)}.bind(this));return a}}),b.methods({initialize:function(){this._selectedStates={},this._groupNames=[],this.$compSchema.states=this._states_||{},this._initializeCurrentState()},_initializeCurrentState:function(){this._selectedStates={},Object.each(this.$compSchema.states,function(a,b){this._selectedStates[b]=a[0]},this),this._syncViewNodeWithStates()},getState:function(a){var b=a||this.DEFAULT_GROUP_NAME,c=this._selectedStates[b];return c||null},setState:function(a,b){var c=a,d=b;return d||(d=this._getGroupNameByState(c)),d?this._selectedStates[d]?this.$compSchema.states[d].contains(c)?(this._selectedStates[d]=c,this._syncViewNodeWithStates(),void 0):(LOG.reportError(wixErrors.CM_UNKNOWN_STATE_NAME,"BaseCompStates","setState",this.getOriginalClassName()+"{"+b+":"+a+"}"),void 0):(LOG.reportError(wixErrors.CM_UNKNOWN_STATE_GROUP,"BaseCompStates","setState",this.getOriginalClassName()+"{"+b+"}"),void 0):(LOG.reportError(wixErrors.CM_UNKNOWN_STATE_NAME,"BaseCompStates","setState",this.getOriginalClassName()+"{"+b+":"+a+"}"),void 0)},hasState:function(a,b){return b||(b=this._getGroupNameByState(a)),b?this.$compSchema.states?this.$compSchema.states[b]?this.$compSchema.states[b].contains(a)?!0:!1:!1:!1:!1},_getGroupNameByState:function(a){for(var b in this.$compSchema.states)if(this.$compSchema.states[b].contains(a))return b;return null},_syncViewNodeWithStates:function(){var a=this.getViewNode();if(a){var b=Object.values(this._selectedStates).join(" ");a.setAttribute(this.ATTR_NAME,b),a.addClass("FOCRE_REFLOW_PLEASE"),a.removeClass("FOCRE_REFLOW_PLEASE")}}})}),define.Class("core.components.base.traits.OldBaseCompEditorPropIntegration",function(a){var b=a;b.utilize(["core.components.base.SizeLimits"]),b.statics({MINIMUM_X_DEFAULT:-2e3,MAXIMUM_X_DEFAULT:2e3,MINIMUM_Y_DEFAULT:-1e3,MAXIMUM_Y_DEFAULT:4e4,MINIMUM_WIDTH_DEFAULT:5,MINIMUM_HEIGHT_DEFAULT:5,MAXIMUM_WIDTH_DEFAULT:2500,MAXIMUM_HEIGHT_DEFAULT:2e3}),b.methods({initialize:function(){this._showOnAllPagesChangeability=!0,this._usesExternalData=!1,this._resizableSides||(this._resizableSides=[Constants.BaseComponent.ResizeSides.TOP,Constants.BaseComponent.ResizeSides.LEFT,Constants.BaseComponent.ResizeSides.BOTTOM,Constants.BaseComponent.ResizeSides.RIGHT]),this._moveDirections=[Constants.BaseComponent.MoveDirections.HORIZONTAL,Constants.BaseComponent.MoveDirections.VERTICAL],this.on(this.INVALIDATIONS.Y_REQUEST,this,this._OBCEI_onMovement),this.on(this.INVALIDATIONS.X_REQUEST,this,this._OBCEI_onMovement)},getSelectableX:function(){return this.getX()},getSelectableY:function(){return this.getY()},getSelectableWidth:function(){return this.getPhysicalWidth()},getSelectableHeight:function(){return this.getPhysicalHeight()},isSelectable:function(){return!0},getHorizontalGroup:function(){return this._horizontalGroup},_OBCEI_onMovement:function(){this.fireEvent("componentMoved")},allowHeightLock:function(){return this.isVertResizable()},getResizableSides:function(){return this._resizableSides},isResizable:function(){return this._resizableSides.length>0},isHorizResizable:function(){return this._resizableSides.contains(Constants.BaseComponent.ResizeSides.RIGHT)||this._resizableSides.contains(Constants.BaseComponent.ResizeSides.LEFT)},isVertResizable:function(){return this._resizableSides.contains(Constants.BaseComponent.ResizeSides.TOP)||this._resizableSides.contains(Constants.BaseComponent.ResizeSides.BOTTOM)},isHorizontallyMovable:function(){return this._moveDirections.contains(Constants.BaseComponent.MoveDirections.HORIZONTAL)},isVerticallyMovable:function(){return this._moveDirections.contains(Constants.BaseComponent.MoveDirections.VERTICAL)},getSizeRefNode:function(){return this._getEditBoxReferenceNode().getSize()},_getEditBoxReferenceNode:function(){return this.$view},getExtraPixels:function(a){return this.getDivExtraPixels(this.$view,a)},getDivExtraPixels:function(a,b){var c=Number.from(a.getStyle("border-top"))+Number.from(a.getStyle("padding-top")),d=Number.from(a.getStyle("border-bottom"))+Number.from(a.getStyle("padding-bottom")),e=Number.from(a.getStyle("border-left"))+Number.from(a.getStyle("padding-left")),f=Number.from(a.getStyle("border-right"))+Number.from(a.getStyle("padding-right"));return b&&(c+=Number.from(a.getStyle("margin-top")),d+=Number.from(a.getStyle("margin-bottom")),e+=Number.from(a.getStyle("margin-left")),f+=Number.from(a.getStyle("margin-right"))),{top:c,bottom:d,left:e,right:f,height:c+d,width:e+f}},isSiteSegment:function(){return this.isInstanceOfClass("wysiwyg.viewer.components.SiteSegmentContainer")},isInstanceOfClass:function(a){if(this.className==a)return!0;for(var b=this.$parentPrototype;b;){if(b.className==a)return!0;b=b.$parentPrototype}return!1},useLayoutOnDrag:function(){return!1},useLayoutOnResize:function(){return!1},isDraggable:function(){return!0},getGlobalPosition:function(){return this.$view.getPosition()},getGlobalPositionRefNode:function(){return this._getEditBoxReferenceNode().getPosition()},getParentComponent:function(){var a=this.getViewNode().getParent("[comp]");return a&&a.getLogic?a.getLogic():null},getParentSiteSegmentContainer:function(){if(this.isSiteSegment())return null;for(var a=this.getParentComponent();a&&!a.isSiteSegment();)a=a.getParentComponent();return a},isChildOfFixedPositionHeader:function(){var a=this.getParentSiteSegmentContainer();return a&&"wysiwyg.viewer.components.HeaderContainer"===a.$className&&a.isFixedPositioned()},isChildOfFooter:function(){var a=this.getParentSiteSegmentContainer();return a&&"wysiwyg.viewer.components.FooterContainer"===a.$className},isAnchorable:function(){return{to:{allow:!0,lock:Constants.BaseComponent.AnchorLock.BY_THRESHOLD},from:{allow:!0,lock:Constants.BaseComponent.AnchorLock.BY_THRESHOLD}}},isContainable:function(){return!0},isDeleteable:function(){return!0},isDuplicatable:function(){return!0},isDeleteableRecurse:function(){if(!this.isDeleteable())return!1;var a=this.getViewNode().getElements("[comp]");return this._isDeleteableRecurse(_.compact(_.pluck(a,"$logic")))},_isDeleteableRecurse:function(a){for(var b=0;b<a.length;b++)if(!a[b].isDeleteable())return!1;return!0},isMultiSelectable:function(){return!0},getShowOnAllPagesChangeability:function(){return this._showOnAllPagesChangeability},setShowOnAllPagesChangeability:function(a){this._showOnAllPagesChangeability=a},hasChildren:function(){return!1},canMoveToOtherScope:function(){return!0},isUsingExternalData:function(){return this._usesExternalData},onPageVisibilityChange:function(){},getID:function(){var a=this.$view.getProperty("id");return this._removeIdPrefix(a)}})}),define.Class("core.components.base.traits.OldBaseCompIntegration",function(a){var b=a;b.inherits("bootstrap.utils.Events"),b.binds(["_onReadyWhenCapturing","_onReadyForDomDisplay"]),b.methods({initialize:function(a,b){this._view=b,this._isRendered=!1,this.on(Constants.LifecycleSteps.FIRST_RENDER,this,this._OBCI_onRender),this.on(this.INVALIDATIONS.SIZE,this,this._OBCI_onSizeChange),(W.Config.isCapturing()||W.Config.isLoadedFromStatic())&&(this.addEvent(Constants.ComponentEvents.READY,this._onReadyWhenCapturing),this.$view.addEvent(Constants.ComponentEvents.DOM_DISPLAY_READY,this._onReadyForDomDisplay))},_onReadyWhenCapturing:function(){this.isDomDisplayReadyOnReady()&&this.$view.fireEvent(Constants.ComponentEvents.DOM_DISPLAY_READY)},_OBCI_onRender:function(){this.off(Constants.LifecycleSteps.FIRST_RENDER,this,this._OBCI_onRender),this._isRendered=!0,this.fireEvent(Constants.ComponentEvents.RENDER),this.$view.fireEvent(Constants.ComponentEvents.RENDER),this.fireEvent(Constants.ComponentEvents.READY),this.$view.fireEvent(Constants.ComponentEvents.READY),this.$view.trigger(Constants.ComponentEvents.READY)},_OBCI_onSizeChange:function(){this.fireEvent("autoSizeChange")},isDomDisplayReadyOnReady:function(){return!0},_onReadyForDomDisplay:function(){this._isReadyForDomDisplay=!0},isReadyForDomDisplay:function(){return!!this._isReadyForDomDisplay},isPartiallyFunctionalInStaticHtml:function(){return!1},isInvisibleInStaticHtml:function(){return!1},setStyle:function(a){this.setSkinMapper(a)},getStyle:function(){return this.getSkinMapper()},getIsDisposed:function(){return this._isExterminated},isRendered:function(){return this._isRendered},isReady:function(){return this._isRendered},getViewNode:function(){return this.$view},dispose:function(){this.exterminate()},isContainer:function(){return!1}})}),define.Class("core.components.base.traits.OldBaseCompLayoutIntegration",function(a){var b=a;b.utilize(["core.components.base.SizeLimits"]),b.statics({MINIMUM_X_DEFAULT:-2e3,MAXIMUM_X_DEFAULT:2e3,MINIMUM_Y_DEFAULT:-1e3,MAXIMUM_Y_DEFAULT:4e4,MINIMUM_WIDTH_DEFAULT:5,MINIMUM_HEIGHT_DEFAULT:5,MAXIMUM_WIDTH_DEFAULT:2500,MAXIMUM_HEIGHT_DEFAULT:2e3}),b.methods({initialize:function(){this._actualHeight=-1,this._anchors=[],this._reverseAnchors=[],this.initComponentLayout()},initComponentLayout:function(){this.$view.setStyle("visibility","visible");for(var a=this._getLayoutParamsArray(),b=!1,c=0;c<a.length;c++){var d=a[c],e=this.$view.get(d);null!=e&&""!==e&&(b=!0,"pos"!==d&&(e=Number(e)),this._setInitialValueToComp(d,e))}if(b&&this.$view.hasAttribute("pos")===!1)"relative"!=this.$view.getStyle("position")&&this.$view.setStyle("position","absolute");else{var f=this.$view.getAttribute("pos");f&&this.$view.setStyle("position",f)}this.saveCurrentDimensions(),this.saveCurrentCoordinates()},_setInitialValueToComp:function(a,b){switch(a){case"width":this.getRequestDimensions().width=b,this._setWidth_(b);break;case"height":this.getRequestDimensions().height=b,this._setHeight_(b);break;case"x":this.getRequestDimensions().left=b,this._setX_(b);break;case"y":this.getRequestDimensions().top=b,this._setY_(b);break;case"angle":this.getRequestDimensions().angle=b,this._setAngle_(b);break;case"pos":this._setPos_(b||"absolute");break;case"scale":this._setScale_(b)}},getMinPhysicalHeight:function(){return 1},saveCurrentDimensions:function(){this._lastDimensions={w:this.getWidth(),h:this.getHeight(),angle:this.getAngle()}},getCurrentDimensions:function(){return this._lastDimensions={w:this.getWidth(),h:this.getHeight(),angle:this.getAngle()},this._lastDimensions},getLastDimensions:function(){return this._lastDimensions||this.saveCurrentDimensions(),this._lastDimensions},getCurrentCoordinates:function(){return this._lastCoords={x:this.getX(),y:this.getY()},this._lastCoords},getLastCoordinates:function(){return this._lastCoords||this.saveCurrentCoordinates(),this._lastCoords},saveCurrentCoordinates:function(){this._lastCoords={x:this.getX(),y:this.getY()}},_onAutoSized:function(){},getIsDisplayed:function(){return this.isDisplayed()},checkVisibility:function(){return this.isDisplayed()},getSizeLimits:function(){return void 0===this._sizeLimits&&(this._sizeLimits=new this.imports.SizeLimits,this._sizeLimits.minW=this._sizeLimits.minW||this.MINIMUM_WIDTH_DEFAULT,this._sizeLimits.minH=this._sizeLimits.minH||this.MINIMUM_HEIGHT_DEFAULT,this._sizeLimits.maxW=this._sizeLimits.maxW||this.MAXIMUM_WIDTH_DEFAULT,this._sizeLimits.maxH=this._sizeLimits.maxH||this.MAXIMUM_HEIGHT_DEFAULT,this._originalSizeLimits=this._sizeLimits.clone()),this._sizeLimits},setMinW:function(a){this.getSizeLimits().minW=a,this._originalSizeLimits.minW=a,this._applySizeLimitsIfNeeded()},setMinH:function(a){this.getSizeLimits().minH=a,this._originalSizeLimits.minH=a,this._applySizeLimitsIfNeeded()},setMaxW:function(a){this.getSizeLimits().maxW=a,this._originalSizeLimits.maxW=a,this._applySizeLimitsIfNeeded()},setMaxH:function(a){this.getSizeLimits().maxH=a,this._originalSizeLimits.maxH=a,this._applySizeLimitsIfNeeded()},collapse:function(){this.$view&&this.$view.collapse()},uncollapse:function(a){this.$view&&this.$view.uncollapse(a)},_applySizeLimitsIfNeeded:function(){(this._$width<this.getSizeLimits().minW||this._$width>this.getSizeLimits().maxW)&&this.setWidth(this._$width),(this._$height<this.getSizeLimits().minH||this._$height>this.getSizeLimits().maxH)&&this.setHeight(this._$height)},_onResize:function(){this.fireEvent("resize")},flushPhysicalHeightCache:function(){delete this._actualHeight},flushMinPhysicalHeightCache:function(){delete this._minPhysicalHeight},getAnchors:function(){return this._anchors},setAnchors:function(a){this._anchors=a,a.forEach(this.addReverseAnchor)},addAnchor:function(a){this._anchors.push(a),this.addReverseAnchor(a)},addReverseAnchor:function(a){a.toComp===this?this._reverseAnchors.include(a):a.toComp.addReverseAnchor(a)},getReverseAnchors:function(){return this._reverseAnchors},getHorizontalGroup:function(){return this._horizontalGroup},setHorizontalGroup:function(a){this._horizontalGroup=a},_getLayoutParamsArray:function(){return["x","y","width","height","scale","angle","pos"]}})}),define.Class("core.components.image.ImageDimensions",function(a){var b=a;b.resources(["W.Config"]),b.statics({settingOptions:{crop:{FILL:"fill",FULL:"full",STRETCH:"stretch"},align:{LEFT:"left",CENTER:"center",RIGHT:"right"},v_align:{TOP:"top",MIDDLE:"middle",BOTTOM:"bottom"}}}),b.methods({initialize:function(){this._imageSettings={crop:this.settingOptions.crop.FILL,align:this.settingOptions.align.CENTER,v_align:this.settingOptions.v_align.MIDDLE}},getDimensionsForContainerSize:function(a,b,c){var d=this._getImageRequestSize(a,b,c),e=this._getImageObjectSize(d,b),f=this._getImageLeftPosition(e.x,b.x),g=this._getImageTopPosition(e.y,b.y);return{imageRequestSize:d,imageObjectSize:e,imageVisibleSize:{x:Math.min(b.x,d.x),y:Math.min(b.y,d.y)},imagePosition:{x:f,y:g}}},_getImageRequestSize:function(a,b,c){var d,e,f=a.x/a.y,g=b.x/b.y;if(this.resources.W.Config.env.isPublicViewer()&&!this._isFullScreenMode&&!c)return b;switch(this._imageSettings.crop){case this.settingOptions.crop.FILL:case this.settingOptions.crop.STRETCH:f>g?(e=b.y,d=e*f):(d=b.x,e=d/f);break;case this.settingOptions.crop.FULL:g>f?(e=b.y,d=e*f):(d=b.x,e=d/f)}return{x:Math.ceil(d),y:Math.ceil(e)}},_getImageObjectSize:function(a,b){var c=a;return this._imageSettings.crop===this.settingOptions.crop.STRETCH&&(c=b),c},_getImageLeftPosition:function(a,b){var c;switch(this._imageSettings.align){case this.settingOptions.align.LEFT:c=0;break;case this.settingOptions.align.CENTER:c=b/2-a/2;break;case this.settingOptions.align.RIGHT:c=b-a}return Math.ceil(c)},_getImageTopPosition:function(a,b){var c;switch(this._imageSettings.v_align){case this.settingOptions.v_align.TOP:c=0;break;case this.settingOptions.v_align.MIDDLE:c=b/2-a/2;break;case this.settingOptions.v_align.BOTTOM:c=b-a}return Math.ceil(c)},getCropMode:function(){return this._imageSettings.crop},getHorizontalAlign:function(){return this._imageSettings.align},getVerticalAlign:function(){return this._imageSettings.v_align},setCropMode:function(a){return this._setSettingsProperty(this.settingOptions.crop,"crop",a)},setHorizontalAlign:function(a){return this._setSettingsProperty(this.settingOptions.align,"align",a)},setVerticalAlign:function(a){return this._setSettingsProperty(this.settingOptions.v_align,"v_align",a)},_setSettingsProperty:function(a,b,c){return this._imageSettings[b]!==c&&this._isValueInObject(a,c)?(this._imageSettings[b]=c,!0):!1},_isValueInObject:function(a,b){for(var c in a)if(a[c]===b)return!0;return!1},setFullScreenMode:function(){this._isFullScreenMode=!0}})}),define.Class("core.components.image.ImageDimensionsNew",function(a){var b=a;b.utilize(["core.components.image.ImageSettings"]),b.methods({initialize:function(){this.ImageSettings=this.imports.ImageSettings},getDimensionsForExactSize:function(a,b){return this._getImageDimensions(a,b,!0)},getDimensionsForPyramid:function(a,b){return this._getImageDimensions(a,b,!1)},_getImageDimensions:function(a,b,c){var d=b.x/b.y,e=this._getContainerSize(a,d),f=this._getWholeImageSize(a,d,e,c),g=this._getImagePosition(f,e,a);return{containerSize:e,imageSize:f,imagePosition:g}},_getContainerSize:function(a,b){var c=a.getCropMode(),d=Object.clone(a.getSize());return c===this.ImageSettings.CropModes.FIT_WIDTH?d.y=this._getHeightByWidth(d.x,b):c===this.ImageSettings.CropModes.FIT_HEIGHT&&(d.x=this._getWidthByHeight(d.y,b)),d},_getWholeImageSize:function(a,b,c,d){var e=c.x/c.y,f=Object.clone(c),g=a.getCropMode();return g===this.ImageSettings.CropModes.CONTAINS?e>b?f.x=this._getWidthByHeight(c.y,b):f.y=this._getHeightByWidth(c.x,b):(g===this.ImageSettings.CropModes.STRETCH||!d&&g===this.ImageSettings.CropModes.COVER)&&(e>b?f.y=this._getHeightByWidth(c.x,b):f.x=this._getWidthByHeight(c.y,b)),f},_getImagePosition:function(a,b,c){if(c.getCropMode()==this.ImageSettings.CropModes.STRETCH)return{x:0,y:0};var d={};return d.y=Math.ceil((b.y-a.y)/2),d.x=Math.ceil((b.x-a.x)/2),d},_getHeightByWidth:function(a,b){return Math.ceil(a/b)},_getWidthByHeight:function(a,b){return Math.ceil(a*b)}})}),define.component("core.components.image.ImageNew",function(a){var b=a;b.dataTypes(["Image","ImageButton",""]),b.utilize(["core.components.image.ImageDimensionsNew","core.components.image.ImageUrlNew","core.components.image.ImageSettings"]),b.traits(["core.components.image.traits.ImageNewZoom"]),b.skinParts({image:{type:"htmlElement"}}),b.inherits("mobile.core.components.base.BaseComponent"),b.binds(["_onImageError"]),b.methods({initialize:function(a,b,c){this._initGlobalResources(),this.parent(a,b,c),this._useWebUrl=c.useWebUrl||!1,this._settings=c.settings,this._requestExactSize="boolean"==typeof c.requestExactSize?c.requestExactSize:!0,this._imageDimensions=new this.imports.ImageDimensionsNew,this._imageSrcBuilder=new this.imports.ImageUrlNew,this._imageUrl="",this._isSameImage=!1,this._retryCounter=0
},_initGlobalResources:function(){this._utils=this.injects().Utils},setSettings:function(a){a&&(this._settings=a,this._renderIfReady())},_onDataChange:function(a,b,c){this._isSameImage=this._imageUrl===a.get("uri"),this._imageUrl=a.get("uri"),this.parent(a,b,c)},_prepareForRender:function(){return this._settings&&this._imageUrl?(this._refreshImage(),!0):!0},_refreshImage:function(){var a,b,c;this._handleImageLoading(),this._skinParts.image.set("alt",this._data.get("alt")),this._handleImageLoadingError(),a=this._getImageDimensions(),this._setContainerSize(a.containerSize),b=this._imageUrl,this._isGIF()?b=this._getImageSrc(this._getOriginalSizeFromData()):this._isICO()?b=this._imageSrcBuilder.getImageAbsoluteUrlFromRelativeUrl(this._data.get("uri")):this._useWebUrl||this._imageUrl.test(/(^https?)|(^data)/)||this._isGIF()||(b=this._getImageSrc(a.imageSize,!this._isSameImage)),this._isSameImage=!0,this._setImageSrc(b),c=this._settings.getCropMode()===this._settings.CropModes.STRETCH?a.containerSize:a.imageSize,this._setImagePositionAndSize(a.imagePosition,c),this.fireEvent("refresh")},_getImageDimensions:function(){var a,b=this._getOriginalSizeFromData();return a=!this._requestExactSize||this._isGIF()||this._isZoomOn()?this._imageDimensions.getDimensionsForPyramid(this._settings,b):this._imageDimensions.getDimensionsForExactSize(this._settings,b)},_isGIF:function(){return this._imageUrl.test(/(\.gif$)/)},_isICO:function(){return this._imageUrl.test(/(\.ico$)/)},_getImageSrc:function(a,b){var c;if(this._requestExactSize)c=this._imageSrcBuilder.getImageUrlExactSize(a,this._imageUrl,this._getOriginalSizeFromData());else{var d=b?this._imageSrcBuilder.getImageUrlFromPyramidFirstTime(a,this._imageUrl):this._imageSrcBuilder.getImageUrlFromPyramidForSameImage(a,this._imageUrl,this._pyramidRequestSize);c=d.url,this._pyramidRequestSize=d.pyramidRequestSize}return c},_getOriginalSizeFromData:function(){var a={};return a.x=parseInt(this._data.get("width"),10),a.y=parseInt(this._data.get("height"),10),a.x||a.y||(a.x=a.y=128),a},_setContainerSize:function(a){this._utils.isEquivalent(this._containerSize,a)||(this.getViewNode().setStyles({width:a.x+"px",height:a.y+"px"}),this._containerSize=a)},getSize:function(){return this._containerSize},_setImageSrc:function(a){var b=this._skinParts.image;this._loadStart=LOG.getSessionTime(),this._getImagesPerformance().started++,this._isZoomOn()?(this._needToFetchFullImage()||this._imgSrc!==a)&&(b.set("src",a),this._imgSrc=a,this._loadFullImageInBackground()):(b.set("src",a),this._imgSrc=a)},_setImagePositionAndSize:function(a,b){this._skinParts.image.setStyles({"margin-top":a.y+"px","margin-left":a.x+"px",width:b.x+"px",height:b.y+"px"}),this._imageSize=b},getImageSize:function(){return this._imageSize},_isZoomOn:function(){return this._zoom},toggleZoom:function(){this._isZoomOn()?this.setZoomOff():this.setZoomOn()},setZoom:function(a){this._log("setZoom with flag: ",a),this._zoom=a,a?(this._bindEvents(),this._setImageSize(),this._setWrapperSize(),this._init(),this._prefetchFullImageIfNeeded()):this._reset()},setZoomOn:function(){this.setZoom(!0)},setZoomOff:function(){this.setZoom(!1)},_onImageError:function(){LOG.reportError(wixErrors.IMAGE_LOAD_ERROR,"ImageNew","refresh",this._imageUrl),this._retryCounter<2&&(this._retryCounter++,this._renderIfReady()),this._handleLoadEnd(!0)},_handleImageLoadingError:function(){this._skinParts.image.removeEvents("error"),this._skinParts.image.addEvent("error",this._onImageError)},_handleImageLoading:function(){this._skinParts.image.removeEvents("load"),this._skinParts.image.addEvent("load",function(){this._handleLoadEnd(!1)}.bind(this))},_handleLoadEnd:function(a){var b=this._getImagesPerformance(),c=LOG.getSessionTime(),d=this._skinParts.image.fileSize?parseInt(this._skinParts.image.fileSize,10):this._skinParts.image.width*this._skinParts.image.height;b.timing.push({url:this._skinParts.image.src,start:this._loadStart,end:c,hadError:a,width:this._skinParts.image.width,height:this._skinParts.image.height,size:d,speed:d/(c-this._loadStart)})},_getImagesPerformance:function(){return window._imagePerformance||(window._imagePerformance={started:0,timing:[]}),window._imagePerformance}})}),define.Class("core.components.image.ImageSettings",function(a){var b=a;b.statics({CropModes:{COVER:"fill",CONTAINS:"full",FIT_WIDTH:"fitWidth",FIT_HEIGHT:"fitHeight",STRETCH:"stretch"}}),b.methods({initialize:function(a,b,c){return this.setSettings(a,b,c)},setSettings:function(a,b,c){return this._validateSettings(a,b,c)?(this._cropMode=a,this._containerWidth=b,this._containerHeight=c,this):null},getCropMode:function(){return this._cropMode},getSize:function(){return{x:this._containerWidth,y:this._containerHeight}},setCropMode:function(a){this._validateSettings(a,this._containerWidth,this._containerHeight)&&(this._cropMode=a)},setSize:function(a,b){this._validateSettings(this._cropMode,a,b)&&(this._containerWidth=a,this._containerHeight=b)},setWidth:function(a){this._containerWidth=a},setHeight:function(a){this._containerHeight=a},setContainerHeight:function(a){this._validateSettings(this._cropMode,this._containerWidth,a)&&(this._containerHeight=a)},setContainerWidth:function(a){this._validateSettings(this._cropMode,a,this._containerHeight)&&(this._containerWidth=a)},validateSettings:function(){return this._validateSettings(this._cropMode,this._containerWidth,this._containerHeight)},_validateSettings:function(a,b,c){switch(a){case this.CropModes.FIT_WIDTH:return this._isValidNumber(b);case this.CropModes.FIT_HEIGHT:return this._isValidNumber(c);case this.CropModes.COVER:case this.CropModes.CONTAINS:case this.CropModes.STRETCH:return this._isValidNumber(c)&&this._isValidNumber(b);default:return!1}},_isValidNumber:function(a){return a&&"number"==typeof a&&!isNaN(a)&&a>0}})}),define.Class("core.components.image.ImageUrl",function(a){var b=a;b.resources(["W.Config"]),b.fields({SMALL_IMAGE_SIZE:80}),b.methods({getImageUrlExactSize:function(a,b,c){var d=a,e=this.resources.W.Config.getMediaStaticUrl(b)+b,f=this._getFileExtension(e),g=[e];return g.push("srz"),this._useProgressiveJpg()&&g.push("p"),this._isMobileView()&&(d=this._fetchLargerImagesForMobile(f,d)),d=this._getRequestSizeSmallerThanOriginal(d,c),g.push(parseInt(d.x,10)),g.push(parseInt(d.y,10)),g.push("85_22_0.50_1.20_0.00"),g.push(f),g.push("srz"),g.join("_")},_isMobileView:function(){var a=W.Config.env.$viewingDevice===Constants.ViewerTypesParams.TYPES.MOBILE;return a},_fetchLargerImagesForMobile:function(a,b){var c=_.clone(b),d=this._isMobileView(),e=!!W.Config.mobileConfig._getDevicePixelRatio(),f="png"===a.toLowerCase(),g=b.x<this.SMALL_IMAGE_SIZE||b.y<this.SMALL_IMAGE_SIZE;return d&&e&&(f||g||this._fetchImageForMobile)&&(c.x=b.x*W.Config.mobileConfig._getDevicePixelRatio(),c.y=b.y*W.Config.mobileConfig._getDevicePixelRatio()),c},getImageUrlFromPyramid:function(a,b,c,d){var e=this.getBaseImageUrl(b),f=a.y>a.x?a.y:a.x,g=this._getPyramidSize(f,c,d);return e=e+"_"+g,{url:e,pyramidRequestSize:g}},getBaseImageUrl:function(a){return this.resources.W.Config.getMediaStaticUrl(a)+a},setFetchImageForMobile:function(a){this._fetchImageForMobile=a},_getPyramidSize:function(a,b,c){for(var d=[128,256,400,512,650,850,1024],e=d[d.length-1],f=0;f<d.length;++f)if(d[f]>=a){e=d[f];break}return b&&(e=Math.max(e,c)||e),e},_getFileExtension:function(a){var b=/[.]([^.]+)$/.exec(a);return b&&/[.]([^.]+)$/.exec(a)[1]||""},_useProgressiveJpg:function(){return window.Browser.chrome||window.Browser.firefox},_getRequestSizeSmallerThanOriginal:function(a,b){var c=b.x/a.x,d=b.y/a.y,e={x:0,y:0};return c>=1&&d>=1?a:(d>c?(e.x=b.x,e.y=b.x*(a.y/a.x)):(e.y=b.y,e.x=b.y*(a.x/a.y)),e)}})}),define.Class("core.components.image.ImageUrlNew",function(a){var b=a;b.fields({SMALL_IMAGE_SIZE:80}),b.methods({initialize:function(){this._initGlobalResources()},_initGlobalResources:function(){this._config=this.injects().Config},getImageUrlExactSizeKeepRatio:function(a,b){var c=this._config.getMediaStaticUrl(b)+b,d=this._getFileExtension(c),e=[c];return e.push("srb"),e.push(parseInt(a.x,10)),e.push(parseInt(a.y,10)),e.push("75_22_0.50_1.20_0.00"),e.push(d),e.push("srb"),e.join("_")},getImageUrlExactSize:function(a,b,c){var d=a,e=this._config.getMediaStaticUrl(b)+b,f=this._getFileExtension(e);this._isMobileView()&&(d=this._fetchLargerImagesForMobile(f,a));var g=[e];g.push("srz"),this._useProgressiveJpg()&&g.push("p");var h=this._getRequestSizeSmallerThanOriginal(d,c);return g.push(parseInt(h.x,10)),g.push(parseInt(h.y,10)),g.push("75_22_0.50_1.20_0.00"),g.push(f),g.push("srz"),g.join("_")},_isMobileView:function(){var a=W.Config.env.$viewingDevice===Constants.ViewerTypesParams.TYPES.MOBILE;return a},_fetchLargerImagesForMobile:function(a,b){var c=_.clone(b),d=this._isMobileView(),e=!!W.Config.mobileConfig._getDevicePixelRatio(),f="png"===a.toLowerCase(),g=b.x<this.SMALL_IMAGE_SIZE||b.y<this.SMALL_IMAGE_SIZE;return d&&e&&(f||g||this._fetchImageForMobile)&&(c.x=b.x*W.Config.mobileConfig._getDevicePixelRatio(),c.y=b.y*W.Config.mobileConfig._getDevicePixelRatio()),c},_useProgressiveJpg:function(){return window.Browser.chrome||window.Browser.firefox},getImageAbsoluteUrlFromRelativeUrl:function(a){return this._config.getMediaStaticUrl(a)+a},getImageUrlFromPyramidFirstTime:function(a,b){return this._getUrlForPyramid(a,b)},getImageUrlFromPyramidForSameImage:function(a,b,c){return this._getUrlForPyramid(a,b,!0,c)},setFetchImageForMobile:function(a){this._fetchImageForMobile=a},_getRequestSizeSmallerThanOriginal:function(a,b){var c=b.x/a.x,d=b.y/a.y;if(c>=1&&d>=1)return a;var e={};return d>c?(e.x=b.x,e.y=b.x*(a.y/a.x)):(e.y=b.y,e.x=b.y*(a.x/a.y)),e},_getUrlForPyramid:function(a,b,c,d){var e=this._config.getMediaStaticUrl(b)+b,f=a.y>a.x?a.y:a.x,g=this._getPyramidSize(f,c,d);return e=e+"_"+g,{url:e,pyramidRequestSize:g}},_getPyramidSize:function(a,b,c){var d,e=[128,256,400,512,650,850,1024],f=e[e.length-1];for(d=0;d<e.length;++d)if(e[d]>=a){f=e[d];break}return b&&(f=Math.max(f,c)||f),f},_getFileExtension:function(a){var b=/[.]([^.]+)$/.exec(a);return b&&/[.]([^.]+)$/.exec(a)[1]||""}})}),define.Class("core.components.image.traits.ImageNewZoom",function(a){var b=a;b.binds(["_toggleZoom","_drag","_zoomOut","_setPrefetchedImage","_prefetchFullImageIfNeeded","_waitBeforeZoomOut","_onRefresh"]),b.statics({_DURATION:200,_STEPS:50,_CANCEL_ZOOM_TIMEOUT:1500,_MOUSE_EVENTS_FIXED:!1}),b.methods({_debug:!1,initialize:function(a,b,c){this.parent(a,b,c),this.addEvent("refresh",this._onRefresh)},_onRefresh:function(){this._isZoomOn()&&(this._setWrapperSize(),this._setImageSize(),this._init())},_loadFullImageInBackground:function(){var a=this._data._data.uri,b=this._imageSrcBuilder.getImageAbsoluteUrlFromRelativeUrl(a),c=new Image,d=new Date;this._prefetchStarted=!0,c.onload=this._setPrefetchedImage(b,d),c.src=b},_setPrefetchedImage:function(a){this._loadStart=LOG.getSessionTime(),this._getImagesPerformance().started++,this._skinParts.image.src=a,this._imgSrc=a,this._isFullImageLoaded=!0},_needToFetchFullImage:function(){return!this._isFullImageLoaded&&!this._prefetchStarted},_prefetchFullImageIfNeeded:function(){this._needToFetchFullImage()&&this._loadFullImageInBackground()},_setImageSize:function(){var a=this._data._data.width,b=this._data._data.height;this._imageOriginalSize={w:parseInt(a,10),h:parseInt(b,10)}},_setWrapperSize:function(a,b){var c=this.getSize(),d=this.getImageSize();c&&d&&(this._wrapperSize={w:a||c.x,h:b||c.y},this._imageSmallSize={w:a||d.x,h:b||d.y},this._maxMarginInfo={left:(this._wrapperSize.w-this._imageSmallSize.w)*(this._imageOriginalSize.w/this._imageSmallSize.w),top:(this._wrapperSize.h-this._imageSmallSize.h)*(this._imageOriginalSize.h/this._imageSmallSize.h)},this._initialInfo={marginLeft:.5*(this._wrapperSize.w-this._imageSmallSize.w),marginTop:.5*(this._wrapperSize.h-this._imageSmallSize.h)},this.fireEvent("resize",this.isOriginalImageSmallerThanWrapper()))},_bindEvents:function(){var a=this._skinParts.image.parentNode;a.addEvent("click",this._prefetchFullImageIfNeeded),a.addEvent("click",this._toggleZoom),a.addEvent("mousemove",this._drag),a.addEvent("mouseleave",this._waitBeforeZoomOut),this._areEventsBound=!0},_unbindEvents:function(){var a=this._skinParts.image.parentNode;a.removeEvents("click"),a.removeEvents("mousemove"),a.removeEvents("mouseleave"),this._areEventsBound=!1},_reset:function(){var a=this._skinParts.image.parentNode;this._zoomOut(),this._unbindEvents(),a.removeClass("zoomedin"),a.removeClass("zoomedout")},_init:function(){var a=this._skinParts.image.parentNode,b=this._skinParts.image;return this.isOriginalImageSmallerThanWrapper()?(this._unbindEvents(),a.removeClass("zoomedin"),a.removeClass("zoomedout"),void 0):(this._bindEvents(),this._initialInfo&&(b.style.marginLeft=this._initialInfo.marginLeft+"px",b.style.marginTop=this._initialInfo.marginTop+"px"),this._isZoomed=!1,a.addClass("zoomedout"),a.removeClass("zoomedin"),void 0)},isOriginalImageSmallerThanWrapper:function(){return this._logCurrentState(),!!this._imageOriginalSize&&!!this._wrapperSize&&(this._imageOriginalSize.w<this._wrapperSize.w||this._imageOriginalSize.h<this._wrapperSize.h)},_toggleZoom:function(a){this._logCurrentState(),this._clearZoomOutWaitTimeout(),this._isZoomed?this._zoomOut():this._zoomIn(a.event)},_zoomTimeout:function(a,b,c){var d=this,e=c/this._STEPS,f=d._skinParts.image;setTimeout(function(){f.style.width=d._currentInfo.maxWidth+((b?d._imageOriginalSize.w:d._imageSmallSize.w)-d._currentInfo.maxWidth)*e+"px",f.style.height=d._currentInfo.maxHeight+((b?d._imageOriginalSize.h:d._imageSmallSize.h)-d._currentInfo.maxHeight)*e+"px",f.style.marginLeft=d._currentInfo.marginLeft+(a.marginLeft-d._currentInfo.marginLeft)*e+"px",f.style.marginTop=d._currentInfo.marginTop+(a.marginTop-d._currentInfo.marginTop)*e+"px"},c*this._DURATION/this._STEPS)},_zoomIn:function(a){var b,c,d=this,e=d._skinParts.image;for(this._log("_zoomIn with event: ",a),this._setCurrentInfo(),b=this._getTargetPosition(a),c=1;c<=this._STEPS;c++)this._zoomTimeout(b,!0,c);setTimeout(function(){d._isZoomed=!0,d._setCurrentInfo()},this._DURATION),e.parentNode.addClass("zoomedin"),e.parentNode.removeClass("zoomedout")},_zoomOut:function(){var a,b=this;if(this._log("_zoomOut"),this._isZoomed&&(this._isZoomed=!1,null!==this._skinParts)){var c=b._skinParts.image;for(this._setCurrentInfo(),a=1;a<=this._STEPS;a++)this._zoomTimeout(this._initialInfo,!1,a);setTimeout(function(){b._setCurrentInfo()},this._DURATION),this._clearZoomOutWaitTimeout(),c.parentNode.addClass("zoomedout"),c.parentNode.removeClass("zoomedin")}},_drag:function(a){var b=this._skinParts.image,c=this._getTargetPosition(a.event);this._isZoomed&&(b.style.marginLeft=c.marginLeft+"px",b.style.marginTop=c.marginTop+"px",this._clearZoomOutWaitTimeout())},_waitBeforeZoomOut:function(){this._zoomOutWaitTimeout=setTimeout(this._zoomOut,this._CANCEL_ZOOM_TIMEOUT)},_clearZoomOutWaitTimeout:function(){null!==this._zoomOutWaitTimeout&&(window.clearTimeout(this._zoomOutWaitTimeout),this._zoomOutWaitTimeout=null)},_setCurrentInfo:function(){this._skinParts&&this._skinParts.image&&(this._currentInfo={label:"_currentInfo",marginLeft:parseInt(this._skinParts.image.style.marginLeft,10),marginTop:parseInt(this._skinParts.image.style.marginTop,10),maxWidth:parseInt(this._skinParts.image.style.width,10),maxHeight:parseInt(this._skinParts.image.style.height,10)})},_getTargetPosition:function(a){var b=this._skinParts.image.parentNode.getBoundingClientRect(),c=a.clientX-b.left,d=a.clientY-b.top,e={label:"_getTargetPosition",marginLeft:-(this._maxMarginInfo.left+this._imageOriginalSize.w-this._wrapperSize.w)*(c/this._wrapperSize.w)+this._maxMarginInfo.left/2,marginTop:-(this._maxMarginInfo.top+this._imageOriginalSize.h-this._wrapperSize.h)*(d/this._wrapperSize.h)+this._maxMarginInfo.top/2};return this._log("_getTargetEvent: ",{mouseX:c,mouseY:d,target:a.target.nodeName,targetPosition:e}),e},_log:function(a,b){this._debug&&(b?console.log(a,b):console.log(a))},_logCurrentState:function(){this._log({imageSrc:this._skinParts.image.src,_isZoomOn:this._isZoomOn(),_isZoomed:this._isZoomed,_imageOriginalSize:this._imageOriginalSize,_imageSmallSize:this._imageSmallSize,_wrapperSize:this._wrapperSize,_maxMarginInfo:this._maxMarginInfo,_initialInfo:this._initialInfo})}})}),define.Class("core.components.traits.TouchRollOverSupport",function(a){a.binds(["_onComponentTouchStart","_onStageTouchStart","_onRender","_onComponentReady"]),a.methods({initialize:function(){this._touchSupported="ontouchend"in document||this._swipeEmulate,this._touchSupported&&(this._states_.touchRollOverSupport=["touchRollOver","touchRollOut"],this.addEvent(Constants.ComponentEvents.READY,this._onComponentReady),this.addEvent(Constants.ComponentEvents.RENDER,this._onRender))},_onComponentReady:function(){this.setState("touchRollOut")},_onRender:function(){this._view.addEvent("touchstart",this._onComponentTouchStart),document.addEvent("touchstart",this._onStageTouchStart)},_onComponentTouchStart:function(a){-1!==this.getState().indexOf("touchRollOut")&&(a.preventDefault(),a.stopPropagation(),this.setState("touchRollOver"))},_onStageTouchStart:function(a){-1!==this.getState().indexOf("touchRollOver")&&-1===a.target.getParents().indexOf(this._view)&&a.target!==this._view&&this.setState("touchRollOut")},dispose:function(){document.removeEvent("touchstart",this._onStageTouchStart),this.parent()}})}),define.Class("core.events.EventDispatcher",function(a){var b=a;b.inherits("bootstrap.managers.events.EventDispatcherBase"),b.resources(["W.Commands","W.Config"]),b.methods({exterminate:function(){this.resources.W.Commands.unregisterListener(this),this.resources.W.Config.env.$isEditorFrame&&W.Preview&&W.Preview.getPreviewManagersAsync(function(a){a.Commands.unregisterListener(this);var b=a.Events._getObjectIdIfInMap_(this);b&&a.Events.deleteObjectFromMaps(b)},this),this.parent()}})}),define.experiment.component("core.components.Container.EditorLoadPerPage",function(a){var b=a;b.methods({addChild:function(a){var b,c=a.getParentComponent();c&&(b=c.getChildComponents().map(function(a){return a.get("id")})),a.getViewNode().insertInto(this.getInlineContentContainer()),c&&this._reportComponentsZOrderChanged(a,c,b),this.moveChild(a,this.Z_INDEX_CHANGE_TYPES.TOP),this._setPageIdToComponent(a),this._setDomLevelToComponent(a)},moveChildFromIndexToIndex:function(a,b,c){var d=this.getChildComponents().map(function(a){return a.get("id")});W.Utils.setChildIndex(this.getInlineContentContainer(),b,c),this._reportComponentsZOrderChanged(a,this,d)},_reportComponentsZOrderChanged:function(a,b,c){var d=b.getChildComponents().map(function(a){return a.get("id")}),e={subType:"explicitZOrderChange",changedComponentIds:[a.getComponentId()],oldState:{children:c},newState:{children:d}};this.injects().Commands.executeCommand("WViewerCommands.ComponentZIndexChanged",{editedComponent:a,urmData:e})}})}),define.experiment.component("core.components.Container.EditorMetaDataRelocation",function(a,b){var c=a,d=b;c.statics({EDITOR_META_DATA:{general:{settings:!0,design:!0},mobile:{allInputsHidden:!0}}}),c.fields({EDITOR_META_DATA:d.remove()})}),define.experiment.component("core.components.ContainerOBC.EditorLoadPerPage",function(a,b){var c=a;c.methods({addChild:function(a){var b,c=a.getParentComponent();c&&(b=c.getChildComponents().map(function(a){return a.get("id")})),a.getViewNode().insertInto(this.getInlineContentContainer()),c&&this._reportComponentsZOrderChanged(a,c,b),this.moveChild(a,this.Z_INDEX_CHANGE_TYPES.TOP),this._setPageIdToComponent(a),this._setDomLevelToComponent(a)},moveChildFromIndexToIndex:function(a,b,c){var d=this.getChildComponents().map(function(a){return a.get("id")});W.Utils.setChildIndex(this.getInlineContentContainer(),b,c),this._reportComponentsZOrderChanged(a,this,d)},_reportComponentsZOrderChanged:function(a,b,c){var d=b.getChildComponents().map(function(a){return a.get("id")}),e={subType:"explicitZOrderChange",changedComponentIds:[a.getComponentId()],oldState:{children:c},newState:{children:d}};this.injects().Commands.executeCommand("WViewerCommands.ComponentZIndexChanged",{editedComponent:a,urmData:e})}})}),define.experiment.component("core.components.ContainerOBC.EditorMetaDataRelocation",function(a,b){var c=a,d=b;c.fields({EDITOR_META_DATA:d.remove()}),c.statics({EDITOR_META_DATA:{general:{settings:!0,design:!0},mobile:{allInputsHidden:!0}}})}),define.experiment.component("core.components.Page.EditorMetaDataRelocation",function(a,b){var c=a,d=b;c.statics({EDITOR_META_DATA:{general:{settings:!0,design:!0,animation:!1}}}),c.fields({EDITOR_META_DATA:d.remove()})}),define.experiment.component("core.components.Page.LandingPageSupport",function(a){a.methods({isLanding:function(){return this._data.get("isLandingPage")||W.Config.$isMobileApp}})}),define.experiment.component("core.components.base.BaseComp.BoxSlideShow",function(a,b){var c=a,d=b;c.methods({initialize:d.after(function(){this._canBeNavigatedFromEditBox=!1})})}),define.experiment.component("core.components.base.BaseComp.EditorMetaDataRelocation",function(a){a.statics({EDITOR_META_DATA:{general:{settings:!0,design:!0,animation:!0},custom:[],dblClick:{},mobile:{}}})}),define.experiment.component("core.components.base.BaseComp.SocialActivity",function(a,b){a.traits(b.merge(["core.components.base.traits.BaseCompSocialActivity"]))}),define.experiment.Class("core.components.base.traits.BaseCompBehaviors.AnimationPageTransitions",function(a,b){var c=a,d=b;c.binds(["_initializeBehaviors"]),c.fields({_behaviors:null,_actionManager:null}),c.methods({initialize:function(){this.resources.W.Config.env.$isEditorFrame||resource.getResourceValue("W.Actions",function(a){this._actionsManager=a,this._actionsManager.isAnyActionsEnabledForSession()&&this._initializeBehaviors()}.bind(this))},setBehaviors:function(a){return this._behaviors=a?"string"==typeof a?JSON.parse(a):a:null,this._updateBehaviorsRegistration(),this.getBehaviors()},getBehaviors:function(){return this._behaviors?_.cloneDeep(this._behaviors):null},_initializeBehaviors:function(){var a;a=this.$view.$behaviors,a&&(this.setBehaviors(a),this._removeBehaviorsFromViewNode(),this._initializeBehaviorListeners())},_initializeBehaviorListeners:function(){this.on(Constants.ComponentEvents.PAGE_ID_CHANGED,this,this._updateBehaviorsRegistration),this.on(Constants.EventDispatcher.Events.EXTERMINATING,this,this._removeBehaviorsRegistration)},_updateBehaviorsRegistration:function(){var a=this.$view.$pageId,b=this.getBehaviors();this._actionsManager.registerComponent(a,this,b)},_removeBehaviorsRegistration:function(){this._behaviors&&this._actionsManager.registerComponent(null,this,null)},_removeBehaviorsFromViewNode:function(){delete this.$view.$behaviors},initializeBehaviors:d.remove(),updateBehaviorsRegistration:d.remove(),removeBehaviorsRegistration:d.remove(),removeBehaviorsFromViewNode:d.remove()})}),define.experiment.Class("core.components.base.traits.BaseCompBehaviors.BoxSlideShow",function(a,b){var c=a,d=b;c.methods({initialize:d.after(function(){this.on(Constants.ComponentEvents.REMOVE_ANIMATION_ON_ADD_BOX,this,this.removeBehaviorsRegistration),this.on(Constants.ComponentEvents.RETURN_ANIMATION_ON_REMOVE_FROM_BOX,this,this.updateBehaviorsRegistration)})})}),define.experiment.Class("core.components.base.traits.BaseCompLayout.BoxSlideShow",function(a,b){var c=a;c.methods({showNavigationOnEditBox:function(){return this._canBeNavigatedFromEditBox},getComponentDependantType:function(){return!!this.isCompDependentOnOtherComp},overrideSelectableOnDelete:function(){return!!this.overrideIsSelectableOnDelete},waitTillMeasureToPreformLayoutChanges:function(){return!!this._needToWaitTillMeasure},canBeDraggedIntoBoxSlideShow:function(){return!0}})}),define.experiment.Class("core.components.base.traits.BaseCompSkinHandler.AppsWPhotoNBC",function(a){var b=a;b.statics({_definitionFieldName_:"_skinParts_",_fieldName_:"skinParts",_aggregateSchema_:function(a,b,c){if((!a||a&&"object"!==typeOf(a))&&(a={}),b&&"object"===typeOf(b)&&Object.merge(a,b),c&&"object"===typeOf(c))for(var d in c)delete a[d];return a}}),b.methods({setSkin:function(a,b){this._removeOldSkinAndExtractInlineContent(),this._skin=a,this._skin._setLogic_(this,b)}})}),define.experiment.newClass("core.components.base.traits.BaseCompSocialActivity.SocialActivity",function(a){var b=a;b.methods({initialize:function(){W.Config.env.$isEditorFrame||(this._helper||(this._helper=new this.imports.BaseCompDataHandlerHelper),this._socialData=null,this._initSocialDataFromNode(),this.on(Constants.EventDispatcher.Events.EXTERMINATING,this,this._exterminateSocialData))},_initSocialDataFromNode:function(){if(this.$view.getAttribute("socialQuery")){var a=W.SocialActivityDataManager.getDataByQuerey(this.$view.getAttribute("socialQuery"));this.setSocialDataItem(a)}},getSocialDataItem:function(){return console.log("base comp:",this._socialData),this._socialData},setSocialDataItem:function(a){this._helper.connectDataItemToComponent(a,this._socialData,this,this._onCompSocialDataChanged)&&(this._socialData=a,this.$view.setAttribute("socialQuery","#"+this._socialData.get("id")),this.invalidate(this.INVALIDATIONS.SOCIAL_DATA_CHANGE,this._helper.getChangesObjectWhenNewItem(a),!0))},removeSocialDataItem:function(){this.$view.removeAttribute("socialQuery"),this._exterminateSocialData()},_onCompSocialDataChanged:function(a){var b=this._helper.getChangesObject(a);this.invalidate(this.INVALIDATIONS.SOCIAL_DATA_CHANGE,b,!0)},hasSocialDataFieldBeenInvalidated:function(a,b){return this._helper.isFieldInvalidated(a,b,this.INVALIDATIONS.SOCIAL_DATA_CHANGE)},_exterminateSocialData:function(){this._helper.disconnectDataItemFromComponent(this,this._socialData)}})}),define.experiment.component("core.components.image.ImageNew.AppsWPhotoNBC",function(a){var b=a;b.methods({setSettings:function(a){a&&a.getIsValid()&&(this._settings=a,this._renderIfReady())},_prepareForRender:function(){return this._settings&&this._settings.getIsValid()&&this._imageUrl?(this._refreshImage(),!0):!0}})}),define.experiment.component("core.components.image.ImageNew.FaviconURL",function(a,b){var c=a,d=b;c.methods({initialize:d.after(function(){this._mediaType="",this._thumbnailUrl=""}),_onDataChange:d.before(function(a){this._mediaType=a.get("mediaType"),this._thumbnailUrl=a.get("thumbnailUrl")}),_isICO:function(){return this._mediaType&&"site_icon"===this._mediaType||this._thumbnailUrl&&this._thumbnailUrl.test("ficons/")||this._imageUrl.test(/(\.ico$)/)},_refreshImage:function(){var a,b,c;this._handleImageLoading(),this._skinParts.image.set("alt",this._data.get("alt")),this._handleImageLoadingError(),a=this._getImageDimensions(),this._setContainerSize(a.containerSize),b=this._imageUrl,this._isGIF()?b=this._getImageSrc(this._getOriginalSizeFromData()):this._isICO()?b=this._imageUrl.test(/(\.ico$)/)||!this._thumbnailUrl?this._imageSrcBuilder.getImageAbsoluteUrlFromRelativeUrl(this._imageUrl):this._thumbnailUrl:this._useWebUrl||this._imageUrl.test(/(^https?)|(^data)/)||this._isGIF()||(b=this._getImageSrc(a.imageSize,!this._isSameImage)),this._isSameImage=!0,this._setImageSrc(b),c=this._settings.getCropMode()===this._settings.CropModes.STRETCH?a.containerSize:a.imageSize,this._setImagePositionAndSize(a.imagePosition,c),this.fireEvent("refresh")}})}),define.experiment.component("core.components.image.ImageNew.NBC_ImageNew",function(a){var b=a;b.inherits("core.components.base.BaseComp"),b.statics({_useWidthOverMinWidth:!0,_useHeightOverMinHeight:!0,SETTINGS_CHANGE_INVALIDATION:"settingsChanged"}),b.methods({isRenderNeeded:function(a){var b=[this.INVALIDATIONS.SKIN_CHANGE,this.INVALIDATIONS.DATA_CHANGE,this.SETTINGS_CHANGE_INVALIDATION,this.INVALIDATIONS.SIZE];return a.isInvalidated(b)},setSettings:function(a){a&&(this._settings=a,this.invalidate(this.SETTINGS_CHANGE_INVALIDATION,this._settings))},_onRender:function(a){var b=a.data.invalidations,c=!1;if(b.isInvalidated([this.INVALIDATIONS.DATA_CHANGE])&&(this._isSameImage=this._imageUrl===this._data.get("uri"),this._imageUrl=this._data.get("uri"),c=!0),this._settings&&this._settings._isSizeCalculated&&b.isInvalidated([this.INVALIDATIONS.SIZE])){var d=this.getMeasure();_.isEqual({x:d.width,y:d.height},this._settings.getSize)||(this._settings.setSize(d.width,d.height),c=!0)}b.isInvalidated([this.SETTINGS_CHANGE_INVALIDATION])&&(c=!0),c&&this._settings&&this._imageUrl&&this._settings.validateSettings()&&this._refreshImage()},_refreshImage:function(){var a,b,c;this._handleImageLoading(),this._skinParts.image.set("alt",this._data.get("alt")),this._handleImageLoadingError(),a=this._getImageDimensions(),this._setContainerSize(a.containerSize),b=this._getImageSrc(a),this._isSameImage=!0,this._setImageSrc(b),c=this._settings.getCropMode()===this._settings.CropModes.STRETCH?a.containerSize:a.imageSize,this._setImagePositionAndSize(a.imagePosition,c),this.fireEvent("refresh")},_getImageDimensions:function(){var a,b=this._getOriginalSizeFromData();return a=this._requestExactSize&&!this._isLoadingOriginalImage()?this._imageDimensions.getDimensionsForExactSize(this._settings,b):this._imageDimensions.getDimensionsForPyramid(this._settings,b)},_getImageSrc:function(a){var b;return b=this._imageUrl.test(/(^https?)|(^data)/)?this._imageUrl:this._isLoadingOriginalImage()?this._imageSrcBuilder.getImageAbsoluteUrlFromRelativeUrl(this._data.get("uri")):this._getImageSrcWithCrop(a.imageSize,!this._isSameImage)},_getImageSrcWithCrop:function(a,b){var c;if(this._requestExactSize)c=this._imageSrcBuilder.getImageUrlExactSize(a,this._imageUrl,this._getOriginalSizeFromData());else{var d=b?this._imageSrcBuilder.getImageUrlFromPyramidFirstTime(a,this._imageUrl):this._imageSrcBuilder.getImageUrlFromPyramidForSameImage(a,this._imageUrl,this._pyramidRequestSize);c=d.url,this._pyramidRequestSize=d.pyramidRequestSize}return c},_setImageSrc:function(a){var b=this._skinParts.image;this._loadStart=LOG.getSessionTime(),this._getImagesPerformance().started++;var c=this._imgSrc!==a;c&&(b.set("src",a),this._imgSrc=a),this._isZoomOn()&&(this._needToFetchFullImage()||c)&&this._loadFullImageInBackground()},_isLoadingOriginalImage:function(){return this._isGIF()||this._isICO()||this._isZoomOn()},_setContainerSize:function(a){_.isEqual(this._containerSize,a)||(this._settings._isSizeCalculated||(this.setHeight(a.y),this.setWidth(a.x)),this._containerSize=a)}})}),define.experiment.Class("core.components.image.ImageSettings.AppsWPhotoNBC",function(a){var b=a;b.methods({setSettings:function(a,b,c){return this._validateSettings(a,b,c)?(this._isValid=!0,this._cropMode=a,this._containerWidth=b,this._containerHeight=c,this):(this._isValid=!1,null)},getIsValid:function(){return this._isValid},setCropMode:function(a){this._validateSettings(a,this._containerWidth,this._containerHeight)&&(this._cropMode=a,this._isValid=!0)},setSize:function(a,b){this._validateSettings(this._cropMode,a,b)&&(this._containerWidth=a,this._containerHeight=b,this._isValid=!0)},setContainerHeight:function(a){this._validateSettings(this._cropMode,this._containerWidth,a)&&(this._containerHeight=a,this._isValid=!0)},setContainerWidth:function(a){this._validateSettings(this._cropMode,a,this._containerHeight)&&(this._containerWidth=a,this._isValid=!0)}})}),define.experiment.Class("core.components.image.ImageSettings.NBC_ImageNew",function(a){var b=a;b.methods({initialize:function(a,b,c,d){return this._isSizeCalculated=!1,d?this.setSettingsForCalculatedSize(a):this.setSettings(a,b,c)},setSettingsForCalculatedSize:function(a){return this._cropMode=a,this._containerWidth=0,this._containerHeight=0,this._isSizeCalculated=!0,this}})}),define.experiment.Class("core.components.image.ImageUrl.ViewerImageParamChange",function(a,b){var c=a;c.resources(["W.Utils","W.Config"]),c.methods({getImageUrlExactSize:function(a,b,c){var d=a,e=this.resources.W.Config.getMediaStaticUrl(b)+b;return this._isMobileView()&&(d=this._fetchLargerImagesForMobile(this._getFileExtension(e),d)),d=this._getRequestSizeSmallerThanOriginal(d,c),this.getImageUrl(d,c,e)
},getImageUrl:function(a,b,c){var d=[c],e=b.x===a.x&&b.y===a.y,f=this.resources.W.Utils.getQueryParam("quality")||"85",g=this.resources.W.Utils.getQueryParam("sharpness")||(e?"0.00_0.00_0.00":"0.50_1.20_0.00"),h=this._getFileExtension(c);return d.push("srz"),this._useProgressiveJpg()&&d.push("p"),d.push(parseInt(a.x,10)),d.push(parseInt(a.y,10)),d.push(f),d.push("22"),d.push(g),d.push(h),d.push("srz"),d.join("_")}})}),define.experiment.Class("core.components.image.ImageUrlNew.ViewerImageParamChange",function(a,b){var c=a;c.resources(["W.Utils"]),c.methods({getImageUrlExactSize:function(a,b,c){var d=a,e=this._config.getMediaStaticUrl(b)+b;return this._isMobileView()&&(d=this._fetchLargerImagesForMobile(this._getFileExtension(e),d)),d=this._getRequestSizeSmallerThanOriginal(d,c),this.getImageUrl(d,c,e)},getImageUrl:function(a,b,c){var d=[c],e=b.x===a.x&&b.y===a.y,f=this.resources.W.Utils.getQueryParam("quality")||"85",g=this.resources.W.Utils.getQueryParam("sharpness")||(e?"0.00_0.00_0.00":"0.50_1.20_0.00"),h=this._getFileExtension(c);return d.push("srz"),this._useProgressiveJpg()&&d.push("p"),d.push(parseInt(a.x,10)),d.push(parseInt(a.y,10)),d.push(f),d.push("22"),d.push(g),d.push(h),d.push("srz"),d.join("_")}})}),define.experiment.newClass("core.datatypes.BasicMenuItemDataClass.CustomSiteMenu",function(a){var b=a;b.inherits("core.managers.data.DataItemWithSchema"),b.resources(["W.Data","W.Utils"]),b.methods({initialize:function(a,b,c,d){this.parent(c,a,b,d),this._convertItems()},_convertItems:function(){var a,b=this._data.items||[];for(a=0;a<b.length;a++)if("string"==typeof b[a]&&!this.resources.W.Data.isDataAvailable(b[a]))return this.resources.W.Utils.callLater(this._convertItems,null,this),void 0;for(this._data.items=[],a=0;a<b.length;a++)this._data.items.push("string"==typeof b[a]?this.resources.W.Data.getDataByQuery(b[a]):b[a]);this._isReady=!0},isReady:function(){return this._isReady},isVisible:function(a){return a?this.get("isVisibleMobile"):this.get("isVisible")},isVisibleMobile:function(){return this.isVisible(!0)},getLabel:function(){return this.get("label")},getItems:function(){return this.get("items")||[]},hasItems:function(){return this.getItems().length>0},hasVisibleItems:function(a){var b,c=this.getItems();for(b=0;b<c.length;b++)if(c[b].isVisible(a))return!0;return!1},hasVisibleItemsMobile:function(){return this.hasVisibleItems(!0)},setLabelAndVisibility:function(a,b,c){this.setFields({label:a,isVisible:b,isVisibleMobile:c})},getLinkedDataItem:function(){var a=this.get("link");return a?this.resources.W.Data.getDataByQuery(a):null},getLinkedDataItemType:function(){var a=this.getLinkedDataItem();return a?a.getType():null},isLinkedToType:function(a){var b=this.getLinkedDataItemType();return b===a},isValueInLinkedDataItem:function(a){return _.contains(this.getLinkedDataItem().getData(),a)},cloneData:function(){return{id:this.get("id"),isVisible:this.get("isVisible"),isVisibleMobile:this.get("isVisibleMobile"),label:this.get("label"),link:this.get("link"),type:this._dataType,metaData:this._data.metaData,items:_.reduce(this.get("items"),function(a,b){return a.push("#"+b.get("id")),a},[])}}})}),define.experiment.newDataSchema("BasicMenuItem.CustomSiteMenu",function(){return{link:"ref",items:"list",label:"string",isVisible:{type:"boolean","default":!0},isVisibleMobile:{type:"boolean","default":!0},dataClassRef:"core.datatypes.BasicMenuItemDataClass"}}),define.experiment.newClass("core.datatypes.CustomMenuDataClass.CustomMenu",function(a){var b=a;b.inherits("core.datatypes.NavigationTreeDataClass"),b.methods({_convertRawItemsToMenuItems:function(a,b){var c,d,e,f;for(c=0;c<a.length;c++)d=a[c],e={link:d.refId,items:[],type:"BasicMenuItem"},f=this.resources.W.Data.createDataItem(e),b.push(f),d.items&&d.items.length>0&&this._convertRawItemsToMenuItems(d.items,f.get("items"))},_createNavigationItem:function(a,b){var c={link:a,items:[],type:"BasicMenuItem",label:b};return this.resources.W.Data.addDataItemWithUniqueId("nav_item_",c).dataObject},createAndAddNavigationItem:function(a,b,c,d){var e=this._createNavigationItem(a,d),f=this.getItemByRefId(b);return this.addItem(e,b,c),this.fireDataChangeEvent({cause:"CREATED_AND_ADDED",parentItem:f,item:e}),e},deleteNavigationItemById:function(a){var b,c,d=this.getItemById(this.getItems(),a),e=this.getItemParent(d,this),f=e.get("items"),g=d.get("items"),h=f.indexOf(d);if(g)for(b=0;g.length>0;)c=g[0],this._moveItem(c,e,h+b),b++;f.erase(d),this.fireDataChangeEvent({cause:"DELETE",item:d})},getItemById:function(a,b){var c,d,e;for(c=0;c<a.length;c++){if(d=a[c],d.get("id")===b)return d;if(d.get("items")&&d.get("items").length>0&&(e=this.getItemById(d.get("items"),b)))return e}},getAllItemRefIds:function(){var a=this.getAllItems();return _.map(a,function(a){return a.get("link").slice(1)})},_getItemFromItemsByRefId:function(a,b){var c,d,e;for(c=0;c<a.length;c++){if(d=a[c],d.get("link")===b)return d;if(d.get("items")&&d.get("items").length>0&&(e=this._getItemFromItemsByRefId(d.get("items"),b)))return e}},_moveItem:function(a,b,c){var d=b?b.get("link"):null,e=this.getItemParent(a,this),f=e.get("items");this._addBIonMovedPageToBeSubPage(d,e),f.erase(a),this.addItem(a,d,c)},_addBIonMovedPageToBeSubPage:function(a,b){!a||b&&b.get("link")||LOG.reportEvent(wixEvents.MOVED_PAGE_TO_BE_SUB_PAGE)},cloneSingleItem:function(a){return{link:a.get("link"),items:[]}},getWaitingForReadyList:function(){var a,b,c,d,e=[],f=this.getAllItems();for(a=0;a<f.length;a++)b=f[a],c=b.get("link"),d=this.resources.W.Data.isDataAvailable(c),d||e.push(c);return e}})}),define.experiment.newDataSchema("CustomMenu.CustomSiteMenu",function(){return{name:"string",items:{type:"refList","default":[]}}}),define.experiment.newDataSchema("CustomMenusCollection.CustomSiteMenu",function(){return{menus:{type:"refList","default":[]}}}),define.experiment.dataSchema("Image.FaviconURL",function(a){return a.customizeField(function(a){return a.thumbnailUrl="string",a.mediaType="string",a})}),define.experiment.newDataSchema("Item301redirect.RedirectFeature301Data",function(){return{fromExternalUri:"string",toWixUri:"string"}}),define.experiment.Class("core.datatypes.NavigationTreeDataClass.CustomSiteMenu",function(a,b){var c=a,d=b;c.resources(["W.Data","W.Utils"]),c.methods({initialize:d.after(function(){this.resources.W.Data.isDataAvailable("#CUSTOM_MAIN_MENU")||this.convertMenuItemsToBasicMenuItems()}),getItems:function(a){return this._data.items||(this._data.items=[]),a?this._data.items:this.isConverted()?this._getPages():this._data.items},getAllItems:function(a){var b=this.getItems(a),c=[];return this._collectInternalItems(b,c)},createAndAddNavigationItem:function(a,b,c,d){var e=this._createNavigationItem(a,d),f=this.getItemByRefId(b,!0),g=f&&"#"+f.get("id");return this.addItem(e,g,c),this.fireDataChangeEvent({cause:"CREATED_AND_ADDED",parentItem:f,item:e}),e},addItem:function(a,b,c){b?this._addSubItem(a,b,c):"number"==typeof c?this.getItems(!0).splice(c,0,a):this.getItems(!0).push(a),this._clearPages()},getItemLevel:function(a,b,c){var d,e;for(d=b?b.get("items"):this.getItems(!0),c||(c=0),e=0;e<d.length;e++){var f=d[e];if(f===a)return c;if(f.get("items")&&f.get("items").length>0){var g=this.getItemLevel(a,f,c+1);if("number"==typeof g)return g}}},deleteNavigationItem:function(a){var b=this.getItemByRefId(a,!0);this.deleteNavigationItemByDataItem(b)},deleteNavigationItemById:function(a){var b=this.getItemById(this.getItems(),a);this.deleteNavigationItemByDataItem(b)},deleteNavigationItemByDataItem:function(a){var b,c,d=this.getItemParent(a,this),e=d.get("items"),f=a.get("items"),g=e.indexOf(a);if(f)for(b=0;f.length>0;)c=f[0],this._moveItem(c,d,g+b),b++;e.erase(a),this.fireDataChangeEvent({cause:"DELETE",item:a})},getItemById:function(a,b){var c,d,e;for(c=0;c<a.length;c++){if(d=a[c],d.get("id")===b)return d;if(d.get("items")&&d.get("items").length>0&&(e=this.getItemById(d.get("items"),b)))return e}},getItemParentByRedId:d.remove(),getItemParentByRefId:function(a){var b=this.getItemByRefId(a,!0);return this.getItemParent(b)},isSubItemByRefId:function(a){var b=this.getItemByRefId(a,!0),c=this.getItemParent(b);return c!==this},getItemByRefId:function(a,b){return a?"#MAIN_MENU"===a?this:b?this._getRealInstanceItemByRefId(this.getItems(!0),a):this._getItemFromItemsByRefId(this._getPages(),a):null},_getRealInstanceItemByRefId:function(a,b){var c,d,e,f=0;for(f;f<a.length;f++){if(c=a[f],"#"+c.get("id")===b)return c;if(c.isValueInLinkedDataItem(b))return c;if(e=c.get("items"),e&&e.length>0&&(d=this._getRealInstanceItemByRefId(e,b)))return d}},_addSubItem:function(a,b,c){var d="string"==typeof b?this.getItemByRefId(b,!0):b,e=d.get("items");"number"==typeof c?e.splice(c,0,a):e.push(a)},_moveItem:function(a,b,c){var d=b?"#"+b.get("id"):null,e=this.getItemParent(a,this),f=e.get("items");this._addBIonMovedPageToBeSubPage(d,e),f.erase(a),this.addItem(a,b,c)},_createNavigationItem:function(a,b){return"string"==typeof a?"#CUSTOM_MENU_HEADER"===a?this._createNavigationItemWithLink("#CUSTOM_MENU_HEADER",b,!0,!0):this._createPageNavigationItem(a):a.id&&a.dataObject?this._createNavigationItemWithLink("#"+a.id,b,!0,!0):this._createLinkNavigationItem(a,b,!0,!0)},_createPageNavigationItem:function(a){var b=this.resources.W.Data.getDataByQuery(a),c=b.get("title"),d=!b.get("hidePage"),e=!b.get("mobileHidePage"),f=this._createLinkNavigationItem({type:"PageLink",pageId:a},c,d,e);return b.on(Constants.DataEvents.DATA_CHANGED,f,this._onPageDataChange),f},_createLinkNavigationItem:function(a,b,c,d){var e=this.resources.W.Data.addDataItemWithUniqueId("",a);return this._createNavigationItemWithLink("#"+e.id,b,c,d)},_createNavigationItemWithLink:function(a,b,c,d){return this.resources.W.Data.addDataItemWithUniqueId("bmi",{label:b,link:a,items:[],isVisible:c,isVisibleMobile:d,type:"BasicMenuItem"}).dataObject},convertIdsToBasicMenuItems:function(){var a,b,c=this.resources.W.Data.getDataByQuery("#CUSTOM_MAIN_MENU"),d=c.get("items");if(d=_.reject(d,function(a){return!a||"#undefined"===a}),!this._convertedToBasicMenuItems){for(a=0;a<d.length;a++)if(b=this.resources.W.Data.getDataByQuery(d[a]),!b||!b.isReady())return this.resources.W.Utils.callLater(this.convertIdsToBasicMenuItems,null,this),void 0;for(this._data.items=[],a=0;a<d.length;a++)this._data.items.push(this.resources.W.Data.getDataByQuery(d[a]));this._convertedToBasicMenuItems=!0}},convertMenuItemsToBasicMenuItems:function(){var a=this.getItems();return this._convertedToBasicMenuItems?this:(this._data.items=[],a.forEach(function(a){this._data.items.push(this._convertMenuItemToBasicMenuItem(a))}.bind(this)),this._convertedToBasicMenuItems=!0,this._updateCustomMainMenu(),this)},_convertMenuItemToBasicMenuItem:function(a){var b,c=a.get("refId"),d=this.resources.W.Data.addDataItemWithUniqueId("",{type:"PageLink",pageId:c}),e=[];return a.get("items").forEach(function(a){e.push(this._convertMenuItemToBasicMenuItem(a))}.bind(this)),b=this.resources.W.Data.addDataItemWithUniqueId("bmi",{link:"#"+d.id,label:"",items:e,type:"BasicMenuItem"}).dataObject,this.resources.W.Data.getDataByQuery(c,function(a){b.setLabelAndVisibility(a.get("title"),!a.get("hidePage"),!a.get("mobileHidePage")),a.on(Constants.DataEvents.DATA_CHANGED,b,this._onPageDataChange)}.bind(this)),b},_onPageDataChange:function(a){switch(a.data.field){case"hidePage":this.set("isVisible",!a.data.newValue.hidePage);break;case"mobileHidePage":this.set("isVisibleMobile",!a.data.newValue.mobileHidePage);break;case"title":this.set("label",a.data.newValue.title)}},fireDataChangeEvent:d.before(function(){this._pages=null,this._updateCustomMainMenu()}),_getPages:function(){var a=[];return this._pages?this._pages:(this._data.items.forEach(function(b){this._addConvertedMenuItem(b,a)}.bind(this)),this._pages=a,a)},_clearPages:function(){this._pages=null},_convertBasicMenuItemToMenuItem:function(a){var b=a.getLinkedDataItem(),c=b&&b.getType(),d=[];if("PageLink"===c)return a.get("items").forEach(function(a){this._addConvertedMenuItem(a,d)}.bind(this)),this._createMenuItem(b.get("pageId"),d)},_addConvertedMenuItem:function(a,b){"PageLink"===a.getLinkedDataItemType()?b.push(this._convertBasicMenuItemToMenuItem(a)):a.get("items").forEach(function(a){this._addConvertedMenuItem(a,b)}.bind(this))},_createMenuItem:function(a,b){var c={refId:a,items:b,type:"MenuItem"};return this.resources.W.Data.createDataItem(c)},isConverted:function(){return this._convertedToBasicMenuItems},cloneData:function(){return{type:this._dataType,metaData:this._data.metaData,id:"MAIN_MENU",items:[]}},getItemIdsList:function(){return _.reduce(this.getItems(!0),function(a,b){return a.push("#"+b.get("id")),a},[])},_updateCustomMainMenu:function(){this._populateCustomMainMenu(),this._addCustomMenuToCollection()},_populateCustomMainMenu:function(){var a;a=this.resources.W.Data.isDataAvailable("#CUSTOM_MAIN_MENU")?this.resources.W.Data.getDataByQuery("#CUSTOM_MAIN_MENU"):this.resources.W.Data.addDataItemWithId("CUSTOM_MAIN_MENU",{type:"CustomMenu",name:"Custom Main Menu"}),a.set("items",this.getItemIdsList())},_addCustomMenuToCollection:function(){var a;a=this.resources.W.Data.isDataAvailable("#CUSTOM_MENUS")?this.resources.W.Data.getDataByQuery("#CUSTOM_MENUS"):this.resources.W.Data.addDataItemWithId("CUSTOM_MENUS",{type:"CustomMenusCollection"}),_.contains(a.get("menus"),"#CUSTOM_MAIN_MENU")||a.get("menus").push("#CUSTOM_MAIN_MENU")},_isCustomMainMenuReady:function(){var a,b=this.resources.W.Data.getDataByQuery("#CUSTOM_MAIN_MENU"),c=b.get("items");for(a=0;a<c.length;a++)if(!this.resources.W.Data.isDataAvailable(c[a]))return!1;return!0},isReady:function(){if(this._isReady)return!0;var a=this.getWaitingForReadyList();return a.length>0?this._isReady=!1:(this._isReady=!0,this.convertIdsToBasicMenuItems()),this._isReady},getWaitingForReadyList:function(){return this.resources.W.Data.isDataAvailable("#CUSTOM_MAIN_MENU")?this.resources.W.Data.getDataByQuery("#CUSTOM_MAIN_MENU").getWaitingForReadyList():[]}})}),define.experiment.dataSchema("Page.LandingPageSupport",function(a){var b=a;return b.customizeField(function(a){return a.isLandingPage={type:"boolean","default":!1},a})}),define.experiment.newDataSchema("TransientCustomBG.BackgroundPerPage",function(){return{bg:{type:"background","default":"none 0 0 center center auto no-repeat no-repeat fixed {color_1}"}}}),define.experiment.component("core.components.Container.BoxSlideShow",function(a,b){var c=a;c.statics({Z_INDEX_CHANGE_TYPES:{BACK:"BACK",FORWARD:"FORWARD",TOP:"TOP",BOTTOM:"BOTTOM"},IS_CONTAINER:!0,_disableAnimationForChildComp:!1}),c.methods({_handleRightSideResize:function(a,b){var c=b.right<1?0:b.right,d=this.getWidth()-a.width;return d=Math.min(d,c),0===c&&0===d&&this.fireEvent("ShowCantResizeDialog"),a.width=this.getWidth()-d,a},_handleBottomSideResize:function(a,b){var c=b.bottom<1?0:b.bottom,d=this.getHeight()-a.height;return d=Math.min(d,c),a.height=this.getHeight()-d,0===c&&0===d&&this.fireEvent("ShowCantResizeDialog"),a},_handleLeftSideResize:function(a,b,c){var d=b.left<1?0:b.left,e=this.getWidth()-a.width;e=Math.min(e,d);for(var f=this._getChildComponentsForResize(),g={},h=0;h<f.length;h++)if(f[h]&&f[h].getLogic){var i=f[h].getLogic();g.editedComponent=i,g.x=i.getX()-e,c._setSelectedComponentPosSize(g)}return 0===d&&0===e&&this.fireEvent("ShowCantResizeDialog"),a.x=this.getX()+e,a.width=this.getWidth()-e,a},_handleTopSideResize:function(a,b,c){var d=b.top<1?0:b.top,e=this.getHeight()-a.height;e=Math.min(e,d);for(var f,g=this._getChildComponentsForResize(),h={},i=0;i<g.length;i++)g[i]&&g[i].getLogic&&(f=g[i].getLogic(),h.editedComponent=f,h.y=f.getY()-e,c._setSelectedComponentPosSize(h));return 0===d&&0===e&&this.fireEvent("ShowCantResizeDialog"),a.y=this.getY()+e,a.height=this.getHeight()-e,a},getContentBoundingBox:function(){for(var a,b=this.getHeight(),c=this.getWidth(),d={top:b,bottom:b,right:c,left:c},e=this._getChildComponentsForResize(),f=0;f<e.length;f++)e[f]&&e[f].getLogic&&(a=e[f].getLogic(),d.top=Math.min(d.top,a.getBoundingY()),d.bottom=Math.min(d.bottom,b-a.getBoundingY()-a.getBoundingHeight()),d.right=Math.min(d.right,c-a.getBoundingX()-a.getBoundingWidth()),d.left=Math.min(d.left,a.getBoundingX()));return _.forOwn(d,function(a,b){this[b]=Math.max(a,0)},d),d},_getChildComponentsForResize:function(){return this.getChildComponents()},canBeDraggedIntoBoxSlideShow:function(){for(var a=this.getChildComponents(),b=0;b<a.length;b++)if(a[b].$logic&&!a[b].$logic.canBeDraggedIntoBoxSlideShow())return!1;return!0},addChild:function(a){this.saveAnimationDefaultState(a);var b,c=a.getParentComponent();c&&(b=c.getChildComponents().map(function(a){return a.getLogic().getComponentId()})),a.getViewNode().insertInto(this.getInlineContentContainer()),c&&this._reportComponentsZOrderChanged(a,c,b),this.moveChild(a,this.Z_INDEX_CHANGE_TYPES.TOP),this._setPageIdToComponent(a),this._setDomLevelToComponent(a),this.checkIfNeedDisableAnimationBtn(a)},saveAnimationDefaultState:function(a){a.originalAnimation=a.EDITOR_META_DATA&&a.EDITOR_META_DATA.general&&a.EDITOR_META_DATA.general.animation||!0},disableAnimationBtn:function(a){a.EDITOR_META_DATA.general?a.EDITOR_META_DATA.general.animation=!1:a.EDITOR_META_DATA.general={animation:!1},a.trigger(Constants.ComponentEvents.REMOVE_ANIMATION_ON_ADD_BOX,{comp:a}),this.resources.W.Commands.executeCommand("WEditorCommands.reloadPropertyPanel",{component:a},this)},enableAnimationBtn:function(a){a.EDITOR_META_DATA.general?a.EDITOR_META_DATA.general.animation=a.originalAnimation:a.EDITOR_META_DATA.general={animation:a.originalAnimation},a.trigger(Constants.ComponentEvents.RETURN_ANIMATION_ON_REMOVE_FROM_BOX,{comp:a}),this.resources.W.Commands.executeCommand("WEditorCommands.reloadPropertyPanel",{component:a},this)},checkIfNeedDisableAnimationBtn:function(a){this._checkIfNeedToDisableAnimation(a)?(this.disableAnimationBtn(a),this._applyAnimationChangeForContainerChildren(a,!0)):(this.enableAnimationBtn(a),this._applyAnimationChangeForContainerChildren(a,!1))},isPageComponent:function(a){return"mobile.core.components.Page"===a||"core.components.Page"===a},_applyAnimationChangeForContainerChildren:function(a,b){if(a&&a.isContainer&&a.isContainer()){var c=a.getChildComponents();c.length>0&&c.map(function(a){var c=a.$logic;b?this.disableAnimationBtn(c):this.enableAnimationBtn(c),this._applyAnimationChangeForContainerChildren(c,b)}.bind(this))}},_checkIfNeedToDisableAnimation:function(a){if(a._disableAnimationForChildComp)return!0;var b=a.getParentComponent();return null===b||this.isPageComponent(b.getOriginalClassName())?!1:this._checkIfNeedToDisableAnimation(b)}})}),define.experiment.component("core.components.ContainerOBC.BoxSlideShow",function(a,b){var c=a;c.statics({Z_INDEX_CHANGE_TYPES:{BACK:"BACK",FORWARD:"FORWARD",TOP:"TOP",BOTTOM:"BOTTOM"},IS_CONTAINER:!0,_disableAnimationForChildComp:!1}),c.methods({_handleRightSideResize:function(a,b){var c=b.right<1?0:b.right,d=this.getWidth()-a.width;return d=Math.min(d,c),0===c&&0===d&&this.fireEvent("ShowCantResizeDialog"),a.width=this.getWidth()-d,a},_handleBottomSideResize:function(a,b){var c=b.bottom<1?0:b.bottom,d=this.getHeight()-a.height;return d=Math.min(d,c),a.height=this.getHeight()-d,0===c&&0===d&&this.fireEvent("ShowCantResizeDialog"),a},_handleLeftSideResize:function(a,b,c){var d=b.left<1?0:b.left,e=this.getWidth()-a.width;e=Math.min(e,d);for(var f=this._getChildComponentsForResize(),g={},h=0;h<f.length;h++)if(f[h]&&f[h].getLogic){var i=f[h].getLogic();g.editedComponent=i,g.x=i.getX()-e,c._setSelectedComponentPosSize(g)}return 0===d&&0===e&&this.fireEvent("ShowCantResizeDialog"),a.x=this.getX()+e,a.width=this.getWidth()-e,a},_handleTopSideResize:function(a,b,c){var d=b.top<1?0:b.top,e=this.getHeightv()-a.height;e=Math.min(e,d);for(var f,g=this._getChildComponentsForResize(),h={},i=0;i<g.length;i++)g[i]&&g[i].getLogic&&(f=g[i].getLogic(),h.editedComponent=f,h.y=f.getY()-e,c._setSelectedComponentPosSize(h));return 0===d&&0===e&&this.fireEvent("ShowCantResizeDialog"),a.y=this.getY()+e,a.height=this.getHeight()-e,a},getContentBoundingBox:function(){for(var a,b=this.getHeight(),c=this.getWidth(),d={top:b,bottom:b,right:c,left:c},e=this._getChildComponentsForResize(),f=0;f<e.length;f++)e[f]&&e[f].getLogic&&(a=e[f].getLogic(),d.top=Math.min(d.top,a.getBoundingY()),d.bottom=Math.min(d.bottom,b-a.getBoundingY()-a.getBoundingHeight()),d.right=Math.min(d.right,c-a.getBoundingX()-a.getBoundingWidth()),d.left=Math.min(d.left,a.getBoundingX()));return _.forOwn(d,function(a,b){this[b]=Math.max(a,0)},d),d},_getChildComponentsForResize:function(){return this.getChildComponents()},canBeDraggedIntoBoxSlideShow:function(){for(var a=this.getChildComponents(),b=0;b<a.length;b++)if(a[b].$logic&&!a[b].$logic.canBeDraggedIntoBoxSlideShow())return!1;return!0},addChild:function(a){this.saveAnimationDefaultState(a);var b,c=a.getParentComponent();c&&(b=c.getChildComponents().map(function(a){return a.getLogic().getComponentId()})),a.getViewNode().insertInto(this.getInlineContentContainer()),c&&this._reportComponentsZOrderChanged(a,c,b),this.moveChild(a,this.Z_INDEX_CHANGE_TYPES.TOP),this._setPageIdToComponent(a),this._setDomLevelToComponent(a),this.checkIfNeedDisableAnimationBtn(a)},saveAnimationDefaultState:function(a){a.originalAnimation=a.EDITOR_META_DATA&&a.EDITOR_META_DATA.general&&a.EDITOR_META_DATA.general.animation||!0},disableAnimationBtn:function(a){a.EDITOR_META_DATA.general?a.EDITOR_META_DATA.general.animation=!1:a.EDITOR_META_DATA.general={animation:!1},a.trigger(Constants.ComponentEvents.REMOVE_ANIMATION_ON_ADD_BOX,{comp:a}),this.resources.W.Commands.executeCommand("WEditorCommands.reloadPropertyPanel",{component:a},this)},enableAnimationBtn:function(a){a.EDITOR_META_DATA.general?a.EDITOR_META_DATA.general.animation=a.originalAnimation:a.EDITOR_META_DATA.general={animation:a.originalAnimation},a.trigger(Constants.ComponentEvents.RETURN_ANIMATION_ON_REMOVE_FROM_BOX,{comp:a}),this.resources.W.Commands.executeCommand("WEditorCommands.reloadPropertyPanel",{component:a},this)},checkIfNeedDisableAnimationBtn:function(a){this._checkIfNeedToDisableAnimation(a)?(this.disableAnimationBtn(a),this._applyAnimationChangeForContainerChildren(a,!0)):(this.enableAnimationBtn(a),this._applyAnimationChangeForContainerChildren(a,!1))},_applyAnimationChangeForContainerChildren:function(a,b){if(a&&a.isContainer&&a.isContainer()){var c=a.getChildComponents();c.length>0&&c.map(function(a){var c=a.$logic;b?this.disableAnimationBtn(c):this.enableAnimationBtn(c),this._applyAnimationChangeForContainerChildren(c,b)}.bind(this))}},isPageComponent:function(a){return"mobile.core.components.Page"===a||"core.components.Page"===a},_checkIfNeedToDisableAnimation:function(a){if(a._disableAnimationForChildComp)return!0;var b=a.getParentComponent();return null===b||this.isPageComponent(b.getOriginalClassName())?!1:this._checkIfNeedToDisableAnimation(b)}})}),define.experiment.component("core.editor.components.dialogs.DialogWindow.BackgroundPerPage",function(a,b){var c=a,d=b;c.states(d.merge({dialogWindowColor:["normal","grayed"],dialogTabs:["none","bottomTab"]})),c.methods({_setOptions:d.after(function(a){this._relativePosition=a.relativePosition,this._relativeOffset=a.relativeOffset}),setPositionByType:function(a,b,c,d){switch(a){case Constants.DialogWindow.POSITIONS.RELATIVE:this._positionDialogRelatively(b,c);break;case Constants.DialogWindow.POSITIONS.TOP:this._setPositionToTop();break;case Constants.DialogWindow.POSITIONS.SIDE:this._setPositionToScreenSides(c,d);break;case Constants.DialogWindow.POSITIONS.DYNAMIC:this._setPosition(b,c);break;case Constants.DialogWindow.POSITIONS.CENTER:this._setPositionToCenter();break;default:this._setPositionToCenter()}},_positionDialogRelatively:function(a,b){this._top=isNaN(a)?0:a,this._left=isNaN(b)?0:b,this._relativePosition&&(this._top=this._top+this._relativePosition.y+this._relativeOffset.y-this._maxHeight,this._left=this._left+this._relativePosition.x+this._relativeOffset.x),this._skinParts.dialogBox.setStyles({top:this._top+"px",left:this._left+"px"})},closeDialog:function(){var a=$$("body");a.removeEvent("keyup",this._onKeyUp),window.removeEvent(Constants.CoreEvents.RESIZE,this._setDialogHeightRelativeToWindowHeight),window.removeEvent(Constants.CoreEvents.RESIZE,this._enableDrag),this.$view.removeEvent(Constants.CoreEvents.RESIZE),this.injects().Editor.getEditedComponent()&&this.injects().Editor.enableEditCommands(),this._view.removeFromDOM(),this._insertedDialogToDom=!1,this.injects().Utils.forceBrowserRepaint(),this._view.fireEvent("dialogClosed")},setDialogColorToDefault:function(){this.setState("normal","dialogWindowColor")},setDialogColorToGray:function(){this.setState("grayed","dialogWindowColor")},setDialogTabToNone:function(){this.setState("none","dialogTabs")},setDialogTabToBottom:function(){this.setState("bottomTab","dialogTabs")},triggerConfirmButton:function(a){return this._buttonsMap[W.EditorDialogs.DialogButtons.OK]?(this._onButtonClicked(W.EditorDialogs.DialogButtons.OK,a),!0):this._buttonsMap[W.EditorDialogs.DialogButtons.YES]?(this._onButtonClicked(W.EditorDialogs.DialogButtons.YES,a),!0):this._buttonsMap[W.EditorDialogs.DialogButtons.SAVE]?(this._onButtonClicked(W.EditorDialogs.DialogButtons.SAVE,a),!0):this._buttonsMap[W.EditorDialogs.DialogButtons.DELETE]?(this._onButtonClicked(W.EditorDialogs.DialogButtons.DELETE,a),!0):!1},triggerCancelButton:function(a){return this._buttonsMap[W.EditorDialogs.DialogButtons.CANCEL]?(this._onButtonClicked(W.EditorDialogs.DialogButtons.CANCEL,a),!0):this._buttonsMap[W.EditorDialogs.DialogButtons.NO]?(this._onButtonClicked(W.EditorDialogs.DialogButtons.NO,a),!0):!1},_onButtonClicked:function(a,b){var c=this._buttonsMap[a];if(!c||c&&c.getLogic&&c.getLogic().isEnabled()){var d=!0;this._closeCallBack&&this._closeCallBack({result:a})===!1&&(d=!1),d&&this.endDialog(a,b)}},endDialog:function(a,b){this.fireEvent("onDialogClosing",{result:a,event:b}),this.closeDialog()}})}),define.experiment.component("core.editor.components.dialogs.DialogWindow.CanClickUR",function(a,b){var c=a;c.states(b.merge({undoRedoActions:["noUndoRedo","doUndoRedo"]})),c.methods({_setOptions:b.after(function(a){this._canClickUndoRedo=a.canClickUndoRedo}),setDialogOptions:function(a,b){if(a=a||{},a.eventData&&LOG.reportError("Someone called DialogWindow with deprecated param eventData, please use top and left instead","core.editor.components.dialogs.DialogWindow","setDialogOptions"),this._optionsReadyCallback=b,this._setOptions(a),this._modalMode=a.nonModal&&Constants.DialogWindow.TYPES.NON_MODAL||a.semiModal&&Constants.DialogWindow.TYPES.SEMI_MODAL||a.transparentModal&&Constants.DialogWindow.TYPES.TRANSPARENT_MODAL||Constants.DialogWindow.TYPES.MODAL,this._allowDrag=a.allowDrag,this.setTitle(a.title),this.setDescription(a.description),this.setHelpLink(a.helplet,!0),this.setHelpButton(a.helpButtonId),this.setWidth(this._width),this.setMaxMinHeight(this._maxHeight,this._minHeight),this._setDialogHeightRelativeToWindowHeight(),this._enableDrag(),window.addEvent(Constants.CoreEvents.RESIZE,this._enableDrag),Browser.safari?setTimeout(function(){this._setupButtons(a.buttonSet||W.EditorDialogs.DialogButtonSet.OK)}.bind(this),120):this._setupButtons(a.buttonSet||W.EditorDialogs.DialogButtonSet.OK),this.setState(this._modalMode),this._modalMode!==Constants.DialogWindow.TYPES.NON_MODAL){this.injects().Editor.disableEditCommands();var c=this;this._view.addEvent(Constants.CoreEvents.MOUSE_DOWN,function(a){c.resources.W.Commands.executeCommand("WEditorCommands.DialogWindowMouseDown",a),c._modalMode!==Constants.DialogWindow.TYPES.MODAL&&a.stopPropagation()})}this._canClickUndoRedo?(this.setState("doUndoRedo"),this._startCapturingUndoRedoButtons()):this.setState("noUndoRedo"),this._skinParts.blockLayer.addEvent(Constants.CoreEvents.CLICK,this._closeOnOutsideClick),this._skinParts.dialogToolbar.setCollapsed(!a.showToolbar),this._skinParts.tabs.setCollapsed(!a.tabs),this._checkDialogOptionsSet(),this._setMargin(a.margin),this._setDescriptionStyles(a.descriptionStyles),this._setInnerOverflow(a.innerOverflow),this._setInnerPadding(a.innerPadding)},_startCapturingUndoRedoButtons:function(){var a=!1,b={closeModalDialog:function(b){a||(this._closeOnOutsideClick(b),a=!0)}.bind(this)};W.Commands.executeCommand("WEditorCommands.StartCapturingUndoRedoButtons",b)},_stopCapturingUndoRedoButtons:function(){W.Commands.executeCommand("WEditorCommands.StopCapturingUndoRedoButtons")},closeDialog:b.after(function(){this._canClickUndoRedo&&this._stopCapturingUndoRedoButtons()})})}),define.experiment.component("core.editor.components.dialogs.DialogWindow.CustomMenu",function(a){var b=a;b.methods({setDialogOptions:function(a,b){if(a=a||{},a.eventData&&LOG.reportError("Someone called DialogWindow with deprecated param eventData, please use top and left instead","core.editor.components.dialogs.DialogWindow","setDialogOptions"),this._optionsReadyCallback=b,this._setOptions(a),this._modalMode=a.nonModal&&Constants.DialogWindow.TYPES.NON_MODAL||a.semiModal&&Constants.DialogWindow.TYPES.SEMI_MODAL||a.transparentModal&&Constants.DialogWindow.TYPES.TRANSPARENT_MODAL||Constants.DialogWindow.TYPES.MODAL,this._allowDrag=a.allowDrag,this.setTitle(a.title),this.setDescription(a.description),this.setHelpLink(a.helplet,!0),this.setHelpButton(a.helpButtonId),this.setWidth(this._width),this.setMaxMinHeight(a.maxHeight,a.minHeight),this._setDialogHeightRelativeToWindowHeight(),this._enableDrag(),window.addEvent(Constants.CoreEvents.RESIZE,this._enableDrag),Browser.safari?setTimeout(function(){this._setupButtons(a.buttonSet||W.EditorDialogs.DialogButtonSet.OK)}.bind(this),120):this._setupButtons(a.buttonSet||W.EditorDialogs.DialogButtonSet.OK),this.setState(this._modalMode),this._modalMode!==Constants.DialogWindow.TYPES.NON_MODAL){this.injects().Editor.disableEditCommands();var c=this;this._view.addEvent(Constants.CoreEvents.MOUSE_DOWN,function(a){c.resources.W.Commands.executeCommand("WEditorCommands.DialogWindowMouseDown",a),c._modalMode!==Constants.DialogWindow.TYPES.MODAL&&a.stopPropagation()})}this._skinParts.blockLayer.addEvent(Constants.CoreEvents.CLICK,this._closeOnOutsideClick),this._skinParts.dialogToolbar.setCollapsed(!a.showToolbar),this._skinParts.tabs.setCollapsed(!a.tabs),this._checkDialogOptionsSet(),this._setMargin(a.margin),this._setDescriptionStyles(a.descriptionStyles),this._setInnerOverflow(a.innerOverflow),this._setInnerPadding(a.innerPadding)}})}),define.experiment.component("core.editor.components.dialogs.DialogWindow.ModalDialogScrollBlock",function(a,b){var c=a,d=b;c.resources(d.merge(["W.ScrollHandler"])),c.methods({initialize:d.after(function(){this._className=this.className.split(".").pop()}),openDialog:d.after(function(){this._currentState===Constants.DialogWindow.TYPES.MODAL&&this.resources.W.ScrollHandler.scrollBlock(this._className)}),closeDialog:d.after(function(){this._currentState===Constants.DialogWindow.TYPES.MODAL&&this.resources.W.ScrollHandler.scrollUnBlock(this._className)})})}),define.experiment.component("core.editor.components.dialogs.DialogWindow.WixAppsGalleryField",function(a){var b=a;b.methods({_onDialogClosing:function(a,b){if(!a)return null;var c=a.innerComponentName,d=a.innerComponentLogic,e=a.args,f=e&&e.dialogId?e.dialogId:c.toString(),g={c1:f};return"_helpDialog"==f&&d&&d.url&&(g.c2=W.Utils.encodeUrl(d.url)),b&&b.result&&(g.c3=b.result.toString()),LOG.reportEvent(wixEvents.DIALOG_CLOSED,g),e&&e.callback&&e.callback(b),g}})}),define.experiment.Class("core.editor.managers.serverfacade.ServerApiUrls.EditorLoadPerPage",function(a){var b=a;b.methods({getOverrideSaveUrl:function(){return this._getUrlWithQueryParams(this._constants.NEW_OVERRIDE_SAVE_URL_PART)}})}),define.experiment.Class("core.editor.components.traits.GalleryDataPanel.OrganizeImages",function(a,b){var c=a;c.methods({_addFieldOrganizeImages:function(){this.addInputGroupField(function(){this.setNumberOfItemsPerLine(1),this.addButtonField(null,W.Resources.get("EDITOR_LANGUAGE","GALLERY_ORGANIZE_PHOTOS"),null,null,"blueWithArrow",null,null,"WEditorCommands.OpenOrganizeImagesDialog",{})
})}})}),define.experiment.dataSchema("SiteSettings.RedirectFeature301Data",function(a){return a.customizeField(function(a){return a.externalUriMappings={type:"Item301redirect",items:[]},a})}),define.experiment.newDataSchema("HeaderMetaTags.RedirectFeature301Data",function(){return{userMetaTags:{type:"string","default":""}}}),define.experiment.Class("core.editor.managers.DialogManager.BackgroundPerPage",function(a){var b=a;b.methods({_closeTopDialog:function(a,b){var c=this._openDialogs.pop();c&&c.$logic&&(a?c.$logic.triggerConfirmButton(b):c.$logic.triggerCancelButton(b)||c.$logic.endDialog("CANCEL"))},_onKeyDown:function(a){return"esc"==a.key?(this._closeTopDialog(!1,a),void 0):"enter"==a.key?("TEXTAREA"!=a.target.nodeName&&this._closeTopDialog(!0,a),void 0):void 0}})}),define.experiment.Class("core.editor.managers.editormanager.EditorManagerBase.RedirectFeature301",function(a,b){var c=a;c.methods({_handleUserMetaTags:function(a){if(!a)return this.resources.W.Data.addDataItem("USER_META_TAGS",{type:"HeaderMetaTags"}),void 0;var b={type:"HeaderMetaTags",userMetaTags:a.headTags};this.resources.W.Data.addDataItem("USER_META_TAGS",b)}})}),define.experiment.Class("core.managers.ConfigurationManager.ImagesFromTopology",function(a,b){var c=a;c.binds(["_saveTopology"]),c.methods({initialize:b.after(function(){this.resource.getResourceValue("topology",this._saveTopology)}),_saveTopology:function(a){this._topology=a},getLocationMapProperty:function(a){var b=this._topology[a];return b||window.serviceTopology&&window.serviceTopology.scriptsLocationMap&&window.serviceTopology.scriptsLocationMap[a]}})}),define.experiment.Class("core.managers.ConfigurationManager.LandingPageSupport",function(a,b){a.methods({initialize:b.after(function(){this.$isMobileApp=!!W.Utils.getQueryParam("ismobileapp")})})}),define.experiment.Class("core.managers.configuration.MobileConfigurationManager.ImproveTabletDetection.New",function(a){var b=a;b.methods({_getTabletScreenWidth:function(){var a=this.isAppleMobileDevice();return a||this.isNewChromeOnAndroid()?screen.width:screen.width/this._getDevicePixelRatio()},isTablet:function(){if("boolean"==typeof this._isTablet)return this._isTablet;if(!W.Config.env.$isPublicViewerFrame)return this._isTablet=!1,this._isTablet;var a=this._getTabletScreenWidth();return this._isTabletScreenWidth=a>=this.MOBILE_MAX_WIDTH&&a<this.TABLET_MAX_WIDTH&&this.isTouchScreen(),this._isTablet=this._isTabletScreenWidth||this._isIpad()||this._isAndroidTablet(),this._isTablet},_isIpad:function(){return/ipad/i.test(navigator.userAgent.toLowerCase())},_isAndroidTablet:function(){return this.isAndroidMobileDevice()&&/tablet/i.test(navigator.userAgent.toLowerCase())}})}),define.experiment.Class("core.managers.ResourceManager.SiteMemberAdditionalTranslations",function(a,b){var c=a;c.fields({_bundleMap:{EDITOR_LANGUAGE:"/resources/editor/bundles/_generated/html_editor_",WIXAPPS_LANGUAGE:"/resources/editor/wixapps/wixapps_",WIXAPPS2_LANGUAGE:"/resources/editor/wixapps2/wixapps2_",FEEDBACK_REVIEW:"/resources/editor/bundles/feedback_review/feedback_review_",SITE_MEMBER_MANAGER:"/resources/editor/bundles/SITEMEMBERMANGAGER/SITEMEMBERMANGAGER_"},_bundleWaitList:{}})}),define.experiment.Class("core.managers.ResourceManager.WixAppsTranslation",function(a){var b=a;b.fields({_bundleMap:{EDITOR:{EDITOR_LANGUAGE:"/resources/editor/bundles/_generated/html_editor_",WIXAPPS_LANGUAGE:"/resources/blog/editor/bundles/common/common_",WIXAPPS2_LANGUAGE:"/resources/wixapps2/editor/bundles/_generated/wixapps2_",FEEDBACK_REVIEW:"/resources/editor/bundles/feedback_review/feedback_review_",ECOMMERCE:"/resources/ecommerce/editor/bundles/_generated/ecommerce_",BLOG:"/resources/classic_wixapps/blog/editor/_generated/blog_",MENU:"/resources/classic_wixapps/menu/editor/_generated/menu_",FAQ:"/resources/classic_wixapps/faq/editor/_generated/faq_",NEWS:"/resources/classic_wixapps/news/editor/_generated/news_",PLAYLIST:"/resources/classic_wixapps/playlist/editor/_generated/playlist_"},VIEWER:{WIXAPPS_LANGUAGE:"/resources/blog/viewer/bundles/common/common_",WIXAPPS2_LANGUAGE:"/resources/wixapps2/viewer/bundles/_generated/wixapps2_",FEEDBACK_REVIEW:"/resources/editor/bundles/feedback_review/feedback_review_",ECOMMERCE:"/resources/ecommerce/viewer/bundles/_generated/ecommerce_",BLOG:"/resources/classic_wixapps/blog/viewer/_generated/blog_",MENU:"/resources/classic_wixapps/menu/viewer/_generated/menu_",FAQ:"/resources/classic_wixapps/faq/viewer/_generated/faq_",NEWS:"/resources/classic_wixapps/news/viewer/_generated/news_",PLAYLIST:"/resources/classic_wixapps/playlist/viewer/_generated/playlist_"}},_bundleWaitList:{},_currentBundle:null,_missingTranslation:null,bundles:null,langSymbol:null}),b.methods({_getViewingFrame:function(){return this.resources.W.Config.env.$isEditorFrame?"EDITOR":"VIEWER"},getUrlForLanguage:function(a,b){b=b||this.langSymbol;var c=this.resources.topology.langs,d=this._getViewingFrame(),e=this._bundleMap[d][a];return c+e+b+".json"},_getEnvLangCode:function(){var a=this.resources.W.Config.env;if(a.$isEditorFrame)return this.resources.W.Config.getLanguage();if(a.$isEditorViewerFrame)return this.resources.W.CookiesManager.getCookie("wixLanguage");if(a.$isPublicViewerFrame){var b=window.navigator.userLanguage||window.navigator.language;return b.split("-")[0]}return null},loadLanguageBundle:function(a,b,c){var d=this,e=this.getUrlForLanguage(a,c);"function"==typeof b&&(b={onSuccess:b,onFailure:b}),this.resources.scriptLoader.loadResource({url:e},{onLoad:function(e){d.setBundle(a,e),d.define.resource(a,e),b&&b.onSuccess&&b.onSuccess.call(d,e,a,c)},onFailed:function(f){d.setBundle(a,{}),d.define.resource(a,{}),b&&b.onFailure&&b.onFailure.call(d,f,a,c),LOG.reportError(wixErrors.LANGUAGE_PACK_FAILED_TO_LOAD,{c1:a,c2:e,language:c})}})},isBundleLoaded:function(a){return _.has(this.bundles,a)},isKeyInBundle:function(a,b){return _.has(this.bundles,a)&&_.has(this.bundles[a],b)}})}),define.experiment.Class("mobile.core.components.base.BaseComponent.BoxSlideShow",function(a,b){var c=a,d=b;c.methods({initialize:d.after(function(){this._canBeNavigatedFromEditBox=!1}),showNavigationOnEditBox:function(){return this._canBeNavigatedFromEditBox},getComponentDependantType:function(){return!!this.isCompDependentOnOtherComp},overrideSelectableOnDelete:function(){return!!this.overrideIsSelectableOnDelete},waitTillMeasureToPreformLayoutChanges:function(){return!!this._needToWaitTillMeasure},canBeDraggedIntoBoxSlideShow:function(){return!0}})}),define.experiment.Class("core.managers.components.ComponentDomBuilder.SocialActivity",function(a,b){var c=a;c.methods({_setAdditionalAttributes:b.after(function(a,b){b.socialQuery&&a.setAttribute("socialQuery",b.socialQuery)})})}),define.experiment.Class("core.managers.componentlifecyclemanager.ComponentLifecycleManager.BoxSlideShow",function(a,b){var c=a,d=b;c.statics({PHASES:{MEASURE_INITIATED:"measureInitiatedComps",MEASURE:"measure",COLLECT_RENDER_COMPS:"collectCompsForRender",RENDER:"render"},EVENTS:{BEFORE_RENDER:"beforeRender",COMPONENTS_RENDERED:"componentsRendered",AFTER_LAYOUT_UPDATE:"afterLayout",AFTER_REFLOW:"afterReflow"}}),c.methods({_afterReflow:d.after(function(){this.fireEvent(this.EVENTS.AFTER_REFLOW)})})}),define.experiment.Class("core.managers.componentlifecyclemanager.ComponentMeasurer.NBC_FixMeasureBug",function(a,b){var c=a,d=b;c.methods({invalidateDisplayAndMeasureAllDisplayedComponents:function(){this._markAllCompsAsNotDisplayed();var a=this._getInitiatedCompsInfoAndMarkMeasured(),b=this._getDisplayedCompListAndMarkAsDisplayed(document.body),c=a.concat(b);this.measureComponents(c),this._clearTempMeasureData(c),this._invalidateAllDisplayModifiedComps()},measureComponents:function(a){var b,c;if(a.length)try{for(b=0;b<a.length;++b)c=a[b],this._measureComponent(c)}catch(d){a.splice(0,b+1),this._compLC._onComponentError(c,d,this._compLC.PHASES.MEASURE),a.length>0&&this.measureComponents(a)}},_measureComponent:function(a){if(!a.justMeasured){a.justMeasured=!0;var b=a.component;if(b._skinParts){this._clearInvalidations(b);for(var c in b._skinParts){var d=this._getNodeForMeasure(b._skinParts[c]);if(d&&d.parentNode){var e=this._getPartMeasuresAndUpdateNode(d,b._skinParts[c]);this._invalidateSizeIfChanged(b,c,d,e.newMeasure,e.oldMeasure),this._invalidatePositionIfChanged(b,c,d,e.newMeasure,e.oldMeasure)}}b.isInvalidated([b.INVALIDATIONS.SIZE])&&b.reportLayoutChange()}b.trigger(Constants.LifecycleSteps.MEASURE)}},_clearInvalidations:function(a){a._invalidations_.clearInvalidationType(a.INVALIDATIONS.SIZE),a._invalidations_.clearInvalidationType(a.INVALIDATIONS.POSITION),a._invalidations_.clearInvalidationType(a.INVALIDATIONS.MEASURED_SIZE_DIFFERS_FROM_REQUESTED)},_getPartMeasuresAndUpdateNode:function(a,b){if(a._tempOldMeasure_)return{newMeasure:a.$measure,oldMeasure:a._tempOldMeasure_};var c=this._getOldMeasure(a),d=this._getNewMeasure(a);return b.NEW_BASE_COMP&&(a._tempOldMeasure_=c),a.$measure=d,{newMeasure:d,oldMeasure:c}},_clearTempMeasureData:function(a){_.forEach(a,function(a){delete a.justMeasured;var b=a.component.$view;delete b._tempOldMeasure_})},_getInitiatedCompsInfoAndMarkMeasured:function(){var a=this._compLC.getAllComponentsInfo();return _.filter(a,function(a){return a.state===a.STATES.INITIATED||a.forceSingleMeasure?(a.state=a.STATES.MEASURED,a.forceSingleMeasure=!1,!0):!1})},_getDisplayedCompListAndMarkAsDisplayed:function(a,b){b=b||[];var c=this._isNodeDisplayed(a);if(c)for(var d=a.childNodes,e=0;e<d.length;++e)this._getDisplayedCompListAndMarkAsDisplayed(d[e],b);if(c&&a.$logic){var f=a.$logic,g=f.getComponentUniqueId(),h=this._compLC.getAllComponentsInfo(),i=h[g];i&&(i.isDisplayed=!0,b.push(i))}return b},_runMeasureForFirstTimeInitiatedComps:d.remove(),_getDisplayedCompList:d.remove()})}),define.experiment.Class("core.managers.css.CssManager.UploadFonts",function(a,b){var c=a,d=b;c.resources(d.merge(["W.CookiesManager"])),c.utilize(["core.managers.serverfacade.CorsRESTClient"]),c.fields({possibleCharacterSets:d.merge(["userFonts"])}),c.methods({initialize:d.after(function(){this._corsRESTClient=new this.imports.CorsRESTClient,window.editorModel&&this.updateUserFontsFromServer()}),_getErrorCallback:function(){},updateUserFonts:function(a){a.files||a;this._languagesFontsLists.userFonts},_createUserFontObject:function(a){return{displayName:a.title,fontFamily:"arial",cdnName:"",genericFamily:"sans-serif",provider:"system",characterSets:["user"],permissions:"all",fallbacks:"",spriteIndex:2}},updateUserFontsFromServer:function(){var a=this.resources.W.CookiesManager.getCookie("wixSession"),b=this;this._corsRESTClient.get("http://wixprivatemedia.appspot.com/files?media_type=ufonts&wixSession="+a,null,{onSuccess:this.updateUserFonts.bind(b),onError:this._getErrorCallback})},updateSelectableFontsList:function(){this._selectableFontsList={};var a,b,c=this.getFontsListSpriteUrl(),d=this.getCharacterSets(),e=[];for(a=0;a<this.possibleCharacterSets.length;a++){var f=this.possibleCharacterSets[a];if(_.contains(d,f)){var g=this._languagesFontsLists[f];for(b=0;b<g.length;b++){var h=g[b];if("legacy"!==h.permissions){var i=h.displayName,j=h.fontFamily,k=h.spriteIndex+h.characterSets.indexOf(f),l=h.iconSrc||c,m=h.iconSrc?{x:0,y:0}:{x:0,y:-24*k},n={value:j,label:i,iconSrc:l,spriteOffset:m};e.push(n)}}}}}})}),define.experiment.Class("core.managers.css.CssManager.WixStaff",function(a,b){var c=a,d=b;c.methods({initialize:d.after(function(){if(this.resources.W.Config.env.$isEditorFrame){this._addFontsByPermissionToFontsList(["studio"]);var a=this.getHelveticaCssUrl();a&&this._addFontsLoaderCssTag(a)}})})}),define.experiment.Class("core.managers.data.DataItemBase.OrganizeImages",function(a){a.methods({getDataCopy:function(){var a=this.getSchema(),b={};return _.each(a,function(a,c){b[c]=this.get(c)},this),b}})}),define.experiment.Class("core.managers.data.DataManager.BackgroundPerPage",function(a){var b=a;b.methods({normalizeQueryID:function(a){return a?"string"==typeof a&&0!==a.indexOf("#")?"#"+a:a:null}})}),define.experiment.Class("core.managers.serverfacade.FeedbackClient.FeedmeEditorTranslations",function(a){var b=a;b.methods({getPreviewUrl:function(a,b,c){var d=W.Config.getLanguage(),e=W.Config.getCurrentOrigin(),f="http:"+e+"/html/editor/web/review/createToken/"+b+"?metaSiteId="+a;this._restClient.get(f,null,{onSuccess:function(a){if(a.success===!0){var b=a.payload.url,e="&utm_campaign=vir_wixad_feedback",f=-1===b.indexOf("?")?"?":"&";this._getShortenUrl(a.payload.url+f+"feedback=true&lang="+d+e,c)}else c(!1)}.bind(this)})}})}),define.experiment.Class("core.managers.skin.BaseSkin2.AppsWPhotoNBC",function(a){var b=a;b.methods({_setLogic_:function(a,b){this._logic=a,this._overrides=b,this._render()},_renderHtml:function(){var a=this._logic.getViewNode();return this.resources.W.Skins.buildSkinHTML(this.$className,a,this._paramMapper,this._overrides)}})}),define.experiment.Class("core.managers.skin.SkinManager.AppsWPhotoNBC",function(a){var b=a;b.methods({buildSkinHTML:function(a,b,c,d){if(!a||!b){var e=b&&b.getProperty("id");return LOG.reportError(wixErrors.SKIN_MANAGER_MISSING_ARGUMENTS,"mobile.core.managers.SkinManager","buildSkinHTML","skinName="+a+" compId="+e+"compViewNode: "+b),{}}var f=this._skinDataMap[a];return f?this._skinRenderer.buildSkinHTML(f,b,c,d):(LOG.reportError(wixErrors.SKIN_MANAGER_NO_DATA_FOR_SKIN,"mobile.core.managers.SkinManager","buildSkinHTML",a),{})}})}),define.experiment.Class("core.managers.skin.SkinRenderer.AppsWPhotoNBC",function(a){var b=a;b.methods({buildSkinHTML:function(a,b,c,d){var e=this.getStyleId(c);d=d||{};var f=d.html?d.html:a.html,g=this.replaceStylePlaceHolder(a.skinCSSName,e);b.empty(),b.set("html",f),b.set("styleId",e),b.set("skin",a.name),a.canFocus?b.tabIndex=0:0===b.tabIndex&&(b.tabIndex=-1),b._wixCSSName&&(b.removeClass(b._wixCSSName),delete b._wixCSSName),g&&(b.addClass(g),b._wixCSSName=g);var h=d.compParts?d.compParts:a.compParts||{},i=d.skinPartClasses?d.skinPartClasses:a.skinPartClasses||{},j=this._handleSkinParts(b,h,i,c,e);return this._handleSkinClasses(a,b,e),j}})}),define.experiment.Class("core.managers.skin.SkinRenderer.StyleHighlight",function(a,b){var c=a,d=b;c.fields({_skinPartsForHighlightMap:{fnt:["label","actionTitle","menuContainer"],fnt2:["submit"],fntt:["title","showMore"],fntds:["description"]},_skinPartsForHighlightList:[]}),c.resources(["W.Commands"]),c.methods({initialize:d.after(function(){this.resources.W.Commands.registerCommandAndListener("WEditorCommands.ComponentAdvancedStyleChanged",this,this._onComponentAdvancedStyleChanged),_.forEach(this._skinPartsForHighlightMap,function(a){_.forEach(a,function(a){this._skinPartsForHighlightList.push(a)},this)},this)}),_onComponentAdvancedStyleChanged:function(a){var b=a.data,c=b.oldState.styleData.properties,d=b.newState.styleData.properties,e=b.changedComponent,f=e.$view.getElements("[skinPart]");_.forEach(f,function(a){var b=a.getAttribute("skinPart");if(this._skinPartsForHighlightList.indexOf(b)>-1){var e=_.findKey(this._skinPartsForHighlightMap,function(a){return a.indexOf(b)>-1}),f=c[e],g=d[e];f&&g&&f!=g&&(a.removeClass(f),this._addFontClass(a,g))}},this)},_handleSkinParts:function(a,b,c,d,e){for(var f={view:a},g=$$(a.getElements("[skinPart]")),h=0;h<g.length;++h){var i=g[h],j=i.getAttribute("skinPart");f[j]=i;var k=c[j];k&&i.addClass(this.replaceStylePlaceHolder(k,e));var l;d&&this._skinPartsForHighlightList.indexOf(j)>-1&&(l=_.findKey(this._skinPartsForHighlightMap,function(a){return a.indexOf(j)>-1}),this._addFontClass(i,d._rawData.properties[l]));var m=i.getAttribute("skin");!m&&b[j]&&b[j].skin&&(m=b[j].skin,m&&i.setAttribute("skin",m))}return f},_addFontClass:function(a,b){"string"==typeof b&&b.indexOf("font_")>-1&&a.addClass(b)}})}),define.experiment.Class("core.managers.theme.ThemeManager.BackgroundPerPage",function(a){var b=a;b.methods({getProperty:function(a,b,c){var d=this._data.get(a);if(!d)return LOG.reportError(wixErrors.THEME_MANAGER_MISSING_PROPERTY,"ThemeManager","getProperty",[a,this._data.getData(),null]),null;var e="string"===typeOf(d)?d:d.clone?d.clone():_.cloneDeep(d),f=this._data.getFieldSchema(a);if(!f)return LOG.reportError(wixErrors.SCHEMA_MISSING_KEY,"ThemeManager","getProperty",[a,this._data.getData(),null]),null;var g=this.getPropertyType(a);if(!b&&"string"==typeOf(e)&&-1!=e.indexOf("["))for(var h in this._data.getSchema())-1!=e.indexOf("["+h+"]")&&(e=e.split("["+h+"]").join(this.getProperty(h)));if(c)return e;switch(g){case"themeUrl":return W.Config.getImagesUrl()+"/web/";case"color":return new this.imports.Color(e);case"background":return new this.imports.Background(e,this);case"font":return new this.imports.Font(e,this);case"radius":return new this.imports.BorderRadius(e);case"webThemeUrl":return W.Config.getServiceTopologyProperty("staticThemeUrlWeb")+"/"+e+"/"}return e}})}),define.experiment.Class("core.utils.css.Background.ViewerImageParamChange",function(a,b){var c=a,d=b;c.utilize(d.merge(["core.components.image.ImageUrlNew"])),c.methods({initialize:d.after(function(){this._imageUrlBuilder=new this.imports.ImageUrlNew}),getUrl:function(a){var b=W.Config.getServiceTopologyProperty("staticMediaUrl")+"/",c=a?"background-image:":"";return c+="none"==this._imageId?this._imageId:"url("+b+this._getPyramidSuffix()+")"},_getPyramidSuffix:function(){var a,b,c=this._isMobileView(),d="",e=this._pyramid||(c?1e3:Constants.Background.DEFAULT_PYRAMID_SIZE),f=[],g=1;return f[0]=parseInt(this.getImageSize()[0],10),f[1]=parseInt(this.getImageSize()[1],10),g=f[0]/f[1],a=f[0],b=f[1],(f[0]>e||f[1]>e)&&(a=f[0]>=f[1]?e:Math.round(g*e),b=f[1]>=f[0]?e:Math.round(1/g*e)),d=this._imageUrlBuilder.getImageUrl({x:a,y:b},{x:f[0],y:f[1]},this._imageId)},_getImageSuffixHelper:d.remove(),_getFileExtension:d.remove()})});