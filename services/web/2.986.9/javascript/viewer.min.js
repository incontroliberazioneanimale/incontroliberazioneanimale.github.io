define.Class("wysiwyg.viewer.managers.ActionsManager",function(a){var b=a;b.inherits("bootstrap.managers.BaseManager"),b.resources(["W.Config","W.Viewer"]),b.utilize(["wysiwyg.viewer.managers.actions.ScreenInAction","wysiwyg.viewer.managers.actions.PageInAction","wysiwyg.common.behaviors.Animations"]),b.fields({_actions:{}}),b.methods({initialize:function(){window.addEventListener&&(this._animations=new this.imports.Animations,this._actions[Constants.Actions.PAGE_IN]=new this.imports.PageInAction(this._animations),this._actions[Constants.Actions.SCREEN_IN]=new this.imports.ScreenInAction(this._animations))},registerComponent:function(a,b,c){var d,e=b.getComponentId();if(c=c||{},"string"==typeof c)try{c=JSON.parse(c)}catch(f){return LOG.reportError(wixErrors.ANIMATIONS_REGISTER_CORRUPTED_DATA,"ActionsManager","registerComponent",{dsc:e}),void 0}for(d in this._actions)this._actions[d].removeComponentBehaviors(e);for(d in c)this._actions[d]&&this._addBehaviorsByAction(a,e,c,d)},_addBehaviorsByAction:function(a,b,c,d){var e=this._dataToBehaviorsList(a,b,c[d]);this._actions[d].addBehaviors(e)},_validateDataStructure:function(a){return a?!0:(LOG.reportError(wixErrors.ANIMATIONS_REGISTER_INVALID_DATA,"ActionsManager","registerComponent"),!1)},getActionsForComponent:function(a){var b=null;for(var c in this._actions){var d=this.getBehaviorsForComponentAction(a,c);d&&d.length&&(b=b||{},b[c]=d)}return b},getBehaviorsForComponentAction:function(a,b){var c=this._actions[b]&&this._actions[b].getBehaviorsBySourceId(a);return c},setBehaviorsForComponentAction:function(a,b,c){var d,e=this.resources.W.Viewer.getCompLogicById(a),f=this.getActionsForComponent(a)||{};return c&&c.length?(d=this._behaviorsListToData(_.cloneDeep(c)),f[b]=d):(delete f[b],_.isEmpty(f)&&(f=null)),e.setBehaviors(f),f},getAnimationClass:function(){return this._animations},isReady:function(){return!0},_dataToBehaviorsList:function(a,b,c){var d=[];return _.forEach(c,function(c,e){_.forEach(c,function(c){var f=_.extend({pageId:a,sourceId:b,targetId:e},c);d.push(f)},this)},this),d},_behaviorsListToData:function(a){var b=_.groupBy(a,"targetId");return _.forEach(b,function(a){_.forEach(a,function(a){delete a.pageId,delete a.sourceId,delete a.targetId})}),b},_isActionExists:function(a){return!!this._actions[a]},__removeAllBehaviorsFromSite__:function(){},__convertSiteFromOldBehaviorStructure__:function(){}})}),define.Class("wysiwyg.viewer.managers.LayoutManager",function(a){var b=a;b.utilize(["wysiwyg.common.managers.classdata.Anchor"]),b.inherits("bootstrap.managers.BaseManager"),b.fields({LOCK_THRESHOLD:70,DEFAULT_MARGIN:10,SUGGEST_ANCHOR_MARGIN:20,FLAG_DIRTY_TOP:1,FLAG_DIRTY_BOTTOM:2}),b.binds(["_getAnchoredY","_getAnchoredH","_updateLayout","_countToValidate"]),b.resources(["W.Utils","W.Viewer","W.Experiments"]),b.methods({initialize:function(){this._AnchorClass=this.imports.Anchor,this._isReady=!0,this._changedByHGroup=[],this._emptyArr=[],this._nextRenderId},setSavedAnchor:function(a){this._savedAnchors=a},attachSavedAnchors:function(a){this._addMissingAnchors();for(var b in this._savedAnchors)if(this._savedAnchors[b]){var c=$(b);if(a&&!a.contains(c))continue;c&&c.getLogic&&0===c.getLogic().getAnchors().length&&this.attachSavedAnchorsToComponent(c.getLogic(),this._savedAnchors[b])&&delete this._savedAnchors[b]}},_addMissingAnchors:function(){this._savedAnchors||(this._savedAnchors={}),this._savedAnchors.SITE_PAGES&&0!=this._savedAnchors.SITE_PAGES.length||(this._savedAnchors.SITE_PAGES=[{distance:0,locked:!0,originalValue:0,targetComponent:"PAGES_CONTAINER",type:"BOTTOM_PARENT"}]),this._savedAnchors.PAGES_CONTAINER&&0!=this._savedAnchors.PAGES_CONTAINER.length||(this._savedAnchors.PAGES_CONTAINER=[{distance:10,locked:!0,originalValue:0,targetComponent:"SITE_FOOTER",type:"BOTTOM_TOP"}])},attachSavedAnchorsToComponent:function(a,b){for(var c,d=[],e=[],f=0;f<b.length;f++)c=this.deserializeAnchor(b[f],a),c&&(c.type==c.ANCHOR_LOCK_BOTTOM?e.push(c):d.push(c));if(this._setComponentAnchors(a,d),e.length>0){var g=new this._AnchorClass;for(g.distance=0,g.originalValue=0,g.topToTop=0,g.type=g.ANCHOR_LOCK_BOTTOM,g.fromComp=a,g.toComp=a,e.unshift(g),f=0;f<e.length;f++)e[f].toComp.setHorizontalGroup(e)}},_setComponentAnchors:function(a,b){var c=a.getAnchors();a.setAnchors(b),this._notifyComponentAnchorsChanged(a,b,c)},_notifyComponentAnchorsChanged:function(a,b,c){var d=this.serializeAnchors(c),e=this.serializeAnchors(b);this.resources.W.Utils.areObjectsEqual(d,e)||this.fireEvent("updateAnchors",{data:{changedComponentIds:[a.getComponentId()],oldAnchors:d,newAnchors:e,sender:"layoutmanager"}})},serializeAnchors:function(a){var b=[],c=this;return a.each(function(a){b.push(c.serializeAnchor(a))}),b},serializeAnchor:function(a){var b={};return b.type=a.type,b.targetComponent=a.toComp.getComponentId(),b.locked=a.locked,b.distance=a.distance,b.topToTop=a.topToTop,b.originalValue=a.originalValue,b},deserializeAnchors:function(a,b){var c=[],d=this;return a.each(function(a){c.push(d.deserializeAnchor(a,b))}),c},deserializeAnchor:function(a,b){var c=new this._AnchorClass;return c.distance=a.distance||0,c.topToTop=a.topToTop||0,c.originalValue=a.originalValue||0,c.type=a.type,c.toComp=this.resources.W.Viewer.getCompLogicById(a.targetComponent),c.fromComp=b,c.locked=a.locked||!1,c.toComp&&c.fromComp?c:null},reportRotateStart:function(){this._getAndClearChangedByHGroup()},reportRotate:function(a){if(!a)throw new Error("Invalid changed elements");this._updateAnchors(a,[a],!1),this.notifyPositionChanged(a,"updateAngle")},reportResize:function(a){var b;if(!a||0===a.length)throw new Error("Invalid changed elements");for(this._updateAnchors(a[0],a,!1),b=0;b<a.length;b++)this.updateChildAnchors(a[b]);var c=this._getAndClearChangedByHGroup();for(b=0;b<c.length;b++)this.updateChildAnchors(c[b]),this._updateAnchors(c[0],[c[0]],!1);var d={type:"componentResize",data:{changedElements:a}};this._reportElementsSize(d.data.changedElements),this.fireEvent(d.type,d)},_reportElementsSize:function(a){for(var b=0;b<a.length;b++)this.notifyPositionChanged(a[b],"updateSize")},reportMove:function(a){if(!a||0===a.length)throw new Error("Invalid changed elements");for(var b=0;b<a.length;b++)this.notifyPositionChanged(a[b],"updatePosition");this._updateAnchors(a[0],a,!1);var c=this._getAndClearChangedByHGroup();for(b=0;b<c.length;b++)this._updateAnchors(c[0],[c[0]],!1);var d={type:"componentMove",data:{changedElements:a}};this.fireEvent(d.type,d)},notifyPositionChanged:function(a,b){var c=a.getLastCoordinates(),d=a.getCurrentCoordinates(),e=a.getLastDimensions(),f=a.getCurrentDimensions(),g=a.getComponentId(),h=this.resources.W.Viewer.getCompLogicById(g);if(h){var i=this._getSiblingsYSortedArray(h),j=i.map(function(a){return a.getComponentId()}.bind(this)),k={data:{changedComponentIds:[g],ySortedElementIds:j,oldCoordinates:c,newCoordinates:d,oldDimensions:e,newDimensions:f}};_.isEqual(d,c)&&_.isEqual(f,e)||this.fireEvent(b,k)}},reportReparent:function(a,b,c,d){if(!a||0===a.length)throw new Error("Invalid changed elements");this.updateChildAnchors(b),this._updateAnchors(a[0],a,!1);var e=a[0].getParentComponent(),f=e.getChildComponents().map(function(a){return a.getLogic()}),g=a.map(function(a){return a.getComponentId()}),h=d?"showOnAllPagesChange":"scopeChangeWithinPage",i={type:"reparentComponent",data:{subType:h,changedComponentIds:g,oldState:{parentId:b._compId,children:c},newState:{parentId:e._compId,children:f}}};this.fireEvent(i.type,i)},reportDeleteComponent:function(a){this.updateChildAnchors(a)},reportResizeStart:function(a){this._getAndClearChangedByHGroup();var b={type:"componentResizeStart",data:a};this.fireEvent(b.type,b)},deleteSavedAnchorsById:function(a){this._savedAnchors&&this._savedAnchors[a]&&delete this._savedAnchors[a]},getOptionalBottomLocks:function(a){var b,c,d,e=[],f=[],g=a.getViewNode().getParent().getChildren("[comp]"),h=a.getHorizontalGroup();if(h){for(c=0,d=h.length;d>c;++c){var i=h[c];i.toComp!=a&&(e.push({locked:!0,target:i.toComp}),f.push(i.toComp))}b=h.slice(0)}for(c=0,d=g.length;d>c;++c){var j=g[c],k=j.getLogic&&j.getLogic();if(k&&k!=a&&-1===f.indexOf(k)&&!this._isHorizontalOverlap(a,k)&&this._isVerticalOverlap(a,k)&&k.allowHeightLock())if(b){var l=new this._AnchorClass;l.fromComp=b[0].fromComp,l.toComp=k,b.push(l),this._isValidHGroup(b)&&e.push({locked:!1,target:k}),b.pop(l)}else e.push({locked:!1,target:k})}return e},toggleHGroup:function(a,b,c){var d,e,f=a.getHorizontalGroup(),g=b.getHorizontalGroup();if(c){for(var h=0;h<f.length;h++)f[h].toComp===b&&(b.setHorizontalGroup(null),f.splice(h,1));if(1===f.length)return a.setHorizontalGroup(null),void 0;d=f}else f&&g?(f.combine(g),d=f):g?(e=new this._AnchorClass,e.type=e.ANCHOR_LOCK_BOTTOM,e.fromComp=g[0].fromComp,e.toComp=a,g.push(e),d=g):f?(e=new this._AnchorClass,e.type=e.ANCHOR_LOCK_BOTTOM,e.fromComp=f[0].fromComp,e.toComp=b,f.push(e),d=f):(d=[],e=new this._AnchorClass,e.type=e.ANCHOR_LOCK_BOTTOM,e.fromComp=a,e.toComp=a,d.push(e),e=new this._AnchorClass,e.type=e.ANCHOR_LOCK_BOTTOM,e.fromComp=a,e.toComp=b,d.push(e));this._updateHGroup(d)},_updateHGroup:function(a){for(var b=0;b<a.length;b++){var c=a[b];c.toComp.setHorizontalGroup(a),c.fromComp=a[0].fromComp,c.distance=this._getBottomDiff(c.fromComp,c.toComp),c.topToTop=c.toComp.getY()-c.fromComp.getY()}},_clearHGroup:function(a){for(var b=0;b<a.length;b++)a[b].toComp.setHorizontalGroup(null)},_isValidHGroup:function(a){var b;for(b=0;b<a.length;b++)if(a[b].toComp.getIsDisposed()||!a[b].toComp.allowHeightLock())return!1;var c=a.slice();for(c.sort(function(a,b){var c=a.toComp.getX(),d=b.toComp.getX();return c===d?0:c>d?1:-1}),b=0;b<c.length-1;b++)if(c[b].toComp.getX()+c[b].toComp.getWidth()>=c[b+1].toComp.getX())return!1;var d=a[0].toComp.getViewNode().getParent(),e=Number.MAX_VALUE,f=-Number.MAX_VALUE;for(b=0;b<a.length;b++){if(a[b].toComp.getIsDisposed())return!1;if(a[b].toComp.getViewNode().getParent()!=d)return!1;var g=a[b].toComp.getY(),h=a[b].toComp.getPhysicalHeight()+g;e=Math.min(h,e),f=Math.max(g,f)}return e>f},_getBottomDiff:function(a,b){return b.getY()+b.getPhysicalHeight()-a.getY()-a.getPhysicalHeight()},_validateCommonParent:function(a,b){if(0!==a.length){var c;c=b?b.getViewNode().getParent():a[0].getViewNode().getParent();var d=function(a){return c!==a.getViewNode().getParent()};if(a.some(d))throw new Error("Invalid elements scope")}},_getSiblingsYSortedArray:function(a){var b=a.getViewNode().getParent();if(W.Config.env.$isPublicViewerFrame&&b._sortedChildren)return b._sortedChildren;var c=b.getChildren("[comp]");if(c=c.reverse(),_.some(c,function(a){return!a.getLogic}))return[];var d=c.map(function(a){var b=a.getLogic();return[b,b.getBoundingY()]}).sort(function(a,b){return a[1]===b[1]?0:a[1]>b[1]?1:-1}).map(function(a){return a[0]});return b._sortedChildren=d,d},_isHorizontalOverlap:function(a,b){var c=a.getBoundingX(),d=c+a.getBoundingWidth(),e=b.getBoundingX(),f=e+b.getBoundingWidth();return!(c>f||e>d)},_isVerticalOverlap:function(a,b){var c=a.getBoundingY(),d=c+a.getBoundingHeight(),e=b.getBoundingY(),f=e+b.getBoundingHeight();return!(c>f||e>d)},_clearReverseAnchorsByScope:function(a,b){for(var c=a.length-1;c>-1;c--){var d=a[c];b?d.type==d.ANCHOR_BOTTOM_PARENT&&a.splice(c,1):d.type!=d.ANCHOR_BOTTOM_PARENT&&a.splice(c,1)}},_updateAnchors:function(a,b,c){var d,e,f,g=this._getSiblingsYSortedArray(a),h=[],i=[],j=g.length,k=null;for(f=0;f<g.length;f++)h[f]={},this._clearReverseAnchorsByScope(g[f].getReverseAnchors(),!1),g[f].getHorizontalGroup()&&(g[f].getHorizontalGroup().$hGroupDirty=!0);var l=a.getParentComponent();for(l&&this._clearReverseAnchorsByScope(l.getReverseAnchors(),!0),d=j-1;d>=0;d--){var m=g[d],n=m.getAngle?m.getAngle():0;this._updateOrClearHGroup(m.getHorizontalGroup(),n),i[d]=m.getAnchors();var o=[],p=!1;if(m.isAnchorable().from.allow){for(e=d+1;j>e;e++){var q=g[e];q.isAnchorable()&&q.isAnchorable().to.allow&&(k=null,!h[d][e]&&this._isHorizontalOverlap(m,q)&&(-1===b.indexOf(m)&&-1===b.indexOf(q)&&(k=this._findAnchorToComp(i[d],q)),k=k||this._createToTopAnchor(m,q),h[d][e]=!0,k.type==k.ANCHOR_BOTTOM_TOP&&(p=!0,this._mergeSets(h[d],h[e])),k.type==k.ANCHOR_TOP_TOP&&m.isAnchorable().to.allow&&m.isAnchorable().to.allowBottomBottom!==!1&&this._checkAndAddBottomAnchor(q,m),o.push(k)))}p||l&&l.isAnchorable().to.allow&&(k=null,-1!==b.indexOf(m)||c||(k=this._findAnchorToComp(i[d],l)),k||(k=this._createToParentAnchor(m,l)),o.push(k))}this._setComponentAnchors(m,o)}},_updateOrClearHGroup:function(a,b){a&&a.$hGroupDirty&&(delete a.$hGroupDirty,this._isValidHGroup(a)&&0===b?this._updateHGroup(a):this._clearHGroup(a))},_setAnchorableIsLocked:function(a){var b=a.fromComp,c=a.toComp;a.locked=b.isAnchorable().from.lock==Constants.BaseComponent.AnchorLock.NEVER||c.isAnchorable().to.lock==Constants.BaseComponent.AnchorLock.NEVER?!1:b.isAnchorable().from.lock==Constants.BaseComponent.AnchorLock.ALWAYS||c.isAnchorable().to.lock==Constants.BaseComponent.AnchorLock.ALWAYS?!0:a.distance<=this.LOCK_THRESHOLD},_setAnchorableDistance:function(a,b){var c=a.fromComp,d=a.toComp;void 0!==c.isAnchorable().from.distance?b=c.isAnchorable().from.distance:void 0!==d.isAnchorable().to.distance&&(b=d.isAnchorable().to.distance),a.distance=b},_createToParentAnchor:function(a,b){var c=a.getBoundingY(),d=a.getBoundingHeight(),e=b.getInlineContentContainer().getSize().y,f=new this._AnchorClass;return f.type=f.ANCHOR_BOTTOM_PARENT,f.fromComp=a,f.toComp=b,this._setAnchorableDistance(f,e-c-d),this._setAnchorableIsLocked(f),f.topToTop=c,f.originalValue=e,f},_createToTopAnchor:function(a,b){var c=a.getBoundingY(),d=b.getBoundingY(),e=a.getBoundingHeight(),f=b.getBoundingHeight(),g=new this._AnchorClass;return g.fromComp=a,g.toComp=b,d+f>c+e&&d>c+e/2?(g.type=g.ANCHOR_BOTTOM_TOP,this._setAnchorableDistance(g,d-c-e)):(g.type=g.ANCHOR_TOP_TOP,this._setAnchorableDistance(g,d-c)),this._setAnchorableIsLocked(g),g.topToTop=d-c,g.originalValue=d,g},_checkAndAddBottomAnchor:function(a,b){var c=b.getBoundingY(),d=a.getBoundingY(),e=b.getBoundingHeight(),f=a.getBoundingHeight();if(c+e>d+f&&0===b.getAngle()){var g=new this._AnchorClass;g.type=g.ANCHOR_BOTTOM_BOTTOM,g.fromComp=a,g.toComp=b,this._setAnchorableDistance(g,c+e-d-f),g.locked=g.distance<=this.LOCK_THRESHOLD,g.topToTop=d-c,g.originalValue=e;var h=[];h=h.concat(a.getAnchors()),a.addAnchor(g),this._notifyComponentAnchorsChanged(a,a.getAnchors(),h)}},_getAnchoredY:function(a){switch(a.type){case a.ANCHOR_BOTTOM_TOP:var b=a.fromComp.getBoundingHeight(),c=a.fromComp.getBoundingY()+b;return c+=a.locked?a.distance:this.DEFAULT_MARGIN,Math.max(c,a.fromComp.getBoundingY()+b/2);case a.ANCHOR_TOP_TOP:return a.fromComp.getBoundingY()+a.distance}},_getAnchoredH:function(a){var b=a.fromComp.getBoundingHeight(),c=a.fromComp.getBoundingY()+b;return a.locked?c+=a.distance:this.resources.W.Viewer.isPageComponent(a.toComp.getOriginalClassName())||(c+=this.DEFAULT_MARGIN),a.type==a.ANCHOR_BOTTOM_BOTTOM?c-=a.toComp.getBoundingY():a.type==a.ANCHOR_BOTTOM_PARENT&&a.toComp.getInlineContentContainer&&this._isInlineContentNonZeroSize(a.toComp)&&(c+=this._getContainerMarginHeight(a.toComp)),c},_isInlineContentNonZeroSize:function(a){return a.getInlineContentContainer().getSize().y>0},_getContainerMarginHeight:function(a){return a.getPhysicalHeight()-a.getInlineContentContainer().getSize().y},notifyWhenNoMoreChanges:function(){var a=this;a._lastEnforceTime=null;var b=setInterval(function(){var c=Date.now();a._lastEnforceTime&&c-a._lastEnforceTime>1e3&&(a.fireEvent("layoutDone"),console.log("done - "+(c-a._lastEnforceTime)),window.clearInterval(b))},200)},enforceAnchors:function(a,b,c,d,e,f){if(this._lastEnforceTime=Date.now(),0!==a.length&&null!==a[0].getViewNode().getParent()){this._validateCommonParent(a);var g=a[0].getParentComponent();d=d||this._getSiblingsYSortedArray(a[0]);var h;if(0!==d.length){for(h=0;h<a.length;h++)a[h].$layoutDirtyFlag=b?this.FLAG_DIRTY_TOP:this.FLAG_DIRTY_BOTTOM;var i=[];for(h=0;h<d.length;h++){if(i[h]||(i[h]=0),i[h]++,i[h]>20)return this.resources.W.Utils.debugTrace("Layout Manager","enforceAnchors","infinite loop"),this._enforceParentIfNeeded(g),void 0;if(d[h].$tempIndex=h,d[h].$layoutDirtyFlag&&d[h].isRendered()){for(var j=Number.MAX_VALUE,k=d[h],l=0;l<k.getAnchors().length;l++)j=Math.min(this._enforceSingleAnchor(k.getAnchors()[l],c),j);k.getHorizontalGroup()&&(j=Math.min(this._enforceHGroup(k),j)),delete k.$layoutDirtyFlag,h>j&&(h=j-1)}}var m=this._validateAllClean(d);e||this._enforceParentIfNeeded(g,c);var n=this._enforceAnchorsAgainIfNeeded(m,f);return n||g&&g.$layoutDirtyFlag||!1}for(h=0;h<a.length;h++)delete a[h].$layoutDirtyFlag}},_validateAllClean:function(a){for(var b=null,c=0;c<a.length;c++){var d=a[c];!b&&d.$layoutDirtyFlag&&(LOG.reportEvent(wixEvents.LAYOUT_DIRTY_AFTER_ENFORCE_ANCHORS),b=d),delete d.$tempIndex,delete d.$layoutDirtyFlag}return b},_enforceParentIfNeeded:function(a,b){a&&a.$layoutDirtyFlag===this.FLAG_DIRTY_BOTTOM&&this.enforceAnchors([a],!1,b)},_enforceAnchorsAgainIfNeeded:function(a,b){b=b||0;var c=!1;return a&&3>b&&(b+=1,c=this.enforceAnchors([a],a.$layoutDirtyFlag===this.FLAG_DIRTY_TOP,void 0,void 0,void 0,b)),c},_validateComponentsRendered:function(a){for(var b=0;b<a.length;b++)if(0===a[b].getPhysicalHeight())return!1;return!0},_validateNodesRendered:function(a){for(var b=[],c=0;c<a.length;c++){if(!a[c].getLogic)return!1;b.push(a[c].getLogic())}return this._validateComponentsRendered(b)},validateAnchorTargetsRendered:function(a){for(var b=0;b<a.length;b++)if(!a[b].toComp.isRendered())return!1;return!0},_getContainerContentHeight:function(a){for(var b=0,c=a.getChildComponents(),d=0,e=0;e<c.length;e++)c[e]&&c[e].getLogic&&(d=this._getCompBottom(c[e].getLogic())),b=Math.max(d,b);return b},_getCompBottom:function(a){var b=a.getBoundingY(),c=a.getBoundingHeight();return Math.max(b+c,0)},_getComponentContentHeight:function(a){var b=0;return b=a.getChildComponents&&this._validateNodesRendered(a.getChildComponents())?this._getContainerContentHeight(a):a.getMinPhysicalHeight()},getComponentMinResizeHeight:function(a){if(a.getHorizontalGroup()){var b=this._findAnchorToComp(a.getHorizontalGroup(),a);return this.getHGroupMinBottom(a.getHorizontalGroup())-a.getY()+b.distance}if(a.getChildComponents){var c=this._getContainerContentHeight(a);return a.getInlineContentContainer&&(c+=this._getContainerMarginHeight(a)),c}return 0},getComponentMinDragY:function(a,b){b||(b=this._emptyArr);for(var c=0,d=0;d<a.getReverseAnchors().length;d++){var e=a.getReverseAnchors()[d];if(!b.contains(e.fromComp))if(e.type==e.ANCHOR_BOTTOM_TOP){var f=this._getCompBottom(e.fromComp);c=Math.max(f,c)}else e.type==e.ANCHOR_TOP_TOP&&(c=Math.max(e.fromComp.getY(),c))}return c},getHGroupMinBottom:function(a){if(a.length<2)return 0;for(var b=-Number.MAX_VALUE,c=0;c<a.length;c++){var d=a[c];b=Math.max(this._getComponentContentHeight(d.toComp)-d.distance+d.toComp.getY(),b)}return b},getHGroupMinY:function(a){if(a.length<2)return 0;for(var b=-Number.MAX_VALUE,c=0;c<a.length;c++){var d=a[c];b=Math.max(this.getComponentMinDragY(d.toComp)-d.topToTop,b)}return b},_enforceHGroup:function(a){var b,c,d=Number.MAX_VALUE,e=a.getHorizontalGroup(),f=this._findAnchorToComp(e,a);if(!f)return Number.MAX_VALUE;if(a.$layoutDirtyFlag==this.FLAG_DIRTY_TOP){var g=this.getHGroupMinY(a.getHorizontalGroup()),h=Math.max(g,f.toComp.getY()-f.topToTop);for(d=Math.min(this._setHGroupPartY(f.fromComp,h),d),c=0;c<a.getHorizontalGroup().length;c++){b=a.getHorizontalGroup()[c];var i=b.fromComp.getY()+b.topToTop;d=Math.min(this._setHGroupPartY(b.toComp,i),d)}}var j=this.getHGroupMinBottom(a.getHorizontalGroup()),k=Math.max(j-f.fromComp.getY(),f.toComp.getY()+f.toComp.getPhysicalHeight()-f.distance-f.fromComp.getY());for(d=Math.min(this._setHGroupPartHeight(f.fromComp,k),d),c=0;c<a.getHorizontalGroup().length;c++){b=a.getHorizontalGroup()[c];var l=b.fromComp.getY()+b.fromComp.getPhysicalHeight()+b.distance-b.toComp.getY();d=Math.min(this._setHGroupPartHeight(b.toComp,l),d)}return d},_setHGroupPartHeight:function(a,b){var c=a.getPhysicalHeight();return c!=b&&(b=b-a.getExtraPixels().bottom-a.getExtraPixels().top,a.setHeight(b),a.$layoutDirtyFlag=this.FLAG_DIRTY_BOTTOM,this._changedByHGroup.include(a),void 0!==a.$tempIndex)?a.$tempIndex:Number.MAX_VALUE},_setHGroupPartY:function(a,b){var c=a.getY();return c!=b&&(a.setY(b),a.$layoutDirtyFlag=this.FLAG_DIRTY_TOP,this._changedByHGroup.include(a),void 0!==a.$tempIndex)?a.$tempIndex:Number.MAX_VALUE},updateChildAnchors:function(a){if(a&&a.getChildComponents){var b=a.getChildComponents();if(!this._validateNodesRendered(b))return;b.length>0?this._updateAnchors(b[0].getLogic(),[],!0):this._clearReverseAnchorsByScope(a.getReverseAnchors(),!0)}},_getAndClearChangedByHGroup:function(){var a=this._changedByHGroup;return this._changedByHGroup=[],a},_enforceSingleAnchor:function(a,b){if(a.type==a.ANCHOR_TOP_TOP&&a.fromComp.$layoutDirtyFlag===this.FLAG_DIRTY_BOTTOM)return Number.MAX_VALUE;var c;return c=a.type==a.ANCHOR_BOTTOM_PARENT||a.type==a.ANCHOR_BOTTOM_BOTTOM?this._enforceFromBottomTypeAnchor(a):this._enforceToTopTypeAnchor(a,b),this.fireEvent("singleAnchorEnforced",a),c},_enforceToTopTypeAnchor:function(a,b){var c=a.toComp,d=this._getAnchoredY(a),e=c.getBoundingY(),f=-Number.MAX_VALUE;if(a.type!=a.ANCHOR_BOTTOM_TOP||a.locked||(f=a.originalValue),!b){var g=c.getY(),h=d>e?d:this._getMaxAnchoredY(c,f),i=h-e;0!==i&&(c.setY(g+i),c.$layoutDirtyFlag=this.FLAG_DIRTY_TOP)}return Number.MAX_VALUE},_enforceFromBottomTypeAnchor:function(a){if(0!==a.toComp.getAngle())return Number.MAX_VALUE;var b=a.toComp,c=b.getBoundingHeight(),d=this._getAnchoredH(a),e=d;return a.toComp.layoutMinHeight?e=a.toComp.layoutMinHeight():a.locked||"wysiwyg.viewer.components.PagesContainer"===b.className||(e=a.originalValue),b.setHeight(d>c?d:this._getMaxAnchoredH(b,e)),c!==b.getBoundingHeight()&&(b.$layoutDirtyFlag=this.FLAG_DIRTY_BOTTOM,a.type==a.ANCHOR_BOTTOM_BOTTOM)?b.$tempIndex:Number.MAX_VALUE},_getMaxAnchoredH:function(a,b){b||(b=-Number.MAX_VALUE);var c=b;return a.getReverseAnchors().forEach(function(b){if(b.type==b.ANCHOR_BOTTOM_PARENT||b.type==b.ANCHOR_BOTTOM_BOTTOM){var d=this._getAnchoredH(b);b.locked||"wysiwyg.viewer.components.PagesContainer"===a.className||(d=Math.max(d,b.originalValue)),c=Math.max(d,c)}}.bind(this)),c},_getMaxAnchoredY:function(a,b){var c=this._getAnchoredY,d=b;return a.getReverseAnchors().forEach(function(a){if(a.type==a.ANCHOR_BOTTOM_TOP||a.type==a.ANCHOR_TOP_TOP){var b=c(a);d=Math.max(b,d)}}),d},_findAnchorToComp:function(a,b){for(var c=0;c<a.length;c++)if(a[c].toComp===b)return a[c]},_mergeSets:function(a,b){for(var c in b)a[c]=!0},isReady:function(){return this._isReady},clone:function(a){return this.parent(a)},_getRenderModifiers:function(){var a=this.resources.W.Viewer._siteStructureData;return a?a.get("renderModifiers")||{}:{}},appendSavedAnchor:function(a){this._savedAnchors?Object.append(this._savedAnchors,a):this.setSavedAnchor(a)},callForMeasure:function(){this._nextRenderId||(this._layoutValidationCounter=this._getLayoutCounter(),this._countToValidate())},_countToValidate:function(){this._layoutValidationCounter--,0===this._layoutValidationCounter?this._updateLayout():this._nextRenderId=W.Utils.callOnNextRenderPriority(this._countToValidate,30)},_getLayoutCounter:function(){return 5},_updateLayout:function(){this._nextRenderId=null;var a=this._getLayoutRootComp();this._measureInvalidatedComps(a),this._enforceAnchorsRecurse(a)},_getLayoutRootComp:function(){return W.Viewer.getSiteNode().$logic},_enforceAnchorsRecurse:function(a){var b;if(a.getChildComponents){b=a.getCurrentChildren?a.getCurrentChildren():a.getChildComponents();for(var c=[],d=!1,e=0;e<b.length;e++)b[e].getLogic&&(d=this._enforceAnchorsRecurse(b[e].$logic),(d||b[e].getLogic().wasHeightChanged())&&(b[e].$logic.validateHeight(),c.push(b[e].$logic)));return 0==c.length?!1:this.enforceAnchors(c,!1,void 0,void 0,!0)}},_measureInvalidatedComps:function(a){if(!a.NEW_BASE_COMP&&a.isMeasureNeeded()&&a.measure(),a.getChildComponents){var b;b=a.getCurrentChildren?a.getCurrentChildren():a.getChildComponents();for(var c=0;c<b.length;c++)b[c].getLogic&&this._measureInvalidatedComps(b[c].getLogic())}}})}),define.Class("wysiwyg.viewer.managers.PageManager",function(a){var b=a;b.inherits("bootstrap.managers.BaseManager"),b.resources(["W.Utils"]),b.binds(["_createMasterPage","_onLoadSiteSuccess","_onLoadSiteFailed","_saveSiteNode","_markPageAsLoaded","_savePageNodes","_handleFailedComps","_addFailedComps"]),b.utilize(["wysiwyg.viewer.managers.pages.PageHandler","wysiwyg.viewer.managers.pages.MasterPageHandler","wysiwyg.viewer.managers.pages.LazyPageLoader","wysiwyg.viewer.managers.pages.PageDeadCompsHandler"]),b.statics({EVENTS:{SITE_LOADED:"siteLoaded"},pageStatus:{NONE:0,LOADING:1,LOADED:2}}),b.methods({isReady:function(){return!0},clone:function(){return new this.$class},initialize:function(a,b){this._viewerName=a,this._dataResolver=b,this._loadSitePromise=null,this._siteNode=null,this._loadedPages={},this._pageNodes={},this._firstPageId=null,this._failedComps=[]},loadSite:function(a){this._initFirstPageInfo();var b=this;return this._loadSitePromise||(this._loadSitePromise=this._createMasterPage().then(this._saveSiteNode).then(this._savePageNodes).then(function(c){return a?b._loadAllPages(c):b._loadMasterAndFirstPage(c)}).then(this._handleFailedComps).then(this._onLoadSiteSuccess).fail(this._onLoadSiteFailed)),this._loadSitePromise},_initFirstPageInfo:function(){this._firstPageId=this._getFirstPageId(),this._startLoadingFirstPageData(this._firstPageId)},getDataResolver:function(){return this._dataResolver},_createMasterPage:function(){var a=new this.imports.MasterPageHandler(this._dataResolver,this._viewerName);this._propagateEvents(a);var b=a.loadMasterSignatureHtml();return this._masterPageHandler=a,b},_propagateEvents:function(a){a.on("siteNodeCreated",this,function(a){this.fireEvent("siteNodeCreated",a.data.siteNode)})},_saveSiteNode:function(a){return this._siteNode=a.rootCompNode,this._pageWidth=W.Viewer.getDocWidth(),a},_savePageNodes:function(a){var b=this._dataResolver.getPagesIds(),c=a.pageNodes,d=this;return _.forEach(b,function(a){d._pageNodes[a]=c[a]}),a},_loadMasterAndFirstPage:function(a){var b=a.pageNodes,c=[];return c.push(this._getLoadMasterPromise(a)),c.push(this.loadPage(this._firstPageId,b[this._firstPageId],!0)),Q.all(c)},_loadAllPages:function(a){var b=a.pageNodes,c=this._dataResolver.getPagesIds(),d=[];return d.push(this._getLoadMasterPromise(a)),_.forEach(c,function(a){d.push(this.loadPage(a,b[a],a===this._firstPageId))},this),Q.all(d)},_getLoadMasterPromise:function(a){var b=this._masterPageHandler.wixifyMasterPage(a);return b.then(this._addFailedComps),b},loadPage:function(a,b,c){if(!this._loadedPages[a]){this._loadedPages[a]=this.pageStatus.LOADING;var d=new this.imports.PageHandler(a,b,this._dataResolver,this._viewerName,this._pageWidth,c),e=d.loadPage();return e.then(this._markPageAsLoaded),e}},addLoadedPage:function(a,b){this._markPageAsLoaded({pageId:a,pageNode:b})},removePage:function(a){delete this._loadedPages[a],delete this._pageNodes[a]},getLoadedPages:function(){return this._loadedPages},_markPageAsLoaded:function(a){var b=a.pageId;this._loadedPages[b]=this.pageStatus.LOADED,this._pageNodes[b]=a.pageNode,this._addFailedComps(a)},_handleFailedComps:function(){if(this._failedComps.length){var a=new this.imports.PageDeadCompsHandler;return a.handleDeadComps(this._failedComps)}return!0},getPageNodes:function(){return this._pageNodes},_addFailedComps:function(a){this._failedComps=this._failedComps.concat(a.failed)},_onLoadSiteFailed:function(a){var b=a.stack?a.stack:a;throw console.log("Failed to load site",b),LOG.reportError(wixErrors.PM_SITE_LOAD_FAILED,"PageManager","_onLoadSiteFailed",b),a},_onLoadSiteSuccess:function(){this.fireEvent(this.EVENTS.SITE_LOADED,this._siteNode),this._startPageLazyLoading()},_startPageLazyLoading:function(){this._dataResolver.isAllPagesDataLoaded()||(this._lazyPageLoader=this._createLazyPageLoader(),this._lazyPageLoader.start())},_createLazyPageLoader:function(){return new this.imports.LazyPageLoader(this._dataResolver)},loadPageById:function(a,b,c,d){var e=this.loadPage(a,b);e?e.then(c.bind(d)).done(function(){},function(){}):c.call(d,{pageId:a,pageNode:this._pageNodes[a]})},isPageLoadingCompleted:function(){return this._loadSitePromise&&this._loadSitePromise.isFulfilled()},isPageLoaded:function(a){return this._loadedPages[a]===this.pageStatus.LOADED},_getFirstPageId:function(){var a,b=this._dataResolver.getMainPageId(),c=this._dataResolver.getPagesIds(),d=this.resources.W.Utils.hash.getHashParts(),e="zoom"===d.id?d.extData.match("([^/]+)/([^/]+)")[1]:d.id;return a=e&&_.contains(c,e)?e:b&&_.contains(c,b)?b:_.first(c)},_startLoadingFirstPageData:function(a){this._dataResolver.getPageData("master"),this._dataResolver.getPageData(a)}})}),define.Class("wysiwyg.viewer.managers.SiteMembersManager",function(a){var b=a;b.inherits("bootstrap.managers.BaseManager"),b.resources(["W.Viewer","W.Utils","W.Config","W.MessagesController"]),b.binds(["_initializeAPI","openSiteMembersPopup","closeSiteMembersPopup"]),b.statics({AUTH_STATES:{AUTH:"auth token and cookie exist",NO_AUTH_WITH_COOKIE:"no auth token, cookie exist",NO_AUTH_WITHOUT_COOKIE:"no auth token, cookie doesnt exist"},INTENTS:{LOGIN:"LOGIN",REGISTER:"REGISTER",UPDATE_USER:"UPDATE"},API_ERRORS:{API_NOT_LOADED:"Site Members API was not loaded",TOKEN_IS_INVALID:"Authentication Token is invalid"},RESET_PASSWORD_KEY_PARAMETER:"forgotPasswordToken",OWNER_LOGOUT_ACTION:{TITLE:"Logout failure",MESSAGE:"You are the owner of this website, and are logged in on Wix.com. Please log out of Wix.com to test the Site Members feature."},WIX_USER_COOKIE_NAME:"wixClient",LOGOUT_MESSAGES:{TITLE:"Logout Unsuccessful",IN_PROGRESS:"Something went wrong with that logout. Please give it another go."}}),b.fields({MAX_NUMBER_OF_RETRIES:10,DELAY_OF_RETRY_IN_MS:300}),b.methods({initialize:function(){var a=this.resources.W.Viewer.getAppDataHandler().getSiteMembersData();this.setData(a);var b=this;this.resources.W.Viewer.addEvent("SiteReady",function(){b._showPasswordResetIfNeeded()})},_showPasswordResetIfNeeded:function(){var a=this._getCurrentSearchURL();if(this._isResetPasswordRequested(a)&&this._isViewerMode()){var b=this;this.resource.getResourceValue("W.SiteMembers",function(c){var d=b._getResetPasswordIdFromURL(a);c.openSiteMembersPopup({intent:"RESETPASSWORD",disableCancel:!0,resetPassKey:d})})}},_getCurrentSearchURL:function(){return window.location.search},sendUserPasswordResetEmail:function(a,b,c){var d=this._getReturnUrl();this._api.sendForgotPasswordMail(a,d,b,c)},_getReturnUrl:function(){var a=this._getLocationUrl();return a=encodeURIComponent(a)},_getLocationUrl:function(){return window.location.href},resetPassword:function(a,b,c){var d=this._getCurrentSearchURL(),e=this._getResetPasswordIdFromURL(d);this._api.resetMemberPassword(e,a,b,c)},_isResetPasswordRequested:function(a){return a.indexOf(this.RESET_PASSWORD_KEY_PARAMETER)>=0},_getResetPasswordIdFromURL:function(a){return W.Utils.getQueryParam(this.RESET_PASSWORD_KEY_PARAMETER,a)},_isViewerMode:function(){return"site"===window.viewMode},isReady:function(){return!0},setData:function(a){this._smData=a,a&&this._loadScriptAndInitAPI()},_loadScriptAndInitAPI:function(){if(window.SiteMembers)this._initializeAPI();else{var a=window.serviceTopology.scriptsLocationMap,b=a.sitemembers;define.getDefinition("resource","SiteMembersSdk")||define.resource("SiteMembersSdk").withUrls(b+"/SiteMembers.js"),resource.getResourceValue("SiteMembersSdk",function(){this._initializeAPI(),this._checkQueryStringForFormOpen(),this._preloadMemberDetails()}.bind(this))}},_initializeAPI:function(){var a=W.Config.getServiceTopologyProperty("siteMembersUrl"),b="siteMembers",c=window.SiteMembers,d=this.getCollectionId();if(d){var e=W.Config.getMetaSiteId();window[b]=new c(d,a,b,e),this._api=window[b],this._token=this.getData().smtoken,this._apiReady=!0
}else LOG.reportError("Site members - collection Id is undefined? ["+d+"]",this.$className,"_initializeAPI")},_checkQueryStringForFormOpen:function(){var a=this.injects().Utils,b=a.getQueryParam("intent");if(b&&!this._queryStringHandled){if(!this.injects().Viewer.isSiteReady()||!this.isApiReady())return a.callLater(this._checkQueryStringForFormOpen,[],this,500),void 0;this.openSiteMembersPopup({intent:b}),this._queryStringHandled=!0}},_preloadMemberDetails:function(){this.getMemberDetails(function(a){this._memberDetails=a}.bind(this))},getData:function(){return this._smData||{}},getCollectionId:function(){return this.getData().smcollectionId||this.getData().id},getCollectionOwner:function(){return this.getData().owner},getCollectionType:function(){return this.getData().collectionType||this.getData().type},isServiceProvisioned:function(){return!!this._smData},isApiReady:function(){return this._apiReady},login:function(a,b,c,d,e,f){if(this._apiReady){var g=this.resources.W.Config.getSvSession();this._api.login(a,b,c,d,e,f,g)}else e&&e({code:"API_NOT_LOADED",description:this.API_ERRORS.API_NOT_LOADED})},register:function(a,b,c,d,e){if(this._apiReady){var f=this.resources.W.Config.getSvSession();this._api.register(a,b,c,d,e,f)}else d&&d({code:"API_NOT_LOADED",description:this.API_ERRORS.API_NOT_LOADED})},updateMemberDetails:function(a,b,c){this._apiReady?this._token?this._api.updateMemberDetails(this._token,a,b,c):c&&c({code:"TOKEN_IS_INVALID",description:this.API_ERRORS.TOKEN_IS_INVALID}):c&&c({code:"API_NOT_LOADED",description:this.API_ERRORS.API_NOT_LOADED})},getMemberDetails:function(a,b){this._memberDetails?a(this._memberDetails):this._apiReady?this._token?this._api.getMemberDetails(this._token,a,b):b&&b({code:"TOKEN_IS_INVALID",description:this.API_ERRORS.TOKEN_IS_INVALID}):b&&b({code:"API_NOT_LOADED",description:this.API_ERRORS.API_NOT_LOADED})},applyForMembership:function(a,b,c,d){if(this._apiReady){var e=this.resources.W.Config.getSvSession();this._api.apply(a,b,c,d,e)}else d&&d({code:"API_NOT_LOADED",description:this.API_ERRORS.API_NOT_LOADED})},logout:function(){return this._retries=0,this._isOwnerLoggedIn()?(this._informSiteOwnerToLogout(),!1):(this._logoutSiteMember(),!0)},_logoutSiteMember:function(){this._apiReady&&(this.resources.W.MessagesController.showTryAgainMessage(this.LOGOUT_MESSAGES.TITLE,this.LOGOUT_MESSAGES.IN_PROGRESS,this.MAX_NUMBER_OF_RETRIES*this.DELAY_OF_RETRY_IN_MS,this.logout.bind(this)),delete this._token,this._logoutUser())},_logoutUser:function(){this._api.logout(),this._retries<this.MAX_NUMBER_OF_RETRIES&&this._api.isSessionValid()?(this._retries++,this._logoutRetry()):this._retries>=this.MAX_NUMBER_OF_RETRIES?LOG.reportError(wixErrors.SM_LOGOUT_FAILED,"SiteMembersManager"):location.reload()},_logoutRetry:function(){var a=this;setTimeout(function(){a._logoutUser()},this.DELAY_OF_RETRY_IN_MS)},_informSiteOwnerToLogout:function(){var a=this.OWNER_LOGOUT_ACTION.TITLE,b=this.OWNER_LOGOUT_ACTION.MESSAGE;W.MessagesController.showMessage(a,b,function(){})},_isOwnerLoggedIn:function(){return this.resources.W.Utils.cookies.hasCookie(this.WIX_USER_COOKIE_NAME)&&this._isSiteBelongToUser()},_isSiteBelongToUser:function(){var a=null,b=function(b){a=b};return this.getMemberDetails(b,function(){}),a&&a.owner===!0},getToken:function(){return this._token},isLoggedIn:function(){var a=this._getAuthenticationState();return a==this.AUTH_STATES.AUTH},isNotAuthenticatedWithCookie:function(){if(this.isLoggedIn())return!1;var a=this._getAuthenticationState();return a==this.AUTH_STATES.NO_AUTH_WITH_COOKIE},_getAuthenticationState:function(){var a=!!this._token,b=this._api?this._api.isSessionValid():!1;return a?this.AUTH_STATES.AUTH:!a&&b?this.AUTH_STATES.NO_AUTH_WITH_COOKIE:a||b?void 0:this.AUTH_STATES.NO_AUTH_WITHOUT_COOKIE},openSiteMembersPopup:function(a){var b=a&&a.intent,c=a&&a.authCallback;b||(b=this.isNotAuthenticatedWithCookie()?this.INTENTS.LOGIN:this.INTENTS.REGISTER);var d=[this.INTENTS.LOGIN,this.INTENTS.REGISTER];if(d.contains(b)&&this.isLoggedIn())this.injects().SiteMembers.getMemberDetails(function(a){this.reportAuthStatusChange(c,!0,a)}.bind(this));else{var e=this.injects().SiteMembers;this._siteMembersContainer&&(this._previousContainer=this._siteMembersContainer._args,this.closeSiteMembersPopup());var f=!this._openSiteMembersPopupRequested||"RESETPASSWORD"===b;e.isApiReady()&&!this._siteMembersContainer&&f&&(this._openSiteMembersPopupRequested=!0,W.Components.createComponent("wysiwyg.viewer.components.sm.SMContainer","wysiwyg.viewer.skins.sm.SMContainerSkin",null,a,function(){},function(a){this._previousContainer&&(a._previousContainer=this._previousContainer),this._siteMembersContainer=a;var b=a.getViewNode();b.setStyle("opacity","0.0");var c=this.injects().Viewer.getSiteNode();b.insertInto(c);new Fx.Tween(b,{duration:"short",link:"ignore"}).start("opacity","1.0")}.bind(this)))}},closeSiteMembersPopup:function(){if(this._siteMembersContainer){var a=this._siteMembersContainer.getViewNode(),b=new Fx.Tween(a,{duration:"short",link:"chain"});b.addEvent("complete",function(){b.removeEvent("complete",arguments.callee),a.removeFromDOM()}.bind(this)),b.start("opacity","0.0"),delete this._siteMembersContainer,this._openSiteMembersPopupRequested=!1}},reportAuthStatusChange:function(a,b,c){a&&a({authResponse:b,data:c})}})}),define.Class("wysiwyg.viewer.managers.WViewManager",function(a){var b=a;b.inherits("bootstrap.managers.BaseManager"),b.utilize(["wysiwyg.managers.appdata.AppDataHandler","wysiwyg.viewer.managers.viewer.SiteView","wysiwyg.viewer.managers.viewer.HashChangeHandler","wysiwyg.viewer.managers.viewer.ViewerZoomHandler","wysiwyg.viewer.managers.viewer.SiteMembersHandler","wysiwyg.viewer.managers.pages.data.DataResolverFactory","wysiwyg.common.managers.viewer.MobileViewHandler","wysiwyg.viewer.utils.PageConfigurationRepository","wysiwyg.viewer.managers.viewer.ViewerStaticLoadingHandler","wysiwyg.common.utils.AnchorManager"]),b.traits(["wysiwyg.viewer.managers.viewer.ViewerProxy"]),b.resources(["W.Utils","W.Commands","W.Data","W.Config","W.Classes"]),b.fields({_appDataHandler:null,_currentViewerName:null}),b.binds(["_onPageNavigation","_setPageToCurrent","_setPageOnSiteLoad"]),b.statics({FIXED_CONTAINER_ID:"FIXED_CONTAINER"}),b.methods({initialize:function(){this._initMembers(),this._registerPageConfiguration(),this.parent(),this._isReady=!0,this.addHeightChangeCallback(function(){return this.getSiteNode().getLogic().getSiteStructureHeightWithMenu()}.bind(this)),this.addEvent("pageTransitionEnded",this._onPageNavigation),this._initAdData(),this._pageDataWaitingList=[],this.resources.W.Commands.registerCommandAndListener("WViewerCommands.PageChangeStart",this,this._onPageChangeStart),this.resources.W.Commands.registerCommandAndListener("WViewerCommands.PageChangeComplete",this,this._onPageChangeComplete),this._anchorManager=new this.imports.AnchorManager(this)},_initMembers:function(){this._fixedContainer=this._addFixedItemsContainer(this.FIXED_CONTAINER_ID),this._zoomHandler=new this.imports.ViewerZoomHandler(this,this._fixedContainer),this._siteMembersHandler=new this.imports.SiteMembersHandler(this,this._fixedContainer),this._mobileHandler=new this.imports.MobileViewHandler,this._hashChangeHandler=new this.imports.HashChangeHandler(this,this._zoomHandler,this._siteMembersHandler),this._dataResolver=(new this.imports.DataResolverFactory).getDataResolver(),this._pageConfigurationRepository=new this.imports.PageConfigurationRepository,this._loadedViewers={},this._activeViewer_=null,this._currentPageExtData=null,this._initCurrentPageFromHash(),this.resources.W.Config.isLoadedFromStatic()&&(this._staticLoadingHandler_=new this.imports.ViewerStaticLoadingHandler(this))},_initAdData:function(){var a={},b={};a[Constants.ViewerTypesParams.TYPES.DESKTOP]=window.adData,a[Constants.ViewerTypesParams.TYPES.MOBILE]=window.mobileAdData,this._adData=a;var c=document.getElementById("wixFooter");c?_.forEach(c.attributes,function(a){b[a.name]=a.value}):b=null,this._wixAdsNodeData=b},getNodeAdData:function(){return this._wixAdsNodeData},captureMobile:function(){var a=this;this.resources.W.Classes.getClass("wysiwyg.viewer.managers.viewer.ViewerCaptureHandler",function(b){a._captureHandler_=new b(a),a._captureHandler_.captureMobile()})},_initCurrentPageFromHash:function(){var a=this.resources.W.Utils.hash.getHash(),b=W.Data.isDataAvailable("#"+a)&&W.Data.getDataByQuery("#"+a);this._hashChangeHandler.isPageDataType(b.getType)&&(this._currentPageId=a)},_registerPageConfiguration:function(){this._pageConfigurationRepository.registerPageType("Page",function(a){return a.type}),this._pageConfigurationRepository.registerConfig("Page",{})},_addFixedItemsContainer:function(a){var b=new Element("div",{id:a});return document.body.appendChild(b),b},initiateSite:function(){var a=this,b=function(b){var c=b&&(W.Config.isMobileOptimizedViewOn()||W.Config.forceMobileOptimizedViewOn()),d=c?Constants.ViewerTypesParams.TYPES.MOBILE:Constants.ViewerTypesParams.TYPES.DESKTOP;a._firstActiveViewerLoad(d),W.Config.mobileConfig.isMobile()&&a._mobileHandler.setMobileSite(d),a._activeViewer_.initiateSite()};W.Config.env.$isPublicViewerFrame&&(W.Config.mobileConfig.isMobile()||W.Config.forceMobileOptimizedViewOn())?this._dataResolver.isStructureExists(Constants.ViewerTypesParams.TYPES.MOBILE).then(b):b(!1)},switchViewer:function(a,b,c){this.resources.W.Commands.executeCommand("WViewerCommands.MediaZoom.Close"),this._activeViewer_&&this._activeViewer_.getSiteNode().$logic.collapse();var d=this._loadedViewers[a];d&&b&&d.dispose(),(!d||b)&&this._initSiteView(a,c,this._setPageToCurrent),this._activeViewer_&&this.removeEventPropagation(),this._setSiteViewToBeActive(a),this._activeViewer_.getSiteNode()&&(this._activeViewer_.getSiteNode().$logic.uncollapse(),this._activeViewer_.isSiteReady()&&this._setPageToCurrent())},_firstActiveViewerLoad:function(a){var b=a===Constants.ViewerTypesParams.TYPES.DESKTOP,c=b?void 0:Constants.ViewerTypesParams.DOC_WIDTH[a];this._initSiteView(a,c,this._setPageOnSiteLoad),this._setSiteViewToBeActive(a)},_initSiteView:function(a,b,c){this._loadedViewers[a]=new this.imports.SiteView(this,this._dataResolver,a),this._loadedViewers[a].addEvent("SiteReady",c),b&&this._loadedViewers[a]._updateDocWidth(b)},_setSiteViewToBeActive:function(a){var b=this._currentViewerName;this._activeViewer_=this._loadedViewers[a],this._currentViewerName=a,this.propagateEvents(),this._currentViewerName!==b&&this.resources.W.Commands.executeCommand("WPreviewCommands.ViewerStateChanged",{viewerMode:a})},_setPageToCurrent:function(){this._activeViewer_.removeEvent("SiteReady",this._setPageToCurrent),this._currentPageId=this._currentPageId||this.getHomePageId();var a=this.resources.W.Utils.hash.getHashParts().extData;this._activeViewer_.changePageWithTransition(this._currentPageId),this._activeViewer_._onPageExtraDataChange_(a,this._currentPageId,!1)},_setPageOnSiteLoad:function(){this._activeViewer_.removeEvent("SiteReady",this._setPageOnSiteLoad),this.resources.W.Utils.hash.fireHashChangeEvent(!0),W.Commands.executeCommand("WViewerCommands.SelectedPageChanged",this._currentPageId)},getViewerMode:function(){return this._currentViewerName},getSiteView:function(a){return this._loadedViewers[a]},getCurrentPageId:function(){return this._currentPageId},_setCurrentPageId_:function(a){this._currentPageId=a},getPageConfigurationRepository:function(){return this._pageConfigurationRepository},isPageComponent:function(a){return"mobile.core.components.Page"===a||"core.components.Page"===a||"wixapps.integration.components.AppPage"===a},_onPageChangeStart:function(a){"site"===window.viewMode&&a.fromPageId&&LOG.reportBeatStartEvent({pageId:a.pageId,isFromReset:a.isFromReset})},_onPageChangeComplete:function(a){"site"===window.viewMode&&LOG.reportBeatFinishEvent({pageId:a.pageId})},_onPageNavigation:function(a){this._setDocumentTitle(a),this.resources.W.Commands.executeCommand("WViewerCommands.MediaZoom.Close")},_getCustomPageTitlePromise:function(){var a=Q.defer(),b=null;try{b=this.getCurrentPageNode().getLogic()}catch(c){}return b&&b.getCustomPageTitle?b.getCustomPageTitle(function(b){a.resolve(b)}):a.resolve(null),a.promise},_setDocumentTitle:function(a){var b="",c=this.getPagesData()[a],d=c.get("pageTitleSEO")||"",e=c.get("title")||"",f=W.Config.getSiteTitleSEO(),g=this.isHomePage(a);this._getCustomPageTitlePromise().then(function(a){a?b=f?f+" | "+a:a:d?b=d:(b=f,g||(b+=b?" | ":"",b+=e)),b&&(document.title=b)})},getAppPages:function(){var a={},b=this;return Object.each(this.getPages(),function(c){var d=c.getAttribute("dataQuery"),e=b.resources.W.Data.getDataByQuery(d),f=e.getData();if("AppPage"===f.type||"AppBuilderPage"===f.type){var g=e.get("appPageId");a[g]={data:e,node:c}}}),a},getAppDataHandler:function(){return this._appDataHandler||(this._appDataHandler=new this.imports.AppDataHandler),this._appDataHandler},setSite:function(){},getAdData:function(){return this._adData},addHeightChangeCallback:function(a){this._heightChangeCallbacks=this._heightChangeCallbacks||[],this._heightChangeCallbacks.push(a)},enterFullScreenMode:function(){this._isFullScreen||(W.Config.env.$isEditorViewerFrame&&window.parent.document.body.addClass("fullScreenMode"),document.body.addClass("fullScreenMode"),this._isFullScreen=!0,this._currentPageExtData=this.resources.W.Utils.hash.getHashParts().extData)},exitFullScreenMode:function(){if(this._isFullScreen){var a,b="";this.getCurrentPageId()?(a=this.getCurrentPageId(),b=this._currentPageExtData):a=this.getHomePageId(),this._hashChangeHandler._setUrlHashToPage(a,b),W.Config.env.$isEditorViewerFrame&&window.parent.document.body.removeClass("fullScreenMode"),document.body.removeClass("fullScreenMode"),this._isFullScreen=!1}},getActiveViewerHeightFromCallback:function(){if(!this._heightChangeCallbacks)return 0;var a,b=0;for(a=0;a<this._heightChangeCallbacks.length;a++)b+=this._heightChangeCallbacks[a]();return b},getScrollTop:function(){return document.body.scrollTop},goToPage:function(a,b){var c=W.Data.getDataByQuery("#"+a);c&&(this._siteMembersHandler.checkRequireLogin(c,this.setUrlHashToPage.bind(this,a,b),!1),this.fireEvent("pageChanging"))},setUrlHashToPage:function(a,b,c){this._hashChangeHandler._setUrlHashToPage(a,b,c)},handleQuickActions:function(){if(this.resources.W.Config.mobileConfig.isMobile()){var a=new this.imports.MobileQuickActionsHandler;a.handleMobileQuickActions()}},getDefaultGetZoomDisplayerFunction:function(a){return this._zoomHandler.getDefaultGetZoomDisplayerFunction(a)},getDefaultGetHashPartsFunction:function(a){return this._zoomHandler.getDefaultGetHashPartsFunction(a)},removeZoomElement:function(){return this._zoomHandler.removeZoomElement()},getZoomHandler:function(){return this._zoomHandler},setPageAsNotValidated:function(a){return this._siteMembersHandler.setPageAsNotValidated(a)},_getDataResolver_:function(){return this._dataResolver},setViewportAttribute:function(a,b){this._mobileHandler.setViewportAttribute(a,b)},setViewportTag:function(a,b){this._mobileHandler.setViewportTag(a,b)},resetViewportTag:function(){this._mobileHandler._handleMobileRotation()},addViewerRotationListener:function(){this._mobileHandler.addRotationEventListener()},removeViewerRotationListener:function(){this._mobileHandler.removeRotationEventListener()},createElement:function(a,b){return new Element(a,b)},addPage:function(a,b){this._dataResolver.addPage(a),this._activeViewer_.getPageManager().addLoadedPage(a.id,b);var c=this.resources.W.Data.getDataByQuery("#"+a.id);this._notifyPageDataLoaded(c)},removePage:function(a){this._dataResolver.removePage(a),this._activeViewer_.getPageManager().removePage(a.getComponentId())},_notifyPageDataLoaded:function(a){this._pageDataWaitingList=_.filter(this._pageDataWaitingList,function(b){return b.predicate(a)?(b.q.resolve(a),!1):!0})},_waitForPageData:function(a,b){this._pageDataWaitingList.push({predicate:a,q:b})},getPageDataPromise:function(a){var b=Q.defer(),c=this.getPagesData(),d=_.find(c,a);return d?b.resolve(d):this._waitForPageData(a,b),b.promise},getHomePageId:function(){return this._dataResolver.getMainPageId()},clone:function(a){return this.parent(a)},isReady:function(){return this._isReady},setLinkTipFunc:function(a){this._linkTipFunc=a},getLinkTipFunc:function(){return this._linkTipFunc},getSiteName:function(){return window.rendererModel.siteName||""},getAnchorManager:function(){return this._anchorManager}})}),define.Class("wysiwyg.viewer.managers.actions.PageInAction",function(a){var b=a;b.inherits("wysiwyg.viewer.managers.actions.base.BaseAction"),b.resources(["W.Viewer","W.Commands","W.Config","W.Utils"]),b.binds(["_onTickEvent","_onPageTransitionStart","_onPageTransitionComplete"]),b.fields({_siteTargetsPlayData:[],_pageTargetsToPlay:[],_defaultWaitForPageTransition:!0,_defaultHideOnStart:!1,_animateOnTickEvent:!1}),b.methods({initialize:function(a){this.parent(),this._animations=a,this.resources.W.Commands.registerCommandListenerByName("WViewerCommands.PageTransitionComplete",this,this._onPageTransitionComplete),this.resources.W.Commands.registerCommandListenerByName("WViewerCommands.PageTransitionStart",this,this._onPageTransitionStart),this.resources.W.Commands.registerCommandListenerByName("WPreviewCommands.ViewerStateChanged",this,this._onViewerStateChanged),this.resources.W.Commands.registerCommandListenerByName("WPreviewCommands.WEditModeChanged",this,this._onEditModeChanged),this.resources.W.Commands.registerCommandListenerByName("WPreviewCommands.FeedbackQuickTourEnded",this,this._onFeedbackQuickTourEnded),this.resources.W.Commands.registerCommandListenerByName("WViewerCommands.PageChangeRequested",this,this._onPageChange)},addBehaviors:function(a){this.parent(a),this._isPublic&&_.forEach(a,function(a){this._hideSingleElement(a.targetId,a.name)},this)},_addListeners:function(){this._animations.addTickerEvent(this._onTickEvent)},_removeListeners:function(){this._animations.removeTickerEvent(this._onTickEvent)},_onPageChange:function(a){(a.fromPageId||!this.resources.W.Config.env.$isEditorViewerFrame)&&(a.fromPageId&&this._clearAnimations(a.fromPageId),a.pageId&&(this._hideElements(a.pageId),this._hideElements("master")))},_onPageTransitionStart:function(a){if(this._getCurrentPageId()===a.pageId&&this._animations.isReady()&&"PREVIEW"===this.resources.W.Config.env.$editorMode){this._resetPageTargetsToPlay();var b=this.getCurrentPageTargetsIds();this._populateSiteTargetsPlayData(b),this._populatePageTargetsToPlay(b,{isPageTransitionEnd:!1}),this._startAnimationEvents()}},_onPageTransitionComplete:function(a){if(this._getCurrentPageId()===a.pageId&&this._animations.isReady()&&"PREVIEW"===this.resources.W.Config.env.$editorMode){var b=this.getCurrentPageTargetsIds();this._populateSiteTargetsPlayData(b),this._populatePageTargetsToPlay(b,{isPageTransitionEnd:!0}),this._startAnimationEvents()}},_populateSiteTargetsPlayData:function(a){_.forEach(a,function(a){var b;this._siteTargetsPlayData[a]||(b=this._getIsPlayOnceByTargetId(a),this._siteTargetsPlayData[a]={isPlayed:!1,isPlayOnce:b})},this)},_populatePageTargetsToPlay:function(a,b){var c,d,e,f;for(c=0,d=a.length;d>c;c++)e=a[c],f=this._isAnimateOnPageTransitionEnd(e),f===b.isPageTransitionEnd&&(this._siteTargetsPlayData[e].isPlayOnce?this._siteTargetsPlayData[e].isPlayed||this._pageTargetsToPlay.push(e):this._pageTargetsToPlay.push(e))},_startAnimationEvents:function(){this._animateOnTickEvent=!0,this._isTargetsToAnimate()&&this._addListeners()},_getIsPlayOnceByTargetId:function(a){var b;return b="master"===this.getPageIdByTargetId(a)?!0:_.some(this.getBehaviorsByTargetId(a),"playOnce")},_isAnimateOnPageTransitionEnd:function(a){var b=this._getAnimationsByTargetId(a),c=this._defaultWaitForPageTransition;return _.forEach(b,function(a){return a.options&&"undefined"!=typeof a.options.waitForPageTransition&&(c=a.options.waitForPageTransition),c}),c},_onTickEvent:function(){this._animateOnTickEvent&&(this._animateOnTickEvent=!1,this._animateTargets(),this._isTargetsToAnimate()||this._removeListeners())},_animateTargets:function(){if(this._isTargetsToAnimate())for(var a=this._pageTargetsToPlay.length;a--;){var b=this._pageTargetsToPlay[a];this._isTweening(b)||(_.forEach(this.getBehaviorsByTargetId(b),function(a){var c=a.params||{},d=this._getDomElementByTargetId(b);this._animations.applyTween(a.name,d,a.duration,a.delay,_.extend(c,{autoClear:!0}))},this),this._siteTargetsPlayData[b].isPlayed=!0,this._pageTargetsToPlay.splice(a,1))}},_isPlayed:function(a){return this._siteTargetsPlayData[a]&&this._siteTargetsPlayData[a].isPlayed},_isPlayOnce:function(a){return this._siteTargetsPlayData[a]&&this._siteTargetsPlayData[a].isPlayOnce},_hideSingleElement:function(a,b){var c=this._isPlayed(a),d=this._isPlayOnce(a);if(!c||!d){var e=this._getDomElementByTargetId(a);this._animations.hideSingleElement(e,b)}},_unHideSingleElement:function(a){var b=this._getDomElementByTargetId(a);this._animations.unHideSingleElement(b)},_onViewerStateChanged:function(a){var b=this.resources.W.Config.env.$editorMode;this._resetSiteAnimationDataAndListeners(),"PREVIEW"===b&&a.viewerMode===Constants.ViewerTypesParams.TYPES.DESKTOP&&this._simulatePageChange()},_onEditModeChanged:function(a){this._resetSiteAnimationDataAndListeners(),"PREVIEW"===a&&this._simulatePageChange()},_onFeedbackQuickTourEnded:function(){this._resetSiteAnimationDataAndListeners(),this._simulatePageChange()},_resetSiteAnimationDataAndListeners:function(){this._removeListeners(),this._resetSiteTargetsPlayData(),this.clearAllAnimationTargets()},_simulatePageChange:function(){var a=this._getCurrentPageId();this.hideCurrentPageAnimationTargets(),_.defer(this._onPageTransitionStart,{pageId:a}),_.defer(this._onPageTransitionComplete,{pageId:a})},_getCurrentPageId:function(){return this.resources.W.Viewer.getCurrentPageId()},_getDomElementByTargetId:function(a){return this.resources.W.Viewer.getCompByID(a)},_resetPageTargetsToPlay:function(){this._pageTargetsToPlay=[]},_resetSiteTargetsPlayData:function(){this._siteTargetsPlayData=[]},_isTargetsToAnimate:function(){return this._pageTargetsToPlay.length>0},_getAnimationsByTargetId:function(a){var b=this.getBehaviorsByTargetId(a),c=[];return _.forEach(b,function(a){c.push(this._animations.getAnimationDefinition(a.name))},this),c},_isTweening:function(a){var b=this._getDomElementByTargetId(a);return this._animations.isTweening(b)},_hideElements:function(a){var b=this.getBehaviorsByPageId(a);_.forEach(b,function(a){this._hideSingleElement(a.targetId,a.name)},this)},_clearAnimations:function(a){var b=this.getBehaviorsByPageId(a);_.forEach(b,function(a){var b=this._getDomElementByTargetId(a.targetId);this._animations.clear(b)},this)},removeComponentBehaviors:function(a){var b=this.getBehaviorsBySourceId(a);_.forEach(b,function(a){this._unHideSingleElement(a.targetId)},this),this.parent(a)}})}),define.Class("wysiwyg.viewer.managers.actions.ScreenInAction",function(a){var b=a;b.inherits("wysiwyg.viewer.managers.actions.base.BaseAction"),b.resources(["W.Viewer","W.Commands","W.Config","W.Utils"]),b.binds(["_onScrollEvent","_onResizeEvent","_onTickEvent","_onPageTransitionStart","_onPageTransitionComplete"]),b.fields({_siteTargetsPlayData:[],_pageTargetsToPlay:[],_defaultInViewportThreshold:10,_defaultWaitForPageTransition:!0,_defaultHideOnStart:!1,_animateOnTickEvent:!1}),b.methods({initialize:function(a){this.parent(),this._animations=a,this.resources.W.Commands.registerCommandListenerByName("WViewerCommands.PageTransitionComplete",this,this._onPageTransitionComplete),this.resources.W.Commands.registerCommandListenerByName("WViewerCommands.PageTransitionStart",this,this._onPageTransitionStart),this.resources.W.Commands.registerCommandListenerByName("WPreviewCommands.ViewerStateChanged",this,this._onViewerStateChanged),this.resources.W.Commands.registerCommandListenerByName("WPreviewCommands.WEditModeChanged",this,this._onEditModeChanged),this.resources.W.Commands.registerCommandListenerByName("WPreviewCommands.FeedbackQuickTourEnded",this,this._onFeedbackQuickTourEnded),this.resources.W.Commands.registerCommandListenerByName("WViewerCommands.PageChangeRequested",this,this._onPageChange)},addBehaviors:function(a){this.parent(a),this._isPublic&&_.forEach(a,function(a){this._hideSingleElement(a.targetId,a.name)},this)},_addListeners:function(){$(window).addEvent("scroll",this._onScrollEvent),$(window).addEvent("resize",this._onResizeEvent),this._animations.addTickerEvent(this._onTickEvent)},_removeListeners:function(){$(window).removeEvent("scroll",this._onScrollEvent),$(window).removeEvent("resize",this._onResizeEvent),this._animations.removeTickerEvent(this._onTickEvent)},_onPageChange:function(a){(a.fromPageId||!this.resources.W.Config.env.$isEditorViewerFrame)&&(a.fromPageId&&this._clearAnimations(a.fromPageId),a.pageId&&(this._hideElements(a.pageId),this._hideElements("master")))},_onPageTransitionStart:function(a){if(this._getCurrentPageId()===a.pageId&&this._animations.isReady()&&"PREVIEW"===this.resources.W.Config.env.$editorMode){this._resetPageTargetsToPlay();var b=this.getCurrentPageTargetsIds();this._populateSiteTargetsPlayData(b),this._populatePageTargetsToPlay(b,{isPageTransitionEnd:!1}),this._startAnimationEvents()}},_onPageTransitionComplete:function(a){if(this._getCurrentPageId()===a.pageId&&this._animations.isReady()&&"PREVIEW"===this.resources.W.Config.env.$editorMode){var b=this.getCurrentPageTargetsIds();this._populateSiteTargetsPlayData(b),this._populatePageTargetsToPlay(b,{isPageTransitionEnd:!0}),this._startAnimationEvents()}},_populateSiteTargetsPlayData:function(a){_.forEach(a,function(a){var b;this._siteTargetsPlayData[a]||(b=this._getIsPlayOnceByTargetId(a),this._siteTargetsPlayData[a]={isPlayed:!1,isPlayOnce:b}),this._siteTargetsPlayData[a].topPlayTrigger=this._getTopPlayTriggerByTargetId(a)},this)},_populatePageTargetsToPlay:function(a,b){var c,d,e,f;for(c=0,d=a.length;d>c;c++)e=a[c],f=this._isAnimateOnPageTransitionEnd(e),f===b.isPageTransitionEnd&&(this._siteTargetsPlayData[e].isPlayOnce?this._siteTargetsPlayData[e].isPlayed||this._pageTargetsToPlay.push(e):this._pageTargetsToPlay.push(e))},_startAnimationEvents:function(){this._animateOnTickEvent=!0,this._isTargetsToAnimate()&&this._addListeners()},_getIsPlayOnceByTargetId:function(a){var b;return b="master"===this.getPageIdByTargetId(a)?!0:_.some(this.getBehaviorsByTargetId(a),"playOnce")},_getTopPlayTriggerByTargetId:function(a){var b=100,c=this._getDomElementByTargetId(a),d=c.getBoundingClientRect(),e=this.resources.W.Utils.Layout.isComponentOrParentsFixedPositioned(c.$logic)?0:window.pageYOffset;return _.forEach(this._getAnimationsByTargetId(a),function(a){var c=this._defaultInViewportThreshold;a.options&&"undefined"!=typeof a.options.screenInThreshold&&(c=parseInt(a.options.screenInThreshold)),b=Math.min(b,c)},this),d.top+e+d.height*(b/100)},_isAnimateOnPageTransitionEnd:function(a){var b=this._getAnimationsByTargetId(a),c=this._defaultWaitForPageTransition;return _.forEach(b,function(a){return a.options&&"undefined"!=typeof a.options.waitForPageTransition&&(c=a.options.waitForPageTransition),c}),c},_onScrollEvent:function(){this._animateOnTickEvent=!0},_onResizeEvent:function(){this._onScrollEvent()},_onTickEvent:function(){this._animateOnTickEvent&&(this._animateOnTickEvent=!1,this._animateTargets(),this._isTargetsToAnimate()||this._removeListeners())},_animateTargets:function(){if(this._isTargetsToAnimate())for(var a=this._pageTargetsToPlay.length;a--;){var b=this._pageTargetsToPlay[a],c=this._isTargetInViewport(b);c&&!this._isTweening(b)&&(_.forEach(this.getBehaviorsByTargetId(b),function(a){var c=a.params||{},d=this._getDomElementByTargetId(b);this._animations.applyTween(a.name,d,a.duration,a.delay,_.extend(c,{autoClear:!0}))},this),this._siteTargetsPlayData[b].isPlayed=!0,this._pageTargetsToPlay.splice(a,1))}},_isPlayed:function(a){return this._siteTargetsPlayData[a]&&this._siteTargetsPlayData[a].isPlayed},_isPlayOnce:function(a){return this._siteTargetsPlayData[a]&&this._siteTargetsPlayData[a].isPlayOnce},_hideSingleElement:function(a,b){var c=this._isPlayed(a),d=this._isPlayOnce(a);if(!c||!d){var e=this._getDomElementByTargetId(a);this._animations.hideSingleElement(e,b)}},_unHideSingleElement:function(a){var b=this._getDomElementByTargetId(a);this._animations.unHideSingleElement(b)},_onViewerStateChanged:function(a){var b=this.resources.W.Config.env.$editorMode;this._resetSiteAnimationDataAndListeners(),"PREVIEW"===b&&a.viewerMode===Constants.ViewerTypesParams.TYPES.DESKTOP&&this._simulatePageChange()},_onEditModeChanged:function(a){this._resetSiteAnimationDataAndListeners(),"PREVIEW"===a&&this._simulatePageChange()},_onFeedbackQuickTourEnded:function(){this._resetSiteAnimationDataAndListeners(),this._simulatePageChange()},_resetSiteAnimationDataAndListeners:function(){this._removeListeners(),this._resetSiteTargetsPlayData(),this.clearAllAnimationTargets()},_simulatePageChange:function(){var a=this._getCurrentPageId();this.hideCurrentPageAnimationTargets(),_.defer(this._onPageTransitionStart,{pageId:a}),_.defer(this._onPageTransitionComplete,{pageId:a})},_getCurrentPageId:function(){return this.resources.W.Viewer.getCurrentPageId()},_getDomElementByTargetId:function(a){return this.resources.W.Viewer.getCompByID(a)},_isTargetInViewport:function(a){var b=this._siteTargetsPlayData[a].topPlayTrigger;return b>=window.pageYOffset&&b<=window.getSize().y+window.pageYOffset},_resetPageTargetsToPlay:function(){this._pageTargetsToPlay=[]},_resetSiteTargetsPlayData:function(){this._siteTargetsPlayData=[]},_isTargetsToAnimate:function(){return this._pageTargetsToPlay.length>0},_getAnimationsByTargetId:function(a){var b=this.getBehaviorsByTargetId(a),c=[];return _.forEach(b,function(a){var b=this._animations.getAnimationDefinition(a.name);b&&c.push(this._animations.getAnimationDefinition(a.name))},this),c},_isTweening:function(a){var b=this._getDomElementByTargetId(a);return this._animations.isTweening(b)},_hideElements:function(a){var b=this.getBehaviorsByPageId(a);_.forEach(b,function(a){this._hideSingleElement(a.targetId,a.name)},this)},_clearAnimations:function(a){var b=this.getBehaviorsByPageId(a);_.forEach(b,function(a){var b=this._getDomElementByTargetId(a.targetId);this._animations.clear(b)},this)},removeComponentBehaviors:function(a){var b=this.getBehaviorsBySourceId(a);_.forEach(b,function(a){this._unHideSingleElement(a.targetId)},this),this.parent(a)}})}),define.Class("wysiwyg.viewer.managers.actions.base.BaseAction",function(a){var b=a;b.resources(["W.Config","W.Commands","W.Viewer"]),b.methods({initialize:function(a){this._behaviors={},this._viewingDevice=null,this._isPublic=this.resources.W.Config.env.$isPublicViewerFrame,this._setViewingDeviceForBehaviors({viewerMode:a||this.resources.W.Config.env.$viewingDevice}),this.resources.W.Commands.registerCommandAndListener("WEditorCommands.SetViewerMode",this,this._setViewingDeviceForBehaviors),this.resources.W.Commands.registerCommandListenerByName("WPreviewCommands.ViewerStateChanged",this,this._setViewingDeviceForBehaviors)},addBehaviors:function(a){_.forEach(a,function(a){this._behaviors[this._viewingDevice].push(a)},this)},removeComponentBehaviors:function(a){var b=_.reject(this._behaviors[this._viewingDevice],{sourceId:a});this._behaviors[this._viewingDevice]=b},getBehaviorsBySourceId:function(a){return _.filter(this._behaviors[this._viewingDevice],{sourceId:a})},getBehaviorsByPageId:function(a){return _.filter(this._behaviors[this._viewingDevice],{pageId:a})},getBehaviorsByTargetId:function(a){return _.filter(this._behaviors[this._viewingDevice],{targetId:a})},getTargetIdsByPageId:function(a){var b=this.getBehaviorsByPageId(a),c=this.getBehaviorsByPageId("master");return b=b.concat(c),_.uniq(_.pluck(b,"targetId"))},getPageIdByTargetId:function(a){var b=this.getBehaviorsByTargetId(a);return b[0].pageId},hideCurrentPageAnimationTargets:function(){var a=this.resources.W.Viewer.getCurrentPageId();
this._hideElements(a),this._hideElements("master")},clearAllAnimationTargets:function(){var a=this.resources.W.Viewer.getCurrentPageId();this._clearAnimations(a),this._clearAnimations("master")},getCurrentPageTargetsIds:function(){var a=this.resources.W.Viewer.getCurrentPageId();return this.getTargetIdsByPageId(a)},_getDomElementByTargetId:function(a){return this.resources.W.Viewer.getCompByID(a)},_setViewingDeviceForBehaviors:function(a){this._viewingDevice=a.viewerMode||a.mode,this._behaviors[this._viewingDevice]=this._behaviors[this._viewingDevice]||[]}})}),define.Class("wysiwyg.viewer.managers.pages.LazyPageLoader",function(a){"use strict";var b=a;b.binds(["_loadPageLazy","_loadNextPage"]),b.statics({FirstLazyPageLoadDelay:1e4,NextLazyPageLoadDelay:3e3,MaxNumberOfPagesToLoad:5}),b.methods({initialize:function(a){this._dataResolver=a,this._numberOfPagesToLoad=0},start:function(){Q.delay(this.FirstLazyPageLoadDelay).then(this._loadPageLazy)},_loadPageLazy:function(){if(!this._dataResolver.isAllPagesDataLoaded()){var a=_.first(this._dataResolver.getPagesIdsToLoad());this._dataResolver.getPageData(a).then(this._loadNextPage).fail(this._loadNextPage),this._numberOfPagesToLoad++}},_loadNextPage:function(){this._numberOfPagesToLoad<this.MaxNumberOfPagesToLoad&&Q.delay(this.NextLazyPageLoadDelay).then(this._loadPageLazy)}})}),define.Class("wysiwyg.viewer.managers.pages.MasterPageHandler",function(a){var b=a;b.inherits("wysiwyg.viewer.managers.pages.PageHandler"),b.utilize(["wysiwyg.viewer.managers.pages.SiteStructureDomBuilder","wysiwyg.viewer.managers.pages.StubPageDomBuilder"]),b.resources(["W.Data","W.Config"]),b.binds(["_getPageData","_createPagesStubs","_attachPage","_addWixAdsNode","_fireSiteNodeCreated"]),b.methods({initialize:function(a,b){this.parent("master",null,a,b);var c=Constants.ViewerTypesParams.DOM_ID_PREFIX[b],d=new this.imports.ComponentDomBuilder(c);this._structureDomBuilder=new this.imports.SiteStructureDomBuilder(c,d),this._pageStubDomBuilder=new this.imports.StubPageDomBuilder(c),this._compDomBuilder=this._structureDomBuilder},loadMasterSignatureHtml:function(){return this._rootNode=$(this._structureDomBuilder.getStructureDomId()),this._getPageData().then(this._addComponentStuffToManagers).then(this._createPageStructure).then(this._writePageIdOnComponentNodes).then(this._fireSiteNodeCreated).then(this._createPagesStubs).then(this._attachPage).then(this._addWixAdsNode,this._onFailBeforeWixify)},wixifyMasterPage:function(a){return this._wixifyPage(a).then(this._getSuccessInfo).fail(this._onFailToRenderPage)},loadPage:function(){throw new Error("this method isn't implemented. user loadMasterSignatureHtml and wixifyMasterPage instead")},_getPageData:function(){return this._dataResolver.getMasterPageData()},_createPagesStubs:function(a){var b=a.rootCompNode,c=this._getPagesContainerNode(b),d=this._dataResolver.getPagesIds(),e=_.reduce(d,function(a,b){return a[b]=this._createStubPage(c,b),a},{},this);return{rootCompNode:b,pageNodes:e,compNodes:a.compNodes,pagesContainerNode:c}},_getPagesContainerNode:function(a){return a.querySelector("#"+this._structureDomBuilder.getPagesContainerDomId())},_createStubPage:function(a,b){var c=this.resources.W.Data.getDataByQuery("#"+b),d=this._pageStubDomBuilder.createPageStubNode(b,c,a.$domLevel+1);return a.appendChild(d),d},_addStructureIdToPageData:function(a){var b=_.clone(a);return b.structure=_.clone(a.structure),b.structure.id=this._structureDomBuilder.STRUCTURE_COMP_ID,b},_fireSiteNodeCreated:function(a){return this.trigger("siteNodeCreated",{siteNode:a.rootCompNode}),a},_addWixAdsNode:function(a){if(window.adData){var b=document.getElementById("wixFooter"),c=W.Viewer.getNodeAdData();!b&&c&&(b=document.createElement("div"),_.forOwn(c,function(a,c){b.setAttribute(c,a)}),document.body.appendChild(b)),b&&!b.$logic&&a.compNodes.push($(b))}return a},_attachPage:function(a){var b=a.rootCompNode,c=this._getSiteParentNode();return c.firstChild?c.insertBefore(b,c.firstChild):c.appendChild(b),this.resources.W.Config.isLoadedFromStatic()&&this._attachPageFarAwayIfNeeded(a.rootCompNode),a},_attachPageFarAwayIfNeeded:function(a){var b=Constants.ViewerTypesParams.DOM_ID_STATIC_PREFIX+a.getAttribute("id");document.getElementById(b)?a.addClass("farAwayNode"):LOG.reportError(wixErrors.STATIC_HTML_REPLACEMENT_FAILURE,this.className,"_attachPageFarAwayIfNeeded",b)},_getChildrenPropertyName:function(){return this._dataResolver.getMasterChildrenPropertyName(this._viewerName)},_getNodeWixifyFinishedEvent:function(){return Constants.ComponentEvents.READY},_getSiteParentNode:function(){return document.body},_getSiteNode:function(){return document.body}})}),define.Class("wysiwyg.viewer.managers.pages.PageDeadCompsHandler",function(a){var b=a;b.resources(["W.Config","W.Data","W.ComponentData","W.Events","W.Commands"]),b.methods({handleDeadComps:function(a){return this._sendBI(a),_.forEach(a,this._replaceFailedComp,this),!0},_sendBI:function(a){var b=_.map(a,this._getBIJson,this);_.forEach(b,function(a){var b=JSON.stringify(a.desc);LOG.reportError(wixErrors.PM_RENDER_FILED_COMPS,a.compType,a.pageId,b)})},_getBIJson:function(a){var b=this._getCompById(a.domCompId),c="";a.stack&&(c="string"==typeof a.stack?a.stack:a.stack.toString());var d={compType:b.get("comp"),pageId:a.pageId,desc:{compId:a.domCompId,message:a.message,stack:c.substr(0,50)}};return d},_replaceFailedComp:function(a){var b=this._getCompById(a.domCompId);this._checkForAnchors(b);var c=this._createSignatureNode(b);return b.parentNode.replaceChild(c,b),this._disposeCompOnWixify(b,c),this._wixifyNode(c,a.messageToUser),c},_createSignatureNode:function(a){var b=a.outerHTML,c=a.innerHTML,d=b.replace(c,""),e=new Element("div");return e.innerHTML=d,e.firstChild},_wixifyNode:function(a,b){var c=a.get("dataquery");c&&!this.resources.W.Data.isDataAvailable(c)&&(c=void 0);var d=a.get("propertyquery");d&&!this.resources.W.ComponentData.isDataAvailable(d)&&(d=void 0);var e=this._getDeadCompSkinName();a.__wixifyInner__("wysiwyg.common.components.DeadComponent",e,c,d,void 0,{messageToUserObj:b})},_getDeadCompSkinName:function(){var a="skins.viewer.deadcomp.DeadCompPreviewSkin";return this.resources.W.Config.env.$isPublicViewerFrame&&(a="skins.viewer.deadcomp.DeadCompPublicSkin"),a},_disposeCompOnWixify:function(a){try{a.$logic&&a.$logic.dispose(),a.dispose()}catch(b){this._removeEvents(a),W.Utils.debugTrace("couldn't dispose of a dead comp "+b.message||b)}},_removeEvents:function(a){var b=this.resources.W.Events;a.removeEvents&&a.removeEvents();var c=b.getObjectId(a,!0);b.deleteObjectFromMaps(c),a.$logic&&(this.resources.W.Commands.unregisterListener(a.$logic),a.$logic.removeEvents(),c=b.getObjectId(a.$logic,!0),b.deleteObjectFromMaps(c))},_checkForAnchors:function(a){var b="";a.$logic&&a.$logic.getAnchors().length&&_.forEach(a.$logic.getAnchors(),function(a){b+=" to "+a.toComp.getComponentUniqueId()}),a.$logic&&a.$logic.getReverseAnchors().length&&_.forEach(a.$logic.getAnchors(),function(a){b+=" from "+a.toComp.getComponentUniqueId()}),b.length&&LOG.reportError(wixErrors.PM_FOUND_FAILED_COMP_WITH_ANCHORS,"PageManager","_replaceFailedComp","comp "+a.get("id")+" anchors "+b)},_getCompById:function(a){return $(a)}})}),define.Class("wysiwyg.viewer.managers.pages.PageHandler",function(a){"use strict";var b=a;b.resources(["W.Data","W.ComponentData","W.Theme","dataFixer","W.Skins","W.Commands"]),b.utilize(["core.managers.components.ComponentDomBuilder"]),b.inherits("bootstrap.managers.events.EventDispatcherBase"),b.binds(["_getPageData","_createPageStructure","_attachPage","_addComponentStuffToManagers","_setCorrectWidthToPage","_wixifyPage","_onFailBeforeWixify","_onFailToRenderPage","_getSuccessInfo","_writePageIdOnComponentNodes"]),b.methods({initialize:function(a,b,c,d,e,f){this._comps={},this._pageId=a,this._dataResolver=c,this._isPageLoaded=!1,this._viewerName=d,this._rootNode=b,this._pageCorrectWidth=e,this._waitingForRender=f,this._failed={},this._compDomBuilder=new this.imports.ComponentDomBuilder(Constants.ViewerTypesParams.DOM_ID_PREFIX[d]),this.resources.W.Commands.registerCommand("W.ViewerCommands.PageHandlerAttachPage",!0)},loadPage:function(){return this.promise=this._getPageData().then(this._addComponentStuffToManagers).then(this._createPageStructure).then(this._writePageIdOnComponentNodes).then(this._setCorrectWidthToPage).then(this._attachPage).then(this._wixifyPage,this._onFailBeforeWixify).then(this._getSuccessInfo).fail(this._onFailToRenderPage),this.promise},_getSuccessInfo:function(a){var b={pageId:this._pageId,pageNode:a.rootCompNode,failed:_.values(this._failed),nodes:a};return this.exterminate(),b},_writePageIdOnComponentNodes:function(a){for(var b=a.compNodes,c=0;c<b.length;c++)b[c].$pageId=this._pageId;return a},_getPageData:function(){return this._dataResolver.getPageData(this._pageId)},_createPageStructure:function(a){this._logPageRender("startHtml");var b=a.structure,c=this._getChildrenPropertyName(),d=this._rootNode?this._rootNode.$domLevel:0,e=this._compDomBuilder.createComponent(b,c,d);return e},_addComponentStuffToManagers:function(a){var b=this._getChildrenPropertyName(),c=a.structure;return this._addComponentStuffToManagersRec(c,b),a},_addComponentStuffToManagersRec:function(a,b){this._addCompAnchorsToLayout(a),this._applyMethodOnChildren(a,b,this._addComponentStuffToManagersRec)},_addCompAnchorsToLayout:function(a){var b=a.layout&&a.layout.anchors,c=a.id;if(c&&b){var d=[];_.forEach(b,function(a){var b=_.clone(a);b.targetComponent=this._compDomBuilder._getDomId_(a.targetComponent),d.push(b)},this);var e={};e[this._compDomBuilder._getDomId_(c)]=d,W.Layout.appendSavedAnchor(e)}},_applyMethodOnChildren:function(a,b,c){b=b||"components";var d=a[b]||[],e=[];return _.forEach(d,function(a){var b=c.call(this,a);e.push(b)},this),e},_getChildrenPropertyName:function(){return this._dataResolver.getPageComponentsPropertyName(this._viewerName)},_setCorrectWidthToPage:function(a){var b=a.rootCompNode;return b.setAttribute("width",this._pageCorrectWidth),a},_attachPage:function(a){var b=a.rootCompNode;return this._rootNode.parentNode.replaceChild(b,this._rootNode),this._rootNode=b,this._collapsePage(b),a},_collapsePage:function(a){this.resources.W.Commands.executeCommand("W.ViewerCommands.PageHandlerAttachPage",this,{pageNode:a}),a.setStyle("opacity","0"),this._waitingForRender||a.collapse()},_wixifyPage:function(a){this._logPageRender("startWixify");var b=Q.defer(),c=a.compNodes;return this._comps=_.transform(c,function(a,b){a[b.get("id")]=!0},{}),this.on("allCompsWixifyDone",this,function(){this._logPageRender("ready"),b.resolve(a)}),this._wixifyNodes(c),b.promise},_wixifyNodes:function(a){return _.forEach(a,function(a){var b=a.get("id");a.on(this._getNodeWixifyFinishedEvent(),this,function(){this._onNodeWixifyDone(b)}),a.on(Constants.ComponentEvents.REQUESTING_TO_DIE,this,function(c){var d=c.data;this._addFailedComp(a,d.errorObj,d.messageToUserObj),this._onNodeWixifyDone(b)}),this._wixifyNode(a)},this)},_wixifyNode:function(a){try{a.wixify({isWaitingForRender:this._waitingForRender})}catch(b){this._addFailedComp(a,b),this._onNodeWixifyDone(a.get("id"))}},_onNodeWixifyDone:function(a){delete this._comps[a],_.isEmpty(this._comps)&&this.trigger("allCompsWixifyDone")},_addFailedComp:function(a,b,c){if(this._compDomBuilder._getNodeCompId_(a)===this._pageId||a.$isContainerOrPage)throw console.log("we don't support dead containers and pages"),b;var d=a.get("id");this._failed[d]||(this._failed[d]={pageId:this._pageId,domCompId:d,stack:b.stack||b,message:b.message||b,messageToUser:c})},_getNodeWixifyFinishedEvent:function(){return this._waitingForRender?Constants.ComponentEvents.READY:Constants.ComponentEvents.WIXIFIED},_onFailBeforeWixify:function(a){var b=a.stack?a.stack:a;throw this._logPageRender("startWixify",b),LOG.reportError(wixErrors.PM_PAGE_FAILED_BEFORE_WIXIFY,"PageHandler","loadPage",b),a},_onFailToRenderPage:function(a){var b=a.stack?a.stack:a;throw this._logPageRender("ready",b),LOG.reportError(wixErrors.PM_RENDER_PAGE_FAILED,"PageHandler","loadPage",b),this.exterminate(),a},_logPageRender:function(a,b){deployStatus("pageLoad",{pageId:this._pageId,type:a,time:LOG.getSessionTime(),errorDesc:b})}})}),define.Class("wysiwyg.viewer.managers.pages.SiteStructureDomBuilder",function(a){var b=a;b.inherits("core.managers.components.BaseDomBuilder"),b.statics({STRUCTURE_COMP_ID:"SITE_STRUCTURE",PAGES_CONTAINER_COMP_ID:"SITE_PAGES"}),b.methods({initialize:function(a,b){this.parent(a),this._compDomBuilder=b},createComponent:function(a,b){b=b||"children";var c=this._createViewNodeBase(this.STRUCTURE_COMP_ID,"wysiwyg.viewer.components.WSiteStructure","mobile.core.skins.InlineSkin",0);c.setAttribute("class","SITE_STRUCTURE");var d=this._compDomBuilder._createChildComponents(c,a,b);return d.push(c),{rootCompNode:c,compNodes:d}},getStructureDomId:function(){return this._getDomId_(this.STRUCTURE_COMP_ID)},getPagesContainerDomId:function(){return this._getDomId_(this.PAGES_CONTAINER_COMP_ID)}})}),define.Class("wysiwyg.viewer.managers.pages.StubPageDomBuilder",function(a){var b=a;b.inherits("core.managers.components.BaseDomBuilder"),b.methods({initialize:function(a){this.parent(a)},createPageStubNode:function(a,b,c){var d=b&&"AppPage"===b.getData().type?"wixapps.integration.components.AppPage":"mobile.core.components.Page",e=this._createViewNodeBase(a,d,"mobile.core.skins.InlineSkin",c);return e.setAttribute("dataQuery","#"+a),e}})}),define.Class("wysiwyg.viewer.managers.pages.data.DataResolverFactory",function(a){"use strict";var b=a;b.utilize(["wysiwyg.viewer.managers.pages.data.LocalDataResolver","wysiwyg.viewer.managers.pages.data.RemoteDataResolver","wysiwyg.viewer.managers.pages.data.StructureDataResolver"]),b.methods({initialize:function(){},getDataResolver:function(){var a;return window.publicModel&&window.publicModel.pageList?a=new this.imports.RemoteDataResolver(window.publicModel):window.siteAsJson?a=new this.imports.LocalDataResolver(window.siteAsJson):window.wixData&&(a=new this.imports.StructureDataResolver),a}})}),define.Class("wysiwyg.viewer.managers.pages.data.LocalDataResolver",function(a){"use strict";var b=a;b.resources(["W.Data","W.ComponentData","W.Theme","dataFixer","W.Commands"]),b.methods({initialize:function(a){this._siteData=a,this._pagesData=[],this._pageIds=[],this._pagesIdsToLoad=[],this._preparePageData()},_preparePageData:function(){this._pageIds=_.map(this._siteData.pages,function(a){return a.structure.id}),this._siteData.masterPage=this._fixPageData(this._siteData.masterPage,_.clone(this._pageIds)),this._setData(this._siteData.masterPage.data)},_fixPageData:function(a,b){return this.resources.dataFixer.FixPageJson(a,b)},_setData:function(a){if(a.links_data){var b=this;return this.resources.W.Data.addDataItemsForPage(a.links_data),_.forEach(a.links_data,function(a){b.resources.W.Data.markDirtyCompIdForLater(a.id)}),this.resources.W.Data.addDataItemsForPage(a.document_data),this.resources.W.ComponentData.addDataItemsForPage(a.component_properties),this.resources.W.Theme.addDataItemsForPage(a.theme_data),this._pageData}},setViewerStructure:function(a,b){this._siteData.masterPage.structure[this.getMasterChildrenPropertyName(a)]=b.masterPage.children,_.forEach(b.pages,function(b){var c=b.id;this._pagesData[c].structure[this.getPageComponentsPropertyName(a)]=b.components,this._pagesData[c].structure.styleId=b.styleId},this)},addPage:function(a){this._pageIds.push(a.id),this._pagesData[a.id]={structure:a}},removePage:function(a){var b=a.getComponentId();this._pagesData[b]=null,delete this._pagesData[b],this._pageIds.splice(_.indexOf(this._pageIds,b),1)},getPagesIds:function(){return this._pageIds},isPageLoaded:function(a){return void 0!==this._pagesData[a]},isAllPagesDataLoaded:function(){return 0===this._pagesIdsToLoad.length},getPagesIdsToLoad:function(){return this._pagesIdsToLoad},getMasterPageData:function(){return Q(this._siteData.masterPage)},getMainPageId:function(){var a=this.resources.W.Data.getDataByQuery("#SITE_STRUCTURE"),b=a&&a.get("mainPage");return b&&b.replace("#","")},getPageData:function(a){return Q(this._pagesData[a]||this._loadPageData(a))},_loadPageData:function(a){var b=_.find(this._siteData.pages,function(b){return b.structure.id===a});return b?(b=this._fixPageData(b),this._pagesData[a]=b,this._setData(b.data),b):null},getSerializedPageStructureSync:function(a,b){var c=this._loadPageData(b);if(!c)return null;var d=c.structure;return this._getPageStructureForSingleView(d,a,this.getPageComponentsPropertyName.bind(this))},getDataById:function(a){return this._pagesData[a]},getPageComponentsPropertyName:function(a){var b=Constants.ViewerTypesParams.SERVER_JSON_PREFIX[a];return b&&b.length>0?b+"Components":"components"},getMasterChildrenPropertyName:function(a){var b=Constants.ViewerTypesParams.SERVER_JSON_PREFIX[a];return b&&b.length>0?b+"Components":"children"},isStructureExists:function(a){var b=this.getMasterChildrenPropertyName(a);return this.getMasterPageData().then(function(a){return a.structure[b]&&!_.isEmpty(a.structure[b])})},_getSerializedStructureForSingleView_:function(a){var b=this._getPagesStructuresForSingleView(a),c=this._getMasterStructureForSingleView(a),d=b&&c&&!_.isEmpty(c.children),e=null;return d&&(e={pages:b,masterPage:c}),e},_getMasterStructureForSingleView:function(a){var b=this._siteData.masterPage.structure;return b[this.getMasterChildrenPropertyName(a)]?this._getPageStructureForSingleView(b,a,this.getMasterChildrenPropertyName.bind(this)):null},_getPagesStructuresForSingleView:function(a){var b={},c=!1;return _.forEach(this._pageIds,function(d){var e=this._pagesData[d]&&this._pagesData[d].structure||null;e&&e[this.getPageComponentsPropertyName(a)]?(c=!0,b[d]=this._getPageStructureForSingleView(e,a,this.getPageComponentsPropertyName.bind(this))):b[d]=null},this),c?b:null},_getPageStructureForSingleView:function(a,b,c){var d=_.cloneDeep(a);return d[c("DESKTOP")]=d[c(b)],_.forOwn(Constants.ViewerTypesParams.SERVER_JSON_PREFIX,function(a,b){a&&delete d[c(b)]},this),d}})}),define.Class("wysiwyg.viewer.managers.pages.data.RemoteDataResolver",function(a){var b=a;b.inherits("wysiwyg.viewer.managers.pages.data.LocalDataResolver"),b.methods({initialize:function(a){this.parent(a),this._deferredRequests=[],this._pagesIdsToLoad=_.clone(this._pageIds),this._failedPagesIdsToLoad=[]},_preparePageData:function(){_.forEach(this._siteData.pageList.pages,function(a){this._pageIds.push(a.pageId);var b=a.urls.map(function(a){return resource.url(a,this._getRequestMethod(a),this._shouldLoadOnce(a))},this);define.resource(this._getResourceIdFromPageID(a.pageId)).withUrls(b).withTrials(3).withTimeBetween(3e3)},this);var a=this._siteData.pageList.masterPage.map(function(a){return resource.url(a,this._getRequestMethod(a),this._shouldLoadOnce(a))},this);define.resource(this._getResourceIdFromPageID("master")).withUrls(a).withTrials(3).withTimeBetween(3e3)},_getResourceIdFromPageID:function(a){return"pages."+a},_isStaticPage:function(a){return!~a.indexOf("archive.")},_getRequestMethod:function(a){return this._isStaticPage(a)?"cors":"jsonp"},_shouldLoadOnce:function(a){return!!this._isStaticPage(a)},getMasterPageData:function(){return this.getPageData("master")},getMainPageId:function(){return this._siteData.pageList.mainPageId},getPageData:function(a){var b;if(this._pagesData&&this._pagesData[a])b=Q(this._pagesData[a]);else if(this._deferredRequests[a])b=this._deferredRequests[a].promise;else{var c=Q.defer();this._logPageRender_(a,"startData"),resource.getResourceValue(this._getResourceIdFromPageID(a),this._onGetResourceSuccess.bind(this,a,c),this._onGetResourcesFailure.bind(this,a,c)),this._deferredRequests[a]=c,b=c.promise}return b},_onGetResourceSuccess:function(a,b,c){this._logPageRender_(a,"endData"),this._handleGetPageResource(a),this._pagesData[a]=c,this._fixPageData(c),this._setData(c.data),b.resolve(c)},_onGetResourcesFailure:function(a,b){this._logPageRender_(a,"endData","all load attempts failed"),LOG.reportError(wixErrors.ALL_PAGE_RETRIEVAL_ATTEMPTS_FAILED,"PageManager","loadPageById"),this._handleGetPageResource(a),this._failedPagesIdsToLoad.push(a),b.reject(new Error("Failed to get json page "+a))},_handleGetPageResource:function(a){this._deferredRequests[a]=null,delete this._deferredRequests[a],this._pagesIdsToLoad=_.without(this._pagesIdsToLoad,a)},_logPageRender_:function(a,b,c){deployStatus("pageLoad",{pageId:a,type:b,time:LOG.getSessionTime(),errorDesc:c})}})}),define.Class("wysiwyg.viewer.managers.pages.data.StructureDataResolver",function(a){"use strict";var b=a;b.inherits("wysiwyg.viewer.managers.pages.data.LocalDataResolver"),b.methods({_preparePageData:function(){var a=document.getElementById("SITE_STRUCTURE");if(a){var b=this._createSiteDataComponents(a),c=_.find(b.components,{id:"PAGES_CONTAINER"}),d=_.find(c.components,{id:"SITE_PAGES"}),e=d.components;d.components=[],this._siteData={masterPage:{structure:{children:b.components},data:window.wixData},pages:[]},this._fixPageData(this._siteData.masterPage),_.forEach(e,function(a){var b=a.id;this._pageIds.push(b);var c={structure:a};this._fixPageData(c),this._pagesData[b]=c,this._siteData.pages.push(c)}.bind(this)),this._setData(window.wixData),a.parentNode.removeChild(a),window.wixData=null,window.anchors=null}},_createSiteDataComponents:function(a){var b={id:a.getAttribute("id"),skin:a.getAttribute("skin"),componentType:a.getAttribute("comp"),styleId:a.getAttribute("styleId"),dataQuery:a.getAttribute("dataQuery"),layout:{width:a.getAttribute("width"),height:a.getAttribute("height"),x:a.getAttribute("x"),y:a.getAttribute("y"),anchors:window.anchors[a.getAttribute("id")]},propertyQuery:a.getAttribute("propertyQuery"),components:[]};return _.forEach(a.children,function(a){b.components.push(this._createSiteDataComponents(a))}.bind(this)),b}})}),define.Class("wysiwyg.viewer.managers.viewer.HashChangeHandler",function(a){var b=a;b.binds(["_onHashChange"]),b.resources(["W.Utils","W.Config","W.Commands","W.Data"]),b.methods({initialize:function(a,b,c){this._viewer=a,this._zoomHandler=b,this._siteMembersHandler=c,this.resources.W.Utils.hash.addEvent("change",this._onHashChange)},_onHashChange:function(a){if(a=a||{},this._viewer.isSiteReady()){var b=a.newHash,c=a.extData,d=a.isIdChanged,e=a.isExtraDataChanged,f=a.silent,g=this._zoomHandler.isZoomOpened(),h="zoom"===b;h||W.Data.isDataAvailable("#"+b)||(b=this._viewer.getHomePageId()),d&&!f&&b&&("zoom"===b&&(b=c.split("/")[1]),W.Data.getDataByQuery("#"+b,function(a){this._onHashDataItemIdChange(b,a)}.bind(this)),a.isForSureAfterChange&&LOG.reportPageEvent(window.location.href));var i=this._viewer.getCurrentPageId();e&&(g?this._zoomHandler.showItemInOpenedZoom():i&&(this._viewer._activeViewer_._onPageExtraDataChange_(c,i,f),this._viewer.fireEvent("hashExtraDataChanged",{extData:c,pageId:i,silent:f})))}},_onHashDataItemIdChange:function(a,b){var c=b.getType&&b.getType();return this.isPageDataType(c)&&a?(this._changePageFromHash(b),void 0):("Image"===c?this.resources.W.Commands.executeCommand("WViewerCommands.OpenZoom",{item:"#"+b.get("id"),getDisplayerDivFunction:this._zoomHandler.getDefaultGetZoomDisplayerFunction("Image")},this):"PermaLink"===c&&"ListsApps"===b.get("appType")&&W.Apps.openPermaLink(b),void 0)},isPageDataType:function(a){return"Page"===a||"AppPage"==a},_changePageFromHash:function(a){if(null!==a&&this._isPageVisible(a)){var b=a.get("id");b!==this._viewer.getCurrentPageId()&&this._siteMembersHandler.checkRequireLogin(a,function(){b&&(this.resources.W.Config.env.$isEditorViewerFrame&&LOG.reportEvent(wixEvents.USER_MOVED_BETWEEN_PAGES,{c1:a._data&&a._data.pageUriSEO||"no-page-url"}),this._viewer._setCurrentPageId_(b),this._viewer._activeViewer_.changePageWithTransition(b),W.Commands.executeCommand("WViewerCommands.SelectedPageChanged",b))}.bind(this),!0)}},_isPageVisible:function(a){return!a.getMeta("isHidden")||this.resources.W.Config.env.$isEditorViewerFrame},_setUrlHashToPage:function(a,b,c){c=!!c;var d=this._viewer.getPageData(a);d&&this.resources.W.Utils.hash.setHash(a,d.get("pageUriSEO"),b,c)}})}),define.Class("wysiwyg.common.managers.viewer.MobileViewHandler",function(a){var b=a;b.utilize(["wysiwyg.viewer.utils.MobileQuickActionsHandler"]),b.binds(["_handleMobileRotation"]),b.resources(["W.Config"]),b.methods({setMobileSite:function(a){this._viewerName=a,this.handleQuickActions(),this._viewerName===Constants.ViewerTypesParams.TYPES.MOBILE?W.Config.isLoadedFromStatic()?(this._handleMobileRotation(),this.addRotationEventListener()):(this._hideQuickActions(),this._handleMobileRotation(),this._fixQuickActionsZoom(),this.addRotationEventListener()):this._resetViewPortTagAttributes()},addRotationEventListener:function(){window.addEventListener("orientationchange",this._handleMobileRotation,!1),window.WQuickActions&&window.addEventListener("orientationchange",this._showQuickActions,!1)},removeRotationEventListener:function(){window.removeEventListener("orientationchange",this._handleMobileRotation),window.WQuickActions&&window.removeEventListener("orientationchange",this._showQuickActions)},_handleMobileRotation:function(){return W.Config.env.$isPublicViewerFrame?(window.MobileUtils&&MobileUtils.fixViewportScale(Constants.ViewerTypesParams.DOC_WIDTH.MOBILE),void 0):(LOG.reportError(wixErrors.NO_MOBILE_IN_EDITOR,this.className,"_handleMobileRotation"),void 0)},setViewportTag:function(a,b){return W.Config.env.$isPublicViewerFrame?(window.MobileUtils&&MobileUtils.setViewportTag(a,b),void 0):(LOG.reportError(wixErrors.NO_MOBILE_IN_EDITOR,this.className,"setViewportTag"),void 0)},_fixQuickActionsZoom:function(){window.WQuickActions&&W.Viewer.addEvent("SiteReady",function(){_.delay(this._showQuickActions,100)}.bind(this))},_hideQuickActions:function(){window.WQuickActions&&window.WQuickActions.hideBar()},_showQuickActions:function(){setTimeout(function(){window.WQuickActions&&(window.WQuickActions.showBar(),window.WQuickActions.fixZoom())},100)},_resetViewPortTagAttributes:function(){this.setViewportAttribute("minimum-scale","0.25"),this.setViewportAttribute("maximum-scale","1.2")},handleQuickActions:function(){var a=new this.imports.MobileQuickActionsHandler;a.handleMobileQuickActions()},setViewportAttribute:function(a,b){var c=document.getElementById("wixMobileViewport");if(c){for(var d=c.getAttribute("content"),e=d.split(/ *,/),f="",g=!1,h=0;h<e.length;h++){var i=e[h];if(i.indexOf(a)>-1){if(g=!0,!b)continue;i=i.replace(/\ *=.*/,"="+b)}f+=i+","}f=f.substring(0,f.length-1),g||!b?c.setAttribute("content",f):c.setAttribute("content",f+","+a+"="+b)}}})}),define.Class("wysiwyg.viewer.managers.viewer.PageManagementTemp",function(a){var b=a;b.resources(["W.Utils","W.Data"]),b.methods({goToHomePage:function(){this.changePageWithTransition(this.getHomePageId())},isHomePage:function(a){return this._isSiteReady?a===this.getHomePageId():!0},getHomePageId:function(){return this._mainPageData?this._mainPageData.get("id"):void 0},getPageNode:function(a){var b=null;return a&&this._siteNode&&(b=this.injects().Viewer.getCompByID(a)),b},indexPages:function(){var a=this._viewer.getPageGroupElement();if(!a)return this.resources.W.Utils.callLater(this.indexPages,[],this,10);var b={},c=[];this._getPageElements(a).each(function(a){var d=a.get("id")||this.resources.W.Utils.getUniqueId();this._prefix&&(d=d.replace(this._prefix,"")),b[d]=a,a.addClass("sitePage");var e=a.get("dataQuery");c.push(e)}.bind(this)),c=this._fixPagesOrderByNewMenuData(c);var d=this._siteStructureData.getData().pages;d=d||[];var e;for(e=0;e<d.length;++e){var f=d[e],g=c.indexOf(f);-1!=g&&(c.splice(g,1),c.splice(e,0,f))}var h=W.Data.isDataChange();this._siteStructureData.set("pages",c),(void 0===this._siteStructureData.get("mainPage")||""===this._siteStructureData.get("mainPage"))&&this._siteStructureData.set("mainPage",c[0]),h&&W.Data.flagDataChange(),this._pages=b},_getPageElements:function(a){var b="[comp=mobile.core.components.Page],[comp=core.components.Page],[comp=wixapps.integration.components.AppPage]";return a.getElements(b)},_fixPagesOrderByNewMenuData:function(a){if(W.Data.isDataAvailable("#MAIN_MENU")){var b=W.Data.getDataByQuery("#MAIN_MENU"),c=b.getAllItems();c=b.getAllItems(),a=c.map(function(a){return a.get("refId")})}return a},getPageData:function(a){return this._pagesData[a]},getPagesData:function(){return this._pagesData},getLinkablePagesData:function(){return this._pagesData},updatePagesData:function(){this._pagesData={};var a=this.getPages();for(var b in a){var c=a[b].getAttribute("dataQuery"),d=this.resources.W.Data.getDataByQuery(c);this._pagesData[d.get("id")]=d,this._viewer._notifyPageDataLoaded(d),this._siteStructureData.get("mainPage")==="#"+d.get("id")&&(this._mainPageData=d)}},changePageWithTransition:function(a){this._pageGroupComp&&this._pageGroupComp.getLogic().gotoPage(a)},getNewUniquePageId:function(a){var b,c=this.getPages();do b=W.Utils.getUniqueId(a+"Page");while(void 0!==c[b]);return b}})}),define.Class("wysiwyg.viewer.managers.viewer.SiteDataHandler",function(a){var b=a;b.resources(["W.Data"]),b.statics({PROPERTIES_OF_TYPE:{"wixapps.integration.components.AppPage":["id","appPageId"],"wixapps.integration.components.AppPart2":["id","appInnerID","appPartName"]}}),b.fields({_serializedStructureFromServer:null,_pageManager:null}),b.methods({initialize:function(a,b){this._pageManager=a,this.updateServerData(b)},updateServerData:function(a){var b=a.getSerializedStructureFromServer();this._serializedStructureFromServer=_.clone(b.pages),this._serializedStructureFromServer.masterPage=b.masterPage},getComponentOfTypeInPage:function(a,b){if(this._pageManager.isPageLoaded(b)){var c=this._pageManager.getPageNodes()[b],d=c.getLogic().getPageComponents();return _.filter(d,{className:a}).map(function(b){return this._convertToExternalData(a,this.resources.W.Data.getDataByQuery(b.$view.get("dataQuery")))},this)}return this._getServerComponentsOfTypeOnPage(a,b)},_getAllLoadedComponentsOfType:function(a){return _(W.Viewer.getSiteNode().getElements("[comp="+a+"]")).map(function(b){var c=b.get("dataQuery");if(c){var d=this.resources.W.Data.getDataByQuery(c);return d&&this._convertToExternalData(a,d.getData())}return null}.bind(this)).compact().value()},getComponentsOfType:function(a){var b=_.difference(_.keys(this._serializedStructureFromServer),this._pageManager.getLoadedPageIds().concat("masterPage")),c=_.reduce(b,function(b,c){if("masterPage"!==c){var d=this._serializedStructureFromServer[c]&&this._serializedStructureFromServer[c].componentType;d=d||this._pageManager.getPageNodes()[c].$logic.$className,d===a&&b.push(this._convertToExternalData(a,this._serializedStructureFromServer[c]))}return b.concat(this._getServerComponentsOfTypeOnPage(a,c))},[],this);return c.concat(this._getAllLoadedComponentsOfType(a))},_getServerComponentsOfTypeOnPage:function(a,b){return this._getChildrenComponentsOfType(a,this._serializedStructureFromServer[b])},_getChildrenComponentsOfType:function(a,b){var c=b.components||b.children;return _.reduce(c,function(b,c){return c.componentType===a&&b.push(this._convertToExternalData(a,c)),b.concat(this._getChildrenComponentsOfType(a,c))},[],this)},_convertToExternalData:function(a,b){var c=this.PROPERTIES_OF_TYPE[a];return c?_.pick(b,c):b}})}),define.Class("wysiwyg.viewer.managers.viewer.SiteMembersHandler",function(a){var b=a;b.inherits("bootstrap.utils.Events"),b.binds([]),b.resources(["W.Utils","W.Commands","W.Config"]),b.methods({initialize:function(a,b){this._passwordLogin=null,this._validatedPages=null,this._siteNode=b,this._viewer=a,this._registerCommands()},_registerCommands:function(){var a=this.resources.W.Commands;a.registerCommandAndListener("WViewerCommands.AdminLogin.Open",this,this._openAdminLogin),a.registerCommandAndListener("WViewerCommands.AdminLogin.Close",this,this._closeAdminLogin),a.registerCommandAndListener("WViewerCommands.SiteMembers.Open",this,this._openSiteMembersPopup),a.registerCommandAndListener("WViewerCommands.SiteMembers.Close",this,this._closeSiteMembersPopup),a.registerCommandAndListener("WViewerCommands.PasswordLogin.Open",this,this._openPasswordLogin),a.registerCommandAndListener("WViewerCommands.PasswordLogin.Close",this,this._closePasswordLogin)
},setPageAsNotValidated:function(a){this._validatedPages||(this._validatedPages={}),this._validatedPages[a]=!1},_closeAdminLogin:function(){this._closePasswordLogin()},_closePasswordLogin:function(){if(this._passwordLogin){var a=this._passwordLogin.getViewNode(),b=new Fx.Tween(a,{duration:"short",link:"ignore"}),c=function(){b.removeEvent("complete",c),a.removeFromDOM(),delete this._passwordLogin}.bind(this);b.addEvent("complete",c),b.start("opacity","0.0"),this._openPasswordLoginRequested=!1}},_openAdminLogin:function(a){a||(a={}),a.clazz="wysiwyg.viewer.components.AdminLogin",a.dataItem=W.Data.createDataItem({type:"Text"}),this._openPasswordLogin(a)},_openPasswordLogin:function(a){if(!this._passwordLogin&&!this._openPasswordLoginRequested){var b=a&&a.args,c=a&&a.clazz||"wysiwyg.viewer.components.PasswordLogin",d=a&&a.dataItem||null;this._openPasswordLoginRequested=!0,W.Components.createComponent(c,"wysiwyg.viewer.skins.PasswordLoginSkin",d,b,function(){},function(a){this._passwordLogin=a;var b=a.getViewNode();b.setStyle("opacity","0"),a.getViewNode().insertInto(this._siteNode),a.centerDialog();new Fx.Tween(b,{duration:"short",link:"ignore"}).start("opacity","1.0")}.bind(this))}},_openSiteMembersPopup:function(a){this.injects().SiteMembers.openSiteMembersPopup(a)},_closeSiteMembersPopup:function(){this.injects().SiteMembers.closeSiteMembersPopup()},checkRequireLogin:function(a,b,c){var d=this.resources.W.Config.env.isInInteractiveViewer(),e=a.get("pageSecurity"),f=a.get("id"),g=this._getFallbackPage(f),h=!g;if(d&&e.requireLogin&&!this.injects().SiteMembers.isLoggedIn()&&!this._isProtectedPageValidated(f)){var i="",j=a.get("pageUriSEO"),k=this.resources.W.Utils.hash.getHashPartsString(f,j,i);this.injects().SiteMembers.openSiteMembersPopup({disableCancel:h,hashRedirectTo:"#"+k,cameFromHashChange:c,openedByPageSecurity:!0,dialogsLanguage:e.dialogLanguage?e.dialogLanguage:"en",authCallback:function(a){this._onAuthCallback(a,f,g,b)}.bind(this)})}else d&&e.passwordDigest&&!this._isProtectedPageValidated(f)?this.resources.W.Commands.executeCommand("WViewerCommands.PasswordLogin.Open",{args:{digestedPassword:e.passwordDigest,disableCancel:h,dialogsLanguage:e.dialogLanguage?e.dialogLanguage:"en",authCallback:function(a){this._onAuthCallback(a,f,g,b)}.bind(this)}}):b()},_getFallbackPage:function(a){var b=this._viewer.getCurrentPageId(),c=!!b,d=W.Data.getDataMap().SITE_STRUCTURE.get("mainPage");return d=d?d.replace("#",""):"",c?b:a!=d?d:null},_isProtectedPageValidated:function(a){return this._validatedPages&&this._validatedPages[a]},_onAuthCallback:function(a,b,c,d){a.authResponse?(this._setPageValidated(b),d()):a.data&&a.data.cancel&&(c?location.hash=c:location.reload())},_setPageValidated:function(a){this._validatedPages||(this._validatedPages={}),this._validatedPages[a]=!0}})}),define.Class("wysiwyg.viewer.managers.viewer.SiteView",function(a){var b=a;b.inherits("bootstrap.utils.Events"),b.utilize(["wysiwyg.viewer.managers.PageManager"]),b.traits(["wysiwyg.viewer.managers.viewer.PageManagementTemp"]),b.binds(["_fireScreenResizeEvent","_onSiteReady","_notifySiteReadyForThumbnail","AfterSiteRendered","_setSiteNode","_afterSiteReplacedStaticHtml"]),b.resources(["W.Utils","W.Commands","W.Config","W.Data","fnvHash","BrowserUtils"]),b.statics({SCREEN_RESIZE_EVENT:"ScreenResize"}),b.methods({initialize:function(a,b,c){this._viewer=a,this._viewerName=c,this._dataResolver=b,this._prefix=Constants.ViewerTypesParams.DOM_ID_PREFIX[this._viewerName]||"",this._pageManager=new this.imports.PageManager(this._viewerName,b),this._pageManager.addEvent("siteNodeCreated",this._setSiteNode),this._initState(),this.initScreenResizeEventPropagation()},initScreenResizeEventPropagation:function(){$(window).addEvent("resize",this._fireScreenResizeEvent)},_initState:function(){this._isSiteReady=!1,this._pagesData=null,this._mainPageData=null,this._siteStructureData=null,this._isFullScreen=null,this._isStaticHtmlCleared=!1},isSiteReady:function(){return this._isSiteReady},getPageManager:function(){return this._pageManager},initiateSite:function(){this._pageManager.addEvent(this._pageManager.EVENTS.SITE_LOADED,this.AfterSiteRendered);var a=this.resources.BrowserUtils.getQueryParams().keepstatic;this._keepStatic=a&&a[0]&&"true"===a[0],this._keepStatic||(this._logViewerRender("site starting to load"),this._pageManager.loadSite(!this.resources.W.Config.env.$isPublicViewerFrame))},AfterSiteRendered:function(a){this._setSiteNode(a),this.getAndInitSiteStructureData(),a||LOG.reportError(wixErrors.VM_INVALID_SITE_NODE,this.className,"setSite",""),this._siteStructureData||LOG.reportError(wixErrors.VM_INVALID_SITE_DATA,this.className,"setSite",""),this.indexPages(),this.updatePagesData(),this._siteStructureData.addComponentWithInterest(this._siteNode.getLogic());var b=this._viewer.getPageGroupElement();if(b&&b.getProperty("comp")){this._pageGroupComp=b;var c=this;this._pageGroupComp.addEvent("pageTransitionEnded",function(a){c.fireEvent("pageTransitionEnded",a)})}this._onSiteReady()},_setSiteNode:function(a){this._siteNode=$(a)},dispose:function(){$(window).removeEvent("resize",this._fireScreenResizeEvent),this._pageGroupComp.$logic.removeAllEvents(),this._siteNode.$logic.removeAllEvents(),this.removeAllEvents(),this._siteNode.$logic.dispose()},_onSiteReady:function(){if(this._logViewerRender("site ready"),this._isSiteReady=!0,this.resources.W.Config.mobileConfig.isMobile()&&this._scrollToHideMobileAddressBar(),W.Layout.attachSavedAnchors(),this.fireEvent("SiteReady",{viewerName:this._viewerName}),this._reportBIEvents(),this.resources.W.Config.env.$isEditorlessPreview){var a=this.resources.W.Commands.registerCommand("EditorCommands.SiteLoaded");a.execute()}this._fireScreenResizeEvent(),this.getSiteNode()&&this.getSiteNode().getLogic&&this.siteHeightChanged(),this.resources.W.Utils.callLater(this._notifySiteReadyForThumbnail),this.resources.W.Config.isLoadedFromStatic()?(this._viewer._staticLoadingHandler_.addEvent(this._viewer._staticLoadingHandler_.EVENTS.SITE_REPLACED_STATIC_HTML,this._afterSiteReplacedStaticHtml),this._viewer._staticLoadingHandler_.replaceStaticHtmlWithActualSite()):window.loadedFromStatic&&!this._isStaticHtmlCleared&&LOG.reportError(wixErrors.STATIC_HTML_REPLACEMENT_FAILURE,this.className,"_onSiteReady","site is ready but static html is stuck")},_afterSiteReplacedStaticHtml:function(){this._isStaticHtmlCleared=!0,this.fireEvent(this._viewer._staticLoadingHandler_.EVENTS.SITE_REPLACED_STATIC_HTML,{viewerName:this._viewerName})},_logViewerRender:function(a){deployStatus("viewerRender",{step:a,time:LOG.getSessionTime()})},_scrollToHideMobileAddressBar:function(){this.resources.W.Config.isLoadedFromStatic()||window.scrollTo(0,1)},isStaticHtmlCleared:function(){return this._isStaticHtmlCleared},getSiteHeight:function(){return this._siteHeight},siteHeightChanged:function(a){this.getSiteNode().getLogic().flushPhysicalHeightCache(),this._siteHeight=this._getHeightFromCallback(),this.fireEvent("resize",this._siteHeight),a||this.getSiteNode().getLogic().setHeight(this._siteHeight),this._postHeightMessage()},_getHeightFromCallback:function(){return this._viewer.getActiveViewerHeightFromCallback()},_postHeightMessage:function(){var a=parent.postMessage?parent:parent.document.postMessage?parent.document:void 0;a&&"undefined"!=typeof a&&a.postMessage(this._siteHeight,"*")},_updateDocWidth:function(a){if(a)return this._docWidth=a,void 0;var b=this.getAndInitSiteStructureData(),c=b.get("renderModifiers"),d=this.injects().Utils.getQueryParam("siteWidth");if(d)return this._docWidth=parseInt(d,10),c.siteWidth=this._docWidth,b.markDataAsDirty(),void 0;if(c&&c.siteWidth)return this._docWidth=c.siteWidth,void 0;switch(window.rendererModel.applicationType){case"HtmlFacebook":this._docWidth="520";break;case"HtmlWeb":this._docWidth="980";break;default:this._docWidth=980}},getDocWidth:function(){return this._docWidth||this._updateDocWidth(),this._docWidth},getAndInitSiteStructureData:function(){return this._siteStructureData||(this._siteStructureData=W.Data.getDataByQuery("#SITE_STRUCTURE")),this._siteStructureData},_notifySiteReadyForThumbnail:function(){"true"===this.resources.W.Utils.getQueryParam("siteReadyAlert");var a=this.resources.W.Utils.getQueryParam("siteReadyPost");if(a){var b=new Request.JSON({url:a});b.post({siteReady:!0})}},getSiteNode:function(){return this._siteNode},getPages:function(){return this._pageManager.getPageNodes()},getCompByID:function(a){var b=a;this._prefix&&0!==a.indexOf(this._prefix)&&(b=this._prefix+a);var c=document.querySelectorAll("[id="+b+"]");if(!c)return LOG.reportError(wixErrors.NO_COMPONENT_WITH_GIVEN_ID,this.className,"getCompByID","id"+a),void 0;c.length>1&&LOG.reportError(wixErrors.CORRUPTED_ELEMENT_WITH_COMPONENT_ID,this.className,"getCompByID","id"+a);for(var d=0;d<c.length;d++){var e=c[d];if(e.getAttribute("comp"))return e}return c[0]},getAllCompsWithID:function(a){var b=a;return this._prefix&&0!==a.indexOf(this._prefix)&&(b=this._prefix+a),document.querySelectorAll("[id="+b+"]")},getMasterComponents:function(){var a=this.getSiteNode().$logic;return this._getMasterComponents(a,[])},_getMasterComponents:function(a,b){var c=a.getChildComponents();return _.forEach(c,function(a){var c=a.getLogic();c&&!this._viewer.isPageComponent(c.className)&&(b.push(c),c.isContainer()&&this._getMasterComponents(c,b))}.bind(this)),b},getPageComponents:function(a){a=a||this.getCurrentPageId();var b=this.getCompByID(a).$logic;return b.getPageComponents()},_onPageExtraDataChange_:function(a,b,c){if(!c){var d=W.Data.getDataByQuery("#"+b),e=d.get("type");"Page"===e&&this._handleTPAExtraDataChange(d)}},_handleTPAExtraDataChange:function(a){this.resources.W.Commands.executeCommand("TPAViewerCommands.HashExtraDataChange",a)},getCompByIDAddPrefix:function(a){return $(this._prefix+a)},_fireScreenResizeEvent:function(){this.fireEvent(this.SCREEN_RESIZE_EVENT)},_reportBIEvents:function(){switch(window.viewMode){case"preview":LOG.reportEvent(wixEvents.PREVIEW_READY);break;case"site":var a=!window.wixData,b=this.resources.W.Utils.getFullStateString(),c=this.resources.fnvHash.hash(b),d={c1:a,c2:c};LOG.reportEvent(wixEvents.SITE_READY,d)}},getPrefix:function(){return this._prefix}})}),define.Class("wysiwyg.viewer.managers.viewer.ViewerCaptureHandler",function(a){var b=a;b.utilize(["wysiwyg.viewer.managers.viewer.ViewerDomDisplayReadyEventsCollector"]),b.binds(["_processSiteForCapture","_prepareHtml","_fireReadyEvent","_onMobileReady","_addPageDataToCapturedHtml","_onLayoutReady","_waitForLayoutReady","_addTpaGalleriesData","_addStaticPrefixToComponents","_prepareComponentForCapture","_onNeverDomDisplayReady"]),b.resources(["topology"]),b.statics({CONTENT_STR:"content: "}),b.methods({initialize:function(a){this._viewer=a,this._tpaGalleriesData={},this._capturedHtml={shouldCapture:!1},this._domDisplayReadyEventsCollector=new this.imports.ViewerDomDisplayReadyEventsCollector(wixErrors.HTML_CAPTURE_FAILURE,this._prepareComponentForCapture)},captureMobile:function(){var a=this;this._viewer._getDataResolver_().isStructureExists(Constants.ViewerTypesParams.TYPES.MOBILE).then(function(b){if(a._addPageDataToCapturedHtml(),!b||!W.Config.isMobileOptimizedViewOn())return window.capturedHtml=a._capturedHtml,window.fireEvent("noMobileCapture"),void 0;a._capturedHtml.shouldCapture=!0,W.Config._setIsCapturing_(!0);var c=Constants.ViewerTypesParams.TYPES.MOBILE;a._viewer.switchViewer(c,!1,Constants.ViewerTypesParams.DOC_WIDTH[c]),a._viewer._activeViewer_.addEvent("SiteReady",a._onMobileReady),W.Layout.addEvent("layoutDone",a._onLayoutReady),W.Layout.notifyWhenNoMoreChanges();var d=a._getObsoleteNodeIdsToRemove();a._removeObsoleteComponents(d),a._viewer._activeViewer_.initiateSite()})},_getObsoleteNodeIdsToRemove:function(){return["wixFooter"]},_removeObsoleteComponents:function(a){if(a&&a.length>0)for(var b=null,c=0;c<a.length;c++)a[c]&&(b=this._getNodeInDom(a[c]),b&&b.$logic&&b.$logic.dispose())},_getNodeInDom:function(a){return $(a)},_onLayoutReady:function(){this._layoutReady=!0},_onMobileReady:function(){this._viewer.getSiteView(Constants.ViewerTypesParams.TYPES.DESKTOP).dispose(),this._turnOffMovement(),this._processSiteForCapture()},_processSiteForCapture:function(){this._domDisplayReadyEventsCollector._waitForDomDisplayReady(2e4).then(this._waitForLayoutReady,this._onNeverDomDisplayReady).then(this._garbageCollectCss).then(this._addStaticPrefixToComponents).then(this._prepareHtml).then(this._addTpaGalleriesData).then(this._fireReadyEvent)},_turnOffMovement:function(){function a(a){_.forEach(a,function(a){a.get("autoplay")?a.set("autoplay",!1):a.get("autoPlay")?a.set("autoPlay",!1):a.get("loop")&&a.set("loop",!1)})}W.ComponentData.getDataItemsByType("SlideShowGalleryProperties",a),W.ComponentData.getDataItemsByType("PaginatedGridGalleryProperties",a),W.ComponentData.getDataItemsByType("VideoProperties",a),W.ComponentData.getDataItemsByType("SingleAudioPlayerProperties",a),W.ComponentData.getDataItemsByType("AudioPlayerProperties",a),W.Data.getDataItemsByType("AudioPlayer",a),W.Data.getDataItemsByType("SoundCloudWidget",a)},_garbageCollectCss:function(){W.Skins._cssGarbageCollector.runGarbageCollector()},_prepareComponentForCapture:function(a){var b=a.$logic,c=b.getTPAData&&b.getTPAData();if(c){var d=a.getAttribute("id");this._tpaGalleriesData[d]=c}b.isPartiallyFunctionalInStaticHtml()||b.isInvisibleInStaticHtml()&&a.addClass("component_capture_full_preloader")},_waitForLayoutReady:function(){var a=Q.defer();if(this._layoutReady)a.resolve();else{var b=this;W.Layout.addEvent("layoutDone",function(){b._onLayoutReady(),a.resolve()})}return a.promise},_addStaticPrefixToComponents:function(){var a=document.querySelectorAll("[comp]");_.map(a,function(a){a.setAttribute("id",Constants.ViewerTypesParams.DOM_ID_STATIC_PREFIX+a.getAttribute("id"))})},_prepareHtml:function(){var a=this._getSiteStyles(),b=this._getAdditionalScripts(),c=this._getNodeHtml(document.body),d=this._getNodeHtml(document.head);d+=a,d=b+d,this._capturedHtml.bodyHtml=c,this._capturedHtml.headHtml=d},_getSiteStyles:function(){var a=_.map(W.Skins._skinRenderer._stylesheet.cssRules,function(a){return this._fixStyleContentText(a.cssText)}.bind(this)),b=_.map(W.Css._generateThemeStylesSheet().cssRules,function(a){return this._fixStyleContentText(a.cssText)}.bind(this));return"<style id='"+Constants.ViewerTypesParams.DOM_ID_STATIC_PREFIX+"skinStyles'>"+a.join("\n")+"</style><style id='"+Constants.ViewerTypesParams.DOM_ID_STATIC_PREFIX+"themeStyles'>"+b.join("\n")+"</style>"},_fixStyleContentText:function(a){var b=a,c=a.indexOf(this.CONTENT_STR);if(-1!==c){var d=a.substr(c+this.CONTENT_STR.length,1);if("'"!==d&&'"'!==d){var e=a.substr(0,c),f=a.substr(c+this.CONTENT_STR.length,a.length-1),g=f.indexOf(";");-1!==g&&(b=e+this.CONTENT_STR+"'"+f.substr(0,g)+"'"+f.substr(g,f.length-1))}}return b},_getAdditionalScripts:function(){var a=this.resources.topology.bootstrap;return a+="/javascript/bootstrap/bootstrap/capture/additionalScripts.js","<script type='text/javascript' src='"+a+"'></script>\n"},_getNodeHtml:function(a){var b=a.children,c="",d=this;return _.forEach(b,function(a){if(d._shouldCaptureNode(a)){var b=a.getAttribute("id");b&&0!==b.indexOf(Constants.ViewerTypesParams.DOM_ID_STATIC_PREFIX)&&a.setAttribute("id",Constants.ViewerTypesParams.DOM_ID_STATIC_PREFIX+b),c+=a.outerHTML+"\n"}}),c},_shouldCaptureNode:function(a){return a.serverGenerated&&a.hasAttribute("comp")?!0:!a.serverGenerated},_addPageDataToCapturedHtml:function(){var a=this._viewer.getCurrentPageId(),b=_.find(publicModel.pageList.pages,function(b){return b.pageId===a});if(!b)throw"there is no such page in page list";var c=_.last(b.urls[0].split("/")).split("?")[0].split(".")[0],d=_.last(publicModel.pageList.masterPage[0].split("/")).split("?")[0];c+="-"+d,this._capturedHtml.urlName=c,this._capturedHtml.pageId=a},_addTpaGalleriesData:function(){this._tpaGalleriesData&&!_.isEmpty(this._tpaGalleriesData)&&(this._capturedHtml.tpaGalleriesData={},_.forOwn(this._tpaGalleriesData,function(a,b){var c=Constants.ViewerTypesParams.DOM_ID_STATIC_PREFIX+b;this._capturedHtml.tpaGalleriesData[c]=a}.bind(this)))},_fireReadyEvent:function(){window.capturedHtml=this._capturedHtml,window.fireEvent("siteReadyForCapture",this._capturedHtml)},_onNeverDomDisplayReady:function(){throw this._domDisplayReadyEventsCollector._onNeverDomDisplayReady(),this._domDisplayReadyEventsCollector.getUnfulfilledPromises()}})}),define.Class("wysiwyg.viewer.managers.viewer.ViewerDomDisplayReadyEventsCollector",function(a){var b=a;b.binds(["_onNeverDomDisplayReady"]),b.methods({initialize:function(a,b){this.errorCode=a,this._handleNodeDomDisplayReadyEvent=b},_waitForDomDisplayReady:function(a){var b=_.filter(document.querySelectorAll("[comp]"),function(a){return a.$logic}),c=this._getNodesDomDisplayReadyPromises(b);this._nodesDomDisplayReadyPromises=c;var d=Q.defer();return Q.allSettled(_.map(c,function(a){return a.promise})).then(function(){d.resolve()}),d.promise.timeout(a)},_getNodesDomDisplayReadyPromises:function(a){var b=this;return _.map(a,function(a){var c=Q.defer();a.$logic.isReadyForDomDisplay()?(b._handleNodeDomDisplayReadyEvent(a),c.resolve()):a.addEvent(Constants.ComponentEvents.DOM_DISPLAY_READY,function(){b._handleNodeDomDisplayReadyEvent(this),c.resolve()});var d={promise:c.promise,nodeId:a.getAttribute("id"),comp:a.getAttribute("comp")};return d})},_onNeverDomDisplayReady:function(){var a=_.map(_.filter(this._nodesDomDisplayReadyPromises,function(a){return!a.promise.isFulfilled()||a.promise.isPending()}),function(a){return{nodeId:a.nodeId,comp:a.comp}});this._unfulfilledPromises=a,LOG.reportError(this.errorCode,this.className,"_onNeverDomDisplayReady",JSON.stringify(a))},getUnfulfilledPromises:function(){return this._unfulfilledPromises}})}),define.Class("wysiwyg.viewer.managers.viewer.ViewerProxy",function(a){var b=a;b.methods({initialize:function(){this.SCREEN_RESIZE_EVENT="ScreenResize"},_eventHandlers:{},propagateEvents:function(){this.addEventPropagation("pageTransitionEnded"),this.addEventPropagation("SiteReady"),this.addEventPropagation("resize"),this.addEventPropagation(this._activeViewer_.SCREEN_RESIZE_EVENT),this.addEventPropagation("siteReplacedStaticHtml")},removeEventPropagation:function(){this.removeEvent("resize",this._eventHandlers.resize),this.removeEvent("SiteReady",this._eventHandlers.SiteReady),this.removeEvent("pageTransitionEnded",this._eventHandlers.pageTransitionEnded),this.removeEvent(this._activeViewer_.SCREEN_RESIZE_EVENT,this._eventHandlers[this._activeViewer_.SCREEN_RESIZE_EVENT]),this.removeEvent("siteReplacedStaticHtml",this._eventHandlers.siteReplacedStaticHtml)},addEventPropagation:function(a){var b=this;this._eventHandlers[a]=function(c){b.fireEvent(a,c)},this._activeViewer_.addEvent(a,this._eventHandlers[a])},indexPages:function(){return this._activeViewer_.indexPages()},getPageData:function(a){return this._activeViewer_.getPageData(a)},getPagesData:function(){return this._activeViewer_.getPagesData()},getPages:function(){return this._activeViewer_.getPages()},getLinkablePagesData:function(){return this._activeViewer_.getLinkablePagesData()},updatePagesData:function(){return this._activeViewer_.updatePagesData()},getNewUniquePageId:function(a){return this._activeViewer_.getNewUniquePageId(a)},goToHomePage:function(){return this._activeViewer_.goToHomePage()},isHomePage:function(a){return a=a||this.getCurrentPageId(),this._activeViewer_.isHomePage(a)},getCurrentPageNode:function(){return this.getPageGroup().getCurrentPageNode()||this.getCompByID(this.getCurrentPageId())},getMasterComponents:function(a){return a in this._loadedViewers?this._loadedViewers[a].getMasterComponents():this._activeViewer_.getMasterComponents()},getPageComponents:function(a,b){return b in this._loadedViewers?this._loadedViewers[b].getPageComponents(a):this._activeViewer_.getPageComponents(a)},loadPageById:function(a,b,c,d){return this._activeViewer_.getPageManager().loadPageById(a,b,c,d)},isStaticHtmlCleared:function(){return this._activeViewer_&&this._activeViewer_.isStaticHtmlCleared()},isSiteReady:function(){return this._activeViewer_&&this._activeViewer_.isSiteReady()},getSiteHeight:function(){return this._activeViewer_.getSiteHeight()},siteHeightChanged:function(a){return this._activeViewer_.siteHeightChanged(a)},getDocWidth:function(){return this._activeViewer_?this._activeViewer_.getDocWidth():0},getSiteNode:function(){return this._activeViewer_.getSiteNode()},initScreenResizeEventPropagation:function(){return this._activeViewer_.initScreenResizeEventPropagation()},getCompByID:function(a,b){return b in this._loadedViewers?this._loadedViewers[b].getCompByID(a):this._activeViewer_.getCompByID(a)},getAllCompsWithID:function(a,b){return b in this._loadedViewers?this._loadedViewers[b].getAllCompsWithID(a):this._activeViewer_.getAllCompsWithID(a)},getElementBySelector:function(a){var b=this.getSiteNode();return b.getElement(a)||null},getCompLogicBySelector:function(a){var b=this.getElementBySelector(a);return b&&b.$logic?b.$logic:null},getCompLogicById:function(a,b){var c=this.getCompByID(a,b);return c&&c.$logic?c.$logic:null},getPageGroup:function(){return this.getPageGroupElement().getLogic()},getPageGroupElement:function(){return this._activeViewer_.getCompByIDAddPrefix("SITE_PAGES")},getPagesContainer:function(){return this._activeViewer_.getCompByIDAddPrefix("PAGES_CONTAINER")},getFooterContainer:function(){return this._activeViewer_.getCompByIDAddPrefix("SITE_FOOTER")},getHeaderContainer:function(){return this._activeViewer_.getCompByIDAddPrefix("SITE_HEADER")},getCurrentPrefix:function(){return this._activeViewer_.getPrefix()}})}),define.Class("wysiwyg.viewer.managers.viewer.ViewerStaticLoadingHandler",function(a){var b=a;b.inherits("bootstrap.utils.Events"),b.utilize(["wysiwyg.viewer.managers.viewer.ViewerDomDisplayReadyEventsCollector"]),b.statics({EVENTS:{SITE_REPLACED_STATIC_HTML:"siteReplacedStaticHtml"}}),b.binds(["_cleanupStaticElements","_onAllDomDisplayReady","_onNeverDomDisplayReady"]),b.methods({initialize:function(a){this._viewer=a,this._domDisplayReadyEventsCollector=new this.imports.ViewerDomDisplayReadyEventsCollector(wixErrors.STATIC_HTML_REPLACEMENT_DELAY,function(){})},replaceStaticHtmlWithActualSite:function(){this._domDisplayReadyEventsCollector._waitForDomDisplayReady(5e3).then(this._onAllDomDisplayReady,this._onNeverDomDisplayReady)},_onAllDomDisplayReady:function(){this._cleanupStaticElements()},_cleanupStaticElements:function(){this._removeFarAwayPage();var a=document.head.getChildren("[id^="+Constants.ViewerTypesParams.DOM_ID_STATIC_PREFIX+"]"),b=document.body.getChildren("[id^="+Constants.ViewerTypesParams.DOM_ID_STATIC_PREFIX+"]"),c=a.concat(b);_.forEach(c,function(a){a.getAttribute("id")!==Constants.ViewerTypesParams.DOM_ID_STATIC_PREFIX+"mobile_bgNode"?a.parentNode.removeChild(a):a.setStyle("display","none")}),this.fireEvent(this.EVENTS.SITE_REPLACED_STATIC_HTML)},_removeFarAwayPage:function(){var a=Constants.ViewerTypesParams.DOM_ID_STATIC_PREFIX+this._viewer.getSiteNode().getAttribute("id"),b=document.getElementById(a);b&&(b.parentNode.replaceChild(this._viewer.getSiteNode(),b),this._viewer.getSiteNode().removeClass("farAwayNode"))},_onNeverDomDisplayReady:function(){this._domDisplayReadyEventsCollector._onNeverDomDisplayReady(),this._cleanupStaticElements()}})}),define.Class("wysiwyg.viewer.managers.viewer.ViewerZoomHandler",function(a){var b=a;b.resources(["W.Commands","W.Config"]),b.methods({initialize:function(a,b){this._zoomComp=null,this._viewer=a,this._siteNode=b;var c=this.resources.W.Commands;c.registerCommandAndListener("WViewerCommands.OpenZoom",this,this._setZoomData)},getDefaultGetZoomDisplayerFunction:function(a){return"Image"===a?function(a,b,c){var d=this._getCurrentZoomType(!0),e=this._getZoomDisplayerCompSettings(d);this.injects().Components.createComponent(e.comp,e.skin,a,{maxWidth:b.x,maxHeight:b.y},null,function(a){c(a.getViewNode())})}.bind(this):void 0},getDefaultGetHashPartsFunction:function(a){return"Image"===a?function(a,b){W.Data.getDataItem(a,function(a){b({id:"zoom",title:a.get("title"),extData:this._viewer.getCurrentPageId()+"/"+a.get("id")})}.bind(this))}.bind(this):void 0},_getZoomDisplayerCompSettings:function(a){var b,c;return"MOBILE"===a?(b="wysiwyg.viewer.skins.displayers.MobileMediaZoomDisplayerSkin",c="wysiwyg.viewer.components.MobileMediaZoomDisplayer"):(b="wysiwyg.viewer.skins.displayers.MediaZoomDisplayerSkin",c="wysiwyg.viewer.components.MediaZoomDisplayer"),{comp:c,skin:b}},_getCurrentZoomComp:function(a){return"MOBILE"===a?this._mobileZoomNode:this._desktopZoomNode},_setCurrentZoomComp:function(a,b){"MOBILE"===b?this._mobileZoomNode=a:this._desktopZoomNode=a},_setZoomData:function(a){this._initZoomIfNeeded(a,function(b){this._zoomComp=b.getViewNode(),this._setZoomDataInner(a)}.bind(this))},removeZoomElement:function(){this._zoomComp&&(this._zoomComp.removeFromDOM(),delete this._zoomComp)},_setZoomDataInner:function(a){a.itemsList?this._zoomComp.getLogic().setGallery(a.itemsList,a.currentIndex,a.getDisplayerDivFunction,a.getHashPartsFunction,a.extraParams):a.item&&this._zoomComp.getLogic().setImage(a.item,a.getDisplayerDivFunction,a.getHashPartsFunction,a.extraParams)},_initZoomIfNeeded:function(a,b){var c=(a.item||a.itemsList&&"ImageList"===a.itemsList.getType())&&!a.extraParams,d=this._getCurrentZoomType(c),e=this._getCurrentZoomComp(d);if(e)return this._zoomComp=e,b(this._zoomComp.getLogic()),void 0;var f=this._getZoomCompSettings(d);this._zoomComp=W.Components.createComponent(f.comp,f.skin,null,null,null,function(a){a.getViewNode().insertInto(this._siteNode),this._setCurrentZoomComp(a.getViewNode(),d),b(a)}.bind(this))},_getZoomCompSettings:function(a){var b,c;return"MOBILE"===a?(b="wysiwyg.viewer.skins.MobileMediaZoomSkin",c="wysiwyg.viewer.components.MobileMediaZoom"):(b="wysiwyg.viewer.skins.MediaZoomSkin",c="wysiwyg.viewer.components.MediaZoom"),{comp:c,skin:b}},isZoomOpened:function(){return this._zoomComp&&this._zoomComp.getLogic&&this._zoomComp.getLogic().isZoomOpened()},showItemInOpenedZoom:function(){this._zoomComp.getLogic().showZoomImage()},hideNextPrevButtons:function(){this._zoomComp&&this._zoomComp.$logic&&this._zoomComp.$logic.hideNextPrevButtons()},_getCurrentZoomType:function(a){return this._isMobileOptimizedView()?"MOBILE":this._isMobileOrTabletDevice()?a?"MOBILE":"DESKTOP":"DESKTOP"},_isMobileOrTabletDevice:function(){return W.Config.mobileConfig.isMobileOrTablet()},_isMobileDevice:function(){return W.Config.mobileConfig.isMobile()},_isMobileOptimizedView:function(){return this.resources.W.Config.env.getCurrentFrameDevice()===Constants.ViewerTypesParams.TYPES.MOBILE}})}),define.Class("wysiwyg.viewer.utils.ComponentSequencer",function(a){a.inherits("bootstrap.utils.Events"),a.resources(["W.Data"]),a.fields({_pendingElements:[],_createdElements:[],_reusedElements:[],_notifiedOnReady:[],_preExistingElements:[]}),a.methods({initialize:function(){},resolveItem:function(){},createComponents:function(a,b){this._resolveRefList(b,function(b){this._createCompsFromDataList(a,b)}.bind(this))},reset:function(){this._pendingElements.forEach(function(a){a.removeEvent(Constants.ComponentEvents.READY)}),this._pendingElements=[],this._createdElements=[],this._reusedElements=[],this._preExistingElements=[],this._notifiedOnReady=[]},_resolveRefList:function(a,b){var c="array"===typeOf(a)?a:a.get("items"),d=[],e=c.length;if(c.length)for(var f=0;f<c.length;f++)this._resolveCompData(c[f],f,function(a,c){d[c]=a,e--,0===e&&b(d)});else b([])},_resolveCompData:function(a,b,c){"string"===typeOf(a)?this.resources.W.Data.getDataByQuery(a,function(a){c(a,b)}):c(a,b)},_createCompsFromDataList:function(a,b){this._preExistingElements=a.getChildren().slice(0),this._allSetup=!1,this._pendingElements=[],this._createdElements=[],this._reusedElements=[],this._notifiedOnReady=[];for(var c=0;c<b.length;c++)this._setupComponent(a,c,b);this._preExistingElements.forEach(function(a){this._reusedElements.contains(a)||this._removeElement(a)}.bind(this)),this._createdElements.forEach(function(b){a.appendChild(b)}),this._allSetup=!0,this._checkIfAllDone()},_setupComponent:function(a,b,c){var d,e=c[b],f=this._findReusableComponent(this._preExistingElements,e);f?(d="reuse",this._reusedElements.push(f)):(d="create",f=this.createComponent(a,e,b,c)),this._createdElements.push(f),this._notifyOnComponentReadyIfNeeded(d,f,b)},createComponent:function(a,b,c,d){var e,f=this.resolveItem(b,c,d),g=typeOf(f),h=this._getCompStyle(a);return"element"===g?(e=f,e.getLogic||e.hasAttribute("comp")||this._supplyMinimalLogic(e,b),a.adopt(e)):(e=new Element("div"),e.setAttribute("comp",f.comp),e.setAttribute("skin",f.skin),f.styleId&&e.setAttribute("styleId",f.styleId),"data"in f&&(b=f.data),this._pendingElements.push(e),this._listenToInnerComponentReady(e,c),a.adopt(e),e.wixify(f.args||{},b,void 0,void 0,h)),e},_notifyOnComponentReadyIfNeeded:function(a,b,c){this._notifiedOnReady.contains(b)||this._pendingElements.contains(b)||(this._notifiedOnReady.push(b),this.fireEvent(Constants.ComponentEvents.COMPONENT_SEQUENCER_COMP_SETUP,{method:a,compView:b,index:c}))},_supplyMinimalLogic:function(a,b){var c={getDataItem:function(){return b},getIsDisplayed:function(){return!0},dispose:function(){b=null}};a.getLogic=function(){return c}},_onAllComponentsReady:function(){var a=this._createdElements.slice(0);this._createdElements=[],this._reusedElements=[],this._preExistingElements=[],this.fireEvent(Constants.ComponentEvents.COMPONENT_SEQUENCER_PRODUCTION_FINISHED,{elements:a})},_removeElement:function(a){a.getLogic&&a.getLogic().dispose(),a.destroy()},_findReusableComponent:function(a,b){for(var c,d=0;d<a.length;d++)if(c=a[d],c.getLogic&&this._dataItemsIdentical(b,c.getLogic().getDataItem()))return c},_dataItemsIdentical:function(a,b){if(a===b)return!0;if(a.get&&b.get&&a.hasField("id")&&b.hasField("id")){var c=a.get("id"),d=b.get("id");return c&&d&&c===d}return!1},_getCompStyle:function(a){var b;if(!this._style){for(b=a;b&&!b.getLogic;)b=b.getParent();if(b&&b.getLogic&&b.getLogic()&&b.getLogic().getStyle)return b.getLogic().getStyle()}},_listenToInnerComponentReady:function(a,b){a.addEvent(Constants.ComponentEvents.READY,function(){this._pendingElements.erase(a),this._notifyOnComponentReadyIfNeeded("create",a,b),this._checkIfAllDone()}.bind(this))},isPending:function(){return this._pendingElements.length>0},_checkIfAllDone:function(){this._allSetup!==!0||this.isPending()||this._onAllComponentsReady()}})}),define.Class("wysiwyg.viewer.utils.GalleryUtils",function(a){a.methods({createActionQueue:function(a,b){var c=[];return function(d){for(d&&c.push(d);c.length>0&&a()===!0;){c.length>b&&c.splice(0,c.length-b);var e=c.shift();e&&e.call()}}},createMinimalGalleryDisplayer:function(a,b){var c=Number.random(0,99999).toString(36),d={getViewNode:function(){return a},getRef:function(){return c},getDataItem:function(){return b},setOwner:function(){},invalidateSize:function(){},setSize:function(b,c){var d={width:b,height:c};a.setStyles(d)},dispose:function(){a.destroy(),a=null}};a.getLogic=function(){return d}}})}),define.Class("wysiwyg.viewer.utils.MatrixTransitions",function(a){var b=a;b.utilize(["wysiwyg.viewer.utils.TransitionUtils"]),b.binds(["_matrixCrossFade","_crossFade","_shrinkFade","_vertSwipe","_horizSwipe","_transitionSequence","_transitionSequenceGenerator","_generalTransition","_destroyHolder","_rotateDiagonalTiming","_noTransition","_timingDiagonalWave"]),b.fields({_transitionUtils:null,_sequenceIndex:0,_positioningFunc:null,_itemsContainer:null}),b.methods({initialize:function(){this._transitionUtils=new this.imports.TransitionUtils},setupTransitionMap:function(a,b){this._positioningFunc=a,this._itemsContainer=b;var c={crossFadeAllAtOnce:this._generalTransition(this._matrixCrossFadePrepare,this._matrixCrossFade(this._timingAllAtOnce)),crossFadeSequential:this._generalTransition(this._matrixCrossFadePrepare,this._matrixCrossFade(this._timingSequential)),crossFadeHorizWave:this._generalTransition(this._matrixCrossFadePrepare,this._matrixCrossFade(this._timingHorizontalWave)),crossFadeVertWave:this._generalTransition(this._matrixCrossFadePrepare,this._matrixCrossFade(this._timingVerticalWave)),crossFadeDiagonal:this._generalTransition(this._matrixCrossFadePrepare,this._matrixCrossFade(this._timingDiagonalWave)),shrinkFadeAllAtOnce:this._generalTransition(this._matrixCrossFadePrepare,this._shrinkFade(this._timingAllAtOnce)),shrinkFadeSequential:this._generalTransition(this._matrixCrossFadePrepare,this._shrinkFade(this._timingSequential)),shrinkFadeHorizWave:this._generalTransition(this._matrixCrossFadePrepare,this._shrinkFade(this._timingHorizontalWave)),shrinkFadeVertWave:this._generalTransition(this._matrixCrossFadePrepare,this._shrinkFade(this._timingVerticalWave)),shrinkFadeDiagonal:this._generalTransition(this._matrixCrossFadePrepare,this._shrinkFade(this._timingDiagonalWave)),vertSwipeAllAtOnce:this._generalTransition(this._vertSwipePrepare,this._vertSwipe(this._timingSwipeAllAtOnce,this._swipeSingleDirection)),vertSwipeWave:this._generalTransition(this._vertSwipePrepare,this._vertSwipe(this._timingSwipeWave,this._swipeSingleDirection)),vertSwipeAlternate:this._generalTransition(this._vertSwipePrepare,this._vertSwipe(this._timingSwipeAllAtOnce,this._swipeAlternate)),horizSwipeAllAtOnce:this._generalTransition(this._horizSwipePrepare,this._horizSwipe(this._timingSwipeAllAtOnce,this._swipeSingleDirection)),horizSwipeWave:this._generalTransition(this._horizSwipePrepare,this._horizSwipe(this._timingSwipeWave,this._swipeSingleDirection)),horizSwipeAlternate:this._generalTransition(this._horizSwipePrepare,this._horizSwipe(this._timingSwipeAllAtOnce,this._swipeAlternate)),seq_crossFade_All:this._transitionSequence([this._generalTransition(this._matrixCrossFadePrepare,this._matrixCrossFade(this._timingAllAtOnce)),this._generalTransition(this._matrixCrossFadePrepare,this._matrixCrossFade(this._timingSequential)),this._generalTransition(this._matrixCrossFadePrepare,this._matrixCrossFade(this._timingHorizontalWave)),this._generalTransition(this._matrixCrossFadePrepare,this._matrixCrossFade(this._reverseTiming(this._timingHorizontalWave))),this._generalTransition(this._matrixCrossFadePrepare,this._matrixCrossFade(this._timingVerticalWave)),this._generalTransition(this._matrixCrossFadePrepare,this._matrixCrossFade(this._reverseTiming(this._timingVerticalWave))),this._generalTransition(this._matrixCrossFadePrepare,this._matrixCrossFade(this._rotateDiagonalTiming(this._timingDiagonalWave,0))),this._generalTransition(this._matrixCrossFadePrepare,this._matrixCrossFade(this._rotateDiagonalTiming(this._timingDiagonalWave,1))),this._generalTransition(this._matrixCrossFadePrepare,this._matrixCrossFade(this._rotateDiagonalTiming(this._timingDiagonalWave,2))),this._generalTransition(this._matrixCrossFadePrepare,this._matrixCrossFade(this._rotateDiagonalTiming(this._timingDiagonalWave,3)))]),seq_shrink_All:this._transitionSequence([this._generalTransition(this._matrixCrossFadePrepare,this._shrinkFade(this._timingAllAtOnce)),this._generalTransition(this._matrixCrossFadePrepare,this._shrinkFade(this._timingSequential)),this._generalTransition(this._matrixCrossFadePrepare,this._shrinkFade(this._timingHorizontalWave)),this._generalTransition(this._matrixCrossFadePrepare,this._shrinkFade(this._reverseTiming(this._timingHorizontalWave))),this._generalTransition(this._matrixCrossFadePrepare,this._shrinkFade(this._timingVerticalWave)),this._generalTransition(this._matrixCrossFadePrepare,this._shrinkFade(this._reverseTiming(this._timingVerticalWave))),this._generalTransition(this._matrixCrossFadePrepare,this._shrinkFade(this._rotateDiagonalTiming(this._timingDiagonalWave,0))),this._generalTransition(this._matrixCrossFadePrepare,this._shrinkFade(this._rotateDiagonalTiming(this._timingDiagonalWave,1))),this._generalTransition(this._matrixCrossFadePrepare,this._shrinkFade(this._rotateDiagonalTiming(this._timingDiagonalWave,2))),this._generalTransition(this._matrixCrossFadePrepare,this._shrinkFade(this._rotateDiagonalTiming(this._timingDiagonalWave,3)))]),swipe_horiz_All:this._transitionSequence([this._generalTransition(this._horizSwipePrepare,this._horizSwipe(this._timingSwipeAllAtOnce,this._swipeSingleDirection)),this._generalTransition(this._horizSwipePrepare,this._horizSwipe(this._timingSwipeWave,this._swipeSingleDirection)),this._generalTransition(this._horizSwipePrepare,this._horizSwipe(this._reverseTiming(this._timingSwipeWave),this._swipeSingleDirection)),this._generalTransition(this._horizSwipePrepare,this._horizSwipe(this._timingSwipeAllAtOnce,this._swipeAlternate))]),swipe_vert_All:this._transitionSequence([this._generalTransition(this._vertSwipePrepare,this._vertSwipe(this._timingSwipeAllAtOnce,this._swipeSingleDirection)),this._generalTransition(this._vertSwipePrepare,this._vertSwipe(this._timingSwipeWave,this._swipeSingleDirection)),this._generalTransition(this._vertSwipePrepare,this._vertSwipe(this._reverseTiming(this._timingSwipeWave),this._swipeSingleDirection)),this._generalTransition(this._vertSwipePrepare,this._vertSwipe(this._timingSwipeAllAtOnce,this._swipeAlternate))]),seq_crossFade_Horiz:this._transitionSequence([this._generalTransition(this._matrixCrossFadePrepare,this._matrixCrossFade(this._timingHorizontalWave)),this._generalTransition(this._matrixCrossFadePrepare,this._matrixCrossFade(this._reverseTiming(this._timingHorizontalWave)))]),seq_crossFade_Vert:this._transitionSequence([this._generalTransition(this._matrixCrossFadePrepare,this._matrixCrossFade(this._timingVerticalWave)),this._generalTransition(this._matrixCrossFadePrepare,this._matrixCrossFade(this._reverseTiming(this._timingVerticalWave)))]),seq_crossFade_Seq:this._transitionSequence([this._generalTransition(this._matrixCrossFadePrepare,this._matrixCrossFade(this._timingSequential)),this._generalTransition(this._matrixCrossFadePrepare,this._matrixCrossFade(this._reverseTiming(this._timingSequential)))]),seq_crossFade_Diagonal:this._transitionSequence([this._generalTransition(this._matrixCrossFadePrepare,this._matrixCrossFade(this._rotateDiagonalTiming(this._timingDiagonalWave,0))),this._generalTransition(this._matrixCrossFadePrepare,this._matrixCrossFade(this._rotateDiagonalTiming(this._timingDiagonalWave,1))),this._generalTransition(this._matrixCrossFadePrepare,this._matrixCrossFade(this._rotateDiagonalTiming(this._timingDiagonalWave,2))),this._generalTransition(this._matrixCrossFadePrepare,this._matrixCrossFade(this._rotateDiagonalTiming(this._timingDiagonalWave,3)))]),seq_shrink_Horiz:this._transitionSequence([this._generalTransition(this._matrixCrossFadePrepare,this._shrinkFade(this._timingHorizontalWave)),this._generalTransition(this._matrixCrossFadePrepare,this._shrinkFade(this._reverseTiming(this._timingHorizontalWave)))]),seq_shrink_Vert:this._transitionSequence([this._generalTransition(this._matrixCrossFadePrepare,this._shrinkFade(this._timingVerticalWave)),this._generalTransition(this._matrixCrossFadePrepare,this._shrinkFade(this._reverseTiming(this._timingVerticalWave)))]),seq_shrink_Seq:this._transitionSequence([this._generalTransition(this._matrixCrossFadePrepare,this._shrinkFade(this._timingSequential)),this._generalTransition(this._matrixCrossFadePrepare,this._shrinkFade(this._reverseTiming(this._timingSequential)))]),seq_shrink_Diagonal:this._transitionSequence([this._generalTransition(this._matrixCrossFadePrepare,this._shrinkFade(this._rotateDiagonalTiming(this._timingDiagonalWave,0))),this._generalTransition(this._matrixCrossFadePrepare,this._shrinkFade(this._rotateDiagonalTiming(this._timingDiagonalWave,1))),this._generalTransition(this._matrixCrossFadePrepare,this._shrinkFade(this._rotateDiagonalTiming(this._timingDiagonalWave,2))),this._generalTransition(this._matrixCrossFadePrepare,this._shrinkFade(this._rotateDiagonalTiming(this._timingDiagonalWave,3)))]),seq_swipe_alternate:this._transitionSequence([this._generalTransition(this._horizSwipePrepare,this._horizSwipe(this._timingSwipeAllAtOnce,this._swipeAlternate)),this._generalTransition(this._vertSwipePrepare,this._vertSwipe(this._timingSwipeAllAtOnce,this._swipeAlternate))]),seq_swipe_vert_wave:this._transitionSequence([this._generalTransition(this._vertSwipePrepare,this._vertSwipe(this._timingSwipeWave,this._swipeSingleDirection)),this._generalTransition(this._vertSwipePrepare,this._vertSwipe(this._reverseTiming(this._timingSwipeWave),this._swipeSingleDirection))]),seq_swipe_horiz_wave:this._transitionSequence([this._generalTransition(this._horizSwipePrepare,this._horizSwipe(this._timingSwipeWave,this._swipeSingleDirection)),this._generalTransition(this._horizSwipePrepare,this._horizSwipe(this._reverseTiming(this._timingSwipeWave),this._swipeSingleDirection))])};
c.none=this._generalTransition(this._matrixCrossFadePrepare,this._noTransition),this._transitionMap=c,c.seq_random=this._transitionSequenceGenerator(this._transitionRandomPicker(this.getTransitionList()))},getTransition:function(a){return this._transitionMap[a]},getTransitionList:function(){var a=[];for(var b in this._transitionMap)a.push(b);return a},_generalTransition:function(a,b){return function(c,d,e,f,g,h,i){var j=a(c,d,e,f,this._itemsContainer,this._positioningFunc);b(j,e,f,g,h,i)}.bind(this)},_transitionSequence:function(a){return function(b,c,d,e,f,g,h){this._sequenceIndex=this._sequenceIndex<a.length?this._sequenceIndex:0;var i=a[this._sequenceIndex++],j="function"===typeOf(i)?i:transMap[i];j(b,c,d,e,f,g,h)}.bind(this)},_transitionSequenceGenerator:function(a){return function(b,c,d,e,f,g,h){var i=a(this._sequenceIndex);i(b,c,d,e,f,g,h)}.bind(this)},_transitionRandomPicker:function(a){return function(){var b=a[parseInt(Math.random()*a.length)];return this._transitionMap[b]}.bind(this)},_destroyHolder:function(a,b){var c=a.children[0];if(c){this._itemsContainer.adopt(c);var d=this._positioningFunc(b);c.setStyles({position:"absolute",left:d.left+"px",top:d.top+"px"})}a.destroy()},_matrixCrossFadePrepare:function(a,b,c,d,e,f){var g,h,i,j,k=[];e.empty();for(var l=c*d,m=0;l>m;m++)g=new Element("div"),e.adopt(g),h=a[m]||new Element("div"),i=b[m]||new Element("div"),g.adopt(i,h),a[m]||i.setStyles({opacity:"0.0"}),h.setStyles({left:"0px",top:"0px"}),i.setStyles({left:"0px",top:"0px"}),k.push(g),j=f(m),g.setStyles({position:"absolute",left:j.left+"px",top:j.top+"px"});return k},_noTransition:function(a,b,c,d,e,f){a.forEach(this._destroyHolder),f()},_crossFade:function(a,b){var c=this;return function(d,e,f,g,h,i){for(var j=d.length,k=0;k<d.length;k++)!function(){var g=k;setTimeout(function(){var b=d[g].children[1],e=d[g].children[0];a(b,e,0,h,function(){c._destroyHolder(d[g],g),j--,0>=j&&i()})},b(g,1e3*h,e,f))}()}},_matrixCrossFade:function(a){return this._crossFade(this._transitionUtils.getTransition(Constants.TransitionTypes.CROSS_FADE),a)},_shrinkFade:function(a){return this._crossFade(this._transitionUtils.getTransition(Constants.TransitionTypes.SHRINK_FADE),a)},_vertSwipePrepare:function(a,b,c,d,e,f){var g,h,i,j,k,l,m,n,o,p=[];e.empty(),o=f(d*c).top;for(var q=0;c>q;q++){g=new Element("div"),e.adopt(g),m=new Element("div"),g.adopt(m),n=new Element("div"),g.adopt(n),m.setStyles({position:"absolute",top:"0px",height:o+"px"}),n.setStyles({position:"absolute",top:o+"px",height:o+"px"});for(var r=0;d>r;r++)k=r*c+q,l=f(k),h=a[k]||new Element("div"),i=b[k]||new Element("div"),n.adopt(i),m.adopt(h),h.setStyles({left:"0px",top:l.top+"px"}),i.setStyles({left:"0px",top:l.top+"px"});p.push(g),j=f(q),g.setStyles({position:"absolute",left:j.left+"px"})}return p},_horizSwipePrepare:function(a,b,c,d,e,f){var g,h,i,j,k,l,m,n,o,p=[];e.empty(),l=f(c-1),o=l.left+l.width;for(var q=0;d>q;q++){g=new Element("div"),e.adopt(g),m=new Element("div"),g.adopt(m),n=new Element("div"),g.adopt(n),m.setStyles({position:"absolute",left:"0px",width:o+"px"}),n.setStyles({position:"absolute",left:o+"px",width:o+"px"});for(var r=0;c>r;r++)k=q*c+r,l=f(k),h=a[k]||new Element("div"),i=b[k]||new Element("div"),n.adopt(i),m.adopt(h),h.setStyles({top:"0px",left:l.left+"px"}),i.setStyles({top:"0px",left:l.left+"px"});p.push(g),j=f(q*c),g.setStyles({position:"absolute",top:j.top+"px"})}return p},_vertSwipe:function(a,b){var c=this._transitionUtils.getTransition(Constants.TransitionTypes.SWIPE_VERTICAL),d=this;return function(e,f,g,h,i,j){for(var k=e.length,l=0;l<e.length;l++)!function(){var g=l;setTimeout(function(){b(c,e,g,h,i,function(){for(var a=e[g].children[1].children,b=a.length-1;b>=0;b--){var c=a[b];d._itemsContainer.adopt(c);var h=d._positioningFunc(b*f+g);c.setStyles({position:"absolute",left:h.left+"px",top:h.top+"px"})}e[g].destroy(),k--,0>=k&&j()})},a(g,1e3*i,e.length))}()}},_horizSwipe:function(a,b){var c=this._transitionUtils.getTransition(Constants.TransitionTypes.SWIPE_HORIZONTAL),d=this;return function(e,f,g,h,i,j){for(var k=e.length,l=0;l<e.length;l++)!function(){var g=l;setTimeout(function(){b(c,e,g,h,i,function(){for(var a=e[g].children[1].children,b=a.length-1;b>=0;b--){var c=a[b];d._itemsContainer.adopt(c);var h=d._positioningFunc(g*f+b);c.setStyles({position:"absolute",left:h.left+"px",top:h.top+"px"})}e[g].destroy(),k--,0>=k&&j()})},a(g,1e3*i,e.length))}()}},_swipeSingleDirection:function(a,b,c,d,e,f){a(b[c].children[0],b[c].children[1],d,e,f)},_swipeAlternate:function(a,b,c,d,e,f){c%2===0?a(b[c].children[0],b[c].children[1],d,e,f):(d=0==d?1:0,a(b[c].children[0],b[c].children[1],d,e,f))},_timingAllAtOnce:function(){return 0},_timingSequential:function(a,b,c,d){return a/(c*d)*b},_timingHorizontalWave:function(a,b,c){{var d=a%c;Math.floor((a-d)/c)}return d/c*b},_timingVerticalWave:function(a,b,c,d){var e=a%c,f=Math.floor((a-e)/c);return f/d*b},_reverseTiming:function(a){return function(b,c){return c-a.apply(this,arguments)}},_standardDiagonalDistFunc:function(a,b){return Math.sqrt(a*a+b*b)},_timingDiagonalWave:function(a,b,c,d,e){e=e||this._standardDiagonalDistFunc;var f=a%c,g=Math.floor((a-f)/c),h=e(f,g,c,d),i=Math.sqrt(c*c+d*d);return h/i*b},_timingSwipeAllAtOnce:function(){return 0},_timingSwipeWave:function(a,b,c){return(.6+.4*a/c)*b},_rotateDiagonalTiming:function(a,b){var c,d=this;return c=0>=b||b>3?this._standardDiagonalDistFunc:1==b?function(a,b,c){return d._standardDiagonalDistFunc(c-a,b)}:2==b?function(a,b,c,e){return d._standardDiagonalDistFunc(c-a,e-b)}:function(a,b,c,e){return d._standardDiagonalDistFunc(a,e-b)},function(b,d,e,f){return a(b,d,e,f,c)}}})}),define.Class("wysiwyg.viewer.utils.MessageViewController",function(a){var b=a;b.binds(["_showMessageBox","_messageBoxClosed","_showMessageBoxWithSuspendedOk"]),b.resources(["W.Components","W.Config","W.Theme"]),b.inherits("bootstrap.managers.BaseManager"),b.methods({initialize:function(){this._messagesQueue=[],this.BETWEEN_MESSAGES_DELAY=700,W.Commands.registerCommandListenerByName("WPreviewCommands.ViewerStateChanged",this,this._onViewerStateChanged),W.Commands.registerCommandListenerByName("WPreviewCommands.WEditModeChanged",this,this._onViewerStateChanged),this._overlay=null},showTryAgainMessage:function(a,b,c,d){var e={};e.msgTitle=a,e.msgBody=b,e.okCaption="Try Again",e.messageDelay=c,e.cb=d,this._messagesQueue.push(e);var f=this._getTryAgainDialogDefinition();this._initIfNeededMessageView(this._showMessageBoxWithSuspendedOk,f)},_getTryAgainDialogDefinition:function(){var a="wysiwyg.viewer.components.TryAgainMessageView",b="wysiwyg.viewer.skins.TryAgainMessageViewSkin";return this._isMobileMode()&&(b="wysiwyg.viewer.skins.MobileTryAgainMessageViewSkin"),{comp:a,skin:b}},_showMessageBoxWithSuspendedOk:function(){if(this._messagesQueue.length>0&&!this._messageBox.getLogic().visible()){var a=this._messagesQueue.shift();this._messageBox.getLogic().hideMessage(),this._handleSuspendedMessage(a)}},_handleSuspendedMessage:function(a){a.messageDelay&&a.messageDelay>0&&(this._showSpinner(),setTimeout(function(){this._hideSpinner(),this._messageBox.getLogic().showMessage(a)}.bind(this),a.messageDelay))},_showSpinner:function(){this._overlay||(this._overlay=this._createOverlay()),window.document.body.appendChild(this._overlay)},_hideSpinner:function(){this._overlay&&window.document.body.removeChild(this._overlay)},_createOverlay:function(){var a=new Element("div",{styles:{position:"fixed",width:"100%",height:"100%",top:"0",left:"0","background-color":"rgba(0,0,0,0.5)"}}),b=this._createSpinner();return a.appendChild(b),a},_createSpinner:function(){var a=new Element("div",{styles:{width:"100%",height:"100%",top:"0",left:"-15px",position:"fixed","margin-left":"50%","margin-top":"25%"}}),b=new Image;return b.src=this.resources.W.Theme.getProperty("BG_DIRECTORY")+"full_preloader.gif",a.appendChild(b),a},_onViewerStateChanged:function(){this._messageBox&&(this._messageBox.getLogic().hideMessage(),this._messagesQueue.empty())},_getMessageViewSettings:function(){return this._isMobileMode()?{comp:"wysiwyg.viewer.components.MessageView",skin:"wysiwyg.viewer.skins.MobileMessageViewSkin"}:{comp:"wysiwyg.viewer.components.MessageView",skin:"wysiwyg.viewer.skins.MessageViewSkin"}},_isMobileMode:function(){return this.resources.W.Config.env.getCurrentFrameDevice()===Constants.ViewerTypesParams.TYPES.MOBILE},_initIfNeededMessageView:function(a,b){if(b||(b=this._getMessageViewSettings()),this._messageBox){var c={comp:this._messageBox.getAttribute("comp"),skin:this._messageBox.getAttribute("skin")};(c.comp!==b.comp||c.skin!==b.skin)&&this.kill()}this._messageBox?a&&a():this.resources.W.Components.createComponent(b.comp,b.skin,null,null,function(b){this._messageBox=b.getViewNode(),this._messageBox.insertInto(document.body),b.addEvent("complete",this._messageBoxClosed),a()}.bind(this))},showError:function(a,b){var c={};c.msgTitle=a,c.msgBody=b,this._messagesQueue.push(c),this._initIfNeededMessageView(this._showMessageBox)},showMessage:function(a,b,c){var d={};d.msgTitle=a,d.msgBody=b,d.cb=c,this._messagesQueue.push(d),this._initIfNeededMessageView(this._showMessageBox)},_showMessageBox:function(){this._messagesQueue.length>0&&!this._messageBox.getLogic().visible()&&this._messageBox.getLogic().showMessage(this._messagesQueue.shift())},_messageBoxClosed:function(){setTimeout(function(){this._showMessageBox()}.bind(this),this.BETWEEN_MESSAGES_DELAY)},kill:function(){this._messageBox&&(this._messageBox.dispose(),this._messageBox.removeFromDOM(),this._messageBox=null)},isReady:function(){return!0},clone:function(a){return this.parent(a)}})}),define.Class("wysiwyg.viewer.utils.MobileActionsMenuHandler",function(a){var b=a;b.resources(["W.Data","W.Resources","W.Commands"]),b.utilize(["core.managers.components.ComponentBuilder"]),b.binds(["_navigateToPage","_createNavItemsFromDataItems","_createSingleNavItem"]),b.methods({handleMobileActionsMenu:function(){this._removePreloader(),this._addPagesNavigation(),this._addSocialNavigation(),window.WMobileActionsMenu&&window.WMobileActionsMenu.updateDisplay()},_removePreloader:function(){var a=document.getElementById("viewer_preloader");a&&document.body.removeChild(a);var b=document.getElementById(Constants.ViewerTypesParams.DOM_ID_STATIC_PREFIX+"viewer_preloader");b&&document.body.removeChild(b)},_addPagesNavigation:function(){var a=document.getElementById("mobileActionsMenuListsPages");if(a){this._pagesMap={},this.resources.W.Commands.registerCommandAndListener("WViewerCommands.SelectedPageChanged",this,this._onSelectedPageChanged);var b=new Element("ul");a.appendChild(b),this.resources.W.Data.getDataByQuery("#MAIN_MENU",function(a){var c=a.getItems();this._createNavItemsFromDataItems(b,c,0)}.bind(this))}},_addSocialNavigation:function(){var a;if(window.rendererModel.siteMetaData.quickActions&&window.rendererModel.siteMetaData.quickActions.socialLinks){a=window.rendererModel.siteMetaData.quickActions.socialLinks;var b=document.getElementById("mobileActionsMenuListsSocial");if(b){var c=new Element("ul");b.appendChild(c);for(var d=0;d<a.length;d++){var e=new Element("li"),f=e.appendChild(new Element("div")).appendChild(new Element("a"));f.setAttribute("href","#"),f.setAttribute("target","_blank"),f.innerHTML=a[d].id,c.appendChild(e),window.Hammer(e).on("tap",function(a){this._hideMenu(),a.preventDefault(),a.stopPropagation(),a.gesture.preventDefault(),a.gesture.stopPropagation()}.bind(this))}}}},_createNavItemsFromDataItems:function(a,b,c,d){for(var e=0;e<b.length;e++){var f=b[e];this._createSingleNavItem(a,f,c,d)}},_createSingleNavItem:function(a,b,c){for(var d="&nbsp;  ",e="",f=0;c>f;f++)e+=d;var g=document.createElement("li"),h=b.get("refId");this._pagesMap[h]=g;var i=g.appendChild(new Element("div")).appendChild(new Element("a")),j=new Element("span");j.className="alignHelper",i.parentNode.appendChild(j),a.appendChild(g),this.resources.W.Data.getDataByQuery(h,function(d){var f=d.get("hidePage");if(f)a.removeChild(g);else{var j=d.get("title");i.innerHTML=e+j;var k=b.get("items");if(k&&k.length>0){g.setAttribute("class","hasChildren");var l=new Element("ul");l.setAttribute("class","subMenu");var m=new Element("span");m.setAttribute("id","toggleBtn"),g.appendChild(m),g.appendChild(l),this._createNavItemsFromDataItems(l,k,c+1,g),window.Hammer(m).on("tap",function(b){var c=b.currentTarget,d=c.parentNode,e=d.children[2];e.hasClass("open")?(e.removeClass("open"),c.removeClass("open")):(e.addClass("open"),c.addClass("open")),a.parentNode.scrollHeight<=a.clientHeight?g.parentNode.parentNode.addClass("hasOverflow"):g.parentNode.parentNode.removeClass("hasOverflow"),b.preventDefault(),b.stopPropagation(),b.gesture.preventDefault(),b.gesture.stopPropagation()}.bind(this))}h&&0===h.indexOf("#")&&(h=h.substr(1)),window.Hammer(g).on("tap",function(a){this._hideMenu(),this._navigateToPage(h),a.preventDefault(),a.stopPropagation(),a.gesture.preventDefault(),a.gesture.stopPropagation()}.bind(this))}}.bind(this))},_onSelectedPageChanged:function(){},_hideMenu:function(){window.WMobileActionsMenu&&window.WMobileActionsMenu.hideLists()},_navigateToPage:function(a){W.Viewer.goToPage(a)}})}),define.Class("wysiwyg.viewer.utils.MobileQuickActionsHandler",function(a){var b=a;b.resources(["W.Data","W.Resources","W.Commands"]),b.binds(["_navigateToPage","_createNavItemsFromDataItems","_createSingleNavItem"]),b.methods({handleMobileQuickActions:function(){this._removePreloader(),this._addNavigation()},_removePreloader:function(){var a=document.getElementById("viewer_preloader");a&&document.body.removeChild(a);var b=document.getElementById(Constants.ViewerTypesParams.DOM_ID_STATIC_PREFIX+"viewer_preloader");b&&document.body.removeChild(b)},_addNavigation:function(){var a=document.getElementById("quick-actions");if(a){var b=document.getElementById("quick-actions-pages-button");if(b){this._pagesMap={},this.resources.W.Commands.registerCommandAndListener("WViewerCommands.SelectedPageChanged",this,this._onSelectedPageChanged);var c=document.getElementById("qa-drop-up-pages").querySelector(".quick-actions-drop-up-title"),d=document.getElementById("qa-drop-up-pages-list");this.resources.W.Data.getDataByQuery("#MAIN_MENU",function(a){var b="Pages";c.innerHTML=b;var e=a.getItems();this._createNavItemsFromDataItems(d,e,0),this._addGapElement(d)}.bind(this)),b.className=b.className.replace("disabled","")}}},_addGapElement:function(a){if(a){var b=document.createElement("li");b.className="quick-actions-drop-up-ugly-clearfix",a.appendChild(b)}},_createNavItemsFromDataItems:function(a,b,c,d){for(var e=0;e<b.length;e++){var f=b[e];this._createSingleNavItem(a,f,c,d)}},_createSingleNavItem:function(a,b,c){for(var d=this._navigateToPage,e=this._hideMenu,f=">  ",g="",h=0;c>h;h++)g+=f;var i=document.createElement("li"),j=b.get("refId");this._pagesMap[j]=i,i.innerHTML="<a href='#'></a>",a.appendChild(i),this.resources.W.Data.getDataByQuery(j,function(f){var h=f.get("mobileHidePage");if(h)a.removeChild(i);else{var k=f.get("title");i.firstChild.innerHTML=g+k;var l=b.get("items");l&&l.length>0&&this._createNavItemsFromDataItems(a,l,c+1,i),j&&0===j.indexOf("#")&&(j=j.substr(1)),i.addEventListener("click",function(a){e(),d(j),a.stopPropagation(),a.preventDefault()})}}.bind(this))},_onSelectedPageChanged:function(a){var b=this._pagesMap[this._currentPage];b&&b.removeClass("quick-actions-drop-up-selected"),this._currentPage="#"+a;var c=this._pagesMap[this._currentPage];c&&c.addClass("quick-actions-drop-up-selected")},_hideMenu:function(){var a="quick-actions-drop-up-wrapper-open",b=document.getElementById("qa-drop-up-pages");b.removeClass(a)},_navigateToPage:function(a){W.Viewer.goToPage(a)}})}),define.Class("wysiwyg.viewer.utils.PageConfigurationRepository",function(a){var b=a;b.resources(["W.Utils"]),b.methods({initialize:function(){this._pageConfigMap={},this._pageTypeMap={},this._defaultConfig={type:"wysiwyg.editor.utils.PageConfiguration",options:{canBeDeleted:!0,canBeDuplicated:!0,showSeoSettings:!0,canBeHidden:!0,canBeReordered:!0,canHaveChildren:!0,canBeAddedFromMenu:!0,canBeSetAsHomePage:!0,showBasicSettings:!0,canBeProtected:!0,pageIcon:null,repeaterPage:!1,canBeLinkedTo:!0}}},registerConfig:function(a,b){b=Object.merge({},this._defaultConfig,b),this._pageConfigMap.hasOwnProperty(a)||(this._pageConfigMap[a]=b)},getConfig:function(a){var b=this._pageTypeMap[a.type];if(!b)throw"PageConfigurationRepository:: cannot resolve key getter function for page type ["+a.type+"].";var c=b(a);return this.getConfigById(c)},getConfigById:function(a){var b=this._pageConfigMap[a];if(!b)throw"PageConfigurationRepository:: configuration not found for page type ["+a+"].";return b},registerPageType:function(a,b){this._pageTypeMap.hasOwnProperty(a)||(this._pageTypeMap[a]=b)},_areEqualConfigs:function(a,b){var c=Object.keys(a),d=Object.keys(b);if(c.length!=d.length)return!1;for(var e=0;e<c.length;e++){var f=c[e];if(a[f]!==b[f])return!1}return!0}})}),define.Class("wysiwyg.viewer.utils.TransitionHandler",function(a){a.binds(["_swipeHorizontalTransition","_swipeHorizontalTransitionFullScreen","_swipeVerticalTransition","_swipeVerticalTransitionFullScreen","_noTransition","_inOutTransition","_crossFadeTransition","_shrinkFadeTransition","_trackCallback"]),a.fields({_useCSS3:!1,_frameRateTrackingActive:!1,_frameRateCount:0,_trackStartTime:0}),a.resources(["W.Utils"]),a.methods({initialize:function(){this._Tween=this.resources.W.Utils.Tween},getTransition:function(a){switch(a){case Constants.TransitionTypes.SWIPE_HORIZONTAL:return this._swipeHorizontalTransition;case Constants.TransitionTypes.SWIPE_HORIZONTAL_FULLSCREEN:return this._swipeHorizontalTransitionFullScreen;case Constants.TransitionTypes.SWIPE_VERTICAL:return this._swipeVerticalTransition;case Constants.TransitionTypes.SWIPE_VERTICAL_FULLSCREEN:return this._swipeVerticalTransitionFullScreen;case Constants.TransitionTypes.CROSS_FADE:return this._crossFadeTransition;case Constants.TransitionTypes.SHRINK_FADE:return this._shrinkFadeTransition;case Constants.TransitionTypes.OUT_IN:return this._inOutTransition;default:return this._noTransition}},_noTransition:function(a,b,c,d,e){e()},_swipeHorizontalTransition:function(a,b,c,d,e){var f=a.getWidth();this._swipeHorizontalTransitionCommon(a,b,c,d,f,e)},_swipeHorizontalTransitionFullScreen:function(a,b,c,d,e){var f=a.getContentRect(),g=Math.max($(document).getSize().x-f.left,f.right),h=g-b.getContentRect(b).left;this._swipeHorizontalTransitionCommon(a,b,c,d,h,e)},_swipeHorizontalTransitionCommon:function(a,b,c,d,e,f){var g=a.getParent(),h=this.injects().Utils.getCSSBrowserFeature("animation"),i=this.injects().Utils.getCSSBrowserFeature("animation-timing-function"),j={};a.setStyles({position:"absolute"}),b.setStyles({position:"absolute"}),0!==c&&(e=-e),b.setStyle("left",e+"px"),b.setStyle("top","0px"),this._useCSS3&&h?(j.left=e+"px",j["margin-left"]=String(-e)+"px",j[h]="swipeHoriz "+d+"s",j[i]="ease-in-out",g.setStyles(j),setTimeout(function(){g.setStyle(h,""),g.setStyles({left:"0px","margin-left":"0px"}),b.setStyles({left:"0px"}),f()},1e3*d)):this._Tween.to(g,d,{left:String(-e),ease:"strong_easeInOut",onComplete:function(){b.setStyles({left:"0px"}),g.setStyles({top:"0px",left:"0px"}),f()}})},_swipeVerticalTransition:function(a,b,c,d,e){var f=a.getHeight();this._swipeVerticalTransitionCommon(a,b,c,d,f,e)},_swipeVerticalTransitionFullScreen:function(a,b,c,d,e){var f=a.getCoordinates().top+b.getHeight();this._swipeVerticalTransitionCommon(a,b,c,d,f,e)},_swipeVerticalTransitionCommon:function(a,b,c,d,e,f){var g=a.getParent(),h=this.injects().Utils.getCSSBrowserFeature("animation"),i=this.injects().Utils.getCSSBrowserFeature("animation-timing-function"),j={};a.setStyles({position:"absolute"}),b.setStyles({position:"absolute"}),0!==c&&(e=-e),b.setStyle("top",e+"px"),b.setStyle("left","0px"),this._useCSS3&&h?(j.top=e+"px",j["margin-top"]=String(-e)+"px",j[h]="swipeVert "+d+"s",j[i]="ease-in-out",g.setStyles(j),setTimeout(function(){g.setStyle(h,""),g.setStyles({top:"0px","margin-top":"0px"}),b.setStyles({top:"0px"}),f()},1e3*d)):this._Tween.to(g,d,{top:String(-e),ease:"strong_easeInOut",onComplete:function(){b.setStyles({top:"0px"}),g.setStyles({top:"0px",left:"0px"}),f()}})},_crossFadeTransition:function(a,b,c,d,e){var f=this.injects().Utils.getCSSBrowserFeature("animation");a.setStyles({position:"absolute"}),b.setStyles({position:"relative",top:"0px",left:"0px",opacity:"0.0"}),this._useCSS3&&f?(a.setStyle(f,"fadeOut "+d+"s"),b.setStyle(f,"fadeIn "+d+"s"),setTimeout(function(){b.setStyle(f,""),a.setStyle(f,""),b.setStyles({position:"absolute"}),e()},1e3*d)):(a.setStyles({opacity:"1.0"}),b.setStyles({opacity:"0.0",visibility:"visible"}),this._Tween.to(a,d,{opacity:0,ease:"swing"}),this._Tween.to(b,d,{opacity:1,ease:"swing",onComplete:function(){e()}}))},_shrinkFadeTransition:function(a,b,c,d,e){var f=a.getCoordinates(),g=a.getParent();a.setStyles({position:"absolute",top:"0px",left:"0px"}),b.setStyles({position:"absolute",top:"0px",left:"0px"});var h=new Element("div");h.setStyles({position:"absolute",width:f.width+"px",height:f.height+"px",overflow:"hidden"}),g.adopt(h),h.adopt(a),this._Tween.to(h,d,{top:parseInt(f.height/2)+"px",left:parseInt(f.width/2)+"px",width:"0px",height:"0px",ease:"swing",onComplete:function(){h.getParent().adopt(a),h.destroy(),e()}})},_inOutTransition:function(a,b,c,d,e){var f=this.injects().Utils.getCSSBrowserFeature("animation");a.setStyles({position:"absolute"}),b.setStyles({position:"relative",top:"0px",left:"0px",opacity:"0.0",visibility:"visible"}),this._useCSS3&&f?(a.setStyle(f,"fadeOut "+d+"s"),b.setStyle(f,"fadeIn "+d+"s "+d+"s"),setTimeout(function(){a.setStyle(f,""),a.setStyles({opacity:"0.0"}),setTimeout(function(){b.setStyle(f,""),b.setStyles({opacity:"1.0"}),b.setStyles({position:"absolute"}),e()},1e3*d)},1e3*d)):(a.setStyles({opacity:"1.0"}),b.setStyles({opacity:"0.0",visibility:"visible"}),this._Tween.to(a,1.2*d,{opacity:0,ease:"strong_easeOut"}),this._Tween.to(b,d,{opacity:1,ease:"strong_easeIn",onComplete:function(){e()}}))},_startTracking:function(){this._frameRateTrackingActive=!0,this._frameRateCount=0,this._trackStartTime=(new Date).getTime(),window.requestAnimFrame(this._trackCallback)},_stopTracking:function(){this._frameRateTrackingActive=!1;((new Date).getTime()-this._trackStartTime)/1e3},_trackCallback:function(){this._frameRateCount++,this._frameRateTrackingActive&&window.requestAnimFrame(this._trackCallback)}})}),define.Class("wysiwyg.viewer.utils.TransitionUtils",function(a){var b=a;b.binds(["_swipeHorizontalTransition","_swipeHorizontalTransitionFullScreen","_swipeVerticalTransition","_swipeVerticalTransitionFullScreen","_noTransition","_inOutTransition","_crossFadeTransition","_shrinkFadeTransition","_trackCallback"]),b.fields({_useCSS3:!1,_frameRateTrackingActive:!1,_frameRateCount:0,_trackStartTime:0}),b.resources(["W.Config"]),b.methods({initialize:function(){this._Tween=W.Utils.Tween},getTransition:function(a){if(this.resources.W.Config.mobileConfig.isMobileOrTablet())return this._noTransition;switch(a){case Constants.TransitionTypes.SWIPE_HORIZONTAL:return this._swipeHorizontalTransition;case Constants.TransitionTypes.SWIPE_HORIZONTAL_FULLSCREEN:return this._swipeHorizontalTransitionFullScreen;case Constants.TransitionTypes.SWIPE_VERTICAL:return this._swipeVerticalTransition;case Constants.TransitionTypes.SWIPE_VERTICAL_FULLSCREEN:return this._swipeVerticalTransitionFullScreen;case Constants.TransitionTypes.CROSS_FADE:return this._crossFadeTransition;case Constants.TransitionTypes.SHRINK_FADE:return this._shrinkFadeTransition;case Constants.TransitionTypes.OUT_IN:return this._inOutTransition;default:return this._noTransition}},_noTransition:function(a,b,c,d,e){e()},_swipeHorizontalTransition:function(a,b,c,d,e){var f=a.getWidth();this._swipeHorizontalTransitionCommon(a,b,c,d,f,e)},_swipeHorizontalTransitionFullScreen:function(a,b,c,d,e){var f=a.getContentRect(),g=Math.max($(document).getSize().x-f.left,f.right),h=g-b.getContentRect(b).left;this._swipeHorizontalTransitionCommon(a,b,c,d,h,e)},_swipeHorizontalTransitionCommon:function(a,b,c,d,e,f){var g=a.getParent(),h=this.injects().Utils.getCSSBrowserFeature("animation"),i=this.injects().Utils.getCSSBrowserFeature("animation-timing-function"),j={};a.setStyles({position:"absolute"}),b.setStyles({position:"absolute"}),0!==c&&(e=-e),b.setStyle("left",e+"px"),this._useCSS3&&h?(j.left=e+"px",j["margin-left"]=String(-e)+"px",j[h]="swipeHoriz "+d+"s",j[i]="ease-in-out",g.setStyles(j),setTimeout(function(){g.setStyle(h,""),g.setStyles({left:"0px","margin-left":"0px"}),b.setStyles({left:"0px"}),f()},1e3*d)):this._Tween.to(g,d,{left:String(-e),ease:"strong_easeInOut",onComplete:function(){b.setStyles({left:"0px"}),g.setStyles({top:"0px",left:"0px"}),f()}})},_swipeVerticalTransition:function(a,b,c,d,e){var f=a.getHeight();this._swipeVerticalTransitionCommon(a,b,c,d,f,e)},_swipeVerticalTransitionFullScreen:function(a,b,c,d,e){var f=a.getCoordinates().top+b.getHeight();this._swipeVerticalTransitionCommon(a,b,c,d,f,e)},_swipeVerticalTransitionCommon:function(a,b,c,d,e,f){var g=a.getParent(),h=this.injects().Utils.getCSSBrowserFeature("animation"),i=this.injects().Utils.getCSSBrowserFeature("animation-timing-function"),j={};a.setStyles({position:"absolute"}),b.setStyles({position:"absolute"}),0!==c&&(e=-e),b.setStyle("top",e+"px"),this._useCSS3&&h?(j.top=e+"px",j["margin-top"]=String(-e)+"px",j[h]="swipeVert "+d+"s",j[i]="ease-in-out",g.setStyles(j),setTimeout(function(){g.setStyle(h,""),g.setStyles({top:"0px","margin-top":"0px"}),b.setStyles({top:"0px"}),f()},1e3*d)):this._Tween.to(g,d,{top:String(-e),ease:"strong_easeInOut",onComplete:function(){b.setStyles({top:"0px"}),g.setStyles({top:"0px",left:"0px"}),f()}})},_crossFadeTransition:function(a,b,c,d,e){var f=this.injects().Utils.getCSSBrowserFeature("animation");a.setStyles({position:"absolute"}),b.setStyles({position:"relative",top:"0px",left:"0px",opacity:"0.0"}),this._useCSS3&&f?(a.setStyle(f,"fadeOut "+d+"s"),b.setStyle(f,"fadeIn "+d+"s"),setTimeout(function(){b.setStyle(f,""),a.setStyle(f,""),b.setStyles({position:"absolute"}),e()},1e3*d)):(a.setStyles({opacity:"1.0"}),b.setStyles({opacity:"0.0",visibility:"visible"}),this._Tween.to(a,d,{opacity:0,ease:"swing"}),this._Tween.to(b,d,{opacity:1,ease:"swing",onComplete:function(){e()}}))},_shrinkFadeTransition:function(a,b,c,d,e){var f=a.getCoordinates(),g=a.getParent();a.setStyles({position:"absolute",top:"0px",left:"0px"}),b.setStyles({position:"absolute",top:"0px",left:"0px"});var h=new Element("div");h.setStyles({position:"absolute",width:f.width+"px",height:f.height+"px",overflow:"hidden"}),g.adopt(h),h.adopt(a),this._Tween.to(h,d,{top:parseInt(f.height/2)+"px",left:parseInt(f.width/2)+"px",width:"0px",height:"0px",ease:"swing",onComplete:function(){h.getParent().adopt(a),h.destroy(),e()}})},_inOutTransition:function(a,b,c,d,e){var f=this.injects().Utils.getCSSBrowserFeature("animation");a.setStyles({position:"absolute"}),b.setStyles({position:"relative",top:"0px",left:"0px",opacity:"0.0",visibility:"visible"}),this._useCSS3&&f?(a.setStyle(f,"fadeOut "+d+"s"),b.setStyle(f,"fadeIn "+d+"s "+d+"s"),setTimeout(function(){a.setStyle(f,""),a.setStyles({opacity:"0.0"}),setTimeout(function(){b.setStyle(f,""),b.setStyles({opacity:"1.0"}),b.setStyles({position:"absolute"}),e()},1e3*d)},1e3*d)):(a.setStyles({opacity:"1.0"}),b.setStyles({opacity:"0.0",visibility:"visible"}),this._Tween.to(a,d,{opacity:.1,ease:"strong_easeOut"}),this._Tween.to(b,d,{opacity:1,ease:"strong_easeIn",onComplete:function(){e()}}))},_startTracking:function(){this._frameRateTrackingActive=!0,this._frameRateCount=0,this._trackStartTime=(new Date).getTime(),window.requestAnimFrame(this._trackCallback)},_stopTracking:function(){this._frameRateTrackingActive=!1;((new Date).getTime()-this._trackStartTime)/1e3},_trackCallback:function(){this._frameRateCount++,this._frameRateTrackingActive&&window.requestAnimFrame(this._trackCallback)}})}),define.component("wysiwyg.viewer.components.AdminLogin",function(a){var b=a;b.inherits("wysiwyg.viewer.components.PasswordLogin"),b.binds(["centerDialog","_onSubmit","_reportError","_invalidateErrorState","_onKeyPress"]),b.skinParts({blockingLayer:{type:"htmlElement"},passwordInput:{type:"wysiwyg.viewer.components.inputs.TextInput",hookMethod:"_bindPasswordField"},submitButton:{type:"htmlElement"},xButton:{type:"htmlElement",command:"WViewerCommands.PasswordLogin.Close"},favIcon:{type:"htmlElement"},header:{type:"htmlElement"},dialog:{type:"htmlElement"}}),b.dataTypes(["Text"]),b.states({DEFAULT:["normal","confirm"],displayDevice:["mobile","desktop"]}),b.methods({initialize:function(a,b,c){this.isVolatile=!0,this._userApi=!window.userApi&&window.UserApi?window.UserApi.getInstance().init({orgDocID:"",usersDomain:window.usersDomain||'https://users.wix.com/wix-users";',corsEnabled:!0,dontHandShake:!0,urlThatUserRedirectedFrom:""}):window.userApi,this.parent(a,b,c),this.VIEWER_STRINGS.LOGIN_HEADER="Login to edit your site",this.ERR_MAP={9975:this.VIEWER_STRINGS.LOGIN_ERR_GENERAL,9972:this.VIEWER_STRINGS.LOGIN_ERR_WRONG_PASSWORD}},_validatePassword:function(a,b,c){var d=this._validateInput(a);if(d)c(d);else{var e=window.rendererModel,f=e.metaSiteId,g=e.siteId,h=window.siteHeader.userId,i=(this.injects().Config.getServiceTopologyProperty("serverName"),!1),j=this.injects().Config.getServiceTopologyProperty("htmlEditorUrl")+"/editor/web/renderer/edit/"+g+"?metaSiteId="+f;if(!this._userApi)return this._reportError(this.VIEWER_STRINGS.LOGIN_ERR_GENERAL),void 0;this._userApi.loginByGuid(h,a,i,function(){c(this.VIEWER_STRINGS.LOGIN_ERR_GENERAL)}.bind(this),function(a){var d=a.success;if(d)b(),(this.injects().Config.env.$isPublicViewerFrame||this._debugMode)&&window.open(j,"_blank");else{var e=this.ERR_MAP[a.errorCode]||this.ERR_MAP[9975];c(e)}}.bind(this))}},_onSubmit:function(){this.injects().Config.env.$isPublicViewerFrame?this.parent():this.injects().Commands.executeCommand("adminLogin.submitAttempt",{component:this._skinParts.submitButton},this)},_validateInput:function(a){var b=a.length;return 4>b||b>15?this.ERR_MAP["9972"]:0==a.test(/^[a-zA-Z0-9_\-!@#$%^&*]+$/)?this.ERR_MAP["9972"]:null}})}),define.component("wysiwyg.viewer.components.AdminLoginButton",function(a){var b=a;b.inherits("wysiwyg.viewer.components.SiteButton"),b.resources(["W.Commands"]),b.skinParts({label:{type:"htmlElement"},link:{type:"htmlElement"}}),b.dataTypes(["LinkableButton"]),b.propertiesSchemaType("ButtonProperties"),b.fields({EDITOR_META_DATA:{general:{settings:!0,design:!0},mobile:{allInputsHidden:!0}}}),b.methods({initialize:function(a,b,c){this.parent(a,b,c)},isPartiallyFunctionalInStaticHtml:function(){return!0},_onClick:function(){this.resources.W.Commands.executeCommand("WViewerCommands.AdminLogin.Open")}})}),define.component("wysiwyg.viewer.components.AudioPlayer",function(a){var b=a;b.inherits("mobile.core.components.base.BaseComponent"),b.utilize(["wysiwyg.viewer.components.classes.SoundUtils"]),b.binds(["_play","_pause","_stop","_onFinish","_setVolume","_createAudioPlayer","_soundManagerReady","_onViewerModeChange","_mediaGalleryCallback","_onPageTransitionStarted"]),b.resources(["scriptLoader","W.Config","W.Utils","W.Commands","topology","W.Resources","W.Viewer"]),b.skinParts({playButton:{type:"htmlElement"},stopButton:{type:"htmlElement"},pauseButton:{type:"htmlElement"}}),b.statics({MEDIA_GALLERY:{DataTypes:{music:"Audio"}}}),b.fields({EDITOR_META_DATA:{general:{settings:!0,design:!0},custom:[{label:"AUDIO_REPLACE_AUDIO",command:"WEditorCommands.OpenMediaFrame",commandParameter:{galleryConfigID:"audio",i18nPrefix:"music",selectionType:"single",mediaType:"music",callback:"_mediaGalleryCallback"},commandParameterDataRef:"SELF"}],dblClick:{command:"WEditorCommands.OpenMediaFrame",commandParameter:{galleryConfigID:"audio",i18nPrefix:"music",selectionType:"single",mediaType:"music",callback:"_mediaGalleryCallback"},commandParameterDataRef:"SELF"},mobile:{allInputsHidden:!0}}}),b.states(["loading","stopped","playing"]),b.dataTypes(["AudioPlayer"]),b.methods({initialize:function(a,b,c){this._soundUtils=new this.imports.SoundUtils,this.parent(a,b,c),this._soundUtils.loadApi(),this.resources.W.Commands.registerCommandAndListener("WViewerCommands.StopAllOtherAudios",this,this._stopAllOtherAudios),this.resources.W.Commands.registerCommandAndListener("WPreviewCommands.WEditModeChanged",this,this._onEditModeChange),this.resources.W.Viewer.addEvent("pageTransitionStarted",this._onPageTransitionStarted)
},_onEditModeChange:function(){this._shouldPlayAudio()},_onPageTransitionStarted:function(){this._shouldPlayAudio()||this._stop()},_shouldPlayAudio:function(){var a=this.resources.W.Config.env,b="playing"===this.getState(),c=this._data.get("autoPlay");return a.isInInteractiveViewer()&&a.isViewingDesktopDevice()&&this.getIsDisplayed()&&(c||b)},_stopAllOtherAudios:function(a){a.compId!==this.getComponentUniqueId()&&this.getIsDisplayed()&&this._pause()},_isEditModeChangeToFromPreview:function(a,b){return"PREVIEW"===a||b&&"PREVIEW"===b.source},_onAllSkinPartsReady:function(){this.$class._audioManagerWasLoaded&&this.setState("stopped"),this._fileWasSet()&&this._createAudioPlayer().done()},_createAudioPlayer:function(){return this._attachButtonEvents(),this._registerButtonCommands(),this._createAudio().then(function(){this._shouldPlayAudio()&&this._play()}.bind(this))},_onViewerModeChange:function(a){var b=a.viewerMode;b===Constants.ViewerTypesParams.TYPES.MOBILE&&this._stop(),this.resources.W.Config.env.isEditorInPreviewMode()&&this.getIsDisplayed()&&this._data.get("autoPlay")&&this._fileWasSet()?this._play():this._stop()},_onModeChange:function(a){this._isDisposed||this.resources.W.Config.env.$viewingDevice!==Constants.ViewerTypesParams.TYPES.MOBILE&&(this._isInPreviewMode(a)&&this.getIsDisplayed()&&this._data.get("autoPlay")&&this._fileWasSet()?this._play():this._stop())},_fileWasSet:function(){return this._isDisposed?void 0:this._data.get("uri").length>0},_isInPreviewMode:function(a){return a.toLowerCase()===Constants.ViewManager.VIEW_MODE_PREVIEW.toLowerCase()},_play:function(){if(this._fileWasSet()){this.setState("playing");var a={volume:this.getDataItem().get("volume")};a.onfinish=this._onFinish,this.resources.W.Commands.executeCommand("WViewerCommands.StopAllOtherAudios",{compId:this.getComponentUniqueId()},this),this._audio&&this._audio.play(a)}},_onFinish:function(){this._data.get("loop")&&this._play(),this.fireEvent("trackFinished")},_pause:function(){this._fileWasSet()&&(this.setState("stopped"),this._audio.pause())},_stop:function(){this._fileWasSet()&&this._audio&&(this.setState("stopped"),this._audio.stop(),this._audio.destruct(),this._createAudio())},_attachButtonEvents:function(){this._skinParts.playButton.addEvent("click",this._play),this._skinParts.stopButton.addEvent("click",this._stop),this._skinParts.pauseButton.addEvent("click",this._pause)},_registerButtonCommands:function(){this.resources.W.Commands.registerCommandListenerByName("WPreviewCommands.WEditModeChanged",this,this._onModeChange),this.resources.W.Commands.registerCommandListenerByName("WPreviewCommands.ViewerStateChanged",this,this._onViewerModeChange),this.resources.W.Commands.registerCommandAndListener("WViewerCommands.StopAllOtherAudios",this,this._stopAllOtherAudios)},_createAudioObject:function(a){return a.createSound({id:this.getComponentUniqueId(),url:this._soundUtils.getAudioFullUrl(this._data.get("uri"))})},_createAudio:function(){return this._soundUtils.waitForApiReady().then(function(a){return this._audio=this._createAudioObject(a),Q(this._audio)}.bind(this))},_removeProtocol:function(a){var b=a;if(void 0!==a)return 0===b.indexOf("http://")&&(b=b.substr(5)),0===b.indexOf("https://")&&(b=b.substr(6)),b},_setVolume:function(a){var b=a.value||100;this._audio.volume=b/100},_onDataChange:function(a){this.parent(a),this._stop()},_soundManagerReady:function(){this.$class._audioManagerWasLoaded=!0,this.$class._soundManagerReadyCallbacks&&this.$class._soundManagerReadyCallbacks.forEach(function(a){a()})},onPageVisibilityChange:function(a){W.Config.env.isInInteractiveViewer()&&W.Config.env.isViewingDesktopDevice()&&(a||"playing"!==this.getState()?a&&this._data.get("autoPlay")&&"playing"!==this.getState()&&this._play():this._pause())},isPartiallyFunctionalInStaticHtml:function(){return!0},dispose:function(){this.parent(),this.resources.W.Commands.unregisterListener(this._onModeChange),this.resources.W.Commands.unregisterListener(this._onViewerModeChange),this.resources.W.Viewer.removeEvent("pageTransitionStarted",this._onPageTransitionStarted)},_mediaGalleryCallback:function(a){this.getDataItem().setFields({uri:a.fileName}),this._createAudioPlayer().done()}})}),define.component("wysiwyg.viewer.components.BgImageStrip",function(a){var b=a;b.inherits("core.components.base.BaseComp"),b.resources(["W.Config","W.Viewer","topology"]),b.dataTypes(["Image"]),b.binds(["_mediaGalleryCallback"]),b.skinParts({bg:{type:"htmlElement"}}),b.propertiesSchemaType("BgImageStripProperties"),b.fields({EDITOR_META_DATA:{general:{settings:!0,design:!0},custom:[{label:"BG_STRIP_CHANGE",command:"WEditorCommands.OpenMediaFrame",commandParameter:{galleryConfigID:"backgrounds",publicMediaFile:"backgrounds",i18nPrefix:"background",selectionType:"single",mediaType:"picture",callback:"_mediaGalleryCallback",startingTab:"free"},commandParameterDataRef:"SELF"}],dblClick:{command:"WEditorCommands.OpenMediaFrame",commandParameter:{galleryConfigID:"backgrounds",publicMediaFile:"backgrounds",i18nPrefix:"background",selectionType:"single",mediaType:"picture",callback:"_mediaGalleryCallback",startingTab:"free"},commandParameterDataRef:"SELF"},mobile:{allInputsHidden:!0}}}),b.methods({initialize:function(a,b,c){var d;this.parent(a,b,c),this._baseUrl=this.resources.W.Config.getServiceTopologyProperty("staticMediaUrl")+"/",this._isPrimeRender=!0,this._docWidth=W.Viewer.getDocWidth(),this._resizableSides=[Constants.BaseComponent.ResizeSides.TOP,Constants.BaseComponent.ResizeSides.BOTTOM],d=_.findIndex(this.EDITOR_META_DATA.custom,function(a){return"WEditorCommands.OpenMediaFrame"===a.command}),this.EDITOR_META_DATA.custom[d].commandParameter.startingTab="free",this.EDITOR_META_DATA.dblClick.commandParameter.startingTab="free"},_mediaGalleryCallback:function(a){this.getDataItem().setFields({uri:a.fileName})},_onRender:function(a){return this._isPrimeRender?(this._fixWidth(),this._setBgDefaults(),this._setBgImage(),this._isPrimeRender=!1,void 0):(this.isRendered()&&(a.data.invalidations.isInvalidated([this.INVALIDATIONS.WIDTH_REQUEST])&&this._fixWidth(),a.data.invalidations.isInvalidated([this.INVALIDATIONS.SKIN_CHANGE])&&(this._setBgDefaults(),this._setBgImage()),a.data.invalidations.isInvalidated([this.INVALIDATIONS.DATA_CHANGE])&&this._setBg(a.data.invalidations._invalidations.dataChange)),void 0)},_fixWidth:function(){var a,b;this.resources.W.Config.env.isViewingSecondaryDevice()?(a=this._docWidth,b=0):(a=document.body.clientWidth,b=this._getDiff()),a!==this.getWidth()&&this.setWidth(a),this.$view.style.width=a+"px",this.$view.style.left=b+"px"},_setBgDefaults:function(){this._skinParts.bg.style.backgroundPosition=this.getComponentProperty("bgPosition"),this._skinParts.bg.style.backgroundRepeat=this.getComponentProperty("bgRepeat"),this._skinParts.bg.style.backgroundSize=this.getComponentProperty("bgSize")},_setBgImage:function(){return this._isFakeOrEmptyUri()?(this._skinParts.bg.style.backgroundImage="",this._data.set("uri",this.resources.topology.skins+"/images/wysiwyg/core/themes/editor_web/add_image_thumb.png"),this.EDITOR_META_DATA.mobile.allInputsHidden=!0,void 0):(this.EDITOR_META_DATA.mobile.allInputsHidden=!1,this._skinParts.bg.style.backgroundImage="url("+this._baseUrl+this._data.get("uri")+")",void 0)},_setBg:function(a){_.each(a,function(a){"Image"===a.dataItem._dataType?this._setBgImage():this._setBgDefaults()},this)},_getDiff:function(){var a=(this._docWidth-document.body.clientWidth)/2;return a>=0?0:a},_isFakeOrEmptyUri:function(){var a=this._data.get("uri");return!a||""===a||/add_image_thumb\.png$/i.test(a)},isContainer:function(){return!1},isContainable:function(a){return a.isSiteSegment()},getSelectableX:function(){return this.resources.W.Config.env.isViewingSecondaryDevice()?0:this._getDiff()},getX:function(){return 0},setX:function(){}})}),define.component("wysiwyg.viewer.components.ClipArt",function(a){var b=a;b.binds(["_mediaGalleryCallback"]),b.inherits("wysiwyg.viewer.components.WPhoto"),b.skinParts({link:{type:"htmlElement"},img:{type:"core.components.image.ImageNew",dataRefField:"*"}}),b.propertiesSchemaType("WPhotoProperties"),b.dataTypes(["Image"]),b.fields({EDITOR_META_DATA:{general:{settings:!0,design:!1},custom:[{label:"CLIP_ART_REPLACE_IMAGE",command:"WEditorCommands.OpenMediaFrame",commandParameter:{galleryConfigID:"clipart",publicMediaFile:"clipart",i18nPrefix:"clipart",selectionType:"single",mediaType:"picture",callback:"_mediaGalleryCallback",startingTab:"free"}},{label:"LINK_LINK_TO",command:"WEditorCommands.OpenLinkDialogCommand",commandParameter:{position:"center"},commandParameterDataRef:"SELF"}],dblClick:{command:"WEditorCommands.OpenMediaFrame",commandParameter:{galleryConfigID:"clipart",publicMediaFile:"clipart",i18nPrefix:"clipart",selectionType:"single",mediaType:"picture",callback:"_mediaGalleryCallback",startingTab:"free"}},mobile:{previewImageDataRefField:"*",allInputsHidden:!0}}}),b.methods({_mediaGalleryCallback:function(a){this.getDataItem().setFields({title:"",description:a.description||"",height:a.height,width:a.width,uri:a.fileName})},_setTitle:function(){this.getDataItem().set("title","",!0)}})}),define.component("wysiwyg.viewer.components.ContactForm",function(a){var b=a;b.inherits("core.components.base.BaseComp"),b.resources(["W.Config","W.Viewer","W.Commands","W.Utils","W.Resources"]),b.dataTypes(["ContactForm"]),b.propertiesSchemaType("ContactFormProperties"),b.traits(["wysiwyg.viewer.components.traits.ContactFormUtils"]),b.utilize(["core.managers.serverfacade.WixRESTClient"]),b.binds(["_onSubmit","_preventKeyTranslation","_canKeyBeTranslated"]),b.skinParts({wrapper:{type:"htmlElement"},name:{type:"htmlElement"},subject:{type:"htmlElement"},message:{type:"htmlElement"},phone:{type:"htmlElement"},email:{type:"htmlElement"},address:{type:"htmlElement"},label_name:{type:"htmlElement",optional:!0},label_subject:{type:"htmlElement",optional:!0},label_message:{type:"htmlElement",optional:!0},label_phone:{type:"htmlElement",optional:!0},label_email:{type:"htmlElement",optional:!0},label_address:{type:"htmlElement",optional:!0},notifications:{type:"htmlElement"},submit:{type:"htmlElement"}}),b.statics({langKeys:{en:{CFORM_ERRORS_404:"service not found 404",CFORM_ERRORS_main:"an error has occurred",CFORM_ERRORS_noOwner:"Owner email address not set",CFORM_ERRORS_timeOut:"request timeout",CFORM_eMAIL_date:"Sent on:",CFORM_eMAIL_details:"Message Details: ",CFORM_eMAIL_title:"You have a new message: ",CFORM_eMAIL_tnx:"Thank you for using Wix.com!",CFORM_eMAIL_via:"Via: ",CFORM_user_errorMessage:"Please provide a valid email",CFORM_user_validationErrorMessage:"Please fill in all required fields.",CFORM_user_submitButtonLabel:"Send",CFORM_user_successMessage:"Your details were sent successfully!",CFORM_FIELDS_name:"Name",CFORM_FIELDS_email:"Email",CFORM_FIELDS_phone:"Phone",CFORM_FIELDS_subject:"Subject",CFORM_FIELDS_message:"Message",CFORM_FIELDS_address:"Address"},es:{CFORM_ERRORS_404:"sevicio no encontrado 404",CFORM_ERRORS_main:"ha ocurrido un error",CFORM_ERRORS_noOwner:"Email del propietario no est configurado",CFORM_ERRORS_timeOut:"tiempo expirado",CFORM_eMAIL_date:"Enviado:",CFORM_eMAIL_details:"Detalles del Mensaje: ",CFORM_eMAIL_title:"Tienes un mensaje nuevo: ",CFORM_eMAIL_tnx:"Gracias por usar Wix.com!",CFORM_eMAIL_via:"Va: ",CFORM_user_errorMessage:"Por favor introduce un email vlido ",CFORM_user_validationErrorMessage:"Por favor rellena todos los campos obligatorios. ",CFORM_user_submitButtonLabel:"Enviar",CFORM_user_successMessage:"Tus datos se enviaron con xito!",CFORM_FIELDS_name:"Nombre",CFORM_FIELDS_phone:"Telfono",CFORM_FIELDS_subject:"Asunto",CFORM_FIELDS_email:"Email",CFORM_FIELDS_message:"Mensaje",CFORM_FIELDS_address:"Direccin"},de:{CFORM_ERRORS_404:"Dienst nicht gefunden 404",CFORM_ERRORS_main:"Ein Fehler ist aufgetreten",CFORM_ERRORS_noOwner:"E-Mail-Adresse des Eigentmers nicht festgelegt",CFORM_ERRORS_timeOut:"Anfrage abgelaufen",CFORM_eMAIL_date:"Gesendet am:",CFORM_eMAIL_details:"Nachrichtendetails: ",CFORM_eMAIL_title:"Sie haben eine neue Nachricht: ",CFORM_eMAIL_tnx:"Danke, dass Sie Wix.com verwenden!",CFORM_eMAIL_via:"ber: ",CFORM_user_errorMessage:"Bitte geben Sie eine gltige E-Mail-Adresse ein",CFORM_user_validationErrorMessage:"Bitte fllen Sie alle erforderlichen Felder aus.",CFORM_user_submitButtonLabel:"Senden",CFORM_user_successMessage:"Ihre Angaben wurden erfolgreich versandt!",CFORM_FIELDS_name:"Name",CFORM_FIELDS_phone:"Telefon",CFORM_FIELDS_subject:"Betreff",CFORM_FIELDS_email:"Email",CFORM_FIELDS_message:"Nachricht",CFORM_FIELDS_address:"Adresse"},fr:{CFORM_ERRORS_404:"service non trouv 404",CFORM_ERRORS_main:"une erreur s'est produite",CFORM_ERRORS_noOwner:"Adresse email du propritaire non dfini",CFORM_ERRORS_timeOut:"dlai expir",CFORM_eMAIL_date:"Envoy le:",CFORM_eMAIL_details:"Dtails du message: ",CFORM_eMAIL_title:"Vous avez un nouveau message: ",CFORM_eMAIL_tnx:"Merci d'avoir utilis Wix.com!",CFORM_eMAIL_via:"Via: ",CFORM_user_errorMessage:"Veuillez saisir un email valide",CFORM_user_validationErrorMessage:"Veuillez remplir tous les champs requis.",CFORM_user_submitButtonLabel:"Envoyer",CFORM_user_successMessage:"Vos informations ont bien t envoyes !",CFORM_FIELDS_name:"Nom",CFORM_FIELDS_phone:"Tlphone",CFORM_FIELDS_subject:"Sujet",CFORM_FIELDS_email:"Email",CFORM_FIELDS_message:"Message",CFORM_FIELDS_address:"Adresse"},it:{CFORM_ERRORS_404:"servizio non trovato 404",CFORM_ERRORS_main:"si  verificato un errore",CFORM_ERRORS_noOwner:"Indirizzo email del proprietario non impostato",CFORM_ERRORS_timeOut:"tempo scaduto",CFORM_eMAIL_date:"Inviato il:",CFORM_eMAIL_details:"Dettagli del Messaggio: ",CFORM_eMAIL_title:"Hai un nuovo messaggio: ",CFORM_eMAIL_tnx:"Grazie per aver utilizzato Wix.com!",CFORM_eMAIL_via:"Via: ",CFORM_user_errorMessage:"Please provide a valid email",CFORM_user_validationErrorMessage:"Please fill in all required fields.",CFORM_user_submitButtonLabel:"Send",CFORM_user_successMessage:"Your details were sent successfully!",CFORM_FIELDS_name:"Nome",CFORM_FIELDS_phone:"Telefono",CFORM_FIELDS_subject:"Oggetto",CFORM_FIELDS_email:"Email",CFORM_FIELDS_message:"Messaggio",CFORM_FIELDS_address:"Indirizzo"},ja:{CFORM_ERRORS_404:"404",CFORM_ERRORS_main:"",CFORM_ERRORS_noOwner:"",CFORM_ERRORS_timeOut:"",CFORM_eMAIL_date:"",CFORM_eMAIL_details:" ",CFORM_eMAIL_title:" ",CFORM_eMAIL_tnx:"Wix.com",CFORM_eMAIL_via:" ",CFORM_user_errorMessage:"Please provide a valid email",CFORM_user_validationErrorMessage:"Please fill in all required fields.",CFORM_user_submitButtonLabel:"Send",CFORM_user_successMessage:"Your details were sent successfully!",CFORM_FIELDS_name:"",CFORM_FIELDS_phone:"",CFORM_FIELDS_subject:"",CFORM_FIELDS_email:"Email",CFORM_FIELDS_message:"",CFORM_FIELDS_address:""},ko:{CFORM_ERRORS_404:" 404-    .",CFORM_ERRORS_main:" .",CFORM_ERRORS_noOwner:"    .",CFORM_ERRORS_timeOut:" ",CFORM_eMAIL_date:":",CFORM_eMAIL_details:" : ",CFORM_eMAIL_title:"  : ",CFORM_eMAIL_tnx:"Wix.com   !",CFORM_eMAIL_via:" : ",CFORM_user_errorMessage:"Please provide a valid email",CFORM_user_validationErrorMessage:"Please fill in all required fields.",CFORM_user_submitButtonLabel:"Send",CFORM_user_successMessage:"Your details were sent successfully!",CFORM_FIELDS_name:"",CFORM_FIELDS_phone:"",CFORM_FIELDS_subject:"",CFORM_FIELDS_email:"Email",CFORM_FIELDS_message:"",CFORM_FIELDS_address:""},pl:{CFORM_ERRORS_404:"bd usugi 404",CFORM_ERRORS_main:"wystpi bd",CFORM_ERRORS_noOwner:"Email waciciela nie skonfigurowany",CFORM_ERRORS_timeOut:"wyganicie proby",CFORM_eMAIL_date:"Wysana dnia:",CFORM_eMAIL_details:"Szczegy Wiadomoci: ",CFORM_eMAIL_title:"Otrzymae now wiadomo: ",CFORM_eMAIL_tnx:"Dzikujemy za korzystanie z Wix.com!",CFORM_eMAIL_via:"Poprzez: ",CFORM_user_errorMessage:"Please provide a valid email",CFORM_user_validationErrorMessage:"Please fill in all required fields.",CFORM_user_submitButtonLabel:"Send",CFORM_user_successMessage:"Your details were sent successfully!",CFORM_FIELDS_name:"Imi",CFORM_FIELDS_phone:"Telefon",CFORM_FIELDS_subject:"Temat",CFORM_FIELDS_email:"Email",CFORM_FIELDS_message:"Wiadomo",CFORM_FIELDS_address:"Adres"},pt:{CFORM_ERRORS_404:"Servio no encontrado 404",CFORM_ERRORS_main:"ocorreu um erro",CFORM_ERRORS_noOwner:"Endereo de e-mail do proprietrio no est configurado",CFORM_ERRORS_timeOut:"tempo expirou",CFORM_eMAIL_date:"Enviado:",CFORM_eMAIL_details:"Detalhes da Mensagem: ",CFORM_eMAIL_title:"Voc tem uma nova mensagem: ",CFORM_eMAIL_tnx:"Obrigado por usar Wix.com!",CFORM_user_errorMessage:"Por favor, insira um e-mail vlido",CFORM_user_validationErrorMessage:"Por favor, preencha os campos obrigatrios.",CFORM_user_submitButtonLabel:"Enviar",CFORM_user_successMessage:"Seus detalhes foram enviados com sucesso!",CFORM_eMAIL_via:"Via: ",CFORM_FIELDS_name:"Nome",CFORM_FIELDS_phone:"Telefone",CFORM_FIELDS_subject:"Assunto",CFORM_FIELDS_email:"Email",CFORM_FIELDS_message:"Mensagem",CFORM_FIELDS_address:"Endereo"},ru:{CFORM_ERRORS_404:"   404",CFORM_ERRORS_main:" ",CFORM_ERRORS_noOwner:"   ",CFORM_ERRORS_timeOut:" ",CFORM_eMAIL_date:":",CFORM_eMAIL_details:" : ",CFORM_eMAIL_title:"   : ",CFORM_eMAIL_tnx:",    Wix.com!",CFORM_eMAIL_via:": ",CFORM_user_errorMessage:"Please provide a valid email",CFORM_user_validationErrorMessage:"Please fill in all required fields.",CFORM_user_submitButtonLabel:"Send",CFORM_user_successMessage:"Your details were sent successfully!",CFORM_FIELDS_name:"",CFORM_FIELDS_phone:"",CFORM_FIELDS_subject:"",CFORM_FIELDS_email:"Email",CFORM_FIELDS_message:"",CFORM_FIELDS_address:""},tr:{CFORM_ERRORS_404:"Hizmet bulunamad 404",CFORM_ERRORS_main:"bir hata olutu",CFORM_ERRORS_noOwner:"Sahip e-posta adresi ayarlanmad",CFORM_ERRORS_timeOut:"talep zaman am",CFORM_eMAIL_date:"Gnderim Tarihi:",CFORM_eMAIL_details:"Mesaj Bilgileri: ",CFORM_eMAIL_title:"Yeni mesajnz var: ",CFORM_eMAIL_tnx:"Wix.com'u kullandnz iin teekkr ederiz!",CFORM_eMAIL_via:"unun araclyla: ",CFORM_user_errorMessage:"Ltfen geerli bir e-posta gnderin",CFORM_user_validationErrorMessage:"Ltfen tm gerekli alanlar doldurun.",CFORM_user_submitButtonLabel:"Gnder",CFORM_user_successMessage:"Ayrntlarnz gnderildi",CFORM_FIELDS_name:"Ad",CFORM_FIELDS_phone:"Telefon",CFORM_FIELDS_subject:"Konu",CFORM_FIELDS_email:"Email",CFORM_FIELDS_message:"Mesaj",CFORM_FIELDS_address:"Adres"}},_isComponentNew:!0,_isMail:/[\w\.\-]+@[\w\.\-]+\.[\w\.\-]+/,_sizeLimits:{minW:180,minH:180,maxW:980,maxH:1024}}),b.states({dir:["left","right"],mob:["mobile","desktop"],visibility:["hidden","visible"]}),b.methods({initialize:function(a,b,c){c=c||{},this.parent(a,b,c),this._metaSiteId=null,this._resizableSides=[Constants.BaseComponent.ResizeSides.LEFT,Constants.BaseComponent.ResizeSides.RIGHT],this.EDITOR_META_DATA={general:{settings:!0,design:!0},mobile:{allInputsHidden:!0}},this._restClient=new this.imports.WixRESTClient,this._dataKeysOveriddenByUser={},this._dataKeyAllowedToTranslate={submitButtonLabel:!0,successMessage:!0,errorMessage:!0,validationErrorMessage:!0,nameFieldLabel:!0,emailFieldLabel:!0,phoneFieldLabel:!0,subjectFieldLabel:!0,messageFieldLabel:!0,addressFieldLabel:!0}},_onRender:function(a){var b,c,d,e=a.data.invalidations;return e.isInvalidated([this.INVALIDATIONS.FIRST_RENDER])&&this._firstRender(),e.isInvalidated([this.INVALIDATIONS.DATA_CHANGE])&&(d=e._invalidations.dataChange,this._handleKeyTranslations(d)),this.resources.W.Viewer.isSiteReady()?(b=this.resources.W.Config.env.isViewingSecondaryDevice(),c=this.getDataItem().get("textDirection"),this.setState(b?"mobile":"desktop","mob"),this.setState(c,"dir"),this._renderForm(),this.setHeight(this._skinParts.wrapper.clientHeight),void 0):(this.invalidate("siteNotReady"),void 0)},isPartiallyFunctionalInStaticHtml:function(){return!0},_preventKeyTranslation:function(a){this._dataKeysOveriddenByUser[a]=!0},_canKeyBeTranslated:function(a){return this._dataKeyAllowedToTranslate[a]},_isKeyOveriddenByUser:function(a){return this._dataKeysOveriddenByUser[a]},_handleKeyTranslations:function(a){var b="",c=this;a.forEach(function(a){b=a.field,c._canKeyBeTranslated(b)&&c._preventKeyTranslation(b)})},_firstRender:function(){var a=this.resources.W.Config;this._isComponentNew=this._isPreset(),this._setDictionary(a.getLanguage(),a.isPremiumUser()),this.resources.W.Config.env.$isPublicViewerFrame||(this._decryptEmails(),this._handleMissingEmail(),this._translatePlaceholdersIfComponentIsNew())},_handleMissingEmail:function(){var a,b=this.getDataItem(),c=b.get("toEmailAddress"),d=function(a,b){return a.indexOf(b)===a.length-b.length},e=function(a){return a&&d(a,"@wix.com")};c||(a=this.resources.W.Config.getUserEmail(),e(a)||(b.set("toEmailAddress",a),this.setComponentProperty("useCookie",!0)))},_setDictionary:function(a,b){var c=this.langKeys[a];this.lingo={err_404:c.CFORM_ERRORS_404,err_main:c.CFORM_ERRORS_main,err_noOwner:c.CFORM_ERRORS_noOwner,err_timeOut:c.CFORM_ERRORS_timeOut,msg_date:c.CFORM_eMAIL_date,msg_details:c.CFORM_eMAIL_details,msg_title:c.CFORM_eMAIL_title,msg_tnx:b?"Thank you!":c.CFORM_eMAIL_tnx,msg_subj:b?"New message via your website, from ":"New message via your Wix website, from ",msg_via:c.CFORM_eMAIL_via,sending:"",nameFieldLabel:c.CFORM_FIELDS_name,phoneFieldLabel:c.CFORM_FIELDS_phone,subjectFieldLabel:c.CFORM_FIELDS_subject,emailFieldLabel:c.CFORM_FIELDS_email,messageFieldLabel:c.CFORM_FIELDS_message,addressFieldLabel:c.CFORM_FIELDS_address,errorMessage:c.CFORM_user_errorMessage,submitButtonLabel:c.CFORM_user_submitButtonLabel,successMessage:c.CFORM_user_successMessage,validationErrorMessage:c.CFORM_user_validationErrorMessage}},_translatePlaceholdersIfComponentIsNew:function(){this._isComponentNew&&this._translateUserMsg()},_translateUserMsg:function(){var a=this.getDataItem();this._translateIfAllowed(a,"submitButtonLabel","Send"),this._translateIfAllowed(a,"successMessage","Your details were sent successfully!"),this._translateIfAllowed(a,"errorMessage","Please provide a valid email"),this._translateIfAllowed(a,"validationErrorMessage","Please fill in all required fields."),this._translateIfAllowed(a,"nameFieldLabel","Name"),this._translateIfAllowed(a,"emailFieldLabel","Email"),this._translateIfAllowed(a,"phoneFieldLabel","Phone"),this._translateIfAllowed(a,"subjectFieldLabel","Subject"),this._translateIfAllowed(a,"messageFieldLabel","Message"),this._translateIfAllowed(a,"addressFieldLabel","Address")},_translateIfAllowed:function(a,b,c){this._canKeyBeTranslated(b)&&!this._isKeyOveriddenByUser(b)&&a.set(b,this.lingo[b]||c)},_isPreset:function(){return this.getDataItem().getMeta("isPreset")},isRenderNeeded:function(a){return a.isInvalidated([this.INVALIDATIONS.SKIN_CHANGE,this.INVALIDATIONS.DATA_CHANGE,this.INVALIDATIONS.PART_SIZE,this.INVALIDATIONS.DISPLAY,"siteNotReady"])},_renderForm:function(){this._skinParts.submit&&this._skinParts.submit.set("text",this._data.get("submitButtonLabel")).addEvent("click",this._onSubmit);var a=_.pick(this._skinParts,this.isInput,this);_.each(a,function(a,b){this._doUpdateInput(b,a)},this),this.setState("visible")},_getInputData:function(a){var b=_.isElement(a)?a.getAttribute("skinpart")+"FieldLabel":a+"FieldLabel";return{value:this._data.get(b),displayed:this.getComponentProperty("hidden_"+b),required:this.getComponentProperty("required_"+b)}},_doUpdateInput:function(a,b){var c=b||this._skinParts[a],d=this._getInputData(a);this.setInput(c,d),this._skin.hidePlaceholders&&this.setLabel(this._skinParts["label_"+a],d)},_sendMail:function(a,b){this._restClient.post(a,b,{onSuccess:function(){this._showMessage(this._data.get("successMessage"))}.bind(this),onError:function(){this._showMessage(this.lingo.err_main,1)}.bind(this)})},_reportActivity:function(a){this.resources.W.Commands.executeCommand("WViewerCommands.Activity.Report",{name:"ContactForm",fields:a})},_onSubmit:function(){var a,b,c,d=this.getDataItem(),e=d.get("toEmailAddress"),f=d.get("bccEmailAddress");return e?(this._isValid()&&(a=this.preFormatFields(),b=this.getMsgTemplate(a.forSend,this.lingo),c=this._formatData(a.forReport,b,e,f),this._showMessage(this.lingo.sending),this._sendMail(this.getMailServerUrl(),c),this.resources.W.Config.env.$isPublicViewerFrame&&this._reportActivity(a.forReport),this._cleanForm()),void 0):(this._showMessage(this.lingo.err_noOwner,!0),void 0)},_formatData:function(a,b,c,d){var e=function(b){var c=a[b];return c?c:"n/a"};return{to:[{address:c||"n/a",personal:c||"n/a"}],bcc:d?[{address:d||"n/a",personal:d||"n/a"}]:[],cc:[],from:{address:e("email"),personal:e("name")},subject:this.lingo.msg_subj+e("email"),metaSiteId:rendererModel.metaSiteId||"dc853130-4fb2-464f-878d-3b6667dc4f97",htmlMessage:b,plainTextMessage:e("message")}},_showMessage:function(a,b){this._skinParts.notifications.set("text",a),this._skinParts.notifications.className=b?"error":"success"},_cleanForm:function(){var a=this.needsPoly();_.each(this._skinParts,function(b){this.isInput(b)&&($(b).removeClass("error"),b.value="",a&&b.focus())},this)},_isValid:function(){var a,b=!0;return this._isMail.test(this._skinParts.email.value.replace(/^\s+|\s+$/g,""))?($(this._skinParts.email).removeClass("error"),a=_.pick(this._skinParts,this.getEmptyInputs,this),_.isEmpty(a)?_.each(this._skinParts,function(a){$(a).removeClass("error")}):(b=!1,_.each(a,function(a){$(a).addClass("error")}),this._showMessage(this._data.get("validationErrorMessage"),1)),b):($(this._skinParts.email).addClass("error"),this._showMessage(this._data.get("errorMessage"),1),!b)},_decryptEmails:function(){var a=this._getServiceBaseUrl(),b=W.Config.getSiteId();this.serviceBaseUrl=a.replace("{{siteId}}",b);var c=["toEmailAddress","bccEmailAddress"];_.forEach(c,function(a){var b=this._data.get(a);this._isEmpty(b)||this._isDecryptedEmail(b)||this._doDecryptRequest(a,b)},this)},_doDecryptRequest:function(a,b){var c={},d=this.serviceBaseUrl.replace("{{mail}}",b),e={onSuccess:this._getSuccessCallback(a),onError:this._getErrorCallback(a)};this._restClient.get(d,c,e)},_getSuccessCallback:function(a){return function(b){b.email?this._data.set(a,b.email):this._sendError(a,"Server returned success but no email field in response")}.bind(this)},_getErrorCallback:function(a){return function(b){this._data.set(a,""),this._sendError(a,b)}.bind(this)},_getServiceBaseUrl:function(){var a=window.location.protocol+"//"+window.location.host,b="/html/email/decrypt/{{mail}}/{{siteId}}";return a+b},_sendError:function(a,b){var c={dataFieldName:a,originalMail:this._data.get(a),errorMsg:b};LOG.reportError(wixErrors.CONTACT_FORM_EMAIL_DECRYPT_FAILURE,"wysiwyg.viewer.components.ContactForm","_sendError",JSON.stringify(c))},_isEmpty:function(a){return!a},_isDecryptedEmail:function(a){return a.match(/^(([a-zA-Z0-9_\.\-\+])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+|\s*)$/)?!0:!1}})}),define.component("wysiwyg.viewer.components.Displayer",function(a){var b=a;b.inherits("mobile.core.components.base.BaseComponent"),b.skinParts({image:{type:"core.components.Image",dataRefField:"*",optional:!1},imageWrapper:{type:"htmlElement",optional:!1},title:{type:"htmlElement",optional:!1},description:{type:"htmlElement",optional:!1},zoom:{type:"htmlElement",optional:!0},link:{type:"htmlElement",optional:!1},rolloverHitArea:{type:"htmlElement",optional:!0}}),b.binds(["_onMouseOver","_onMouseOut","_onZoomClick","_onImageStateChange"]),b.utilize(["wysiwyg.common.utils.LinkRenderer"]),b.traits(["wysiwyg.common.components.traits.SelectableOption"]),b.states({general:["loading","normal","rollover"],transitionPhase:["noTransition","transIn","transOut"],linkableComponent:["link","noLink"],selectState:["selected","unselected"],displayDevice:["mobileView"],textAlignmentState:["alignLeft","alignCenter","alignRight"],scaling:["clipImage","flexibleHeight","flexibleWidth","flexibleWidthFixed"]}),b.dataTypes(["Image"]),b.resources(["W.Config","W.Data"]),b.fields({_renderTriggers:[Constants.DisplayEvents.SKIN_CHANGE],_parentList:null,_owner:null,_expandEnabled:!0,_debugMode:!1,_lastSetSizeParams:null,_heightDiff:-1}),b.methods({initialize:function(a,b,c){this._NO_LINK_PROPAGATION=!0,b.setStyle("visibility","hidden"),this.parent(a,b,c),this.resources.W.Config.env.getCurrentFrameDevice()===Constants.ViewerTypesParams.TYPES.MOBILE&&this.setState("mobileView","displayDevice"),this._linkRenderer=new this.imports.LinkRenderer},render:function(){this._refreshImage(),this.parent(),this._renderLink()},setOwner:function(a){if(this.removeOldOwner(),a&&(this._owner=a,this._ownerProps=this._owner.getComponentProperties(),this._parentList=this._owner.getDataItem(),this._ownerProps.on(Constants.DataEvents.DATA_CHANGED,this,this._onOwnerPropsChanged),this._onOwnerPropsChanged()),this._debugMode){var b=this._data.get("id"),c=this._parentList.getData().items.indexOf("#"+b),d=new Element("div");this._debugMode=!1,d.set("text",String(c)),d.setStyles({position:"relative",top:"-20px"}),this.getViewNode().adopt(d)}},removeOldOwner:function(){this._ownerProps&&this._ownerProps.offByListener(this)},_onOwnerPropsChanged:function(){this._isDisposed||this._owner&&this._owner._isDisposed||(this._galleryImageOnClickAction=this._owner.getComponentProperties().hasField("galleryImageOnClickAction")?this._owner.getComponentProperty("galleryImageOnClickAction"):this._owner.getComponentProperty("expandEnabled")===!0?"zoomMode":"disabled",this._updateLinkText(),this._isImageClickable()||-1==this.getState().indexOf("rollover")||this.setState("rollover","general"),this._updateParts(),this._setTextAlignment())},_updateLinkText:function(){var a=this._skinParts.link,b=a.getChildren();b.length||this._skinParts.link.set("text",this._owner.getComponentProperty("goToLinkText"))},_setTextAlignment:function(){var a=this._owner.getComponentProperties(),b=a.get("alignText");if(b)switch(b){case"left":this.setState("alignLeft","textAlignmentState");break;case"center":this.setState("alignCenter","textAlignmentState");break;case"right":this.setState("alignRight","textAlignmentState");break;default:this.setState("alignLeft","textAlignmentState")}},setParentList:function(a){this._parentList=a},_setupParts:function(){var a=this._skinParts.rollOverHitArea||this._view,b=this._skinParts.zoom||this._skinParts.imageWrapper;this._skinParts.image.addEvent("stateChange",this._onImageStateChange),b.addEvent(Constants.CoreEvents.CLICK,this._onZoomClick),a.addEvent(Constants.CoreEvents.MOUSE_OVER,this._onMouseOver),a.addEvent(Constants.CoreEvents.MOUSE_OUT,this._onMouseOut);var c={overflow:"hidden","text-overflow":"ellipsis"};this._skinParts.title.setStyles(c),this._skinParts.description.setStyles(c)},_updateParts:function(){if(this._skinParts){this._skinParts.image.getDataItem&&this._data&&this._data!==this._skinParts.image.getDataItem()&&this._skinParts.image.setDataItem(this._data),this._skinParts.title.set("text",this._data.get("title")),this._skinParts.description.set("text",this._data.get("description"));var a=this._skinParts.zoom||this._skinParts.imageWrapper;a.setStyle("cursor",this._isImageClickable()?"pointer":"default");var b="mobileView"===this.getState("displayDevice");"goToLink"===this._galleryImageOnClickAction||!this._isImageLinked()||b?this._skinParts.link.setStyle("display","none"):this._skinParts.link.setStyle("display","block")}},_onImageStateChange:function(a){switch(a.newState){case"loading":this.setState("loading","general");break;case"loaded":this.setState("normal","general")}},_onMouseOver:function(){this._isImageClickable()&&-1!=this.getState().indexOf("normal")&&this.setState("rollover","general")},_onMouseOut:function(){this._isImageClickable()&&-1!=this.getState().indexOf("rollover")&&this.setState("normal","general")
},zoom:function(){var a=this._data.get("id"),b=this._parentList.getData().items.indexOf("#"+a);this.injects().Commands.executeCommand("WViewerCommands.OpenZoom",{itemsList:this._parentList,currentIndex:b,getDisplayerDivFunction:this.injects().Viewer.getDefaultGetZoomDisplayerFunction("Image"),getHashPartsFunction:this.injects().Viewer.getDefaultGetHashPartsFunction("Image")})},goToLink:function(){if(this._skinParts.link.click)this._skinParts.link.click();else{var a=document.createEvent("HTMLEvents");a.initEvent("click",!0,!0),this._skinParts.link.dispatchEvent(a)}},_onZoomClick:function(a){a.rightClick===!1&&("zoomMode"==this._galleryImageOnClickAction?this.zoom():"goToLink"==this._galleryImageOnClickAction&&this.goToLink())},setSize:function(a,b,c){var d,e;if(this.setState(c||"clipImage","scaling"),!this._lastSetSizeParams||this._lastSetSizeParams[0]!==a||this._lastSetSizeParams[1]!==b||this._lastSetSizeParams[2]!==c)if(this._componentReady&&this._skinParts){switch(this._skinParts.image.checkVisibility(),d=this.getWidthDiff()||0,e=this.getHeightDiff()||0,c=c||"clipImage"){case"clipImage":this._clipImage(a,b,d,e);break;case"flexibleHeight":this._setFlexibleHeight(a,b,d,e);break;case"flexibleWidth":this._setFlexibleWidth(a,b,d,e,!0);break;case"flexibleWidthFixed":this._setFlexibleWidth(a,b,d,e,!1)}this._refreshImage(),this._lastSetSizeParams=[arguments[0],arguments[1],arguments[2]]}else this.addEvent(Constants.ComponentEvents.READY,function(){this.setSize(a,b,c)}.bind(this))},invalidateSize:function(){this._lastSetSizeParams=null},getWidthDiff:function(){return"mobileView"===this.getState("displayDevice")&&_.isNumber(this._skin.m_widthDiff)?this._skin.m_widthDiff:this._skin.widthDiff||0},getHeightDiff:function(){var a=this.getSkin(),b=0,c=a&&a.getParamValue("imgHeightDiff"),d=a&&a.getParamValue("topPadding");if(this._skin&&(c||d))c&&(b=c._amount),d&&(b+=d._amount);else if("mobileView"===this.getState("displayDevice")){if(!_.isNumber(this._skin.m_heightDiff))return this._skin.heightDiff||0;b=this._skin.m_heightDiff}else b=this._skin.heightDiff||0;return this._heightDiff=b,b},getOldHeightDiff:function(){return this._heightDiff},_refreshImage:function(){this._componentReady&&(this._skinParts.image._invalidate("size"),this._skinParts.image._renderIfReady())},_clipImage:function(a,b,c,d){c=this.getWidthDiff()||0,d=this.getHeightDiff()||0;var e=a-c,f=b-d;this._setWrapperSize(e,f),this._setDisplayerSize(a,b)},_setFlexibleHeight:function(a,b,c,d){c=this.getWidthDiff()||0,d=this.getHeightDiff()||0;var e=a-c,f=Math.floor(e/this._getAspectRatio());this._setWrapperSize(e,f-d),this._setDisplayerSize(a,f)},_setFlexibleWidth:function(a,b,c,d,e){c=this.getWidthDiff()||0,d=this.getHeightDiff()||0;var f,g=0,h=0,i=b-d,j=i*this._getAspectRatio();!e&&j>a-c&&(f=(a-c)/j,j=a-c,i=f*i),e||(g=Math.floor((a-j-c)/2),h=Math.floor(b-i-d)/2),this._view.setStyle("width",String(j+c)+"px"),this._setWrapperSize(j,i,g,h),e?this._setDisplayerSize(j,b):this._setDisplayerSize(a,b)},_getAspectRatio:function(){var a=this._skinParts.image.getDataItem(),b=parseInt(a.get("width"))/parseInt(this._data.get("height"));return b},_setWrapperSize:function(a,b,c,d){c=c||0,d=d||0;var e=0>b?0:b,f=0>a?0:a;this._skinParts.imageWrapper.setStyles({width:String(f)+"px",height:String(e)+"px","margin-left":String(c)+"px","margin-right":String(c)+"px","margin-top":String(d)+"px","margin-bottom":String(d)+"px"})},_setDisplayerSize:function(a,b){this._view.setStyles({width:String(a)+"px",height:String(b)+"px"}),this.setWidth(a),this.setHeight(b),this.fireEvent("autoSized")},_onDataChange:function(){this.parent(),this._updateParts(),this._isRendered&&this._renderLink()},_onAllSkinPartsReady:function(){this.parent(),this._view.setStyle("visibility","visible"),this._updateParts(),this._setupParts()},_renderLink:function(){var a=this.getDataItem(),b=a._data.link;if(!b)return this._linkRenderer.removeRenderedLinkFrom(this._skinParts.link,this),void 0;var c=this.resources.W.Data.getDataByQuery(b);c&&this._linkRenderer.renderLink(this._skinParts.link,c,this)},_onResize:function(){this.parent(),this._refreshImage()},getImageRef:function(){var a="";return this._skinParts&&(a=String(this._skinParts.image.getDataItem().get("id"))),a},isImageLoading:function(){var a=!1;return this._componentReady&&(a=-1!=this._skinParts.image.getState().indexOf("loading")),a},dispose:function(){this.removeOldOwner(),this.parent()},_isImageLinked:function(){var a=this.getDataItem().get("link");return!!a},_isImageClickable:function(){return"goToLink"===this._galleryImageOnClickAction?this._isImageLinked():"disabled"!==this._galleryImageOnClickAction},setSelected:function(a){this.setState(a?"selected":"unselected","selectState")}})}),define.component("wysiwyg.viewer.components.documentmedia.DocumentMedia",function(a){var b=a;b.inherits("wysiwyg.viewer.components.WPhoto"),b.resources(["topology"]),b.skinParts({link:{type:"htmlElement"},label:{type:"htmlElement"},img:{type:"core.components.image.ImageNew",dataRefField:"*"}}),b.binds(["documentGalleryCallback","mediaGalleryCallback"]),b.propertiesSchemaType("DocumentMediaProperties"),b.dataTypes(["Image"]),b.methods({initialize:function(a,b,c){var d=function(a){var b={command:"WEditorCommands.OpenMediaFrame",commandParameter:{galleryConfigID:"documents",publicMediaFile:"file_icons",i18nPrefix:"document",selectionType:"single",mediaType:"document",callback:"documentGalleryCallback"}};return a&&(b.label=a),b};this.parent(a,b,c),this.EDITOR_META_DATA={general:{settings:!0,design:!1},custom:[d("CHOOSE_DOCUMENT"),{label:"LINK_TO_ICON",command:"WEditorCommands.OpenMediaFrame",commandParameter:{galleryConfigID:"photos",publicMediaFile:"file_icons",i18nPrefix:"single_icon",selectionType:"single",mediaType:"picture",callback:"mediaGalleryCallback",startingTab:"free"}}],dblClick:d()}},_setDefaultImage:function(){this.getDataItem().set("uri",this.resources.topology.skins+"/images/wysiwyg/core/themes/editor_web/add_image_thumb.png")},_onRender:function(a){this.parent(a);var b=a.data.invalidations;b.isInvalidated([this.INVALIDATIONS.FIRST_RENDER])&&(""===this.getDataItem().get("uri")&&this._setDefaultImage(),this.setComponentProperty("displayMode","full",!0)),this._setLabelAccordingToData(),this.setMinW(this._skinParts.label.$measure.width),this.getViewNode().setStyle("width",this._skinParts.label.$measure.width),this._setLineHeight(),this._toggleTitleDisplay()},_setLineHeight:function(){var a=this._skinParts.img.getViewNode();a.setStyle("line-height",a.getStyle("height"))},_setLabelAccordingToData:function(){var a=this.getDataItem().get("title");this._skinParts.label.set("html",a)},_toggleTitleDisplay:function(){var a=this._skinParts.label;a.setStyle("display",this.getComponentProperty("showTitle")?"inline-block":"none")},_updateFramePadding:function(){var a=this.getSkin();this._framePadding={x:parseInt(a.getParamValue("contentPaddingLeft")._amount,10)+parseInt(a.getParamValue("contentPaddingRight")._amount,10),y:parseInt(a.getParamValue("contentPaddingTop")._amount,10)+parseInt(this._skinParts.label.getHeight(),10)}},_getImageCropMode:function(){return"full"},documentGalleryCallback:function(a){var b=this._getThumbnailUri(a.thumbnailUrl),c=this._createDocumentLinkDataItem(a.title,a.uri),d=this._createCompDataItemObj("#"+c.get("id"),b,a.title);this.getDataItem().setFields(d)},_createCompDataItemObj:function(a,b,c){return{link:a,title:c,uri:b,width:60,height:60}},_createDocumentLinkDataItem:function(a,b){var c=this.resources.W.Data.createDataItem({type:"DocumentLink",docId:b,name:a}),d=this._getViewerDataManager();return d.addDataItemWithUniqueId("",c.getData()).dataObject},_getViewerDataManager:function(){return W.Config.env.$isEditorFrame?W.Preview.getPreviewManagers().Data:this.resources.W.Data},mediaGalleryCallback:function(a){this.getDataItem().setFields(this._createImageObject(a.description||"",a.height,a.width,a.fileName))},_getThumbnailUri:function(a){var b=a.split("/");return b[b.length-2]+"/"+b[b.length-1]},_createDocumentObject:function(a,b,c){return{title:a,text:a,linkType:"DOCUMENT",href:c,target:"_blank",uri:b}},_createImageObject:function(a,b,c,d){return{description:a,height:b,width:c,uri:d}},setWidth:function(a){this.setMinW(a),this.parent(a)}})}),define.component("wysiwyg.viewer.components.EbayItemsBySeller",function(a){var b=a;b.inherits("mobile.core.components.base.BaseComponent"),b.skinParts({iFrameHolder:{type:"htmlElement"}}),b.propertiesSchemaType("EbayItemsBySellerProperties"),b.binds(["_applyThemeColors"]),b.states(["hasContent","noContent"]),b.dataTypes(["EbayItemsBySeller"]),b.fields({EDITOR_META_DATA:{general:{settings:!0,design:!0}},_renderTriggers:[Constants.DisplayEvents.MOVED_IN_DOM,Constants.DisplayEvents.ADDED_TO_DOM,Constants.DisplayEvents.DISPLAYED,Constants.DisplayEvents.DISPLAY_CHANGED]}),b.methods({initialize:function(a,b,c){c=c||{},this.parent(a,b,c),this.addEvent("resizeEnd",this._onResizeEnd),this._iframe=null},options:{width:0,height:0,url:""},render:function(){var a=this._data.get("sellerId");if(this.setState(a?"hasContent":"noContent"),a){var b=this._createUrl(a,this._data.get("registrationSite"),this._prepareOptions()),c=this._createIFrame(b.width,b.height);this.injects().Utils.prepareIFrameForWrite(c,function(a,c){c.write('<html><body style="margin:0px;"><div><script type="text/javascript" src="'+b.url+'"></script></div></body></html>'),a.setStyles({height:b.height,width:b.width})})}},isInvisibleInStaticHtml:function(){return!0},_onStyleReady:function(){this.parent(),this._style.addEvent(Constants.StyleEvents.PROPERTY_CHANGED,this._applyThemeColors)},dispose:function(){this._style.removeEvent(Constants.StyleEvents.PROPERTY_CHANGED,this._applyThemeColors),this.parent()},_applyThemeColors:function(a){var b=["fontColor","borderColor","headerColor","backgroundColor","linkColor"];for(var c in a.properties)if(b.indexOf(c)>-1)return this._renderIfReady(),void 0},_onResizeEnd:function(){this._renderIfReady()},_prepareOptions:function(){var a=this.injects().Skins,b=this._skin.className,c=a.getSkinParamValue(b,"fontColor",this._style).getHex(!1),d=a.getSkinParamValue(b,"borderColor",this._style).getHex(!1),e=a.getSkinParamValue(b,"headerColor",this._style).getHex(!1),f=a.getSkinParamValue(b,"backgroundColor",this._style).getHex(!1),g=a.getSkinParamValue(b,"linkColor",this._style).getHex(!1);return{width:this._view.getWidth(),height:this._view.getHeight(),headerImage:this.getComponentProperty("headerImage"),fontColor:c.replace("#",""),borderColor:d.replace("#",""),headerColor:e.replace("#",""),backgroundColor:f.replace("#",""),linkColor:g.replace("#","")}},_createUrl:function(a,b,c){var d=Math.floor((c.height-100)/70),e={Australia:"15",Austria:"16",Belgium_Dutch:"123",Belgium_French:"23",Canada:"2",CanadaFrench:"210",China:"223",eBayMotors:"100",France:"71",Germany:"77",HongKong:"201",India:"203",Ireland:"205",Italy:"101",Malaysia:"207",Netherlands:"146",Philippines:"211",Poland:"212",Singapore:"216",Spain:"186",Sweden:"218",Switzerland:"193",Taiwan:"196",UK:"3",US:"0",findId:function(a){var b=this[a];return b||(b=0),b}},f=this.urlCreator("http://lapi.ebay.com/ws/eBayISAPI.dll").addParam("EKServer").addParam("ai","aj|kvpqvqlvxwkl").addParam("bdrcolor",c.borderColor).addParam("fntcolor",c.fontColor).addParam("hdrcolor",c.headerColor).addParam("hdrimage",c.headerImage).addParam("lnkcolor",c.linkColor).addParam("tbgcolor",c.backgroundColor).addParam("si",a).addParam("sid",a).addParam("num",d).addParam("width",c.width).addParam("cid","0").addParam("eksize","1").addParam("encode","UTF-8").addParam("endcolor","FF0000").addParam("endtime","y").addParam("fbgcolor","FFFFFF").addParam("fs","0").addParam("hdrsrch","n").addParam("img","y").addParam("logo","6").addParam("numbid","n").addParam("paypal","n").addParam("popup","y").addParam("prvd","9").addParam("r0","3").addParam("shipcost","y").addParam("siteid",e.findId(b)).addParam("sort","MetaEndSort").addParam("sortby","endtime").addParam("sortdir","asc").addParam("srchdesc","n").addParam("title","").addParam("tlecolor","FFFFFF").addParam("tlefs","0").addParam("tlfcolor","000000").addParam("toolid","10004").addParam("track","5335838312");return c.url=f.toString(),c},_createIFrame:function(){var a=new IFrame;return a.width=this.options.width,a.height=this.options.height,this._iframe?a.replaces(this._iframe):a.insertInto(this._skinParts.iFrameHolder),this._iframe=a,a},urlCreator:function(a){return{_baseUrl:a,_params:[],addParam:function(a,b){return this._params.push({key:a,value:b}),this},toString:function(){var a=[];a.push(this._baseUrl),this._params.length>0&&a.push("?");for(var b=0;b<this._params.length;b++){var c=this._params[b];b>0&&a.push("&"),a.push(c.key),c.value&&(a.push("="),a.push(encodeURIComponent(c.value)))}return a.join("")}}}})}),define.component("wysiwyg.viewer.components.FacebookShare",function(a){var b=a;b.inherits("core.components.base.BaseComp"),b.traits(["wysiwyg.viewer.components.traits.CustomPreviewBehavior"]),b.dataTypes(["FacebookShareButton"]),b.resources(["W.Utils","W.Viewer"]),b.skinParts({facebookShareButton:{type:"htmlElement"}}),b.methods({initialize:function(a,b,c){this.parent(a,b,c),this._resizableSides=[],this.EDITOR_META_DATA={general:{settings:!0,design:!1},mobile:{allInputsHidden:!0}}},_onRender:function(a){var b,c=a.data.invalidations;c.isInvalidated([this.INVALIDATIONS.SKIN_CHANGE,this.INVALIDATIONS.DATA_CHANGE])&&(b=this._skinParts.facebookShareButton,this._createClickOverlayForPreviewMode("Social_Widgets_Only_On_Public"),this._setShareButtonLabelText(),b.addEvent("click",function(){this.resources.W.Utils.openPopupWindow(this._getUrlToBeShared(),"wix_share_to_facebook","width=635,height=346,scrollbars=no,status=no,toolbar=no,menubar=no,location=no")}.bind(this)))},_getUrlToBeShared:function(){var a=this.getDataItem(),b="Site"===a.get("urlChoice")?this.getSiteUrl():this.getCurrentPageUrl();return"http://www.facebook.com/sharer.php?u="+encodeURIComponent(b)},getSiteUrl:function(){return window.publicModel?window.publicModel.externalBaseUrl:""},getCurrentPageUrl:function(){return window.location.href},isPartiallyFunctionalInStaticHtml:function(){return!0},_setShareButtonLabelText:function(){var a=this.getDataItem().get("label");this._skinParts.label.set("html",a),""===a?(this._skinParts.label.setStyle("display","none"),this._skinParts.icon.setStyle("border-width","0")):(this._skinParts.label.setStyle("display",""),this._skinParts.icon.setStyle("border-width","1px"))}})}),define.component("wysiwyg.viewer.components.FiveGridLine",function(a){var b=a;b.inherits("core.components.base.BaseComp"),b.resources(["W.Viewer","W.Config","W.Commands"]),b.propertiesSchemaType("FiveGridLineProperties"),b.skinParts({line:{type:"htmlElement"}}),b.fields({EDITOR_META_DATA:{general:{settings:!0,design:!0},mobile:{allInputsHidden:!0}}}),b.methods({initialize:function(a,b,c){this.parent(a,b,c),this._rotatable=!0,this.setMaxW(15e3),this._resizableSides=[Constants.BaseComponent.ResizeSides.LEFT,Constants.BaseComponent.ResizeSides.RIGHT],this._setXOriginal=this.setX.bind(this),this.setWidthOriginal=this.setWidth.bind(this),this._firstInitialization=!0;var d=window.addEventListener?"addEventListener":"attachEvent",e=this.resources.W.Config.env.$viewingDevice===Constants.ViewerTypesParams.TYPES.MOBILE;window[d]("resize",function(){var a=this.resources.W.Config.env.$viewingDevice===Constants.ViewerTypesParams.TYPES.MOBILE;a==e&&this.$view&&this._fixWidth()}.bind(this))},isRenderNeeded:function(a){var b=[this.INVALIDATIONS.SKIN_CHANGE,this.INVALIDATIONS.WIDTH_REQUEST,this.INVALIDATIONS.DATA_CHANGE,this.INVALIDATIONS.FIRST_RENDER];return a.isInvalidated(b)},setWidth:function(a){this._getNumberOfKnobs();this.width=a,this.parent(a)},_onRender:function(a){var b=this._skinParts.line.$measure.height,c=a.data.invalidations,d=this.getComponentProperty("fullScreenModeOn");this.setHeight(b),this._firstInitialization&&(this._firstInitialization=!1,d&&(this._fixWidth(),this._lockLineXPosition())),this._updateEditBoxUI(),c.isInvalidated([this.INVALIDATIONS.WIDTH_REQUEST])&&this._fixWidth(),this.isContainable()},_getNumberOfKnobs:function(){var a=0;return this._skinParts&&(this._skinParts.rightKnob&&a++,this._skinParts.leftKnob&&a++,this._skinParts.middleKnob&&a++),a},_getNewPosition:function(){var a=(this.resources.W.Viewer.getDocWidth()-document.body.clientWidth)/2-1;return a>=0?0:a},_fixWidth:function(){var a=document.body.clientWidth,b=this._getNewPosition(),c=this.getComponentProperty("fullScreenModeOn"),d=this.resources.W.Config.env.$viewingDevice===Constants.ViewerTypesParams.TYPES.MOBILE;if(c){d&&(this._rotatable=!1,a=W.Viewer.getDocWidth(),b=0);var e=this.$view&&this.$view.style?this.$view.style.minWidth:"";if(a+"px"===e)return;this.setWidthOriginal(a),this._setXOriginal(b)}},isContainable:function(a){var b=this.getComponentProperty("fullScreenModeOn");if(void 0!==a){if(b&&"core.components.Container"===a.className)return!1}else if(b)return!1;return!0},_updateEditBoxUI:function(){{var a=this.getComponentProperty("fullScreenModeOn");this.resources.W.Config.env.$viewingDevice===Constants.ViewerTypesParams.TYPES.MOBILE}a?(this._rotatable=!1,this._resizableSides=[],this._moveDirections=["VERTICAL_MOVE"]):(this._unlockLineXPosition(),this._rotatable=!0,this._resizableSides=[Constants.BaseComponent.ResizeSides.LEFT,Constants.BaseComponent.ResizeSides.RIGHT],this._moveDirections=["HORIZONTAL_MOVE","VERTICAL_MOVE"]),W.Commands.executeCommand("WEditorCommands.UpdateRotatableProperties",{},this)},_lockLineXPosition:function(){this.setX=function(){},this.setWidth=function(){}},_unlockLineXPosition:function(){this.setX=this._setXOriginal,this.setWidth=this.setWidthOriginal}})}),define.component("wysiwyg.viewer.components.FlashComponent",function(a){var b=a;b.inherits("mobile.core.components.base.BaseComponent"),b.resources(["W.Utils","W.Config","W.Commands","W.Data"]),b.utilize(["wysiwyg.common.utils.LinkRenderer"]),b.binds(["_enforceDisplayMode","_mediaGalleryCallback"]),b.skinParts({flashContainer:{type:"htmlElement"},link:{type:"htmlElement",optional:!1},mouseEventCatcher:{type:"htmlElement"},noFlashImgContainer:{type:"htmlElement"},noFlashImg:{type:"core.components.Image",dataRefField:"placeHolderImage",argObject:{cropMode:"full"}}}),b.dataTypes(["LinkableFlashComponent"]),b.states({linkableComponent:["link","noLink"]}),b.propertiesSchemaType("FlashComponentProperties"),b.fields({EDITOR_META_DATA:{general:{settings:!0,design:!1,animation:!1},custom:[{label:"GENERAL_CHANGE",command:"WEditorCommands.OpenMediaFrame",commandParameter:{galleryConfigID:"flash",i18nPrefix:"flash",selectionType:"single",mediaType:"swf",callback:"_mediaGalleryCallback"}},{label:"LINK_LINK_TO",command:"WEditorCommands.OpenLinkDialogCommand",commandParameter:{position:"center"},commandParameterDataRef:"SELF"}],dblClick:{command:"WEditorCommands.OpenMediaFrame",commandParameter:{galleryConfigID:"flash",i18nPrefix:"flash",selectionType:"single",mediaType:"swf",callback:"_mediaGalleryCallback"}}}}),b.methods({initialize:function(a,b,c){this.parent(a,b,c),this._noFlashMode=!0,this._params={},this._attributes={},this._params.quality="high",this._params.bgcolor="#FAFAFA",this._params.allowscriptaccess=this._getFlashScriptAccess(),this._params.allowfullscreen="true",this._params.wMode="transparent",this._params.scale="exactFit",this._params.flashVars="",this._attributes.align="middle",this.resources.W.Commands.registerCommandListenerByName("WPreviewCommands.WEditModeChanged",this,this._onEditorModeChanged),this._linkRenderer=new this.imports.LinkRenderer},_getFlashScriptAccess:function(){return"never"},render:function(){this._createFlashEmbed(),this.parent()},_createFlashEmbed:function(a){var b=this._data.get("uri");if(b||this._uri||(this._mediaWidth=this._mediaWidth||this.getWidth(),this._mediaHeight=this._mediaHeight||this.getHeight()),a&&this._uri||b&&b!=this._uri){this._uri=b,this._mediaWidth=this._data.get("width"),this._mediaHeight=this._data.get("height");var c=this.resources.W.Config.getMediaStaticUrl(this._uri)+this._uri;this._skinParts.flashContainer.empty(),this._embedDivID=this.resources.W.Utils.getUniqueId(),this._embedDIV=new Element("DIV",{id:this._embedDivID}),this._skinParts.flashContainer.adopt(this._embedDIV),this._params.play=this.resources.W.Config.env.isInInteractiveViewer()?"true":"false",this._params.autoplay=this.resources.W.Config.env.isInInteractiveViewer()?"true":"false",this._flashObj=swfobject.embedSWF(c,this._embedDivID,"100%","100%","10.0.0","playerProductInstall.swf",null,this._params,this._attributes,function(a){a.success&&(this._noFlashMode=!1,this._skinParts.noFlashImgContainer.collapse(),this._embedCreated=!0),this._enforceDisplayMode()}.bind(this))}var d=this.getComponentProperty("displayMode");d!=this._displayMode&&(this._displayMode=d,this._enforceDisplayMode())},_onEditorModeChanged:function(){this._createFlashEmbed(!0)},_onResize:function(){this.isReady()&&this._embedCreated&&this._enforceDisplayMode()},_enforceDisplayMode:function(){var a=this._displayMode||this.getComponentProperty("displayMode");"fit"==a?this._width!=this.getWidth()?(this._width=this.getWidth(),this._height=this._width*(this._mediaHeight/this._mediaWidth)):(this._height=this.getHeight(),this._width=this._height*(this._mediaWidth/this._mediaHeight)):"stretch"===a?(this._width=this.getWidth(),this._height=this.getHeight()):(this._width=this._mediaWidth,this._height=this._mediaHeight),this.setWidth(this._width,!0,!1),this.setHeight(this._height,!0,!1),this.getViewNode().setStyles({width:this._width+"px",height:this._height+"px"}),this._noFlashMode&&this._skinParts.noFlashImg.setSize(this._width,this._height,"px"),this._wCheckForSizeChangeAndFireAutoSized(1)},_onDataChange:function(a){this.parent(),this.fireEvent("propertyChanged",a.getData().displayMode),this._isRendered&&this._renderLink()},_mediaGalleryCallback:function(a){this.getDataItem().setFields({width:a.width,height:a.height,uri:a.fileName})},_onAllSkinPartsReady:function(){this._renderLink()},_renderLink:function(){var a=this.getDataItem(),b=a._data.link;if(!b)return this._linkRenderer.removeRenderedLinkFrom(this._skinParts.link,this),void 0;var c=this.resources.W.Data.getDataByQuery(b);c&&this._linkRenderer.renderLink(this._skinParts.link,c,this)}})}),define.component("wysiwyg.viewer.components.FlickrBadgeWidget",function(a){var b=a;b.utilize(["core.utils.css.Color"]),b.inherits("mobile.core.components.base.BaseComponent"),b.skinParts({iframe:{type:"htmlElement"},overlay:{type:"htmlElement"},overlayClick:{type:"htmlElement"}}),b.binds(["_applyThemeColors","_updateIframeDimensions"]),b.states([]),b.dataTypes(["FlickrBadgeWidget"]),b.traits(["wysiwyg.viewer.components.traits.IframeUtils"]),b.fields({EDITOR_META_DATA:{general:{settings:!0,design:!1},mobile:{allInputsHidden:!0}},_renderTriggers:[Constants.DisplayEvents.MOVED_IN_DOM,Constants.DisplayEvents.ADDED_TO_DOM,Constants.DisplayEvents.DISPLAYED,Constants.DisplayEvents.DISPLAY_CHANGED,Constants.DisplayEvents.SKIN_CHANGE],_backgroundColor:void 0,_backgroundAlpha:void 0,_borderColor:void 0,_borderAlpha:void 0,_currentDimensions:{w:-1,h:-1},_totalSizeSamplingAttempts:10,_sizeSamplingAttemptsCount:0}),b.methods({initialize:function(a,b,c){c=c||{},this.parent(a,b,c),this.addEvent("resizeEnd",this._onResizeEnd),this._minimumTimeBetweenRenders=1e3,this._disableResizeHandlers(),this._resizableSides=[],this._iframeDimensions={w:0,h:0}},_disableResizeHandlers:function(){this._resizableSides=[]},_onStyleReady:function(){this.parent(),this._applyThemeColors({propName:"borderColor"}),this._applyThemeColors({propName:"backgroundColor"}),this._style.addEvent(Constants.StyleEvents.PROPERTY_CHANGED,this._applyThemeColors)},_applyThemeColors:function(a){var b,c,d;for(var e in a.properties)b=this.injects().Skins.getSkinParamValue(this._skin.className,e,this._style),c=b.getHex(!1),d=b.getAlpha(),"borderColor"==e&&(this._borderColor=c,this._borderAlpha=d),"backgroundColor"==e&&(this._backgroundColor=c,this._backgroundAlpha=d);this._tryRender()},isInvisibleInStaticHtml:function(){return!0},render:function(){this._updateFrameSize(),this._clearFrame(),this.callLater(this._fillFrame,[],100)},_onResizeEnd:function(){this._tryRender()},_clearFrame:function(){try{var a=this._getFrame();if(void 0!==a){this.setIFrameSrc(a,"about:blank");var b=a.contentWindow.document||a.contentWindow.document;b&&(a.src="javascript:(function () {document.open();document.clear();document.close()})();")}}catch(c){}},_getFrame:function(){return this._skinParts?this._skinParts.iframe:void 0},_getOverlay:function(){return this._skinParts?this._skinParts.overlayClick:void 0},_updateFrameSize:function(a,b){var c;a=a||this._view.getWidth()-1,b=b||this._view.getHeight()-1,c=this._getFrame(),c&&c.set({width:a,height:b})},_fillFrame:function(){var a,b={};b.userID=this._data.get("userId"),b.userName=this._data.get("userName"),b.tag=this._data.get("tag"),b.imageCount=this._data.get("imageCount"),b.whichImages=this._data.get("whichImages"),b.imageSize=this._data.get("imageSize"),b.layoutOrientation=this._data.get("layoutOrientation");var c=this._getFlickrEmbedCode(b),d=this._getFrame();void 0!==d&&(this.injects().Utils.prepareIFrameForWrite(d,function(a,b){b.write(c)}.bind(this)),a="http://www.flickr.com/photos/"+b.userID+"/",this._getOverlay().set("href",a),this._sizeSamplingAttemptsCount=0,this.callLater(this._updateIframeDimensions,[],1e3))},_updateIframeDimensions:function(){this._sizeSamplingAttemptsCount++;var a=this._sampleIframeDimensions();a&&(a.w!=this._currentDimensions.w||a.h!=this._currentDimensions.h)&&(this._currentDimensions.w=a.w,this._currentDimensions.h=a.h,this.setWidth(this._currentDimensions.w+5),this.setHeight(this._currentDimensions.h+5),this._updateFrameSize(this._currentDimensions.w+5,this._currentDimensions.h+5),this._wCheckForSizeChangeAndFireAutoSized(0)),this._sizeSamplingAttemptsCount<this._totalSizeSamplingAttempts&&this.callLater(this._updateIframeDimensions,[],500)},_sampleIframeDimensions:function(){var a,b,c=this._getFrame();if(void 0!=c){if(Browser.ie){var d=this._data.get("imageSize")+this._data.get("layoutOrientation");switch(d){case"sv":a=130,b=83+75*this._data.get("imageCount");break;case"tv":a=130,b=83+67*this._data.get("imageCount");break;case"mv":a=260,b=83+160*this._data.get("imageCount");break;case"sh":a=55+75*this._data.get("imageCount"),b=130;break;case"th":a=55+100*this._data.get("imageCount"),b=161;break;case"mh":a=55+240*this._data.get("imageCount"),b=297}}else{var e=c.contentWindow.document.getElementById("flickr_badge_uber_wrapper");e&&(a=e.clientWidth,b=e.clientHeight)}0==isNaN(a)&&0==isNaN(b)&&(this._iframeDimensions.w=a,this._iframeDimensions.h=b)}return this._iframeDimensions},_rgbToHex:function(a){var b;return b=new this.imports.Color(a),b.getHex(!1)},_getFlickrEmbedCode:function(a){var b,c,d="";return void 0!==a.tag&&""!==a.tag?(c="user_tag",b="&tag="+a.tag):(c="user",b=""),Browser.ie&&(d="a:link{color:"+this._backgroundColor+"}a:visited{color:"+this._backgroundColor+"}"),'<style type="text/css">#flickr_badge_source_txt {padding:0; font: 11px Arial, Helvetica, Sans serif; color:#666666;}#flickr_badge_source_txt {padding:0; font: 11px Arial, Helvetica, Sans serif; color:#666666;}#flickr_badge_icon {display:block !important; margin:0 !important; border: 1px solid rgb(0, 0, 0) !important;}#flickr_icon_td {padding:0 5px 0 0 !important;}.flickr_badge_image {text-align:center !important;}.flickr_badge_image img {border: 1px solid black !important;}#flickr_badge_uber_wrapper {width:150px;}#flickr_www {display:block; text-align:center; padding:0 10px 0 10px !important; font: 11px Arial, Helvetica, Sans serif !important; color:#3993ff !important;}#flickr_badge_uber_wrapper a:hover,#flickr_badge_uber_wrapper a:link,#flickr_badge_uber_wrapper a:active,#flickr_badge_uber_wrapper a:visited {text-decoration:none !important; background:inherit !important;}#flickr_badge_wrapper {opacity: '+this._backgroundAlpha+";background-color: "+this._backgroundColor+";border: solid 1px "+this._borderColor+"}#flickr_badge_source {padding:0 !important; font: 11px Arial, Helvetica, Sans serif !important; }body {overflow: hidden;}"+d+'</style><table id="flickr_badge_uber_wrapper" cellpadding="0" cellspacing="10" border="0"><tr><td><a href="http://www.flickr.com" id="flickr_www">www.<strong style="color:#3993ff">flick<span style="color:#ff1c92">r</span></strong>.com</a><table cellpadding="0" cellspacing="10" border="0" id="flickr_badge_wrapper"><script type="text/javascript" src="http://www.flickr.com/badge_code_v2.gne?show_name=1&count='+a.imageCount+"&display="+a.whichImages+"&size="+a.imageSize+"&layout="+a.layoutOrientation+"&source="+c+"&user="+a.userID+b+'"></script></table></td></tr></table></td></tr></table>'}})}),define.component("wysiwyg.viewer.components.FooterContainer",function(a){var b=a;b.inherits("wysiwyg.viewer.components.SiteSegmentContainer"),b.traits(["wysiwyg.viewer.components.traits.FixedComponentTrait"]),b.binds(["_adjustPositionForWixAds"]),b.methods({applyPos:function(a){this._applyLayoutPosition_(a);var b=a||this.getLayoutPosition();"fixed"===b?this._setBottomPosition():this._unsetBottomPosition()},_setBottomPosition:function(){this.$view.addClass("fixedPosition");var a=window.$$('[comp="wysiwyg.viewer.components.WixAds"]')[0],b=!!a;if(b){var c=a.$logic;c?this._adjustPositionForWixAds(c):a.addEvent("ready",this._adjustPositionForWixAds)}else this.$view.setStyle("bottom","0px")},_adjustPositionForWixAds:function(a){var b=a.getAdHeight();this.$view.setStyle("bottom",b.footer+"px")},_unsetBottomPosition:function(){this.$view.setStyle("bottom","auto")}})}),define.component("wysiwyg.viewer.components.GoogleMap",function(a){var b=a;b.inherits("mobile.core.components.base.BaseComponent"),b.resources(["topology"]),b.skinParts({mapContainer:{type:"htmlElement"}}),b.states(["normal","error"]),b.dataTypes(["GeoMap"]),b.propertiesSchemaType("GoogleMapProperties"),b.fields({_renderTriggers:[Constants.DisplayEvents.MOVED_IN_DOM,Constants.DisplayEvents.ADDED_TO_DOM,Constants.DisplayEvents.DISPLAYED,Constants.DisplayEvents.DISPLAY_CHANGED],MIN_SIZE:130}),b.methods({initialize:function(a,b,c){c=c||{},this.parent(a,b,c),this.iframeCreated=!1,W.Commands.registerCommandListenerByName("WPreviewCommands.WEditModeChanged",this,this._onEditorModeChanged),this.addEvent("resizeEnd",this._renderGoogleMapsIframe)},_onEditorModeChanged:function(a,b){"PREVIEW"===b&&"CURRENT_PAGE"===a&&this.render()},render:function(){this._renderGoogleMapsIframe()},isPartiallyFunctionalInStaticHtml:function(){return!0},_renderGoogleMapsIframe:function(){this.isReady()&&(this.iframeCreated&&this._skinParts.mapContainer.hasChildNodes()?this._updateIframe():(this._createIframe(),this.iframeCreated=!0))},_createIframe:function(){var a=new IFrame({src:this.resources.topology.wysiwyg+"/html/external/googleMap.html",width:"100%",height:"100%",webkitAllowFullScreen:"true",mozallowfullscreen:"true",allowfullscreen:"allowfullscreen",frameBorder:"0",events:{load:function(){this._updateIframe()}.bind(this)}});this._iframe=a,this._skinParts.mapContainer.empty(),this._skinParts.mapContainer.grab(a)},_updateIframe:function(){var a={address:this._data.get("address"),addressInfo:this._data.get("addressInfo"),mapType:this.getComponentProperty("mapType"),mapDragging:this.getComponentProperty("mapDragging"),showZoom:this.getComponentProperty("showZoom"),showPosition:this.getComponentProperty("showPosition"),showStreetView:this.getComponentProperty("showStreetView"),showMapType:this.getComponentProperty("showMapType"),latVal:this._data.get("latitude"),longVal:this._data.get("longitude")};this._iframe.contentWindow.postMessage(JSON.stringify(a),"*")}})}),define.component("wysiwyg.viewer.components.HeaderContainer",function(a){var b=a;b.inherits("wysiwyg.viewer.components.SiteSegmentContainer"),b.traits(["wysiwyg.viewer.components.traits.FixedComponentTrait"])}),define.component("wysiwyg.viewer.components.HorizontalMenu",function(a){var b=a;
b.inherits("core.components.BaseRepeater"),b.utilize(["core.components.BaseList","core.components.SimpleButton"]),b.skinParts({repeaterButton:{type:"core.components.MenuButton",repeater:!0,dataRefField:"pages",container:"itemsContainer",hookMethod:"_changePagesRefData",argObject:{listSubType:"PAGES"}},moreButton:{type:"core.components.MenuButton"},itemsContainer:{type:"htmlElement"},moreContainer:{type:"htmlElement"}}),b.binds(["_onButtonDataChange","_onMoreButtonClick","_onThemeChange","_arrangeButtons","_onButtonClick","_onMoreButtonOver","_onMoreButtonOut","_onMoreContainerOver","_onMoreContainerOut","_closeMoreMenu","_onPageChanged"]),b.dataTypes(["Document"]),b.propertiesSchemaType("HorizontalMenuProperties"),b.fields({_renderTriggers:[Constants.DisplayEvents.ADDED_TO_DOM,Constants.DisplayEvents.DISPLAYED,Constants.DisplayEvents.SKIN_CHANGE],EDITOR_META_DATA:{general:{settings:!0,design:!0},custom:[{label:"FPP_NAVIGATE_LABEL",command:"WEditorCommands.Pages"}],dblClick:{command:"WEditorCommands.Pages"}},_moreButtonClicked:!1,_prevButtonsWidth:0,_testOverFlowCount:50,_buttonsPadding:{}}),b.methods({initialize:function(a,b,c){this.parent(a,b,c),this.injects().Theme.addEvent("propertyChange",this._onThemeChange),this._arrangeWaitID=-1,this.injects().Viewer.addEvent("pageTransitionStarted",this._onPageChanged),this._usesExternalData=!0,this._staticWidth=0,this._preWidthModifier=this._nullModifier,this._postWidthModifier=this._nullModifier,this._hiddenButtonsContainer=new Element("div",{id:"hiddenButtonsContainer",style:"visibility:hidden"}),this._hiddenButtonsContainer.inject(this.getViewNode()),this.getViewNode().setStyle("opacity","0")},_testOverFlow:function(){var a=this._getButtonsWidth();this.injects().Utils.clearCallLater(this._overflowID),0==this._prevButtonsWidth&&(this._prevButtonsWidth=a),a!=this._prevButtonsWidth?this._arrangeButtons():(this._testOverFlowCount--,this._testOverFlowCount>0&&(this._overflowID=this.callLater(this._testOverFlow,[],100)))},_onPageChanged:function(a){var b,c;if(null!=this._skinParts&&this._allButtons)for(b=0;b<this._allButtons.length;b++)this._allButtons[b]&&this._allButtons[b].getViewNode()&&(c=this._allButtons[b],c.getID()==a?c.setState("selected"):c.removeState("selected"),this.injects().Utils.forceBrowserRepaint(c.getViewNode()))},_onThemeChange:function(){this._changeTriggeredBy="themeChange",this._arrangeButtonsDelayed()},_beforeRepeatersCreation:function(){this._allButtons=[]},_onRepeaterItemReady:function(a,b,c,d){d&&b.addEvent("click",function(){this._onButtonClick(c)}.bind(this)),this._allButtons.push(b),this.parent(a,b,c,d)},_onRepeaterReady:function(){this.addEvent(Constants.PropertyEvents.PROPERTY_CHANGED,this._arrangeButtons),this._addPartsListeners(),this._arrangeButtons()},_addPartsListeners:function(){this._skinParts.moreButton.addEvent("over",this._onMoreButtonOver),this._skinParts.moreButton.addEvent("out",this._onMoreButtonOut),this._skinParts.moreButton.addEvent("click",this._onMoreButtonClick),this._skinParts.moreContainer.addEvent("mouseover",this._onMoreContainerOver),this._skinParts.moreContainer.addEvent("mouseout",this._onMoreContainerOut);var a;for(a=0;a<this._allButtons.length;a++)this._allButtons[a]&&this._allButtons[a].getViewNode()&&(this._allButtons[a].getViewNode().uncollapse(),this._allButtons[a].addEvent("dataChanged",this._onButtonDataChange))},render:function(){this.parent(),"styleChange"==this._changeTriggeredBy?this._arrangeButtonsDelayed():this._arrangeButtons()},setSkin:function(a){this._staticWidth=a.staticWidth||0,this.parent(a)},_onButtonDataChange:function(){this._changeTriggeredBy="dataChange",this.render()},_onDataChange:function(a){this.getComponentProperties().removeField("spacing"),this._changeTriggeredBy="dataChange",this.parent(a)},_applySettings:function(){this._preWidthModifier=this._nullModifier,this._postWidthModifier=this._nullModifier,this._staticWidth>0?this._preWidthModifier=this._staticWidthModifier:(this.getComponentProperty("sameWidthButtons")&&(this._preWidthModifier=this._sameWidthModifier),this.getComponentProperty("stretchButtonsToMenuWidth")&&(this._postWidthModifier=this._stretchToFillModifier))},_skinSizeChange:function(){this._changeTriggeredBy="styleChange",this.parent()},_skinParamsChange:function(a){this._changeTriggeredBy="styleChange",this.parent(a)},_arrangeButtonsDelayed:function(){-1!=this._arrangeWaitID&&this.injects().Utils.clearCallLater(this._arrangeWaitID),this._arrangeWaitID=this.callLater(this._arrangeButtonsCapture,[],100),this._changeTriggeredBy="",this._skinParts.itemsContainer.setStyle("overflow","hidden")},_arrangeButtonsCapture:function(){this._arrangeButtons(),-1!=this._arrangeWaitID&&this._arrangeButtonsDelayed()},_arrangeButtons:function(){if(void 0!=this._skinParts&&this._allButtons&&0!=this._allButtons.length&&this._isDisplayed&&this.isReady()){this.getViewNode().setStyle("opacity","1"),this.injects().Utils.clearCallLater(this._overflowID),this._prevButtonsWidth=0,this._arrangeWaitID=-1,this._applySettings();var a=this._allButtons[0]&&this._allButtons[0].getViewNode()?this._allButtons[0].getViewNode().getStyle("-webkit-transition-duration"):0;this._initItemsContainer(),this._skinParts.itemsContainer.setStyle("overflow","hidden"),this._skinParts.itemsContainer.setStyle("white-space","normal"),this._initMoreContainer(),this._skinParts.moreButton.setLabel(this.getComponentProperty("moreButtonLabel")),this._skinParts.moreButton.skipMe=!0;var b=this._getDisplayedButtons();if(b.length){b.push(this._skinParts.moreButton);var c=this._getSampleButton();this._sampleButtonBorder(c),this._setMinimumDimensions(c),this._preArrangeButtons(b),this._preWidthModifier(b),this._calculateButtonsAmount(b),this.setMinW(b[0].getViewNode().offsetWidth),this._postWidthModifier(b),this._arrangeMoreContainer(),b=this._getDisplayedButtons(),b.push(this._skinParts.moreButton),this._alignButtonsText(b);var d;for(d=0;d<b.length;d++){var e=b[d];e.getViewNode().setStyle("-webkit-transition-duration",a)}this._skinParts.itemsContainer.setStyle("overflow","visible"),this._skinParts.itemsContainer.setStyle("white-space","nowrap"),this._setListPositions(),this._testOverFlow()}}},_calculateButtonsAmount:function(a){a=this._arrangementAlgorithm(a),this._skinParts.moreButton.skipMe&&(this._skinParts.moreButton.getViewNode().setStyle("visibility","hidden"),this._skinParts.moreButton.getViewNode().inject(this._skinParts.moreContainer),a[a.length-1]===this._skinParts.moreButton&&a.pop())},_getButtonsWidth:function(){for(var a=0,b=0;b<this._skinParts.itemsContainer.children.length;b++)a+=this._skinParts.itemsContainer.children[b].getLogic().getWidthOnLayout();return a},_getDisplayedButtons:function(){var a,b=[];for(a=0;a<this._allButtons.length;a++)this._allButtons[a]&&this._allButtons[a].getDataItem()&&!this._allButtons[a].getDataItem()._data.hidePage?b.push(this._allButtons[a]):this._allButtons[a]&&this._allButtons[a].getViewNode()&&(this._allButtons[a].getViewNode().setStyle("visibility","inherit"),this._allButtons[a].getViewNode().inject(this._hiddenButtonsContainer));return b},_setListPositions:function(){var a,b,c;for(a=0;a<this._skinParts.itemsContainer.children.length;a++)b=this._skinParts.itemsContainer.children[a],c=0==a&&this._setPositionForFirst()?"first":a==this._skinParts.itemsContainer.children.length-1&&this._setPositionForLast()?"last":"center",b.setProperty("listposition",c);for(a=0;a<this._skinParts.moreContainer.children.length;a++)b=this._skinParts.moreContainer.children[a],b.setProperty("listposition","more")},_setPositionForFirst:function(){var a=!1;return this._postWidthModifier==this._stretchToFillModifier?a=!0:"left"==this.getComponentProperty("alignButtons")&&(a=!0),a},_setPositionForLast:function(){var a=!1;return this._postWidthModifier==this._stretchToFillModifier?a=!0:"right"==this.getComponentProperty("alignButtons")&&(a=!0),a},_getSampleButton:function(){return this._allButtons[0]&&this._allButtons[0].getViewNode()&&"visible"==this._allButtons[0].getViewNode().getStyle("visibility")?this._allButtons[0]:this._skinParts.moreButton},_sampleButtonBorder:function(a){this._buttonsBorder=a._skinParts.borderWrapper?this._getBorder(a._skinParts.borderWrapper):this._getBorder(a.getViewNode())},_setMinimumDimensions:function(a){a._skinParts.label.setStyle("line-height","100%");var b=0;a.getSkin()&&!isNaN(a.getSkin().addToMinH)&&(b=a.getSkin().addToMinH);var c=this._getBorder(this._skinParts.itemsContainer).y+this._buttonsBorder.y;this.setMinH(b+c+parseInt(a._skinParts.label.getComputedStyle("line-height"),10))},_initItemsContainer:function(){this._skinParts.itemsContainer.setStyle("text-align",this.getComponentProperty("alignButtons"));var a=this.getHeight()-this._getBorder(this._skinParts.itemsContainer).y-this._getMargin(this._skinParts.itemsContainer).y,b=this.getWidth()-this._getBorder(this._skinParts.itemsContainer).x-this._getMargin(this._skinParts.itemsContainer).x;this._skinParts.itemsContainer.setStyle("height",a+"px"),this._skinParts.itemsContainer.setStyle("width",b+"px")},_initMoreContainer:function(){this._skinParts.moreContainer.setStyle("visibility","hidden"),this._skinParts.moreContainer.setStyle("opacity","0"),this._skinParts.moreContainer.setStyle("width","0px"),this._skinParts.moreContainer.setStyle("left","0px")},_preArrangeButtons:function(a){var b;for(b=0;b<a.length;b++){var c=a[b];c.getViewNode().setStyle("visibility","inherit"),c.getViewNode().setStyle("-webkit-transition-duration","0s"),c.getViewNode().inject(this._skinParts.moreContainer),c._skinParts.bg.setStyle("padding","0px 0px")}},_arrangeMoreContainer:function(){var a,b,c=this._skinParts.moreButton.getViewNode().offsetWidth;for(a=0;a<this._skinParts.moreContainer.children.length;a++)b=this._skinParts.moreContainer.children[a],c=Math.max(c,b.offsetWidth);for(this._skinParts.moreContainer.setStyle("width",c+"px"),a=0;a<this._skinParts.moreContainer.children.length;a++)b=this._skinParts.moreContainer.children[a],this._fillWidthByPadding(b,c);var d=this._skinParts.moreButton.getViewNode().offsetLeft;isNaN(d)||this._skinParts.moreContainer.setStyle("left",d+"px")},_alignButtonsText:function(a){var b;for(b=0;b<a.length;b++){var c=a[b].getViewNode(),d=parseInt(c.getLogic()._skinParts.bg.getComputedStyle("padding-left"),10)+parseInt(c.getLogic()._skinParts.bg.getComputedStyle("padding-right"),10);switch(this.getComponentProperty("alignText")){case"left":c.getLogic()._skinParts.bg.setStyle("padding-left","0px"),c.getLogic()._skinParts.bg.setStyle("padding-right",d+"px");break;case"right":c.getLogic()._skinParts.bg.setStyle("padding-left",d+"px"),c.getLogic()._skinParts.bg.setStyle("padding-right","0px")}}},_setPadding:function(a,b){a.getLogic()._skinParts.bg.setStyle("padding","0px "+b+"px")},_fillWidthByPadding:function(a,b){var c=parseInt(a.getLogic()._skinParts.bg.getComputedStyle("padding-left"),10),d=c+Math.floor((b-a.offsetWidth)/2);this._setPadding(a,d)},_arrangementAlgorithm:function(a){for(var b=!1;!b;)if(b=this._arrangementIteration(a),!b)if(1==a.length)b=!0;else{this._skinParts.moreButton.skipMe=!1;var c=a.splice(a.length-2,1)[0];c.getViewNode().setStyle("visibility","inherit"),c.getViewNode().inject(this._skinParts.moreContainer,"top")}return a},_stretchToFillModifier:function(a,b){function c(a,b){if(j>0){var c=Math.floor(h/j),e=parseInt(a._skinParts.bg.getStyle(b),10);d&&(i._buttonsPadding[a]||(i._buttonsPadding[a]={}),i._buttonsPadding[a][b]=e),a._skinParts.bg.setStyle(b,e+c+"px"),j--,h-=c}}b=b||0;var d=!1;0==b&&(d=!0,this._buttonsPadding={});var e,f=this._getButtonsWidth(),g=parseInt(this._skinParts.itemsContainer.getStyle("width"),10),h=g-f-b-1;Browser.ie&&(h-=1),h=Math.max(h,0);var i=this;if(a.length>0){var j=2*a.length;for(e=0;e<a.length/2;e++){var k=a[e],l=a[a.length-e-1];c(k,"padding-left"),c(l,"padding-right"),c(k,"padding-right"),c(l,"padding-left")}}if(this._skinParts.itemsContainer.scrollHeight-a[0].getViewNode().offsetHeight>=a[0].getViewNode().offsetHeight){for(e=0;e<a.length;e++){var m=a[e];m._skinParts.bg.setStyle("padding-left",this._buttonsPadding[m]["padding-left"]),m._skinParts.bg.setStyle("padding-right",this._buttonsPadding[m]["padding-left"])}if(b>20)return;this._stretchToFillModifier(a,b+1)}},_sameWidthModifier:function(a){var b,c,d=0;for(b=0;b<a.length;b++){c=a[b];var e=parseInt(c.getViewNode().offsetWidth-this._buttonsBorder.x,10);isNaN(e)||(d=Math.max(d,e))}if(d>0)for(b=0;b<a.length;b++)c=a[b],this._fillWidthByPadding(c.getViewNode(),d)},_staticWidthModifier:function(a){var b,c;for(b=0;b<a.length;b++)c=a[b],c.offsetWidth<this._staticWidth?this._fillWidthByPadding(c.getViewNode(),this._staticWidth):c.getViewNode().setStyle("width",this._staticWidth+"px")},_nullModifier:function(){},_arrangementIteration:function(a){var b,c;for(c=0;c<a.length;c++){var d=a[c];d.skipMe?d.collapse():(d.uncollapse(),d.getViewNode().setStyle("visibility","visible"),d.getViewNode().inject(this._skinParts.itemsContainer),b=parseInt(this._skinParts.itemsContainer.getStyle("height"),10)-this._buttonsBorder.y,d.getViewNode().setStyle("height",b+"px"),void 0!=d._skinParts.labelPad&&(b-=d._skinParts.labelPad.offsetHeight),d._skinParts.label.setStyle("line-height",b+"px"),d._skinParts.label.setStyle("width","auto"))}return this._skinParts.itemsContainer.scrollHeight-a[0].getViewNode().offsetHeight<a[0].getViewNode().offsetHeight},_getBorder:function(a){var b=0,c=0;return a&&(b=parseInt(a.getStyle("border-left-width"),10)+parseInt(a.getStyle("border-right-width"),10),c=parseInt(a.getStyle("border-top-width"),10)+parseInt(a.getStyle("border-bottom-width"),10)),{x:b,y:c}},_getMargin:function(a){var b=0,c=0;return a&&(b=parseInt(a.getStyle("margin-left"),10)+parseInt(a.getStyle("margin-right"),10),c=parseInt(a.getStyle("margin-top"),10)+parseInt(a.getStyle("margin-bottom"),10)),{x:b,y:c}},_onResize:function(){this._arrangeButtons()},_onButtonClick:function(a){this.injects().Viewer.goToPage(a.get("id"))},_openMoreMenu:function(){this._skinParts.moreButton.setState("selected"),this._skinParts.moreContainer.setStyle("visibility","visible"),this._skinParts.moreContainer.setStyle("opacity","1"),this._isMoreContainerOpen=!0,this._toCloseMoreMenu=!1,this.injects().Utils.forceBrowserRepaint(this._skinParts.moreButton.getViewNode()),this.injects().Utils.forceBrowserRepaint(this._skinParts.moreContainer)},_closeMoreMenuTimer:function(){this.injects().Utils.clearCallLater(this._closeMoreMenuTimerID),this._closeMoreMenuTimerID=this.injects().Utils.callLater(this._closeMoreMenu,[],this,500)},_closeMoreMenu:function(a){(a||this._toCloseMoreMenu)&&(this._skinParts.moreButton.removeState("selected"),this._skinParts.moreContainer.setStyle("visibility","hidden"),this._skinParts.moreContainer.setStyle("opacity","0"),this._toCloseMoreMenu=!1,this._isMoreContainerOpen=!1,this._moreButtonClicked=!1)},_forceCloseMoreMenu:function(){this._closeMoreMenu(!0)},_onMoreButtonOver:function(){this._toCloseMoreMenu=!1,this._moreButtonClicked||this._openMoreMenu()},_onMoreButtonOut:function(){this._toCloseMoreMenu=!0,this._closeMoreMenuTimer()},_onMoreContainerOver:function(){this._toCloseMoreMenu=!1},_onMoreButtonClick:function(){this._moreButtonClicked=!0,this._isMoreContainerOpen===!1?this._openMoreMenu():this._forceCloseMoreMenu()},_onMoreContainerOut:function(){this._toCloseMoreMenu=!0,this._closeMoreMenuTimer()},dispose:function(){this.injects().Viewer.removeEvent("pageTransitionStarted",this._onPageChanged),this.injects().Theme.removeEvent("propertyChange",this._onThemeChange),this.parent()}})}),define.component("wysiwyg.viewer.components.HtmlComponent",function(a){var b=a;b.inherits("mobile.core.components.base.BaseComponent"),b.utilize(["core.components.base.SizeLimits"]),b.resources(["W.Config","W.Viewer","W.Commands"]),b.binds(["_onPageTransitionStarted"]),b.traits(["wysiwyg.viewer.components.traits.IframeUtils"]),b.skinParts({iFrameHolder:{type:"htmlElement"}}),b.dataTypes(["HtmlComponent"]),b.states(["hasContent","noContent"]),b.propertiesSchemaType(""),b.statics({MAX_HTML_COMPONENT_HEIGHT_DEFAULT:5e3}),b.fields({EDITOR_META_DATA:{general:{settings:!0,design:!1},mobile:{allInputsHidden:!0}}}),b.methods({initialize:function(a,b,c){this.parent(a,b,c),this.addEvent("resizeEnd",this._onResizeEnd),this._iframe=null,this._renderOnResize=!1,this._renderFrame=!1,this.resources.W.Config.env.$isEditorViewerFrame&&this.resources.W.Commands.registerCommandListenerByName("WPreviewCommands.WEditModeChanged",this,this._onViewModeChanged),this.resources.W.Config.getSafeMode("htmlcomponent")&&(this._IsInSafeMode=!0)},_onViewModeChanged:function(){this.resources.W.Config.env.isEditorInPreviewMode()&&!this.resources.W.Config.env.isInDeactivatedViewer()?this._renderFrame=!0:this._renderFrame&&null!==this._iframe&&(this._setFrameWithSrc(this._iframe),this._renderFrame=!1)},_onResizeEnd:function(){this._iframe&&(this._iframe.width=this._view.getWidth(),this._iframe.height=this._view.getHeight()),this._renderOnResize&&this._renderIfReady()},render:function(){this.resources.W.Viewer.removeEvent("pageTransitionStarted",this._onPageTransitionStarted),this.getDataItem().getData().freezeFrame&&!this._isInMasterpageScope()&&(this.resources.W.Viewer.addEvent("pageTransitionStarted",this._onPageTransitionStarted),this._renderTriggers=[Constants.DisplayEvents.DISPLAY_CHANGED]),this._createIFrame(this._view.getWidth(),this._view.getHeight()),this.setState(this.hasContent()?"hasContent":"noContent"),this.hasContent()&&this._setFrameWithSrc(this._iframe)},_onPageTransitionStarted:function(a){a!==this.$view.$pageId&&this.setIFrameSrc(this._iframe,"about:blank")},getSizeLimits:function(){return void 0===this._sizeLimits&&(this._sizeLimits=new this.imports.SizeLimits,this._sizeLimits.minW=this._sizeLimits.minW||this.MINIMUM_WIDTH_DEFAULT,this._sizeLimits.minH=this._sizeLimits.minH||this.MINIMUM_HEIGHT_DEFAULT,this._sizeLimits.maxW=this._sizeLimits.maxW||this.MAXIMUM_WIDTH_DEFAULT,this._sizeLimits.maxH=this._sizeLimits.maxH||this.MAX_HTML_COMPONENT_HEIGHT_DEFAULT,this._originalSizeLimits=this._sizeLimits.clone()),this._sizeLimits},addProtocolIfMissing:function(a){var b=/^(ftps|ftp|http|https):.*$/;return b.test(a)?a:"http://"+a},getIFrameSrc:function(){var a=this._data.get("url"),b="external"===this._data.get("sourceType"),c=this.resources.W.Config.getServiceTopologyProperty("staticHTMLComponentUrl");return b||0!==a.indexOf("html/")||(a=c+a),a=this.addProtocolIfMissing(a),c=this.addProtocolIfMissing(c),b||(a=a.replace("http://static.wix.com",c)),a},_onPageTransitionEnded:function(){this.getIsDisposed()||this._setFrameWithSrc(this._iframe)},hasContent:function(){return!!this._data.get("url")},_createIFrame:function(a,b){var c=new IFrame;c.width=a,c.height=b,navigator.userAgent.match(/(iPod|iPhone|iPad)/)&&this._view.setStyles({overflow:"scroll","-webkit-overflow-scrolling":"touch"}),this._iframe?c.replaces(this._iframe):c.insertInto(this._skinParts.iFrameHolder),this._iframe=c},_setFrameWithSrc:function(a){var b=this.getIFrameSrc(),c=a.src;if(this._IsInSafeMode){var d=this._getSafeModeHTML(b);a.contentWindow.document.open(),a.contentWindow.document.write(d),a.contentWindow.document.close()}else c!==b&&this.setIFrameSrc(a,b)},_getSafeModeHTML:function(a){var b='<!DOCTYPE html><html><head><style>.wholepage {background-color: #f984ef; height: 100%;width:100%;}</style></head><body class="wholepage"><div><button onClick=\'window.location.href="'+a+"\"'>Reset</button></div><div>"+a+"</div></body></html>";return b},_isInMasterpageScope:function(){var a=this.getParentSiteSegmentContainer();return!a||"wysiwyg.viewer.components.HeaderContainer"===a.$className||"wysiwyg.viewer.components.FooterContainer"===a.$className},dispose:function(){this.resources.W.Viewer.removeEvent("pageTransitionStarted",this._onPageTransitionStarted),this.parent()}})}),define.component("wysiwyg.viewer.components.IFrameComponent",function(a){var b=a;b.inherits("mobile.core.components.base.BaseComponent"),b.traits(["wysiwyg.viewer.components.traits.IframeUtils"]),b.methods({initialize:function(a,b,c){c=c||{},this.parent(a,b,c),this._iframeUrl=c.iframeUrl||"",this._iframe=null},render:function(){this._renderIframe()},_onResize:function(){this.parent(),this._skinParts&&this._renderIframe()},_renderIframe:function(a){this._iframe?this._updateIframe(a):this._createIframe()},_createIframe:function(){this._iframe=new IFrame({src:this._iframeUrl,width:"100%",height:"100%",webkitAllowFullScreen:"true",mozallowfullscreen:"true",allowfullscreen:"allowfullscreen",frameborder:"0",scrolling:"no"}),this._setBasicIframeParams(),this._setIframeParams(),this._iframe.insertInto(this._getIframeContainer())},_getIframeContainer:function(){return this._view},_changeSize:function(a,b){var c=this.getWidth(),d=this.getHeight(),e=a.x||a.w||a.width,f=a.y||a.h||a.height;e&&e!=c&&(this.setWidth(e,!1,!f&&b),this._iframe.setStyle("width",e+"px")),f&&f!=d&&(this.setHeight(f,!1,b),this._iframe.setStyle("height",f+"px")),this._wCheckForSizeChangeAndFireAutoSized(1)},_updateIframe:function(a){this._setBasicIframeParams(a),this._setIframeParams()},_setBasicIframeParams:function(a){a=a||!1;var b=this._getUrl(a);(a||this._iframe.src!==b)&&this.setIFrameSrc(this._iframe,b),this._iframe.width=this.getWidth(),this._iframe.height=this.getHeight()},_setIframeParams:function(){},_getUrl:function(){throw new Error("IFrameComponent::_getUrl() must be overridden.")},getIFrame:function(){return this._iframe}})}),define.component("wysiwyg.viewer.components.ImageLite",function(a){var b=a;b.inherits("mobile.core.components.base.BaseComponent"),b.utilize(["core.components.image.ImageUrl"]),b.dataTypes(["Image"]),b.fields({_currentUri:""}),b.methods({initialize:function(a,b,c){this.parent(a,b,c)},_onAllSkinPartsReady:function(){this._img||(this._img=new Element("img"),this._view.adopt(this._img))},render:function(){var a=this._view.getSize();this.setSize(a.x,a.y)},setOwner:function(){},invalidateSize:function(){},setSize:function(a,b){this._imgWidth=parseInt(this._data.get("width")),this._imgHeight=parseInt(this._data.get("height"));var c={width:parseInt(a),height:parseInt(b),overflow:"hidden"};this._view.setStyles(c);var d=a,e=a*(this._imgHeight/this._imgWidth);b>e&&(e=b,d=b*(this._imgWidth/this._imgHeight));var f=(b-e)/2;f=0>f?f:0;var g=(a-d)/2;g=0>g?g:0;var h=(new this.imports.ImageUrl).getImageUrlFromPyramid({x:parseInt(d),y:parseInt(e)},this._data.get("uri")).url;this._currentUri!==h&&(this._currentUri=h,this._img.setAttribute("src",h));var i={position:"static",width:Math.round(d)+1,height:parseInt(e),"margin-top":parseInt(f),"margin-left":parseInt(g),"box-shadow":"#000 0 0 0","image-rendering":"optimizequality"};this._img.setStyles(i)}})}),define.component("wysiwyg.viewer.components.ItunesButton",function(a){var b=a;b.inherits("core.components.base.BaseComp"),b.traits(["wysiwyg.viewer.components.traits.CustomPreviewBehavior"]),b.dataTypes(["ItunesButton"]),b.propertiesSchemaType("ItunesButtonProperties"),b.resources(["W.Config"]),b.skinParts({downloadButton:{type:"htmlElement"},itunesImg:{type:"htmlElement"}}),b.statics({_useWidthOverMinWidth:!0,EDITOR_META_DATA:{general:{settings:!0,design:!1}}}),b.methods({initialize:function(a,b,c){this.parent(a,b,c),this._resizableSides=[Constants.BaseComponent.ResizeSides.LEFT,Constants.BaseComponent.ResizeSides.RIGHT],this._sizeLimits={minW:110,minH:40,maxW:400,maxH:145},this.supportsSVG=Modernizr.svg;var d=this.supportsSVG?"svg":"png",e=this.resources.W.Config.getServiceTopologyProperty("staticThemeUrlWeb")+"/viewer/ItunesButton/",f="iTunesBtn_{{langCode}}.";this.imageBaseUrl=e+f+d},isPartiallyFunctionalInStaticHtml:function(){return!0},_onRender:function(a){var b=a.data.invalidations,c=this.getDataItem(),d=this.getComponentProperties(),e=d.get("language");this.target=d.get("openIn"),this.downloadUrl=c.get("downloadUrl"),this._setImgSrcByLang(e),b.isInvalidated([this.INVALIDATIONS.FIRST_RENDER])&&(this._skinParts.downloadButton.addEvent("click",this._clickHandler.bind(this)),this.resources.W.Config.env.$isPublicViewerFrame&&this._view.setStyle("height",this.getHeight()+"px")),this._createClickOverlayForPreviewMode("ItunesButton_CustomPreviewBehavior_ttid")},_clickHandler:function(){this.downloadUrl&&("_blank"===this.target?this._navigateInNewTab(this.downloadUrl):this._navigateInSameWindow(this.downloadUrl))},_navigateInNewTab:function(a){var b=document.createElement("form");b.setAttribute("action",a),b.setAttribute("method","GET"),b.setAttribute("target","_blank"),document.body.appendChild(b),b.submit(),document.body.removeChild(b)},_navigateInSameWindow:function(a){window.location.href=a},_setImgSrcByLang:function(a){var b=this.imageBaseUrl.replace("{{langCode}}",a.toUpperCase());this._skinParts.itunesImg.setAttribute("src",b)},setWidth:function(a){var b=Math.round(a/2.75);this.parent(a),this.setHeight(b)}})}),define.component("wysiwyg.viewer.components.LazySocialPanel",function(a){var b=a;b.inherits("mobile.core.components.base.BaseComponent"),b.binds(["onHover"]),b.skinParts({placeHolder:{type:"htmlElement"},fbLike:{type:"htmlElement"},twitterShare:{type:"htmlElement"},googlePlus:{type:"htmlElement"}}),b.methods({initialize:function(a,b,c){this.parent(a,b,c);var d="";this.injects().Viewer.getCurrentPageNode()&&(d=this.injects().Viewer.getCurrentPageNode().getLogic().getDataItem().getData().title);location.href;this._buttons={fbLike:{type:"wysiwyg.viewer.components.WFacebookLike",skin:"skins.core.FacebookLikeSkin",data:null,args:{propObj:{layout:"button_count"}}},twitterShare:{type:"wysiwyg.viewer.components.WTwitterTweet",skin:"mobile.core.skins.TwitterTweetSkin",data:this.injects().Data.createDataItem({defaultText:d+" ~ ",accountToFollow:"",type:"TwitterTweet"},"TwitterTweet"),args:null},googlePlus:{type:"wysiwyg.viewer.components.WGooglePlusOne",skin:"mobile.core.skins.GooglePlusOneSkin",data:null,args:{annotation:"small_bubble",size:"medium",width:{w:50,h:15}}}}},render:function(){this._skinParts.placeHolder.addEvent("mouseover",this.onHover)},onHover:function(){this._skinParts.placeHolder.removeEvent("mouseover",this.onHover),this._skinParts.placeHolder.dispose(),this._addService(this._buttons.twitterShare,this._skinParts.twitterShare),this._addService(this._buttons.fbLike,this._skinParts.fbLike)},_addService:function(a,b){this.injects().Components.createComponent({type:a.type,skin:a.skin,data:a.data,args:a.args}).insertInto(b)}})}),define.component("wysiwyg.viewer.components.LinkBar",function(a){var b=a;b.inherits("core.components.BaseRepeater"),b.binds(["_setComponentSize"]),b.resources(["W.Config"]),b.dataTypes(["ImageList"]),b.skinParts({imageItem:{type:"wysiwyg.viewer.components.LinkBarItem",repeater:!0,container:"itemsContainer",dataRefField:"items",argObject:{unit:"px"}},itemsContainer:{type:"htmlElement"}}),b.propertiesSchemaType("LinkBarProperties"),b.fields({EDITOR_META_DATA:{general:{settings:!0,design:!1},custom:[{label:"SOCIAL_BAR_MNG_ICONS",command:"WEditorCommands.OpenListEditDialog",commandParameter:{galleryConfigID:"social_icons",source:"fpp",startingTab:"free"},commandParameterDataRef:"SELF"}],dblClick:{command:"WEditorCommands.OpenListEditDialog",commandParameter:{galleryConfigID:"social_icons",source:"dblclick",startingTab:"free"},commandParameterDataRef:"SELF"}}}),b.methods({initialize:function(a,b,c){this.parent(a,b,c),this._resizableSides=[],this.setMaxH(9999),this.setMaxW(9999),this._isMobileView=!1,this.resources.W.Config.env.getCurrentFrameDevice()===Constants.ViewerTypesParams.TYPES.MOBILE&&(this._isMobileView=!0)},_onDataChange:function(){this.parent()},render:function(){this._iconSize=this.getComponentProperty("iconSize")||30,this._orientation=this.getComponentProperty("orientation"),this._spacing=this.getComponentProperty("spacing"),this._bgScale=this.getComponentProperty("bgScale"),this._setComponentSize()},_processDataRefs:function(a){return a},_onRepeaterReady:function(a){this._itemsAmount=a.itemsAmount,this._items=a.readyItemsLogic},_setComponentSize:function(){for(var a=0,b=0,c="HORIZ"===this._orientation,d=0;d<this._items.length;d++){var e=this._items[d],f=e.getViewNode(),g=this._spacing;d==this._items.length-1&&(g=0),e.setSize(this._iconSize,g,this._bgScale,c);var h=f.offsetWidth,i=f.offsetHeight;c?(f.setStyle("display","inline-block"),b=Math.max(b,i),a+=h):(f.setStyle("display","block"),b+=i,a=Math.max(a,h))}if(this._isMobileView){var j=this._items.length<6?this._items.length*(this._iconSize+this._spacing):300;this.setWidth(j,!0);var k=Math.floor(this._items.length/7)+1;b=k*this._iconSize}else this.setWidth(a+5,!0);this.setHeight(b,!0),this._wCheckForSizeChangeAndFireAutoSized(3)}})}),define.component("wysiwyg.viewer.components.LinkBarItem",function(a){var b=a;b.inherits("mobile.core.components.base.BaseComponent"),b.binds(["_onMouseOver","_onMouseOut","_onLinkMouseDown","_onImageStateChange"]),b.utilize(["wysiwyg.common.utils.LinkRenderer"]),b.resources(["W.Data"]),b.dataTypes([]),b.skinParts({image:{type:"core.components.Image",dataRefField:"*",optional:!1},imageBG:{type:"htmlElement",optional:!0},link:{type:"htmlElement",optional:!1}}),b.dataTypes(["Image"]),b.states(["loading","normal","rollover"]),b.fields({_parentList:null}),b.methods({initialize:function(a,b,c){this.parent(a,b,c),this._linkRenderer=new this.imports.LinkRenderer},_onRender:function(){this._isRendered&&this._renderLink()},_renderLink:function(){var a=this.getDataItem(),b=a._data.link;if(!b)return this._linkRenderer.removeRenderedLinkFrom(this._skinParts.link,this),void 0;var c=this.resources.W.Data.getDataByQuery(b);c&&this._linkRenderer.renderLink(this._skinParts.link,c,this)},setParentList:function(a){this._parentList=a},_onImageStateChange:function(){switch(this._skinParts.image.getState()){case"loading":this.setState("loading");break;case"loaded":this.setState("normal")}},_onMouseOver:function(){"normal"==this.getState()&&this.setState("rollover")},_onMouseOut:function(){"rollover"==this.getState()&&this.setState("normal")},_onLinkMouseDown:function(){var a=this._data.get("link"),b=this._data.get("target")||"_blank";a&&window.open(a,b)},setSize:function(a,b,c,d){var e,f;d?(e=b,f=0):(e=0,f=b);var g,h={};this._skinParts.image.setSize(a,a,"px"),g=a,h.x=h.y=g/2,this._skinParts.image.getViewNode().setStyles({left:h.x-a/2,top:h.y-a/2}),this.getViewNode().setStyles({width:String(g+e)+"px",height:String(g+f)+"px"})},_onDataChange:function(){this.parent()},_onAllSkinPartsReady:function(){var a,b=this._skinParts.image.getDataItem(),c=b.get("uri"),d=["b1cd13f9d4dfb1450bbb325285106177.png","01113281ebb7dfb57a8dc2a02eb1cb92.png","303edc0e9267d1fbf617777609f864ae.wix_mp","806f5f56d9a7b8849f2f2ea71ff5c0cc.png"];for(this.parent(),a=0;a<d.length;a++)d[a]===c&&(b.set("width",128),b.set("height",128))},_onResize:function(){this.parent(),this._skinParts.image&&(this._skinParts.image._invalidate("size"),this._skinParts.image._renderIfReady())},getImageRef:function(){var a="";return this._skinParts&&(a=String(this._skinParts.image.getDataItem().get("id"))),a}})}),define.component("wysiwyg.viewer.components.LoginButton",function(a){var b=a;b.inherits("mobile.core.components.base.BaseComponent"),b.resources(["W.SiteMembers","W.Data"]),b.dataTypes(["LoginButton",""]),b.binds(["_onStyleChange"]),b.skinParts({container:{type:"htmlElement"},actionTitle:{type:"htmlElement"},memberTitle:{type:"htmlElement"}}),b.fields({EDITOR_META_DATA:{general:{settings:!0,design:!0},mobile:{allInputsHidden:!0}}}),b.states(["auth","no_auth"]),b.statics({langKeys:{en:{Login_Button_Sign_In:"Login/Sign up",Login_Button_Sign_Out:"Log out",Login_Button_Hello:"Hello"},es:{Login_Button_Sign_In:"Inicia Sesin/Regstrate",Login_Button_Sign_Out:"Salir",Login_Button_Hello:"Hola"},de:{Login_Button_Hello:"Hallo",Login_Button_Sign_In:"Anmelden/Registrieren",Login_Button_Sign_Out:"Abmelden"},fr:{Login_Button_Hello:"Bonjour",Login_Button_Sign_In:"Connexion / Inscription",Login_Button_Sign_Out:"Dconnexion"},it:{Login_Button_Hello:"Ciao",Login_Button_Sign_In:"Login/ Registati",Login_Button_Sign_Out:"Esci"},ja:{Login_Button_Hello:"",Login_Button_Sign_In:"",Login_Button_Sign_Out:""},ko:{Login_Button_Hello:", ",Login_Button_Sign_In:"/",Login_Button_Sign_Out:""},pl:{Login_Button_Hello:"Witaj",Login_Button_Sign_In:"Zaloguj si/Zarejestruj si",Login_Button_Sign_Out:"Wyloguj si"},pt:{Login_Button_Hello:"Ol",Login_Button_Sign_In:"Login / Registre-se",Login_Button_Sign_Out:"Sair"},ru:{Login_Button_Hello:",",Login_Button_Sign_In:"/",Login_Button_Sign_Out:""},tr:{Login_Button_Hello:"Merhaba",Login_Button_Sign_In:"Giri / Kayt",Login_Button_Sign_Out:"k"}},_keys:{}}),b.methods({initialize:function(a,b,c){this.parent(a,b,c)
},_setDictionary:function(a){this._keys=a&&this.langKeys[a]?this.langKeys[a]:this.langKeys.en},_onStyleReady:function(){this.parent(),this._style.addEvent(Constants.StyleEvents.PROPERTY_CHANGED,this._onStyleChange)},_onStyleChange:function(){this._centerButton(),this._wCheckForSizeChangeAndFireAutoSized(10)},isPartiallyFunctionalInStaticHtml:function(){return!0},render:function(){if(this.parent(),this.getDataItem())this.getDataItem()&&!this.getDataItem()._data.language&&this.getDataItem().set("language",this.resources.W.Config.getLanguage()||"en");else{var a=this.resources.W.Data.addDataItemWithUniqueId("",{type:"LoginButton",language:"en"});this.setDataItem(a.dataObject)}this._updateTextsAndEvents(),this._centerButton()},_updateTextsAndEvents:function(){this._setDictionary(this.getDataItem()&&this.getDataItem()._data.language?this.getDataItem()._data.language:"en");var a=this._skinParts,b=this.injects().SiteMembers,c=a.actionTitle,d=a.memberTitle,e=this;this.injects().SiteMembers.isLoggedIn()?(c.set("text",this._keys.Login_Button_Sign_Out),c.addEvent("click",this._addLogoutMemberHandler(c)),this.injects().SiteMembers.getMemberDetails(function(a){var b=a.attributes&&a.attributes.name||a.email;d.set("text",this._keys.Login_Button_Hello+" "+b)}.bind(this)),this.setState("auth")):(c.set("text",this._keys.Login_Button_Sign_In),c.addEvent("click",function(){b.openSiteMembersPopup({dialogsLanguage:e.getDataItem()&&e.getDataItem()._data.language?e.getDataItem()._data.language:"en",authCallback:function(a){a.authResponse===!0&&e._renderIfReady()}}),c.removeEvent("click",arguments.callee)}.bind(this)),d.set("text",""),this.setState("no_auth"))},_addLogoutMemberHandler:function(){var a=this,b=function(){a.resources.W.SiteMembers.logout()};return b},_centerButton:function(){{var a=this._skinParts.container,b=a.getSize(),c=b.x,d=b.y,e=this.getHeight()-d;this.getWidth()-c}a.setStyle("margin-top",e/2),this._skinParts.actionTitle.setStyle("width",this.getWidth()),this._skinParts.memberTitle.setStyle("width",this.getWidth()),this.setMinH(d)},_onResize:function(){this._centerButton(),this.parent()}})}),define.component("wysiwyg.viewer.components.MatrixGallery",function(a){var b=a;b.inherits("mobile.core.components.base.BaseComponent"),b.utilize(["wysiwyg.viewer.utils.ComponentSequencer"]),b.binds(["_increaseTotalMaxRows","_sequencingHook","_handleEditModeChange","_handleViewerModeChange"]),b.resources(["W.Config","W.Commands"]),b.dataTypes(["ImageList"]),b.skinParts({imageItem:{type:"wysiwyg.viewer.components.Displayer",repeater:!0,container:"itemsContainer",dataRefField:"items",argObject:{unit:"px"}},itemsContainer:{type:"htmlElement"},showMore:{type:"htmlElement"}}),b.states(["fullView","hiddenChildren"]),b.propertiesSchemaType("MatrixGalleryProperties"),b.fields({EDITOR_META_DATA:{general:{settings:!0,design:!0},custom:[{label:"GALLERY_ORGANIZE_PHOTOS",command:"WEditorCommands.OpenListEditDialog",commandParameter:{galleryConfigID:"MatrixGallery",publicMediaFile:"photos",selectionType:"multiple",mediaType:"picture",i18nPrefix:"multiple_images",source:"fpp"},commandParameterDataRef:"SELF"},{label:"CHANGE_GALLERY_TYPE",command:"WEditorCommands.OpenChangeGalleryDialog",commandParameter:{}}],dblClick:{command:"WEditorCommands.OpenListEditDialog",commandParameter:{galleryConfigID:"MatrixGallery",publicMediaFile:"photos",selectionType:"multiple",mediaType:"picture",i18nPrefix:"multiple_images",source:"dblclick"},commandParameterDataRef:"SELF"},mobile:{previewImageDataRefField:"*"}},_itemsRef:[],_galleryItems:[],_totalMaxRows:0,_numCols:0,_numRows:0,_gap:0,_itemWidth:-1,_itemHeight:-1,_transitionProp:"",_numItems:0,_imageMode:"",_transitionsOn:!0,_Tween:null,_widthDiff:0,_heightDiff:0,_minDisplayerWidth:5,_minDisplayerHeight:5,_renderingPhase:"normal",_defaultButtonLabel:"Show More"}),b.methods({initialize:function(a,b,c){this.parent(a,b,c),this._transitionProp=this.injects().Utils.getCSSBrowserFeature("transition"),this._Tween=this.injects().Utils.Tween,this.setMaxW(1e4),this.setMaxH(1e4),this._sequencer=new this.imports.ComponentSequencer,this._sequencer.resolveItem=c&&c.sequencingHook?c.sequencingHook:this._sequencingHook,this.resources.W.Commands.registerCommandAndListener("WPreviewCommands.WEditModeChanged",this,this._handleEditModeChange),this.resources.W.Commands.registerCommandAndListener("WPreviewCommands.ViewerStateChanged",this,this._handleViewerModeChange)},_handleEditModeChange:function(a,b){"PREVIEW"===(b&&b.source)&&this._setTotalMaxRows(this._getRowNumber()),this._isInEditingMode()&&this._onDataChange()},_onRender:function(){this._setButtonLabelText()},_setButtonLabelText:function(){var a=this.getComponentProperties();void 0!==this._skinParts.showMore&&(this._skinParts.showMore.textContent=void 0===a.get("showMoreLabel")?this._defaultButtonLabel:a.get("showMoreLabel"))},_sequencingHook:function(){return{comp:"wysiwyg.viewer.components.Displayer",skin:this._skin.compParts.imageItem.skin}},_handleEditModeChange:function(){this._isInEditingMode()&&this._onDataChange()},_handleViewerModeChange:function(){this._onDataChange()},_isInEditingMode:function(){return!this.resources.W.Config.env.isEditorInPreviewMode()},_onDataChange:function(){var a,b;this._numItems=this._data.get("items").length,this._numCols=parseInt(this.getComponentProperty("numCols")),this._numRows=this._getRowNumber(),this._gap=parseInt(this.getComponentProperty("margin")),this._imageMode=String(this.getComponentProperty("imageMode")),this._updateState(),-1===this._itemWidth?this._calculateItemSize():this._numItems>0&&(a=Math.round(this._numCols*this._itemWidth+(this._numCols-1)*this._gap),b=Math.round(this._numRows*this._itemHeight+(this._numRows-1)*this._gap),this._setContainerWidth(a),this._setContainerHeight(b),this._positionAllItems(),this.fireEvent("autoSized")),this._updateSizeLimits(),this.parent()},_skinParamsChange:function(a){var b,c,d=this._galleryItems;"size"===_.values(a)[0]&&(b=d[0]?d[0].getLogic():"",b&&(c=b.getOldHeightDiff(),this._itemHeight=this._itemHeight-(c-b.getHeightDiff()),this._onDataChange(),this.render()))},_updateGridGalleryAccordingToData:function(){var a,b;this._numItems=this._data.get("items").length,this._numCols=parseInt(this.getComponentProperty("numCols")),this._numRows=this._getRowNumber(),this._gap=parseInt(this.getComponentProperty("margin")),this._imageMode=String(this.getComponentProperty("imageMode")),this._updateState(),-1===this._itemWidth?this._calculateItemSize():this._numItems>0&&(a=Math.round(this._numCols*this._itemWidth+(this._numCols-1)*this._gap),b=Math.round(this._numRows*this._itemHeight+(this._numRows-1)*this._gap),this._setContainerWidth(a),this._setContainerHeight(b),this._positionAllItems(),this.fireEvent("autoSized")),this._updateSizeLimits()},_getRowNumber:function(){var a=parseInt(this.getComponentProperty("numCols")),b=parseInt(this.getComponentProperty("maxRows"));return this._numItems&&this._numItems<b*a?this._normalizeRows(b):b},_updateSizeLimits:function(){this.setMinW(this._numCols*(this._minDisplayerWidth+this._gap)+this._widthDiff-this._gap),this.setMinH(this._numRows*(this._minDisplayerHeight+this._gap)+this._heightDiff-this._gap)},_setContainerWidth:function(a){var b=a+this._widthDiff;this._skinParts.itemsContainer.setStyle("width",String(a)+"px"),this._view.setStyle("width",String(b)+"px"),this.setWidth(b,!1,!1)},_setContainerHeight:function(a){var b=a+this._heightDiff;this._skinParts.itemsContainer.setStyle("height",String(a)+"px"),this.setHeight(b,!1,!1),this._view.setStyle("height",String(b)+"px")},_updateContainerSize:function(){var a=this._view.getSize();(0==a.x||0==a.y)&&(a.x=this.getWidth(),a.y=this.getHeight());var b=a.x-this._widthDiff,c=a.y-this._heightDiff;this._skinParts.itemsContainer.setStyles({width:b+"px",height:c+"px"})},_calculateItemSize:function(){if(this._skinParts&&this._data.get("items").length>0){var a=this._view.getSize();(0==a.x||0==a.y)&&(a.x=this.getWidth(),a.y=this.getHeight());var b=a.x-this._widthDiff,c=a.y-this._heightDiff;this._itemWidth=Math.max(Math.floor((b-(this._numCols-1)*this._gap)/this._numCols),0),this._itemHeight=Math.max(Math.floor((c-(this._numRows-1)*this._gap)/this._numRows),0)}},_onAllSkinPartsReady:function(){var a=this.getComponentProperty("galleryImageOnClickAction"),b=this.getComponentProperty("expandEnabled");"unset"===a&&(b===!1?this.setComponentProperty("galleryImageOnClickAction","disabled",!0):this.setComponentProperty("galleryImageOnClickAction","zoomMode",!0)),this._sequencer.addEvent("componentSetup",function(a){this._onDisplayerCreation(a.compView.getLogic(),a.method,a.index)}.bind(this)),this._sequencer.addEvent("productionFinished",function(a){this._onSequencerFinished(a)}.bind(this)),this._skinParts.itemsContainer.setStyles({position:"relative"}),this._skinParts.showMore&&(this._skinParts.showMore.addEvent(Constants.CoreEvents.MOUSE_DOWN,this._increaseTotalMaxRows),this._skinParts.showMore.setStyles({"white-space":"nowrap"})),this._widthDiff=this._skin.widthDiff||0,this._heightDiff=this._skin.heightDiff||0,this._bottomGap=this._skin.bottomGap||0,this._calculateItemSize(),this._updateSizeLimits(),this._setCorrectedComponentSize(),this._updateContainerSize()},isPartiallyFunctionalInStaticHtml:function(){return!0},render:function(){this._newItems=[],this._sequencer.createComponents(this._skinParts.itemsContainer,this._data.get("items").slice(0,this._numCols*this._numRows))},_onSequencerFinished:function(a){this._renderingPhase="normal",this._galleryItems=a.elements,this._totalMaxRows=this.getComponentProperty("maxRows"),this._positionAllItems(),this._setupAllItems()},_setupItem:function(a){if(a.getLogic){var b=a.getLogic();b.setOwner(this),b.invalidateSize(),b.setSize(this._itemWidth,this._itemHeight-this._bottomGap,this._imageMode),this._transitionsOn&&parseFloat(a.getStyle("opacity"))<1&&(this._transitionProp?(a.setStyle(this._transitionProp,"opacity 1s"),setTimeout(function(){a.setStyle("opacity","1.0")},150)):this._Tween.to(a,1,{opacity:1}))}},_onDisplayerCreation:function(a,b){"create"==b&&"showMore"==this._renderingPhase&&a.getViewNode().setStyle("opacity","0.0")},_normalizeRows:function(a){var b=Math.floor(this._numItems/this._numCols)+(this._numItems%this._numCols>0?1:0);return Math.min(a,b)},_updateState:function(){this._numItems<=this._numRows*this._numCols?this.setState("fullView"):this.setState("hiddenChildren")},_positionAllItems:function(a){a=a||this._galleryItems;for(var b=0;b<a.length;b++){var c=this._calcItemPosition(b);a[b].setStyles({position:"absolute",left:c.left+"px",top:c.top+"px"})}},_calcItemPosition:function(a){var b=a%this._numCols,c=Math.floor((a-b)/this._numCols);return{left:b*(this._itemWidth+this._gap),top:c*(this._itemHeight+this._gap),width:this._itemWidth+this._gap,height:this._itemHeight+this._gap}},_setupAllItems:function(a){a=a||this._galleryItems;for(var b=0;b<a.length;b++)this._setupItem(a[b])},_setCorrectedComponentSize:function(){var a=this.getWidth()-(this.getWidth()-this._widthDiff-this._gap*(this._numCols-1))%this._numCols,b=this.getHeight()-(this.getHeight()-this._heightDiff-this._gap*(this._numRows-1))%this._numRows;this._view.setStyles({width:a,height:b}),this.setWidth(a,!1,!1),this.setHeight(b,!1,!1)},_onResize:function(){this.parent(),this._skinParts&&(this._calculateItemSize(),this._setCorrectedComponentSize(),this._updateContainerSize(),this._positionAllItems(),this._setupAllItems())},_checkExtremeValues:function(){if(this._itemWidth<this._minDisplayerWidth){var a=this.getWidth()-this._widthDiff;this._itemWidth=this._minDisplayerWidth,this._gap=Math.floor((a-this._numCols*this._itemWidth)/(this._numCols-1)),this.setComponentProperty("margin",this._gap)}else if(this._itemHeight<this._minDisplayerHeight){var b=this.getHeight()-this._heightDiff;this._itemHeight=this._minDisplayerHeight,this._gap=Math.floor((b-this._numRows*this._itemHeight)/(this._numRows-1)),this.setComponentProperty("margin",this._gap)}},_increaseTotalMaxRows:function(){this._setTotalMaxRows(this._normalizeRows(this._numRows+parseInt(this.getComponentProperty("incRows"))))},_setTotalMaxRows:function(a){this._numRows=a;var b=Math.floor(this._numRows*this._itemHeight+(this._numRows-1)*this._gap);this._updateState(),this._setContainerHeight(b),this._calculateItemSize(),this.fireEvent("autoSized"),this._renderingPhase="showMore",this.render()},getSequencer:function(){return this._sequencer}})}),define.component("wysiwyg.viewer.components.MediaRichText",function(a){var b=a;b.inherits("wysiwyg.viewer.components.WRichText"),b.utilize(["core.managers.components.ComponentDomBuilder"]),b.dataTypes(["MediaRichText"]),b.traits(["wysiwyg.viewer.components.traits.MediaTextHandler"]),b.binds(["_onAllInnerCompsReady"]),b.fields({_innerComponenets:{}}),b.methods({initialize:function(a,b,c){this.parent(a,b,c),this._compDomBuilder=new this.imports.ComponentDomBuilder,this.addEvent("resize",this._updateSize),this._isChildCompsReady=!1},_updateSize:function(a){var b=a||this.getViewNode().getWidth();_.forEach(this._innerComponenets,function(a){a.node.$logic&&("wysiwyg.viewer.components.WPhoto"===a.jsonData.componentType?this._updateImageSize(a,b):"wysiwyg.viewer.components.Video"===a.jsonData.componentType&&this._updateVideoSize(a,b))},this)},_updateVideoSize:function(a,b){var c,d=a.jsonData.defaultWidth;a.jsonData.width&&(d=this._getWidthMultiplier(a.jsonData)*b),d=d>b?b:d,c=d*a.jsonData.dimsRatio,a.node.$logic.setWidth(d),a.node.$logic.setHeight(c)},_updateImageSize:function(a,b){if(a.jsonData.width)a.node.$logic.setWidth(this._getWidthMultiplier(a.jsonData)*b);else{var c=a.node.$logic.getDataItem().get("width"),d=c>b?b:c;a.node.$logic.setWidth(d)}},_getWidthMultiplier:function(a){return this._isMobile?.99:a.width},_createReference4CacheNodes:function(){this.docFragment=document.createDocumentFragment(),_.forEach(this._innerComponenets,function(a){this.docFragment.appendChild(a.node)},this)},_clearCacheNodesReference:function(){delete this.docFragment},_updateText:function(){this._loadFontsToViewer();var a=this.getDataItem().get("text");this._createReference4CacheNodes(),this.getRichTextContainer().set("html",a),this._shouldUpdateLinksData()&&this._setLinksDataToElements("VIEW"),this._createInnerComponents(),this._isMobile&&this._setMobileComponentAppearance(),this._clearCacheNodesReference()},_createInnerComponents:function(){this._isChildCompsReady=!1,this._replacePlaceHoldersWithComps(),this._listenToAllChildrenReady(this._onAllInnerCompsReady)},_setStyles:function(a,b){a.setStyle("margin-top","10px"),a.setStyle("margin-bottom","10px"),b.floatValue?(a.setStyle("float",b.floatValue),a.setStyle("display",""),a.setStyle("clear","")):(a.setStyle("display",b.display),a.setStyle("clear","both"),a.setStyle("float","")),a.setStyle("margin-left",b.marginLeft),a.setStyle("margin-right",b.marginRight),a.setStyle("position","static")},_replacePlaceHoldersWithComps:function(){var a=this.getRichTextContainer().getElements("[wix-comp]");_.forEach(a,function(a){var b,c=JSON.parse(a.get("wix-comp"));if(this._innerComponenets[c.id]){var d=this._innerComponenets[c.id];d.jsonData=c,b=d.node}else b=this._createNewInnerComp(c);a.parentElement.replaceChild(b,a)},this)},_createNewInnerComp:function(a){a.layout={staticPosition:!0},W.Config.env.isViewingSecondaryDevice()&&(a.id=Constants.ViewerTypesParams.DOM_ID_PREFIX.MOBILE+a.id,this._transformDataJsonForMobile(a));var b=this._compDomBuilder.createComponent(a).rootCompNode;return"wysiwyg.viewer.components.WPhoto"===a.componentType&&this._createImagePropertiesItem(a.dataQuery),b.wixify(),this._innerComponenets[a.id]={jsonData:a,node:b},b},_prepareForRender:function(){return this._isChildCompsReady},_listenToAllChildrenReady:function(a){var b=this._getNodesReadyPromises();return Q.all(b).then(function(){a()})},_onAllInnerCompsReady:function(){this.$view.setStyle("overflow","overlay"),this._isChildCompsReady=!0,this._addAllCompsToSkinParts(),this._updateCompsStyles(),this.renderIfNeeded(),this._updateSize()},_getNodesReadyPromises:function(){var a=this._getNodesFromCompsArray();return _.map(a,function(a){var b=Q.defer();return a.$logic&&a.$logic.isReady()&&b.resolve(),a.on(Constants.ComponentEvents.READY,this,function(){b.resolve()}),b.promise},this)},_addAllCompsToSkinParts:function(){var a=this._getNodesFromCompsArray();_.forEach(a,function(a){a.$logic&&(this._skinParts[a.$logic.getComponentId()]=a.$logic)},this)},_updateCompsStyles:function(){_.forEach(this._innerComponenets,function(a){var b=a.node;b.$logic&&"wysiwyg.viewer.components.WPhoto"===b.$logic.$className&&(b.$logic._skinParts.link.setStyle("display","inline-block"),b.$logic.setUseWidthOverMinWidth(!0)),this._setStyles(b,a.jsonData)},this)},_getNodesFromCompsArray:function(){return _.map(this._innerComponenets,function(a){return a.node})},_transformDataJsonForMobile:function(a){a.marginLeft="auto",a.marginRight="auto",a.width=1,delete a.floatValue},markInnerCompsForDispose:function(){_.forEach(this._innerComponenets,function(a){a.shouldBeDisposed=!0},this)},markInnerCompAsUsed:function(a){this._innerComponenets[a]&&(this._innerComponenets[a].shouldBeDisposed=!1)},disposeUnusedComps:function(){_.forEach(this._innerComponenets,function(a){a.shouldBeDisposed&&(a.node.$logic.dispose(),delete this._innerComponenets[a.jsonData.id])},this)},dispose:function(){_.forEach(this._innerComponenets,function(a){a.node.$logic.dispose()},this),this.parent()}})}),define.component("wysiwyg.viewer.components.MediaZoom",function(a){var b=a;b.inherits("mobile.core.components.base.BaseComponent"),b.binds(["_handleCurrentItemChange","_transitionToCurrentDisplayer","gotoNextIfOpen","gotoPrevIfOpen"]),b.traits(["wysiwyg.viewer.components.traits.ListIterator"]),b.resources(["W.Config","W.Utils","W.Viewer","W.InputBindings"]),b.skinParts({blockingLayer:{type:"htmlElement",command:"WViewerCommands.MediaZoom.Close"},dialogBox:{type:"htmlElement"},xButton:{type:"htmlElement",command:"WViewerCommands.MediaZoom.Close"},virtualContainer:{type:"htmlElement"},itemsContainer:{type:"htmlElement"},counter:{type:"htmlElement"},buttonPrev:{type:"htmlElement",command:"WViewerCommands.MediaZoom.Prev"},buttonNext:{type:"htmlElement",command:"WViewerCommands.MediaZoom.Next"}}),b.fields({transitionTime:"normal",_inTransition:!1,_lastCurrentItem:null}),b.methods({initialize:function(a,b,c){this.isVolatile=!0,this.parent(a,b,c);var d=this.injects().Commands;d.registerCommandAndListener("WViewerCommands.MediaZoom.Close",this,this._closeZoom,null,!0),d.registerCommandAndListener("WViewerCommands.MediaZoom.Next",this,this.gotoNextIfOpen,null,!0),d.registerCommandAndListener("WViewerCommands.MediaZoom.Prev",this,this.gotoPrevIfOpen,null,!0),d.registerCommandAndListener("WPreviewCommands.WEditModeChanged",this,this._onEditorModeChanged,null,!0),this.addEvent("currentItemChanged",this._handleCurrentItemChange),this.collapse()},_onAllSkinPartsReady:function(){var a=function(a){a.stopPropagation()};this._skinParts.dialogBox.addEvent("click",a),this._skinParts.buttonNext.addEvent("click",a),this._skinParts.buttonPrev.addEvent("click",a),this._skinParts.xButton.addEvent("click",a)},gotoNextIfOpen:function(){this.isZoomOpened()&&this.gotoNext()},gotoPrevIfOpen:function(){this.isZoomOpened()&&this.gotoPrev()},setGallery:function(a,b,c,d,e){this._validateArgs(a,b)&&(this._opened=!0,this._getDisplayerDivFunction=c,this._getHashPartsFunction=d,this._extraParams=e||{},this.setDataItem(a),this.setListAndCurrentIndex(a,b),this._setNextPrevVisibility(),this._bindKeyboardShortcuts())},setImage:function(a,b,c,d){var e=this.injects().Data.createDataItem({type:"list",items:[a]});this.setGallery(e,0,b,c,d)},showZoomImage:function(){if(this._currentItem&&this._currentItem!=this._lastCurrentItem){var a=this._getWindowSize(),b=this.getSkin().getParams().first(function(a){return"$marginIncludingArrow"===a.id});this._imageMaxWidth=a.width-2*b.defaultValue,this._imageMaxHeight=a.height-60,this._lastCurrentItem=this._currentItem,this._renderCurrentDisplayer(this._transitionToCurrentDisplayer),this._skinParts.counter.set("text",String(this._currentItemIndex+1)+"/"+String(this._numItems)),this.injects().Viewer.enterFullScreenMode(),this.uncollapse()}},_getWindowSize:function(){if(this.resources.W.Config.mobileConfig.isMobile()){var a=this.resources.W.Viewer.getDocWidth(),b=window.innerHeight||document.documentElement&&document.documentElement.clientHeight;return{width:a,height:b}}return this.resources.W.Utils.getWindowSize()},_onEditorModeChanged:function(){this._closeZoom()},_closeZoom:function(){this.collapse(),this.injects().Viewer.exitFullScreenMode(),this.setDataItem(null),this.resetIterator(),this._skinParts.virtualContainer.empty(),this._skinParts.itemsContainer.empty(),this._skinParts.dialogBox.setStyles({width:"100px"}),this._opened=!1,this.unlock(),this._lastCurrentItem=null,this._unbindKeyboardShortcuts()},_handleCurrentItemChange:function(){this.lock();var a=function(a){var b=this.injects().Utils.hash.getHashParts();b.id===a.id&&b.extData===a.extData?this.showZoomImage():this.injects().Utils.hash.setHash(a.id,a.title,a.extData,!0)}.bind(this);this._getHashPartsFunction?this._getHashPartsFunction(this._currentItem,a):this.showZoomImage()},_renderCurrentDisplayer:function(){for(var a=this._skinParts.virtualContainer,b=0;b<a.childNodes.length;b++)a.childNodes[b].destroy();var c=this;this._getDisplayerDivFunction(this._currentItem,{container:c._skinParts.virtualContainer,x:this._imageMaxWidth,y:this._imageMaxHeight},function(a){a.getParent('[skinpart="virtualContainer"]')||a.insertInto(c._skinParts.virtualContainer),c._transitionToCurrentDisplayer(a)})},_transitionToCurrentDisplayer:function(a){if(!this._inTransition){this._inTransition=!0,a.setStyle("opacity","0.0");var b=this._skinParts.itemsContainer,c=this,d=function(){for(var d=0;d<b.childNodes.length;d++)b.childNodes[d].destroy();b.empty();var f=a.getSize(),g=c._getTopGap(f.y);b.adopt(a),c._skinParts.virtualContainer.empty();var h=new Fx.Morph(c._skinParts.dialogBox,{duration:c.transitionTime,link:"chain"});h.addEvent("complete",function(){var b=new Fx.Tween(a,{duration:c.transitionTime,link:"chain"});b.addEvent("complete",function(){c.unlock(),c._inTransition=!1,b.removeEvent("complete",arguments.callee)}),b.start("opacity","1.0"),h.removeEvent("complete",arguments.callee)}),h.start({width:f.x+"px","min-height":f.y+"px","margin-top":g+"px"}),e&&e.removeEvent("complete",arguments.callee)};if(b.hasChildNodes()){var e=new Fx.Tween(b.firstChild,{duration:c.transitionTime,link:"chain",property:"opacity"});e.addEvent("complete",d),e.start("0.0")}else d()}},_changeImageNoTransition:function(a){for(var b=this._skinParts.itemsContainer,c=this,d=0;d<b.childNodes.length;d++)b.childNodes[d].destroy();b.empty();var e=a.getStyles("width","height"),f=c._getTopGap(e.height.replace("px",""));b.adopt(a),c._skinParts.virtualContainer.empty(),c._skinParts.dialogBox.setStyles({width:e.width,"min-height":e.height,"margin-top":f+"px"}),c.unlock()},_getTopGap:function(a){if(this._isEditingMobile())return 0;var b=this.injects().Utils.getWindowSize(),c=(b.height-a)/2;return c>0?c:0},_isEditingMobile:function(){return this.resources.W.Config.env.isInDeactivatedViewer()&&this.resources.W.Config.env.isViewingSecondaryDevice()},_validateArgs:function(a,b){if(!a)return!1;var c=a.length;return a.length<1?!1:0>b||b>=c?(LOG.reportError(wixErrors.EDITOR_INDEX_OUT_OF_RANGE,"wysiwyg.viewer.components.MediaZoom","setGallery",b),!1):!0},_setNextPrevVisibility:function(){this._skinParts.buttonNext.uncollapse(),this._skinParts.buttonPrev.uncollapse(),(this.getDataItem().get("items").length<=1||this._extraParams.hideNextPrevBtns)&&this.hideNextPrevButtons()},hideNextPrevButtons:function(){this._skinParts.buttonNext.collapse(),this._skinParts.buttonPrev.collapse()},_getItemId:function(a){var b="string"==typeof a?a:a.get("id");return 0==b.indexOf("#")?b.substr(1):b},_opened:!1,isZoomOpened:function(){return this._opened},_bindKeyboardShortcuts:function(){var a=this.resources.W.InputBindings;a.addBinding("left",{commandName:"WViewerCommands.MediaZoom.Prev",keypressType:"keydown"}),a.addBinding("right",{commandName:"WViewerCommands.MediaZoom.Next",keypressType:"keydown"}),a.addBinding("esc",{commandName:"WViewerCommands.MediaZoom.Close",keypressType:"keydown"})},_unbindKeyboardShortcuts:function(){var a=this.resources.W.InputBindings;a.removeBinding("left","keydown"),a.removeBinding("right","keydown"),a.removeBinding("esc","keydown")},validateArgs:function(a,b){if(!a)return!1;var c=a.length;return a.length<1?!1:0>b||b>=c?(LOG.reportError(wixErrors.EDITOR_INDEX_OUT_OF_RANGE,"wysiwyg.viewer.components.MediaZoom","setGallery",b),!1):!0}})}),define.component("wysiwyg.viewer.components.MediaZoomDisplayer",function(a){var b=a;b.inherits("mobile.core.components.base.BaseComponent"),b.binds(["_setCorrectImageSize","_closeMediaZoom"]),b.dataTypes(["Image"]),b.resources(["W.Data"]),b.utilize(["wysiwyg.common.utils.LinkRenderer"]),b.skinParts({title:{type:"htmlElement",optional:!1},description:{type:"htmlElement",optional:!1},link:{type:"htmlElement",optional:!0},imageWrapper:{type:"htmlElement",command:"WViewerCommands.MediaZoom.Next"},image:{type:"core.components.Image",dataRefField:"*",optional:!1,hookMethod:"_addImageArgs"}}),b.states({link:["showLink","hideLink"]}),b.fields({_minWidth:600,_maxWidth:-1,_maxHeight:-1,_imgActualSize:{x:0,y:0}}),b.methods({initialize:function(a,b,c){this.parent(a,b,c),this._maxWidth=c.maxWidth,this._maxHeight=c.maxHeight,this._linkRenderer=new this.imports.LinkRenderer},_tweetHookMethod:function(a){return a.dataItem=this.injects().Data.createDataItem({defaultText:"",accountToFollow:"",type:"TwitterTweet"},"TwitterTweet"),a},_addImageArgs:function(a){this._imageDimensionsClass=this.injects().Classes.get("core.components.image.ImageDimensions"),this._imageDimensions=new this._imageDimensionsClass,this._imageDimensions.setCropMode(this._imageDimensionsClass.settingOptions.crop.FULL),this._imageDimensions.setFullScreenMode();var b=this.getSkin().getParams().first(function(a){return"imgPadding"===a.id});this._maxWidth=this._maxWidth-2*b.defaultValue;var c=this._imageDimensions.getDimensionsForContainerSize({x:this.getDataItem().get("width"),y:this.getDataItem().get("height")},{x:this._getImageWidth(),y:this._getImageHeight()});return this._imgActualSize=c.imageVisibleSize,a.argObject={unit:"px",cropMode:"full",width:this._imgActualSize.x,height:this._imgActualSize.y},a},_onAllSkinPartsReady:function(){this.parent(),this._skinParts.comments&&(this._minWidth=600),this._setCorrectImageSize(this._imgActualSize),this._updateParts()},_updateParts:function(){if(this._skinParts){this._skinParts.title.set("text",this._data.get("title")),this._skinParts.description.set("text",this._data.get("description"));var a=this.getDataItem().get("link");if(a){var b=this.resources.W.Data.getDataByQuery(a),c=this._skinParts.link;this._linkRenderer.renderLink(c,b,this),this.setState("showLink","link")}else this.setState("hideLink","link")}this._addCloseEventForLinkIfNeeded()},_addCloseEventForLinkIfNeeded:function(){var a=this.getDataItem().get("link"),b=a&&W.Data.getDataByQuery(a),c=b&&b.getType();"AnchorLink"===c&&this._skinParts&&this._skinParts.link&&this._skinParts.link.addEvent("click",this._closeMediaZoom)},_closeMediaZoom:function(){this.resources.W.Commands.executeCommand("WViewerCommands.MediaZoom.Close",this)},_setCorrectImageSize:function(a){var b=a.y,c=this._getDisplayerWidth(a.x);this._skinParts.imageWrapper.setStyles({width:c+"px",height:b+"px","min-width":"600px"}),this._skinParts.title.setStyles({"max-width":c+"px","word-wrap":"break-word"}),this._skinParts.description.setStyles({"max-width":c+"px","word-wrap":"break-word"})},_getDisplayerWidth:function(a){return a<this._minWidth?this._minWidth:a},_getImageWidth:function(){var a=this._data.get("width");return this._maxWidth<0||a<=this._maxWidth?a:this._maxWidth},_getImageHeight:function(){var a=this._data.get("height");return this._maxHeight<0||a<=this._maxHeight?a:this._maxHeight}})}),define.component("wysiwyg.viewer.components.MessageView",function(a){var b=a;b.inherits("mobile.core.components.base.BaseComponent"),b.skinParts({blockingLayer:{type:"htmlElement"},okButton:{type:"core.editor.components.EditorButton"},title:{type:"htmlElement"},description:{type:"htmlElement"},dialog:{type:"htmlElement"}}),b.binds(["_closeView"]),b.resources(["W.Commands"]),b.methods({_onAllSkinPartsReady:function(a){a.okButton.setLabel("OK"),a.okButton.addEvent("buttonClick",this._closeView)},showMessage:function(a){this.uncollapse(),this._skinParts.title.set("html",a.msgTitle||""),this._skinParts.description.set("html",a.msgBody||""),this._visible=!0},hideMessage:function(){this.collapse(),this._visible=!1},visible:function(){return this._visible},_closeView:function(){this.hideMessage(),this.fireEvent("complete")}})}),define.component("wysiwyg.viewer.components.MobileMediaZoom",function(a){var b=a;b.resources(["W.Viewer","W.Config","W.Utils","W.Commands"]),b.states({showButtons:["doShowButtons","dontShowButtons"],orientation:["portrait","landscape"],viewerType:["desktop","mobile","tablet"]}),b.binds(["_onOrientationChange","_preventEvent","_changeButtonsVisibility","_closeZoom","gotoNext","gotoPrev","_preventTouchStart","_getDisplayerCallback"]),b.inherits("wysiwyg.viewer.components.MediaZoom"),b.skinParts({blockingLayer:{type:"htmlElement"},dialogBox:{type:"htmlElement"},xButton:{type:"htmlElement"},virtualContainer:{type:"htmlElement"},itemsContainer:{type:"htmlElement"},counter:{type:"htmlElement"},buttonPrev:{type:"htmlElement",command:"WViewerCommands.MediaZoom.Prev"},buttonNext:{type:"htmlElement",command:"WViewerCommands.MediaZoom.Next"}}),b.fields({transitionTime:"short",_inTransition:!1,_lastCurrentItem:null}),b.methods({initialize:function(a,b,c){this._isMobilePreviewMode=W.Config.env.$isEditorViewerFrame,this._fontSizeCorrectionWhenOpenZoomInPortrait=1.1,this.isVolatile=!0,this.parent(a,b,c);var d=this.injects().Commands;d.registerCommandAndListener("WViewerCommands.MediaZoomDisplayer.PanelTextVisibilityChanged",this,this._changeButtonsVisibility,null,!0),this.addEvent("currentItemChanged",this._handleCurrentItemChange),this.collapse(),this._mobileConfig=this.injects().Config.mobileConfig,this._setInitZoom(),this.resources.W.Config.env.getCurrentFrameDevice()===Constants.ViewerTypesParams.TYPES.MOBILE?this.setState("mobile","viewerType"):this.resources.W.Config.mobileConfig.isTablet()?this.setState("tablet","viewerType"):this.setState("desktop","viewerType"),d.registerCommand("WViewerCommands.MobileMediaZoom.Closed",!0)},_setInitZoom:function(){return this._isMobilePreviewMode?1:(this._initZoom=this._mobileConfig.getInitZoom(),this._initZoom)},fixZoom:function(){if(this._isMobilePreviewMode||"mobile"===this.getState("viewerType"))return 1;(!this._initZoom||this._initZoom<0||this._initZoom>5)&&this._setInitZoom();var a=this._initZoom/this._mobileConfig.getZoom();this._skinParts.xButton.style.zoom=a,this._skinParts.buttonPrev.style.zoom=a,this._skinParts.buttonNext.style.zoom=a},_setOrientation:function(){setTimeout(this.fixZoom.bind(this),300)},_onAllSkinPartsReady:function(){this.parent(),this._mobileConfig.isMobileOrTablet()&&(Hammer(this._view).on("swipeleft",this.gotoNext),Hammer(this._view).on("swiperight",this.gotoPrev)),setTimeout(this.fixZoom.bind(this),300);var a=["click","mousedown","touchstart"],b=["mousemove","touchmove"];this._registerEvents(this._skinParts.xButton,a,function(a){return setTimeout(function(){this._closeZoom(a)}.bind(this),500),this._preventEvent(a)}.bind(this)),this._registerEvents(this._skinParts.buttonPrev,a,function(a){return this.gotoPrev(a),this._preventEvent(a)}.bind(this)),this._registerEvents(this._skinParts.buttonNext,a,function(a){return this.gotoNext(a),this._preventEvent(a)}.bind(this)),this._registerEvents(this._skinParts.xButton,b,this._preventEvent),this._registerEvents(this._skinParts.buttonPrev,b,this._preventEvent),this._registerEvents(this._skinParts.buttonNext,b,this._preventEvent)
},_registerEvents:function(a,b,c){_.forEach(b,function(b){a.addEvent(b,c)})},_onOrientationChange:function(){if(this._currentDisplayer&&this._currentDisplayer.hideContent(),this.showZoomImage(!this._extraParams.disableRerender),this._setOrientation(),this._extraParams.disableRerender){var a=this;_.delay(function(){var b=a.resources.W.Utils.getWindowSize().width;a._currentDisplayer.showContent(),a._currentDisplayer.setWidth(b)},300)}},_changeButtonsVisibility:function(a){a?this.setState("doShowButtons","showButtons"):this.setState("dontShowButtons","showButtons")},_closeZoom:function(){this.collapse(),this.injects().Viewer.exitFullScreenMode(),this.setDataItem(null),this.resetIterator(),this._skinParts.virtualContainer.empty(),this._skinParts.itemsContainer.empty(),this._opened=!1,this.unlock(),this._lastCurrentItem=null,this._enableScroll(),window.removeEvent("orientationchange",this._onOrientationChange),this._enableZoomAndMagnifier(),this._refreshQuickActions();var a=this.injects().Commands;a.executeCommand("WViewerCommands.MobileMediaZoom.Closed")},showZoomImage:function(a){if(this._mobileConfig.isMobileOrTablet()&&window.addEvent("orientationchange",this._onOrientationChange),this._disableScroll(),a||this._currentItem&&this._currentItem!=this._lastCurrentItem){var b=this.injects().Utils.getWindowSize(),c=this.getSkin().getParams().first(function(a){return"$marginIncludingArrow"===a.id});this._imageMaxWidth=b.width-2*c.defaultValue,this._imageMaxHeight=b.height-60,this._lastCurrentItem=this._currentItem,this._renderCurrentDisplayer(this._transitionToCurrentDisplayer),this._skinParts.counter.set("text",String(this._currentItemIndex+1)+"/"+String(this._numItems)),this.injects().Viewer.enterFullScreenMode(),this.uncollapse()}},_renderCurrentDisplayer:function(){for(var a=this._skinParts.virtualContainer,b=0;b<a.childNodes.length;b++)a.childNodes[b].destroy();var c={container:this._skinParts.virtualContainer,x:this._imageMaxWidth,y:this._imageMaxHeight};_.delay(this._getDisplayerDivFunction,500,this._currentItem,c,this._getDisplayerCallback)},_getDisplayerCallback:function(a){if(a.getParent('[skinpart="virtualContainer"]')||a.insertInto(this._skinParts.virtualContainer),this._changeImageNoTransition(a),"edit"!==document.body.getAttribute("preview")){this._enableZoomScroll&&(document.body.addClass("wixappsFullScreenMode"),window.setTimeout(function(){var b=this.resources.W.Utils.getWindowSize().width;a.getLogic().setWidth(b)}.bind(this),10),this._view.setStyles({position:"absolute",top:0}),this._skinParts.blockingLayer.setStyles({position:"static","overflow-x":"hidden"}),window.WQuickActions&&this._mobileConfig.isAndroidOldBrowser()&&window.WQuickActions.hideBar()),window.scrollTo(0,0);var b={height:this._skinParts.blockingLayer.getHeight(),top:0};this.resources.W.Commands.executeCommand("WPreviewCommands.resetCustomScrollbar",b)}this._currentDisplayer=a.getLogic()},_changeImageNoTransition:function(a){for(var b=this._skinParts.itemsContainer,c=this,d=0;d<b.childNodes.length;d++)b.childNodes[d].destroy();b.empty();var e=a.getStyles("width","height"),f=c._getTopGap(e.height.replace("px",""));b.adopt(a),c._skinParts.virtualContainer.empty(),c._skinParts.dialogBox.setStyles({"min-height":e.height,"margin-top":f+"px"}),c.unlock()},setGallery:function(a,b,c,d,e){e&&(this._mobileConfig.isMobile()&&e.enableSwipe===!1&&(Hammer(this._view).off("swipeleft",this.gotoNext),Hammer(this._view).off("swiperight",this.gotoPrev)),this._enableZoomScroll=e.enableScroll),this._pos={left:window.pageXOffset,top:window.pageYOffset},this.parent(a,b,c,d,e),this._disableZoomAndMagnifier(),setTimeout(this.fixZoom.bind(this),300)},_disableZoomAndMagnifier:function(){if(!this._isMobilePreviewMode)if("mobile"===this.getState("viewerType"))if(W.Viewer.removeViewerRotationListener(),this._mobileConfig.isAndroidOldBrowser()){var a=this._enableZoomScroll;a||this._androidDoubleClickFix(),_.delay(this._androidZoomScaleFix,100),this.addAndroidScaleFix()}else W.Viewer.setViewportTag(Constants.ViewerTypesParams.DOC_WIDTH.MOBILE,this._initZoom);else{var b=this._mobileConfig.getZoom();this.resources.W.Viewer.setViewportAttribute("minimum-scale",b),this.resources.W.Viewer.setViewportAttribute("maximum-scale",b)}},_enableZoomAndMagnifier:function(){this._isMobilePreviewMode||("mobile"===this.getState("viewerType")?(this._mobileConfig.isAndroidOldBrowser()&&this.removeAndroidScaleFix(),W.Viewer.addViewerRotationListener(),W.Viewer.resetViewportTag()):(this.resources.W.Viewer.setViewportAttribute("minimum-scale",.25),this.resources.W.Viewer.setViewportAttribute("maximum-scale",1.2)))},addAndroidScaleFix:function(){window.addEventListener("orientationchange",this._androidZoomScaleFix,!1)},removeAndroidScaleFix:function(){window.removeEventListener("orientationchange",this._androidZoomScaleFix)},_androidZoomScaleFix:function(){W.Viewer.setViewportTag(Constants.ViewerTypesParams.DOC_WIDTH.MOBILE,1),W.Viewer.setViewportTag("device-width",1)},_androidDoubleClickFix:function(){var a=this._view;a.addEventListener("touchstart",this._preventEvent)},_refreshQuickActions:function(){window.WQuickActions&&window.WQuickActions.startZooming()},_disableScroll:function(){this._enableZoomScroll||document.addEvent("touchmove",this._preventEvent)},_preventTouchStart:function(a){console.log(a.type),this._preventEvent(a)},_preventEvent:function(a){return a.preventDefault(),a.stopPropagation(),!1},_enableScroll:function(){this._pos=this._pos||{top:0,left:0},this._enableZoomScroll?(document.body.removeClass("wixappsFullScreenMode"),this._view.setStyles({position:"fixed",top:"auto"}),this._skinParts.blockingLayer.setStyles({position:"fixed","overflow-x":"auto"}),this._enableZoomScroll=!1):(document.removeEvent("touchmove",this._preventEvent),document.removeEvent("touchstart",this._preventTouchStart)),window.scrollTo(this._pos.left,this._pos.top),W.Config.env.$isEditorViewerFrame&&this.resources.W.Commands.executeCommand("WPreviewCommands.resetCustomScrollbar",{top:this._pos.top})}})}),define.component("wysiwyg.viewer.components.MobileMediaZoomDisplayer",function(a){var b=a;b.inherits("wysiwyg.viewer.components.MediaZoomDisplayer"),b.binds(["_onImageWrapperClick"]),b.resources(["W.Commands","W.Config","W.Viewer"]),b.statics({FONT_MULTIPLIER:{DESKTOP_SITE:8,MOBILE_SITE:2.5,TABLET_SITE:4}}),b.skinParts({notAllDescriptionPresentedIndicator:{type:"htmlElement",optional:!1},title:{type:"htmlElement",optional:!1},description:{type:"htmlElement",optional:!1},link:{type:"htmlElement",optional:!0},imageWrapper:{type:"htmlElement"},image:{type:"core.components.Image",dataRefField:"*",optional:!1,hookMethod:"_addImageArgs"}}),b.states({link:["showLink","hideLink"],descriptionPresentationMode:["showLimitedDescription","showAllDescription"],showPanelText:["doShowPanelText","dontShowPanelText"],orientation:["portrait","landscape"],displayDevice:["desktop","mobile","tablet"]}),b.methods({initialize:function(a,b,c){this._fontSizeCorrectionWhenOpenZoomInPortrait=1.1,this.parent(a,b,c);var d=this._getDeviceSize();this._maxWidth=d.width,this._maxHeight=d.height,this._mobileConfig=this.resources.W.Config.mobileConfig,this.resources.W.Config.env.getCurrentFrameDevice()===Constants.ViewerTypesParams.TYPES.MOBILE?this.setState("mobile","displayDevice"):this.resources.W.Config.mobileConfig.isTablet()?this.setState("tablet","displayDevice"):this.setState("desktop","displayDevice"),this._isMobilePreviewMode=W.Config.env.$isEditorViewerFrame},_onAllSkinPartsReady:function(){this.parent(),this.setState("showLimitedDescription","descriptionPresentationMode"),this._changeFontSizes(),this._initZoom=this._isMobilePreviewMode?1:this._mobileConfig.getInitZoom(),this.setState("doShowPanelText","showPanelText"),this._setZoomModeFontSize(),this._mobileConfig.isMobile()?this._addMobileEvents():this._addDesktopEventsForPreview()},_addMobileEvents:function(){this._skinParts.title.addEvent("touchstart",this._onDescriptionClick.bind(this)),this._skinParts.description.addEvent("touchstart",this._onDescriptionClick.bind(this)),this._skinParts.link.addEvent("touchstart",function(a){a.target.fireEvent("click"),a.stopPropagation()}),Hammer(this._skinParts.imageWrapper).on("tap",this._onImageWrapperClick)},_addImageArgs:function(a){return a=this.parent(a),a.argObject=a.argObject||{},a.argObject.fetchImageForMobile="mobile"===this.getState("displayDevice")?!0:!1,a},_addDesktopEventsForPreview:function(){this._skinParts.title.addEvent("click",this._onDescriptionClick.bind(this)),this._skinParts.description.addEvent("click",this._onDescriptionClick.bind(this)),this._skinParts.imageWrapper.addEvent("click",this._onImageWrapperClick)},_setZoomModeFontSize:function(){var a,b=this._isMobilePreviewMode?1:this._initZoom/this._mobileConfig.getZoom();switch(this.getState("displayDevice")){case"desktop":a=this.FONT_MULTIPLIER.DESKTOP_SITE;break;case"tablet":a=this.FONT_MULTIPLIER.TABLET_SITE;break;case"mobile":a=this.FONT_MULTIPLIER.MOBILE_SITE;break;default:a=this.FONT_MULTIPLIER.DESKTOP_SITE}var c=a*b;this._mobileConfig.isPortrait()&&(c*=this._fontSizeCorrectionWhenOpenZoomInPortrait),this._view.setStyle("font-size",c+"px")},render:function(){this.parent(),this._limitedDescriptionHeight=1.14*parseInt(this._skinParts.description.getStyle("font-size"))*2+"px",this._fullDescriptionHeight=this._skinParts.description.getStyle("height"),this._skinParts.description.setStyle("height",this._limitedDescriptionHeight),this._canDescriptionExpand()||this._skinParts.notAllDescriptionPresentedIndicator.setStyle("visibility","hidden"),this.resources.W.Commands.executeCommand("WViewerCommands.MediaZoomDisplayer.PanelTextVisibilityChanged",!0)},_onDescriptionClick:function(a){if(this._canDescriptionExpand()){var b="showLimitedDescription"==this.getState("descriptionPresentationMode")?"showAllDescription":"showLimitedDescription";this.setState(b,"descriptionPresentationMode");var c="showLimitedDescription"==b?!0:!1;this.resources.W.Commands.executeCommand("WViewerCommands.MediaZoomDisplayer.PanelTextVisibilityChanged",c),this._animateDescriptionHeightTransition(b),this._animateImageWrapperOpacityTransition(b),a.stopPropagation()}},_onImageWrapperClick:function(){if(this._changeButtonsVisibilityTimer)return!0;this._changeButtonsVisibilityTimer=setTimeout(function(){this._changeButtonsVisibilityTimer=null}.bind(this),500);var a="doShowPanelText"==this.getState("showPanelText")?"dontShowPanelText":"doShowPanelText";this.setState(a,"showPanelText");var b="doShowPanelText"==a?!0:!1;this.resources.W.Commands.executeCommand("WViewerCommands.MediaZoomDisplayer.PanelTextVisibilityChanged",b)},_canDescriptionExpand:function(){return parseInt(this._fullDescriptionHeight)>parseInt(this._limitedDescriptionHeight)},_animateDescriptionHeightTransition:function(a){var b=new Fx.Tween(this._skinParts.description,{duration:"short",link:"chain",property:"height"}),c="showLimitedDescription"===a?this._limitedDescriptionHeight:this._fullDescriptionHeight;b.addEvent("complete",function(){"showLimitedDescription"===this.getState("descriptionPresentationMode")?this._skinParts.notAllDescriptionPresentedIndicator.setStyle("visibility","visible"):this._skinParts.notAllDescriptionPresentedIndicator.setStyle("visibility","hidden")}.bind(this)),b.start(c)},_animateImageWrapperOpacityTransition:function(a){var b=new Fx.Tween(this._skinParts.imageWrapper,{duration:"short",link:"chain",property:"opacity"}),c="showLimitedDescription"===a?"1":"0.65";b.start(c)},_getDeviceSize:function(){return{width:window.innerWidth,height:window.innerHeight}},_setCorrectImageSize:function(a){{var b=a.y;this._getDisplayerWidth(a.x)}this._skinParts.imageWrapper.setStyles({width:"100%",height:b+"px"}),this._skinParts.title.setStyles({"word-wrap":"break-word"}),this._skinParts.description.setStyles({"word-wrap":"break-word"})},hideContent:function(){this._skinParts.image.collapse(),this._skinParts.panel.collapse()},showText:function(){this._skinParts.title.uncollapse(),this._skinParts.description.uncollapse(),this._skinParts.notAllDescriptionPresentedIndicator.uncollapse(),this._skinParts.link.uncollapse()},hideText:function(){this._skinParts.title.collapse(),this._skinParts.description.collapse(),this._skinParts.notAllDescriptionPresentedIndicator.collapse(),this._skinParts.link.collapse()},_changeFontSizes:function(){90==window.orientation||-90==window.orientation?this.setState("landscape","orientation"):this.setState("portrait","orientation")}})}),define.component("wysiwyg.viewer.components.Modal",function(a){var b=a;b.inherits("mobile.core.components.base.BaseComponent"),b.binds(["_onCloseClick","_onBlockingLayerClick","_onViewportResize"]),b.resources(["W.Commands"]),b.skinParts({blockingLayer:{type:"htmlElement"},close:{type:"htmlElement"},innerComponent:{hookMethod:"_innerComponentDefinition"}}),b.methods({initialize:function(a,b,c){this.parent(a,b,c),c=c||{},this.disableBlockLayer=c.disableBlockLayer,this._origin=c.innerComponentArgs.argObject.origin,this._viewportSize=window.getSize(),this._innerComponentArgs=c.innerComponentArgs,this._innerComponentsize=null,this.resources.W.Commands.registerCommandListenerByName("WPreviewCommands.WEditModeChanged",this,this.dispose)},render:function(){this.setSize();var a=0,b=0;"50%"==this._skinParts.innerComponent.getTop()&&(a=this._skinParts.innerComponent.getHeight()/2),"50%"==this._skinParts.innerComponent.getLeft()&&(b=this._skinParts.innerComponent.getWidth()/2),this._setInnerCompPosition(a,b),this._setClosePosition(a,b)},_onAllSkinPartsReady:function(a){this.parent(),window.addEvent(Constants.CoreEvents.RESIZE,this._onViewportResize),a.close.addEvent(Constants.CoreEvents.CLICK,this._onCloseClick),this.disableBlockLayer?a.blockingLayer.hide():a.blockingLayer.addEvent(Constants.CoreEvents.CLICK,this._onBlockingLayerClick)},_innerComponentDefinition:function(a){return a.type=this._innerComponentArgs.type,a.skin=this._innerComponentArgs.skin,a.dataItem=this._innerComponentArgs.dataItem||this._data,a.argObject=this._innerComponentArgs.argObject,a.argObject.containingComponent=this,a},_onViewportResize:function(){this._viewportSize=window.getSize(),this._renderIfReady()},_onCloseClick:function(){this.dispose()},_onBlockingLayerClick:function(){this.dispose()},_setClosePosition:function(a,b){var c=this._skinParts.close,d=c.getSize().x/2,e=this._skinParts.innerComponent.getWidth(),f=this._skinParts.innerComponent.getHeight(),g=this._skinParts.innerComponent.getX(),h="auto"!==this._skinParts.innerComponent.getLeft(),i="auto"!==this._skinParts.innerComponent.getTop(),j=h?b?"50%":g+e-d:"auto",k=h?"auto":0,l=i?a?"50%":0:"auto",m=i?"auto":f-d;c.setStyles({left:j,right:k,top:l,bottom:m,"margin-left":b?b-d:0,"margin-top":a?-a-d:0})},_centerModal:function(){var a=this._skinParts.close,b=a.getSize(),c=this._skinParts.innerComponent.getWidth()/2,d=this._skinParts.innerComponent.getHeight()/2;this._skinParts.innerComponent.getViewNode().setStyles({"margin-left":-c,"margin-top":-d}),a.setStyles({left:"50%",top:"50%","margin-left":c-b.x/2,"margin-top":-d-b.y/2})},setSize:function(){var a,b,c,d;this._innerComponentsize=this._innerComponentsize||{width:this._skinParts.innerComponent.getWidth(),height:this._skinParts.innerComponent.getHeight()},c=this._innerComponentsize,d=this._viewportSize,a=Math.min(c.width,d.x),b=Math.min(c.height,d.y),(this._skinParts.innerComponent.getWidth()!=a||this._skinParts.innerComponent.getHeight()!=b)&&(this._skinParts.innerComponent.setWidth(a),this._skinParts.innerComponent.setHeight(b,!1,!0)),this._setClosePosition()},dispose:function(){window.removeEvent(Constants.CoreEvents.RESIZE,this._onViewportResize),this._skinParts.innerComponent&&this._skinParts.innerComponent.dispose(),this.collapse(),this.parent()},_setInnerCompPosition:function(a,b){this._skinParts.innerComponent.getViewNode().setStyles({"margin-left":-b,"margin-top":-a})}})}),define.component("wysiwyg.viewer.components.PageGroup",function(a){var b=a;b.inherits("core.components.ContainerOBC"),b.utilize(["wysiwyg.viewer.utils.TransitionUtils","core.components.Page"]),b.resources(["W.Utils","W.Viewer","W.Layout","W.Commands","W.Config","W.ComponentLifecycle"]),b.propertiesSchemaType("PageGroupProperties"),b.binds(["_resizePage","_executeTransitionIfPossible","_onTransitionFinished","_resetNavigationProcess","_executeNavigationProcess","_onNavigationFailed"]),b.methods({initialize:function(a,b,c){this.parent(a,b,c),this.setMaxH(this.imports.Page.MAX_HEIGHT),this._initTransitionDurationMap(),this._registerCommands()},render:function(){this.parent();var a=this.resources.W.Viewer.getDocWidth();this.setWidth(a)},editModeChange:function(a){"MASTER_PAGE"!==a&&this._skinParts.overlay.collapse()},gotoPage:function(a){var b=this.resources.W.Viewer.getCompByID(a),c=this._currentPage&&this._currentPage.$logic.getComponentId();if(b===this._currentPage)return this._cancelNextPageNavigation(),void 0;this.resources.W.Commands.executeCommand("WViewerCommands.PageChangeRequested",{fromPageId:c,pageId:a},"pageGroup");var d=this;_.defer(function(){d.resources.W.Viewer.loadPageById(a,b,d._actualGotoPage,d)})},_actualGotoPage:function(a){var b=a.pageNode;return this._isNavigating?(this._nextPageToNavigateTo=b,void 0):(this._executeNavigationProcess(b),void 0)},_executeNavigationProcess:function(a,b){this._prepareForNavigation(a,b),this._waitForPageContentReady(a).then(this._executeTransitionIfPossible).then(this._onTransitionFinished).then(this._resetNavigationProcess,this._onNavigationFailed).done()},_waitForPageContentReady:function(a){var b=Q.defer();return a.$logic.isContentReady()===!0?b.resolve(a):a.$logic.addEvent("pageContentReady",function(){a.$logic.removeEvent("pageContentReady",arguments.callee),b.resolve(a)}),b.promise},_prepareForNavigation:function(a,b){this._isNavigating=!0,this._nextPageToNavigateTo=null,a.$logic.preparePageForShow(),this._notifyPageChangeStart(a.$logic.getComponentId(),b),this._hideNextPage(a)},_executeTransitionIfPossible:function(a){this._unhideNextPage(a);var b=this._currentPage&&this._currentPage.$logic,c=b&&b.getComponentId(),d=Q.defer();return b&&!b.getIsDisposed()?this._transitionToNextPage(a,d):(this._setCurrentPage(a),this._resizePage(),d.resolve(c)),d.promise},_notifyPageChangeStart:function(a,b){var c=this._currentPage&&this._currentPage.$logic.getComponentId();this.resources.W.Commands.executeCommand("WViewerCommands.PageChangeStart",{fromPageId:c,pageId:a,isFromReset:!!b},this),this._view.fireEvent("pageTransitionStarted",a),this.resources.W.Viewer.fireEvent("pageTransitionStarted",a)},_initTransitionDurationMap:function(){this._transitionDurationMap={},this._transitionDurationMap[Constants.TransitionTypes.NONE]=0,this._transitionDurationMap[Constants.TransitionTypes.SWIPE_HORIZONTAL_FULLSCREEN]=1.1,this._transitionDurationMap[Constants.TransitionTypes.SWIPE_VERTICAL_FULLSCREEN]=1.1,this._transitionDurationMap[Constants.TransitionTypes.CROSS_FADE]=1.2,this._transitionDurationMap[Constants.TransitionTypes.OUT_IN]=1.5},_registerCommands:function(){this.resources.W.Commands.registerCommand("WViewerCommands.PageChangeRequested",!0),this.resources.W.Commands.registerCommand("WViewerCommands.PageChangeComplete",!0),this.resources.W.Commands.registerCommand("WViewerCommands.PageTransitionStart",!0),this.resources.W.Commands.registerCommand("WViewerCommands.PageTransitionComplete",!0)},_onDataChanged:function(){var a=this.getComponentProperty("transition");"slide"==a&&this.setComponentProperty("transition",Constants.TransitionTypes.SWIPE_HORIZONTAL_FULLSCREEN,!0)},_cancelNextPageNavigation:function(){this._nextPageToNavigateTo=void 0},_onAllSkinPartsReady:function(){this._transitionUtils=new this.imports.TransitionUtils,this._Tween=this.resources.W.Utils.Tween,this._skinParts.overlay.collapse(),this.parent()},_onNavigationFailed:function(){this._isNavigating=!1,LOG.reportError(wixErrors.PAGE_NAVIGATION_FAILED,"PageGroup","_executeNavigationProcess","")},_resetNavigationProcess:function(){if(this._nextPageToNavigateTo){var a=this._nextPageToNavigateTo;this._nextPageToNavigateTo=void 0,this._executeNavigationProcess(a,!0)}else this._isNavigating=!1},_onTransitionFinished:function(a){var b=this._currentPage.$logic.getComponentId(),c={fromPageId:a,pageId:b};return this._currentPage.$logic.on("resize",this,this._onCurrentPageResize),this._nextPageToNavigateTo||(this.resources.W.Config.isLoadedFromStatic()||window.scrollTo(0,0),this._view.fireEvent("pageTransitionEnded",b),this.resources.W.Commands.executeCommand("WViewerCommands.PageTransitionComplete",c,"pageGroup"),this._resizePage()),W.Layout.callForMeasure(),this.resources.W.Commands.executeCommand("WViewerCommands.PageChangeComplete",c,"pageGroup"),a},_hideNextPage:function(a){a.setStyle("opacity","0.0"),a.getLogic().uncollapse(),this.resources.W.ComponentLifecycle.forceRender(1)},_unhideNextPage:function(a){a.setStyles({opacity:"1.0"})},_setCurrentPage:function(a){this._currentPage=a},_transitionToNextPage:function(a,b){var c=this._currentPage.$logic,d=this.getComponentProperty("transition"),e=this._getPageTransitionDuration(d),f=a.getLogic().getHeight(),g=d===Constants.TransitionTypes.SWIPE_VERTICAL_FULLSCREEN?1:0,h=c&&c.getComponentId();c.off("resize",this,this._onCurrentPageResize);var i=c.getHeight(),j=Q.defer();e>0?(this._Tween.execute(i,f,e,{onUpdate:this._resizePage,ease:"strong_easeInOut"}),this._Tween.execute(window.pageYOffset,0,e,{onUpdate:function(a){window.scrollTo(0,a)},onComplete:function(){j.resolve(h)},ease:"strong_easeInOut"})):(this._resizePage(f),j.resolve(h));var k=this._transitionUtils.getTransition(d);k(this._currentPage,a,g,e,function(){this._currentPage.$logic.collapse(),this._setCurrentPage(a),b.resolve(j.promise)}.bind(this))},_getPageTransitionDuration:function(a){return this._transitionDurationMap[a]||0},_onCurrentPageResize:function(){this._resizePage()},_resizePage:function(a){a||(a=this._currentPage.$logic.getHeight()),this.setHeight(a),this.resources.W.Layout.enforceAnchors([this]),this.resources.W.Commands.executeCommand("WPreviewCommands.PageGroupLayoutChange")},useLayoutOnDrag:function(){return!0},isSelectable:function(){return!1},isContainer:function(){return!1},isAnchorable:function(){return{to:{allow:!0,lock:Constants.BaseComponent.AnchorLock.BY_THRESHOLD},from:{allow:!0,lock:Constants.BaseComponent.AnchorLock.ALWAYS}}},isDeleteable:function(){return!1},getMinPhysicalHeight:function(){return this._currentPage.getLogic().getHeight()},getCurrentChildren:function(){return this._currentPage?[this._currentPage]:[]},getCurrentPageNode:function(){return this._currentPage}})}),define.component("wysiwyg.viewer.components.PagesContainer",function(a){var b=a;b.inherits("wysiwyg.viewer.components.SiteSegmentContainer"),b.utilize(["core.components.Page"]),b.resources(["W.Viewer"]),b.methods({initialize:function(a,b,c){this.parent(a,b,c),this.setMaxH(this.imports.Page.MAX_HEIGHT),this._resizableSides=[]},isAnchorable:function(){return{to:{allow:!0,allowBottomBottom:!1,lock:Constants.BaseComponent.AnchorLock.BY_THRESHOLD},from:{allow:!0,lock:Constants.BaseComponent.AnchorLock.ALWAYS}}},isContainer:function(){return!1},layoutMinHeight:function(){var a=this.resources.W.Viewer.getCurrentPageNode();return a&&a.$logic?a.$logic.getHeight():0}})}),define.component("wysiwyg.viewer.components.PaginatedGridGallery",function(a){var b=a;b.inherits("wysiwyg.viewer.components.MatrixGallery"),b.traits(["wysiwyg.viewer.components.traits.GalleryAutoplay"]),b.utilize(["wysiwyg.viewer.utils.MatrixTransitions","wysiwyg.viewer.utils.GalleryUtils","bootstrap.utils.LinkUtils","wysiwyg.common.utils.LinkRenderer"]),b.resources(["W.Utils","W.Commands","W.Viewer","W.Config","W.Data"]),b.propertiesSchemaType("PaginatedGridGalleryProperties"),b.binds(["next","prev","_onTransitionComplete","_onRollOut","_onMouseMove","_onClick","_onPrevious","_onNext"]),b.skinParts({itemsContainer:{type:"htmlElement"},buttonPrev:{type:"htmlElement"},buttonNext:{type:"htmlElement"},counter:{type:"htmlElement",optional:!0},rolloverHolder:{type:"htmlElement",optional:!0},title:{type:"htmlElement",optional:!1},description:{type:"htmlElement",optional:!1},zoom:{type:"htmlElement",optional:!0},link:{type:"htmlElement",optional:!1}}),b.states({rendering:["pending","ready"],itemSelection:["rollover","idle"],linkableComponent:["link","noLink"],slideshow:["autoplayOn","autoplayOff"],mobile:["notMobile","mobile"],displayDevice:["mobileView"]}),b.fields({_rolloverSequencer:null,_fixedRowNumber:!1,_pageItemsCount:0,_currentItemIndex:0,_displayerDict:{},_transitionPending:!1,_transitionUtils:null,_linkUtils:null,_NO_LINK_PROPAGATION:!0,_hasRollOver:!0}),b.methods({initialize:function(a,b,c){c=c||{},this.parent(a,b,c),this._transitionUtils=new this.imports.MatrixTransitions,this._linkUtils=new this.imports.LinkUtils,this._view.addEvent(Constants.CoreEvents.MOUSE_MOVE,this._onMouseMove),this._view.addEvent(Constants.CoreEvents.MOUSE_OUT,this._onRollOut),"fixedRowNumber"in c&&(this._fixedRowNumber=c.fixedRowNumber===!0),void 0===c.sequencingHook&&(this._sequencer.resolveItem=function(){return{comp:"wysiwyg.viewer.components.ImageLite",skin:"mobile.core.skins.InlineSkin"}}),c.rolloverHook&&(this._rolloverSequencer=new this.imports.ComponentSequencer,this._rolloverSequencer.resolveItem=c.rolloverHook,this._rolloverSequencer.addEvent("componentSetup",this._onRollOverViewCreated)),W.Config.mobileConfig.isMobileOrTablet()?this.setState("mobile","mobile"):this.setState("notMobile","mobile"),this.resources.W.Config.env.getCurrentFrameDevice()===Constants.ViewerTypesParams.TYPES.MOBILE&&this.setState("mobileView","displayDevice"),this._linkRenderer=new this.imports.LinkRenderer},_onRollOverViewCreated:function(a){this._setupItem(a.compView)},getSequencer:function(){return this._sequencer},isPartiallyFunctionalInStaticHtml:function(){return!0},_onAllSkinPartsReady:function(){var a=this.getComponentProperty("galleryImageOnClickAction"),b=this.getComponentProperty("expandEnabled");"unset"===a&&(b===!1?this.setComponentProperty("galleryImageOnClickAction","disabled",!0):this.setComponentProperty("galleryImageOnClickAction","zoomMode",!0),this._updateGalleryImageOnClickAction()),this.parent(),this._skinParts.itemsContainer.setStyles({position:"relative"}),this._skinParts.itemsContainer.addEvent(Constants.CoreEvents.CLICK,this._onClick),this._skinParts.rolloverHolder&&(this._skinParts.rolloverHolder.addEvent(Constants.CoreEvents.CLICK,this._onClick),this._skinParts.rolloverHolder.setStyles({overflow:"hidden"}));var c=this.injects().Utils.getCSSBrowserFeature("user-select"),d={cursor:"pointer"};c&&(d[c]="none"),this._skinParts.buttonPrev.setStyles(d),this._skinParts.buttonNext.setStyles(d),this._addEventListeners(),this._skinParts.itemsContainer.setStyle("overflow","hidden"),this._transitionUtils.setupTransitionMap(this._calcItemPosition.bind(this),this._skinParts.itemsContainer),this._checkSkinPartsVisibility()},_addEventListeners:function(){this._skinParts.buttonPrev.addEvent(Constants.CoreEvents.CLICK,this._onPrevious),this._skinParts.buttonNext.addEvent(Constants.CoreEvents.CLICK,this._onNext),"mobile"===this.getState("mobile")&&(Hammer(this._view).on("swiperight",this._onPrevious),Hammer(this._view).on("swipeleft",this._onNext))},_onPrevious:function(a){a.stopPropagation(),this.prev()},_onNext:function(a){a.stopPropagation(),this.next()},_onResize:function(){this.parent(),this._skinParts&&this._resetRollOver()},_onDataChange:function(a,b){this._updateGalleryImageOnClickAction(),this._currentItemIndex=0,this._pageItemsCount=parseInt(this.getComponentProperty("numCols")*this._getRowNumber()),this._componentReady&&a===this._data&&this._skinParts.itemsContainer.empty(),this._checkSkinPartsVisibility(),this.parent(a,b)},render:function(){this._isRendered===!1&&this._calculateItemSize();var a=this._data.get("items");this._displayerDict={},this._skinParts.counter&&this._skinParts.counter.set("text",this._getCounterText(this._currentItemIndex,a.length)),this._pageItemsCount=parseInt(this.getComponentProperty("numCols")*this._getRowNumber()),this._displayedItems=this._getPageItems(a,this._currentItemIndex);var b=this._displayedItems;a.length>this._pageItemsCount?(this._nextPageItems=this._getPageItems(a,this._getNextPageItemIndex()),this._prevPageItems=this._getPageItems(a,this._getPrevPageItemIndex()),b=b.concat(this._nextPageItems).concat(this._prevPageItems),this._skinParts.buttonNext.setStyles({display:"block"}),this._skinParts.buttonPrev.setStyles({display:"block"})):(this._skinParts.buttonNext.setStyles({display:"none"}),this._skinParts.buttonPrev.setStyles({display:"none"})),this._sequencer.createComponents(this._skinParts.itemsContainer,b)},_getRowNumber:function(){return this._fixedRowNumber===!0?parseInt(this.getComponentProperty("maxRows")):this.parent()},_getPageItems:function(a,b){for(var c=[],d=Math.min(this._numItems-1,b+this._pageItemsCount-1),e=b;d>=e;e++)c.push(a[e]);return c},_getCounterText:function(a){var b=Math.floor(a/this._pageItemsCount),c=this._getTotalPageCount();return c||(c=1),String(b+1)+"/"+String(c)},_translateRefList:function(a){var b,c,d,e=[],f=this._skinParts.itemsContainer.children,g=typeOf(a[0]);a=a.slice(0);for(var h=0;h<f.length;h++)b=f[h],c=b.getLogic().getDataItem(),d="string"===g?"#"+c.get("id"):c,a.contains(d)&&(e.push(b),a.splice(a.indexOf(d),1));return e},_checkSkinPartsVisibility:function(){this._skinParts&&(this._resetRollOver(),this._skinParts.buttonPrev.setStyle("visibility",this.getComponentProperty("showNavigation")?"visible":"hidden"),this._skinParts.buttonNext.setStyle("visibility",this.getComponentProperty("showNavigation")?"visible":"hidden"),this._skinParts.counter.setStyle("visibility",this.getComponentProperty("showCounter")?"visible":"hidden"),this._skinParts.rolloverHolder&&this._skinParts.rolloverHolder.setStyle("cursor",this._isImageClickable()?"pointer":"default"),this._skinParts.link.set("text",this.getComponentProperty("goToLinkText")))},_updateState:function(){},_onDisplayerCreation:function(a,b,c){var d=a.getViewNode();this._setupItem(d);var e;e=a.getRef?a.getRef():"#"+a.getDataItem().get("id"),d.addClass("galleryDisplayer"),this._displayerDict[e]=a,c>=this._displayedItems.length&&d.setStyles({top:1.5*-this._itemHeight,position:"absolute"})},_onSequencerFinished:function(a){a.elements=a.elements.slice(0,this._displayedItems.length),this.parent(a),this._transitionPending=!1,this.fireEvent("transitionFinished")},gotoNext:function(){this.next()},next:function(){!this._transitionPending&&this._numItems>this._pageItemsCount&&this._nextPageItems&&(this._currentItemIndex=this._getNextPageItemIndex(),this._goto(this._nextPageItems,0))},prev:function(){!this._transitionPending&&this._numItems>this._pageItemsCount&&this._prevPageItems&&(this._currentItemIndex=this._getPrevPageItemIndex(),this._goto(this._prevPageItems,1))},_getNextPageItemIndex:function(){var a=this._currentItemIndex+this._pageItemsCount;return a>=this._numItems&&(a=0),a},_getPrevPageItemIndex:function(){var a=this._currentItemIndex-this._pageItemsCount;return 0>a&&(a=(this._getTotalPageCount()-1)*this._pageItemsCount),a},_goto:function(a,b){this._transitionPending=!0,this._resetRollOver();var c=this._translateRefList(this._displayedItems),d=this._translateRefList(a),e=this._transitionUtils.getTransition(this.getComponentProperty("transition"));this._setupAllItems(d),e(c,d,this._numCols,this._numRows,b,parseFloat(this.getComponentProperty("transDuration")),function(){this._onTransitionComplete(d)}.bind(this))},_onTransitionComplete:function(){this._isDisposed||this.render()},_onMouseMove:function(a){if(this._transitionPending!==!0){var b=this._findDisplayerFromPosition(a.page);if(b&&this._skinParts.rolloverHolder&&this._hasRollOver){if(this._highlightedDisplayer!==b){this._highlightedDisplayer=b;var c=b.getCoordinates(this._skinParts.rolloverHolder.getParent());this._skinParts.rolloverHolder.setStyles({visibility:"visible",position:"absolute",padding:0,left:c.left,top:c.top,width:c.width,height:c.height}),this.setState("idle"),window.requestAnimFrame(function(){if(this._highlightedDisplayer){this._updateDisplayerInfo(b.getLogic().getDataItem());
var a=this._getHighlightedDisplayerData();if(a.getType&&"Image"===a.getType()){var c=this.getSkinPart("link");this._renderLink(c,a)}this._skinParts.rolloverHolder.setStyle("cursor",this._isImageClickable()?"pointer":"default"),"goToLink"==this._galleryImageOnClickAction?this._skinParts.link.setStyle("display","none"):this._skinParts.link.setStyle("display",this._isImageLinked()?"block":"none"),this.setState("rollover")}}.bind(this))}}else this._resetRollOver()}},_onRollOut:function(a){a.relatedTarget&&!a.relatedTarget.getParents().contains(this._view)&&this._resetRollOver()},_findDisplayerFromPosition:function(a){var b,c=this._skinParts.itemsContainer.getPosition(),d={x:a.x-c.x,y:a.y-c.y},e=Math.floor(d.x/(this._itemWidth+this._gap)),f=Math.floor(d.y/(this._itemHeight+this._gap));if(e>=0&&f>=0){var g=f*this._numCols+e;g<this._galleryItems.length&&(b=this._galleryItems[g])}return b},_findDisplayer:function(a){for(;a;){if(a===this._skinParts.itemsContainer)return null;if(this._galleryItems.contains(a))return a;a=a.getParent()}return null},_updateDisplayerInfo:function(a){this._skinParts.rolloverHolder&&this._rolloverSequencer?this._rolloverSequencer.createComponents(this._skinParts.rolloverHolder,[a]):a&&a.getData&&"title"in a.getData()&&"description"in a.getData()&&(this._skinParts.title.set("text",a.get("title")),this._skinParts.description.set("text",a.get("description")))},_hideRollOverHolder:function(){this.setState("idle"),this._skinParts.rolloverHolder.setStyles({visibility:"hidden"})},_resetRollOver:function(){this._hideRollOverHolder(),this._highlightedDisplayer=null},_onClick:function(a){if(a.rightClick===!1){var b;if("zoomMode"==this._galleryImageOnClickAction){var c=this._highlightedDisplayer||this._findDisplayer(a.target);if(c){b=c.getLogic().getDataItem();var d=b.get("id"),e=this._data.get("items"),f=e.indexOf("#"+d);this.resources.W.Commands.executeCommand("WViewerCommands.OpenZoom",{itemsList:this._data,currentIndex:f,getDisplayerDivFunction:this.resources.W.Viewer.getDefaultGetZoomDisplayerFunction("Image"),getHashPartsFunction:this.resources.W.Viewer.getDefaultGetHashPartsFunction("Image")})}}else"goToLink"==this._galleryImageOnClickAction&&this._isImageLinked()&&this.goToLink()}},goToLink:function(){if(this._skinParts.link.click)this._skinParts.link.click();else{var a=document.createEvent("HTMLEvents");a.initEvent("click",!0,!0),this._skinParts.link.dispatchEvent(a)}},_getTotalPageCount:function(){var a=Math.floor(this._numItems/this._pageItemsCount);return this._numItems%this._pageItemsCount>0&&a++,a},_renderLink:function(a,b){var c=b&&b.get?b.get("link"):null;if(!c)return this._linkRenderer.removeRenderedLinkFrom(a,this),void 0;var d=this.resources.W.Data.getDataByQuery(c);d&&this._linkRenderer.renderLink(a,d,this)},_isImageLinked:function(){var a=this._getHighlightedDisplayerData(),b=null;return a&&a.get&&(b=a.get("link")),!!b},_getHighlightedDisplayerData:function(){return this._highlightedDisplayer&&this._highlightedDisplayer.getLogic?this._highlightedDisplayer.getLogic().getDataItem():null},_isImageClickable:function(){return"goToLink"===this._galleryImageOnClickAction?this._isImageLinked():"disabled"!==this._galleryImageOnClickAction},_updateGalleryImageOnClickAction:function(){this._galleryImageOnClickAction=this.getComponentProperties().hasField("galleryImageOnClickAction")?this.getComponentProperty("galleryImageOnClickAction"):this.getComponentProperty("expandEnabled")?"zoomMode":"disabled"}})}),define.component("wysiwyg.viewer.components.PasswordLogin",function(a){var b=a;b.inherits("mobile.core.components.base.BaseComponent"),b.resources(["W.Utils","W.Data","W.Config","W.Commands"]),b.skinParts({blockingLayer:{type:"htmlElement"},passwordInput:{type:"wysiwyg.viewer.components.inputs.TextInput",hookMethod:"_bindPasswordField"},submitButton:{type:"htmlElement"},xButton:{type:"htmlElement",command:"WViewerCommands.PasswordLogin.Close"},cancel:{type:"htmlElement"},favIcon:{type:"htmlElement"},faveIconAhref:{type:"htmlElement"},header:{type:"htmlElement"},title:{type:"htmlElement"},dialog:{type:"htmlElement"}}),b.statics({langKeys:{en:{PasswordLogin_Header:"Enter password to view this page",PasswordLogin_Error_General:"Server error - Unable to log in",PasswordLogin_Wrong_Password:"Please enter the correct password",PasswordLogin_Password:"Password",PasswordLogin_Submit:"OK"},es:{PasswordLogin_Wrong_Password:"Por favor introduce la clave correcta",PasswordLogin_Password:"Clave",PasswordLogin_Header:"Escribe la clave para ver esta pgina",PasswordLogin_Submit:"OK",PasswordLogin_Error_General:"Server error - Unable to log in"},de:{PasswordLogin_Wrong_Password:"Bitte geben Sie das richtige Passwort ein.",PasswordLogin_Password:"Passwort",PasswordLogin_Header:"Geben Sie ein Passwort ein, um diese Seite zu sehen.",PasswordLogin_Submit:"OK",PasswordLogin_Error_General:"Server error - Unable to log in"},fr:{PasswordLogin_Header:"Veuillez saisir un mot de passe afin d'accder  cette page",PasswordLogin_Error_General:"Server error - Unable to log in",PasswordLogin_Wrong_Password:"Veuillez saisir le mot de passe correct",PasswordLogin_Password:"Mot de passe",PasswordLogin_Submit:"OK"},it:{PasswordLogin_Header:"Inserisci la password per visualizzare questa pagina",PasswordLogin_Error_General:"Server error - Unable to log in",PasswordLogin_Wrong_Password:"Ti preghiamo di inserire la password corretta",PasswordLogin_Password:"Password",PasswordLogin_Submit:"OK"},ja:{PasswordLogin_Wrong_Password:"",PasswordLogin_Password:"",PasswordLogin_Header:"",PasswordLogin_Submit:"OK",PasswordLogin_Error_General:"Server error - Unable to log in"},ko:{PasswordLogin_Wrong_Password:"  .",PasswordLogin_Password:"",PasswordLogin_Header:" .",PasswordLogin_Submit:"OK",PasswordLogin_Error_General:"Server error - Unable to log in"},pl:{PasswordLogin_Header:"Wpisz haslo, aby zobaczyc te strone",PasswordLogin_Error_General:"Server error - Unable to log in",PasswordLogin_Wrong_Password:"Wpisz poprawne haslo",PasswordLogin_Password:"Haslo",PasswordLogin_Submit:"OK"},pt:{PasswordLogin_Header:"Insira a senha para ver esta pgina",PasswordLogin_Error_General:"Server error - Unable to log in",PasswordLogin_Wrong_Password:"Por favor, insira a senha correta",PasswordLogin_Password:"Senha",PasswordLogin_Submit:"OK"},ru:{PasswordLogin_Wrong_Password:",   ",PasswordLogin_Password:"",PasswordLogin_Header:" ,    ",PasswordLogin_Submit:"OK",PasswordLogin_Error_General:"Server error - Unable to log in"},tr:{PasswordLogin_Header:"Bu sayfayi grntlemek iin sifreyi girin",PasswordLogin_Error_General:"Server error - Unable to log in",PasswordLogin_Wrong_Password:"Ltfen dogru sifreyi girin",PasswordLogin_Password:"Sifre",PasswordLogin_Submit:"OK"}},_keys:{}}),b.binds(["centerDialog","_onSubmit","_reportError","_invalidateErrorState","_onKeyPress","_handleCancel","_onPasswordSuccess"]),b.states({displayDevice:["mobile"]}),b.methods({initialize:function(a,b,c){this.isVolatile=!0,this.parent(a,b,c),this.resources.W.Commands.registerCommandListenerByName("WPreviewCommands.WEditModeChanged",this,this._onEditorModeChanged),this.VIEWER_STRINGS={LOGIN_HEADER:"Enter password to view this page",LOGIN_ERR_GENERAL:"Server error - Unable to log in",LOGIN_ERR_WRONG_PASSWORD:"Please enter the correct password",PASSWORD_LABEL:"Password"},this._digestedPassword=c&&c.digestedPassword,this._authCallback=c&&c.authCallback,this._disableCancel=c&&c.disableCancel,this.resources.W.Commands.registerCommandAndListener("WPreviewCommands.ViewerStateChanged",this,this._onEditorModeChanged),this.resources.W.Config.env.getCurrentFrameDevice()===Constants.ViewerTypesParams.TYPES.MOBILE&&this.setState("mobile","displayDevice"),this._setDictionary(c&&c.dialogsLanguage?c.dialogsLanguage:"en")},_setDictionary:function(a){this._keys=a&&this.langKeys[a]?this.langKeys[a]:this.langKeys.en},centerDialog:function(){var a=this.resources.W.Utils.getWindowSize(),b=this._skinParts.dialog;b.setPosition({x:a.width/2-b.getSize().x/2,y:a.height/2-b.getSize().y/2}),this._skinParts.submitButton.value=this._keys.PasswordLogin_Submit},_onAllSkinPartsReady:function(a){if(this._disableCancel?(a.xButton.hide(),a.cancel.setStyle("visibility","hidden")):(a.cancel.addEvent("click",this._handleCancel),a.xButton.addEvent("click",this._handleCancel),a.blockingLayer.addEvent("click",function(b){b.target==a.blockingLayer&&this._handleCancel()}.bind(this))),a.submitButton.addEvent("click",this._onSubmit),a.title.set("text",this._keys.PasswordLogin_Header),this.resources.W.Config.isPremiumUser()){a.faveIconAhref.removeAttribute("href");var b=window.publicModel&&window.publicModel.favicon;a.favIcon.src=b?this.resources.W.Config.getMediaStaticUrl(b)+b:this.resources.W.Config.getServiceTopologyProperty("staticThemeUrlWeb")+"/viewer/blank-favicon.png"}a.passwordInput.addEvent(Constants.CoreEvents.KEY_UP,this._onKeyPress)},_handleCancel:function(){this._closeDialog(),this._reportAuthStatusChange(!1,{cancel:!0})},_reportAuthStatusChange:function(a,b){this._authCallback&&this._authCallback({authResponse:a,data:b})},_onEditorModeChanged:function(){this._handleCancel()},_onKeyPress:function(a){13==a.code&&this._onSubmit(),this._invalidateErrorState()},_onSubmit:function(){this._invalidateErrorState();var a=this._skinParts.passwordInput._data.get("text");this._validatePassword(a,function(){this._invalidateErrorState(),this._onPasswordSuccess()}.bind(this),function(a){this._reportError(a)}.bind(this))},_onPasswordSuccess:function(){this._closeDialog(),this._reportAuthStatusChange(!0)},_closeDialog:function(){this.resources.W.Commands.executeCommand("WViewerCommands.PasswordLogin.Close",null,null);var a=this.resources.W.Commands.getCommand("WPreviewCommands.WEditModeChanged");a&&a.unregisterListener(this);var b=this.resources.W.Commands.getCommand("WPreviewCommands.ViewerStateChanged");b&&b.unregisterListener(this)},_validatePassword:function(a,b,c){if(this._digestedPassword){var d=W.Utils.hashing.SHA256.b64_sha256(a);d==this._digestedPassword?b():c(this._keys.PasswordLogin_Wrong_Password)}},_reportError:function(a){this._skinParts.passwordInput.setError(a)},_invalidateErrorState:function(){this._skinParts.passwordInput.setValidationState(!0)},_bindPasswordField:function(a){return a.argObject={label:this._keys.PasswordLogin_Password,passwordField:!0},a.dataItem=this.resources.W.Data.createDataItem({text:"",type:"Text"},"Text"),a}})}),define.component("wysiwyg.viewer.components.PayPalButton",function(a){var b=a;b.inherits("mobile.core.components.base.BaseComponent"),b.resources(["W.Commands","W.Config"]),b.dataTypes(["PayPalButton"]),b.propertiesSchemaType("PayPalButtonProperties"),b.skinParts({buttonContainer:{type:"htmlElement"}}),b.fields({EDITOR_META_DATA:{general:{settings:!0,design:!1},mobile:{allInputsHidden:!0}}}),b.methods({initialize:function(a,b,c){this.parent(a,b,c),this._resizableSides=[]},render:function(){this._createPayPalForm()},_createPayPalForm:function(){this._buttonType=this.getComponentProperty("buttonType");var a=this.getComponentProperty("amount"),b=!a||0==Number(a),c=this.getComponentProperty("target"),d="buy"==this._buttonType?"_xclick":"_donations";if(this._form=new Element("form",{action:"https://www.paypal.com/cgi-bin/webscr",method:"POST"}),this._skinParts.buttonContainer.empty(),this._skinParts.buttonContainer.adopt(this._form),this._form.set("target",c),this._addHiddenInput("cmd",d),this._addHiddenInput("business",this._data.get("merchantID")),this._addHiddenInput("item_name","buy"==this._buttonType?this.getComponentProperty("itemName"):this.getComponentProperty("organizationName")),this._addHiddenInput("item_number","buy"==this._buttonType?this.getComponentProperty("itemID"):this.getComponentProperty("organizationID")),this._addHiddenInput("notify_url","https://inventory.wix.com/ecommerce/ipn/paypal"),"_blank"==c){var e=document.location.href;this._addHiddenInput("return",e),this._addHiddenInput("cancel_return",e)}b||this._addHiddenInput("amount",this.getComponentProperty("amount")),this._addHiddenInput("currency_code",this.getComponentProperty("currencyCode")),"buy"==this._buttonType?this._addHiddenInput("bn","Wix_BuyNow_WPS_IL"):this._addHiddenInput("bn","Wix_Donate_WPS_IL"),this._addSubmitImage(),this._addPixelImage(),this._alignSize(),this._form.addEvent("click",function(a){if("_self"===c){this.resources.W.Config.env.$isEditorViewerFrame&&a.preventDefault();var b={component:this};this.resources.W.Commands.executeCommand("linkableComponent.navigateSameWindow",b,this)}}.bind(this))},_alignSize:function(){var a,b,c=this.getComponentProperty("showCreditCards"),d=this.getComponentProperty("smallButton");d?(a=21,b="buy"==this._buttonType?86:74):c?(a=47,b=170):(a=26,b="buy"==this._buttonType?107:92),this.setWidth(b),this.setHeight(a),this._view.setStyle("height",a+"px")},_addSubmitImage:function(){var a=new Element("input",{type:"image",name:"submit",border:0,src:function(){var a=this.getComponentProperty("showCreditCards"),b=this.getComponentProperty("smallButton"),c="en_US",d="https://www.paypalobjects.com/"+c+"/i/btn/btn_";return d+="buy"==this._buttonType?"buynow":"donate",d+=a&&!b?"CC":"",d+=b?"_SM":"_LG",d+=".gif"}.bind(this)()});this._form.adopt(a)},_addHiddenInput:function(a,b){var c=new Element("input",{type:"hidden",name:a,value:b});this._form.adopt(c)},_addPixelImage:function(){this._form.adopt(new Element("img",{src:"https://www.paypalobjects.com/en_US/i/scr/pixel.gif",width:"1",height:"1"}))}})}),define.component("wysiwyg.viewer.components.PinterestFollow",function(a){var b=a;b.inherits("core.components.base.BaseComp"),b.resources(["W.Config","topology"]),b.dataTypes(["PinterestFollow"]),b.skinParts({followButtonTag:{type:"htmlElement"},followButton:{type:"htmlElement"}}),b.methods({initialize:function(a,b,c){this.parent(a,b,c),this._resizableSides=[],this.EDITOR_META_DATA={general:{settings:!0,design:!1},mobile:{allInputsHidden:!0}}},_onRender:function(){this._updatePinterestData()},_updatePinterestData:function(){this._setPinterestBtnTxt(),this._setPinterestUrl()},_setPinterestBtnTxt:function(){var a=this._getPinterestBtnTxt();this._skinParts.followButtonTag.innerHTML=a},_setPinterestUrl:function(){var a=this._getPinterestUrl();this._skinParts.followButton.setAttribute("href",a)},_getPinterestUrl:function(){var a=this.getDataItem(),b=a?a.get("urlChoice"):"",c=b.split("."),d=[];return c.forEach(function(a){("pinterest.com/"!==a&&"http://www.pinterest.com/"!==a&&"www.pinterest.com/"!==a||"http://pinterest.com/"===a)&&d.push(a)}),"//www.pinterest.com/"+d},_getPinterestBtnTxt:function(){var a=this.getDataItem();return a?a.get("label"):""}})}),define.component("wysiwyg.viewer.components.ScreenWidthArea",function(a){var b=a;b.inherits("mobile.core.components.base.BaseComponent"),b.skinParts({inlineContent:{type:"htmlElement"},background:{type:"htmlElement"}}),b.fields({EDITOR_META_DATA:{general:{settings:!0,design:!0}}}),b.methods({getInlineContentContainer:function(){return this._skinParts.inlineContent?this._skinParts.inlineContent:this._view},getLayoutMode:function(){return"BACKGROUND_STRIP"}})}),define.component("wysiwyg.viewer.components.ScreenWidthContainer",function(a){var b=a;b.inherits("core.components.ContainerOBC"),b.resources(["W.Viewer","W.Commands","W.Config"]),b.binds(["_onScreenResize","_stretchBackgroundAndCenterContent"]),b.skinParts({inlineContent:{type:"htmlElement"},screenWidthBackground:{type:"htmlElement"},bg:{type:"htmlElement"},centeredContent:{type:"htmlElement"}}),b.fields({EDITOR_META_DATA:{general:{settings:!0,design:!0},mobile:{allInputsHidden:!0}}}),b.methods({initialize:function(a,b,c){this._pendingSizeUpdates={},this.parent(a,b,c),this._resizableSides=[Constants.BaseComponent.ResizeSides.TOP,Constants.BaseComponent.ResizeSides.BOTTOM],this._moveDirections=[Constants.BaseComponent.MoveDirections.VERTICAL],this._isMobileView=this.resources.W.Config.env.getCurrentFrameDevice()===Constants.ViewerTypesParams.TYPES.MOBILE},_onScreenResize:function(){this.getIsDisplayed()&&this._stretchBackgroundAndCenterContent()},_onResize:function(){},_stretchBackgroundAndCenterContent:function(){var a=this._view,b=$(document).getSize(),c=a.getSize(),d=this.resources.W.Viewer.getDocWidth(),e=this._isMobileView?0:-Math.round((b.x-d)/2),f=this._isMobileView?d:b.x;e>0&&(e=0),this._skinParts.screenWidthBackground.setStyles({position:"absolute",width:f+"px",height:c.y+"px",left:e})},render:function(){this.resources.W.Viewer.addEvent(this.resources.W.Viewer.SCREEN_RESIZE_EVENT,this._onScreenResize),this._stretchBackgroundAndCenterContent();var a=this.resources.W.Viewer.getDocWidth();this.setWidth(a),this._onAutoSized()},dispose:function(){this.parent(),this.resources.W.Viewer.removeEvent(this.resources.W.Viewer.SCREEN_RESIZE_EVENT,this._onScreenResize)},_onAllSkinPartsReady:function(){this._applyPendingSizeUpdates(!0)},_applyPendingSizeUpdates:function(a){null!=this._pendingSizeUpdates.width?(this.setWidth(this._pendingSizeUpdates.width),this._pendingSizeUpdates.width=null):a&&this.setWidth(this.getWidth(),!0),null!=this._pendingSizeUpdates.height?(this.setHeight(this._pendingSizeUpdates.height),this._pendingSizeUpdates.height=null):a&&this.setHeight(this.getHeight(),!0)},setX:function(){},getX:function(){return 0},setHeight:function(a,b,c){this.parent(a,b,c),this._skinParts?(this._view.setStyle("min-height",a+"px"),this._stretchBackgroundAndCenterContent(),this.flushPhysicalHeightCache(),this._onResize()):this._pendingSizeUpdates.height=a},setWidth:function(a,b,c){if(this.parent(a,b,c),this._skinParts){var d=this.resources.W.Viewer.getDocWidth(),e=a+"px",f=(d-a)/2+"px";this._skinParts.centeredContent.setStyles({width:e,"margin-left":f})}else this._pendingSizeUpdates.width=a},getSelectableX:function(){if(this.resources.W.Config.env.isViewingSecondaryDevice())return this.getX();var a=$(document).getSize().x;return this.getX()-(a-this.getWidth())/2},getSelectableWidth:function(){if(this.resources.W.Config.env.isViewingSecondaryDevice())return this.getWidth();var a=$(document).getSize().x;return a},isContainable:function(a){return instanceOf(a,this.constructor)},isDuplicatable:function(){return!0},saveCurrentDimensions:function(){this._lastDimensions={w:this.resources.W.Viewer.getDocWidth(),h:this.getHeight()}},_getEditBoxReferenceNode:function(){return this._skinParts.inlineContent}})}),define.component("wysiwyg.viewer.components.SelectableSliderGallery",function(a){var b=a;b.skinParts({imageItem:{type:"wysiwyg.viewer.components.Displayer",repeater:!0,container:"itemsContainer",dataRefField:"items"},itemsContainer:{type:"htmlElement"},swipeLeftHitArea:{type:"htmlElement"},swipeRightHitArea:{type:"htmlElement"}}),b.inherits("wysiwyg.viewer.components.SliderGallery"),b.fields({_selectedItem:null}),b.methods({initialize:function(a,b,c){this._expandEnabled=!1,this._initialSelectedIndex=0,c.selectedIndex&&(this._initialSelectedIndex=c.selectedIndex),this.parent(a,b,c)},_setupDisplayer:function(a,b){this.parent(a),b===this._initialSelectedIndex&&this.setSelectedState(a),a.addEvent("itemSelected",function(){this.setSelectedState(a),this.fireEvent("imageSelected",a.getDataItem())}.bind(this))},setSelectedState:function(a){if(this._selectedItem){if(this._selectedItem===a)return;this._selectedItem.setSelected(!1)}this._selectedItem=a,this._selectedItem.setSelected(!0)}})}),define.component("wysiwyg.viewer.components.SiteButton",function(a){var b=a;b.inherits("mobile.core.components.base.BaseComponent"),b.resources(["W.Utils","W.Config","W.Data"]),b.utilize(["wysiwyg.common.utils.LinkRenderer","core.utils.css.Font"]),b.propertiesSchemaType("ButtonProperties"),b.skinParts({label:{type:"htmlElement"},link:{type:"htmlElement"}}),b.dataTypes(["LinkableButton"]),b.binds(["_onClick","_onOver","_onOut","_onMouseDown","_onMouseUp"]),b.states(["up","over","selected","pressed"]),b.fields({EDITOR_META_DATA:{general:{settings:!0,design:!0},custom:[{label:"LINK_LINK_TO",command:"WEditorCommands.OpenLinkDialogCommand",commandParameter:{position:"center"},commandParameterDataRef:"SELF"}],mobile:{isTextScalable:!0,previewTextDataField:"label"}},_canFocus:!0,_triggers:["click"]}),b.methods({initialize:function(a,b,c){this.parent(a,b,c),this._userSelectedWidth=0,this._resizeTriggeredByData=!1,this._rotatable=!0,this._linkRenderer=new this.imports.LinkRenderer},_onClick:function(a){if(LOG.reportEvent(wixEvents.VIEWER_BUTTON_COMPONENT_CLICK,{c1:this._compId,i1:this.isEnabled()?1:0}),!this.isEnabled())return this._cancelEvent(a);if(a.target=this.getViewNode(),this.fireEvent(Constants.CoreEvents.CLICK,a),this._toggleMode){var b="selected"!=this.getState()?"selected":"over";this.setState(b)}},_onOver:function(a){this.isEnabled()&&"selected"!=this.getState()&&(this.fireEvent("over",a),this.setState("over"))},_onOut:function(a){this.isEnabled()&&"selected"!=this.getState()&&(this.fireEvent("up",a),this.setState("up"))},_onMouseDown:function(a){if(this.isEnabled()&&"selected"!=this.getState())this.setState("pressed"),this.fireEvent(Constants.CoreEvents.MOUSE_DOWN,a);else if(!this.isEnabled())return this._cancelEvent(a)},_cancelEvent:function(a){return a.stopPropagation(),a.preventDefault(),!1},_onMouseUp:function(){this.removeState("pressed")},_onEnabled:function(){var a=this._skinParts.view;a.addEvent(Constants.CoreEvents.CLICK,this._onClick),a.addEvent(Constants.CoreEvents.MOUSE_OVER,this._onOver),a.addEvent(Constants.CoreEvents.MOUSE_OUT,this._onOut),a.addEvent(Constants.CoreEvents.MOUSE_DOWN,this._onMouseDown),a.addEvent(Constants.CoreEvents.MOUSE_UP,this._onMouseUp)},_onDisabled:function(){var a=this._skinParts.view;a.removeEvent(Constants.CoreEvents.MOUSE_OVER,this._onOver),a.removeEvent(Constants.CoreEvents.MOUSE_OUT,this._onOut),a.removeEvent(Constants.CoreEvents.MOUSE_UP,this._onMouseUp)},render:function(){this.resources.W.Config.env.getCurrentFrameDevice()===Constants.ViewerTypesParams.TYPES.MOBILE&&this._normalizeForMobile();var a=this._data.get("label");this._skinParts.label.set("text",a),this._userSelectedWidth||a||(this._userSelectedWidth=parseInt(this._view.getStyle("width"),10)),this._updateMinimumWidth(),this._updateWidthFromText(),this._updateMinimumHeight(),this._setLineHeight(),this._setTextAlignment(),this._wCheckForSizeChangeAndFireAutoSized(0),this._renderLink()},_normalizeForMobile:function(){var a=this._skinParts.label,b=this._getButtonFontSize(),c=this._convertSizeToMobile(b);-1!=c&&a.setStyle("font-size",c)},_getButtonFontSize:function(){var a=this.getStyle();if(a){var b=a.getPropertySource("fnt"),c=a.getProperty("fnt"),d="value"==b?new this.imports.Font(c):W.Theme.getProperty(c);return parseInt(d.getSize())}var e=this._skinParts.label;return parseInt(e.getStyle("font-size"))},_convertSizeToMobile:function(a){var b=this.getScale();return W.Utils.mobile.convertFontSizeToMobile(a,b)},setScale:function(a){this._$scale=parseFloat(a),this.render(),this.fireEvent("autoSized")},_skinParamsChange:function(){this.resources.W.Utils.callLater(function(){this._renderIfReady()}.bind(this),[],this,0),this.parent()},setHeight:function(a,b,c){this.parent(a,b,c),this._setLineHeight()},_setLineHeight:function(){if(this.isReady()){var a=parseInt(this._view.getStyle("padding-top")),b=parseInt(this._view.getStyle("padding-bottom")),c=this.getHeight()-a-b;this._skinParts.label.setStyle("line-height",c+"px")}},_setTextAlignment:function(){var a=this.getComponentProperty("align");this._skinParts.link.setStyle("text-align",a),this._setTextMargin()},_setTextMargin:function(){var a=this.getComponentProperty("margin"),b=this.getComponentProperty("align"),c=parseInt(this._skinParts.label.offsetWidth),d=this.getWidth();c+a>d&&(a=d-c),"left"==b?(this._skinParts.label.setStyle("margin-right",""),this._skinParts.label.setStyle("margin-left",a+"px")):"right"==b?(this._skinParts.label.setStyle("margin-left",""),this._skinParts.label.setStyle("margin-right",a+"px")):(this._skinParts.label.setStyle("margin-left",""),this._skinParts.label.setStyle("margin-right",""))},_setMinimumWidthAccordingToText:function(){var a=parseInt(this._skinParts.label.offsetWidth),b=parseInt(this._view.getStyle("padding-left")),c=parseInt(this._view.getStyle("padding-right"));this.setMinW(a+b+c)},_setMinimumHeightAccordingToText:function(){var a=parseInt(this._view.getStyle("padding-top")),b=parseInt(this._view.getStyle("padding-bottom"));this._skinParts.label.setStyle("line-height",""),this.setMinH(this._skinParts.label.offsetHeight+a+b)},_updateMinimumHeight:function(){this._setMinimumHeightAccordingToText(),this.setHeight(this.getHeight(),!1,!1)},_updateMinimumWidth:function(){this._setMinimumWidthAccordingToText(),this.setWidth(this.getWidth(),!1,!1)},_updateWidthFromText:function(){this._userSelectedWidth=0==this._userSelectedWidth?this.getWidth():this._userSelectedWidth;var a=Math.max(this.getSizeLimits().minW,this._userSelectedWidth);this.setWidth(a,!1,!1)},_onResize:function(){return this.parent(),0==this._resizeTriggeredByData?this._userSelectedWidth=parseInt(this._view.getStyle("width")):this._resizeTriggeredByData=!1,this.isReady()?(this._setTextMargin(),void 0):0},_onDataChange:function(a,b,c){this._resizeTriggeredByData=!0,this.parent(a,b,c),this._isRendered&&this._renderLink()},_renderLink:function(){var a=this.getDataItem(),b=a._data.link;if(!b)return this._linkRenderer.removeRenderedLinkFrom(this._skinParts.link,this),void 0;var c=this.resources.W.Data.getDataByQuery(b);c&&this._linkRenderer.renderLink(this._skinParts.link,c,this)}})}),define.component("wysiwyg.viewer.components.SiteSegmentContainer",function(a){var b=a;b.inherits("wysiwyg.viewer.components.ScreenWidthContainer"),b.skinParts({inlineContent:{type:"htmlElement"},screenWidthBackground:{type:"htmlElement"},bg:{type:"htmlElement"},centeredContent:{type:"htmlElement"}}),b.fields({EDITOR_META_DATA:{general:{settings:!0,design:!0,animation:!1},mobile:{allInputsHidden:!0}}}),b.methods({initialize:function(a,b,c){this.parent(a,b,c),this._resizableSides=[Constants.BaseComponent.ResizeSides.TOP,Constants.BaseComponent.ResizeSides.BOTTOM]},useLayoutOnDrag:function(){return!0},useLayoutOnResize:function(){return!0},isDeleteable:function(){return!1},isAnchorable:function(){return{to:{allow:!0,lock:Constants.BaseComponent.AnchorLock.BY_THRESHOLD},from:{allow:!0,lock:Constants.BaseComponent.AnchorLock.ALWAYS}}},canMoveToOtherScope:function(){return!1},isMultiSelectable:function(){return!1},isDraggable:function(){return!1},isDuplicatable:function(){return!1},initComponentLayoutPosition:function(a){var b=W.Config.env.$viewingDevice===Constants.ViewerTypesParams.TYPES.MOBILE;if(a&&(this._view.hasAttribute("pos")===!1||b))"relative"!=this._view.getStyle("position")&&this._view.setStyle("position","absolute");else{var c=this._view.getAttribute("pos");c&&this._view.setStyle("position",c)}},_applyLayoutPosition_:function(a){var b=W.Config.env.$viewingDevice===Constants.ViewerTypesParams.TYPES.MOBILE,c=b?"absolute":a||this._$pos;"fixed"===c?(this.$view.setStyle("position","fixed"),this.$view.addClass("fixedPosition")):"absolute"===c&&(this.$view.setStyle("position","absolute"),this.$view.removeClass("fixedPosition"))}})}),define.component("wysiwyg.viewer.components.SlideShowGallery",function(a){var b=a;b.inherits("core.components.BaseRepeater"),b.utilize(["wysiwyg.viewer.utils.TransitionUtils"]),b.traits(["core.components.traits.TouchRollOverSupport","wysiwyg.viewer.components.traits.GalleryAutoplay"]),b.dataTypes(["ImageList"]),b.resources(["W.Utils","W.Config","W.Theme","W.Commands"]),b.states({editMode:["showButtons"],slideshow:["autoplayOn","autoplayOff"],mobile:["notMobile","mobile"],mobileShowTextPanel:["showTextPanel","notShow"],displayDevice:["mobileView"]}),b.propertiesSchemaType("SlideShowGalleryProperties"),b.skinParts({imageItem:{type:"wysiwyg.viewer.components.Displayer",repeater:!0,container:"virtualContainer",moveOldItemsToContainer:!1,dataRefField:"items",argObject:{unit:"px"}},virtualContainer:{type:"htmlElement",optional:!0},itemsContainer:{type:"htmlElement"},buttonPrev:{type:"htmlElement"},buttonNext:{type:"htmlElement"},counter:{type:"htmlElement"},autoplay:{type:"htmlElement"}}),b.binds(["gotoNext","gotoPrev","_onNext","_onPrev"]),b.fields({EDITOR_META_DATA:{general:{settings:!0,design:!0},custom:[{label:"GALLERY_ORGANIZE_PHOTOS",command:"WEditorCommands.OpenListEditDialog",commandParameter:{galleryConfigID:"SlideShowGallery",publicMediaFile:"photos",i18nPrefix:"multiple_images",mediaType:"picture",selectionType:"multiple",source:"fpp"},commandParameterDataRef:"SELF"},{label:"CHANGE_GALLERY_TYPE",command:"WEditorCommands.OpenChangeGalleryDialog",commandParameter:{}}],dblClick:{command:"WEditorCommands.OpenListEditDialog",commandParameter:{galleryConfigID:"SlideShowGallery",publicMediaFile:"photos",i18nPrefix:"multiple_images",mediaType:"picture",selectionType:"multiple",source:"dblclick"},commandParameterDataRef:"SELF"},mobile:{previewImageDataRefField:"*"}},_currentItemIndex:0,_currentItemRef:"",_prevItemIndex:-1,_numItems:-1,_itemHolder:null,_currentDisplayer:null,_locked:!1,_lastCommand:"",_transitionUtils:null,_displayedImages:[],_imageMode:"",_widthDiff:0,_heightDiff:0,_galleryItems:[],_expandEnabled:!0}),b.methods({initialize:function(a,b,c){this.parent(a,b,c),this.injects().Commands.registerCommandListenerByName("WPreviewCommands.WEditModeChanged",this,this._onEditorModeChanged),this._Tween=this.resources.W.Utils.Tween,this._hideIndicatorElement=c&&c.hideIndicatorElement||!1,W.Config.mobileConfig.isMobileOrTablet()?this.setState("mobile","mobile"):this.setState("notMobile","mobile"),this.resources.W.Config.env.getCurrentFrameDevice()===Constants.ViewerTypesParams.TYPES.MOBILE&&this.setState("mobileView","displayDevice")},_onDataChange:function(){this._numItems=this._data.get("items").length,this._imageMode=String(this.getComponentProperty("imageMode")),this._expandEnabled=this.getComponentProperty("expandEnabled")===!0,this._resizableSides="flexibleHeight"==this._imageMode?[Constants.BaseComponent.ResizeSides.LEFT,Constants.BaseComponent.ResizeSides.RIGHT]:[Constants.BaseComponent.ResizeSides.TOP,Constants.BaseComponent.ResizeSides.LEFT,Constants.BaseComponent.ResizeSides.BOTTOM,Constants.BaseComponent.ResizeSides.RIGHT],this._checkSkinPartsVisibility(),this.parent()},_checkSkinPartsVisibility:function(){if(this._skinParts){var a=this.getComponentProperty("showNavigation"),b=a?"visible":"hidden";this._skinParts.buttonPrev.setStyle("visibility",b),this._skinParts.buttonNext.setStyle("visibility",b),this._skinParts.counter.setStyle("visibility",this.getComponentProperty("showCounter")?"visible":"hidden")}},_processDataRefs:function(a){var b=[];if(a.length>0){b=[a[this._currentItemIndex]];var c;this._currentItemRef=a[this._currentItemIndex],a.length>1&&(c=this._normalizeIndex(this._currentItemIndex+1),b.push(a[c]),a.length>2&&(c=this._normalizeIndex(this._currentItemIndex-1),b.push(a[c])))}else this._itemHolder.empty();return b},_onAllSkinPartsReady:function(){var a=this.getComponentProperty("galleryImageOnClickAction"),b=this.getComponentProperty("expandEnabled");"unset"===a&&(b===!1?this.setComponentProperty("galleryImageOnClickAction","disabled",!0):this.setComponentProperty("galleryImageOnClickAction","zoomMode",!0)),this._view.setStyle("overflow","hidden"),this._itemHolder=new Element("div"),this._itemHolder.setStyles({position:"absolute",width:"100%",height:"100%"}),this._skinParts.itemsContainer.appendChild(this._itemHolder),this._skinParts.buttonPrev.addEvent(Constants.CoreEvents.MOUSE_DOWN,this._onPrev),this._skinParts.buttonNext.addEvent(Constants.CoreEvents.MOUSE_DOWN,this._onNext),"mobile"===this.getState("mobile")&&(Hammer(this._view).on("swiperight",this._onPrev),Hammer(this._view).on("swipeleft",this._onNext)),this._transitionUtils=new this.imports.TransitionUtils,this._skinParts.virtualContainer||(this._skinParts.virtualContainer=new Element("div"),this._view.grab(this._skinParts.virtualContainer,"top"),this._skinParts.virtualContainer.setStyles({visibility:"hidden",display:"block",width:"1px",height:"1px",overflow:"hidden"})),this._widthDiff=this._skin.widthDiff||0,this._heightDiff=this._skin.heightDiff||0;
var c={cursor:"pointer"},d=this.injects().Utils.getCSSBrowserFeature("user-select");d&&(c[d]="none"),this._skinParts.buttonPrev.setStyles(c),this._skinParts.buttonNext.setStyles(c),this._checkSkinPartsVisibility(),this._onEditorModeChanged(this.resources.W.Config.env.$editorMode)},_mobileShowTextPanel:function(){this.setState("notShow","mobileShowTextPanel"),this._mobileShowTextPanelTimeout&&clearTimeout(this._mobileShowTextPanelTimeout),"mobile"===this.getState("mobile")&&(this.setState("showTextPanel","mobileShowTextPanel"),this._mobileShowTextPanelTimeout=setTimeout(function(){this.setState("notShow","mobileShowTextPanel")}.bind(this),2e3))},_onPrev:function(){this._mobileShowTextPanel(),this.gotoPrev()},_onNext:function(){this._mobileShowTextPanel(),this.gotoNext()},_onEditorModeChanged:function(a){a="view"===document.body.getAttribute("preview")?"PREVIEW":a,this.resources.W.Config.env.$isPublicViewerFrame||this._hideIndicatorElement||(this._editorIndicatorElement||this._createSlideShowIndicatorElement(),"PREVIEW"===a?this._hideEditModeSlideShowIndicator():this._showEditModeSlideShowIndicator())},_createSlideShowIndicatorElement:function(){if(!this._editorIndicatorElement){var a=this.resources.W.Theme.getProperty("WEB_THEME_DIRECTORY")+"ico_slide.png";this._editorIndicatorElement=new Element("div",{styles:{position:"absolute",top:"50%",left:"0",width:"100%",marginTop:"-18px",textAlign:"center"}});var b=new Element("b",{styles:{display:"inline-block",borderRadius:"3px",background:"#222 url("+a+") no-repeat 8px 50%",opacity:"0.6",color:"#ffffff",padding:"0 14px 0 66px",whiteSpace:"nowrap",height:"38px",lineHeight:"39px",fontSize:"12px",position:"static",width:"auto"}});b.set("text","Slide Show"),b.insertInto(this._editorIndicatorElement)}this._editorIndicatorElement.insertInto(this._view)},_hideEditModeSlideShowIndicator:function(){this.removeState("showButtons","editMode"),this._editorIndicatorElement.collapse()},_showEditModeSlideShowIndicator:function(){this.setState("showButtons","editMode"),this._editorIndicatorElement.uncollapse()},_onRepeaterItemReady:function(a,b){b.getViewNode().setStyles({position:"relative"})},_onRepeaterReady:function(a){if(this._galleryItems)for(var b=0;b<this._galleryItems.length;++b)this._galleryItems[b].dispose();this._galleryItems=a.readyItems},_isAllowRender:function(){return!this._locked},render:function(){if(this._isAllowRender()){for(var a,b=0;b<this._galleryItems.length;b++)a=this._galleryItems[b].getLogic(),a.invalidateSize(),this._setupDisplayer(a),this._currentItemRef=="#"+a.getDataItem().get("id")?this._insertNewDisplayer(a):a.getViewNode().setStyles({visibility:"hidden",opacity:"1.0"});this._skinParts.counter.set("text",String(this._currentItemIndex+1)+"/"+String(this._numItems)),this._prevItemIndex=this._currentItemIndex}},isPartiallyFunctionalInStaticHtml:function(){return!0},_setupDisplayer:function(a){a.setOwner(this),a.setSize(this.getWidth()-this._widthDiff,this.getHeight()-this._heightDiff,this._imageMode)},_insertNewDisplayer:function(a){var b=this._itemHolder,c=this._currentDisplayer,d=a.getViewNode(),e=parseFloat(this.getComponentProperty("transDuration"));this._currentDisplayer=a,c&&c!==a&&b.adopt(c.getViewNode()),b.adopt(a.getViewNode()),d.setStyles({position:"absolute",top:"0px",left:"0px",visibility:"visible"}),a.setSize(this.getWidth()-this._widthDiff,this.getHeight()-this._heightDiff,this._imageMode),"flexibleHeight"==this._imageMode&&this._adjustFlexibleHeight(this._currentDisplayer,e);var f=this._currentDisplayer.getImageRef();f&&-1==this._displayedImages.indexOf(f)&&this._displayedImages.push(f),b.children.length>1?(a.setState("transIn"),c&&c.setState("transOut"),this._locked=!0,this._transitionUtils.getTransition(String(this.getComponentProperty("transition")))(b.children[0],b.children[1],this._getTransitionDirection(),e,function(){b.children.length>1&&(b.children[1].setStyle("position","static"),b.removeChild(b.children[0])),this._locked=!1,c&&c.setState("normal"),this._onDisplayerTransitoinFinished(a)}.bind(this))):this._onDisplayerTransitoinFinished(a),a.$view.triggerDisplayChanged()},_onDisplayerTransitoinFinished:function(a){a.setState("noTransition"),this.fireEvent("transitionFinished")},_restartAutoPlay:function(){this._autoplayOn&&this._galleryItems.length>1&&this._startAutoplayTimer()},_adjustFlexibleHeight:function(a,b){var c=a.getHeight()+this._heightDiff;this._Tween.to(this._view,b,{height:c,onUpdate:function(a){this.setHeight(parseInt(a)),this.fireEvent("autoSized")}.bind(this)})},_getTransitionDirection:function(){var a=this.getComponentProperty("bidirectional")===!0,b=this.getComponentProperty("reverse")===!0,c={next:0,prev:1},d=0;return a&&(d=c[this._lastCommand]||0,b&&(d=1==d?0:1)),d},_onResize:function(){var a;this.parent(),this._currentDisplayer&&(this._currentDisplayer.setSize(this.getWidth()-this._widthDiff,this.getHeight()-this._heightDiff,this._imageMode),"flexibleHeight"==this._imageMode?window.requestAnimFrame(function(){a=this._currentDisplayer.getHeight()+this._heightDiff,this._view.setStyle("height",String(a)+"px"),this.setHeight(a),this.fireEvent("autoSized")}.bind(this)):(a=this.getHeight(),this._view.setStyle("height",String(a)+"px"),this.setHeight(a)))},gotoPrev:function(){!this._locked&&this._galleryItems.length>0&&(this._lastCommand="prev",this._currentItemIndex=this._getPrevItemIndex(),this._allRepeatersReady=!1,this._renderIfReady()),this.fireEvent("displayerChanged")},gotoNext:function(){!this._locked&&this._galleryItems.length>0&&(this._lastCommand="next",this._currentItemIndex=this._getNextItemIndex(),this._allRepeatersReady=!1,this._renderIfReady()),this.fireEvent("displayerChanged")},onPageVisibilityChange:function(a){a?this._restartAutoPlay():this._stopAutoPlay()},_stopAutoPlay:function(){null!=this._timeoutID&&(clearTimeout(this._timeoutID),this._timeoutID=null)},_getNextItemIndex:function(){return this._normalizeIndex(this._currentItemIndex+1)},_getPrevItemIndex:function(){return this._normalizeIndex(this._currentItemIndex-1)},_normalizeIndex:function(a){return(a%this._numItems+this._numItems)%this._numItems}})}),define.component("wysiwyg.viewer.components.SliderGallery",function(a){var b=a;b.inherits("core.components.BaseRepeater"),b.resources(["W.Commands","W.Utils","W.Config"]),b.propertiesSchemaType("SliderGalleryProperties"),b.dataTypes(["ImageList"]),b.skinParts({imageItem:{type:"wysiwyg.viewer.components.Displayer",repeater:!0,container:"itemsContainer",dataRefField:"items"},itemsContainer:{type:"htmlElement"},swipeLeftHitArea:{type:"htmlElement"},swipeRightHitArea:{type:"htmlElement"}}),b.states({mobile:["notMobile","mobile"],displayDevice:["mobileView"]}),b.binds(["gotoNext","gotoPrev","_updateMovementNoLoop","_updateMovementInLoop","_stopMovement"]),b.statics({LEFT:"LEFT",RIGHT:"RIGHT"}),b.fields({EDITOR_META_DATA:{general:{settings:!0,design:!0},custom:[{label:"GALLERY_ORGANIZE_PHOTOS",command:"WEditorCommands.OpenListEditDialog",commandParameter:{galleryConfigID:"SliderGallery",publicMediaFile:"photos",i18nPrefix:"multiple_images",mediaType:"picture",selectionType:"multiple",source:"fpp"},commandParameterDataRef:"SELF"},{label:"CHANGE_GALLERY_TYPE",command:"WEditorCommands.OpenChangeGalleryDialog",commandParameter:{}}],dblClick:{command:"WEditorCommands.OpenListEditDialog",commandParameter:{galleryConfigID:"SliderGallery",publicMediaFile:"photos",i18nPrefix:"multiple_images",mediaType:"picture",selectionType:"multiple",source:"dblclick"},commandParameterDataRef:"SELF"},mobile:{previewImageDataRefField:"*"}},_itemHolder:null,_itemWidth:0,_itemHeight:0,_gap:20,_movementSpeed:0,_shiftOffset:0,_shiftOffsetMax:0,_shiftOffsetMin:0,_maxSpeed:.05,_aspectRatio:0,_inMotion:!1,_keepMovementActive:!1,_debugMode:!1,_imageMode:"",_lastUpdate:0/0,_updateMovementFunc:null,_loop:!1,_itemsHolderSize:0,_contentOverflow:!1,_segment:0,_isZoomed:!1}),b.methods({initialize:function(a,b,c){this.parent(a,b,c),this.addEvent("resizeEnd",this._onResizeEnd),this.resources.W.Commands.registerCommandListenerByName("WPreviewCommands.WEditModeChanged",this,this._onChangeMode,null),W.Config.mobileConfig.isMobileOrTablet()?this.setState("mobile","mobile"):this.setState("notMobile","mobile"),this.resources.W.Config.env.getCurrentFrameDevice()===Constants.ViewerTypesParams.TYPES.MOBILE&&this.setState("mobileView","displayDevice")},_onChangeMode:function(a){"PREVIEW"!==a&&this._stopMovement()},_onResizeEnd:function(){this._recalcItemSize(),this._allRepeatersReady=!1,this._renderIfReady()},_recalcItemSize:function(){this._skinParts&&(this._itemHeight=Math.floor(this._skinParts.itemsContainer.getHeight()),this._itemWidth=Math.floor(this._itemHeight*this._aspectRatio))},_processDataRefs:function(a){return this._loop===!0?a.concat(a):a},_onDataChange:function(){this._enableMovement(!1),this._aspectRatio=this._parseAspectRatioPreset(this.getComponentProperty("aspectRatioPreset")),this._aspectRatio?this.setComponentProperty("aspectRatio",this._aspectRatio,!0):this._aspectRatio=parseFloat(this.getComponentProperty("aspectRatio")),this._loop=this.getComponentProperty("loop")===!0,this._maxSpeed=parseInt(this.getComponentProperty("maxSpeed")),this._imageMode=String(this.getComponentProperty("imageMode")),this._gap=parseInt(this.getComponentProperty("margin")),this.parent()},_parseAspectRatioPreset:function(a){var b=a.split(":"),c=0;return 2==b.length&&(c=parseFloat(b[0])/parseFloat(b[1])),c},_onAllSkinPartsReady:function(){var a=this.getComponentProperty("galleryImageOnClickAction"),b=this.getComponentProperty("expandEnabled");"unset"===a&&(b===!1?this.setComponentProperty("galleryImageOnClickAction","disabled",!0):this.setComponentProperty("galleryImageOnClickAction","zoomMode",!0)),this._itemHolder=this._skinParts.itemsContainer,this._itemHolder.setStyles({position:"absolute",left:"0px",right:"0px",top:"0px",bottom:"0px","white-space":"nowrap","-webkit-transform":"translateZ(0)"}),this._skinParts.itemsContainer.setStyles({overflow:this._debugMode?"visible":"hidden",border:this._debugMode?"1px solid black":"0"}),this.resources.W.Commands.registerCommandListenerByName("WViewerCommands.SetMediaZoomImage",this,this._onMediaZoomClicked,null),this.resources.W.Commands.registerCommandListenerByName("WViewerCommands.MediaZoom.Close",this,this._onMediaZoomClosed,null),this._skinParts.swipeLeftHitArea.addEvent(Constants.CoreEvents.MOUSE_MOVE,this.gotoPrev),this._skinParts.swipeRightHitArea.addEvent(Constants.CoreEvents.MOUSE_MOVE,this.gotoNext),this._skinParts.swipeLeftHitArea.addEvent(Constants.CoreEvents.MOUSE_OUT,this._stopMovement),this._skinParts.swipeRightHitArea.addEvent(Constants.CoreEvents.MOUSE_OUT,this._stopMovement),"mobile"===this.getState("mobile")&&(Hammer(this._view).on("swiperight",this.gotoPrev),Hammer(this._view).on("swipeleft",this.gotoNext))},_onMediaZoomClicked:function(){this._isZoomed=!0,this._stopMovement()},_onMediaZoomClosed:function(){this._isZoomed=!1},render:function(){var a;for(this._recalcItemSize(),this._updateMovementFunc=this._loop===!0?this._updateMovementInLoop:this._updateMovementNoLoop,this._loop===!1&&(this._segment=0),this._shiftOffset=0,this._itemsHolderSize=0,a=0;a<this._itemHolder.children.length;a++)this._setupDisplayer(this._itemHolder.children[a].getLogic(),a),this._itemsHolderSize+=this._itemHolder.children[a].getLogic().getWidth()+this._gap;this._checkItemsVisibility(),this._applyShiftOffset()},isPartiallyFunctionalInStaticHtml:function(){return!0},_checkItemsVisibility:function(){var a=this._itemHolder.children.length/2,b=this._loop===!0?this._itemsHolderSize/2:this._itemsHolderSize;this._contentOverflow=b>this._skinParts.itemsContainer.getWidth(),this._loop===!0&&this._contentOverflow===!1&&(this._segment=0);for(var c=0;c<this._itemHolder.children.length;c++)this._loop===!0&&this._contentOverflow===!1&&c>=a?this._itemHolder.children[c].setStyle("opacity","0.0"):this._itemHolder.children[c].setStyle("opacity","1.0")},_setupDisplayer:function(a){a.invalidateSize(),a.setSize(this._itemWidth,this._itemHeight,this._imageMode),a.setOwner(this),a.getViewNode().setStyles({position:"static",display:"inline-block","vertical-align":"top","margin-right":String(this._gap)+"px","margin-left":"0px",opacity:"1.0"})},_moveTo:function(a){this._keepMovementActive=!0;var b=this._maxSpeed;a===this.LEFT&&(b*=-1),this._contentOverflow&&(this._setMovementSpeed(b),this._enableMovement(!0))},gotoNext:function(){this._isZoomed||(this._moveTo(this.RIGHT),"mobile"===this.getState("mobile")&&(clearTimeout(this._nextStopTimeout),this._nextStopTimeout=setTimeout(function(){this._stopMovement()}.bind(this),2e3)))},gotoPrev:function(){this._isZoomed||(this._moveTo(this.LEFT),"mobile"===this.getState("mobile")&&(clearTimeout(this._prevStopTimeout),this._prevStopTimeout=setTimeout(function(){this._stopMovement()}.bind(this),2e3)))},_enableMovement:function(a){a===!0?(this._inMotion===!1&&window.requestAnimFrame(this._updateMovementFunc),this._inMotion||(this._shiftOffsetMin=this._skinParts.itemsContainer.getWidth()+this._gap-this._itemsHolderSize,this._offsetIsOnGapOnly()&&(this._shiftOffsetMin=0),this._inMotion=!0)):(this._inMotion=!1,this._movementSpeed=0)},_stopMovement:function(){var a=this.resources.W.Utils.Tween;this._keepMovementActive=!1,a.to(this,1,{_movementSpeed:0,onComplete:function(){this._keepMovementActive||this._enableMovement(!1)}.bind(this)})},_setMovementSpeed:function(a){var b=this.resources.W.Utils.Tween;b.to(this,1,{_movementSpeed:a})},_calcMovementCoeficient:function(){var a=1,b=(new Date).getTime();return isNaN(this._lastUpdate)||(a=(b-this._lastUpdate)/16),this._lastUpdate=b,a},_updateMovementNoLoop:function(){var a=this._calcMovementCoeficient();this._inMotion&&(this._shiftOffset+=-this._movementSpeed*a,this._shiftOffset>this._shiftOffsetMax&&(this._shiftOffset=this._shiftOffsetMax,this._enableMovement(!1)),this._shiftOffset<this._shiftOffsetMin&&(this._shiftOffset=this._shiftOffsetMin,this._enableMovement(!1)),this._applyShiftOffset()),this._inMotion&&window.requestAnimFrame(this._updateMovementFunc)},_updateMovementInLoop:function(){var a=this._calcMovementCoeficient();this._inMotion&&(this._shiftOffset+=-this._movementSpeed*a,this._movementSpeed<0&&(this._segment=0,this._shiftOffset>this._shiftOffsetMax&&(this._shiftOffset-=this._itemsHolderSize/2)),this._movementSpeed>0&&(this._segment=1,this._shiftOffset<0&&(this._shiftOffset+=this._itemsHolderSize/2)),this._applyShiftOffset()),this._inMotion&&window.requestAnimFrame(this._updateMovementFunc)},_applyShiftOffset:function(){var a=this._shiftOffset-this._segment*this._itemsHolderSize/2;this._itemHolder.children.length>0&&this._itemHolder.children[0].setStyle("margin-left",String(Math.floor(a))+"px")},_offsetIsOnGapOnly:function(){return Math.abs(this._shiftOffsetMin)<this._gap&&this._shiftOffsetMin>0}})}),define.component("wysiwyg.viewer.components.SocialBaseComponent",function(a){var b=a;b.inherits("wysiwyg.viewer.components.IFrameComponent"),b.resources(["W.Config","topology"]),b.binds(["_createClickOverlay","_getUrl"]),b.methods({initialize:function(a,b,c){if(this.parent(a,b),this._resizableSides=[],c&&c.propObj)for(var d in c.propObj){var e=c.propObj[d];this.setComponentProperty(d,e)}this._iframeCallback=0},_onResize:function(){this._initialized&&this._renderIframe()},render:function(){this._createClickOverlay(),this._renderComponent(),this._initialized=!0},_renderComponent:function(){if(this._renderIframe(!1),this._getSizeAccordingToProperties){var a=this._getSizeAccordingToProperties();this._changeSize(a)}},_getSizeAccordingToProperties:function(){return{w:225,h:55}},_getUrl:function(){var a=this.resources.topology.wysiwyg+"/html/external/",b=this._getUrlParams();return a+this._getPageName()+"?"+Object.toQueryString(b)},_getPageName:function(){},_getUrlParams:function(){return{}}})}),define.component("wysiwyg.viewer.components.SoundCloudWidget",function(a){var b=a;b.inherits("wysiwyg.viewer.components.IFrameComponent"),b.resources(["W.Config","W.Utils","W.Viewer","W.Commands"]),b.binds(["_stopPlayback","_getSoundCloudUrl"]),b.states(["hasContent","noContent"]),b.dataTypes(["SoundCloudWidget"]),b.traits(["wysiwyg.viewer.components.traits.IframeUtils"]),b.fields({_renderTriggers:[Constants.DisplayEvents.DISPLAY_CHANGED],EDITOR_META_DATA:{general:{settings:!0,design:!1},mobile:{allInputsHidden:!0}}}),b.methods({initialize:function(a,b,c){c=c||{},this.parent(a,b,c),this._urlExists=!1,this._view.addEvent(Constants.DisplayEvents.COLLAPSED,this._stopPlayback),this.resources.W.Commands.registerCommandListenerByName("WPreviewCommands.WEditModeChanged",this,this._onEditorModeChanged),this.setMinW(250)},_stopPlayback:function(){this.setIFrameSrc(this._iframe,"")},_updateIFrameSize:function(){var a;a=this._iframe,a&&a.set({width:this._view.getWidth()-1,height:this._view.getHeight()-1})},_getUrl:function(){return this._getSoundCloudUrl()},_getSoundCloudUrl:function(){var a=this._data.get("url");if(this._urlExists=!1,void 0!=a&&""!=a){3==a.split("?").length&&(a=a.substring(0,a.lastIndexOf("?"))),a=this.resources.W.Utils.setUrlParam(a,"show_artwork",this._isDataTrue("showArtWork"));var b=this._isDataTrue("autoPlay");(this.resources.W.Config.env.isViewingSecondaryDevice()||this.resources.W.Config.env.isInDeactivatedViewer()||!this.getIsDisplayed())&&(b=!1),a=this.resources.W.Utils.setUrlParam(a,"auto_play",b),a=this._normalizeSoundcloudUrl(a),this._urlExists=!0}return a||""},_normalizeSoundcloudUrl:function(a){return a=this._decodeUrl(a),a=this._encodeSemicolon(a)},_decodeUrl:function(a){return a=a.replace(/%2B/g,"+"),a=a.replace(/%3F/g,"?"),a=a.replace(/%3D/g,"="),a=a.replace(/%25/g,"%"),a=a.replace(/%26/g,"&"),a=a.replace(/%2A/g,"*"),a=a.replace(/%2F/g,"/"),a=a.replace(/%40/g,"@"),a=a.replace(/%3A/g,":")},_encodeSemicolon:function(a){return a.replace(/;/g,"%3b")},_isDataTrue:function(a){var b=!1;return(this._data.get(a)===!0||"true"===this._data.get(a))&&(b=!0),b},_setIframeParams:function(){this._iframe["class"]="html5player",this._iframe.setStyles({position:"absolute"}),this._urlExists===!1?this.setState("noContent"):this.setState("hasContent"),this._updateIFrameSize()},_onEditorModeChanged:function(a,b){("PREVIEW"==a||"PREVIEW"==b)&&this._updateIframe(!0)},_getIframeContainer:function(){return this._skinParts.iFrameHolder},setHeight:function(a,b,c){a=Math.max(a,50),this._view.setStyle("height",parseInt(a)+"px"),this.parent(a,b,c)},setWidth:function(a,b,c){a=Math.max(a,200),this._view.setStyle("width",parseInt(a)+"px"),this.parent(a,b,c)}})}),define.component("wysiwyg.viewer.components.TableComponent",function(a){var b=a;b.inherits("mobile.core.components.base.BaseComponent"),b.utilize(["wysiwyg.viewer.utils.ComponentSequencer"]),b.skinParts({tableBody:{type:"htmlElement"},tableHeader:{type:"htmlElement",optional:!0},tableFooter:{type:"htmlElement",optional:!0},table:{type:"htmlElement",optional:!0}}),b.propertiesSchemaType("TableComponentProperties"),b.binds(["_createBodyRow","_createHeaderCell","_createFooterCell","_createBodyCell","_addSpacerRow"]),b.dataTypes(["list","Table"]),b.methods({initialize:function(a,b,c){this.parent(a,b,c),this._rowsSequencer=new this.imports.ComponentSequencer,this._rowsSequencer.resolveItem=this._createBodyRow,this._rowsSequencer.addEvent("productionFinished",this._addSpacerRow),this._bodyCellSequencingHook=c.SequencingHook,this._headerFooterCellSequencingHook=c.HeaderFooterSequencingHook||c.SequencingHook},_onAllSkinPartsReady:function(a){this.parent(a);var b=this.getComponentProperty("minHeight");b&&this.setMinH(b),this.getDataItem()&&this._populateTable()},_onComponentPropertyChange:function(a,b){"minHeight"===a&&this.setMinH(b)},setMinH:function(a){this._skinParts&&this._skinParts.table.setStyle("height",a+"px"),this.parent(a),this.setHeight(a)},_onDataChange:function(a,b,c){this._skinParts&&("minHeight"==b?this.setMinH(c.minHeight||c):(this._populateTable(),this.fireEvent("autoSized",{ignoreLayout:!1}))),this.parent(a,b,c)},_populateTable:function(){var a=this.getDataItem();if(this._rowsSequencer.createComponents(this._skinParts.tableBody,a.get("items")),a.hasField("header")){var b=this._createRow(a.get("header"),this._createHeaderCell);this._skinParts.tableHeader.empty().adopt(b)}else this._skinParts.tableHeader.removeFromDOM();if(a.hasField("footer")){var c=this._createRow(a.get("footer"),this._createFooterCell);this._skinParts.tableFooter.empty().adopt(c)}else this._skinParts.tableFooter.removeFromDOM()},_createBodyRow:function(a){return this._createRow(a,this._createBodyCell)},_createRow:function(a,b){var c=new Element("tr"),d=new this.imports.ComponentSequencer;return d.resolveItem=b,d.createComponents(c,a),c},_createHeaderCell:function(a,b,c){return this._createCell(a,b,c,"th",this._headerFooterCellSequencingHook)},_createFooterCell:function(a,b,c){return this._createCell(a,b,c,"td",this._headerFooterCellSequencingHook)},_createBodyCell:function(a,b,c){return this._createCell(a,b,c,"td",this._bodyCellSequencingHook)},_createCell:function(a,b,c,d,e){var f=new Element(d),g=e(a,b,c);g&&f.grab(g);var h=a.styleData;if(h)for(var i in h)f.setStyle(i,h[i]);return f},_addSpacerRow:function(){var a=new Element("tr",{"class":"spacer"}),b=new Element("td",{colspan:"100%"});a.adopt(b),this._skinParts.tableBody.adopt(a),this.fireEvent("autoSized",{ignoreLayout:!1})}})}),define.component("wysiwyg.viewer.components.TryAgainMessageView",function(a){var b=a;b.inherits("mobile.core.components.base.BaseComponent"),b.skinParts({blockingLayer:{type:"htmlElement"},okButton:{type:"core.editor.components.EditorButton"},backButton:{type:"htmlElement"},title:{type:"htmlElement"},description:{type:"htmlElement"},dialog:{type:"htmlElement"}}),b.binds(["_closeView","_closeViewAndCallback"]),b.statics({TRY_AGAIN_CAPTION:"Try Again",BACK_CAPTION:"Back"}),b.resources(["W.Commands"]),b.methods({_onAllSkinPartsReady:function(a){a.okButton.setLabel(this.TRY_AGAIN_CAPTION),a.backButton.set("html",this.BACK_CAPTION),a.backButton.addEvent("click",this._closeView)},showMessage:function(a){this.uncollapse(),this._skinParts.title.set("html",a.msgTitle||""),this._skinParts.description.set("html",a.msgBody||""),this._callbackOnRetry=a.cb,this._skinParts.okButton.addEvent("buttonClick",this._closeViewAndCallback),this._visible=!0},hideMessage:function(){this.collapse(),this._visible=!1},visible:function(){return this._visible},_closeView:function(){this.hideMessage(),this.fireEvent("complete")},_closeViewAndCallback:function(){this._closeView(),this._callbackOnRetry&&this._callbackOnRetry()}})}),define.component("wysiwyg.viewer.components.TwitterFeed",function(a){var b=a;b.inherits("mobile.core.components.base.BaseComponent"),b.resources(["W.Skins","W.Config","topology"]),b.propertiesSchemaType("TwitterFeedProperties"),b.dataTypes(["TwitterFollow"]),b.binds(["_applyThemeColors","_onResizeEnd"]),b.skinParts({label:{type:"htmlElement"},link:{type:"htmlElement"}}),b.fields({MIN_SIZE:220,EDITOR_META_DATA:{general:{settings:!0,design:!1},custom:[{label:"FPP_DESIGN_LABEL",command:"WEditorCommands.AdvancedDesign"}]}}),b.methods({initialize:function(a,b,c){c=c||{},this.parent(a,b,c),this._iframeLoaded=!1,this.addEvent("resizeEnd",this._onResizeEnd),this._minimumTimeBetweenRenders=2e3},render:function(){this._renderFeed()},_onStyleReady:function(){this.parent(),this._style.addEvent(Constants.StyleEvents.PROPERTY_CHANGED,this._applyThemeColors)},_applyThemeColors:function(a){var b=["bg","txt1","bg2","txt2","linkColor"];for(var c in a.properties)if(b.indexOf(c)>-1)return this._renderFeed(),void 0},_renderFeedAndDontReload:function(){this._renderFeed(!0)},_renderFeed:function(){if(this.isReady()){this._iframeLoaded=!0;var a=this._data.get("accountToFollow")||"wix";this._skinParts.label.set("html",a),this._skinParts.link.set("href","https://twitter.com/intent/user?screen_name="+a)}},_createIframe:function(a){var b=new IFrame({src:this.resources.topology.wysiwyg+"/html/external/twfeed.html",width:"100%",height:"100%",webkitAllowFullScreen:"true",mozallowfullscreen:"true",allowfullscreen:"allowfullscreen",frameBorder:"0",scrolling:"no",events:{load:function(){this._iframeLoaded=!0,this._postMessageToIframe(a)}.bind(this)}});this._iframe=b,this._view.empty(),this._view.grab(b)},_postMessageToIframe:function(a){var b=this.resources.W.Skins,c=this._skin.className,d={userName:this._data.get("accountToFollow")||"wix",height:this._view.getHeight()-90,width:this._view.getWidth(),numOfTweets:this.getComponentProperty("numOfTweets")||1,shellBGColor:b.getSkinParamValue(c,"bg",this._style).getHex(!1),shellColor:b.getSkinParamValue(c,"txt1",this._style).getHex(!1),tweetBGColor:b.getSkinParamValue(c,"bg2",this._style).getHex(!1),tweetColor:b.getSkinParamValue(c,"txt2",this._style).getHex(!1),tweetLinkColor:b.getSkinParamValue(c,"linkColor",this._style).getHex(!1),start:!a};this._iframe.contentWindow.postMessage(JSON.stringify(d),"*")},setHeight:function(a){a=Math.max(220,a),this._view.setStyle("height",parseInt(a)+"px"),this.parent(a,!0,!0)},setWidth:function(a){a=Math.max(220,a),this._view.setStyle("width",parseInt(a)+"px"),this.parent(a,!0,!0)},_onResize:function(){this.parent(),this._renderFeedAndDontReload()},_onResizeEnd:function(){this._renderFeed()}})}),define.component("wysiwyg.viewer.components.VKShareButton",function(a){var b=a;b.inherits("core.components.base.BaseComp"),b.traits(["wysiwyg.viewer.components.traits.CustomPreviewBehavior"]),b.resources(["W.Config","W.Utils","W.Viewer","W.Commands","topology"]),b.propertiesSchemaType("VKShareProperties"),b.dataTypes(["VKShareButton"]),b.skinParts({iframe:{type:"htmlElement"}}),b.binds(["_onPostMessageChangeWidth"]),b.statics({LayoutSize:{Button:{w:100,h:21},ButtonWithoutCounter:{w:64,h:21},Link:{w:50,h:21},LinkWithoutIcon:{w:30,h:21},Icon:{w:36,h:36}}}),b.methods({initialize:function(a,b,c){this._resizableSides=[],this.EDITOR_META_DATA={general:{settings:!0,design:!1},mobile:{allInputsHidden:!0}},window.addNativeListener("message",this._onPostMessageChangeWidth),this.parent(a,b,c)},_onRender:function(){var a,b;return this.resources.W.Viewer.isSiteReady()?(this._measured=!1,a=this.getDataItem(),b=this.LayoutSize[a.get("style")]||this.LayoutSize.Button,this._createClickOverlayForPreviewMode("Social_Widgets_Only_On_Public"),this._changeSize(b.w,b.h),this._skinParts.iframe.setAttribute("src",this._getIframeUrl()),void 0):(this.invalidate("siteNotReady"),void 0)},isRenderNeeded:function(a){var b=[this.INVALIDATIONS.SKIN_CHANGE,this.INVALIDATIONS.DATA_CHANGE,this.INVALIDATIONS.DISPLAY,"siteNotReady"];return a.isInvalidated(b)},_onPostMessageChangeWidth:function(a){var b,c,d,e=this.getComponentUniqueId();try{d=JSON.parse(a.data)}catch(a){return}e===d.id&&(b=d.width,c=this.getHeight(),this._changeSize(b,c))},_getIframeUrl:function(){var a=this.resources.topology.wysiwyg+"/html/external/VKShare.html",b=this._getUrlParams();return a+"?"+Object.toQueryString(b)},_getUrlParams:function(){var a=this.getDataItem(),b=this._getPageInfo();return{id:this.getComponentUniqueId(),url:b.url||"",style:a.get("style"),text:a.get("text")||"Share"}},_getPageInfo:function(){var a,b,c=this.resources.W.Viewer,d={};return this._isPublicViewerFrame()?(a=c.getCurrentPageId())?(b=c.getPageData(a),d={url:this._getPageUrl(b,a)}):d:d},_getPageUrl:function(a,b){var c,d,e=this.resources.W.Viewer;return c=this.resources.W.Config.getExternalBaseUrl()||"",this._isHomePage(b,e)||this._isComponentInHeader()||(d=a.get("pageUriSEO"),c+="#!"+d+"/"+b),c},_isPublicViewerFrame:function(){return this.resources.W.Config.env.$isPublicViewerFrame},_isComponentInHeader:function(){for(var a,b=this.getParentComponent();b;){if(a=b.className,-1!==a.indexOf(".Page"))return!1;if(-1!==a.indexOf("HeaderContainer"))return!0;b=b.getParentComponent()}return!0},_isHomePage:function(a,b){var c=0===a.indexOf("#")?a.substr(1):a;return b.getHomePageId()===c},_changeSize:function(a,b){this.setWidth(a),this.setHeight(b)},onPageVisibilityChange:function(a){a&&!this._measured&&(this._measured=!0,this._skinParts.iframe.setAttribute("src",this._getIframeUrl()))},setWidth:function(a){this.parent(a),this._skinParts.iframe.setStyle("width",a+"px")},setHeight:function(a){this.parent(a),this._skinParts.iframe.setStyle("height",a+"px")},exterminate:function(){window.removeNativeListener("message",this._onPostMessageChangeWidth),this.parent()}})}),define.component("wysiwyg.viewer.components.VerticalLine",function(a){var b=a;b.inherits("core.components.base.BaseComp"),b.fields({_renderTriggers:[Constants.DisplayEvents.SKIN_CHANGE],EDITOR_META_DATA:{general:{settings:!0,design:!0},mobile:{allInputsHidden:!0}}}),b.methods({initialize:function(a,b,c){this.parent(a,b,c),this._resizableSides=[Constants.BaseComponent.ResizeSides.TOP,Constants.BaseComponent.ResizeSides.BOTTOM],this._rotatable=!0},_onRender:function(){var a=this._skinParts.line.$measure.width;this.setWidth(a)},isRenderNeeded:function(a){var b=[this.INVALIDATIONS.SKIN_CHANGE,this.INVALIDATIONS.PART_SIZE];return a.isInvalidated(b)},setHeight:function(a,b,c){this._getNumberOfKnobs();this.height=a,this.parent(a,b,c)},_getNumberOfKnobs:function(){var a=0;return this._skinParts&&(this._skinParts.bottomKnob&&a++,this._skinParts.topKnob&&a++,this._skinParts.middleKnob&&a++),a}})}),define.component("wysiwyg.viewer.components.VerticalRepeater",function(a){var b=a;b.inherits("mobile.core.components.base.BaseComponent"),b.utilize(["wysiwyg.viewer.utils.ComponentSequencer"]),b.dataTypes(["","ImageList"]),b.binds(["_sequencingHook"]),b.skinParts({inlineContent:{type:"htmlElement"}}),b.methods({initialize:function(a,b,c){this.parent(a,b,c),this._sequencer=new this.imports.ComponentSequencer,this._sequencer.resolveItem=c&&c.sequencingHook?this._sequencingHookWrapper(c.sequencingHook):this._sequencingHookWrapper(this._sequencingHook)},_sequencingHookWrapper:function(a){return function(b,c,d){return a(b,c,d)}},getSequencer:function(){return this._sequencer},_sequencingHook:function(){return{comp:"wysiwyg.viewer.components.Displayer",skin:this._skin.compParts.imageItem.skin}},setSequencingHook:function(a){this._sequencer.resolveItem=this._sequencingHookWrapper(a)},_onAllSkinPartsReady:function(){this._sequencer.addEvent("productionFinished",function(a){this._markChildren(a.elements)}.bind(this))},render:function(){this._data&&(this._newItems=[],this._sequencer.createComponents(this._skinParts.inlineContent,this._data.get("items")))},_markChildren:function(a){a.each(function(a,b,c){a.set("isfirst",0==b?"true":"false"),a.set("iseven",b%2==1?"true":"false"),a.set("islast",b==c.length-1?"true":"false")})}})}),define.component("wysiwyg.viewer.components.Video",function(a){var b=a;b.inherits("mobile.core.components.base.BaseComponent"),b.resources(["W.Config","W.Commands","topology"]),b.skinParts({videoFrame:{type:"htmlElement"},preview:{type:"htmlElement"}}),b.binds(["_stopVideo","_getYouTubeParams","_getVimeoParams","_onResize","_onResizeEnd","_getYouTubePreview","_getViemoPreviewUrl"]),b.states([]),b.dataTypes(["Video"]),b.propertiesSchemaType("VideoProperties"),b.traits(["wysiwyg.viewer.components.traits.IframeUtils"]),b.fields({_renderTriggers:[Constants.DisplayEvents.DISPLAY_CHANGED],EDITOR_META_DATA:{general:{settings:!0,design:!0}},_defaultPlayerParams:{wmode:"transparent"},_options:{videoType:"",videoId:"",resize:[]}}),b.methods({_getServices:function(){return{YOUTUBE:{url:"//www.youtube.com/embed/",preview:this._getYouTubePreview,getParams:this._getYouTubeParams,hMinSize:200,wMinSize:200},VIMEO:{url:"http://player.vimeo.com/video/",preview:this._getViemoPreviewUrl,getParams:this._getVimeoParams,hMinSize:100,wMinSize:100}}},initialize:function(a,b,c){c=c||{},this.parent(a,b,c),this._iframe=null,this.addEvent("resizeEnd",this._onResizeEnd),this.resources.W.Commands.registerCommandListenerByName("WPreviewCommands.WEditModeChanged",this,this._onEditorModeChanged),this._view.addEvent(Constants.DisplayEvents.COLLAPSED,this._stopVideo)},_stopVideo:function(){this._iframe&&this.setIFrameSrc(this._iframe,"about:blank")
},render:function(){this._renderIframe(),this.setMinW(this._getWMinSize()),this.setMinH(this._getHMinSize())},_onResize:function(){this.parent()},_onResizeEnd:function(){this._renderIframe()},_onEditorModeChanged:function(a,b){if(!this.resources.W.Config.env.$isPublicViewerFrame){var c="PREVIEW";(b===c||a===c)&&this._renderIframe()}},setHeight:function(a,b,c){a=Math.max(a,this._getHMinSize()),this._view.setStyle("height",parseInt(a,10)+"px"),this.parent(a,!0,c)},setWidth:function(a,b,c){a=Math.max(a,this._getWMinSize()),this._view.setStyle("width",parseInt(a,10)+"px"),this.parent(a,b,c)},_getHMinSize:function(){var a=this._getVideoType(),b=this._getServices()[a].hMinSize,c=this.getComponentProperty("showControls");return"YOUTUBE"===a&&"always_show"===c&&(b+=20),b},_getWMinSize:function(){var a=this._getVideoType();return this._getServices()[a].hMinSize},_renderIframe:function(){if(this._options.videoType=this._getVideoType(),this._options.videoId=this._getVideoId(),this._options.videoId&&this._options.videoType){if(!this.resources.W.Config.env.isInInteractiveViewer()&&Browser.firefox&&Browser.Platform.mac)return this._createPreview(),void 0;this._skinParts.videoFrame.uncollapse(),this._skinParts.preview.collapse(),this._iframe&&this._skinParts.videoFrame.hasChildNodes()?this._updateIframe(this._getUrl(),this.getWidth(),this.getHeight()):this._createIframe(this._getUrl(),this.getWidth(),this.getHeight()),this._iframe.setStyles({height:"100%",width:"100%"})}},_getContainerIframe:function(){return this.resources.topology.wysiwyg+"/html/external/video.html"},_createIframe:function(a,b,c){var d=this._getContainerIframe()+"?url="+encodeURIComponent(a)+"&width="+b+"&height="+c;this._iframe=new IFrame({src:d,webkitAllowFullScreen:"true",mozallowfullscreen:"true",allowfullscreen:"allowfullscreen",frameborder:"0"}),this._iframe.insertInto(this._skinParts.videoFrame)},_updateIframe:function(a){var b=this._getContainerIframe()+"?url="+encodeURIComponent(a);this.setIFrameSrc(this._iframe,b)},_getPlayerParamsAsQueryString:function(){var a=this._getServices()[this._options.videoType].getParams(),b=[];return Object.forEach(a,function(a,c){b.push(c+"="+a)}),b.join("&")},_getYouTubeParams:function(){var a={},b=this.getComponentProperty("showControls"),c=this.resources.W.Config.isFacebookSite(),d=this.getComponentProperty("autoplay")&&!c,e=this.getComponentProperty("lightTheme"),f=this.getComponentProperty("loop"),g=this.getComponentProperty("showinfo");switch(a.wmode="transparent",this.resources.W.Config.env.isInInteractiveViewer()&&(a.autoplay=d&&this.getIsDisplayed()?"1":"0"),a.theme=e?"light":"dark",b){case"always_show":a.controls="1",a.autohide="0";break;case"always_hide":a.controls="0";break;case"temp_show":a.autohide="1"}return f?(a.loop="1",a.playlist=this._options.videoId):a.loop="0",a.showinfo=g?"1":"0",a.rel="0",a},_getVimeoParams:function(){var a={};return this.resources.W.Config.env.isInInteractiveViewer()&&(a.autoplay=this.getIsDisplayed()?this.getComponentProperty("autoplay"):0),a.loop=this.getComponentProperty("loop"),a.byline=this.getComponentProperty("showinfo"),a.portrait=this.getComponentProperty("showinfo"),a.title=this.getComponentProperty("showinfo"),a},_getUrl:function(){return this._getServices()[this._options.videoType].url+this._options.videoId+"?"+this._getPlayerParamsAsQueryString()},_getVideoType:function(){return this._data&&this._data.get("videoType")},_getVideoId:function(){return this._data&&this._data.get("videoId")},_createPreview:function(){var a=this._getServices(),b=this._options.videoType,c=a[b].preview;c()},_renderPreviewImage:function(a){var b=this._view.getWidth(),c=this._view.getHeight();this._image?this._updatePreviewImage(a,c,b):this._createPreviewImage(a,c,b)},_createPreviewImage:function(a,b,c){this._image=new Image,this._image.src=a,this._image.setStyles({height:b,width:c}),this._image.insertInto(this._skinParts.preview),this._options.resize.push(this._image),this._skinParts.videoFrame.collapse(),this._skinParts.preview.uncollapse()},_updatePreviewImage:function(a,b,c){this._image.get("src")!=a&&this._image.set("src",a),this._image.setStyles({height:b,width:c}),this._skinParts.videoFrame.collapse(),this._skinParts.preview.uncollapse()},_getYouTubePreview:function(){var a="http://img.youtube.com/vi/[repLace]/0.jpg",b=a.replace("[repLace]",this._options.videoId);this._renderPreviewImage(b)},_getViemoPreviewUrl:function(){var a="http://vimeo.com/api/v2/video/[repLace].json",b=a.replace("[repLace]",this._options.videoId),c=new Request.JSONP({url:b+"?r="+Math.random(),onComplete:this.onVimeoRetrun.bind(this)});c.send()},onVimeoRetrun:function(a){var b=a&&a[0]&&a[0].thumbnail_large;this._renderPreviewImage(b)}})}),define.component("wysiwyg.viewer.components.WFacebookComment",function(a){var b=a;b.inherits("mobile.core.components.base.BaseComponent"),b.resources(["W.Utils","W.Viewer","W.TPA","W.Config","W.Commands"]),b.propertiesSchemaType("WFacebookCommentProperties"),b.skinParts({facebook:{type:"htmlElement"}}),b.states({EDITOR:["light","dark"],VIEWER:["scriptLoading","scriptLoaded","loading","idle","disabled"],displayDevice:["mobileView"]}),b.binds(["_onResizeEnd","_onFacebookComponentRender","_checkIframeSize","_renderComponentOnViewer","_rebuildFacebookComponent"]),b.fields({EDITOR_META_DATA:{general:{settings:!0,design:!1}},WIDTH:{MOBILE:280,DESKTOP:400}}),b.methods({initialize:function(a,b){this.parent(a,b),this.addEvent("resizeEnd",this._onResizeEnd),this.resources.W.Commands.registerCommandListenerByName("WPreviewCommands.WEditModeChanged",this,this._onEditorModeChanged),this._resizableSides=[Constants.BaseComponent.ResizeSides.RIGHT,Constants.BaseComponent.ResizeSides.LEFT],this.resources.W.Utils.hash.addEvent("change",function(){this.callRenderLater(500)}.bind(this)),this._iframeOldHeight=0,this._isMobileView=!1,this.resources.W.Config.env.getCurrentFrameDevice()===Constants.ViewerTypesParams.TYPES.MOBILE&&(this._isMobileView=!0,this.setState("mobileView","displayDevice"),this._resizableSides=[])},render:function(){this._createClickOverlay(),this._renderComponent()},isDomDisplayReadyOnReady:function(){return!1},_onEditorModeChanged:function(a,b){("PREVIEW"===a||"PREVIEW"===b)&&this._renderComponent()},_onResizeEnd:function(){this._skinParts&&(this.setComponentProperty("width",this.getWidth()),this._renderComponent())},_renderComponent:function(){this.resources.W.Config.env.$isPublicViewerFrame||!Browser.ie?this._renderComponentOnViewer():this._renderComponentOnEditor()},_renderComponentOnEditor:function(){var a=this.getComponentProperty("colorScheme");this.setState(a,"editor")},_renderComponentOnViewer:function(){var a=this.getState("viewer");return a?"loading"==a||"scriptLoading"==a?(this.callRenderLater(),!1):(this.getComponentProperty("canBeShownOnAllPagesBug")?null!==this.resources.W.Viewer.getCurrentPageId()&&(this.setState("loading","viewer"),this._rebuildFacebookComponent()):(this.setState("loading","viewer"),this._rebuildFacebookComponent()),void 0):(this.setState("scriptLoading","viewer"),this._loadScript(function(){this.setState("scriptLoaded","viewer")}.bind(this)),this.callRenderLater(),!1)},_onScriptLoaded:function(){this.setState("scriptLoaded","viewer"),this.getComponentProperty("canBeShownOnAllPagesBug")?null!=this.resources.W.Viewer.getCurrentPageId()&&(this.setState("loading","viewer"),this._rebuildFacebookComponent()):(this.setState("loading","viewer"),this._rebuildFacebookComponent())},_rebuildFacebookComponent:function(){var a=this.getComponentProperty("width");this._isMobileView&&(a=this.WIDTH.MOBILE);var b=this._getFacebookHref();this._skinParts.facebook.empty();var c={"class":"fb-comments","data-href":b,"data-num-posts":this.getComponentProperty("numPosts"),"data-width":a,"data-colorscheme":this.getComponentProperty("colorScheme"),mobile:!1};this._fbCommentElement=new Element("DIV",c),this._fbCommentElement.insertInto(this._skinParts.facebook),window.FB&&FB.XFBML&&FB.XFBML.parse&&FB.XFBML.parse(this._skinParts.facebook),"template"===this.resources.W.Config.getDocumentType().toLowerCase()&&this.resources.W.Config.env.$isPublicViewerFrame?this.setState("disabled","viewer"):this.setState("idle","viewer"),this._view.fireEvent(Constants.ComponentEvents.DOM_DISPLAY_READY)},appendPageHash:function(a){var b=this.resources.W.Utils.hash.getHashParts(window.location.hash),c=b.extData||"";return""===c?a:(this.resources.W.Utils.strEndsWith(a,"#!"+c)||(a+=this.resources.W.Utils.strEndsWith(a,"/#")?"!"+c:this.resources.W.Utils.strEndsWith(a,"/")?"#!"+c:"/#!"+c),a)},_getFacebookHref:function(){var a;return this.resources.W.Config.env.$isPublicViewerFrame?(a=location.href,this.resources.W.Viewer.isHomePage()&&(a=this.appendPageHash(a))):a=this.resources.W.Config.env.$isEditorViewerFrame||this.resources.W.Config.env.$isEditorFrame?this.resources.W.Config.getUserPublicUrl():"http://www.wix.com/create/website",a},_onFacebookComponentRender:function(){if(this.isReady()){var a=this._skinParts.facebook.getSize(),b=a.y;this.setHeight(b),this._wCheckForSizeChangeAndFireAutoSized(1)}},dispose:function(){this._iframeAuditor&&clearInterval(this._iframeAuditor),window.FB&&(FB.Event.unsubscribe("xfbml.render",this._onFacebookComponentRender),FB.Event.subscribe("comment.create",this._onFacebookComponentRender),FB.Event.subscribe("comment.remove",this._onFacebookComponentRender)),this.parent()},setWidth:function(a,b,c){var d;d=this._isMobileView?this.WIDTH.MOBILE:this.WIDTH.DESKTOP,a>=d?this.parent(a,b,c):this.parent(d,b,c)},_checkIframeSize:function(){if(this.isReady()){var a=this._skinParts.facebook.getElement("iframe");if(a){var b=a.getSize().y;this._iframeOldHeight!=b&&(this._iframeOldHeight=b,this._onFacebookComponentRender())}}},_loadScript:function(a){var b="236335823061286";define.getDefinition("resource","FacebookApi")||define.resource("FacebookApi").withUrls("//connect.facebook.net/en_US/all.js"),resource.getResourceValue("FacebookApi",function(){FB.Event.subscribe("xfbml.render",this._onFacebookComponentRender),FB.Event.subscribe("comment.create",this._onFacebookComponentRender),FB.Event.subscribe("comment.remove",this._onFacebookComponentRender),this._iframeAuditor=setInterval(function(){this._checkIframeSize()}.bind(this),500),FB.init({appId:b,xfbml:1}),a()}.bind(this))}})}),define.component("wysiwyg.viewer.components.WFacebookLike",function(a){var b=a;b.inherits("wysiwyg.viewer.components.SocialBaseComponent"),b.resources(["W.Utils","W.Viewer","W.Config"]),b.propertiesSchemaType("WFacebookLikeProperties"),b.skinParts({facebook:{type:"htmlElement"}}),b.fields({EDITOR_META_DATA:{general:{settings:!0,design:!1}}}),b.methods({initialize:function(a,b,c){this.resources.W.Utils.hash.addEvent("change",function(){this.callRenderLater(500)}.bind(this)),this.parent(a,b,c)},render:function(){this._layout=this.getComponentProperty("layout"),this._showFaces=this.getComponentProperty("show_faces"),this._action=this.getComponentProperty("action"),this._colorScheme=this.getComponentProperty("colorScheme"),this._send=this.getComponentProperty("send"),this.parent()},_getIframeContainer:function(){return this._skinParts.facebook},_getPageName:function(){return"fblike.html"},_getUrlParams:function(){return{href:this._getLikeUrl(),layout:this._layout,show_faces:this._showFaces,action:this._action,colorscheme:this._colorScheme,send:this._send,width:this._getSizeAccordingToProperties().x}},_getLikeUrl:function(){if(this.resources.W.Config.env.$isPublicViewerFrame){var a=window.publicModel?window.publicModel.externalBaseUrl:void 0;return a=a||location.protocol+"//"+location.host+location.pathname,this.resources.W.Viewer.isHomePage()||this._isComponentInHeaderOrFooter(this)?a:a+location.hash}return"http://www.wix.com/create/website"},_isComponentInHeaderOrFooter:function(a){return null===a?!1:"wysiwyg.viewer.components.HeaderContainer"===a.className||"wysiwyg.viewer.components.FooterContainer"===a.className?!0:this._isComponentInHeaderOrFooter(a.getParentComponent())},_getSizeAccordingToProperties:function(){var a,b;return"standard"==this._layout?(a=250,"recommend"==this._action&&(a+=40),b=this._showFaces?85:40):"button_count"==this._layout?(a=137,b=20,"recommend"==this._action&&(a+=35)):"box_count"==this._layout&&(a=85,"recommend"==this._action&&(a+=40),b=65),{w:a,h:b}}})}),define.component("wysiwyg.viewer.components.WGooglePlusOne",function(a){var b=a;b.inherits("mobile.core.components.base.BaseComponent"),b.resources(["W.Utils","W.Viewer","W.Config"]),b.binds(["_renderComponentOnViewer","_renderComponentOnEditor","_rebuildComponent","_getSizeAccordingToState","_setComponentSize"]),b.propertiesSchemaType("WGooglePlusOneProperties"),b.states({LAYOUT:["small_bubble","small_none","small_inline","medium_bubble","medium_none","medium_inline","standard_bubble","standard_none","standard_inline","tall_bubble","tall_none","tall_inline"],VIEWER:["scriptLoading","scriptLoaded","loading","idle"]}),b.fields({EDITOR_META_DATA:{general:{settings:!0,design:!1}}}),b.methods({initialize:function(a,b,c){this.parent(a,b,c),this.resources.W.Utils.hash.addEvent("change",function(){this.callRenderLater(500)}.bind(this)),this._resizableSides=[],this._props=c},render:function(){this._createClickOverlay(),this._size=this.getComponentProperty("size"),this._annotation=this.getComponentProperty("annotation"),this._renderComponent()},isDomDisplayReadyOnReady:function(){return!1},_renderComponent:function(){this.setState(this._size+"_"+this._annotation,"LAYOUT"),this.resources.W.Config.env.$isPublicViewerFrame||!Browser.ie?this._renderComponentOnViewer():this._renderComponentOnEditor()},_renderComponentOnEditor:function(){this._setComponentSize()},_renderComponentOnViewer:function(){this._view.setStyles({background:"none"});var a=this.getState("viewer");return a&&""!=a?"loading"==a||"scriptLoading"==a?(this.callRenderLater(),!1):(this.setState("loading","VIEWER"),this._rebuildComponent(function(){this.setState("idle","VIEWER")}.bind(this)),void 0):(this.setState("scriptLoading","viewer"),this._loadScript(function(){this.setState("scriptLoaded","VIEWER")}.bind(this)),this.callRenderLater(),!1)},_rebuildComponent:function(a){this._skinParts.googlePlus.empty();var b={"class":"googlePlusOne",href:location.href};b=this._props?{size:this._props.size||this._size,annotation:this._props.annotation||this._annotation,width:this._props.width||this._view.getWidth()}:{size:this._size,annotation:this._annotation,width:this._view.getWidth()},this._googlePlusOneElement=new Element("g\\:plusone",b),this._skinParts.googlePlus.adopt(this._googlePlusOneElement),window.gapi&&gapi.plusone&&gapi.plusone.go&&gapi.plusone.go(this._skinParts.googlePlus),this.callLater(this._setComponentSize,null,100),a(),this._view.fireEvent(Constants.ComponentEvents.DOM_DISPLAY_READY)},_setComponentSize:function(){var a=this._props&&this._props.width?this._props.width:this._getSizeAccordingToState();this.setHeight(a.h),this.setWidth(a.w),this._wCheckForSizeChangeAndFireAutoSized(5)},_loadScript:function(a){define.getDefinition("resource","PlusOneApi")||define.resource("PlusOneApi").withUrls("https://apis.google.com/js/plusone.js"),resource.getResourceValue("PlusOneApi",a)},_getSizeAccordingToState:function(){switch(this.getState("LAYOUT")){case"small_bubble":return{w:70,h:15};case"small_none":return{w:24,h:15};case"small_inline":return{w:250,h:15};case"medium_bubble":return{w:90,h:20};case"medium_none":return{w:32,h:20};case"medium_inline":return{w:250,h:20};case"standard_bubble":return{w:106,h:24};case"standard_none":return{w:38,h:24};case"standard_inline":return{w:250,h:24};case"tall_bubble":return{w:50,h:60};case"tall_none":return{w:50,h:20};case"tall_inline":return{w:250,h:20}}}})}),define.component("wysiwyg.viewer.components.WPhoto",function(a){var b=a;b.inherits("core.components.base.BaseComp"),b.binds(["_mediaGalleryCallback","_onClick"]),b.utilize(["core.components.image.ImageSettings","core.components.image.ImageDimensionsNew","wysiwyg.common.utils.LinkRenderer"]),b.skinParts({link:{type:"htmlElement"},img:{type:"core.components.image.ImageNew",dataRefField:"*",hookMethod:"_setImageArgs"}}),b.dataTypes(["Image"]),b.states({touch:["noTouch","hasTouch"]}),b.propertiesSchemaType("WPhotoProperties"),b.resources(["W.Utils","W.Viewer","W.Config","W.Data","W.Commands"]),b.fields({_renderTriggers:[Constants.DisplayEvents.ADDED_TO_DOM,Constants.DisplayEvents.DISPLAYED,Constants.DisplayEvents.DISPLAY_CHANGED,Constants.DisplayEvents.SKIN_CHANGE],EDITOR_META_DATA:{general:{settings:!0,design:!0},custom:[{label:"PHOTO_REPLACE_IMAGE",command:"WEditorCommands.OpenMediaFrame",commandParameter:{openCommand:"FPP",galleryConfigID:"photos",publicMediaFile:"photos",selectionType:"single",i18nPrefix:"single_image",mediaType:"picture",callback:"_mediaGalleryCallback"}},{label:"PHOTO_EDIT_IMAGE",command:"WEditorCommands.OpenAviaryDialog"},{label:"LINK_LINK_TO",command:"WEditorCommands.OpenLinkDialogCommand",commandParameter:{position:"center"},commandParameterDataRef:"SELF"}],dblClick:{command:"WEditorCommands.OpenMediaFrame",commandParameter:{openCommand:"dblClick",galleryConfigID:"photos",publicMediaFile:"photos",selectionType:"single",i18nPrefix:"single_image",mediaType:"picture",callback:"_mediaGalleryCallback"}},mobile:{previewImageDataRefField:"*"}}}),b.statics({MIN_IMAGE_HEIGHT:1,MIN_IMAGE_WIDTH:1,_autoSizeStates:{none:1,autoSizeNoLayoutUpdate:2,autoSizeUpdateLayout:3}}),b.methods({initialize:function(a,b,c){this.parent(a,b,c),this._SettingsClass=this.imports.ImageSettings,this._imageSettings=new this.imports.ImageSettings,this._imageDimensions=new this.imports.ImageDimensionsNew,c&&c.props&&this.setComponentProperties(c.props),this._contentPadding={x:0,y:0},this._rotatable=!0,this._linkRenderer=new this.imports.LinkRenderer},isRenderNeeded:function(a){return a.isInvalidated([this.INVALIDATIONS.PART_SIZE])||this.parent(a)},_onRender:function(a){var b,c=a.data.invalidations,d=this.getComponentProperties(),e=d.get("onClickBehavior")||"",f="zoomAndPanMode"===e,g=this._skinParts.img,h=Modernizr.touch?"hasTouch":"noTouch";this.PREVENT_LINK_RENDER="wysiwyg.viewer.components.WPhoto"===this.className?!0:!1,c.isInvalidated([this.INVALIDATIONS.SKIN_CHANGE,this.INVALIDATIONS.PART_SIZE])&&(this._updateFramePadding(),this._updateImageSize(this.getWidth(),this.getHeight())),c.isInvalidated([this.INVALIDATIONS.DATA_CHANGE,this.INVALIDATIONS.SKIN_CHANGE])&&(g.setZoom(f),f?g.fireEvent("resize",g.isOriginalImageSmallerThanWrapper()):g.fireEvent("resize",!1)),this._updateImageSettings(),c.isInvalidated([this.INVALIDATIONS.DATA_CHANGE])&&(this._setTitle(),this._checkResizeInFitMode(),this._skinParts.img._view.style.cursor="",b=c._invalidations.dataChange[0],b&&"link"===b.field&&b.value.link&&this.getComponentProperties().set("onClickBehavior","goToLink"),this._clickEventSelector(),this._renderLink()),this.setState(h,"touch")},_clickEventSelector:function(){var a=this.getComponentProperty("onClickBehavior");switch(this._skinParts.view.removeEvent("click",this._onClick),a){case"zoomMode":this._zoomModeSelected();break;case"goToLink":this.PREVENT_LINK_RENDER=!1;break;case"disabled":this._doNothigModeSelected()}},_doNothigModeSelected:function(){this.PREVENT_LINK_RENDER=!0,this._skinParts.img._view.style.cursor="default"},_zoomModeSelected:function(){this.PREVENT_LINK_RENDER=!0,this._skinParts.view.addEvent("click",this._onClick),this._skinParts.img._view.style.cursor="pointer"},_onClick:function(a){a.rightClick===!1&&"zoomMode"===this.getComponentProperty("onClickBehavior")&&this.resources.W.Commands.executeCommand("WViewerCommands.OpenZoom",{item:this._data,getDisplayerDivFunction:this.resources.W.Viewer.getDefaultGetZoomDisplayerFunction("Image")},this)},_renderLink:function(){if(this.PREVENT_LINK_RENDER)return this._linkRenderer.removeRenderedLinkFrom(this._skinParts.link,this),void 0;var a=this.getDataItem(),b=a._data.link;if(!b)return this._linkRenderer.removeRenderedLinkFrom(this._skinParts.link,this),void 0;var c=this.resources.W.Data.getDataByQuery(b);c&&this._linkRenderer.renderLink(this._skinParts.link,c,this)},_setImageArgs:function(a){return a.argObject={requestExactSize:!this.resources.W.Config.env.$isEditorViewerFrame},a},_preventRenderOnDataChange:function(a,b){return b&&"displayMode"!==b&&"href"!==b?!0:!1},setWidth:function(a,b){this.parent(a),this._updateImageSize(a,null),b||(this._changeCropModeInFit(!0),this._skinParts.img.setSettings(this._imageSettings),this._checkResizeInFitMode())},setHeight:function(a,b){this.parent(a),this._updateImageSize(null,a),b||(this._changeCropModeInFit(!1),this._skinParts.img.setSettings(this._imageSettings),this._checkResizeInFitMode())},_changeCropModeInFit:function(a){this.isDisplayed()&&"fitWidth"===this._getDisplayMode()&&(a?this._imageSettings.setCropMode(this._imageSettings.CropModes.FIT_WIDTH):this._imageSettings.setCropMode(this._imageSettings.CropModes.FIT_HEIGHT))},_updateImageSize:function(a,b){if(this._framePadding||this._updateFramePadding(),null!==a&&!isNaN(a)){var c=a-this._framePadding.x;this._imageSettings.setWidth(c)}if(null!==b&&!isNaN(b)){var d=b-this._framePadding.y;this._imageSettings.setHeight(d)}},_checkResizeInFitMode:function(){var a=this._framePadding;if(this._skinParts.img.getSize())if(this._imageSettings.getCropMode()===this._imageSettings.CropModes.FIT_WIDTH){var b=this._skinParts.img.getSize().y;this.setHeight(b+a.y,!0)}else if(this._imageSettings.getCropMode()===this._imageSettings.CropModes.FIT_HEIGHT){var c=this._skinParts.img.getSize().x;this.setWidth(c+a.x,!0)}},_updateImageSettings:function(){var a=this._getImageCropMode();this._imageSettings.setCropMode(a),this._skinParts.img.setSettings&&this._skinParts.img.setSettings(this._imageSettings)},_updateFramePadding:function(){var a=this.getSkin(),b={left:a.getParamValue("contentPaddingLeft"),right:a.getParamValue("contentPaddingRight"),top:a.getParamValue("contentPaddingTop"),bottom:a.getParamValue("contentPaddingBottom")},c={left:parseInt(b.left?b.left._amount:0,10),right:parseInt(b.right?b.right._amount:0,10),top:parseInt(b.top?b.top._amount:0,10),bottom:parseInt(b.bottom?b.bottom._amount:0,10)};this._framePadding={x:c.left+c.right,y:c.top+c.bottom}},_getImageCropMode:function(){var a=this.getComponentProperty("displayMode");return"fitWidthStrict"===a&&(a=this._imageSettings.CropModes.FIT_WIDTH),"fitHeightStrict"===a&&(a=this._imageSettings.CropModes.FIT_HEIGHT),a},getMinPhysicalHeight:function(){return this._getContentPaddingSize().y},_renderImage:function(){if(this._layoutInitialized){var a=this._skinParts.img;if(a&&a.getOriginalClassName){var b=this._getImageSettings();a.setSettings(b),b.getCropMode()===b.CropModes.FIT_WIDTH?this.setHeight(a.getSize().y+this._getContentPaddingSize().y,!1,!1,!0):b.getCropMode()===b.CropModes.FIT_HEIGHT&&this.setWidth(a.getSize().x+this._getContentPaddingSize().x,!1,!1,!0),this._fireAutoSize()}}},_fireAutoSize:function(){this._autoSizeState!==this._autoSizeStates.none&&(this.fireEvent("autoSized",{ignoreLayout:this._autoSizeState===this._autoSizeStates.autoSizeNoLayoutUpdate}),this.injects().Layout&&this.injects().Layout.notifyPositionChanged(this,"updateSize"),this._autoSizeState=this._autoSizeStates.none)},_styleChanged:function(){var a=this._getContentPaddingSize(!0);this.setMinH(a.y+this.MIN_IMAGE_HEIGHT),this.setMinW(a.x+this.MIN_IMAGE_WIDTH);var b=this._getPhotoInnerSize();this._getImageSettings().setSize(b.x,b.y)},_getContentPaddingSize:function(a){if(!this._contentPadding||a){this._contentPadding={};var b=this.getSkin();this._contentPadding.x=parseInt(b.getParamValue("contentPaddingLeft"),10)+parseInt(b.getParamValue("contentPaddingRight"),10),this._contentPadding.y=parseInt(b.getParamValue("contentPaddingTop"),10)+parseInt(b.getParamValue("contentPaddingBottom"),10),this._contentPadding.x=isNaN(this._contentPadding.x)?0:this._contentPadding.x,this._contentPadding.y=isNaN(this._contentPadding.y)?0:this._contentPadding.y,this.getSizeLimits().minH=this._contentPadding.y,this.getSizeLimits().minW=this._contentPadding.x}return this._contentPadding},_getImageSettings:function(){if(!this._imageSettings){var a=this._getPhotoInnerSize(),b=this._translateDisplayModeToImageCropMode(this._getDisplayMode());this._imageSettings=new this.imports.ImageSettings(b,a.x,a.y)}return this._imageSettings},_getPhotoInnerSize:function(){var a=this._getContentPaddingSize(),b=this.getWidth()-a.x,c=this.getHeight()-a.y;return{x:b,y:c}},_setTitle:function(){var a=this._data.get("title");this._skinParts.view.set("title",a)},_getDisplayMode:function(){return this.getComponentProperty("displayMode")},_getImageDisplayMode:function(){return this._getImageSettings()&&this._getImageSettings().getCropMode()},_translateDisplayModeToImageCropMode:function(a){var b=a;return"fitWidthStrict"===a&&(b=this._SettingsClass.CropModes.FIT_WIDTH),"fitHeightStrict"===a&&(b=this._SettingsClass.CropModes.FIT_HEIGHT),b},allowHeightLock:function(){return!this._isFitMode()},_isFitMode:function(){var a=["fitWidth","fitWidthStrict","fitHeightStrict"];return a.indexOf(this._getDisplayMode())>=0},_mediaGalleryCallback:function(a){this.getDataItem().setFields({title:a.title,description:a.description||"",height:a.height,width:a.width,uri:a.fileName}),this._reportLogEvent()},_reportLogEvent:function(){LOG.reportEvent(wixEvents.CHANGE_IMAGE_CLICK_SUCCESS,{c1:"Wphoto"})}})}),define.component("wysiwyg.viewer.components.WRichText",function(a){var b=a;b.inherits("mobile.core.components.base.BaseComponent"),b.utilize(["wysiwyg.common.utils.LinkRenderer","wysiwyg.viewer.components.classes.TextScalingModifier","wysiwyg.viewer.components.classes.TextBrightnessModifier"]),b.resources(["W.Data","W.Commands","W.Css","W.Config","W.Utils","W.Theme"]),b.dataTypes(["RichText","Text","StyledText"]),b.propertiesSchemaType("WRichTextProperties"),b.skinParts({richTextContainer:{type:"htmlElement",optional:!0}}),b.fields({_renderTriggers:[Constants.DisplayEvents.ADDED_TO_DOM,Constants.DisplayEvents.DISPLAYED],EDITOR_META_DATA:{general:{settings:!0,design:!1},custom:[{label:"EDIT_RICH_TEXT",command:"EditorUI.StartEditRichText"}],mobile:{isTextScalable:!0,previewTextDataField:"text",disablePropertySplit:!0}}}),b.methods({initialize:function(a,b,c){this.resources.W.Commands.registerCommandListenerByName("WPreviewCommands.WEditModeChanged",this,this._setLinksDataToElements),this.parent(a,b,c),this.setMaxH(5e3),this._linkRenderer=new this.imports.LinkRenderer,this._isMobile=this._isMobileComponent(),this._brightness=1},_isMobileComponent:function(){return this.getComponentUniqueId().contains(Constants.ViewerTypesParams.DOM_ID_PREFIX.MOBILE)},setIsPropertiesSavedInServer:function(){var a=this._properties.get("id").contains(Constants.ViewerTypesParams.DOM_ID_PREFIX.MOBILE);this._properties.setMeta("isPersistent",a)},_onAllSkinPartsReady:function(){this._prepareMobileModifiers(),this._updateText(),this.resources.W.Config.env.$isPublicViewerFrame&&this._setLinksDataToElements("VIEW")},_prepareMobileModifiers:function(){var a=this.getRichTextContainer();this._isMobile&&(this._scalingModifier=new this.imports.TextScalingModifier(this._$scale,a),this._brightnessModifier=new this.imports.TextBrightnessModifier(this._brightness,a))},_onDataChange:function(a,b,c,d){this._skinParts&&(a===this._data?this._updateText():this._shouldApplyBrightness(a,b)&&this.setBrightness(c[b]),this.parent(a,b,c,d))},_shouldApplyBrightness:function(a,b){return this._isMobile&&a===this._properties&&"brightness"===b},_updateText:function(){this._loadFontsToViewer();var a=this.getDataItem().get("text");this.getRichTextContainer().set("html",a),this._shouldUpdateLinksData()&&this._setLinksDataToElements("VIEW"),this._isMobile&&this._setMobileComponentAppearance()},_setMobileComponentAppearance:function(){var a=this._properties&&this._properties.get("brightness")||this._brightness;this._brightnessModifier.emptyCache(),this.setBrightness(a),this._scalingModifier.updateDomAccordingToNewValue()},_shouldUpdateLinksData:function(){return W.Config.env.isInInteractiveViewer()},_setLinksDataToElements:function(a){if(this._skinParts&&("PREVIEW"===a||"VIEW"===a))for(var b=$(this.getRichTextContainer()).getElements("a"),c=0;c<b.length;c++){var d=b[c],e=d.getAttribute("dataquery");e?this._setLinkAttributes(e,d):!this.resources.W.Config.env.$isEditorViewerFrame||d.getAttribute("target")&&"_blank"==d.getAttribute("target")||d.setAttribute("target","_blank")}},_setLinkAttributes:function(a,b){var c=this.resources.W.Data.getDataByQuery(a);c&&(this._linkRenderer.renderLink(b,c,this),"PageLink"!==c.getType()&&this._sanitizeLink(b))},getRichTextContainer:function(){return this._skinParts?this._skinParts.richTextContainer||this.getViewNode():null},_loadFontsToViewer:function(){var a=this._getUsedFontsInComp();Object.forEach(a,function(a,b){this.resources.W.Css.loadFont(b)},this)},_getUsedFontsInComp:function(){var a=this.getDataItem().get("text"),b=new Element("div");b.innerHTML=a;var c=b.getElements("span[style]"),d=b.getElements("font[face]"),e={};return c.forEach(function(a){var b=a.style["font-family"]||a.style.fontFamily;if(b)for(var c=this._cleanUpFontName(b).split(","),d=0;d<c.length;d++)e[c[d]]=!0},this),d.forEach(function(a){var b=a.getAttribute("face");b=this._cleanUpFontName(b),e[b]=!0},this),e},_cleanUpFontName:function(a){return a.replace(/['"]/gi,"")},setScale:function(a,b){var c=this._$scale,d=c>a;this._$scale=parseFloat(a),this._isMobile&&(this._scalingModifier.setScale(this._$scale),this._scalingModifier.updateDomAccordingToNewValue(),!b&&d&&this._updateComponentHeightAccordingToTextEffectiveHeight()),this.fireEvent("autoSized",{wasScaleChanged:!0})},_updateComponentHeightAccordingToTextEffectiveHeight:function(){var a=this._scalingModifier.getEffectiveTextHeight(this);this.setHeight(a)},setBrightness:function(a){this._brightness=parseFloat(a),this._brightnessModifier.setBrightness(this._brightness),this._brightnessModifier.updateDomAccordingToNewValue()},getBrightness:function(){return this._brightness},dispose:function(){this._data&&(this._data.componentsWithInterest=_.filter(this._data.componentsWithInterest,function(a){return"wysiwyg.editor.components.panels.WRichTextPanel"!=a.$className})),this.parent()},setLoading:function(a){a?this.getViewNode().addClass("textPreloader"):this.getViewNode().removeClass("textPreloader")}})}),define.component("wysiwyg.viewer.components.WSiteStructure",function(a){var b=a;b.inherits("core.components.ContainerOBC"),b.binds(["_onThemePropertyChange","_updateSiteBgPosition","_updateSiteBgSize","_validateBg","_delayedInvalidateBg","_invalidateBg","_setBgAsImageViewMode"]),b.resources(["W.Utils","W.Viewer","W.Theme","W.Components","W.Data","W.Config","W.Commands"]),b.statics({MAX_SITE_HEIGHT:1e5}),b.methods({initialize:function(a,b,c){this.parent(a,b,c),this._structureState=this.resources.W.Config.env.$viewingDevice,this._mobileConfig=this.resources.W.Config.mobileConfig,this._bgStyles={},this._lastBgStyle={},this._addBgEvents(),this._handleMobileAndTablet(),this._handlePreviewAttribute(),this.setMaxH(this.MAX_SITE_HEIGHT),this._updateBottomPadding(this.resources.W.Config.env.$editorMode),this.resources.W.Config.env.$isEditorViewerFrame&&this._structureState===Constants.ViewerTypesParams.TYPES.MOBILE&&this.resources.W.Commands.registerCommandListenerByName("WPreviewCommands.WEditModeChanged",this,this._updateBottomPadding)},_updateBottomPadding:function(a){var b=this._getBottomPadding(a);this._view.setStyle("padding-bottom",b)},_getBottomPadding:function(a){return this.resources.W.Config.env.$isPublicViewerFrame?0:this._structureState===Constants.ViewerTypesParams.TYPES.DESKTOP?100:this.resources.W.Config.env.$isEditorViewerFrame&&this._structureState===Constants.ViewerTypesParams.TYPES.MOBILE?"PREVIEW"===a?0:100:void 0},_addBgEvents:function(){window.addEvent("scroll",this._delayedInvalidateBg),window.addEvent("resize",this._delayedInvalidateBg),this.resources.W.Theme.addEvent("propertyChange",this._onThemePropertyChange)
},_handlePreviewAttribute:function(){(this.resources.W.Config.env.$isPublicViewerFrame||this.resources.W.Config.env.isInEditorlessPreview())&&document.body.setAttribute("preview","public")},_handleMobileAndTablet:function(){this._mobileConfig.isMobileOrTablet()?(window.addEvent("orientationchange",this._delayedInvalidateBg),document.body.setAttribute("device","mobile"),this._mobileConfig.isAndroidMobileDevice()&&this._view.setStyle("max-height","10000000000px"),this._view.setStyle("-webkit-text-size-adjust","none"),this._view.setStyle("-moz-text-size-adjust","none"),this._view.setStyle("-ms-text-size-adjust","none")):(this.resources.W.Config.env.$isPublicViewerFrame||this.resources.W.Config.env.isInEditorlessPreview())&&document.body.setAttribute("device","desktop")},_onAllSkinPartsReady:function(){var a=this.resources.W.Viewer.getDocWidth();this.setWidth(a),this._structureState===Constants.ViewerTypesParams.TYPES.MOBILE?(this._bgPropertyName="mobileBg",this._createMobileBgNode()):(this._bgPropertyName="siteBg",this._createDesktopBgNode()),this._updateBgProperty(),this._validateBg()},_createDesktopBgNode:function(){var a=this.resources.W.Config.mobileConfig.isMobile()?this.resources.W.Viewer.getDocWidth()+"px":"100%";this._bgNode=new Element("div",{id:"bgNode"}),this._bgNode.setStyles({position:"absolute",width:a}),document.body.insertBefore(this._bgNode,document.body.firstChild)},_createMobileBgNode:function(){this._bgNode=document.getElementById("mobile_bgNode");var a=!this._bgNode;if(this._bgNode=this._bgNode||new Element("div",{id:"mobile_bgNode"}),a){var b=this._view.getStyle("width");this._bgNode.setStyles({width:b,left:"50%","margin-left":"-160px"})}else this._bgNode.setStyles({display:"block"});document.body.insertBefore(this._bgNode,document.body.firstChild)},setMinHeightFromMenu:function(a){W.Layout.getComponentMinResizeHeight(this)<a&&(this.setHeight(a),this.resources.W.Viewer.siteHeightChanged(!0))},resetMinHeightFromMenu:function(){this.setHeight(W.Layout.getComponentMinResizeHeight(this)),this.resources.W.Viewer.siteHeightChanged(!0)},getSiteStructureHeightWithMenu:function(){return Math.max(W.Layout.getComponentMinResizeHeight(this),this._$height)},render:function(){var a=this.resources.W.Viewer.getDocWidth();this.setWidth(a),this.parent()},dispose:function(){this.parent(),this.resources.W.Config.env.$isEditorViewerFrame&&this._structureState===Constants.ViewerTypesParams.TYPES.MOBILE&&this.resources.W.Commands.unregisterListener(this._updateBottomPadding)},collapse:function(){this._bgNode.setStyle("display","none"),this.parent()},uncollapse:function(){this._bgNode.setStyle("display","block"),this.parent()},_getReformattedBgColor:function(){return this.parent()},_onThemePropertyChange:function(a){a&&"propertyChange"==a.type&&a.name!=this._bgPropertyName||(this._updateBgProperty(),this._invalidateBg())},_updateBgProperty:function(){this._siteBgDef=this.resources.W.Theme.getProperty(this._bgPropertyName),this._bgFixed="fixed"==this._siteBgDef.getAttachment(),this._structureState===Constants.ViewerTypesParams.TYPES.MOBILE&&(this._bgFixed=!1),this._bgStyles["background-image"]=this._siteBgDef.getUrl(),this._bgStyles["background-size"]=this._siteBgDef.getCssSizeValue(),this._bgStyles["background-position"]=this._siteBgDef.getPosition(),this._bgStyles["background-repeat"]=this._siteBgDef.getRepeatUnified(),this._bgStyles["background-color"]=this._siteBgDef.getColor()},_updateSiteBgSize:function(){this._bgStyles.height=this._mobileConfig.isMobileOrTablet()?this._bgFixed?window.innerHeight:Math.max(this._siteHeight,document.getHeight())+"px":this._bgFixed?$(document.body).getSize().y+"px":Math.max(this._siteHeight||50,$(document.body).getSize().y)+"px"},_updateSiteBgPosition:function(){return this._mobileConfig.isMobileOrTablet()?(this._handleMobileBgPosition(),void 0):(Modernizr.positionfixed?this._bgStyles.position=this._bgFixed?"fixed":"absolute":this._bgStyles.top=this._bgFixed?document.body.scrollTop+"px":0,void 0)},_handleMobileBgPosition:function(){this._structureState===Constants.ViewerTypesParams.TYPES.MOBILE?this._bgStyles.position="absolute":this._bgStyles.top=this._bgFixed?document.body.scrollTop+"px":0},_delayedInvalidateBg:function(){this._delayedInvalidateBgTimeout&&clearTimeout(this._delayedInvalidateBgTimeout),this._delayedInvalidateBgTimeout=this.resources.W.Utils.callLater(this._invalidateBg,null,this,150)},_invalidateBg:function(){this._bgRenderCall||(this._bgRenderCall=this.resources.W.Utils.callOnNextRender(this._validateBg,10))},_validateBg:function(){delete this._bgRenderCall,this._updateSiteBgSize(),this._updateSiteBgPosition(),this._isBgStyleChanged()&&(this._lastBgStyle=Object.clone(this._bgStyles),this._bgNode.setStyles(this._bgStyles),Modernizr.backgroundsize||("none"===this._bgStyles["background-image"]||"contain"!==this._bgStyles["background-size"]&&"cover"!==this._bgStyles["background-size"]?this._bgAsImage&&this._bgAsImage.collapse():(this._bgNode.setStyle("background-image","none"),this._setBgAsImage(this._bgNode))),this._adjustBackgroundSizeToPadding())},_adjustBackgroundSizeToPadding:function(){if(this._bgNode&&!this.resources.W.Config.env.$isPublicViewerFrame&&this._view){var a=parseInt(this._bgStyles.height),b=parseInt(this._view.getStyle("padding-bottom"));a&&(this._structureState===Constants.ViewerTypesParams.TYPES.DESKTOP?this._bgNode.setStyle("height",a+b+"px"):this.resources.W.Config.env.$isEditorViewerFrame&&this._structureState===Constants.ViewerTypesParams.TYPES.MOBILE&&(W.Config.env.$isEditorViewerFrame||this._bgNode.setStyle("height",a+b+"px")))}},_setBgAsImage:function(){this._bgAsImage?(this._setBgAsImageDataItemValues(this._siteBgDef.getImageId(),this._siteBgDef.getImageSize()),this._setBgAsImageViewMode(this._bgAsImage.getLogic())):(this._bgAsImageDataItem=this.resources.W.Data.createDataItem({type:"Image",uri:this._siteBgDef.getImageId(),width:this._siteBgDef.getImageSize()[0],height:this._siteBgDef.getImageSize()[1],borderSize:0,title:"",description:"",alt:""}),this._bgAsImage=this.resources.W.Components.createComponent("core.components.Image","mobile.core.skins.ImageSkin",this._bgAsImageDataItem,{width:"100",height:"100",unit:"%"},null,this._setBgAsImageViewMode),this._bgAsImage.insertInto(this._bgNode))},_setBgAsImageDataItemValues:function(a,b){this._bgAsImageDataItem&&this._bgAsImageDataItem.setFields({uri:a,width:b[0],height:b[1]})},_setBgAsImageViewMode:function(a){var b="contain"===this._bgStyles["background-size"]?"full":"fill",c=this._bgStyles["background-position"].split(" ");a.setCropMode(b),a.setAlign(c[0],c[1]),a.uncollapse()},_isBgStyleChanged:function(){for(var a in this._bgStyles)if(this._bgStyles[a]!=this._lastBgStyle[a])return!0;return!1},setHeight:function(a){this._siteHeight!=a&&(this._siteHeight=a,this._delayedInvalidateBg(),this.parent(a),this.resources.W.Viewer.siteHeightChanged(!0))},_getBestFit:function(a,b){return this.parent(a,b)},_getWantedBgSize:function(){return this.parent()},getChildComponents:function(){return this.getViewNode().getChildren("[comp]")},isAnchorable:function(){return{to:{allow:!0,lock:Constants.BaseComponent.AnchorLock.ALWAYS,distance:0},from:{allow:!1,lock:Constants.BaseComponent.AnchorLock.NEVER}}},layoutMinHeight:function(){return 0}})}),define.component("wysiwyg.viewer.components.WTwitterFollow",function(a){var b=a;b.inherits("wysiwyg.viewer.components.SocialBaseComponent"),b.skinParts({twitter:{type:"htmlElement"}}),b.dataTypes(["TwitterFollow"]),b.propertiesSchemaType("WTwitterFollowProperties"),b.fields({EDITOR_META_DATA:{general:{settings:!0,design:!1}}}),b.methods({render:function(){this._screenName=this._getScreenName(),this._showCount=this.getComponentProperty("showCount"),this._showScreenName=this.getComponentProperty("showScreenName"),this.parent()},_getScreenName:function(){var a,b=this.getDataItem();return a=b?b.get("accountToFollow"):"",a.replace("@","")},_getIframeContainer:function(){return this._skinParts.twitter},_getPageName:function(){return"twfollow.html"},_getUrlParams:function(){var a=this._screenName||this._getScreenName();return{screen_name:a,href:"https://twitter.com/"+a,show_count:this._showCount,show_screen_name:this._showScreenName,lang:this.getComponentProperty("dataLang"),align:"left"}},_getSizeAccordingToProperties:function(){var a=80,b=20;return this._showCount&&(a+=85),this._showScreenName&&(a+=6*this._screenName.length),{w:a,h:b}}})}),define.component("wysiwyg.viewer.components.WTwitterTweet",function(a){var b=a;b.inherits("wysiwyg.viewer.components.SocialBaseComponent"),b.resources(["W.Utils","W.Viewer"]),b.skinParts({twitter:{type:"htmlElement"}}),b.dataTypes(["TwitterTweet"]),b.propertiesSchemaType("WTwitterTweetProperties"),b.fields({EDITOR_META_DATA:{general:{settings:!0,design:!1}},SIZES:{DESKTOP:{NONE:{WIDTH:60,HEIGHT:20},HORIZONTAL:{WIDTH:100,HEIGHT:20},VERTICAL:{WIDTH:60,HEIGHT:62}},MOBILE:{NONE:{WIDTH:80,HEIGHT:30},HORIZONTAL:{WIDTH:110,HEIGHT:30},VERTICAL:{WIDTH:85,HEIGHT:32}}}}),b.methods({initialize:function(a,b,c){this.resources.W.Utils.hash.addEvent("change",function(){this.callRenderLater(500)}.bind(this)),this.parent(a,b,c),this._isMobileView=this.resources.W.Config.env.getCurrentFrameDevice()===Constants.ViewerTypesParams.TYPES.MOBILE},_getIframeContainer:function(){return this._skinParts.twitter},_getPageName:function(){return"twtweet.html"},_getUrlParams:function(){var a={href:"https://twitter.com/share",count:this.getComponentProperty("dataCount"),lang:this.getComponentProperty("dataLang"),url:location.href,text:this._data.get("defaultText"),related:this._data.get("accountToFollow"),counturl:location.href};return this._isMobileView&&(a.size="l"),a},_getSizeAccordingToProperties:function(){var a=this.getComponentProperty("dataCount").toUpperCase(),b=this._isMobileView?"MOBILE":"DESKTOP",c=this.SIZES[b],d=c[a].WIDTH,e=c[a].HEIGHT;return{w:d,h:e}}})}),define.component("wysiwyg.viewer.components.WixAds",function(a){var b=a;b.inherits("mobile.core.components.base.BaseComponent"),b.skinParts({footerLabel:{type:"htmlElement",optional:!1},topRectLabel:{type:"htmlElement",optional:!1},topRectContent:{type:"htmlElement",optional:!1}}),b.binds(["_getAdHeight","_onViewerModeChange","_onSiteReady","_handleMobileRotation","_onComponentDisposed"]),b.fields({_renderTriggers:[Constants.DisplayEvents.ADDED_TO_DOM,Constants.DisplayEvents.DISPLAYED,Constants.DisplayEvents.DISPLAY_CHANGED]}),b.states({viewerState:["desktop","mobile"],orientation:["portrait","landscape"]}),b.resources(["W.Config","W.Viewer","W.Commands","W.Theme"]),b.methods({initialize:function(a,b,c){this.parent(a,b,c);var d=this.injects().Commands;d.registerCommandListenerByName("WPreviewCommands.WEditModeChanged",this,this._onModeChange),d.registerCommandListenerByName("WViewerCommands.OpenZoom",this,function(){this._handleMediaZoom(!0)}),d.registerCommandListenerByName("WViewerCommands.MediaZoom.Close",this,function(){this._handleMediaZoom(!1)}),d.registerCommandListenerByName("WViewerCommands.MobileMediaZoom.Closed",this,function(){this._handleMediaZoom(!1)}),this.resources.W.Config.env.$isPublicViewerFrame||this.injects().Viewer.addHeightChangeCallback(this._getAdHeight),d.registerCommandAndListener("WPreviewCommands.ViewerStateChanged",this,this._onViewerModeChange),this.resources.W.Viewer._activeViewer_.addEvent("SiteReady",this._onSiteReady),window.addEvent("orientationchange",this._handleMobileRotation),this.addEvent(Constants.ComponentEvents.DISPOSED,this._onComponentDisposed)},_onAllSkinPartsReady:function(){this._showHideAds(this._shouldDisplay()),this._view.addClass("Z-WIX-ADS"),this._skinParts.view.addEvent("click",function(){var a=this._getLinkUrl(),b=this._getLinkTarget();a&&window.open(a,b)}.bind(this)),this.resources.W.Config.env.$isEditorViewerFrame&&this._addBiEvent()},_onComponentDisposed:function(){this.resources.W.Viewer._activeViewer_.removeEvent("SiteReady",this._onSiteReady)},_onViewerModeChange:function(){this.setCollapsed(!0),this._shouldShowAds(null,null)&&(this.resources.W.Viewer._activeViewer_.isSiteReady()?this._onSiteReady(W.Config.env.$viewingDevice):this.resources.W.Viewer._activeViewer_.addEvent("SiteReady",this._onSiteReady))},_onSiteReady:function(){this.resources.W.Viewer._activeViewer_.removeEvent("SiteReady",this._onSiteReady),this.validateDisplayState(),this.$view.fireEvent("ready",this)},_getLinkUrl:function(){var a="";if(!this.resources.W.Config.env.$isEditorlessPreview&&!this.resources.W.Config.env.$isPublicViewerFrame)return a;var b=this.resources.W.Viewer.getAdData();this.resources.W.Config.env.$viewingDevice===Constants.ViewerTypesParams.TYPES.MOBILE?b[Constants.ViewerTypesParams.TYPES.MOBILE]&&(b=b[Constants.ViewerTypesParams.TYPES.MOBILE]):b[Constants.ViewerTypesParams.TYPES.DESKTOP]&&(b=b[Constants.ViewerTypesParams.TYPES.DESKTOP]);var c=this.resources.W.Config.env.$isPublicViewerFrame;return a=c?b.adUrl.replace("[site_id]",window.siteId):b.adUrl},_getLinkTarget:function(){var a="";if("preview"!==W.Config.env.$frameName){var b=this.resources.W.Config.env.$isPublicViewerFrame,c=!b||this._isFacebook();a=c?"_blank":"_self"}return a},_addBiEvent:function(){this._addBiEventsToSkinPart(this._skinParts.topRectLabel,{c1:"top-right"}),this._addBiEventsToSkinPart(this._skinParts.topRectContent,{c1:"top-right"}),this._addBiEventsToSkinPart(this._skinParts.footerLabel,{c1:"footer"})},_addBiEventsToSkinPart:function(a,b){var c=this.resources.W.Config.env.$isEditorlessPreview?wixEvents.FEEDBACK_USER_CLICKED_WIX_ADS:wixEvents.WIXADS_CLICKED_IN_PREVIEW;a.on(Constants.CoreEvents.CLICK,this,function(){LOG.reportEvent(c,b)})},validateDisplayState:function(){var a,b=W.Config.env.$viewingDevice;b===Constants.ViewerTypesParams.TYPES.MOBILE?(this._view.parentNode.getElementById("mobile_SITE_STRUCTURE"),a=this.resources.W.Viewer.getSiteNode(),a.setStyle("margin-top",this._shouldDisplay()&&"PREVIEW"===W.Config.env.$editorMode?"30px":"0px"),this.setState("mobile","viewerState")):(a=this.resources.W.Viewer.getSiteNode(),a.setStyle("margin-top","0px"),this.setState("desktop","viewerState")),this._skinParts&&this.setAdData()},render:function(){this.validateDisplayState()},setAdData:function(){var a=this._shouldDisplay();if(a){var b=this.resources.W.Viewer.getAdData();this.setState(this.resources.W.Config.mobileConfig.isPortrait()?"portrait":"landscape","orientation"),this.resources.W.Config.env.$viewingDevice===Constants.ViewerTypesParams.TYPES.MOBILE?(this._removeHeaderAd(),"PREVIEW"===this.resources.W.Config.env.$editorMode?this._setFooterAd(b[Constants.ViewerTypesParams.TYPES.MOBILE]):this._removeFooterAd()):(this._setHeaderAd(b[Constants.ViewerTypesParams.TYPES.DESKTOP]),this._setFooterAd(b[Constants.ViewerTypesParams.TYPES.DESKTOP]))}this._showHideAds(a),this._fixMobileBGPosition()},_setHeaderAd:function(a){this._skinParts.topRectLabel.set("html",a.topLabel),this._skinParts.topRectContent.set("html",a.topContent),this._skinParts.topRectLabel.uncollapse(),this._skinParts.topRectContent.uncollapse()},_setFooterAd:function(a){var b="",c=W.Config.env.$viewingDevice;c===Constants.ViewerTypesParams.TYPES.MOBILE?(a=a||{footerLabel:"en",adUrl:"http://www.wix.com"},b=a&&a.footerLabel?this._generateMobileAdHTML(a.footerLabel):this._generateMobileAdHTML("7c3dbd_67131d7bd570478689be752141d4e28a.jpg")):b=a.footerLabel,this._skinParts.footerLabel.set("html",b),this._skinParts.footerLabel.uncollapse()},_fixMobileBGPosition:function(){var a;a=document.getElementById("mobile_bgNode"),a?a.setStyle("top",this._shouldDisplay()?"30px":"0px"):(a=document.getElementById("bgNodes"),a&&a.setStyle("top",this._shouldDisplay()?"0px":"-30px"))},_removeHeaderAd:function(){this._skinParts.topRectLabel.collapse(),this._skinParts.topRectContent.collapse()},_removeFooterAd:function(){this._skinParts.footerLabel.collapse()},_generateMobileAdHTML:function(a){var b=W.Config.getMediaStaticUrl(),c=this._getLinkUrl(),d=this._getLinkTarget(),e="<div id='footerLabel'><div id='adContainer'>";return c&&d&&(e+="<a id='adLink' href='"+c+"' target='"+d+"'>"),e+="<img id='adImg' src='"+b+a+"' />",c&&d&&(e+="</a>"),e+="</div></div>"},_onModeChange:function(){this.validateDisplayState()},_handleMediaZoom:function(a){this._isMediaZoomOpen=a,this._showHideAds(this._shouldDisplay())},_handleMobileRotation:function(){this._showHideAds(!this._isPremium()&&!this._isMediaZoomOpen&&this.resources.W.Config.mobileConfig.isPortrait()),this.validateDisplayState(),this._fixMobileBGPosition()},_showHideAds:function(a){if(this._view){var b=this._view.isCollapsed();b===a&&(this.setCollapsed(!a),this.resources.W.Viewer.isSiteReady()&&this.resources.W.Viewer.siteHeightChanged(!1))}},_shouldDisplay:function(){if("PREVIEW"!==this.resources.W.Config.env.$editorMode.toUpperCase())return!1;if(this._isPremium())return!1;if(this._isMediaZoomOpen)return!1;if(this.resources.W.Config.env.$viewingDevice.toUpperCase()===Constants.ViewerTypesParams.TYPES.MOBILE){var a=!this.resources.W.Config.env.$isEditorViewerFrame&&!this.resources.W.Config.mobileConfig.isPortrait();if(a)return!1}return!0},_shouldShowAds:function(){return"PREVIEW"===W.Config.env.$editorMode&&!this._isPremium()},_isInPreviewMode:function(a){return a.toLowerCase()===Constants.ViewManager.VIEW_MODE_PREVIEW.toLowerCase()},_isPremium:function(){var a=this.resources.W.Config.getPremiumFeatures();return a&&0!==a.length?this._isFacebook()?a.contains("NoAdsInSocialSites"):a.contains("AdsFree")||a.contains("ShowWixWhileLoading"):!1},_isFacebook:function(){var a=this.resources.W.Config.getApplicationType();return"HtmlFacebook"===a},_getAdHeight:function(){return this._view.isCollapsed()?0:this._skinParts.footerLabel.getHeight()},_getAdTopHeight:function(){return this._view.isCollapsed()?0:this._skinParts.topRect.getHeight()},getAdHeight:function(){return{footer:this._getAdHeight(),top:this._getAdTopHeight()}}})}),define.Class("wysiwyg.viewer.components.classes.SoundUtils",function(a){var b=a;b.statics({SOUND_API_RESOURCE_NAME:"comp.soundManagerApi"}),b.resources(["W.Config","topology"]),b.methods({setupSoundManagerFailure:function(a){LOG.reportError("Failed to load SoundManager2 API: "+a.toString(),"wysiwyg.viewer.components.classes.SoundUtils")},isSoundApiDefined:function(){return!!window.soundManagerDeferred},isSoundApiReady:function(){return window.soundManagerDeferred&&window.soundManagerDeferred.isFulfilled()},waitForApiReady:function(){return window.soundManagerDeferred.promise},getSoundApiResource:function(){var a=Q.defer();return window.soundManager&&a.resolve(window.soundManager),resource.getResourceValue(this.SOUND_API_RESOURCE_NAME,function(){a.resolve()},function(b){a.reject(b)}),a.promise},loadApi:function(){var a,b;this.isSoundApiDefined()||(window.soundManagerDeferred=Q.defer(),a=this._getSoundApiFileName(),b=this._getSoundApiFolder(),define.resource(this.SOUND_API_RESOURCE_NAME).withUrls(a).withTrials(3).withTimeBetween(3e3),this.getSoundApiResource().then(function(){return this.setupSoundManager(b)}.bind(this),this.setupSoundManagerFailure).then(function(){window.soundManagerDeferred.resolve(window.soundManager)}).done())},setupSoundManager:function(a){var b=Q.defer(),c={url:a,flashVersion:9,useHTML5Audio:!0,html5PollingInterval:100,onready:function(){b.resolve()},ontimeout:function(){this.setupSoundManagerFailure("Setup sound manager timed out"),b.reject()}.bind(this)};return this._forceHTML5Audio()&&(c.useHTML5Audio=!0,c.preferFlash=!1),window.soundManager.setup(c),window.soundManager.beginDelayedInit(),b.promise},_forceHTML5Audio:function(){var a="safari"===Browser.name,b=swfobject.hasFlashPlayerVersion("9.0.0.0"),c=navigator.platform.match(/(Mac|iPhone|iPod|iPad)/i)?!0:!1;return c&&a&&b},_getSoundApiFileName:function(){return this._getSoundApiFolder()+"soundmanager2.js"},_removeProtocol:function(a){var b=a;if(void 0!==a)return 0===b.indexOf("http://")&&(b=b.substr(5)),0===b.indexOf("https://")&&(b=b.substr(6)),b},getAudioFullUrl:function(a){var b;return 0===a.indexOf("http://")?a:(b=this.resources.W.Config.getServiceTopologyProperty("staticAudioUrl"),"/"!==b[b.length-1]&&(b+="/"),b+=a)},_getSoundApiFolder:function(){var a=this._removeProtocol(this.resources.topology.wysiwyg);return"/"!==a[a.length-1]&&(a+="/"),a+="resources/wysiwyg/media/soundmanager2new/"}})}),define.Class("wysiwyg.viewer.components.classes.TextBrightnessModifier",function(a){var b=a;b.inherits("wysiwyg.viewer.components.classes.TextModifierBase"),b.resources(["W.Theme","W.Utils"]),b.methods({initialize:function(a,b){this.parent(a,b),this._brightness=a},_getNodeDesktopValue:function(a){return this.resources.W.Utils.mobile.getFontColor(a,W.Theme)},setBrightness:function(a){this._brightness=a},_updateNodeNewValue:function(a,b){var c,d;b&&(d=this._brightColorIfNeeded(b),c=this.resources.W.Utils.getNewColorAccordingToBrightness(d,this._brightness),a.setStyle("color",c))},_brightColorIfNeeded:function(a){return"#000000"===a.getHex()&&this._brightness>1?this.resources.W.Theme.getColorClassInstance("#121212"):a}})}),define.Class("wysiwyg.viewer.components.classes.TextModifierBase",function(a){var b=a;b.methods({initialize:function(a,b){this._parentNode=b,this._cache=[]},emptyCache:function(){this._cache=[]},updateDomAccordingToNewValue:function(){this._updateCache(),_.forEach(this._cache,function(a){this._updateNodeNewValue(a.node,a.value)},this)},_getNodeDesktopValue:function(){},_updateNodeNewValue:function(){},_updateCache:function(){_.isEmpty(this._cache)&&this._populateCache(this._parentNode)},_populateCache:function(a){if(a.children)for(var b=0;b<a.children.length;b++){var c=a.children[b];this._populateCache(c);var d=this._getNodeDesktopValue(c);d&&this._cache.push({value:d,node:c})}}})}),define.Class("wysiwyg.viewer.components.classes.TextScalingLayoutCalculator",function(a){var b=a;b.inherits("wysiwyg.common.utils.TextCalculator"),b.methods({getNodeGlobalPosition:function(a){return a.getPosition()},getSiteNode:function(){return W.Viewer.getSiteNode()},getPositionOffset:function(){return{x:0,y:0}}})}),define.Class("wysiwyg.viewer.components.classes.TextScalingModifier",function(a){var b=a;b.inherits("wysiwyg.viewer.components.classes.TextModifierBase"),b.utilize(["wysiwyg.viewer.components.classes.TextScalingLayoutCalculator"]),b.methods({initialize:function(a,b){this.parent(a,b),this._scale=a,this._mostCommonTextSize=null,this._layoutCalculator=new this.imports.TextScalingLayoutCalculator},setScale:function(a){this._scale=a},emptyCache:function(){this.parent(),this._mostCommonTextSize=null},getMostCommonTextSizeBeforeScaling:function(){return this._mostCommonTextSize||this.calculateMostCommonTextSize(),this._mostCommonTextSize},calculateMostCommonTextSize:function(){if(this._parentNode){this.emptyCache(),this._updateCache(),this._addTextLengthToElementSizeCache();var a=this._createTextSizeToElementsMap(),b=this._createTextSizeToTextLengthMap(a);this._mostCommonTextSize=this._getMaxTextSize(b)}},getEffectiveTextHeight:function(a){return this._layoutCalculator.getTextOverallBorders(a).height},_addTextLengthToElementSizeCache:function(){for(var a,b,c,d,e=this._cache.length-1;e>=0;e--){for(a=this._cache[e].node,d=a.textContent.replace(/ /g,"").length,b=e-1;b>=0&&a.getElement(c=this._cache[b].node);)d-=c.textContent.replace(/ /g,"").length,b--;this._cache[e].length=d}},_createTextSizeToElementsMap:function(){return _.groupBy(this._cache,function(a){return a.value})},_createTextSizeToTextLengthMap:function(a){var b={};return _.forEach(a,function(a,c){b[c]=this._sumElementsTextLength(a)},this),b},_sumElementsTextLength:function(a){return 1===a.length?_.first(a).length:_.reduce(a,function(a,b){return"object"===typeOf(a)&&(a=a.length),b.length+a})},_getMaxTextSize:function(a){var b,c=_.max(a);return _.forEach(a,function(a,d){return a===c?(b=d,void 0):void 0}),parseFloat(b)},_getNodeDesktopValue:function(a){return W.Utils.mobile.getFontSize(a,W.Theme)},_updateNodeNewValue:function(a,b){var c;b&&(c=Math.round(W.Utils.mobile.convertFontSizeToMobile(b,this._scale)),a.setStyle("fontSize",c))}})}),define.component("Editor.wysiwyg.viewer.components.mobile.TinyMenu",function(a){var b=a;b.fields({EDITOR_META_DATA:{general:{settings:!0,design:!1},mobile:{custom:[{label:"FPP_DESIGN_LABEL",command:"WEditorCommands.ShowMobileMenuPanel"},{label:"FPP_NAVIGATE_LABEL",command:"WEditorCommands.Pages"}],disablePropertySplit:!0}}}),b.statics({FIXED_POSITION_MAX_Y:250}),b.methods({setY:function(a){var b=this.getGlobalPosition().y,c=parseInt(a,10)+b-this.getY(),d=!1,e=this.isFixedPositioned();e&&c>this.FIXED_POSITION_MAX_Y&&(a-=c-this.FIXED_POSITION_MAX_Y,d=!0),this.parent(a),d&&this.trigger("menuOutOfView")}})}),define.component("Editor.wysiwyg.viewer.components.WRichText",function(a,b){var c=a,d=b;c.methods({_setMobileComponentAppearance:d.before(function(){this._scalingModifier.calculateMostCommonTextSize()}),getMostCommonTextSizeBeforeScaling:function(){return W.Utils.mobile.getMobileFontSize(this._scalingModifier.getMostCommonTextSizeBeforeScaling())},normalizeScaleIfNeeded:function(a){var b=this.getMostCommonTextSizeBeforeScaling(),c=Math.round(b*a);return c/b}})}),define.component("wysiwyg.viewer.components.inputs.CheckBoxInput",function(a){var b=a;b.inherits("mobile.core.components.base.BaseComponent"),b.traits(["wysiwyg.viewer.components.traits.ValidationSettings"]),b.skinParts({checkBox:{type:Constants.ComponentPartTypes.HTML_ELEMENT},label:{type:Constants.ComponentPartTypes.HTML_ELEMENT},errorMessage:{type:Constants.ComponentPartTypes.HTML_ELEMENT,optional:"true"}}),b.binds(["_setDataAndFireEvent","setSelected","setSelectedAndFireEvent"]),b.states({validation:["valid","invalid"]}),b.dataTypes(["CheckBox","Boolean"]),b.methods({initialize:function(a,b,c){this.parent(a,b,c),this.addEvent(this.VALID_STATE_CHANGED_EVENT,function(a){this.setState(a?"valid":"invalid","validation")}.bind(this)),this._label=c.label||""},_setDataAndFireEvent:function(){var a=this._skinParts.checkBox;this.getDataItem().set("value",a.get("checked")),a.get("checked")&&this.fireEvent("itemSelected",this)},_onAllSkinPartsReady:function(a){var b=a.checkBox;b.addEvent(Constants.CoreEvents.CHANGE,this._setDataAndFireEvent);var c=a.label.parentNode.id+"-check";a.label.setAttribute("for",c),a.checkBox.setAttribute("id",c),a.label.set("text",this._label)},render:function(){this.getDataItem().get("value")===!0?(this._skinParts.checkBox.setAttribute("checked","checked"),this._skinParts.checkBox.checked=!0):(this._skinParts.checkBox.removeAttribute("checked"),this._skinParts.checkBox.checked=!1),this._skinParts.checkBox.indeterminate=this.getDataItem().get("indeterminate")===!0?!0:!1},setError:function(a){this.setValidationState(!1),this._skinParts.errorMessage&&this._skinParts.errorMessage.set("text",a)},setDisabled:function(){var a=this._skinParts.checkBox;a.set("disabled","disabled")},setSelected:function(a){var b=this._skinParts.checkBox;b.set("checked",a)},setLabel:function(a){this._label=a,this._skinParts.label.set("text",a)},setSelectedAndFireEvent:function(a){this.setSelected(a),this._setDataAndFireEvent()}})}),define.component("wysiwyg.viewer.components.inputs.ColorOption",function(a){var b=a;b.skinParts({tooltip:{type:"wysiwyg.common.components.InfoTip"}}),b.inherits("wysiwyg.viewer.components.inputs.TextOption"),b.methods({_onAllSkinPartsReady:function(){this.getViewNode().setStyle("background-color",this.getDataItem().get("text")),this._initializeTooTip(this.getViewNode())}})}),define.component("wysiwyg.viewer.components.inputs.ComboBoxInput",function(a){var b=a;b.inherits("mobile.core.components.base.BaseComponent"),b.statics({PROMPT_OPTION_VALUE:-1}),b.traits(["wysiwyg.viewer.components.traits.ValidationSettings"]),b.skinParts({collection:{type:Constants.ComponentPartTypes.HTML_ELEMENT},errorMessage:{type:Constants.ComponentPartTypes.HTML_ELEMENT,optional:"true"}}),b.binds(["_selectedIndexChanged","_getPromptOptionDataItem"]),b.states({validity:["valid","invalid"]}),b.dataTypes(["SelectableList"]),b.propertiesSchemaType("ComboBoxInputProperties"),b.fields({_optionsData:[]}),b.methods({initialize:function(a,b,c){this.parent(a,b,c),this.addEvent(this.VALID_STATE_CHANGED_EVENT,function(a){this.setState(a?"valid":"invalid","validity")}.bind(this))},_preventRenderOnDataChange:function(a,b){return"selected"==b},_prepareForRender:function(){return this._createDropDownList(),!0},_onAllSkinPartsReady:function(){this._createDropDownList(),this._skinParts.collection.addEvent(Constants.CoreEvents.CHANGE,this._selectedIndexChanged)},_createDropDownList:function(){var a=function(a){this._optionsData=Object.values(a),this._bindDdlToData(this._skinParts.collection)}.bind(this),b=this.getDataItem().get("items").filter(function(a){return a.get("enabled")});b.length>0&&"string"==typeof b[0]?this.injects().Data.getDataByQueryList(b,a):a(b)},_bindDdlToData:function(a){a.empty();for(var b=0;b<this._optionsData.length;b++){var c=this._optionsData[b];a.options[b]=new Option(c.get("text"),c.get("value"))}var d=this.getDataItem().get("selected");d?this._setSelectedFromData(a,d):this.getComponentProperty("hasPrompt")&&this._addPrompt(a)},_setSelectedFromData:function(a,b){var c=this;"string"==typeof b?this.injects().Data.getDataByQuery(b,function(b){c._setSelected(a,b)}):this._setSelected(a,b)},_setSelected:function(a,b){var c=this._optionsData.indexOf(b);c>-1&&c<a.length&&(a.getSelected()[0].erase("selected"),a[c].set("selected","selected"))},_selectedIndexChanged:function(){this._hasPrompt&&this._removePrompt();var a=this._getSelectedIndex();this.setValidationState(!0),this.getDataItem().set("selected",this._optionsData[a]),this.fireEvent("selectionChanged",this._optionsData[a])},_getSelectedIndex:function(){return this._skinParts.collection.selectedIndex},setSelectedItemByIndex:function(a){var b=this._optionsData[a];this._setSelected(this._skinParts.collection,b),this._selectedIndexChanged()},setError:function(a){this.setValidationState(!1),this._skinParts.errorMessage&&this._skinParts.errorMessage.set("text",a)},_addPrompt:function(a){var b=this.getComponentProperty("promptText");a.options.add(new Option(b,this.PROMPT_OPTION_VALUE,!0,!0),0),this._optionsData.splice(0,0,this._getPromptOptionDataItem(b)),this._hasPrompt=!0},_removePrompt:function(){var a=this._skinParts.collection;a.getFirst().value==this.PROMPT_OPTION_VALUE&&(a.options.remove(0),this._optionsData.splice(0,1),this._hasPrompt=!1)},_getPromptOptionDataItem:function(a){var b={type:"SelectOption",value:this.getComponentProperty("promptValue"),text:a,enabled:!0,description:""},c=W.Data.createDataItem(b);return c.setMeta("isPersistent",!1),c}})}),define.component("wysiwyg.viewer.components.inputs.DateInput",function(a){var b=a;b.inherits("mobile.core.components.base.BaseComponent"),b.skinParts({year:{type:Constants.ComponentPartTypes.HTML_ELEMENT},month:{type:Constants.ComponentPartTypes.HTML_ELEMENT},day:{type:Constants.ComponentPartTypes.HTML_ELEMENT}}),b.binds(["_userChange"]),b.states({validation:["valid","invalid"]}),b.dataTypes(["Text"]),b.methods({initialize:function(a,b,c){this.parent(a,b,c),this.addEvent(this.VALID_STATE_CHANGED_EVENT,function(a){this.setState(a?"valid":"invalid","validation")}.bind(this))},_onAllSkinPartsReady:function(){this._skinParts.year.addEvent(Constants.CoreEvents.CHANGE,this._userChange),this._skinParts.month.addEvent(Constants.CoreEvents.CHANGE,this._userChange),this._skinParts.day.addEvent(Constants.CoreEvents.CHANGE,this._userChange);var a,b=(new Date).getUTCFullYear();for(a=1979;b+6>a;a++)this._skinParts.year.options.add(new Option(a,a));for(a=1;13>a;a++)this._skinParts.month.options.add(new Option(a,a))},render:function(){var a,b=this._data.get("text"),c=new Date(b),d=c.getUTCFullYear(),e=c.getUTCMonth(),f=c.getUTCDate();for(this._skinParts.year[d-1979].selected=!0,this._skinParts.month[e].selected=!0;this._skinParts.day.options.length;)this._skinParts.day.options.remove(this._skinParts.day.options[0]);for(a=1;a<this._getDaysForMonth(d,e)+1;a++)this._skinParts.day.options.add(new Option(a,a));
this._skinParts.day[f-1].selected=!0},_userChange:function(){var a=new Date(0);a.setUTCFullYear(this._skinParts.year.getSelected()[0].value),a.setUTCMonth(this._skinParts.month.getSelected()[0].value-1),a.setUTCDate(this._skinParts.day.getSelected()[0].value),this.getDataItem().set("text",a.toISOString()),this.fireEvent("selectionChanged",a.toISOString())},_getDaysForMonth:function(a,b){return b--,new Date(a,b,0).getDate()}})}),define.component("wysiwyg.viewer.components.inputs.RadioGroupInput",function(a){var b=a;b.inherits("wysiwyg.viewer.components.inputs.ComboBoxInput"),b.traits(["wysiwyg.viewer.components.traits.ValidationSettings"]),b.skinParts({collection:{type:Constants.ComponentPartTypes.HTML_ELEMENT},errorMessage:{type:Constants.ComponentPartTypes.HTML_ELEMENT,optional:"true"}}),b.methods({initialize:function(a,b,c){this.parent(a,b,c),this._radioGroupName=c.radioGroupName||"radioGroup",this._selectedValue=c.selectedValue},_prepareForRender:function(){return this._createRadioGroup(),!0},_onAllSkinPartsReady:function(){this._createRadioGroup(),this._skinParts.collection.addEvent(Constants.CoreEvents.CHANGE,this._selectedIndexChanged)},_createRadioGroup:function(){var a=function(a){this._optionsData=Object.values(a),this._bindRadioGroupToData(this._skinParts.collection)}.bind(this),b=this.getDataItem().get("items").filter(function(a){return a.get("enabled")});b.length>0&&"string"==typeof b[0]?this.injects().Data.getDataByQueryList(b,a):a(b)},_bindRadioGroupToData:function(a){a.empty();for(var b=0;b<this._optionsData.length;b++){var c=this._optionsData[b],d=c.get("value"),e=new Element("Input",{type:"radio",name:this._radioGroupName,value:d});d==this._selectedValue&&e.setAttribute("checked","checked"),a.grab(e,"bottom"),a.innerHTML+=c.get("text")+"<BR/>"}this._setSelected(a)},_getSelectedIndex:function(){for(var a=document.getElementsByName(this._radioGroupName),b=0;b<a.length;b++)if(a[b].checked)return b},_setSelected:function(a){var b=this.getDataItem().get("selected");b&&this.injects().Data.getDataByQuery(b,function(b){var c=this._optionsData.indexOf(b);c>-1&&c<a.length&&a[c].set("checked","checked")}.bind(this))}})}),define.component("wysiwyg.viewer.components.inputs.TextAreaInput",function(a){var b=a;b.inherits("wysiwyg.viewer.components.inputs.TextInput"),b.skinParts({textarea:{type:"htmlElement"},errorMessage:{type:"htmlElement",optional:!0}}),b.binds(["_checkMaxLength"]),b.traits(["wysiwyg.viewer.components.traits.ValidationSettings"]),b.methods({initialize:function(a,b,c){this.parent(a,b,c),c=c||{},this._maxLength=c.maxLength||""},_onAllSkinPartsReady:function(){var a=this._skinParts.textarea;a.set("value",this.getDataItem().get("text")),this.addEvent("inputChanged",function(a){this.getDataItem().set("text",a.value)}.bind(this)),this._maxLength&&(a.setProperty("maxlength",this._maxLength),Browser.ie&&a.addEvent(Constants.CoreEvents.KEY_UP,this._checkMaxLength)),this._listenToInput()},_checkMaxLength:function(){var a=this._skinParts.textarea.get("value"),b=a.length;if(a.length>this._maxLength){var c=this._maxLength-b;a=a.slice(0,c),this._skinParts.textarea.set("value",a)}},_changeEventHandler:function(a){return 13==a.code?!1:(this.parent(a),void 0)},_listenToInput:function(){this._skinParts.textarea.addEvent(Constants.CoreEvents.KEY_UP,this._changeEventHandler),this._skinParts.textarea.addEvent(Constants.CoreEvents.KEY_UP,this._fireKeyUp),this._skinParts.textarea.addEvent(Constants.CoreEvents.CUT,this._changeEventHandler),this._skinParts.textarea.addEvent(Constants.CoreEvents.PASTE,this._changeEventHandler),this._skinParts.textarea.addEvent(Constants.CoreEvents.CHANGE,this._changeEventHandler),this._skinParts.textarea.addEvent(Constants.CoreEvents.BLUR,this._fireBlur)},_stopListeningToInput:function(){this._skinParts.textarea.removeEvent(Constants.CoreEvents.KEY_UP,this._changeEventHandler),this._skinParts.textarea.removeEvent(Constants.CoreEvents.KEY_UP,this._fireKeyUp),this._skinParts.textarea.removeEvent(Constants.CoreEvents.CUT,this._changeEventHandler),this._skinParts.textarea.removeEvent(Constants.CoreEvents.PASTE,this._changeEventHandler),this._skinParts.textarea.removeEvent(Constants.CoreEvents.CHANGE,this._changeEventHandler),this._skinParts.textarea.removeEvent(Constants.CoreEvents.BLUR,this._fireBlur)},_getValue:function(){var a=this._skinParts.textarea;return a.get("value")}})}),define.component("wysiwyg.viewer.components.inputs.TextOption",function(a){var b=a;b.inherits("mobile.core.components.base.BaseComponent"),b.skinParts({size:{type:"htmlElement"},tooltip:{type:"wysiwyg.common.components.InfoTip"}}),b.traits(["wysiwyg.common.components.traits.SelectableOption"]),b.states({selectState:["selected","unselected"],enabledState:["enabled","disabled"]}),b.dataTypes(["SelectOption"]),b.methods({initialize:function(a,b,c){this.parent(a,b,c),this.setSelected(!1)},_onAllSkinPartsReady:function(){var a=this._skinParts.size;a.set("text",this.getDataItem().get("text")),this._initializeTooTip(this.getViewNode())},_initializeTooTip:function(a){var b=this._skinParts.tooltip,c=this.getDataItem().get("description");c&&c.trim().length>0&&(a.addEvent("mouseenter",function(){b._showToolTipCmd({id:1,content:c},{source:a})}),a.addEvent("mouseleave",function(){b._closeToolTipCmd()}))},_onDataChange:function(){this.setEnabled(this.getDataItem().get("enabled"))},setSelected:function(a){this.setState(a?"selected":"unselected","selectState")},setEnabled:function(a){this.setState(a?"enabled":"disabled","enabledState")}})}),define.Class("wysiwyg.viewer.components.menus.DropDownController",function(a){a.fields({_menu:null,_dropButtons:[],_dropContainer:null,_dropWrapper:null,_dropOwnerButton:null,_dropDownNeedsClosing:!1,_closeTimerID:null}),a.inherits("bootstrap.utils.Events"),a.binds(["_onItemsContainerOver","_onItemsContainerOut","closeDropDown","_onMoreContainerOver","_onMoreContainerOut"]),a.methods({initialize:function(a){this._menu=a,this._init()},_init:function(){var a=this._menu.getItemsContainer();a.addEvent("mouseover",this._onItemsContainerOver),a.addEvent("mouseout",this._onItemsContainerOut),this._dropContainer=this._menu.getMoreContainer(),this._dropWrapper=this._menu.getDropWrapper(),null==this._dropWrapper&&(this._dropWrapper=this._dropContainer),this.closeDropDown(!0),this._dropContainer.addEvent("mouseover",this._onMoreContainerOver),this._dropContainer.addEvent("mouseout",this._onMoreContainerOut)},openDropDown:function(a,b){if(a==this._dropOwnerButton)return this._dropDownNeedsClosing=!1,void 0;for(;this._dropContainer.children.length;)this._dropContainer.children[0].dispose();var c,d=[];for(c=0;c<b.length;c++)0==b[c].isHidden()&&d.push(b[c]);if(d.length>0){for(this._dropWrapper.setStyle("width","auto"),c=0;c<d.length;c++)d[c].getViewNode().inject(this._dropContainer,"bottom");this._setDropListPositions(d),this._menu.arrangeDropButtons(d),this._dropDownNeedsClosing=!1,this._releasePreviousOwner(),this._dropOwnerButton=a,this._dropButtons=d,this._dropOwnerButton.setDropdownOpen(!0),this._dropWrapper.setStyle("display","block"),this._dropWrapper.setStyle("opacity","1"),this._arrangeDropDown(),this._dropWrapper.setStyle("z-index","99999")}},_setDropListPositions:function(a){var b,c,d,e=1==a.length;for(b=0;b<a.length;b++)c=a[b],d=0===b?e?"dropLonely":"top":e||b!=a.length-1?"dropCenter":"bottom",c.getViewNode().setProperty("listposition",d),c.getViewNode().setProperty("container","drop")},closeDropDown:function(a){(a||this._dropDownNeedsClosing)&&(this._releasePreviousOwner(),this._dropWrapper.setStyle("display","none"),this._dropWrapper.setStyle("opacity","0"),this._dropDownNeedsClosing=!1)},_releasePreviousOwner:function(){this._dropOwnerButton&&(this._dropOwnerButton.setDropdownOpen(!1),this.injects().Utils.forceBrowserRepaint(this._dropOwnerButton.getViewNode()),this._dropOwnerButton=null)},_closeDropDownTimer:function(){this.injects().Utils.clearCallLater(this._closeTimerID),this._closeTimerID=this.injects().Utils.callLater(this.closeDropDown,[],this,500)},_arrangeDropDown:function(){var a=this._dropOwnerButton.getViewNode().getProperty("listPosition");this._dropWrapper.setProperty("dropHPosition",a),this._setDropDownWidth(),this._setDropDownPosition()},_setDropDownWidth:function(){var a,b,c=this._dropOwnerButton.getMinimalDropdownWidth();for(a=0;a<this._dropButtons.length;a++)b=this._dropButtons[a],c=Math.max(c,b.getMinimalWidth());var d=this._menu.getMenuExtraPixels(!0);this._dropWrapper.setStyle("width",d.left+d.right+c+"px")},_setDropDownPosition:function(){this._dropWrapper.setStyle("text-align",this._menu.getComponentProperty("alignText"));for(var a=0;a<this._dropButtons.length;a++){var b=this._dropButtons[a];b.setPadding(0),b.alignText()}this._setHorizontalPosition(),this._setVerticalPosition()},_setHorizontalPosition:function(){var a=this._dropOwnerButton.getOffsetLeft(),b=this._menu.getComponentProperty("alignButtons");this._dropWrapper.setProperty("dropAlign",b);var c="0px",d="auto",e=this._menu.getMenuExtraPixels(!0),f=this._dropOwnerButton.getViewNode().getProperty("listPosition");if("left"==b)c="left"==f?0:a+e.left+"px";else if("right"==b)d="right"==f?0:this._menu.getWidth()-a-this._dropOwnerButton.getOffsetWidth()-e.right+"px",c="auto";else{"left"==f?c=a+(this._dropOwnerButton.getOffsetWidth()+e.left-this._dropWrapper.offsetWidth)/2+"px":"right"==f?(c="auto",d=(this._dropOwnerButton.getOffsetWidth()+e.right-parseInt(this._dropWrapper.getStyle("width"),10))/2+"px"):c=e.left+a+(this._dropOwnerButton.getOffsetWidth()-this._dropWrapper.offsetWidth)/2+"px"}this._dropWrapper.setStyle("left",c),this._dropWrapper.setStyle("right",d)},_setVerticalPosition:function(){var a="dropDown";this._needsToOpenUp()?(a="dropUp",this._dropWrapper.setStyle("bottom",this._menu.getHeight()+"px")):this._dropWrapper.setStyle("bottom","auto"),this._dropWrapper.setProperty("dropMode",a)},_needsToOpenUp:function(){if(navigator.userAgent.match(/MSIE 8.0/))return!1;var a=!0,b=window.innerHeight,c=this._menu.getViewNode(),d=0;do d+=c.offsetTop,c=c.offsetParent;while(null!=c);var e=d-document.body.getScroll().y;return b/2>=e&&(a=!1),a},_onItemsContainerOver:function(a){var b=this._findLogicParent(a.target);this._isValidButtonForDropDown(b)&&b.children.length>0&&this.openDropDown(b,b.children)},_onItemsContainerOut:function(a){var b=this._findLogicParent(a.target);b&&b==this._dropOwnerButton&&(this._dropDownNeedsClosing=!0,this._closeDropDownTimer())},_onMoreContainerOver:function(){this._dropDownNeedsClosing=!1},_onMoreContainerOut:function(){this._dropDownNeedsClosing=!0,this._closeDropDownTimer()},_findLogicParent:function(a){for(var b=!1;b===!1;){var c;b=!0;try{navigator.userAgent.match(/MSIE 8.0/)?c=a.getLogic():a.hasOwnProperty("getLogic")&&a.getLogic()?c=a.getLogic():b=!1}catch(d){b=!1}b===!1?(a=a.getParent(),a||(b=!0)):a=c}return a},_isValidButtonForDropDown:function(a){return a&&"core.components.MenuButton"==a.className?!0:!1}})}),define.component("wysiwyg.viewer.components.menus.DropDownMenu",function(a){var b=a;b.inherits("core.components.BaseRepeater"),b.utilize(["core.components.BaseList","core.components.SimpleButton","wysiwyg.viewer.components.menus.DropDownController"]),b.skinParts({repeaterButton:{type:"core.components.MenuButton",repeater:!0,inlineDataField:"items",repeaterDataQueryField:"refId",container:"itemsContainer",argObject:{listSubType:"PAGES"}},moreButton:{type:"core.components.MenuButton"},itemsContainer:{type:"htmlElement"},moreContainer:{type:"htmlElement"},dropWrapper:{type:"htmlElement"}}),b.binds(["_onButtonDataChange","_onThemeChange","_arrangeButtons","_onButtonClick","_onPageChanged","_resetTestOverFlowCount"]),b.dataTypes(["Menu"]),b.propertiesSchemaType("HorizontalMenuProperties"),b.fields({_renderTriggers:[Constants.DisplayEvents.ADDED_TO_DOM,Constants.DisplayEvents.DISPLAYED,Constants.DisplayEvents.SKIN_CHANGE],EDITOR_META_DATA:{general:{settings:!0,design:!0},custom:[{label:"FPP_RENAME_PAGES_LABEL",command:"WEditorCommands.PageSettings",commandParameter:{BIsrc:"DropDownMenuFPP",parentPanel:"pagesPanel"}},{label:"FPP_NAVIGATE_LABEL",command:"WEditorCommands.Pages"}],dblClick:{command:"WEditorCommands.Pages"}},_prevButtonsWidth:0,_testOverFlowCount:50,_buttonsPadding:{}}),b.methods({initialize:function(a,b,c){this.parent(a,b,c),this.injects().Theme.addEvent("propertyChange",this._onThemeChange),this._arrangeWaitID=-1,this.injects().Viewer.addEvent("pageTransitionStarted",this._onPageChanged),this._usesExternalData=!0,this._staticWidth=0,this._aspectRatio=-1,this._preWidthModifier=this._nullModifier,this._postWidthModifier=this._nullModifier,this._hiddenButtonsContainer=new Element("div",{id:"hiddenButtonsContainer",style:"visibility:hidden"}),this._hiddenButtonsContainer.inject(this.getViewNode()),this._flatButtons=[],this._arrangeDone=!1,this._treeConstructionDone=!1,this.$view.addClass("visuallyHidden"),this._resetTestOverFlowCount()},setWidth:function(a,b,c,d){if(void 0==d&&(d=!0),d&&-1!=this._aspectRatio){var e=a/this._aspectRatio;e<this.getSizeLimits().minH&&(e=this.getSizeLimits().minH,a=e*this._aspectRatio),this.setHeight(e,!0,!1,!1)}this.parent(a,b,c)},setHeight:function(a,b,c,d){if(void 0==d&&(d=!0),d&&-1!=this._aspectRatio){var e=a*this._aspectRatio;e<this.getSizeLimits().minW&&(e=this.getSizeLimits().minW,a=e/this._aspectRatio),this.setWidth(e,!0,!1,!1)}this.parent(a,b,c)},_onAllSkinPartsReady:function(){this.parent(),this._dropDown=new this.imports.DropDownController(this),this._registerButton(this._skinParts.moreButton)},_registerButton:function(a){a.setMenu(this),a.addEvent("dataChanged",this._onButtonDataChange),a.dropdownMode=!0},getItemsContainer:function(){var a=null;return this._skinParts&&(a=this._skinParts.itemsContainer),a},getMoreContainer:function(){var a=null;return this._skinParts&&(a=this._skinParts.moreContainer),a},getDropWrapper:function(){var a=null;return this._skinParts&&(a=this._skinParts.dropWrapper),a},getMenuExtraPixels:function(){return this.getDivExtraPixels(this._skinParts.itemsContainer,!0)},arrangeDone:function(){return this._arrangeDone},_resetTestOverFlowCount:function(){this._testOverFlowCount=5},_testOverFlow:function(){var a=this._getButtonsWidth();this.injects().Utils.clearCallLater(this._overflowID),0==this._prevButtonsWidth&&(this._prevButtonsWidth=a),a!=this._prevButtonsWidth?this._arrangeButtons():this._testOverFlowCount>0&&(this._testOverFlowCount--,this._overflowID=this.callLater(this._testOverFlow,[],100))},_onPageChanged:function(a){null!=this._skinParts&&this._selectActiveButton(a)},_selectActiveButton:function(a){if(this._flatButtons)for(var b=0;b<this._flatButtons.length;b++)button=this._flatButtons[b],button.getID()==a?button.setSelected(!0):button.setSelected(!1),this.injects().Utils.forceBrowserRepaint(button.getViewNode())},_onThemeChange:function(){this._resetTestOverFlowCount(),this._changeTriggeredBy="themeChange",this._arrangeButtonsDelayed()},_beforeRepeatersCreation:function(){this._rootButtons=[],this._flatButtons=[],this._flatButtons.push(this._skinParts.moreButton)},_onRepeaterItemReady:function(a,b,c,d){d&&b.addEvent("click",function(){this._onButtonClick(c)}.bind(this)),this._rootButtons.push(b),this._flatButtons.push(b),b.getViewNode().setStyle("visibility","hidden"),this._registerButton(b),this.parent(a,b,c,d)},_onRepeaterReady:function(){this.addEvent(Constants.PropertyEvents.PROPERTY_CHANGED,function(){this._resetTestOverFlowCount(),this._arrangeButtons()}.bind(this)),this._treeConstructionDone=!1,this._arrangeButtonAccordingToData(),this._constructButtonsTree()},_constructButtonsTree:function(){var a,b,c,d,e,f=this._data.get("items"),g=this,h=[];for(a=0;a<f.length;a++){for(c=null,b=0;b<this._rootButtons.length;b++)if(this._rootButtons[b].compareRefID(f[a].get("refId"))){c=this._rootButtons[b];break}if(c)for(c.children=[],d=this._data.getSubItems(f[a]),b=0;b<d.length;b++)e=Object.clone(this._repeaterDefinitions[0]),e.dataQuery=d[b].get("refId"),h.push({owner:c,def:e})}var i=h.length;if(0==i)this._constructionDone();else for(a=0;a<h.length;a++){var j=h[a].def;h[a].owner.createSubButton(this._createComponentbyDefinition.bind(this),j,function(a){g._registerButton(a),g._flatButtons.push(a),a.addEvent("click",function(){g._onButtonClick(a._data)}.bind(g)),i--,0==i&&g._constructionDone()})}},_arrangeButtonAccordingToData:function(){for(var a=this._data.get("items"),b=[],c=0;c<a.length;c++){var d=a[c].get("refId").substr(1);b.push(this._rootButtons.filter(function(a){return a.getDataItem().get("id")==d})[0])}this._rootButtons=b},_constructionDone:function(){this._treeConstructionDone=!0,this._arrangeButtons()},render:function(){this.parent(),"styleChange"==this._changeTriggeredBy?this._arrangeButtonsDelayed():this._arrangeButtons()},setSkin:function(a){this._staticWidth=a.staticWidth||0,this._aspectRatio=parseFloat(a.aspectRatio,10)||-1,this.parent(a)},_onButtonDataChange:function(){this._changeTriggeredBy="dataChange",this.render()},_onDataChange:function(){var a=this.getComponentProperties();a&&a.removeField("spacing"),this._changeTriggeredBy="dataChange",this.parent()},_applySettings:function(){this._preWidthModifier=this._nullModifier,this._postWidthModifier=this._nullModifier,this._staticWidth>0?this._preWidthModifier=this._staticWidthModifier:(this.getComponentProperty("sameWidthButtons")&&(this._preWidthModifier=this._sameWidthModifier),this.getComponentProperty("stretchButtonsToMenuWidth")&&(this._postWidthModifier=this._stretchToFillModifier))},_skinSizeChange:function(){this._changeTriggeredBy="styleChange",this.parent()},_skinParamsChange:function(a){this._changeTriggeredBy="styleChange",this.parent(a)},_arrangeButtonsDelayed:function(){this._arrangeDone=!1,-1!=this._arrangeWaitID&&this.injects().Utils.clearCallLater(this._arrangeWaitID),this._arrangeWaitID=this.callLater(this._arrangeButtonsCapture,[],100),this._changeTriggeredBy="",this._skinParts.itemsContainer.setStyle("overflow","hidden")},_arrangeButtonsCapture:function(){this._arrangeButtons(),-1!=this._arrangeWaitID&&this._arrangeButtonsDelayed()},_arrangeButtons:function(){if(this._arrangeDone=!1,this._treeConstructionDone&&void 0!=this._skinParts&&this._rootButtons&&0!=this._rootButtons.length&&this._isDisplayed&&this.isReady()&&""!=this._skinParts.moreButton.className){var a=this._hideButtonsOfHiddenPages();if(a){this.$view.removeClass("visuallyHidden"),this.injects().Utils.clearCallLater(this._overflowID),this._prevButtonsWidth=0,this._arrangeWaitID=-1,this._applySettings(),this._initItemsContainer(),this._initMoreButton();var b=this._getDisplayedButtons();if(b.length){b.push(this._skinParts.moreButton),this._preArrangeButtons(this._flatButtons);var c=this._getSampleButton();this._sampleButtonBorder(c),this._setMinimumDimensions(c);for(var d=0;d<b.length;d++)b[d].getViewNode().inject(this._skinParts.itemsContainer),b[d].getViewNode().setProperty("container","menu");this._preWidthModifier(b),this._calculateButtonsAmount(b),this.setMinW(b[0].getViewNode().offsetWidth),this._postWidthModifier(b),b=this._getDisplayedButtons(),b.push(this._skinParts.moreButton),this._alignButtonsText(b),this._restoreTransition(this._flatButtons),this._skinParts.itemsContainer.setStyle("overflow","visible"),this._skinParts.itemsContainer.setStyle("display","inherit"),this._skinParts.itemsContainer.setStyle("white-space","nowrap"),this._testOverFlow(),this._arrangeDone=!0,this._selectActiveButton(this.injects().Viewer.getCurrentPageId()),this.fireEvent("ready")}}}},arrangeDropButtons:function(a){var b;for(b=0;b<a.length;b++){var c=a[b];c.getViewNode().setStyle("visibility","inherit");var d=this._skin.more_vPadding||15;this._setButtonHeight(c,this._getButtonMinimalHeight(c)+d)}},_calculateButtonsAmount:function(a){a=this._arrangementAlgorithm(a),this._skinParts.moreButton.skipMe&&(this._skinParts.moreButton.getViewNode().setStyle("visibility","hidden"),this._skinParts.moreButton.getViewNode().inject(this._hiddenButtonsContainer),a[a.length-1]===this._skinParts.moreButton&&a.pop())},_getButtonsWidth:function(){for(var a=0,b=0;b<this._skinParts.itemsContainer.children.length;b++)a+=this._skinParts.itemsContainer.children[b].getLogic().getWidthOnLayout();return a},_hideButtonsOfHiddenPages:function(){for(var a=!0,b=0;b<this._flatButtons.length;b++)if(this._flatButtons[b]!=this._skinParts.moreButton){if(!this._flatButtons[b].getDataItem()){a=!1;break}this._flatButtons[b].isHidden()&&(this._flatButtons[b].getViewNode().setStyle("visibility","inherit"),this._flatButtons[b].getViewNode().inject(this._hiddenButtonsContainer))}return a},_getDisplayedButtons:function(){for(var a=[],b=0;b<this._rootButtons.length;b++)this._rootButtons[b].getDataItem()._data.hidePage||a.push(this._rootButtons[b]);return a},_setMenuListPositions:function(a){var b,c,d;if(1==a.length)c=a[0],c.getViewNode().setProperty("listposition","lonely"),c.getViewNode().setProperty("container","menu");else for(b=0;b<a.length;b++)c=a[b],d=0==b&&this._setPositionForFirst()?"left":b==a.length-1&&this._setPositionForLast()?"right":"center",c.getViewNode().setProperty("listposition",d),c.getViewNode().setProperty("container","menu")},_setPositionForFirst:function(){var a=!1;return this._postWidthModifier==this._stretchToFillModifier?a=!0:"left"==this.getComponentProperty("alignButtons")&&(a=!0),a},_setPositionForLast:function(){var a=!1;return this._postWidthModifier==this._stretchToFillModifier?a=!0:"right"==this.getComponentProperty("alignButtons")&&(a=!0),a},_getSampleButton:function(){return"visible"==this._rootButtons[0].getViewNode().getStyle("visibility")?this._rootButtons[0]:this._skinParts.moreButton},_sampleButtonBorder:function(a){this._buttonsBorder=a._skinParts.borderWrapper?this._getBorder(a._skinParts.borderWrapper):this._getBorder(a.getViewNode())},_setMinimumDimensions:function(a){this.setMinH(this._getButtonMinimalHeight(a))},_getButtonMinimalHeight:function(a){a._skinParts.label.setStyle("line-height","100%");var b=0;a.getSkin()&&!isNaN(a.getSkin().addToMinH)&&(b=a.getSkin().addToMinH);var c=this._getBorder(this._skinParts.itemsContainer).y+this._buttonsBorder.y;return b+c+parseInt(a._skinParts.label.getComputedStyle("line-height"))},_initItemsContainer:function(){this._skinParts.itemsContainer.setStyle("text-align",this.getComponentProperty("alignButtons"));var a=this.getHeight()-this._getBorder(this._skinParts.itemsContainer).y-this._getMargin(this._skinParts.itemsContainer).y,b=this.getWidth()-this._getBorder(this._skinParts.itemsContainer).x-this._getMargin(this._skinParts.itemsContainer).x;this._skinParts.itemsContainer.setStyle("height",a+"px"),window.Browser&&window.Browser.safari&&window.Browser.version<6?this._skinParts.itemsContainer.setStyle("width","100%"):this._skinParts.itemsContainer.setStyle("width",b+"px"),this._skinParts.itemsContainer.setStyle("overflow","hidden"),this._skinParts.itemsContainer.setStyle("white-space","normal")},_initMoreButton:function(){this._skinParts.moreButton.setLabel(this.getComponentProperty("moreButtonLabel")),this._skinParts.moreButton.skipMe=!0,this._skinParts.moreButton.children=[],this._skinParts.moreButton.getViewNode().inject(this._skinParts.itemsContainer)},_preArrangeButtons:function(a){for(var b=0;b<a.length;b++){var c=a[b];a[b].getViewNode().setStyle("position","relative"),c.getViewNode().setStyle("visibility","inherit"),c.disableTransition(),c._skinParts.bg.setStyle("padding","0px 0px")}},_restoreTransition:function(a){for(var b=0;b<a.length;b++){var c=a[b];c.enableTransition()}},_alignButtonsText:function(a){for(var b=0;b<a.length;b++){var c=a[b].getViewNode(),d=parseInt(c.getLogic()._skinParts.bg.getComputedStyle("padding-left"))+parseInt(c.getLogic()._skinParts.bg.getComputedStyle("padding-right"));a[b].setPadding(d)}},_arrangementAlgorithm:function(a){for(var b=!1;!b;)if(b=this._arrangementIteration(a),!b)if(1==a.length)b=!0;else{this._skinParts.moreButton.skipMe=!1;var c=a.splice(a.length-2,1)[0];c.getViewNode().setStyle("visibility","inherit"),c.getViewNode().dispose(),this._skinParts.moreButton.children.unshift(c)}return a},_stretchToFillModifier:function(a,b){function c(a,b){if(j>0){var c=Math.ceil(h/j);h-=c;var e=parseInt(a._skinParts.bg.getStyle(b));d&&(i._buttonsPadding[a]||(i._buttonsPadding[a]={}),i._buttonsPadding[a][b]=e),a._skinParts.bg.setStyle(b,e+c+"px"),j--}}b=b||0;var d=!1;0==b&&(d=!0,this._buttonsPadding={});var e,f=this._getButtonsWidth(),g=this._skinParts.itemsContainer.getWidth(),h=g-f-b;Browser.ie&&(h-=1),h=Math.max(h,0);var i=this;if(a.length>0){var j=2*a.length;for(e=0;e<a.length/2;e++){var k=a[e],l=a[a.length-e-1];c(k,"padding-left"),c(l,"padding-right"),c(k,"padding-right"),c(l,"padding-left")}}if(this._skinParts.itemsContainer.scrollHeight-a[0].getViewNode().offsetHeight>=a[0].getViewNode().offsetHeight){for(e=0;e<a.length;e++){var m=a[e];m._skinParts.bg.setStyle("padding-left",this._buttonsPadding[m]["padding-left"]),m._skinParts.bg.setStyle("padding-right",this._buttonsPadding[m]["padding-left"])}20>b&&this._stretchToFillModifier(a,b+1)}for(e=0;e<a.length;e++){var m=a[e];m.alignText()}},_sameWidthModifier:function(a){var b,c,d=0;for(b=0;b<a.length;b++){c=a[b];var e=parseInt(c.getViewNode().offsetWidth-this._buttonsBorder.x);isNaN(e)||(d=Math.max(d,e))}if(d>0)for(b=0;b<a.length;b++)c=a[b],c.fillWidthByPadding(d)},_staticWidthModifier:function(a){var b,c;for(b=0;b<a.length;b++)c=a[b],c.offsetWidth<this._staticWidth?c.fillWidthByPadding(this._staticWidth):c.getViewNode().setStyle("width",this._staticWidth+"px")},_nullModifier:function(){},_arrangementIteration:function(a){var b,c,d,e=[];for(d=0;d<a.length;d++)c=a[d],c.skipMe?c.collapse():e.push(c);for(this._setMenuListPositions(e),d=0;d<e.length;d++)c=e[d],c.uncollapse(),c.getViewNode().setStyle("visibility","visible"),c.getViewNode().inject(this._skinParts.itemsContainer),b=parseInt(this._skinParts.itemsContainer.getStyle("height"))-this._buttonsBorder.y,this._setButtonHeight(c,b),c._skinParts.label.setStyle("width","auto");return this._skinParts.itemsContainer.scrollHeight-a[0].getViewNode().offsetHeight<a[0].getViewNode().offsetHeight},_setButtonHeight:function(a,b){void 0!=a._skinParts.labelPad&&(b-=a._skinParts.labelPad.offsetHeight),a._skinParts.label.setStyle("line-height",b+"px")},_getBorder:function(a){var b=0,c=0;return a&&(b=parseInt(a.getStyle("border-left-width"))+parseInt(a.getStyle("border-right-width")),c=parseInt(a.getStyle("border-top-width"))+parseInt(a.getStyle("border-bottom-width"))),{x:b,y:c}},_getMargin:function(a){var b=0,c=0;return a&&(b=parseInt(a.getStyle("margin-left"))+parseInt(a.getStyle("margin-right")),c=parseInt(a.getStyle("margin-top"))+parseInt(a.getStyle("margin-bottom"))),{x:b,y:c}},_onResize:function(){this._resetTestOverFlowCount(),this._arrangeButtons()},_onButtonClick:function(a){this.injects().Viewer.goToPage(a.get("id")),this.callLater(function(){navigator.userAgent.match(/(iPod|iPhone|iPad)/)&&this._dropDown.closeDropDown(!0)}.bind(this),[],100)},dispose:function(){this.injects().Viewer.removeEvent("pageTransitionStarted",this._onPageChanged),this.injects().Theme.removeEvent("propertyChange",this._onThemeChange),this.parent()}})}),define.component("wysiwyg.viewer.components.mobile.TinyMenu",function(a){var b=a;b.inherits("mobile.core.components.base.BaseComponent"),b.resources(["W.Commands","W.Data","W.Viewer"]),b.traits(["wysiwyg.viewer.components.traits.FixedComponentTrait"]),b.skinParts({menuButton:{type:"htmlElement"},menuContainer:{type:"htmlElement"}}),b.dataTypes(["Menu"]),b.propertiesSchemaType("TinyMenuProperties"),b.binds(["_onEditModeChanged"]),b.states({direction:["right","left","center"]}),b.fields({EDITOR_META_DATA:{general:{settings:!0,design:!1},mobile:{custom:[{label:"FPP_DESIGN_LABEL",command:"WEditorCommands.ShowMobileMenuPanel"},{label:"FPP_NAVIGATE_LABEL",command:"WEditorCommands.MobilePages",commandParameter:{galleryConfigID:"pagesPanel"}}],disablePropertySplit:!0}}}),b.methods({initialize:function(a,b,c){this.parent(a,b,c),this._resizableSides=[],this._usesExternalData=!0},_onAllSkinPartsReady:function(){this._skinParts.menuButton.addEvent("click",this._toggleMenu.bind(this)),this.resources.W.Commands.registerCommandListenerByName("WPreviewCommands.WEditModeChanged",this,this._onEditModeChanged),this._skinParts.menuContainer.collapse()},render:function(){var a=this._data.getItems();this._asyncGetChildren(a,function(a){var b=this._skinParts.menuContainer;if(this._clearOldContent(b),_.isEmpty(a))return this._mainMenu=void 0,!1;this._mainMenu=this._initMenu(a,b);var c=this.resources.W.Viewer.getCurrentPageId();this._setCurrentPage(this._mainMenu,c)}.bind(this)),this.parent()},isFixedPositioned:function(){return"fixed"===this._$pos},_clearOldContent:function(a){for(;a.firstChild;)a.removeChild(a.firstChild)},_onEditModeChanged:function(a){this._closeMainMenu(a),this.render()},_applyResponsiveStyling:function(){var a=20,b=this._skinParts.menuContainer,c=this.resources.W.Viewer.getCompByID("SITE_STRUCTURE"),d=_.parseInt(c.getStyle("width")),e=_.parseInt(c.getPosition().x);d-=2*a,b.setStyle("width",d);var f=_.parseInt(this._view.getPosition().x);f=f-e-a;var g=-1*f;b.setStyle("left",g)},_initMenu:function(a,b){if(a&&!_.isEmpty(a)){var c=this._buildMenu(a,!0);this._addElement(b,c),this._bindMenuEvents(c);var d=this.getComponentProperty("direction");return this.setState(d,"direction"),c}},_bindMenuEvents:function(a){a.addEvent("click",function(a){var b=a.target;if(b.className.indexOf("tiny-menu-toggle-items")>-1){var c=b.parentElement;this._toggleClass(c,"tiny-menu-open"),this._setMinHeightFromMenu()}}.bind(this)),this._setCurrentPageTracking(a)},_toggleMenu:function(){var a=this._skinParts.menuButton;a.className.indexOf("tiny-menu-open")>-1?this._closeMainMenu():this._openMainMenu()},_openMainMenu:function(){var a=this._mainMenu,b=this._skinParts.menuButton;a&&(_.filter(a.children,function(a){var b=$(a).hasClass("hasChildren"),c=a.getElementsByTagName("ul")[0];return b&&c}).forEach(function(a){var b=a.getElementsByTagName("ul")[0],c=b.querySelector("li>.tiny-menu-current-page");c?$(a).addClass("tiny-menu-open"):$(a).removeClass("tiny-menu-open")}),this._applyResponsiveStyling(a),a.addClass("tiny-menu-open"),b.addClass("tiny-menu-open"),this._skinParts.menuContainer.uncollapse(),this._setMinHeightFromMenu())},_closeMainMenu:function(a){var b=this._mainMenu,c=this._skinParts.menuButton;b&&(b.hasClass("tiny-menu-open")||c.hasClass("tiny-menu-open"))&&(b.removeClass("tiny-menu-open"),c.removeClass("tiny-menu-open"),this._skinParts.menuContainer.collapse(),a&&"PREVIEW"!==a||this.resources.W.Viewer.getSiteNode().getLogic().resetMinHeightFromMenu())},_setMinHeightFromMenu:function(){var a=this._skinParts.menuContainer.getSize().y+this._skinParts.menuContainer.getPosition().y;this.resources.W.Viewer.getSiteNode().getLogic().setMinHeightFromMenu(a)},_buildMenu:function(a,b){var c;return c=new Element("ul"),c.setAttribute("class",b?"tiny-menu-top-menu":"tiny-menu-sub-menu"),this._addItems(a,c),c},_addItems:function(a,b){_.forEach(a,function(a){var c=this._buildItem(a),d=a.children;if(d&&_.isArray(d)&&!_.isEmpty(d)){var e=this._buildToggleButton();this._addElement(c,e);var f=this._buildMenu(d);this._addElement(c,f)}this._addElement(b,c)},this)},_buildItem:function(a){var b=a.name,c=a.id,d=a.children,e=d&&_.isArray(d)&&!_.isEmpty(d),f=new Element("li");e&&f.setAttribute("class","hasChildren");var g=this._buildLink(b,c);return f=this._addElement(f,g)},_buildLink:function(a,b){var c=new Element("a");c.innerHTML=a,c.setAttribute("data-refid",b),c=this._bindPageNavigation(c,b);var d=W.Utils.hash.getHashPartsString(b,a);return c.setAttribute("link-ref","#!"+d),c},_buildToggleButton:function(){var a=new Element("span");return a.setAttribute("class","tiny-menu-toggle-items"),a},_bindPageNavigation:function(a,b){return a.addEvent("click",function(){this._navigateToPage(b),this._closeMainMenu()}.bind(this)),a},_setCurrentPageTracking:function(a){this.resources.W.Commands.registerCommandAndListener("WViewerCommands.SelectedPageChanged",this,function(b){this._setCurrentPage(a,b)
})},_setCurrentPage:function(a,b){if(a){var c=a.querySelector(".tiny-menu-current-page");c&&$(c).removeClass("tiny-menu-current-page");var d=a.querySelector("[data-refid="+b+"]");d&&$(d).addClass("tiny-menu-current-page")}},_navigateToPage:function(a){0===a.indexOf("#")&&(a=a.substr(1)),this.resources.W.Viewer.goToPage(a)},_asyncGetChildren:function(a,b){if(!_.isArray(a)||_.isEmpty(a))return b([]),void 0;var c=a.length,d=[];_.forEach(a,function(a){this._asyncGetSinglePage(a,function(a){a&&d.push(a),c-=1,1>c&&b(d)})},this)},_asyncGetSinglePage:function(a,b){var c=a.get("refId"),d=a.get("items");this.resources.W.Data.getDataByQuery(c,function(a){var c=a.get("mobileHidePage");if(c)return b(null),void 0;var e=this._getItemData(a);this._asyncGetChildren(d,function(a){e.children=a,b(e)})}.bind(this))},_getItemData:function(a){var b={};return b.id=a.get("id"),b.name=a.get("title"),b.children=[],b},_addElement:function(a,b){return a.appendChild(b),a},_toggleClass:function(a,b){var c;c=a.className.indexOf(b)>-1?a.className.replace(" "+b,""):a.className+" "+b,a.setAttribute("class",c)},_createComponentProperties:function(){this.parent(),this._properties.setIsPersistent(!0)}})}),define.component("wysiwyg.viewer.components.sm.SMApplyForMembership",function(a){var b=a;b.inherits("wysiwyg.viewer.components.sm.SMRegister"),b.resources(["W.SiteMembers"]),b.skinParts({email:{type:"wysiwyg.viewer.components.inputs.TextInput",hookMethod:"_bindEmailField"},password:{type:"wysiwyg.viewer.components.inputs.TextInput",hookMethod:"_bindPasswordField"},re_password:{type:"wysiwyg.viewer.components.inputs.TextInput",hookMethod:"_bindRePasswordField"}}),b.methods({onSubmit:function(){var a=this._emailField._data.get("text"),b=this._passwordField._data.get("text"),c=this._rePasswordField._data.get("text");this._validateFields(a,b,c)&&this.resources.W.SiteMembers.applyForMembership(a,b,this._onFormSuccess,this._onFormError)},_onFormSuccess:function(){var a=this._emailField._data.get("text"),b=this._keys.SMApply_Success2;b=this._formatString(b,[a]);var c=this._keys.SMApply_Success1+b;this._container.showConfirmation({message:c})},_formatString:function(a,b){var c=0;return b.map(function(b){var d="{"+c+"}";a=a.replace(d,b),c++}),a}})}),define.component("wysiwyg.viewer.components.sm.SMContainer",function(a){var b=a;b.inherits("mobile.core.components.base.BaseComponent"),b.resources(["W.Config","W.Utils","W.Viewer","W.Commands","W.SiteMembers"]),b.binds(["_handleSubmit","onFormError","onFormSuccess","_getCurrentForm","_handleCancel","_handleConfirmationOk"]),b.states({DEFAULT:["normal","confirm"],displayDevice:["mobile"]}),b.skinParts({blockingLayer:{type:"htmlElement"},submitButton:{type:"htmlElement"},okButton:{type:"htmlElement"},content:{type:"htmlElement"},contentInner:{hookMethod:"_createInnerDialog"},confirmationText:{type:"htmlElement"},errMsg:{type:"htmlElement"},title:{type:"htmlElement"},infoTitle:{type:"htmlElement"},note:{type:"htmlElement"},cancel:{type:"htmlElement"},xButton:{type:"htmlElement"}}),b.statics({INTENTS:{LOGIN:"LOGIN",REGISTER:"REGISTER",UPDATE_USER:"UPDATE",EMAIL_RESET_PASSWORD:"EMAILRESETPASSWORD",RESET_PASSWORD:"RESETPASSWORD"},langKeys:{en:{SMContain_Cancel:"Cancel",SMContainer_Need_Log_In:"To view this page, you need to be logged in.",SMContainer_Show_Confirm:"This page is protected with a member login. Your users will be able to see this page once they are logged in.",SMContainer_Show_Confirm2:" To manage your site's members, go to your site in My Account and click Site Members",SMContainer_OK:"OK"},es:{SMContain_Cancel:"Cancelar",SMContainer_Need_Log_In:"Para ver esta pgina, tienes que iniciar sesin.",SMContainer_Show_Confirm:"Esta pgina est protegida con un login de miembro. Tus usuarios podrn ver esta pgina una vez hayan iniciado sesin.",SMContainer_Show_Confirm2:"Para administrar los miembros de tu sitio, ve a tu sitio y en Mi Cuenta haz clic en Miembros del Sitio",SMContainer_OK:"OK"},de:{SMContain_Cancel:"Abbrechen",SMContainer_Need_Log_In:"Sie mssen angemeldet sein, um diese Seite zu sehen.",SMContainer_Show_Confirm:"Diese Seite ist mit der Mitgliederanmeldung geschtzt. Ihre Besucher knnen diese Seite erst sehen, wenn diese angemeldet sind.",SMContainer_Show_Confirm2:'Gehen Sie zu "Mein Konto" und klicken Sie auf "Site-Mitglieder", um Ihre Mitglieder zu verwalten.',SMContainer_OK:"OK"},fr:{SMContain_Cancel:"Annulation",SMContainer_Need_Log_In:"Pour voir cette page, vous devez tre connect",SMContainer_Show_Confirm:"Cette page est protge par une connexion membre. Vos utilisateurs verront cette page une fois qu'ils seront connects.",SMContainer_Show_Confirm2:"Pour grer vos membres, allez sur votre site dans Mon Compte et cliquez sur Membres du Site.",SMContainer_OK:"OK"},it:{SMContain_Cancel:"Cancella",SMContainer_Need_Log_In:"Per visualizzare questa pagina, devi aver fatto il login.",SMContainer_Show_Confirm:"Questa pagina  protetta da un login membri. I tuoi utenti saranno in grado di vedere questa pagina una volta che avranno effettuato l'accesso.",SMContainer_Show_Confirm2:"Per gestire i membri del tuo sito, vai nel tuo sito ne Il Mio Account e clicca Membri del Sito",SMContainer_OK:"OK"},ja:{SMContain_Cancel:"",SMContainer_Need_Log_In:"",SMContainer_Show_Confirm:"",SMContainer_Show_Confirm2:"",SMContainer_OK:"OK"},ko:{SMContain_Cancel:"",SMContainer_Need_Log_In:"   .",SMContainer_Show_Confirm:"     .        .",SMContainer_Show_Confirm2:'    " "     " " .',SMContainer_OK:""},pl:{SMContain_Cancel:"Anuluj",SMContainer_Need_Log_In:"Musisz by zalogowany, aby zobaczy t stron.",SMContainer_Show_Confirm:"Ta strona jest zabezpieczona loginem witryny. Twoi uytkownicy zobacz tre tej strony po zalogowaniu.",SMContainer_Show_Confirm2:"Aby zarzdza uytkownikami twojej witryny, id do Mojego Konta i kliknij na Login Witryny.",SMContainer_OK:"OK"},pt:{SMContain_Cancel:"Cancelar",SMContainer_Need_Log_In:"Para ver esta pgina, voc precisa fazer login.",SMContainer_Show_Confirm:"Esta pgina est protegida com login de membros. Seus usurios podero ver esta pgina depois de fazerem login.",SMContainer_Show_Confirm2:"Para gerenciar os membros de seu site, v para seu site em Minha Conta e clique em Membros do Site",SMContainer_OK:"OK"},ru:{SMContain_Cancel:"",SMContainer_Need_Log_In:"    ",SMContainer_Show_Confirm:"    .           .",SMContainer_Show_Confirm2:"            ",SMContainer_OK:"OK"},tr:{SMContain_Cancel:"ptal",SMContainer_Need_Log_In:"Bu sayfay grntlemek iin giri yapmanz gerekir.",SMContainer_Show_Confirm:"Bu sayfa ye giriiyle korunmaktadr. Kullanclarnz giri yaptktan sonra bu sayfay grebilecekler.",SMContainer_Show_Confirm2:"Sitenizin yelerini ynetmek iin Hesabm'dan sitenize gidip Site yeleri stnde tklatn.",SMContainer_OK:"OK"}},_keys:{}}),b.methods({initialize:function(a,b,c){this._args=c,this._initiatorId=this._initiatorId||c&&c.initiator,this.isVolatile=!0,this.parent(a,b,c),this._intent=c&&c.intent,this._authCallback=c&&c.authCallback,this._hashRedirectTo=c&&c.hashRedirectTo,this._cameFromHashChange=c&&c.cameFromHashChange,this._openedByPageSecurity=c&&c.openedByPageSecurity,this._disableCancel=c&&c.disableCancel,this._shouldCloseContainer=!0,this._formData=c&&c.formData,this.resources.W.Commands.registerCommandListenerByName("WPreviewCommands.WEditModeChanged",this,this._closeSMContainer),this.resources.W.Commands.registerCommandAndListener("WPreviewCommands.ViewerStateChanged",this,this._closeSMContainer),this.resources.W.Config.env.getCurrentFrameDevice()===Constants.ViewerTypesParams.TYPES.MOBILE&&this.setState("mobile","displayDevice")},_onAllSkinPartsReady:function(a){this.setState("normal","DEFAULT"),a.submitButton.addEvent("click",this._handleSubmit),this._disableCancel?(a.xButton.hide(),a.cancel.setStyle("visibility","hidden")):(a.cancel.addEvent("click",this._handleCancel),a.xButton.addEvent("click",this._handleCancel),a.blockingLayer.addEvent("click",function(b){b.target==a.blockingLayer&&this._handleCancel()}.bind(this))),a.okButton.addEvent("click",this._handleConfirmationOk),this._initializeForm(a.contentInner),this.callLater(this.centerDialog),this._updateTranslation()},_setDictionary:function(a){this._keys=a&&this.langKeys[a]?this.langKeys[a]:this.langKeys.en},_updateTranslation:function(){this._skinParts.cancel.innerHTML=this._keys.SMContain_Cancel,this._skinParts.okButton.value=this._keys.SMContainer_OK},_getFormType:function(a){var b=this.resources.W.SiteMembers;switch(a||(a=b.isNotAuthenticatedWithCookie()?this.INTENTS.LOGIN:this.INTENTS.REGISTER),a){case"REGISTER":var c=b.getCollectionType();switch(c){case"Open":return"register";case"ApplyForMembership":return"applyForMembership"}break;case"LOGIN":return"login"}},_createInnerDialog:function(a){return this._assureIntentExists(),this._enrichDefinitionByType(a),a},_assureIntentExists:function(){var a=this.resources.W.SiteMembers;this._intent||(this._intent=a.isNotAuthenticatedWithCookie()?this.INTENTS.LOGIN:this.INTENTS.REGISTER)},_enrichDefinitionByType:function(a){var b=null;switch(this._intent){case this.INTENTS.REGISTER:var c=this.resources.W.SiteMembers.getCollectionType();switch(c){case"Open":b="register";break;case"ApplyForMembership":b="applyForMembership";break;default:b="register"}break;case this.INTENTS.LOGIN:b="login";break;case this.INTENTS.EMAIL_RESET_PASSWORD:b="ResetPasswordEmail";break;case this.INTENTS.RESET_PASSWORD:b="ResetPassword"}return null!==b&&this._enrichDefinitionType(a,b),a},_enrichDefinitionType:function(a,b){a.type="wysiwyg.viewer.components.sm.SM"+b.capitalize(),a.skin="wysiwyg.viewer.skins.sm.SM"+b.capitalize()+"Skin",a.argObject={container:this,formData:this._formData}},_setConfirmationOkCaption:function(a){this._skinParts.okButton.value=a},_initializeForm:function(a){this._currentForm=a;var b=this._skinParts.title;b.set("html",this._currentForm.getDisplayName());var c=this._skinParts.submitButton;c.set("value",this._currentForm.getButtonLabel());var d=this._skinParts.note,e=this._currentForm.getSubHeaderElement();if(e){var f=e.el,g=e.intent;f.getElements("a").addEvent("click",function(){this.resources.W.SiteMembers.openSiteMembersPopup({intent:g,disableCancel:this._disableCancel,openedByPageSecurity:this._openedByPageSecurity,hashRedirectTo:this._hashRedirectTo,cameFromHashChange:this._cameFromHashChange,formData:this._formData,dialogsLanguage:this._args.dialogsLanguage})}.bind(this)),d.adopt(f.childNodes)}this._addCurrentFormEvents(),this._setDictionary(this._args.dialogsLanguage),this._openedByPageSecurity&&(this.resources.W.Config.env.$isPublicViewerFrame||this.resources.W.Config.isInDebugMode()?(this._skinParts.infoTitle.set("text",this._keys.SMContainer_Need_Log_In),this._skinParts.note.setStyle("float","right"),this._skinParts.infoTitle.setStyle("display","block")):this.showConfirmation({message:"".concat(this._keys.SMContainer_Show_Confirm,this._keys.SMContainer_Show_Confirm2)},function(){this.reportAuthStatusChange(!0),this._closeSMContainer()}.bind(this)))},setActiveForm:function(){},centerDialog:function(){var a=this._skinParts.dialog;a.setStyles({"margin-left":-(a.getSize().x/2),"margin-top":-(a.getSize().y/2)})},_removeCurrentFormEvents:function(){var a=this._getCurrentForm();a.removeEvent("error",this._onFormError),a.removeEvent("success",this._onFormSuccess)},_addCurrentFormEvents:function(){var a=this._getCurrentForm();a.addEvent("error",this._onFormError),a.addEvent("success",this._onFormSuccess)},onFormError:function(a){this._skinParts.errMsg.set("html",a)},onFormSuccess:function(){this._closeSMContainer()},closeAndRedirect:function(){if(this._closeSMContainer(),this._hashRedirectTo&&!this._cameFromHashChange){var a=this.resources.W.Utils.hash.getHashParts(this._hashRedirectTo);this.resources.W.Utils.hash.setHash(a.id,a.title,a.extData,!0),window.location.hash=this._hashRedirectTo}location.reload()},reportAuthStatusChange:function(a,b){this._authCallback&&this.resources.W.SiteMembers.reportAuthStatusChange(this._authCallback,a,b)},showConfirmation:function(a,b,c){this.setState("confirm","DEFAULT"),this._updateConfirmationDialogTexts(a),this._confirmCallback=b,this._shouldCloseContainer=c,void 0===c&&(this._shouldCloseContainer=!0)},_updateConfirmationDialogTexts:function(a){this._skinParts.confirmationText.set("text",a.message),this._skinParts.confirmationTitleText.set("text",a.title)},_handleConfirmationOk:function(){this._confirmCallback&&this._confirmCallback(),this._shouldCloseContainer&&this._closeSMContainer(),this._shouldCloseContainer=!0},closeAndRedirectTo:function(a){if(this._closeSMContainer(),this._hashRedirectTo&&!this._cameFromHashChange){var b=this.resources.W.Utils.hash.getHashParts(this._hashRedirectTo);this.resources.W.Utils.hash.setHash(b.id,b.title,b.extData,!0),window.location.hash=this._hashRedirectTo}a?(a=this._removeResetForgotPasswordParameterIfExists(),this._directToUrl(a)):this._reload()},_removeResetForgotPasswordParameterIfExists:function(){var a=window.location.href;return a.indexOf(this.resources.W.SiteMembers.RESET_PASSWORD_KEY_PARAMETER)>=0?this._removeParameterFromUrl(a,this.resources.W.SiteMembers.RESET_PASSWORD_KEY_PARAMETER):a},_removeParameterFromUrl:function(a,b){if(a&&b){var c=a.indexOf(b);if(c>=0){var d=a.substr(c).indexOf("&");return 0>d&&(d=a.length),a.slice(0,c)+a.slice(c+d+"&".length)}}return a},_directToUrl:function(a){a&&(this._setURL(a),this._isUrlContainHash(a)&&setTimeout(function(){this._reload()}.bind(this),10))},_isUrlContainHash:function(a){return-1!==String(a).indexOf("#")},_setURL:function(a){location.href=a},_reload:function(){location.reload()},_handleCancel:function(){this._getCurrentForm().onCancel(),this.reportAuthStatusChange(!1,{cancel:!0}),this._closeSMContainer()},_onKeyPress:function(a){13==a.code&&this._handleSubmit()},_handleSubmit:function(){return this.resources.W.Config.env.$isPublicViewerFrame||this.resources.W.Config.isInDebugMode()?(this._skinParts.errMsg.set("html",""),this._getCurrentForm().onSubmit(),void 0):(this.resources.W.Commands.executeCommand("adminLogin.submitAttempt",{component:this._skinParts.submitButton},this),void 0)},_closeSMContainer:function(){this.resources.W.Commands.executeCommand("WViewerCommands.SiteMembers.Close",null,null)},_getCurrentForm:function(){return this._currentForm}})}),define.component("wysiwyg.viewer.components.sm.SMForm",function(a){var b=a;b.inherits("mobile.core.components.base.BaseComponent"),b.resources(["W.Data"]),b.binds(["_onFormError","_onFormSuccess"]),b.statics({PASS_MIN_LEN:4,PASS_MAX_LEN:15,ERR_MAP:{GENERAL_ERR:"Server error. try again later.",VAL_ERR_PASSWORD_BLANK:"Password cannot be blank",VAL_ERR_PASSWORD_RETYPE:"Passwords are not the same",VAL_ERR_PASSWORD_LENGTH:"Password length must be between {0} and {1}",VAL_ERR_EMAIL_BLANK:"Email cannot be blank",VAL_ERR_EMAIL_INVALID:"Email is invalid",VAL_ERR_NON_ASCII_CHARS:"Password must contain only ASCII characters","-19999":"Unknown user","-19995":"Email is already taken","-19972":"Invalid token","-19988":"Validation Error","-19984":"Invalid Session","-19976":"Wrong email or password","-19958":"Your member request is waiting approval from the site owner","-19980":"Blocked by site owner"},INTENTS:{LOGIN:"LOGIN",REGISTER:"REGISTER",UPDATE_USER:"UPDATE",EMAIL_RESET_PASSWORD:"EMAILRESETPASSWORD",RESET_PASSWORD:"RESETPASSWORD"},LABELS:{EMAIL:"Email",PASSWORD:"Password",RE_PASSWORD:"Retype password",REMEMBER_ME:"Remember Me"},langKeys:{en:{SMRegister_sign_up:"Sign up",SMRegister_GO:"GO",SMRegister_Already_Have_User:"I already have a user",SMRegister_Login:"Login",SMForm_Email:"Email",SMForm_Password:"Password",SMForm_Retype_Password:"Retype password",SMLogin_Remember_Me:"Remember Me",SMLogin_Forgot_Password:"Forgot your password?",SMLogin_Login:"Login",SMLogin_Sign_UP:"Or {0}Sign up{1}",SMResetPassMail_title:"Reset Password",SMResetPassMail_Back_Login:"Back to Login",SMResetPassMail_Enter_Email:"Please enter your email address",SMResetPassMail_confirmation_title:"Please check your email",SMResetPassMail_confirmation_msg:"Weve sent you an email with a link that will allow you to reset your password",SMResetPass_Message:"To set your new password, please enter it in both fields below. ",SMResetPass_New_Password:"Enter a new password",SMResetPass_Retype_Password:"Type again:",SMResetPass_Continue:"Continue",SMResetPass_Reset_Succ:"Youve successfully reset your password.",SMResetPass_Reset_Fail:"Password could not have been changed. Try again later.",SMProfile_Update_Details:"Update your details",SMProfile_Update:"Update",SMApply_Success1:"Success! Your member login request has been sent and is awaiting approval.",SMApply_Success2:"The site administrator will notify you via email( {0} ) once your request has been approved ",SMForm_Error_General_Err:"Server error. try again later.",SMForm_Error_Password_Blank:"Password cannot be blank",SMForm_Error_Password_Retype:"Passwords are not the same",SMForm_Error_Password_Length:"Password length must be between {0} and {1}",SMForm_Error_Email_Blank:"Email cannot be blank",SMForm_Error_Email_Invalid:"Email is invalid",SMForm_Error_Non_Ascii_Chars:"Password must contain only ASCII characters",SMForm_Error_19999:"Unknown user",SMForm_Error_19995:"Email is already taken",SMForm_Error_19972:"Invalid token",SMForm_Error_19988:"Validation Error",SMForm_Error_19984:"Invalid Session",SMForm_Error_19976:"Wrong email or password",SMForm_Error_19958:"Your member request is waiting approval from the site owner",SMForm_Error_19980:"Blocked by site owner"},es:{SMRegister_sign_up:"Regstrate",SMRegister_GO:"ENTRAR",SMRegister_Already_Have_User:"Ya tengo un usuario",SMRegister_Login:"Inicia Sesin",SMForm_Email:"Email",SMForm_Password:"Clave",SMForm_Retype_Password:"Escribe de nuevo la clave",SMLogin_Remember_Me:"Recurdame",SMLogin_Forgot_Password:"Has olvidado tu clave?",SMLogin_Login:"Inicia sesin",SMLogin_Sign_UP:"O {0}Regstrate{1}",SMResetPassMail_title:"Restablecer Clave",SMResetPassMail_Back_Login:"Volver a Iniciar Sesin",SMResetPassMail_Enter_Email:"Por favor escribe tu direccin de correo",SMResetPassMail_confirmation_title:"Por favor revisa tu correo",SMResetPassMail_confirmation_msg:"Te hemos enviado un email con un enlace que te permitir restablecer tu clave",SMResetPass_Message:"Para configurar tu nueva clave, por favor rellena ambos campos a continuacin. ",SMResetPass_New_Password:"Escribe una nueva clave",SMResetPass_Retype_Password:"Escrbela de nuevo:",SMResetPass_Continue:"Continuar",SMResetPass_Reset_Succ:"Has restablecido tu clave con xito!",SMResetPass_Reset_Fail:"La clave no se pudo cambiar. Intntalo de nuevo ms tarde.",SMProfile_Update_Details:"Update your details",SMProfile_Update:"Update",SMApply_Success1:"Enhorabuena! Tu solicitud de login de miembros ha sido enviada y est pendiente de aprobacin.",SMApply_Success2:"El administrador del sitio te notificar a travs de un email ( {0} una vez tu solicitud sea aprobada ",SMForm_Error_General_Err:"Error del servidor. intntalo de nuevo ms tarde.",SMForm_Error_Password_Blank:"El campo de la clave no puede estar en blanco",SMForm_Error_Password_Retype:"Las claves no son las mismas",SMForm_Error_Password_Length:"La longitud de la clave debe ser entre {0} y {1}",SMForm_Error_Email_Blank:"El campo del email no puede estar en blanco",SMForm_Error_Email_Invalid:"Email invlido",SMForm_Error_Non_Ascii_Chars:"La clave debe contener slo caracteres ASCII",SMForm_Error_19999:"Usuario desconocido",SMForm_Error_19995:"Este email ya est siendo usado",SMForm_Error_19972:"Token invlido",SMForm_Error_19988:"Error de Validacin",SMForm_Error_19984:"Sesin Invlida",SMForm_Error_19976:"Email o clave incorrecto/a",SMForm_Error_19958:"La solicitud de miembro est a la espera de la aprobacin por parte del dueo del sitio.",SMForm_Error_19980:"Bloqueado por el dueo del sitio"},de:{SMRegister_sign_up:"Registrieren",SMRegister_GO:"Los",SMRegister_Already_Have_User:"Ich bin bereits Mitglied",SMRegister_Login:"Anmelden",SMForm_Email:"E-Mail-Adresse",SMForm_Password:"Passwort",SMForm_Retype_Password:"Passwort erneut eingeben",SMLogin_Remember_Me:"Angemeldet bleiben",SMLogin_Forgot_Password:"Passwort vergessen?",SMLogin_Login:"Anmelden",SMLogin_Sign_UP:"Oder {0}registrieren{1}",SMResetPassMail_title:"Passwort zurcksetzen",SMResetPassMail_Back_Login:"Zurck zur Anmeldung",SMResetPassMail_Enter_Email:"Bitte geben Sie Ihre E-Mail-Adresse ein.",SMResetPassMail_confirmation_title:"Bitte prfen Sie Ihren Posteingang.",SMResetPassMail_confirmation_msg:"Wir haben Ihnen eine E-Mail mit einem Link geschickt, der es Ihnen ermglicht Ihr Passwort zurckzusetzen.",SMResetPass_Message:"Bitte fllen Sie beide Felder unten aus, um ein neues Passwort festzulegen. ",SMResetPass_New_Password:"Neues Passwort eingeben",SMResetPass_Retype_Password:"Erneut eingeben:",SMResetPass_Continue:"Fortfahren",SMResetPass_Reset_Succ:"Sie haben Ihr Passwort erfolgreich zurckgesetzt.",SMResetPass_Reset_Fail:"Passwort konnte nicht gendert werden. Probieren Sie es spter nochmal.",SMProfile_Update_Details:"Update your details",SMProfile_Update:"Update",SMApply_Success1:"Vielen Dank! Ihre Anfrage zur Mitgliederanmeldung wurde versandt und wartet auf Besttigung.",SMApply_Success2:"Der Administrator der Website wird Sie per E-Mail informieren, ( {0} ) sobald Ihre Anfrage besttigt wurde.  ",SMForm_Error_General_Err:"Serverfehler. Versuchen Sie es spter nochmal.",SMForm_Error_Password_Blank:"Passwort kann nicht leer sein.",SMForm_Error_Password_Retype:"Passwrter stimmen nicht berein.",SMForm_Error_Password_Length:"Passwortlnge muss zwischen {0} und {1} sein.",SMForm_Error_Email_Blank:"E-Mail-Adresse kann nicht leer sein.",SMForm_Error_Email_Invalid:"Ungltige E-Mail-Adresse",SMForm_Error_Non_Ascii_Chars:"Passwort darf nur ASCII-Zeichen beinhalten.",SMForm_Error_19999:"Unbekannter Nutzer",SMForm_Error_19995:"Diese E-Mail-Adresse existiert bereits.",SMForm_Error_19972:"Ungltiges Zeichen",SMForm_Error_19988:"Validierungsfehler",SMForm_Error_19984:"Ungltige Sitzung",SMForm_Error_19976:"Falsche E-Mail-Adresse oder Passwort.",SMForm_Error_19958:"Ihre Anfrage auf Mitgliedschaft wartet auf Besttigung vom Betreiber der Website.",SMForm_Error_19980:"Vom Betreiber der Website geblockt"},fr:{SMRegister_sign_up:"Inscription",SMRegister_GO:"OK",SMRegister_Already_Have_User:"J'ai dj un nom d'utilisateur",SMRegister_Login:"Connexion",SMForm_Email:"Email",SMForm_Password:"Mot de passe",SMForm_Retype_Password:"Confirmez mot de passe",SMLogin_Remember_Me:"Se Souvenir de Moi",SMLogin_Forgot_Password:"Mot de passe oubli ?",SMLogin_Login:"Connexion",SMLogin_Sign_UP:"Ou {0}Inscrivez-vous{1}",SMResetPassMail_title:"Rinitialiser Mot de Passe",SMResetPassMail_Back_Login:"Retour  Connexion",SMResetPassMail_Enter_Email:"Veuillez saisir votre adresse email",SMResetPassMail_confirmation_title:"Veuillez vrifier vos emails",SMResetPassMail_confirmation_msg:"Un email avec un lien pour rinitialiser votre mot de passe vous a t envoy",SMResetPass_Message:"Pour dfinir votre nouveau mot de passe, veuillez le saisir dans les champs ci-dessous. ",SMResetPass_New_Password:"Saisissez un nouveau mot de passe",SMResetPass_Retype_Password:"Confirmez le mot de passe :",SMResetPass_Continue:"Continuer",SMResetPass_Reset_Succ:"Vous avez rinitialis votre mot de passe avec succs ",SMResetPass_Reset_Fail:"Votre mot de passe n'a pas pu tre modifi. Veuillez ressayer ultrieurement.",SMProfile_Update_Details:"Update your details",SMProfile_Update:"Update",SMApply_Success1:"Bravo ! Votre demande de connexion membre a t envoye et est en attente d'approbation.",SMApply_Success2:"L'administrateur du site vous informera par email( {0} ) lorsque votre demande aura t approuve ",SMForm_Error_General_Err:"Erreur de serveur. Veuillez ressayer plus tard.",SMForm_Error_Password_Blank:"Veuillez saisir le mot de passe",SMForm_Error_Password_Retype:"Les mots de passe ne sont pas identiques",SMForm_Error_Password_Length:"La longueur du mot de passe doit tre entre {0} et {1}",SMForm_Error_Email_Blank:"Veuillez saisir l'Email",SMForm_Error_Email_Invalid:"Email invalide",SMForm_Error_Non_Ascii_Chars:"Le mot de passe doit contenir uniquement des caractres ASCII",SMForm_Error_19999:"Utilisateur inconnu",SMForm_Error_19995:"Cet email est dj utilis",SMForm_Error_19972:"Token invalide",SMForm_Error_19988:"Erreur Validation",SMForm_Error_19984:"Session Invalide",SMForm_Error_19976:"L' email ou le mot de passe est incorrect",SMForm_Error_19958:"Votre demande est en attente d'approbation du propritaire du site",SMForm_Error_19980:"Bloqu par le propritaire du site"},it:{SMRegister_sign_up:"Iscriviti",SMRegister_GO:"VAI",SMRegister_Already_Have_User:"Sono un utente esistente",SMRegister_Login:"Login",SMForm_Email:"Email",SMForm_Password:"Password",SMForm_Retype_Password:"Digita nuovamente la password",SMLogin_Remember_Me:"Ricordami",SMLogin_Forgot_Password:"Hai dimenticato la tua password?",SMLogin_Login:"Login",SMLogin_Sign_UP:"Oppure {0}Iscriviti{1}",SMResetPassMail_title:"Ripristina Password",SMResetPassMail_Back_Login:"Torna al Login",SMResetPassMail_Enter_Email:"Ti preghiamo di inserire il tuo indirizzo email",SMResetPassMail_confirmation_title:"Ti preghiamo di controllare la tua email",SMResetPassMail_confirmation_msg:"Ti abbiamo inviato un'email con un link che ti permetter di ripristinare la tua password",SMResetPass_Message:"Per impostare la tua nuova password, inseriscila per cortesia in entrambi i campi qui sotto. ",SMResetPass_New_Password:"Inserisci una nuova password",SMResetPass_Retype_Password:"Digita nuovamente:",SMResetPass_Continue:"Continua",SMResetPass_Reset_Succ:"Hai ripristinato con successo la tua password.",SMResetPass_Reset_Fail:"Non  stato possibile modificare la password. Prova nuovamente pi tardi.",SMProfile_Update_Details:"Update your details",SMProfile_Update:"Update",SMApply_Success1:"Successo! La tua richiesta di login membro  stata inviata ed  in attesa di approvazione.",SMApply_Success2:"L'amministratore del sito ti notificher via email( {0} ) una volta che la tua richiesta  stata accettata ",SMForm_Error_General_Err:"Errore del server. Prova nuovamente pi tardi.",SMForm_Error_Password_Blank:"Il campo Password non pu essere lasciato in bianco",SMForm_Error_Password_Retype:"Le password non sono uguali",SMForm_Error_Password_Length:"La lunghezza della password dev'essere compresa tra {0} e {1}",SMForm_Error_Email_Blank:"Il campo Email non pu essere lasciato in bianco",SMForm_Error_Email_Invalid:"L'Email non  valida",SMForm_Error_Non_Ascii_Chars:"La password deve contenere solo caratteri ASCII",SMForm_Error_19999:"Utente sconosciuto",SMForm_Error_19995:"L'Email  gi in utilizzo",SMForm_Error_19972:"Token non valido",SMForm_Error_19988:"Errore di Convalida",SMForm_Error_19984:"Sessione non valida",SMForm_Error_19976:"Email o password non corretta",SMForm_Error_19958:"La tua richiesta membro  in attesa di approvazione da parte per proprietario del sito",SMForm_Error_19980:"Bloccato dal proprietario del sito"},ja:{SMRegister_sign_up:"",SMRegister_GO:"GO",SMRegister_Already_Have_User:"",SMRegister_Login:"",SMForm_Email:"",SMForm_Password:"",SMForm_Retype_Password:"",SMLogin_Remember_Me:"",SMLogin_Forgot_Password:"",SMLogin_Login:"",SMLogin_Sign_UP:" {0}{1}",SMResetPassMail_title:"",SMResetPassMail_Back_Login:"",SMResetPassMail_Enter_Email:"",SMResetPassMail_confirmation_title:"",SMResetPassMail_confirmation_msg:"",SMResetPass_Message:"",SMResetPass_New_Password:"",SMResetPass_Retype_Password:"",SMResetPass_Continue:"",SMResetPass_Reset_Succ:"",SMResetPass_Reset_Fail:"",SMProfile_Update_Details:"Update your details",SMProfile_Update:"Update",SMApply_Success1:"",SMApply_Success2:" {0}  ",SMForm_Error_General_Err:"",SMForm_Error_Password_Blank:"",SMForm_Error_Password_Retype:"",SMForm_Error_Password_Length:"{0} {1}",SMForm_Error_Email_Blank:"",SMForm_Error_Email_Invalid:"",SMForm_Error_Non_Ascii_Chars:"ASCII",SMForm_Error_19999:"",SMForm_Error_19995:"",SMForm_Error_19972:"",SMForm_Error_19988:"",SMForm_Error_19984:"",SMForm_Error_19976:"",SMForm_Error_19958:"",SMForm_Error_19980:""},ko:{SMRegister_sign_up:"",SMRegister_GO:"",SMRegister_Already_Have_User:" ",SMRegister_Login:"",SMForm_Email:"",SMForm_Password:"",SMForm_Retype_Password:" ",SMLogin_Remember_Me:"  ",SMLogin_Forgot_Password:" ",SMLogin_Login:"",SMLogin_Sign_UP:" {0}{1}",SMResetPassMail_title:" ",SMResetPassMail_Back_Login:" ",SMResetPassMail_Enter_Email:"  .",SMResetPassMail_confirmation_title:"  .",SMResetPassMail_confirmation_msg:"    .",SMResetPass_Message:"     .",SMResetPass_New_Password:" ",SMResetPass_Retype_Password:" ",SMResetPass_Continue:"",SMResetPass_Reset_Succ:"  .",SMResetPass_Reset_Fail:"   .   .",SMProfile_Update_Details:"Update your details",SMProfile_Update:"Update",SMApply_Success1:"   !      .",SMApply_Success2:"   . ",SMForm_Error_General_Err:" .    .",SMForm_Error_Password_Blank:"   .",SMForm_Error_Password_Retype:"   .",SMForm_Error_Password_Length:" {0}  {1}  .",SMForm_Error_Email_Blank:"   .",SMForm_Error_Email_Invalid:"   .",SMForm_Error_Non_Ascii_Chars:"  ASCII  .",SMForm_Error_19999:"   .",SMForm_Error_19995:"  .",SMForm_Error_19972:"  .",SMForm_Error_19988:"  ",SMForm_Error_19984:"  .",SMForm_Error_19976:"   .",SMForm_Error_19958:"     .",SMForm_Error_19980:"   ."},pl:{SMRegister_sign_up:"Zarejestruj sie",SMRegister_GO:"START",SMRegister_Already_Have_User:"Jestem ju uytkownikiem",SMRegister_Login:"Zaloguj sie",SMForm_Email:"Email",SMForm_Password:"Haslo",SMForm_Retype_Password:"Powtrz haslo",SMLogin_Remember_Me:"Zapamietaj mnie",SMLogin_Forgot_Password:"Zapomniales hasla?",SMLogin_Login:"Login",SMLogin_Sign_UP:"Lub {0}Zarejestruj sie{1}",SMResetPassMail_title:"Zresetuj Haslo",SMResetPassMail_Back_Login:"Powrt do Loginu",SMResetPassMail_Enter_Email:"Wpisz swj adres email",SMResetPassMail_confirmation_title:"Sprawdz swj email",SMResetPassMail_confirmation_msg:"Wyslalismy email z linkiem, ktry umozliwi ci zresetowanie hasla",SMResetPass_Message:"Aby skonfigurowac twoje nowe haslo, wpisz je w obu polach ponizej. ",SMResetPass_New_Password:"Wpisz nowe haslo",SMResetPass_Retype_Password:"Wpisz ponownie:",SMResetPass_Continue:"Kontynuuj",SMResetPass_Reset_Succ:"Zresetowanie hasla powiodlo sie.",SMResetPass_Reset_Fail:"Haslo nie moglo zostac zmienione. Sprbuj ponownie pzniej.",SMProfile_Update_Details:"Update your details",SMProfile_Update:"Update",SMApply_Success1:"Sukces! Prosba o login witryny zostala wyslana i czeka na potwierdzenie.",SMApply_Success2:"Administrator powiadomi cie w emailu,( {0} ) gdy twoja prosba zostanie zatwierdzona ",SMForm_Error_General_Err:"Blad serwera. Sprbuj ponownie pzniej.",SMForm_Error_Password_Blank:"Pole Haslo nie moze byc puste",SMForm_Error_Password_Retype:"Hasla rznia sie",SMForm_Error_Password_Length:"Dlugosc hasla musi wynosic pomiedzy {0}, a {1}",SMForm_Error_Email_Blank:"Pole Email nie moze byc puste",SMForm_Error_Email_Invalid:"Nieprawidlowy Email",SMForm_Error_Non_Ascii_Chars:"Haslo moze zawierac tylko znaki ASCII",SMForm_Error_19999:"Nierozpoznany uzytkownik",SMForm_Error_19995:"Email juz istnieje",SMForm_Error_19972:"Bledny zeton",SMForm_Error_19988:"Blad Walidacji",SMForm_Error_19984:"Bledna Sesja",SMForm_Error_19976:"Niepoprawny email lub haslo",SMForm_Error_19958:"Twoja prosba o login witryny czeka na zatwierdzenie od wlasciciela witryny",SMForm_Error_19980:"Zablokowane przez wlasciciela witryny"},pt:{SMRegister_sign_up:"Registre-se",SMRegister_GO:"V",SMRegister_Already_Have_User:"J sou usurio",SMRegister_Login:"Login",SMForm_Email:"E-mail",SMForm_Password:"Senha",SMForm_Retype_Password:"Digite sua senha novamente",SMLogin_Remember_Me:"Lembre-se de Mim",SMLogin_Forgot_Password:"Esqueceu sua senha?",SMLogin_Login:"Login",SMLogin_Sign_UP:"Ou {0}Registre-se{1}",SMResetPassMail_title:"Redefinir Senha",SMResetPassMail_Back_Login:"Voltar para Login",SMResetPassMail_Enter_Email:"Por favor, insira seu endereo de e-mail",SMResetPassMail_confirmation_title:"Por favor, verifique seu e-mail",SMResetPassMail_confirmation_msg:"Enviamos um e-mail com um link que lhe permitir redefinir sua senha",SMResetPass_Message:"Para definir sua nova senha, por favor, digite-a nos dois campos abaixo: ",SMResetPass_New_Password:"Insira uma nova senha",SMResetPass_Retype_Password:"Digite novamente:",SMResetPass_Continue:"Continuar",SMResetPass_Reset_Succ:"Voc redefiniu sua senha com sucesso.",SMResetPass_Reset_Fail:"No foi possvel alterar a senha. Tente novamente mais tarde.",SMProfile_Update_Details:"Update your details",SMProfile_Update:"Update",SMApply_Success1:"Sucesso! Seu pedido de login foi enviado e aguarda aprovao.",SMApply_Success2:"O administrador do site ir enviar-lhe uma notificao via e-mail( {0} ) assim que o pedido for aprovado ",SMForm_Error_General_Err:"Erro de servidor. tente novamente mais tarde.",SMForm_Error_Password_Blank:"Campo senha no pode estar vazio",SMForm_Error_Password_Retype:"Senhas no correspondem",SMForm_Error_Password_Length:"Senha deve ter entre {0} e {1} caracteres",SMForm_Error_Email_Blank:"Campo E-mail no pode estar vazio",SMForm_Error_Email_Invalid:"E-mail invlido",SMForm_Error_Non_Ascii_Chars:"A senha deve conter apenas caracteres ASCII",SMForm_Error_19999:"Usurio desconhecido",SMForm_Error_19995:"E-mail j est sendo usado",SMForm_Error_19972:"Token Invlido",SMForm_Error_19988:"Erro de Validao",SMForm_Error_19984:"Sesso Invlida",SMForm_Error_19976:"Seu pedido de login est aguardando a aprovao do proprietrio do site",SMForm_Error_19958:"Seu pedido de login est aguardando a aprovao do proprietrio do site",SMForm_Error_19980:"Bloqueado pelo proprietrio do site"},ru:{SMRegister_sign_up:"",SMRegister_GO:"",SMRegister_Already_Have_User:"  ",SMRegister_Login:"",SMForm_Email:"Email",SMForm_Password:"",SMForm_Retype_Password:" ",SMLogin_Remember_Me:" ",SMLogin_Forgot_Password:" ?",SMLogin_Login:"",SMLogin_Sign_UP:" {0}{1}",SMResetPassMail_title:" ",SMResetPassMail_Back_Login:"  ",SMResetPassMail_Enter_Email:",   email",SMResetPassMail_confirmation_title:",   email",SMResetPassMail_confirmation_msg:"          .",SMResetPass_Message:"    .",SMResetPass_New_Password:" ",SMResetPass_Retype_Password:" :",SMResetPass_Continue:"",SMResetPass_Reset_Succ:"    .",SMResetPass_Reset_Fail:"   .  .",SMProfile_Update_Details:"Update your details",SMProfile_Update:"Update",SMApply_Success1:"!        .",SMApply_Success2:"    ( {0} ),       ",SMForm_Error_General_Err:" .  .",SMForm_Error_Password_Blank:" ",SMForm_Error_Password_Retype:"  ",SMForm_Error_Password_Length:"     {0}  {1} ",SMForm_Error_Email_Blank:" Email",SMForm_Error_Email_Invalid:" Email",SMForm_Error_Non_Ascii_Chars:"    ASCII ",SMForm_Error_19999:" ",SMForm_Error_19995:"Email  ",SMForm_Error_19972:" ",SMForm_Error_19988:" ",SMForm_Error_19984:" ",SMForm_Error_19976:" email  ",SMForm_Error_19958:"      .",SMForm_Error_19980:"  "},tr:{SMRegister_sign_up:"Kaydol",SMRegister_GO:"GIT",SMRegister_Already_Have_User:"Kullanicim bulunuyor",SMRegister_Login:"Giris",SMForm_Email:"E-posta",SMForm_Password:"Sifre",SMForm_Retype_Password:"Sifreyi yeniden yazin",SMLogin_Remember_Me:"Beni hatirla",SMLogin_Forgot_Password:"Sifrenizi unuttunuz mu?",SMLogin_Login:"Giris",SMLogin_Sign_UP:"Veya {0}Kaydolun{1}",SMResetPassMail_title:"Sifreyi Sifirla",SMResetPassMail_Back_Login:"Girie Dn",SMResetPassMail_Enter_Email:"Ltfen e-posta adresinizi girin",SMResetPassMail_confirmation_title:"Ltfen e-postanizi kontrol edin",SMResetPassMail_confirmation_msg:"Size sifrenizi sifirlamanizi saglayacak bir baglanti ieren bir e-posta gnderdik.",SMResetPass_Message:"Yeni sifrenizi belirlemek iin ltfen asagidaki iki alana da girin. ",SMResetPass_New_Password:"Yeni bir sifre girin",SMResetPass_Retype_Password:"Yeniden girin:",SMResetPass_Continue:"Devam",SMResetPass_Reset_Succ:"Sifrenizi yeniden ayarlama basarili.",SMResetPass_Reset_Fail:"Sifre degistirilemedi. Daha sonra yeniden deneyin.",SMProfile_Update_Details:"Update your details",SMProfile_Update:"Update",SMApply_Success1:"Basarili! ye girisi talebiniz gnderildi ve onay bekliyor.",SMApply_Success2:"Talebiniz onaylandiginda site yneticisi size e-posta( {0} ) yoluyla bildirecektir ",SMForm_Error_General_Err:"Sunucu hatasi. Daha sonra yeniden deneyin.",SMForm_Error_Password_Blank:"Sifre bos olamaz",SMForm_Error_Password_Retype:"Sifreler ayni degil",SMForm_Error_Password_Length:"Sifre uzunlugu {0} ile {1} arasinda olmalidir",SMForm_Error_Email_Blank:"E-posta bos olamaz",SMForm_Error_Email_Invalid:"E-posta geersiz",SMForm_Error_Non_Ascii_Chars:"Sifre sadece ASCII karakterleri iermelidir",SMForm_Error_19999:"Bilinmeyen kullanici",SMForm_Error_19995:"E-posta halihazirda kullanimda",SMForm_Error_19972:"Geersiz jeton",SMForm_Error_19988:"Dogrulama Hatasi",SMForm_Error_19984:"Geersiz Oturum",SMForm_Error_19976:"Yanlis e-posta veya sifre",SMForm_Error_19958:"yelik talebiniz site sahibinden onay bekliyor",SMForm_Error_19980:"Site sahibi tarafindan bloke edildi"}},_keys:{}}),b.methods({initialize:function(a,b,c){this.isVolatile=!0,c=c||{},this.parent(a,b,c),this._container=c.container,this._setDictionary(this._container._args.dialogsLanguage)
},onSubmit:function(){LOG.reportError(wixErrors.MISSING_METHOD,this.className,"performSubmit")},getDisplayName:function(){LOG.reportError(wixErrors.MISSING_METHOD,this.className,"getDisplayName")},getSubHeaderElement:function(){LOG.reportError(wixErrors.MISSING_METHOD,this.className,"getSubHeaderElement")},reportAuthStatusChange:function(a,b){this._container.reportAuthStatusChange(a,b)},closeAndRedirect:function(){this._container.closeAndRedirect()},onCancel:function(){},_onFormError:function(a,b){var c=this._getErrorMessage(a);b?b.setError(c):this._container.onFormError(c)},_onFormSuccess:function(a){this._container.onFormSuccess(a)},_getErrorMessage:function(a){var b=this._keys.SMForm_Error_General_Err;if(a){var c=a.errorCode;if("number"==typeof c&&0>c&&(c="SMForm_Error_"+c.toString().substring(1)),c&&this._keys[c]){b=this._keys[c];var d=a.errorParams;if(d)for(var e=d.length||0,f=0;e>f;f++)b=b.replace("{"+f+"}",d[f])}else b=this._keys.SMForm_Error_General_Err+" ("+c+")";LOG.reportError("Site Members error - "+a.errorDescription+"("+a.errorCode+")")}return b},_bindRePasswordField:function(a){return a.argObject={label:this._keys.SMForm_Retype_Password,passwordField:!0},this._bindTextDataItem(a)},_bindPasswordField:function(a){return a.argObject={label:this._keys.SMForm_Password,passwordField:!0},this._bindTextDataItem(a)},_bindEmailField:function(a){return a.argObject={label:this._keys.SMForm_Email},this._bindTextDataItem(a)},_bindTextDataItem:function(a){return a.dataItem=this.resources.W.Data.createDataItem({text:"",type:"Text"},"Text"),a},_setDictionary:function(a){this._keys=a&&this.langKeys[a]?this.langKeys[a]:this.langKeys.en}})}),define.Class("wysiwyg.viewer.components.sm.SMFormValidationHelper",function(a){var b=a;b.resources(["W.Utils"]),b.statics({PASS_MIN_LEN:4,PASS_MAX_LEN:15}),b.methods({isEmailBlank:function(a){return a?!1:!0},isEmailValid:function(a){return this.resources.W.Utils.isValidEmail(a)},isBlankPassword:function(a){return a?!1:!0},isPasswordLengthValid:function(a){return a.length<this.PASS_MIN_LEN||a.length>this.PASS_MAX_LEN?!1:!0},doPasswordsMatch:function(a,b){return a!==b?!1:!0},_isAsciiOnlyInput:function(a){for(var b=a.length,c=this.PASS_MAX_LEN,d=0;b>d&&c>d;d++)if(a.charCodeAt(d)>127)return!1;return!0}})}),define.component("wysiwyg.viewer.components.sm.SMLogin",function(a){var b=a;b.inherits("wysiwyg.viewer.components.sm.SMForm"),b.resources(["W.Data","W.SiteMembers","W.Utils"]),b.skinParts({email:{type:"wysiwyg.viewer.components.inputs.TextInput",hookMethod:"_bindEmailField"},password:{type:"wysiwyg.viewer.components.inputs.TextInput",hookMethod:"_bindPasswordField"},rememberMe:{type:"wysiwyg.viewer.components.inputs.CheckBoxInput",hookMethod:"_bindCheckBoxDataItem"},forgotPass:{type:"htmlElement"}}),b.utilize(["wysiwyg.viewer.components.sm.SMFormValidationHelper"]),b.statics({CAPTIONS:{FORGOT_PASSWORD:"Forgot your password?",LOGIN:"Login",GO:"GO",SIGN_UP:"Or {0}Sign up{1}"}}),b.methods({initialize:function(a,b,c){this.parent(a,b,c),this._formData=c&&c.formData,this._initEnteredEmail()},_initEnteredEmail:function(){this._enteredEmail=this._formData&&this._formData.enteredEmail||""},_onAllSkinPartsReady:function(){this._emailField=this._skinParts.email,this._passwordField=this._skinParts.password,this._rememberMeField=this._skinParts.rememberMe,this._forgotPasswordField=this._skinParts.forgotPass,this._forgotPasswordField.innerHTML=this._keys.SMLogin_Forgot_Password,this._forgotPasswordField.addEvent("click",function(){this._closeAndRedirectToEmailReset()}.bind(this)),this._updateEmailWithUserInput()},_updateEmailWithUserInput:function(){var a=this._emailField.getDataItem();a._data.text=this._enteredEmail,this._emailField.setDataItem(a),this._emailField._skinParts.input.value=this._enteredEmail},_closeAndRedirectToEmailReset:function(){this.resources.W.SiteMembers.openSiteMembersPopup({intent:this.INTENTS.EMAIL_RESET_PASSWORD,formData:{enteredEmail:this._getEnteredEmail()},dialogsLanguage:this._container._args.dialogsLanguage})},_getEnteredEmail:function(){return this._emailField._data.get("text")},_getInitiator:function(){return this._container._previousContainer&&this._container._previousContainer.initiator?this._container._previousContainer.initiator:this._container._args.initiator},onSubmit:function(){var a=this._emailField._data.get("text"),b=this._passwordField._data.get("text"),c=this._rememberMeField._data.get("value");if(this._validateFields(a,b)){var d=this._getInitiator();this.resources.W.SiteMembers.login(a,b,c,this._onFormSuccess,this._onFormError,d)}},_resetFieldsValidationState:function(){this._passwordField.setValidationState(!0),this._emailField.setValidationState(!0)},_validateFields:function(a,b){var c=new this.imports.SMFormValidationHelper,d=this._validateEmail(c,a),e=this._validatePassword(c,b);return d&&e},_validateEmail:function(a,b){return a.isEmailBlank(b)?(this._displayErrorOn(this._emailField,"SMForm_Error_Email_Blank"),!1):a.isEmailValid(b)?!0:(this._displayErrorOn(this._emailField,"SMForm_Error_Email_Invalid"),!1)},_validatePassword:function(a,b){return a.isBlankPassword(b)?(this._displayErrorOn(this._passwordField,"SMForm_Error_Password_Blank"),!1):a.isPasswordLengthValid(b)?!0:(this._displayErrorOn(this._passwordField,"SMForm_Error_Password_Length",[this.PASS_MIN_LEN,this.PASS_MAX_LEN]),!1)},_displayErrorOn:function(a,b,c){a.setValidationState(!1),this._onFormError({errorCode:b,errorParams:c},a)},_onFormSuccess:function(a){var b=this._removeResetForgotPasswordParameterIfExists();this._container.closeAndRedirectTo(b),LOG.reportEvent(wixEvents.WEBMASTER_LOGIN_SUCCESS,{c1:a.attributes.name})},_removeResetForgotPasswordParameterIfExists:function(){var a=window.location.href;return a.indexOf(this.resources.W.SiteMembers.RESET_PASSWORD_KEY_PARAMETER)>=0?this._removeParameterFromUrl(a,this.resources.W.SiteMembers.RESET_PASSWORD_KEY_PARAMETER):a},_removeParameterFromUrl:function(a,b){if(a&&b){var c=a.indexOf(b);if(c>=0){var d=a.substr(c).indexOf("&");return 0>d&&(d=a.length),a.slice(0,c)+a.slice(c+d+"&".length)}}return a},onCancel:function(){this.reportAuthStatusChange(!1,{cancel:!0})},getDisplayName:function(){return this._keys.SMLogin_Login},getButtonLabel:function(){return this._keys.SMRegister_GO},getSubHeaderElement:function(){var a=new Element("DIV"),b=this._keys.SMLogin_Sign_UP;return b=this._formatString(b,["<a>","</a>"]),a.set("html",b),{el:a,intent:this.INTENTS.REGISTER}},_formatString:function(a,b){var c=0;return b.map(function(b){var d="{"+c+"}";a=a.replace(d,b),c++}),a},_bindCheckBoxDataItem:function(a){return a.dataItem=this.resources.W.Data.createDataItem({value:"false",type:"Boolean"},"Boolean"),a.dataItem.setMeta("isPersistent",!1),a.argObject={label:this._keys.SMLogin_Remember_Me},a}})}),define.component("wysiwyg.viewer.components.sm.SMProfile",function(a){var b=a;b.inherits("wysiwyg.viewer.components.sm.SMForm"),b.resources(["W.SiteMembers"]),b.skinParts({name:{type:"wysiwyg.viewer.components.inputs.TextInput",hookMethod:"_bindTextDataItem"}}),b.methods({_onAllSkinPartsReady:function(){this._emailField=this._skinParts.email,this._nameField=this._skinParts.name},onSubmit:function(){var a=this._nameField._data.get("text");this._validateFields(a)&&this.resources.W.SiteMembers.updateMemberDetails({name:a},this._onFormSuccess,this._onFormError)},_validateFields:function(){return!0},onCancel:function(){this.fireEvent("cancel")},getDisplayName:function(){return this._keys.SMProfile_Update_Details},getButtonLabel:function(){return this._keys.SMProfile_Update},getSubHeaderElement:function(){var a=new Element("DIV");return{el:a}}})}),define.component("wysiwyg.viewer.components.sm.SMRegister",function(a){var b=a;b.inherits("wysiwyg.viewer.components.sm.SMForm"),b.resources(["W.SiteMembers","W.Utils"]),b.utilize(["wysiwyg.viewer.components.sm.SMFormValidationHelper"]),b.skinParts({email:{type:"wysiwyg.viewer.components.inputs.TextInput",hookMethod:"_bindEmailField"},password:{type:"wysiwyg.viewer.components.inputs.TextInput",hookMethod:"_bindPasswordField"},re_password:{type:"wysiwyg.viewer.components.inputs.TextInput",hookMethod:"_bindRePasswordField"}}),b.methods({_onAllSkinPartsReady:function(){this._emailField=this._skinParts.email,this._passwordField=this._skinParts.password,this._rePasswordField=this._skinParts.re_password},_getEmailInputText:function(){return this._emailField._data.get("text")},_getPasswordInputText:function(){return this._passwordField._data.get("text")},_getRetypedPasswordInputText:function(){return this._rePasswordField._data.get("text")},_validateFields:function(a,b,c){var d=new this.imports.SMFormValidationHelper,e=this._validateEmail(d,a),f=this._validatePassword(d,b,c);return e&&f},_validateEmail:function(a,b){return a.isEmailBlank(b)?(this._displayErrorOn(this._emailField,"SMForm_Error_Email_Blank"),!1):a.isEmailValid(b)?!0:(this._displayErrorOn(this._emailField,"SMForm_Error_Email_Invalid"),!1)},_validatePassword:function(a,b,c){return a.isBlankPassword(b)?(this._displayErrorOn(this._passwordField,"SMForm_Error_Password_Blank"),!1):a._isAsciiOnlyInput(b)?a.isPasswordLengthValid(b)?a.doPasswordsMatch(b,c)?!0:(this._displayErrorOn(this._rePasswordField,"SMForm_Error_Password_Retype"),!1):(this._displayErrorOn(this._passwordField,"SMForm_Error_Password_Length",[this.PASS_MIN_LEN,this.PASS_MAX_LEN]),!1):(this._displayErrorOn(this._passwordField,"SMForm_Error_Non_Ascii_Chars"),!1)},_displayErrorOn:function(a,b,c){a.setValidationState(!1),this._onFormError({errorCode:b,errorParams:c},a)},_onFormSuccess:function(){this.closeAndRedirect()},onCancel:function(){this.reportAuthStatusChange(!1,{cancel:!0})},getDisplayName:function(){return this._keys.SMRegister_sign_up},getButtonLabel:function(){return this._keys.SMRegister_GO},getSubHeaderElement:function(){var a=new Element("DIV");return a.set("html",this._keys.SMRegister_Already_Have_User+", <a>"+this._keys.SMRegister_Login+"</a>"),{el:a,intent:this.INTENTS.LOGIN}},_getInitiator:function(){return this._container._previousContainer&&this._container._previousContainer.initiator?this._container._previousContainer.initiator:this._container._args.initiator},onSubmit:function(){var a=this._emailField._data.get("text"),b=this._passwordField._data.get("text"),c=this._rePasswordField._data.get("text");if(this._validateFields(a,b,c)){b=this.resources.W.Utils.encodeValue(b);var d=this._getInitiator();d?this.resources.W.SiteMembers.register(a,b,this._onFormSuccess,this._onFormError,d):this.resources.W.SiteMembers.register(a,b,this._onFormSuccess,this._onFormError)}}})}),define.component("wysiwyg.viewer.components.sm.SMResetPassword",function(a){var b=a;b.inherits("wysiwyg.viewer.components.sm.SMForm"),b.binds(["_onSuccessfulReset","_onFailedReset"]),b.resources(["W.SiteMembers"]),b.skinParts({formMessage:{type:"htmlElement"},password:{type:"wysiwyg.viewer.components.inputs.TextInput",hookMethod:"_bindNewPasswordField"},passwordRetype:{type:"wysiwyg.viewer.components.inputs.TextInput",hookMethod:"_bindPasswordRetypeField"}}),b.statics({CAPTIONS:{RESET_PASSWORD_MESSAGE:"To set your new password, please enter it in both fields below. ",ENTER_NEW_PASSWORD:"Enter a new password:",RETYPE_PASSWORD:"Type again:",FORM_TITLE:"Reset Password",SUBMIT_BUTTON_LABEL:"GO",CONFIRMATION_BUTTON_CAPTION:"Continue"},MESSAGES:{RESET_SUCCESS:"Youve successfully reset your password.",RESET_FAILED:"Password could not have been changed. Try again later."}}),b.methods({_onAllSkinPartsReady:function(){this._formMessage=this._skinParts.formMessage,this._password=this._skinParts.password,this._passwordRetype=this._skinParts.passwordRetype,this._formMessage.innerText=this._keys.SMResetPass_Message},onSubmit:function(){this._password.setValidationState(!0),this._passwordRetype.setValidationState(!0);var a=this._getPasswordText();this._validatePasswordAndReportError(a)?this._doPasswordsMatch()?this._resetPassword():this._passwordRetype.setValidationState(!1):this._password.setValidationState(!1)},_resetPassword:function(){var a=this._getPasswordText(),b=this.resources.W.SiteMembers;b.resetPassword(a,this._onSuccessfulReset,this._onFailedReset)},_getCurrentSearchURL:function(){return window.location.search},_onSuccessfulReset:function(){this._container._setConfirmationOkCaption(this._keys.SMResetPass_Continue),this._container.showConfirmation({message:this._keys.SMResetPass_Reset_Succ},this._closeAndRedirectToLogin(),!1)},_closeAndRedirectToLogin:function(){var a=this;return function(){a.resources.W.SiteMembers.openSiteMembersPopup({intent:a.INTENTS.LOGIN})}},_onFailedReset:function(){this._container.showConfirmation(this._keys.SMResetPass_Reset_Fail,this._closeSMContainer)},_validatePasswordAndReportError:function(a){return this._isPasswordBlank(a)?(this._onFormError({errorCode:"SMForm_Error_Password_Blank"},this._password),!1):this._isPasswordLengthValid(a)?!0:(this._onFormError({errorCode:"SMForm_Error_Password_Length",errorParams:[this.PASS_MIN_LEN,this.PASS_MAX_LEN]},this._password),!1)},_isPasswordBlank:function(a){return null===a||void 0===a||""===a?!0:!1},_isPasswordLengthValid:function(a){return a.length<this.PASS_MIN_LEN||a.length>this.PASS_MAX_LEN?!1:!0},_doPasswordsMatch:function(){var a=this._getPasswordText(),b=this._getRetypedPasswordText();return a!==b?(this._onFormError({errorCode:"SMForm_Error_Password_Retype"},this._passwordRetype),!1):!0},_getPasswordText:function(){return this._password._data.get("text")},_getRetypedPasswordText:function(){return this._passwordRetype._data.get("text")},onCancel:function(){this.reportAuthStatusChange(!1,{cancel:!0})},getDisplayName:function(){return this._keys.SMResetPassMail_title},getButtonLabel:function(){return this._keys.SMRegister_GO},getSubHeaderElement:function(){return null},_bindNewPasswordField:function(a){return this._bindPasswordField(a,this._keys.SMResetPass_New_Password)},_bindPasswordRetypeField:function(a){return this._bindPasswordField(a,this._keys.SMResetPass_Retype_Password)},_bindPasswordField:function(a,b){return a.argObject={label:b,passwordField:!0},this._bindTextDataItem(a)}})}),define.component("wysiwyg.viewer.components.sm.SMResetPasswordEmail",function(a){var b=a;b.inherits("wysiwyg.viewer.components.sm.SMForm"),b.resources(["W.Data","W.SiteMembers","W.Utils"]),b.statics({CAPTIONS:{FORM_TITLE:"Reset Password",SUBMIT_BUTTON_LABEL:"GO",BACK_TO_LOGIN:"Back to Login",EMAIL_TITLE:"Please enter your email address",CONFIRMATION_TITLE:"Please check your email",CONFIRMATION_MSG:"Weve sent you an email with a link that will allow you to reset your password"}}),b.skinParts({email:{type:"wysiwyg.viewer.components.inputs.TextInput",hookMethod:"_bindEmailField"}}),b.methods({initialize:function(a,b,c){this.parent(a,b,c),this._enteredEmail=c&&c.formData&&c.formData.enteredEmail||""},_onAllSkinPartsReady:function(){this._email=this._skinParts.email,this._updateEmailWithUserInput()},_updateEmailWithUserInput:function(){var a=this._email.getDataItem();a._data.text=this._enteredEmail,this._email.setDataItem(a),this._email._skinParts.input.value=this._enteredEmail},_getEmailInput:function(){return this._email._data.get("text")},onSubmit:function(){var a=this._getEmailInput();if(this._isEmailFieldValid(a)){var b=this.resources.W.SiteMembers;b.sendUserPasswordResetEmail(a,this._onFormSuccess,this._onFormError)}},_isEmailFieldValid:function(a){return this._email.setValidationState(!0),a?this.resources.W.Utils.isValidEmail(a)?!0:(this._email.setValidationState(!1),this._onFormError({errorCode:"SMForm_Error_Email_Invalid"},this._email),!1):(this._email.setValidationState(!1),this._onFormError({errorCode:"SMForm_Error_Email_Blank"},this._email),!1)},_bindEmailField:function(a){return a.argObject={label:this._keys.SMResetPassMail_Enter_Email},this._bindTextDataItem(a)},_onFormSuccess:function(){this._closeAndRedirectToConfirmationDialog()},_closeAndRedirectToConfirmationDialog:function(){this._container.showConfirmation({title:this._keys.SMResetPassMail_confirmation_title,message:this._keys.SMResetPassMail_confirmation_msg},this._closeSMContainer)},onCancel:function(){this.reportAuthStatusChange(!1,{cancel:!0})},getDisplayName:function(){return this._keys.SMResetPassMail_title},getButtonLabel:function(){return this._keys.SMRegister_GO},getSubHeaderElement:function(){var a=new Element("DIV"),b=this._keys.SMResetPassMail_Back_Login;return a.set("html","<a>"+b+"</a>"),{el:a,intent:this.INTENTS.LOGIN,formData:{enteredEmail:function(){this._email._data.get("text")}.bind(this)}}}})}),define.Class("wysiwyg.viewer.components.svgshape.SvgCircleScaler",function(a){var b=a;b.traits(["wysiwyg.viewer.components.svgshape.traits.SvgShapeCommonScalers"]),b.methods({initialize:function(a){this.circleElement=a},scale:function(a,b){var c=this.circleElement.getAttribute("cx"),d=this.circleElement.getAttribute("cy"),e=this.circleElement.getAttribute("r"),f=Math.min(a,b);c&&d&&(this.circleElement.setAttribute("cx",this._scaleSingleValue(c,f)),this.circleElement.setAttribute("cy",this._scaleSingleValue(d,f)),this.circleElement.setAttribute("r",this._scaleSingleValue(e,f)))}})}),define.Class("wysiwyg.viewer.components.svgshape.SvgEllipseScaler",function(a){var b=a;b.traits(["wysiwyg.viewer.components.svgshape.traits.SvgShapeCommonScalers"]),b.methods({initialize:function(a){this.ellipseElement=a},scale:function(a,b){var c=this.ellipseElement.getAttribute("cx"),d=this.ellipseElement.getAttribute("cy"),e=this.ellipseElement.getAttribute("rx"),f=this.ellipseElement.getAttribute("ry");c&&e&&(this.ellipseElement.setAttribute("cx",this._scaleSingleValue(c,a)),this.ellipseElement.setAttribute("rx",this._scaleSingleValue(e,a))),d&&f&&(this.ellipseElement.setAttribute("cy",this._scaleSingleValue(d,b)),this.ellipseElement.setAttribute("ry",this._scaleSingleValue(f,b)))}})}),define.Class("wysiwyg.viewer.components.svgshape.SvgLineScaler",function(a){var b=a;b.traits(["wysiwyg.viewer.components.svgshape.traits.SvgShapeCommonScalers"]),b.methods({initialize:function(a){this.lineElement=a},scale:function(a,b){var c=this.lineElement.getAttribute("x1"),d=this.lineElement.getAttribute("y1"),e=this.lineElement.getAttribute("x2"),f=this.lineElement.getAttribute("y2");c&&d&&e&&f&&(this.lineElement.setAttribute("x1",this._scaleSingleValue(c,a)),this.lineElement.setAttribute("x2",this._scaleSingleValue(e,a)),this.lineElement.setAttribute("y1",this._scaleSingleValue(d,b)),this.lineElement.setAttribute("y2",this._scaleSingleValue(f,b)))}})}),define.Class("wysiwyg.viewer.components.svgshape.SvgPathParser",function(a){var b=a;b.traits(["wysiwyg.viewer.components.svgshape.traits.SvgShapeUtils"]),b.methods({initialize:function(a){this.pathElement=a},getParsedPath:function(){var a=this.trim(this.pathElement.getAttribute("d")),b=a.match(/[a-z][^a-z]*/gi),c=b.map(function(a){for(a=a.replace(/-/g," -").replace(/,/g," ");-1!==a.indexOf("  ");)a=a.replace(/ {2}/g," ");return[a.substring(0,1),this.trim(a.substring(1))]}.bind(this));return c.map(function(a){var b,c=[];return-1==="QSCL".indexOf(a[0].toUpperCase())||1!==a[1].split(",").length?a:(b=a[1].split(" "),b.length%2!==0?a:(b.forEach(function(a,b,d){b%2===0&&c.push(a+" "+d[b+1])}),[a[0],c.join(",")]))})},stringifyParsedPath:function(a){var b="";return a.forEach(function(a){a.forEach(function(a){b+=a})}),b}})}),define.Class("wysiwyg.viewer.components.svgshape.SvgPathScaler",function(a){var b=a;b.traits(["wysiwyg.viewer.components.svgshape.traits.SvgShapeBasicScalers","wysiwyg.viewer.components.svgshape.traits.SvgShapeCommonScalers"]),b.utilize(["wysiwyg.viewer.components.svgshape.SvgPathParser"]),b.methods({initialize:function(a){this.pathElement=a,this.parser=new this.imports.SvgPathParser(this.pathElement),this._createScalers()},_createScalers:function(){this._commandScalers={M:this._scalePairString,L:this._scaleMultiplePairStrings,H:this._scaleSingleValueHorizontal,V:this._scaleSingleValueVertical,Z:this._emptyString,C:this._scaleMultiplePairStrings,S:this._scaleMultiplePairStrings,Q:this._scaleMultiplePairStrings,T:this._scalePairString,A:this._scaleArcString}},_emptyString:function(){return""},_scaleAngleValue:function(a){return this._scaleSingleValue(a,this.scaleY/(360*this.scaleX))},_scaleArcString:function(a){var b=a.split(/[\s,]+/);if(7!==b.length)throw new Error("incorrect arc string, should have exactly 7 parameters. (value was "+a);return b[0]=this._scaleSingleValueHorizontal(b[0]),b[1]=this._scaleSingleValueVertical(b[1]),b[2]=this._scaleAngleValue(b[2]),b[5]=this._scaleSingleValueHorizontal(b[5]),b[6]=this._scaleSingleValueVertical(b[6]),b.join(" ")},scale:function(a,b){var c=this.parser.getParsedPath();this.scaleX=a,this.scaleY=b,c.forEach(function(a){a[1]=this._commandScalers[a[0].toUpperCase()].call(this,a[1])}.bind(this)),this.pathElement.setAttribute("d",this.parser.stringifyParsedPath(c))}})}),define.Class("wysiwyg.viewer.components.svgshape.SvgPolygonParser",function(a){var b=a;b.traits(["wysiwyg.viewer.components.svgshape.traits.SvgShapeUtils"]),b.methods({initialize:function(a){this.polygonElement=a},getParsedPoints:function(){var a,b=this.trim(this.polygonElement.getAttribute("points")).split(/[\s,]+/),c=[];for(a=0;a<b.length;a+=2)c.push([b[a],b[a+1]]);return c},stringifyPoints:function(a){var b="";return a.forEach(function(a){b+=a.join(",")+" "}),this.trim(b)}})}),define.Class("wysiwyg.viewer.components.svgshape.SvgPolygonScaler",function(a){var b=a;b.traits(["wysiwyg.viewer.components.svgshape.traits.SvgShapeCommonScalers"]),b.utilize(["wysiwyg.viewer.components.svgshape.SvgPolygonParser"]),b.methods({initialize:function(a){this.polygonElement=a,this.parser=new this.imports.SvgPolygonParser(this.polygonElement)},scale:function(a,b){var c=this.parser.getParsedPoints();c.forEach(function(c){c[0]=this._scaleSingleValue(c[0],a),c[1]=this._scaleSingleValue(c[1],b)}.bind(this)),this.polygonElement.setAttribute("points",this.parser.stringifyPoints(c))}})}),define.Class("wysiwyg.viewer.components.svgshape.SvgPolylineParser",function(a){var b=a;b.traits(["wysiwyg.viewer.components.svgshape.traits.SvgShapeUtils"]),b.methods({initialize:function(a){this.polylineElement=a},getParsedPolyline:function(){var a=this.trim(this.polylineElement.getAttribute("points")),b=a.replace(/ /gi,",").split(","),c=[];return b.forEach(function(a,b,d){b%2===0&&c.push(a+" "+d[b+1])}),c},stringifyParsedPolyline:function(a){return a.join(",")}})}),define.Class("wysiwyg.viewer.components.svgshape.SvgPolylineScaler",function(a){var b=a;b.traits(["wysiwyg.viewer.components.svgshape.traits.SvgShapeBasicScalers","wysiwyg.viewer.components.svgshape.traits.SvgShapeCommonScalers"]),b.utilize(["wysiwyg.viewer.components.svgshape.SvgPolylineParser"]),b.methods({initialize:function(a){this.polylineElement=a,this.parser=new this.imports.SvgPolylineParser(this.polylineElement)},scale:function(a,b){var c=this.parser.stringifyParsedPolyline(this.parser.getParsedPolyline());this.scaleX=a,this.scaleY=b,this.polylineElement.setAttribute("points",this._scaleMultiplePairStrings(c))}})}),define.Class("wysiwyg.viewer.components.svgshape.SvgRectScaler",function(a){var b=a;b.traits(["wysiwyg.viewer.components.svgshape.traits.SvgShapeCommonScalers"]),b.methods({initialize:function(a){this.rectElement=a,this._resetRectOrigin()},_resetRectOrigin:function(){this.rectElement.setAttribute("x","0"),this.rectElement.setAttribute("y","0")},_scaleAttribute:function(a,b,c){b&&this.rectElement.setAttribute(a,this._scaleSingleValue(b,c))},scale:function(a,b){var c=this.rectElement.getAttribute("width"),d=this.rectElement.getAttribute("height"),e=this.rectElement.getAttribute("rx"),f=this.rectElement.getAttribute("ry");this._scaleAttribute("width",c,a),this._scaleAttribute("height",d,b),this._scaleAttribute("rx",e,a),this._scaleAttribute("ry",f,b)}})}),define.Class("wysiwyg.viewer.components.svgshape.SvgScaler",function(a){var b=a;b.utilize(["wysiwyg.viewer.components.svgshape.SvgPathScaler","wysiwyg.viewer.components.svgshape.SvgPolygonScaler","wysiwyg.viewer.components.svgshape.SvgRectScaler","wysiwyg.viewer.components.svgshape.SvgCircleScaler","wysiwyg.viewer.components.svgshape.SvgEllipseScaler","wysiwyg.viewer.components.svgshape.SvgPolylineScaler","wysiwyg.viewer.components.svgshape.SvgLineScaler"]),b.methods({initialize:function(a){this.svgElement=a,this._setGroupElement(),this._initializeScalers()},_setGroupElement:function(){if(this.groupElement=_(this.svgElement.childNodes).find(function(a){return"g"===a.nodeName}),!this.groupElement)throw new Error("Shape component skin must contain a single <g> element wrapping all other svg contents.")},_initializeScalers:function(){this.scalers=[],_(this.groupElement.childNodes).forEach(function(a){this._isValidSvgElement(a.nodeName)&&this.scalers.push(this._createScaler(a))}.bind(this))},_isValidSvgElement:function(a){return _(["path","polygon","rect","circle","ellipse","polyline","line"]).contains(a.toLowerCase())},_createScaler:function(a){var b=a.nodeName.toLowerCase();switch(b){case"path":return new this.imports.SvgPathScaler(a);case"polygon":return new this.imports.SvgPolygonScaler(a);case"rect":return new this.imports.SvgRectScaler(a);case"circle":return new this.imports.SvgCircleScaler(a);case"ellipse":return new this.imports.SvgEllipseScaler(a);case"polyline":return new this.imports.SvgPolylineScaler(a);case"line":return new this.imports.SvgLineScaler(a);default:throw new Error("Can't create a scaler for \""+b+'" element, because it is not implemented.')}},getActualDimensions:function(){var a;try{a=this.groupElement.getBBox()}catch(b){a={width:0,height:0,x:0,y:0}}return{width:Math.round(a.width),height:Math.round(a.height),x:Math.round(a.x),y:Math.round(a.y)}},translateShapePosition:function(a){var b=this.getActualDimensions();this.groupElement.setAttribute("transform","translate("+parseFloat(-1*b.x+.5*a)+","+parseFloat(-1*b.y+.5*a)+")")},scale:function(a,b){this.scalers.forEach(function(c){c.scale(a,b)})},setAspectRatio:function(a){a.height&&a.width&&(this.aspectRatio=a.width/a.height)},getOriginalAspectRatio:function(){return this.aspectRatio}})}),define.component("wysiwyg.viewer.components.svgshape.SvgShape",function(a){var b=a;b.inherits("core.components.base.BaseComp"),b.traits(["wysiwyg.viewer.components.svgshape.traits.SvgShapeUtils"]),b.resources(["W.Skins","W.Theme"]),b.utilize(["wysiwyg.viewer.components.svgshape.SvgScaler"]),b.propertiesSchemaType("SvgShapeProperties"),b.binds(["_mediaGalleryCallback"]),b.fields({EDITOR_META_DATA:{general:{settings:!0,design:!1},custom:[{label:"SVGSHAPE_SELECT_SKIN",command:"WEditorCommands.OpenMediaFrame",commandParameter:{publicMediaFile:"shapes",i18nPrefix:"shape",selectionType:"single",callback:"_mediaGalleryCallback",hasPrivateMedia:!1}}],dblClick:{command:"WEditorCommands.OpenMediaFrame",commandParameter:{publicMediaFile:"shapes",i18nPrefix:"shape",selectionType:"single",callback:"_mediaGalleryCallback",hasPrivateMedia:!1}}}}),b.methods({initialize:function(a,b,c){this.parent(a,b,c),this._rotatable=!0},isRenderNeeded:function(a){var b=[this.INVALIDATIONS.DISPLAY,this.INVALIDATIONS.STYLE_PARAM_CHANGE];return a.isInvalidated(b)||this.parent(a)},_onRender:function(a){var b,c,d,e,f,g=a.data.invalidations,h=g.isInvalidated([this.INVALIDATIONS.SKIN_CHANGE]),i=g.isInvalidated([this.INVALIDATIONS.STYLE_PARAM_CHANGE]),j=g.isInvalidated([this.INVALIDATIONS.FIRST_RENDER]);this._initializeScaler(h),b=this.svgScaler.getActualDimensions(),b.width&&b.height&&(this.svgScaler.aspectRatio||this.svgScaler.setAspectRatio(b),c=parseFloat(this.getSkin().getParamValue("strokewidth")._amount),(i||h||j)&&(f=this.svgScaler.getOriginalAspectRatio(),f>1?(d=c+1,e=d*f):(e=c+1,d=e/f),this.setMinW(e),this.setMinH(d)),this.scaleSvgElementSize(b),this.scaleSvgContents(b,c),this.svgScaler.translateShapePosition(c))},scaleSvgElementSize:function(a){var b,c,d={width:parseFloat(this.$view.style.minWidth),height:parseFloat(this.$view.style.minHeight)};this.getComponentProperty("maintainAspectRatio")?(b=this.calculateScale(a,d),c={width:Math.ceil(a.width*b.scaleX),height:Math.ceil(a.height*b.scaleY)}):c=d,this.svgScaler.svgElement.style.width=c.width+"px",this.svgScaler.svgElement.style.height=c.height+"px"},scaleSvgContents:function(a,b){var c={width:parseFloat(this.$view.style.minWidth)-b,height:parseFloat(this.$view.style.minHeight)-b},d=this.calculateScale(a,c);this.svgScaler.scale(d.scaleX,d.scaleY)},calculateScale:function(a,b){var c,d,e=this.getComponentProperty("maintainAspectRatio"),f=this.svgScaler.getOriginalAspectRatio(),g=b.width/b.height;return c=a.width?e&&g>f?b.height*f/a.width:b.width/a.width:1,d=a.height?e&&f>g?b.width/f/a.height:b.height/a.height:1,{scaleX:this.round(c),scaleY:this.round(d)}},_initializeScaler:function(a){(!this.svgElement||a)&&(this.svgElement=this.$view.getElementsByTagName("svg")[0]),(!this.svgScaler||a)&&(this.svgScaler=new this.imports.SvgScaler(this.svgElement))},_setSkin:function(a){var b=this.resources.W,c=this.getStyle().getDataItem().get("id"),d=Q.defer();return b.Skins.getSkin(a,function(a){var e=b.Theme._styleCache[c];e&&e.setSkin(a),d.resolve(a)}),d.promise},_getSkinNameFromFileName:function(a){var b=/^shapes\/([a-z0-9]{32})_svgshape\.(v\d)\.([A-Z][A-Za-z0-9_]*)\.js$/i,c=b.exec(a),d=c[1],e=c[2],f=c[3];return["svgshape",e,"svg_"+d,f].join(".")},_mediaGalleryCallback:function(a){return a.fileName&&-1!==a.fileName.indexOf("_svgshape.v1.")&&a.fileName.lastIndexOf(".js")===a.fileName.length-3?(this._setSkin(this._getSkinNameFromFileName(a.fileName)).then(function(){window.parent.W.Commands.executeCommand("WEditorCommands.UpdateEditedComponentPanel",{})}),void 0):(console.log("invalid shape data received from media gallery: ",a),void 0)}})}),define.Class("wysiwyg.viewer.components.svgshape.traits.SvgShapeBasicScalers",function(a){var b=a;b.methods({_scaleSingleValueHorizontal:function(a){return this._scaleSingleValue(a,this.scaleX)},_scaleSingleValueVertical:function(a){return this._scaleSingleValue(a,this.scaleY)},_scalePairString:function(a){var b=a.split(/[\s,]+/);return this._scaleSingleValueHorizontal(b[0])+" "+this._scaleSingleValueVertical(b[1])},_scaleMultiplePairStrings:function(a){var b=a.split(",").map(function(a){return this._scalePairString(this.trim(a))}.bind(this));return b.join(",")}})}),define.Class("wysiwyg.viewer.components.svgshape.traits.SvgShapeCommonScalers",function(a){var b=a;b.traits(["wysiwyg.viewer.components.svgshape.traits.SvgShapeUtils"]),b.methods({_scaleSingleValue:function(a,b){return this.round(parseFloat(a)*b)}})}),define.Class("wysiwyg.viewer.components.svgshape.traits.SvgShapeUtils",function(a){var b=a;b.methods({trim:function(a){return a.replace(/^\s+|\s+$/g,"")},round:function(a){return Math.round(1e6*a)/1e6}})}),define.Class("wysiwyg.viewer.components.traits.ContactFormUtils",function(a){var b=a;b.resources(["W.Config"]),b.methods({getMsgTemplate:function(a,b){var c=["January","February","March","April","May","June","July","August","September","October","November","December"],d=new Date,e="",f='<li style="list-style: none; margin: 0 0 5px 0; padding: 0;"><b>{{key}}</b> {{val}}</li>',g='<ul style="list-style: none; margin: 0; padding: 0;"><li style="list-style: none; margin: 0 0 5px 0; padding: 0;"><b>{{ttl}}</b></li><li style="list-style: none; margin: 0 0 15px 0; padding: 0;">{{ttl_via}} '+window.location.protocol+"//"+window.location.hostname+window.location.pathname+'</li><li style="list-style: none; margin: 0 0 5px 0; padding: 0;"><b>{{ttl_details}}</b></li><li style="list-style: none; margin: 0 0 25px 0; padding: 0;"><ul  style="margin: 0 0 0 20px; padding: 0;">{{fields}}</ul></li><li style="list-style: none; margin: 0 0 15px 0; padding: 0;"><b>{{ttl_date}}</b> '+d.getDate()+" "+c[d.getMonth()]+", "+d.getFullYear()+'</li><li style="list-style: none; margin: 0; padding: 0;">{{tnx}}</li></ul>';return _.each(a,function(a,b){var c;c=b&&!/^default_/.test(b)?b+" : ":"",e+=f.replace("{{key}}",c).replace("{{val}}",a)}),g.replace("{{fields}}",e).replace("{{ttl}}",b.msg_title).replace("{{ttl_via}}",b.msg_via).replace("{{ttl_details}}",b.msg_details).replace("{{ttl_date}}",b.msg_date).replace("{{tnx}}",b.msg_tnx)
},getMailServerUrl:function(){var a=this.resources.W.Config.env.$isEditorViewerFrame,b=window.location.protocol+"//"+window.location.hostname,c="/_api/common-services/notification/invoke",d=a?W.CookiesManager.getCookie("wixSession"):"",e=a?"Secured":"",f="{{site}}{{service}}{{secured}}?accept=json&contentType=json&appUrl={{site}}{{cookie}}";return f.replace(/\{\{site\}\}/g,b).replace("{{service}}",c).replace("{{cookie}}",d).replace("{{secured}}",e)},isInput:function(a){return/(textarea|input)/.test(a.nodeName.toLowerCase())},needsValidation:function(a){return this.isInput(a)&&(a.isRequired||$(a).hasClass("required"))},getDisplayedInputs:function(a){return this.isInput(a)&&(!a.hidden||!$(a).hasClass("hidden"))},getEmptyInputs:function(a){return this.needsValidation(a)&&(!a.value.replace(/^\s+|\s+$/g,"")||$(a).hasClass("isPlaceholder"))},setLabel:function(a,b){a&&(a.set("text",b.value),b.displayed?$(a).removeClass("hidden"):$(a).addClass("hidden"))},setInput:function(a,b){var c=!b.displayed,d=b.displayed&&b.required;return a.hidden=c,a.isRequired=d,a.name=b.value,c?$(a).addClass("hidden"):$(a).removeClass("hidden"),d?$(a).addClass("required"):$(a).removeClass("required"),this.hasPlaceholder()&&($(a).setAttribute("placeholder",b.value),this.needsPoly())?(this.setPHPoly($(a)),$(a).value=b.value,void 0):($(a).addEvent("focus",function(){$(this).removeClass("error")}),void 0)},hasPlaceholder:function(){return!this._skin.hidePlaceholders},preFormatFields:function(){var a=_.pick(this._skinParts,this.getDisplayedInputs,this);return{forSend:_.transform(a,function(a,b){var c=b.name?b.name:"default_"+b.getAttribute("skinpart");a[c]=$(b).hasClass("isPlaceholder")?"":b.value}),forReport:_.transform(a,function(a,b,c){a[c]=b.value})}},needsPoly:function(){return!window.Modernizr.input.placeholder},setPHPoly:function(a){var b=a.value,c=a.getAttribute("placeholder");b&&b!==c||(a.value=c,a.addClass("isPlaceholder")),a.addEvent("focus",function(){$(this).removeClass("error"),$(this).hasClass("isPlaceholder")&&($(this).value="",$(this).removeClass("isPlaceholder"))},!1),a.addEvent("blur",function(){var a=$(this).value,b=$(this).getAttribute("placeholder");a&&a!==b?$(this).removeClass("isPlaceholder"):($(this).value=b,$(this).addClass("isPlaceholder"))},!1)}})}),define.Class("wysiwyg.viewer.components.traits.CustomPreviewBehavior",function(a){var b=a;b.resources(["W.Config","W.Commands"]),b.methods({_isPreviewMode:function(){return this.resources.W.Config.env.$isEditorViewerFrame},_overlayElementExists:function(){return!!this._overlayElement},_createOverlayElement:function(){this._overlayElement=new Element("A")},_createOverlayElementStyles:function(){var a=this.resources.W.Config.getServiceTopologyProperty("staticThemeUrlWeb")+"/transparent.gif";this._overlayElement.setStyles({position:"absolute",top:"0",left:"0",height:"100%",width:"100%",background:"transparent url("+a+") repeat top left;"})},_bindOverlayElementEvents:function(){this._overlayElement.addEvent("click",function(a){a.stopPropagation(),this.resources.W.Commands.executeCommand("CustomPreviewBehavior.interact",{component:this,tooltipId:this._overlayElementTooltipId},this)}.bind(this))},_createClickOverlayForPreviewMode:function(a){this._isPreviewMode()&&(this._overlayElementTooltipId=a,this._overlayElementExists()||(this._createOverlayElement(),this._createOverlayElementStyles(),this._bindOverlayElementEvents(),this.getViewNode().adopt(this._overlayElement)))}})}),define.Class("wysiwyg.viewer.components.traits.FixedComponentTrait",function(a){var b=a;b.resources(["W.Config","W.Commands"]),b.binds(["_updateLayoutOnRender"]),b.methods({initialize:function(a,b,c){this.parent(a,b,c);var d=this.getLayoutPosition();this.setPos(d),this.resources.W.Config.env.isPublicViewer()||this.resources.W.Config.env.$isEditorlessPreview?this.applyPos():(this._listenToEditModeChanged(),this.addEvent(Constants.ComponentEvents.RENDER,this._updateLayoutOnRender))},_updateLayoutOnRender:function(){this.removeEvent(Constants.ComponentEvents.RENDER,this._updateLayoutOnRender),this.shouldBeFixedPosition()||this.applyPos("absolute")},_listenToEditModeChanged:function(){this.resources.W.Commands.registerCommandAndListener("WPreviewCommands.WEditModeChanged",this,this._toggleFixedPositionByEditMode)},_toggleFixedPositionByEditMode:function(){this.shouldBeFixedPosition()?this.applyPos():this.applyPos("absolute")},shouldBeFixedPosition:function(){return this.isFixedPositioned()&&this.resources.W.Config.env.isInInteractiveViewer()},canBeFixedPosition:function(){return!0}})}),define.Class("wysiwyg.viewer.components.traits.GalleryAutoplay",function(a){var b=a;b.binds(["_onComponentReady","_onMouseDown","_autoplayCallback","_onTransitionFinished","_onModeChange","_onMediaZoomClosed","_onMediaZoomOpened","_getDirection","_onComponentDisposed"]),b.fields({_autoplayOn:!1,_timeoutID:null,_suppressAutoplay:!1}),b.resources(["W.Viewer","W.Commands","W.Config"]),b.methods({initialize:function(){this.addEvent(Constants.ComponentEvents.RENDER,this._onComponentRender),this.addEvent(Constants.ComponentEvents.READY,this._onComponentReady),W.Config.env.isInDeactivatedViewer()&&(this._suppressAutoplay=!0),this.resources.W.Commands.registerCommandListenerByName("WPreviewCommands.WEditModeChanged",this,this._onModeChange),this.resources.W.Commands.registerCommandListenerByName("WViewerCommands.MediaZoom.Close",this,this._onMediaZoomClosed),this.resources.W.Commands.registerCommandListenerByName("WViewerCommands.OpenZoom",this,this._onMediaZoomOpened),this.addEvent(Constants.ComponentEvents.DISPOSED,this._onComponentDisposed)},_onComponentReady:function(){this._autoplayOn=this.getComponentProperty("autoplay")===!0,this._updateAutoplayState()},_onComponentRender:function(){this._properties.on(Constants.DataEvents.DATA_CHANGED,this,this._onPropertyChanged),this.addEvent("transitionFinished",this._onTransitionFinished),this._skinParts.autoplay&&(this._skinParts.autoplay.addEvent(Constants.CoreEvents.MOUSE_DOWN,this._onMouseDown),this._skinParts.autoplay.setStyle("cursor","pointer"),this._checkAutoPlaySkinPartsVisibility())},_onModeChange:function(a){this._autoplayOn=this.getComponentProperty("autoplay")===!0,this._suppressAutoplay=!("PREVIEW"==a),this._updateAutoplayState()},_onMediaZoomOpened:function(){this._lastAutoplayState=this._autoplayOn,this._suppressAutoplay=!0,this._updateAutoplayState()},_onMediaZoomClosed:function(){this._suppressAutoplay=!1,this._autoplayOn=this._lastAutoplayState===!0,this._updateAutoplayState()},_validateHostComponent:function(){var a=this.getComponentProperties().getSchema();this._skinPartsSchema.hasOwnProperty("autoplay")||this._validationErr("Must require 'autoplay' skinPart."),a.hasOwnProperty("autoplay")||this._validationErr("Must contain 'autoplay' among the component properties."),a.hasOwnProperty("autoplayInterval")||this._validationErr("Must contain 'autoplayInterval' among the component properties."),"function"!=typeOf(this.gotoNext)&&this._validationErr("Host component must implement gotoNext() method.")},_validationErr:function(a){throw new Error("GalleryAutoplay trait's host component validation failed. "+a)},_onMouseDown:function(){this._toggleAutoplay()},_toggleAutoplay:function(){this._autoplayOn=!this._autoplayOn,this._updateAutoplayState()},_updateAutoplayState:function(){this._suppressAutoplay&&(this._autoplayOn=!1),this.setState(this._autoplayOn?"autoplayOn":"autoplayOff","slideshow"),this._startAutoplayTimer()},_getAutoplayInterval:function(){var a=parseFloat(this.getComponentProperty("autoplayInterval")),b=(parseFloat(this.getComponentProperty("transDuration")),Math.floor(1e3*a));return b},_startAutoplayTimer:function(){null!=this._timeoutID&&(clearTimeout(this._timeoutID),this._timeoutID=null),this._autoplayOn&&(this._timeoutID=setTimeout(this._autoplayCallback,this._getAutoplayInterval()))},_autoplayCallback:function(){"LTR"==this._getDirection()?this.gotoPrev():this.gotoNext()},_onPropertyChanged:function(){this._autoplayOn=this.getComponentProperty("autoplay")===!0,this._updateAutoplayState(),this._checkAutoPlaySkinPartsVisibility()},_checkAutoPlaySkinPartsVisibility:function(){this._skinParts&&this._skinParts.autoplay&&this._skinParts.autoplay.setStyle("visibility",this.getComponentProperty("showAutoplay")?"visible":"hidden")},_onTransitionFinished:function(){this._startAutoplayTimer()},_getDirection:function(){return this.getComponentProperties().getData().autoPlayDirection},_onComponentDisposed:function(){clearTimeout(this._timeoutID),this._timeoutID=null,this._properties.offByListener(this)}})}),define.Class("wysiwyg.viewer.components.traits.ListIterator",function(a){var b=a;b.fields({_currentItemIndex:0,_oldItem:null,_currentItem:null,_numItems:-1,_locked:!1,_lastCommand:""}),b.methods({lock:function(){this._locked=!0},unlock:function(){this._locked=!1},isLocked:function(){return this._locked},setListAndCurrentIndex:function(a,b){this._numItems=a.get("items").length,this._currentItemIndex=b,this._onCurrentItemChanged()},resetIterator:function(){this._currentItemIndex=0,this._numItems=-1,this._locked=!1,this._lastCommand="",this._currentItem=null},_onCurrentItemChanged:function(){this._oldItem=this._currentItem,this._currentItem=this.getDataItem().getData().items[this._currentItemIndex],this.fireEvent("currentItemChanged")},gotoPrev:function(){this._locked||(this._lastCommand="prev",this._currentItemIndex=this._getPrevItemIndex(),this._onCurrentItemChanged())},gotoNext:function(){this._locked||(this._lastCommand="next",this._currentItemIndex=this._getNextItemIndex(),this._onCurrentItemChanged())},_getNextItemIndex:function(){var a=this._currentItemIndex;return a++,a>=this._numItems&&(a=0),a},_getPrevItemIndex:function(){var a=this._currentItemIndex;return a--,-1==a&&(a=this._numItems-1),a}})}),define.Class("wysiwyg.viewer.components.traits.MediaTextHandler",function(a){var b=a;b.methods({getCompPlaceholdersJsonData:function(a){var b=document.createElement("div");b.innerHTML=a;var c=$(b).getElements("*[wix-comp]");return _.map(c,function(a){return JSON.parse(a.get("wix-comp"))})},_createImagePropertiesItem:function(a){W.ComponentData.addDataItem(a,{type:"WPhotoProperties",displayMode:"fitWidth",id:a})},cleanText:function(a){var b=document.createElement("div");b.innerHTML=a;var c=$(b).getElements("*[wix-comp]");return _.forEach(c,function(a){a.destroy()}),b.innerHTML}})}),define.Class("wysiwyg.viewer.components.traits.VideoUtils",function(a){a.fields({_videoUrl:{YOUTUBE:"http://youtu.be/",VIMEO:"http://vimeo.com/"},_defualtPreviewImagePath:"images/wysiwyg/core/themes/viewer/video-error.png"}),a.resources(["W.Config"]),a.methods({_getServices:function(){var a={YOUTUBE:{url:"http://www.youtube.com/embed/",getPreviewUrl:this._getYouTubePreviewUrl,_validateImageExists:this._validateImageExists,_defualtPreviewImage:this._getDefaultPreviewImage.bind(this)},VIMEO:{url:"http://player.vimeo.com/video/",getPreviewUrl:this._getVimeoPreviewUrl,_validateImageExists:this._validateImageExists,_defualtPreviewImage:this._getDefaultPreviewImage.bind(this)}};return a},_getYouTubePreviewUrl:function(a,b,c){var d="http://img.youtube.com/vi/[repLace]/0.jpg",e=d.replace("[repLace]",a),f="http://gdata.youtube.com/feeds/api/videos/[repLace]",g=f.replace("[repLace]",a),h=c||this._defualtPreviewImage(),i=!0,j=(new Date).getTime(),k={alt:"json",callback:"youtube_preview"+j.toString(36)};return this._validateImageExists(g,k,function(){b(e,i)},function(){b(h,!i)}.bind(this)),e},_getVimeoPreviewUrl:function(a,b,c){b("82866b_e3ffa44812357aa9fe79a33c0a9b67d5.png_400");var d="http://vimeo.com/api/v2/video/[repLace].json",e=d.replace("[repLace]",a),f=c||this._defualtPreviewImage(),g=!0,h=(new Date).getTime(),i={callback:"vimeo_preview"+h.toString(36)};this._validateImageExists(e,i,function(a){b(a[0].thumbnail_large,g)},function(){b(f,!g)}.bind(this))},_getYoutubeId:function(a){var b="",c=/(?:youtube\.com\/watch[^\s]*[\?&]v=)([\w-]+)/g,d=/(?:youtu\.be\/)([\w-]+)/g,e=c.exec(a)||d.exec(a);return e&&e.length&&e[1]&&(b=e[1]),b},_getVimeoId:function(a){var b="",c=/vimeo\.com\/(\d+)$/gi,d=c.exec(a);return d&&d.length&&d[1]&&(b=d[1]),b},_getVideoDataFromVideoUrl:function(a){var b=null,c=this._getYoutubeId(a);return c?b="YOUTUBE":(c=this._getVimeoId(a),c&&(b="VIMEO")),c&&b?{videoId:c,videoType:b}:{}},_getVideoUrlFromVideoData:function(a){var b=a.videoId,c=a.videoType;return b&&c?this._videoUrl[c]+b:""},_getDefaultPreviewImage:function(){return this.resources.W.Config.getServiceTopologyProperty("staticSkinUrl")+this._defualtPreviewImagePath},_validateImageExists:function(a,b,c,d){var e=b.callback,f=0===Object.keys(b).length?"":"?"+Object.toQueryString(b),g=a+f;window[e]=function(a){c&&c(a),delete window[e]};var h=new Element("script",{src:g,type:"text/javascript",charset:"UTF-8"});h.onerror=function(){d&&d.apply(this,arguments),delete window[e]},h.inject(document.head,"bottom")}})}),define.component("wysiwyg.viewer.components.wixhomepage.HomePageLogin",function(a){var b=a;b.inherits("mobile.core.components.base.BaseComponent"),b.traits(),b.utilize(),b.binds(["_onStyleChange","_doLogout","_doLogin"]),b.skinParts({actionTitle:{type:"htmlElement"},memberTitle:{type:"htmlElement"}}),b.states(["auth","no_auth"]),b.dataTypes(["HomePageLogin"]),b.resources(["W.Config"]),b.fields({Translations:{en:{SIGN_IN:"Login/Sign up",SIGN_OUT:"Log out",HELLO:"Hello"},de:{SIGN_IN:"Anmelden/Registrieren",SIGN_OUT:"Abmelden",HELLO:"Hallo"},es:{SIGN_IN:"Login/ Regstrate",SIGN_OUT:"Cerrar Sesin",HELLO:"Hola"},fr:{SIGN_IN:"Connexion/ Inscription",SIGN_OUT:"Dconnexion",HELLO:"Bonjour"},it:{SIGN_IN:"Accedi/Registrati",SIGN_OUT:"Esci",HELLO:"Ciao"},pl:{SIGN_IN:"Zaloguj si/Zarejestruj si",SIGN_OUT:"Wyloguj si",HELLO:"Witaj"},pt:{SIGN_IN:"Login/Registre-se",SIGN_OUT:"Sair",HELLO:"Ol"},ko:{SIGN_IN:"/",SIGN_OUT:"",HELLO:"?"},ja:{SIGN_IN:"/",SIGN_OUT:"",HELLO:""},ru:{SIGN_IN:"/",SIGN_OUT:"",HELLO:""},tr:{SIGN_IN:"Giri/Kaydol",SIGN_OUT:"k",HELLO:"Merhaba"}}}),b.methods({initialize:function(a,b,c){this.parent(a,b,c),window.userApi&&(this._userApi=window.userApi)},_translate:function(a){var b="en";return this._userApi&&(b=this._userApi.getLanguage()),this.Translations[b][a]},_onStyleReady:function(){this.parent(),this._style.addEvent(Constants.StyleEvents.PROPERTY_CHANGED,this._onStyleChange)},_onStyleChange:function(){this._wCheckForSizeChangeAndFireAutoSized(10)},_onAllSkinPartsReady:function(){this._updateTextsAndEvents()},_doLogout:function(){var a=this._skinParts.actionTitle;a.removeEvent("click",arguments.callee),this.resources.W.Config.env.$isPublicViewerFrame?(this._userApi.logout(),window.location.href="http://www.wix.com"):this.injects().Commands.executeCommand("adminLogin.submitAttempt",{component:this.getViewNode()},this)},_doLogin:function(){var a=this._skinParts.actionTitle;a.removeEvent("click",arguments.callee),this.resources.W.Config.env.$isPublicViewerFrame?this._openLoginDialog():this.injects().Commands.executeCommand("adminLogin.submitAttempt",{component:this.getViewNode()},this)},_updateView:function(a,b,c){var d=this._skinParts.actionTitle,e=this._skinParts.memberTitle;d.set("text",a),e.set("text",b),d.addEvent("click",c)},_updateTextsAndEvents:function(){var a=this._userApi;a&&a.isSessionValid()?(this._updateView(this._translate("SIGN_OUT"),this._translate("HELLO")+" "+a.getUserName(),this._doLogout),this.setState("auth")):(this._updateView(this._translate("SIGN_IN"),"",this._doLogin),this.setState("no_auth"))},_openLoginDialog:function(){var a=this._data.get("postLoginUrl"),b=this._data.get("postSignUpUrl"),c=this._data.get("startWith");a||(a=location.href),b||(b=location.href),window.animateForm.callForm([b,a,c,"HTML"])}})}),define.component("wysiwyg.viewer.components.wixhomepage.LanguagesDropDown",function(a){var b=a;b.inherits("mobile.core.components.base.BaseComponent"),b.binds(["_initMenu","_populateDropDown","_updateSelection","_changeLanguage","_onFocus","_onBlur","_onOptionClick","_onKeyPress","_changeLanguageSuccess","_changeLanguageFailed"]),b.skinParts({select:{type:"htmlElement"},options:{type:"htmlElement"}}),b.states({mouse:["selected"]}),b.statics({CLASS_NAME_SELECTED:"selected",CLASS_NAME_OPTION_CONTAINER:"optionContainer"}),b.methods({initialize:function(a,b,c){this.parent(a,b,c),this._selectedOption=null,this._menuData=window.wixhomepage&&window.wixhomepage.languagesDropDownData?window.wixhomepage.languagesDropDownData:[{languageCode:"en",languageSubdomain:"www",iconURL:"",languageLabel:"English"},{languageCode:"de",languageSubdomain:"de",iconURL:"",languageLabel:"Deutsch"},{languageCode:"es",languageSubdomain:"es",iconURL:"",languageLabel:"Espaol"},{languageCode:"fr",languageSubdomain:"fr",iconURL:"",languageLabel:"Franais"},{languageCode:"it",languageSubdomain:"it",iconURL:"",languageLabel:"Italiano"},{languageCode:"pl",languageSubdomain:"pl",iconURL:"",languageLabel:"Polski"},{languageCode:"pt",languageSubdomain:"pt",iconURL:"",languageLabel:"Portugus"},{languageCode:"ru",languageSubdomain:"ru",iconURL:"",languageLabel:"P"}]},_onAllSkinPartsReady:function(){this._initMenu()},_initMenu:function(){this._populateDropDown(),this._skinParts.select.addEvent(Constants.CoreEvents.CHANGE,this._changeLanguage),this._skinParts.select.addEvent(Constants.CoreEvents.CLICK,this._onFocus),this._skinParts.options.addEvent(Constants.CoreEvents.CLICK,this._onOptionClick)},_onFocus:function(a){return a.stopPropagation(),"selected"==this.getState("mouse")?(this._onBlur(a),void 0):(this.setState("selected","mouse"),document.body.addEvent(Constants.CoreEvents.CLICK,this._onBlur),document.body.addEvent(Constants.CoreEvents.KEY_DOWN,this._onKeyPress),void 0)},_onBlur:function(a){a.stopPropagation(),this.removeState("selected","mouse"),document.body.removeEvent(Constants.CoreEvents.CLICK,this._onBlur),document.body.removeEvent(Constants.CoreEvents.KEY_DOWN,this._onKeyPress)},_onOptionClick:function(a){a=a||{};for(var b=a.target;b!==this._skinParts.options&&0==b.hasClass(this.CLASS_NAME_OPTION_CONTAINER);)b=b.parentNode;var c=b.getAttribute("data-subdomain"),d=b.getAttribute("data-languagecode"),e=this._getLanguage();this._setSelected(b),"site"==window.viewMode&&c&&d&&d!=e&&this._skinParts.select.fireEvent(Constants.CoreEvents.CHANGE,{value:c}),this._onBlur(a)},_onKeyPress:function(a){switch(a.stopPropagation(),a.key){case"up":var b=this._selectedOption.getPrevious();b||(b=this._skinParts.options.getLast()),this._setSelected(b),a.preventDefault();break;case"down":this._setSelected(this._selectedOption.getNext()),a.preventDefault();break;case"enter":case"space":a.target=this._selectedOption,this._onOptionClick(a);break;case"esc":case"tab":this._onBlur(a)}},_setSelected:function(a){var b=this._skinParts.select,c=this._skinParts.options,d=this._skinParts.options.getElement("."+this.CLASS_NAME_SELECTED);d&&d.removeClass(this.CLASS_NAME_SELECTED),a=a||this._skinParts.options.getFirst(),a.addClass(this.CLASS_NAME_SELECTED),b.setAttribute("data-subdomain",a.getAttribute("data-subdomain")),b.setAttribute("data-languagecode",a.getAttribute("data-languagecode")),b.set("html",a.get("html"));var e=a.getPosition(c).y,f=c.getScroll().y;(e>c.getSize().y+f||0>e)&&c.scrollTo(0,e),this._selectedOption=a},_populateDropDown:function(){var a,b;for(this._skinParts.select.empty(),this._skinParts.options.empty(),a=0,b=this._menuData.length;b>a;a++)this._insertOption(this._menuData[a]);this._updateSelection()},_insertOption:function(a){var b=new Element("li",{html:a.languageLabel}),c=new Element("image");b.addClass(this.CLASS_NAME_OPTION_CONTAINER),a.iconURL&&(c.setAttribute("src",a.iconURL),c.inject(b)),b.insertInto(this._skinParts.options),b.setAttribute("data-subdomain",a.languageSubdomain),b.setAttribute("data-languagecode",a.languageCode),b.addEvent(Constants.CoreEvents.CLICK,this._onOptionClick)},_getOptionBySubDomain:function(a){return this._skinParts.options.getElement('[data-subdomain="'+a+'"]')},_changeLanguageSuccess:function(){var a=this._skinParts.select.getAttribute("data-subdomain"),b=location.hostname.substring(location.hostname.indexOf(".")),c=location.protocol+"//"+a+b+location.pathname+location.search+location.hash;location.href.toLowerCase()==c.toLowerCase()?location.reload():location.href=c},_changeLanguageFailed:function(){},_changeLanguage:function(){var a=this._skinParts.select.getAttribute("data-languagecode");window.userApi?window.userApi.setLanguage(a,this._changeLanguageFailed,this._changeLanguageSuccess):LOG.reportError(wixErrors.USER_MANAGER_NOT_FOUND,"LanguagesDropDown","_changeLanguage")()},_getLanguage:function(){return window.userApi?window.userApi.getLanguage():(LOG.reportError(wixErrors.USER_MANAGER_NOT_FOUND,"LanguagesDropDown","_getLanguage")(),"en")},_updateSelection:function(){var a;a=window.userApi?window.userApi.getLanguage():"www";var b=this._getOptionBySubDomain(a);this._setSelected(b)},_removeAllDomEvents:function(){document.body.removeEvent(Constants.CoreEvents.CLICK,this._onBlur),document.body.removeEvent(Constants.CoreEvents.KEY_DOWN,this._onKeyPress)},dispose:function(){this._removeAllDomEvents(),this.parent()}})}),define.component("wysiwyg.viewer.components.wixhomepage.WixHomepageMenu",function(a){var b=a;b.inherits("mobile.core.components.base.BaseComponent"),b.binds(["_populateMenu","_getData"]),b.skinParts({buttonsContainer:{type:"htmlElement"},buttonTemplate:{type:"htmlElement"}}),b.states(["topMenu","bottomMenu"]),b.dataTypes(["WixHomepageMenu"]),b.methods({render:function(){this._getData(),this._populateMenu(),this._setMenuType()},_setMenuType:function(){var a=this._data.get("menuDataSource");this.setState(a)},_getData:function(){var a=this._data.get("menuDataSource"),b=this._getLanguage();this._menuData=window.wixhomepage&&window.wixhomepage[a]&&window.wixhomepage[a][b]?window.wixhomepage[a][b]:[{label:"Create",link:"/create/website"},{label:"Explore",link:"/sample/website"},{label:"Features",link:"/about/features"},{label:"My Account",link:"/create/my-account"},{label:"Premium",link:"/upgrade/website"},{label:"Support",link:"/support/"}]},_getLanguage:function(){return window.userApi?window.userApi.getLanguage():(LOG.reportError(wixErrors.USER_MANAGER_NOT_FOUND,"WixHomepageMenu","_getLanguage"),"en")},_insertButton:function(a){var b=this._skinParts.buttonTemplate.cloneNode(!0);b.setAttribute("isTemplate","false");var c=b.getElements(".buttonLink")[0];c.setAttribute("href",a.link),c.innerHTML=a.label,b.insertInto(this._skinParts.buttonsContainer)},_populateMenu:function(){var a;for(this._skinParts.buttonsContainer.empty(),a=0,l=this._menuData.length;l>a;a++)this._insertButton(this._menuData[a])}})}),define.component("wysiwyg.viewer.components.wixhomepage.WixOfTheDay",function(a){var b=a;b.inherits("mobile.core.components.base.BaseComponent"),b.traits(["wysiwyg.common.components.traits.LinkableComponent"]),b.utilize(["core.components.image.ImageSettings"]),b.binds(["_onCloseDescriptionClicked","_onReadOnClicked","_renderTexts","_updateContainers"]),b.skinParts({img:{type:"core.components.image.ImageNew",dataRefField:"*"},introContainer:{type:"htmlElement"},descriptionContainer:{type:"htmlElement"},introPreTitle:{type:"htmlElement"},introTitle:{type:"htmlElement"},introText:{type:"htmlElement"},shortDescriptionText:{type:"htmlElement"},descriptionText:{type:"htmlElement"},readOn:{type:"htmlElement"},closeDescription:{type:"htmlElement"}}),b.states(["opened","closed"]),b.dataTypes(["Image"]),b.fields({Translations:{en:{INTRO_PRE_TITLE:"GET INSPIRED WITH",INTRO_TITLE:"OF THE DAY",INTRO_TEXT:"Everyday we feature an amazing new website built with Wix.<br>Want your website featured?<br>Submit your URL to wixofday@wix.com",READ_ON_BUTTON_LABEL:"Read on",CLOSE_DESCRIPTION_BUTTON_LABEL:"Close"},es:{INTRO_PRE_TITLE:"Insprate con el",INTRO_TITLE:"del da!",INTRO_TEXT:"Todos los das te presentamos un increble sitio creado con Wix.<br>Quieres que tu sitio aparezca aqu?<br>Envanos tu URL a wixofday@wix.com",READ_ON_BUTTON_LABEL:"Leer Ms",CLOSE_DESCRIPTION_BUTTON_LABEL:"Cerrar"},fr:{INTRO_PRE_TITLE:"Inspirez-vous du",INTRO_TITLE:"du Jour!",INTRO_TEXT:"Nous exposons chaque jour le meilleur site cr avec Wix.<br>Vous voulez que votre site soit expos?<br>Envoyez votre URL  wixofday@wix.com",READ_ON_BUTTON_LABEL:"En lire plus",CLOSE_DESCRIPTION_BUTTON_LABEL:"Fermer"},it:{INTRO_PRE_TITLE:"Lasciati ispirare dal",INTRO_TITLE:"del giorno!",INTRO_TEXT:"Ogni giorno presentiamo un sito spettacolare creato con Wix.<br>Vuoi che anche il tuo sito venga preso in considerazione?<br>Inviaci il tuo URL a wixofday@wix.com",READ_ON_BUTTON_LABEL:"Continua a leggere",CLOSE_DESCRIPTION_BUTTON_LABEL:"Chiudi"},pl:{INTRO_PRE_TITLE:"Zainspiruj sie",INTRO_TITLE:"EM DNIA!",INTRO_TEXT:"Kazdego dnia prezentujemy nowa, niesamowita witryne zbudowana z Wix.<br>Chcesz, aby twoja witryna zostala wyrzniona?<br>Przeslij jej adres URL na wixofday@wix.com",READ_ON_BUTTON_LABEL:"Czytaj wiecej",CLOSE_DESCRIPTION_BUTTON_LABEL:"Zamknij"},pt:{INTRO_PRE_TITLE:"INSPIRE-SE COM O",INTRO_TITLE:"DO DIA!",INTRO_TEXT:"Todos os dias ns exibimos um site incrvel construdo com o Wix.<br>Quer ver o seu site aqui?<br>Envie o seu endereo URL para wixofday@wix.com",READ_ON_BUTTON_LABEL:"Leia mais",CLOSE_DESCRIPTION_BUTTON_LABEL:"Fechar"},ko:{INTRO_PRE_TITLE:" ",INTRO_TITLE:" WIX",INTRO_TEXT:"  Wix    .<br>   ?<br>wixofday@wix.com  URL .",READ_ON_BUTTON_LABEL:"",CLOSE_DESCRIPTION_BUTTON_LABEL:""},ja:{INTRO_PRE_TITLE:"\r\n\r\n",INTRO_TITLE:"WIX ",INTRO_TEXT:"Wix\nURLwixofday@wix.com",READ_ON_BUTTON_LABEL:"",CLOSE_DESCRIPTION_BUTTON_LABEL:""},ru:{INTRO_PRE_TITLE:" ",INTRO_TITLE:"",INTRO_TEXT:"     ,  ,    Wix!<br>,       ?<br>   URL  wixofday@wix.com",READ_ON_BUTTON_LABEL:" ",CLOSE_DESCRIPTION_BUTTON_LABEL:""}}}),b.methods({initialize:function(a,b,c){this.parent(a,b,c),this._SettingsClass=this.imports.ImageSettings,window.userApi&&(this._userApi=window.userApi),this.setState("closed")},_translate:function(a){var b="en";return this._userApi&&(b=this._userApi.getLanguage()),this.Translations[b][a]},render:function(){this._renderImage(),this._renderTexts(),this.parent()},_updateContainers:function(){"closed"==this.getState()?(this._skinParts.introContainer.setStyle("display","block"),this._skinParts.descriptionContainer.setStyle("display","none")):(this._skinParts.introContainer.setStyle("display","none"),this._skinParts.descriptionContainer.setStyle("display","block"))},_renderTexts:function(){this._updateContainers(),this._skinParts.introPreTitle.innerHTML=this._translate("INTRO_PRE_TITLE"),this._skinParts.introTitle.innerHTML=this._translate("INTRO_TITLE"),this._skinParts.introText.innerHTML=this._translate("INTRO_TEXT"),this._skinParts.descriptionText.innerHTML=this._data.get("description"),this._skinParts.shortDescriptionText.innerHTML=this._data.get("description"),this._skinParts.readOn.innerHTML=this._translate("READ_ON_BUTTON_LABEL"),this._skinParts.closeDescription.innerHTML=this._translate("CLOSE_DESCRIPTION_BUTTON_LABEL")},_renderImage:function(){if(this._layoutInitialized){var a=this._skinParts.img;if(a&&a.getOriginalClassName){var b=this._getImageSettings();a.setSettings(b),a.setHeight(274,!1,!1),a.setWidth(344,!1,!1)}}},_getImageSettings:function(){return this._imageSettings||(this._imageSettings=new this.imports.ImageSettings(this._SettingsClass.CropModes.FIT_WIDTH,344,274)),this._imageSettings},_onReadOnClicked:function(a){a.stopPropagation(),this.setState("opened"),W.Utils.Tween.to(this._skinParts.introContainer,.3,{opacity:0,onComplete:this._updateContainers}),W.Utils.Tween.to(this._skinParts.descriptionContainer,.3,{delay:.3,opacity:1})},_onCloseDescriptionClicked:function(a){a.stopPropagation(),this.setState("closed"),W.Utils.Tween.to(this._skinParts.descriptionContainer,.3,{opacity:0,onComplete:this._updateContainers}),W.Utils.Tween.to(this._skinParts.introContainer,.3,{delay:.3,opacity:1})},_onAllSkinPartsReady:function(){this._skinParts.readOn.addEvent(Constants.CoreEvents.CLICK,this._onReadOnClicked),this._skinParts.closeDescription.addEvent(Constants.CoreEvents.CLICK,this._onCloseDescriptionClicked)},_removeAllDomEvents:function(){this._skinParts.readOn.removeEvent(Constants.CoreEvents.CLICK,this._onReadOnClicked),this._skinParts.closeDescription.removeEvent(Constants.CoreEvents.CLICK,this._onCloseDescriptionClicked)},dispose:function(){this._removeAllDomEvents(),this.parent()}})});